<!DOCTYPE html><html lang='en'><head><title>[exec.adapt]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>33.9</a> Senders <a class='abbr_ref' href='exec.snd#exec.adapt'>[exec.snd]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>33.9.12</a> Sender adaptors <a class='abbr_ref'>[exec.adapt]</a></h3><div id='general' class='section'><h4 ><a class='secnum' href='#general' style='min-width:95pt'>33.9.12.1</a> General <a class='abbr_ref' href='exec.adapt.general'>[exec.adapt.general]</a></h4><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3048'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'>Subclause [exec.<span class='shy'></span>adapt] specifies a set of sender adaptors<a class='hidden_link' href='#general-1.sentence-1'>.</a></div></div></div><div class='para' id='general-2'><div class='marginalizedparent'><a class='marginalized' href='#general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3051'>#</a></div><div class='texpara'><div id='general-2.sentence-1' class='sentence'>The bitwise inclusive <span class='textsc'>or</span> operator is overloaded
for the purpose of creating sender chains<a class='hidden_link' href='#general-2.sentence-1'>.</a></div> <div id='general-2.sentence-2' class='sentence'>The adaptors also support function call syntax with equivalent semantics<a class='hidden_link' href='#general-2.sentence-2'>.</a></div></div></div><div class='para' id='general-3'><div class='marginalizedparent'><a class='marginalized' href='#general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3056'>#</a></div><div class='texpara'><div id='general-3.sentence-1' class='sentence'>Unless otherwise specified:
<ul class='itemize'><li id='general-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.1'>(3.1)</a></div><div class='texpara'><div id='general-3.1.sentence-1' class='sentence'>A sender adaptor is prohibited from causing observable effects,
apart from moving and copying its arguments,
before the returned sender is connected with a receiver using <span class='texttt'>connect</span>,
and <span class='texttt'>start</span> is called on the resulting operation state<a class='hidden_link' href='#general-3.1.sentence-1'>.</a></div></div></li><li id='general-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.2'>(3.2)</a></div><div class='texpara'><div id='general-3.2.sentence-1' class='sentence'>A parent sender (<a href='exec.async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) with a single child sender <span class='texttt'>sndr</span> has
an associated attribute object equal to
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> (<a href='exec.fwd.env' title='33.5.1&emsp;forwarding_&shy;query'>[exec.<span class='shy'></span>fwd.<span class='shy'></span>env]</a>)<a class='hidden_link' href='#general-3.2.sentence-1'>.</a></div></div></li><li id='general-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.3'>(3.3)</a></div><div class='texpara'><div id='general-3.3.sentence-1' class='sentence'>A parent sender with more than one child sender has
an associated attributes object equal to <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#general-3.3.sentence-1'>.</a></div></div></li><li id='general-3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.4'>(3.4)</a></div><div class='texpara'><div id='general-3.4.sentence-1' class='sentence'>When a parent sender is connected to a receiver <span class='texttt'>rcvr</span>,
any receiver used to connect a child sender has
an associated environment equal to <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#general-3.4.sentence-1'>.</a></div></div></li><li id='general-3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.5'>(3.5)</a></div><div class='texpara'><div id='general-3.5.sentence-1' class='sentence'>An adaptor whose child senders are all non-dependent (<a href='exec.async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
is itself non-dependent<a class='hidden_link' href='#general-3.5.sentence-1'>.</a></div></div></li><li id='general-3.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.6'>(3.6)</a></div><div class='texpara'><div id='general-3.6.sentence-1' class='sentence'>These requirements apply to any function
that is selected by the implementation of the sender adaptor<a class='hidden_link' href='#general-3.6.sentence-1'>.</a></div></div></li><li id='general-3.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.7'>(3.7)</a></div><div class='texpara'><div id='general-3.7.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use
the completion signatures of the adaptors
to communicate type errors to users and
to propagate any such type errors from child senders<a class='hidden_link' href='#general-3.7.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='general-4'><div class='marginalizedparent'><a class='marginalized' href='#general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3089'>#</a></div><div class='texpara'><div id='general-4.sentence-1' class='sentence'>If a sender returned from a sender adaptor specified in [exec.<span class='shy'></span>adapt]
is specified to include <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>
among its set of completion signatures
where <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span>,
but the implementation does not potentially evaluate
an error completion operation with an <span class='texttt'>exception_<span class='shy'></span>ptr</span> argument,
the implementation is allowed to omit
the <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion signature from the set<a class='hidden_link' href='#general-4.sentence-1'>.</a></div></div></div></div><div id='obj' class='section'><h4 ><a class='secnum' href='#obj' style='min-width:95pt'>33.9.12.2</a> Closure objects <a class='abbr_ref' href='exec.adapt.obj'>[exec.adapt.obj]</a></h4><div class='para' id='obj-1'><div class='marginalizedparent'><a class='marginalized' href='#obj-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3101'>#</a></div><div class='texpara'><div id='obj-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_closure_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_closure_object,pipeable'><i >pipeable sender adaptor closure object</i></span></a> is a function object
that accepts one or more <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='texttt'>sender</span></span></a> arguments and returns a <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-1.sentence-1'>.</a></div> <div id='obj-1.sentence-2' class='sentence'>For a pipeable sender adaptor closure object <span class='texttt'>c</span> and
an expression <span class='texttt'>sndr</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__'><span class='texttt'>sender</span></span></a>,
the following expressions are equivalent and yield a <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___'><span class='texttt'>sender</span></span></a>:
<span class='codeblock'>c<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>
sndr <span class='operator'>|</span> c
</span></div> <div id='obj-1.sentence-3' class='sentence'>
Given an additional pipeable sender adaptor closure object <span class='texttt'>d</span>,
the expression <span class='texttt'>c <span class='operator'>|</span> d</span> produces
another pipeable sender adaptor closure object <span class='texttt'>e</span>:</div></div><div class='texpara'><div id='obj-1.sentence-4' class='sentence'><span class='texttt'>e</span> is a perfect forwarding call wrapper (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>)
with the following properties:
<ul class='itemize'><li id='obj-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.1'>(1.1)</a></div><div class='texpara'><div id='obj-1.1.sentence-1' class='sentence'>Its target object is an object <span class='texttt'>d2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>d<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>d</span><a class='hidden_link' href='#obj-1.1.sentence-1'>.</a></div></div></li><li id='obj-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.2'>(1.2)</a></div><div class='texpara'><div id='obj-1.2.sentence-1' class='sentence'>It has one bound argument entity,
an object <span class='texttt'>c2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>c</span><a class='hidden_link' href='#obj-1.2.sentence-1'>.</a></div></div></li><li id='obj-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.3'>(1.3)</a></div><div class='texpara'><div id='obj-1.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>d2<span class='parenthesis'>(</span>c2<span class='parenthesis'>(</span>arg<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
where arg is the argument used in a function call expression of <span class='texttt'>e</span><a class='hidden_link' href='#obj-1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='obj-1.sentence-5' class='sentence'>
The expression <span class='texttt'>c <span class='operator'>|</span> d</span> is well-formed if and only if
the initializations of the state entities (<a href='func.def' title='22.10.3&emsp;Definitions'>[func.<span class='shy'></span>def]</a>) of <span class='texttt'>e</span>
are all well-formed<a class='hidden_link' href='#obj-1.sentence-5'>.</a></div></div></div><div class='para' id='obj-2'><div class='marginalizedparent'><a class='marginalized' href='#obj-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3134'>#</a></div><div class='texpara'><div id='obj-2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> of type <span class='texttt'>T</span> is
a pipeable sender adaptor closure object
if <span class='texttt'>T</span> models <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>T</span> has no other base classes
of type <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> for any other type <span class='texttt'>U</span>, and
<span class='texttt'>T</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-2.sentence-1'>.</a></div></div></div><div class='para' id='obj-3'><div class='marginalizedparent'><a class='marginalized' href='#obj-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3142'>#</a></div><div class='texpara'><div id='obj-3.sentence-1' class='sentence'>The template parameter <span class='texttt'>D</span> for <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure</span> can be
an incomplete type<a class='hidden_link' href='#obj-3.sentence-1'>.</a></div> <div id='obj-3.sentence-2' class='sentence'>Before any expression of type <span class='mathit'>cv</span> <span class='texttt'>D</span> appears as
an operand to the <span class='texttt'><span class='operator'>|</span></span> operator,
<span class='texttt'>D</span> shall be complete and
model <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>D<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#obj-3.sentence-2'>.</a></div> <div id='obj-3.sentence-3' class='sentence'>The behavior of an expression involving an object of type <span class='mathit'>cv</span> <span class='texttt'>D</span>
as an operand to the <span class='texttt'><span class='operator'>|</span></span> operator is undefined
if overload resolution selects a program-defined <span class='texttt'><span class='keyword'>operator</span><span class='operator'>|</span></span> function<a class='hidden_link' href='#obj-3.sentence-3'>.</a></div></div></div><div class='para' id='obj-4'><div class='marginalizedparent'><a class='marginalized' href='#obj-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3153'>#</a></div><div class='texpara'><div id='obj-4.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_object,pipeable'><i >pipeable sender adaptor object</i></span></a> is a customization point object
that accepts a <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____'><span class='texttt'>sender</span></span></a> as its first argument and
returns a <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-4.sentence-1'>.</a></div> <div id='obj-4.sentence-2' class='sentence'>If a pipeable sender adaptor object accepts only one argument,
then it is a pipeable sender adaptor closure object<a class='hidden_link' href='#obj-4.sentence-2'>.</a></div></div></div><div class='para' id='obj-5'><div class='marginalizedparent'><a class='marginalized' href='#obj-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3160'>#</a></div><div class='texpara'><div id='obj-5.sentence-1' class='sentence'>If a pipeable sender adaptor object adaptor accepts more than one argument,
then let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______'><span class='texttt'>sender</span></span></a>,
let <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be arguments
such that <span class='texttt'>adaptor<span class='parenthesis'>(</span>sndr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is a well-formed expression
as specified below, and
let <span class='texttt'>BoundArgs</span> be a pack that denotes <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#obj-5.sentence-1'>.</a></div> <div id='obj-5.sentence-2' class='sentence'>The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> produces
a pipeable sender adaptor closure object <span class='texttt'>f</span>
that is a perfect forwarding call wrapper with the following properties:
<ul class='itemize'><li id='obj-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.1'>(5.1)</a></div><div class='texpara'><div id='obj-5.1.sentence-1' class='sentence'>Its target object is a copy of adaptor<a class='hidden_link' href='#obj-5.1.sentence-1'>.</a></div></div></li><li id='obj-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.2'>(5.2)</a></div><div class='texpara'><div id='obj-5.2.sentence-1' class='sentence'>Its bound argument entities <span class='texttt'>bound_<span class='shy'></span>args</span> consist of
objects of types <span class='texttt'>BoundArgs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> direct-non-list-initialized with
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, respectively<a class='hidden_link' href='#obj-5.2.sentence-1'>.</a></div></div></li><li id='obj-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.3'>(5.3)</a></div><div class='texpara'><div id='obj-5.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>adaptor<span class='parenthesis'>(</span>rcvr, bound_<span class='shy'></span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>rcvr</span> is
the argument used in a function call expression of <span class='texttt'>f</span><a class='hidden_link' href='#obj-5.3.sentence-1'>.</a></div></div></li></ul></div> <div id='obj-5.sentence-3' class='sentence'>
The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed if and only if
the initializations of the bound argument entities of the result,
as specified above, are all well-formed<a class='hidden_link' href='#obj-5.sentence-3'>.</a></div></div></div></div><div id='exec.write.env' class='section'><h4 ><a class='secnum' href='#exec.write.env' style='min-width:95pt'>33.9.12.3</a> <span class='texttt'>execution&#x200b;::&#x200b;write_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.write.env'>[exec.write.env]</a></h4><div class='para' id='exec.write.env-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.write.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3189'>#</a></div><div class='texpara'><div id='exec.write.env-1.sentence-1' class='sentence'><span class='texttt'>write_<span class='shy'></span>env</span> is a sender adaptor
that accepts a sender and a queryable object, and
that returns a sender that,
when connected with a receiver <span class='texttt'>rcvr</span>,
connects the adapted sender with a receiver
whose execution environment is the result of
joining the <a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable'><span class='texttt'><i >queryable</i></span></span></a> object
to the result of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.write.env-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.write.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3199'>#</a></div><div class='texpara'><div id='exec.write.env-2.sentence-1' class='sentence'><span class='texttt'>write_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#exec.write.env-2.sentence-1'>.</a></div> <div id='exec.write.env-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_'><span class='texttt'><i >queryable</i></span></span></a>,
the expression <span class='texttt'>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.write.env-2.sentence-2'>.</a></div> <div id='exec.write.env-2.sentence-3' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>write_<span class='shy'></span>env, env, sndr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.write.env-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.write.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3208'>#</a></div><div class='texpara'><div id='exec.write.env-3.sentence-1' class='sentence'>Let <span class='texttt'><i >write-env-t</i></span> denote the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-3.sentence-1'>.</a></div> <div id='exec.write.env-3.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >write-env-t</i></span> as follows:
<span id='lib:impls-for<write-env-t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cwrite-env-t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >write-env-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >join-env</i><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>

  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >join-env</i><span class='parenthesis'>(</span>state, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></span></div> <div id='exec.write.env-3.sentence-3' class='sentence'>
Invocation of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >join-env</i></span></span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='exec.write.env-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.write.env-3.1'>(3.1)</a></div><div class='texpara'><div id='exec.write.env-3.1.sentence-1' class='sentence'><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__'><span class='texttt'><i >queryable</i></span></span></a> and</div></div></li><li id='exec.write.env-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.write.env-3.2'>(3.2)</a></div><div class='texpara'><div id='exec.write.env-3.2.sentence-1' class='sentence'>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>state<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid,
otherwise, <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-3.2.sentence-1'>.</a></div></div></li><li id='exec.write.env-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.write.env-3.3'>(3.3)</a></div><div class='texpara'><div id='exec.write.env-3.3.sentence-1' class='sentence'>For a type <span class='texttt'>Sndr</span> and a pack of types <span class='texttt'>Env</span>,
let <span class='texttt'>State</span> be <span class='texttt'><span class='texttt'><i >data-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> and
let <span class='texttt'>JoinEnv</span> be the pack
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >join-env</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>State<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-3.3.sentence-1'>.</a></div> <div id='exec.write.env-3.3.sentence-2' class='sentence'>Then <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-<br/>env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >check-types</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
is expression-equivalent to
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span><br/><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, JoinEnv<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.write.env-3.3.sentence-2'>.</a></div></div></li></ul></div></div></div></div><div id='exec.unstoppable' class='section'><h4 ><a class='secnum' href='#exec.unstoppable' style='min-width:95pt'>33.9.12.4</a> <span class='texttt'>execution&#x200b;::&#x200b;unstoppable</span> <a class='abbr_ref' href='exec.unstoppable'>[exec.unstoppable]</a></h4><div class='para' id='exec.unstoppable-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.unstoppable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3253'>#</a></div><div class='texpara'><div id='exec.unstoppable-1.sentence-1' class='sentence'><span class='texttt'>unstoppable</span> is a sender adaptor
that connects its inner sender
with a receiver that has the execution environment of the outer receiver
but with an object of type <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token</span>
as the result of the <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token query</span><a class='hidden_link' href='#exec.unstoppable-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.unstoppable-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.unstoppable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3260'>#</a></div><div class='texpara'><div id='exec.unstoppable-2.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
<span class='texttt'>unstoppable<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, never_<span class='shy'></span>stop_<span class='shy'></span>token<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.unstoppable-2.sentence-1'>.</a></div></div></div></div><div id='exec.starts.on' class='section'><h4 ><a class='secnum' href='#exec.starts.on' style='min-width:95pt'>33.9.12.5</a> <span class='texttt'>execution&#x200b;::&#x200b;starts_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.starts.on'>[exec.starts.on]</a></h4><div class='para' id='exec.starts.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3267'>#</a></div><div class='texpara'><div id='exec.starts.on-1.sentence-1' class='sentence'><span class='texttt'>starts_<span class='shy'></span>on</span> adapts an input sender into a sender
that will start on an execution agent belonging to
a particular scheduler's associated execution resource<a class='hidden_link' href='#exec.starts.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3272'>#</a></div><div class='texpara'><div id='exec.starts.on-2.sentence-1' class='sentence'>The name <span class='texttt'>starts_<span class='shy'></span>on</span> denotes a customization point object<a class='hidden_link' href='#exec.starts.on-2.sentence-1'>.</a></div> <div id='exec.starts.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.starts.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.starts.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3279'>#</a></div><div class='texpara'><div id='exec.starts.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>starts_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.starts.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3289'>#</a></div><div class='texpara'><div id='exec.starts.on-4.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>OutSndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-4.sentence-1'>.</a></div> <div id='exec.starts.on-4.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, starts_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed; otherwise
<ul class='itemize'><li id='exec.starts.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.1'>(4.1)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li><li id='exec.starts.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.2'>(4.2)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, sndr<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> let_value<span class='parenthesis'>(</span>
  schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>sndr <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.starts.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3315'>#</a></div><div class='texpara'><div id='exec.starts.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-1'>.</a></div> <div id='exec.starts.on-5.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-2'>.</a></div> <div id='exec.starts.on-5.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.starts.on-5.sentence-3'>.</a></div> <div id='exec.starts.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall start <span class='texttt'>sndr</span>
on an execution agent of the associated execution resource of <span class='texttt'>sch</span><a class='hidden_link' href='#exec.starts.on-5.sentence-4'>.</a></div> <div id='exec.starts.on-5.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.starts.on-5.sentence-5'>.</a></div></div></div></div><div id='exec.continues.on' class='section'><h4 ><a class='secnum' href='#exec.continues.on' style='min-width:95pt'>33.9.12.6</a> <span class='texttt'>execution&#x200b;::&#x200b;continues_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.continues.on'>[exec.continues.on]</a></h4><div class='para' id='exec.continues.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3332'>#</a></div><div class='texpara'><div id='exec.continues.on-1.sentence-1' class='sentence'><span class='texttt'>continues_<span class='shy'></span>on</span> adapts a sender into one
that completes on the specified scheduler<a class='hidden_link' href='#exec.continues.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3336'>#</a></div><div class='texpara'><div id='exec.continues.on-2.sentence-1' class='sentence'>The name <span class='texttt'>continues_<span class='shy'></span>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.continues.on-2.sentence-1'>.</a></div> <div id='exec.continues.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.continues.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.continues.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3343'>#</a></div><div class='texpara'><div id='exec.continues.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>continues_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.continues.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3351'>#</a></div><div class='texpara'><div id='exec.continues.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>continues_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>continues_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.continues.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3366'>#</a></div><div class='texpara'><div id='exec.continues.on-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-5.sentence-1'>.</a></div> <div id='exec.continues.on-5.sentence-3' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> schedule_from<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.continues.on-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.continues.on-note-1'>1</a></i>:&ensp;<div id='exec.continues.on-5.sentence-2' class='sentence'>This causes the <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> sender to become
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.continues.on-5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='exec.continues.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3383'>#</a></div><div class='texpara'><div id='exec.continues.on-6.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-1'>.</a></div> <div id='exec.continues.on-6.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-2'>.</a></div> <div id='exec.continues.on-6.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.continues.on-6.sentence-3'>.</a></div> <div id='exec.continues.on-6.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.continues.on-6.sentence-4'>.</a></div> <div id='exec.continues.on-6.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.continues.on-6.sentence-5'>.</a></div></div></div></div><div id='exec.schedule.from' class='section'><h4 ><a class='secnum' href='#exec.schedule.from' style='min-width:95pt'>33.9.12.7</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule_<span class='shy'></span>from</span> <a class='abbr_ref' href='exec.schedule.from'>[exec.schedule.from]</a></h4><div class='para' id='exec.schedule.from-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3402'>#</a></div><div class='texpara'><div id='exec.schedule.from-1.sentence-1' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> schedules work dependent on the completion of a sender
onto a scheduler's associated execution resource<a class='hidden_link' href='#exec.schedule.from-1.sentence-1'>.</a></div> <div id='exec.schedule.from-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.schedule.from-note-1'>1</a></i>:&ensp;<div id='exec.schedule.from-1.sentence-2' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> is not meant to be used in user code;
it is used in the implementation of <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.schedule.from-1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.schedule.from-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3410'>#</a></div><div class='texpara'><div id='exec.schedule.from-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule_<span class='shy'></span>from</span> denotes a customization point object<a class='hidden_link' href='#exec.schedule.from-2.sentence-1'>.</a></div> <div id='exec.schedule.from-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-2.sentence-2'>.</a></div> <div id='exec.schedule.from-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.schedule.from-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.schedule.from-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3419'>#</a></div><div class='texpara'><div id='exec.schedule.from-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>schedule_from, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.schedule.from-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3429'>#</a></div><div class='texpara'><div id='exec.schedule.from-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>schedule_<span class='shy'></span>from_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<schedule_from_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cschedule_from_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>schedule_from_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='exec.schedule.from-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3447'>#</a></div><div class='texpara'><div id='exec.schedule.from-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3456'>#</a></div><div class='texpara'><div id='exec.schedule.from-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='keyword'>requires</span> <a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;

  <span class='keyword'>using</span> sched_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> receiver_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> operation_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span>sched_t<span class='anglebracket'>&gt;</span>, receiver_t<span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='literal'>nullptr</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    variant_t <i >async-result</i>;     <span class='comment'>// <i >exposition only</i></span>
    operation_t <i >op-state</i>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >state-type</i><span class='parenthesis'>(</span>sched_t sch, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <i >op-state</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>sch, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div id='lib:impls-for<schedule_from_t>,check-types'><div id='lib:check-types,impls-for<schedule_from_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cschedule_from_t%3e'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.schedule.from-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3491'>#</a></div><div class='texpara'><div id='exec.schedule.from-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'>get_completion_signatures<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>;   <span class='comment'>// see <a href='exec.snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
</span></div></div></div></div><div class='para' id='exec.schedule.from-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3501'>#</a></div><div class='texpara'><div id='exec.schedule.from-8.sentence-1' class='sentence'>Objects of the local class <span class='texttt'><i >state-type</i></span> can be used
to initialize a structured binding<a class='hidden_link' href='#exec.schedule.from-8.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3505'>#</a></div><div class='texpara'><div id='exec.schedule.from-9.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be
a pack of the arguments to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.schedule.from-9.sentence-1'>.</a></div> <div id='exec.schedule.from-9.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template such that
<span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>, and
let <span class='texttt'><i >is-nothrow-decay-copy-sig</i></span> be a variable template such that
<span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='texttt'><i >is-nothrow-decay-copy-sig</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><br/><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span> is
a constant expression of type <span class='texttt'><span class='keyword'>bool</span></span> and
equal to <span class='texttt'><span class='parenthesis'>(</span>is_<span class='shy'></span>nothrow_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span>, Args<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-9.sentence-2'>.</a></div> <div id='exec.schedule.from-9.sentence-3' class='sentence'>Let <span class='texttt'><i >error-completion</i></span> be a pack consisting of
the type <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>exception_<span class='shy'></span>ptr<span class='parenthesis'>)</span></span>
if <span class='texttt'><span class='parenthesis'>(</span><span class='texttt'><i >is-nothrow-decay-copy-sig</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
and an empty pack otherwise<a class='hidden_link' href='#exec.schedule.from-9.sentence-3'>.</a></div> <div id='exec.schedule.from-9.sentence-4' class='sentence'>Then <span class='texttt'>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, <span class='texttt'><i >error-completion</i></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#exec.schedule.from-9.sentence-4'>.</a></div></div></div><div class='para' id='exec.schedule.from-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3524'>#</a></div><div class='texpara'><div id='exec.schedule.from-10.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>t</span> is an alias for the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >receiver-type</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
    <i >state-type</i><span class='operator'>*</span> <i >state</i>;          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      visit<span class='parenthesis'>(</span>
        <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tuple<span class='operator'>&amp;</span> result<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>monostate, Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>args<span class='squarebracket'>]</span> <span class='operator'>=</span> result;
            tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>,
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >async-result</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3559'>#</a></div><div class='texpara'><div id='exec.schedule.from-11.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of the lambda is <span class='texttt'><span class='literal'>true</span></span>
if the construction of the returned <span class='texttt'><i >state-type</i></span> object
is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.schedule.from-11.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3565'>#</a></div><div class='texpara'><div id='exec.schedule.from-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> result_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span>, Args<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;

  <span class='keyword'>try</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>result_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>nothrow<span class='parenthesis'>)</span>
      state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span>set_error_t,
                                                exception_ptr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
  start<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >op-state</i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.schedule.from-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3585'>#</a></div><div class='texpara'><div id='exec.schedule.from-13.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-13.sentence-1'>.</a></div> <div id='exec.schedule.from-13.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.schedule.from-13.sentence-2'>.</a></div> <div id='exec.schedule.from-13.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.schedule.from-13.sentence-3'>.</a></div> <div id='exec.schedule.from-13.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.schedule.from-13.sentence-4'>.</a></div> <div id='exec.schedule.from-13.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.schedule.from-13.sentence-5'>.</a></div></div></div></div><div id='exec.on' class='section'><h4 ><a class='secnum' href='#exec.on' style='min-width:95pt'>33.9.12.8</a> <span class='texttt'>execution&#x200b;::&#x200b;on</span> <a class='abbr_ref' href='exec.on'>[exec.on]</a></h4><div class='para' id='exec.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3604'>#</a></div><div class='texpara'><div id='exec.on-1.sentence-1' class='sentence'>The <span class='texttt'>on</span> sender adaptor has two forms:
<ul class='itemize'><li id='exec.on-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.1'>(1.1)</a></div><div class='texpara'><div id='exec.on-1.1.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span>,
which starts a sender <span class='texttt'>sndr</span> on an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource and
that, upon <span class='texttt'>sndr</span>'s completion,
transfers execution back to the execution resource
on which the <span class='texttt'>on</span> sender was started<a class='hidden_link' href='#exec.on-1.1.sentence-1'>.</a></div></div></li><li id='exec.on-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.2'>(1.2)</a></div><div class='texpara'><div id='exec.on-1.2.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span>,
which upon completion of a sender <span class='texttt'>sndr</span>,
transfers execution to an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource,
then executes a sender adaptor closure <span class='texttt'>closure</span>
with the async results of the sender, and
that then transfers execution back to the execution resource
on which <span class='texttt'>sndr</span> completed<a class='hidden_link' href='#exec.on-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3625'>#</a></div><div class='texpara'><div id='exec.on-2.sentence-1' class='sentence'>The name <span class='texttt'>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.on-2.sentence-1'>.</a></div> <div id='exec.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
<span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.on-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.2'>(2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr</span> is not
a pipeable sender adaptor closure object (<a href='#obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>), or</li><li id='exec.on-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.3'>(2.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr </span>is also a pipeable sender adaptor closure object<a class='hidden_link' href='#exec.on-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='exec.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3641'>#</a></div><div class='texpara'><div id='exec.on-3.sentence-1' class='sentence'>Otherwise, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________'><span class='texttt'>sender</span></span></a>,
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3651'>#</a></div><div class='texpara'><div id='exec.on-4.sentence-1' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>sch</span>, and <span class='texttt'>closure</span>, if
<ul class='itemize'><li id='exec.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.2'>(4.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.on-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.3'>(4.3)</a></div><span class='texttt'>closure</span> is not a pipeable sender adaptor closure object (<a href='#obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>),</li></ul>
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, <i >product-type</i><span class='curlybracket'>{</span>sch, closure<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.on-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3670'>#</a></div><div class='texpara'><div id='exec.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions,
let <span class='texttt'>OutSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>Env</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-5.sentence-1'>.</a></div> <div id='exec.on-5.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for__'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed<a class='hidden_link' href='#exec.on-5.sentence-2'>.</a></div></div></div><div class='para' id='exec.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3678'>#</a></div><div class='texpara'><div id='exec.on-6.sentence-1' class='sentence'>Otherwise:
Let <span class='texttt'><i >not-a-scheduler</i></span> be an unspecified empty class type<a class='hidden_link' href='#exec.on-6.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3682'>#</a></div><div class='texpara'><div id='exec.on-7.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3694'>#</a></div><div class='texpara'><div id='exec.on-8.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span>
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> continues_on<span class='parenthesis'>(</span>
      starts_on<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>sch, closure<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span> <i >query-with-default</i><span class='parenthesis'>(</span>
    get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span>,
    get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>
      continues_on<span class='parenthesis'>(</span>
        std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>closure<span class='parenthesis'>)</span><span class='parenthesis'>(</span>
          continues_on<span class='parenthesis'>(</span>
            write_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >SCHED-ENV</i><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
            sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        orig_sch<span class='parenthesis'>)</span>,
      <i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3732'>#</a></div><div class='texpara'><div id='exec.on-9.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-9.sentence-1'>.</a></div> <div id='exec.on-9.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-9.sentence-2'>.</a></div> <div id='exec.on-9.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-9.sentence-3'>.</a></div> <div id='exec.on-9.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-9.1'>(9.1)</a></div>remember the current scheduler, <span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li><li id='exec.on-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-9.2'>(9.2)</a></div>start <span class='texttt'>sndr</span> on an execution agent belonging to
<span class='texttt'>sch</span>'s associated execution resource;</li><li id='exec.on-9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-9.3'>(9.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1; and</li><li id='exec.on-9.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-9.4'>(9.4)</a></div>forward <span class='texttt'>sndr</span>'s async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-9.sentence-4'>.</a></li></ul></div> <div id='exec.on-9.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.on-9.sentence-5'>.</a></div></div></div><div class='para' id='exec.on-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3759'>#</a></div><div class='texpara'><div id='exec.on-10.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-10.sentence-1'>.</a></div> <div id='exec.on-10.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-10.sentence-2'>.</a></div> <div id='exec.on-10.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-3'>.</a></div> <div id='exec.on-10.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.1'>(10.1)</a></div>remember the current scheduler,
which is the first of the following expressions that is well-formed:
<ul class='itemize'><li id='exec.on-10.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-10.1.1'>(10.1.1)</a></div><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.on-10.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-10.1.2'>(10.1.2)</a></div><span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li></ul></li><li id='exec.on-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.2'>(10.2)</a></div>start <span class='texttt'>sndr</span> on the current execution agent;</li><li id='exec.on-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.3'>(10.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution to an agent
owned by <span class='texttt'>sch</span>'s associated execution resource;</li><li id='exec.on-10.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.4'>(10.4)</a></div>forward <span class='texttt'>sndr</span>'s async result as if by
connecting and starting a sender <span class='texttt'>closure<span class='parenthesis'>(</span>S<span class='parenthesis'>)</span></span>,
where <span class='texttt'>S</span> is a sender
that completes synchronously with <span class='texttt'>sndr</span>'s async result; and</li><li id='exec.on-10.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.5'>(10.5)</a></div>upon completion of the operation started in the previous step,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1 and
forward the operation's async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-4'>.</a></li></ul></div> <div id='exec.on-10.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed on
an unspecified execution agent<a class='hidden_link' href='#exec.on-10.sentence-5'>.</a></div></div></div></div><div id='exec.then' class='section'><h4 ><a class='secnum' href='#exec.then' style='min-width:95pt'>33.9.12.9</a> <span class='texttt'>execution&#x200b;::&#x200b;then</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.then'>[exec.then]</a></h4><div class='para' id='exec.then-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3800'>#</a></div><div class='texpara'><div id='exec.then-1.sentence-1' class='sentence'><span class='texttt'>then</span> attaches an invocable as a continuation
for an input sender's value completion operation<a class='hidden_link' href='#exec.then-1.sentence-1'>.</a></div> <div id='exec.then-1.sentence-2' class='sentence'><span class='texttt'>upon_<span class='shy'></span>error</span> and <span class='texttt'>upon_<span class='shy'></span>stopped</span> do the same
for the error and stopped completion operations, respectively,
sending the result of the invocable as a value completion<a class='hidden_link' href='#exec.then-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.then-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3807'>#</a></div><div class='texpara'><div id='exec.then-2.sentence-1' class='sentence'>The names <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#exec.then-2.sentence-1'>.</a></div> <div id='exec.then-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >then-cpo</i></span> be one of
<span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, or <span class='texttt'>upon_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.then-2.sentence-2'>.</a></div> <div id='exec.then-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span> </span>is ill-formed<a class='hidden_link' href='#exec.then-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.then-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3817'>#</a></div><div class='texpara'><div id='exec.then-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >then-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.then-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.then-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3825'>#</a></div><div class='texpara'><div id='exec.then-4.sentence-1' class='sentence'>For <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.then-4.sentence-1'>.</a></div> <div id='exec.then-4.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >then-cpo</i></span> as follows:
<span id='lib:impls-for<decayed-typeof<then-cpo>>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cdecayed-typeof%3cthen-cpo%3e%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >then-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
        <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> fn, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span>set<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr,
                          invoke<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
            Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='texpara'><div id='lib:impls-for<decayed-typeof<then-cpo>>,check-types'><div id='lib:check-types,impls-for<decayed-typeof<then-cpo>>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cdecayed-typeof%3cthen-cpo%3e%3e'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.then-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3860'>#</a></div><div class='texpara'><div id='exec.then-5.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_value_t<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='tcode_in_codeblock'>invocable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='curlybracket'>{</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#exec.then-5.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.then-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3875'>#</a></div><div class='texpara'><div id='exec.then-6.sentence-1' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> has undefined behavior
unless it returns a sender <span class='texttt'>out_<span class='shy'></span>sndr</span> that
<ul class='itemize'><li id='exec.then-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-6.1'>(6.1)</a></div>invokes <span class='texttt'>f</span> or a copy of such
with the value, error, or stopped result datums of <span class='texttt'>sndr</span>
for <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>, respectively,
using the result value of <span class='texttt'>f</span> as <span class='texttt'>out_<span class='shy'></span>sndr</span>'s value completion, and</li><li id='exec.then-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-6.2'>(6.2)</a></div>forwards all other completion operations unchanged<a class='hidden_link' href='#exec.then-6.sentence-1'>.</a></li></ul></div></div></div></div><div id='exec.let' class='section'><h4 ><a class='secnum' href='#exec.let' style='min-width:95pt'>33.9.12.10</a> <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>value</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.let'>[exec.let]</a></h4><div class='para' id='exec.let-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3890'>#</a></div><div class='texpara'><div id='exec.let-1.sentence-1' class='sentence'><span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> transform
a sender's value, error, and stopped completions, respectively,
into a new child asynchronous operation
by passing the sender's result datums to a user-specified callable,
which returns a new sender that is connected and started<a class='hidden_link' href='#exec.let-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3897'>#</a></div><div class='texpara'><div id='exec.let-2.sentence-1' class='sentence'>For <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.let-2.sentence-1'>.</a></div> <div id='exec.let-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >let-cpo</i></span> be one of
<span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, or <span class='texttt'>let_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.let-2.sentence-2'>.</a></div> <div id='exec.let-2.sentence-3' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> be expression-equivalent to
the first well-formed expression below:
<ul class='itemize'><li id='exec.let-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.1'>(2.1)</a></div><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.2'>(2.2)</a></div><span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>domain, get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.3'>(2.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li></ul></div></div></div><div class='para' id='exec.let-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3915'>#</a></div><div class='texpara'><div id='exec.let-3.sentence-1' class='sentence'>The names <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> denote
pipeable sender adaptor objects<a class='hidden_link' href='#exec.let-3.sentence-1'>.</a></div> <div id='exec.let-3.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
let <span class='texttt'>F</span> be the decayed type of <span class='texttt'>f</span><a class='hidden_link' href='#exec.let-3.sentence-2'>.</a></div> <div id='exec.let-3.sentence-3' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_'><span class='texttt'><i >movable-value</i></span></span></a>,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-3'>.</a></div> <div id='exec.let-3.sentence-4' class='sentence'>If <span class='texttt'>F</span> does not satisfy <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable_'><span class='texttt'>invocable</span></span></a>,
the expression <span class='texttt'>let_<span class='shy'></span>stopped<span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3926'>#</a></div><div class='texpara'><div id='exec.let-4.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >let-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.let-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3934'>#</a></div><div class='texpara'><div id='exec.let-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >let-cpo</i></span> as follows:
<span id='lib:impls-for<decayed-typeof<let-cpo>>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cdecayed-typeof%3clet-cpo%3e%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> <i >let-bind</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >let-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='exec.let-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3954'>#</a></div><div class='texpara'><div id='exec.let-6.sentence-1' class='sentence'>Let <span class='texttt'><i >receiver2</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >receiver2</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
    <span class='curlybracket'>}</span>

    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    Env <i >env</i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div> <div id='exec.let-6.sentence-2' class='sentence'>
Invocation of the function <span class='texttt'><span class='texttt'><i >receiver2</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env</span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='exec.let-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-6.1'>(6.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___'><span class='texttt'><i >queryable</i></span></span></a> and</li><li id='exec.let-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-6.2'>(6.2)</a></div>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'><span class='texttt'><i >env</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid;
otherwise,
if the type of <span class='texttt'>q</span> satisfies <a href='execution.syn#concept:forwarding-query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:forwarding-query'><span class='texttt'><i >forwarding-query</i></span></span></a>,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>;
otherwise,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-6.sentence-2'>.</a></li></ul></div></div></div><div class='texpara'><div id='lib:impls-for<decayed-typeof<let-cpo>>,check-types'><div id='lib:check-types,impls-for<decayed-typeof<let-cpo>>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cdecayed-typeof%3clet-cpo%3e%3e'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.let-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4009'>#</a></div><div class='texpara'><div id='exec.let-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>using</span> LetFn <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><i >is-valid-let-sender</i><span class='parenthesis'>)</span>   <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='parenthesis'>(</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span>, and
where <span class='texttt'><i >is-valid-let-sender</i></span> is <span class='texttt'><span class='literal'>true</span></span> if and only if
all of the following are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.let-7.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.let-7.1'>(7.1)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span>, Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span></li><li id='exec.let-7.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.let-7.2'>(7.2)</a></div><span class='texttt'><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable__'><span class='texttt'>invocable</span></span></a><span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span></li><li id='exec.let-7.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.let-7.3'>(7.3)</a></div><span class='texttt'><a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>invoke_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span></li><li id='exec.let-7.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.let-7.4'>(7.4)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>invoke_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>, <i >env-t</i><br/><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span></li></ul>
where <span class='texttt'><i >env-t</i></span> is the pack
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-7.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.let-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4036'>#</a></div><div class='texpara'><div id='exec.let-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, fn, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>using</span> fn_t <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>using</span> env_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> args_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> ops2_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    fn_t <i >fn</i>;                    <span class='comment'>// <i >exposition only</i></span>
    env_t <i >env</i>;                  <span class='comment'>// <i >exposition only</i></span>
    args_variant_t <i >args</i>;        <span class='comment'>// <i >exposition only</i></span>
    ops2_variant_t <i >ops2</i>;        <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><i >allocator-aware-forward</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, rcvr<span class='parenthesis'>)</span>,
                    <i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4058'>#</a></div><div class='texpara'><div id='exec.let-9.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-9.sentence-1'>.</a></div> <div id='exec.let-9.sentence-2' class='sentence'>Let <span class='texttt'>LetSigs</span> be a pack of those types in <span class='texttt'>Sigs</span>
with a return type of <span class='texttt'><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-9.sentence-2'>.</a></div> <div id='exec.let-9.sentence-3' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-9.sentence-3'>.</a></div> <div id='exec.let-9.sentence-4' class='sentence'>Then <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-9.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4071'>#</a></div><div class='texpara'><div id='exec.let-10.sentence-1' class='sentence'>Given a type <span class='texttt'>Tag</span> and a pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-sndr2</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-sndr2</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>F, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-10.sentence-1'>.</a></div> <div id='exec.let-10.sentence-2' class='sentence'>Then <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>monostate, connect_result_t<span class='anglebracket'>&lt;</span><i >as-sndr2</i><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span>, <i >receiver2</i><span class='anglebracket'>&lt;</span>Rcvr, env_t<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-10.sentence-2'>.</a></div></div></div><div class='para' id='exec.let-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4083'>#</a></div><div class='texpara'><div id='exec.let-11.sentence-1' class='sentence'>The <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a> constraining the above lambda is satisfied
if and only if
the types <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> and <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> are well-formed<a class='hidden_link' href='#exec.let-11.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4088'>#</a></div><div class='texpara'><div id='exec.let-12.sentence-1' class='sentence'>The exposition-only function template <span class='texttt'><i >let-bind</i></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>using</span> args_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> mkop2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> connect<span class='parenthesis'>(</span>
    apply<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>fn<span class='parenthesis'>)</span>,
          state<span class='operator'>.</span>args<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>args_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >receiver2</i><span class='curlybracket'>{</span>rcvr, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>env<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
start<span class='parenthesis'>(</span>state<span class='operator'>.</span>ops2<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>mkop2<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >emplace-from</i><span class='curlybracket'>{</span>mkop2<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.let-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4102'>#</a></div><div class='texpara'><div id='exec.let-13.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span>let<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >let-bind</i><span class='parenthesis'>(</span>state, rcvr, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4116'>#</a></div><div class='texpara'><div id='exec.let-14.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions, and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-14.sentence-1'>.</a></div> <div id='exec.let-14.sentence-2' class='sentence'>If
<span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for___'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#exec.let-14.sentence-2'>.</a></div> <div id='exec.let-14.sentence-3' class='sentence'>Otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.let-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4130'>#</a></div><div class='texpara'><div id='exec.let-15.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.let-15.sentence-1'>.</a></div> <div id='exec.let-15.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:
<ul class='itemize'><li id='exec.let-15.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-15.1'>(15.1)</a></div>invokes <span class='texttt'>f</span> when <span class='texttt'><i >set-cpo</i></span> is called
with <span class='texttt'>sndr</span>'s result datums,</li><li id='exec.let-15.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-15.2'>(15.2)</a></div>makes its completion dependent on
the completion of a sender returned by <span class='texttt'>f</span>, and</li><li id='exec.let-15.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-15.3'>(15.3)</a></div>propagates the other completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#exec.let-15.sentence-2'>.</a></li></ul></div></div></div></div><div id='exec.bulk' class='section'><h4 ><a class='secnum' href='#exec.bulk' style='min-width:95pt'>33.9.12.11</a> <span class='texttt'>execution&#x200b;::&#x200b;bulk</span>, <span class='texttt'>execution&#x200b;::&#x200b;bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>execution&#x200b;::&#x200b;bulk_<span class='shy'></span>unchunked</span> <a class='abbr_ref' href='exec.bulk'>[exec.bulk]</a></h4><div class='para' id='exec.bulk-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4152'>#</a></div><div class='texpara'><div id='exec.bulk-1.sentence-1' class='sentence'><span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>
run a task repeatedly for every index in an index space<a class='hidden_link' href='#exec.bulk-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.bulk-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4156'>#</a></div><div class='texpara'><div id='exec.bulk-2.sentence-1' class='sentence'>The names <span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#exec.bulk-2.sentence-1'>.</a></div> <div id='exec.bulk-2.sentence-2' class='sentence'>Let <span class='texttt'><i >bulk-algo</i></span> be either
<span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, or <span class='texttt'>bulk_<span class='shy'></span>unchunked</span><a class='hidden_link' href='#exec.bulk-2.sentence-2'>.</a></div> <div id='exec.bulk-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>policy</span>, <span class='texttt'>shape</span>, and <span class='texttt'>f</span>,
let
<span class='texttt'>Policy</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>policy<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>Shape</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
<span class='texttt'>Func</span> be <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.bulk-2.sentence-3'>.</a></div> <div id='exec.bulk-2.sentence-4' class='sentence'>If
<ul class='itemize'><li id='exec.bulk-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.bulk-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-2.2'>(2.2)</a></div><span class='texttt'>is_<span class='shy'></span>execution_<span class='shy'></span>policy_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>Policy<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='exec.bulk-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-2.3'>(2.3)</a></div><span class='texttt'>Shape</span> does not satisfy <a href='concepts.arithmetic#concept:integral' title='18.4.7&emsp;Arithmetic concepts&emsp;[concepts.arithmetic]'><span id='conceptref:integral'><span class='texttt'>integral</span></span></a>, or</li><li id='exec.bulk-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-2.4'>(2.4)</a></div><span class='texttt'>Func</span> does not model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>,</li></ul>
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.bulk-2.sentence-4'>.</a></div></div></div><div class='para' id='exec.bulk-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4179'>#</a></div><div class='texpara'><div id='exec.bulk-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span>
is expression-equivalent to:</div></div><div class='texpara'><div id='exec.bulk-3.sentence-2' class='sentence'><span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>
    <i >bulk-algo</i>, <i >product-type</i><span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i>, Shape, Func<span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>policy, shape, f<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.bulk-3.sentence-2'>.</a></div> <div id='exec.bulk-3.sentence-3' class='sentence'>The first template argument of <span class='texttt'><i >product-type</i></span> is <span class='texttt'>Policy</span>
if <span class='texttt'>Policy</span> models <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible_'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>, and
<span class='texttt'><span class='keyword'>const</span> Policy<span class='operator'>&amp;</span></span> otherwise<a class='hidden_link' href='#exec.bulk-3.sentence-3'>.</a></div></div></div><div class='para' id='exec.bulk-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4193'>#</a></div><div class='texpara'><div id='exec.bulk-4.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions such that
<span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.bulk-4.sentence-1'>.</a></div> <div id='exec.bulk-4.sentence-3' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, bulk_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>, then
the expression <span class='texttt'>bulk<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>policy, shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
<span class='keyword'>auto</span> new_f <span class='operator'>=</span> <span class='squarebracket'>[</span>func <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span>Shape begin, Shape end, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> vs<span class='parenthesis'>)</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span>begin, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>while</span> <span class='parenthesis'>(</span>begin <span class='operator'>!</span><span class='operator'>=</span> end<span class='parenthesis'>)</span> func<span class='parenthesis'>(</span>begin<span class='operator'>+</span><span class='operator'>+</span>, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> bulk_chunked<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, policy, shape, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>new_f<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.bulk-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.bulk-note-1'>1</a></i>:&ensp;<div id='exec.bulk-4.sentence-2' class='sentence'>This causes the <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> sender to be
expressed in terms of <span class='texttt'>bulk_<span class='shy'></span>chunked<span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> when
it is connected to a receiver whose
execution domain does not customize <span class='texttt'>bulk</span><a class='hidden_link' href='#exec.bulk-4.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='exec.bulk-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4215'>#</a></div><div class='texpara'><div id='exec.bulk-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>chunked_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<bulk_chunked_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cbulk_chunked_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_chunked_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div> <div id='exec.bulk-5.sentence-2' class='sentence'>
The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>chunked_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>policy, shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        f<span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div> <div id='exec.bulk-5.sentence-3' class='sentence'>
The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above is
<span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-5.sentence-3'>.</a></div></div></div><div class='para' id='exec.bulk-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4253'>#</a></div><div class='texpara'><div id='exec.bulk-6.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>unchunked_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_unchunked_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div> <div id='exec.bulk-6.sentence-2' class='sentence'>
The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>unchunked_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>for</span> <span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span> i <span class='operator'>=</span> <span class='literal'>0</span>; i <span class='anglebracket'>&lt;</span> shape; <span class='operator'>+</span><span class='operator'>+</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>i<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div> <div id='exec.bulk-6.sentence-3' class='sentence'>
The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause__'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above
is <span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-6.sentence-3'>.</a></div></div></div><div class='texpara'><div id='lib:impls-for<bulk_t>,check-types'><div id='lib:check-types,impls-for<bulk_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cbulk_t%3e'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.bulk-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4296'>#</a></div><div class='texpara'><div id='exec.bulk-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_value_t<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable___'><span class='tcode_in_codeblock'>invocable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, Ts<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='parenthesis'>(</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#exec.bulk-7.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.bulk-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4311'>#</a></div><div class='texpara'><div id='exec.bulk-8.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-8.sentence-1'>.</a></div> <div id='exec.bulk-8.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:</div></div><div class='texpara'><ul class='itemize'><li id='exec.bulk-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-8.1'>(8.1)</a></div><div class='texpara'><div id='exec.bulk-8.1.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> has a successful completion, where
<span class='texttt'>args</span> is a pack of lvalue subexpressions
referring to the value completion result datums of <span class='texttt'>sndr</span>, or
decayed copies of those values if they model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible__'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>,
then:</div></div><div class='texpara'><ul class='itemize'><li id='exec.bulk-8.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.bulk-8.1.1'>(8.1.1)</a></div><div class='texpara'><div id='exec.bulk-8.1.1.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> also completes successfully, then:</div></div><div class='texpara'><ul class='itemize'><li id='exec.bulk-8.1.1.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.1.1'>(8.1.1.1)</a></div><div class='texpara'><div id='exec.bulk-8.1.1.1.sentence-1' class='sentence'>for <span class='texttt'>bulk</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span>
    from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>;</div></div></li><li id='exec.bulk-8.1.1.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.1.2'>(8.1.1.2)</a></div><div class='texpara'><div id='exec.bulk-8.1.1.2.sentence-1' class='sentence'>for <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span>
    from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>;</div></div><div class='texpara'><div id='exec.bulk-8.1.1.2.sentence-2' class='sentence'><i >Recommended practice</i>: The underlying scheduler should execute each iteration
    on a distinct execution agent<a class='hidden_link' href='#exec.bulk-8.1.1.2.sentence-2'>.</a></div></div></li><li id='exec.bulk-8.1.1.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.1.3'>(8.1.1.3)</a></div><div class='texpara'><div id='exec.bulk-8.1.1.3.sentence-1' class='sentence'>for <span class='texttt'>bulk_<span class='shy'></span>chunked</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>b</span></span>, <span class='math'><span class='mathalpha'>e</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> zero or more times
    with pairs of <span class='math'><span class='mathalpha'>b</span></span> and <span class='math'><span class='mathalpha'>e</span></span> of type <span class='texttt'>Shape</span>
    in range [<span class='texttt'><span class='texttt'><span class='literal'>0</span></span>, <span class='texttt'>shape</span></span>],
    such that <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">&lt;</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">e</span></span></span></span></span></span> and
    for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span> from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>,
    there is exactly one invocation with a pair <span class='math'><span class='mathalpha'>b</span></span> and <span class='math'><span class='mathalpha'>e</span></span>,
    such that <span class='math'><span class='mathalpha'>i</span></span> is in the range [<span class='texttt'><span class='math'><span class='mathalpha'>b</span></span>, <span class='math'><span class='mathalpha'>e</span></span></span>)<a class='hidden_link' href='#exec.bulk-8.1.1.3.sentence-1'>.</a></div></div></li></ul></div></li><li id='exec.bulk-8.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.bulk-8.1.2'>(8.1.2)</a></div><div class='texpara'><div id='exec.bulk-8.1.2.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> completes with <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, eptr<span class='parenthesis'>)</span></span>, then
  the asynchronous operation may invoke a subset of
  the invocations of <span class='texttt'>f</span>
  before the error completion handler is called, and
  <span class='texttt'>eptr</span> is an <span class='texttt'>exception_<span class='shy'></span>ptr</span> containing either:
    <ul class='itemize'><li id='exec.bulk-8.1.2.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.2.1'>(8.1.2.1)</a></div>an exception thrown by an invocation of <span class='texttt'>f</span>, or</li><li id='exec.bulk-8.1.2.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.2.2'>(8.1.2.2)</a></div>a <span class='texttt'>bad_<span class='shy'></span>alloc</span> exception if
    the implementation fails to allocate required resources, or</li><li id='exec.bulk-8.1.2.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.bulk-8.1.2.3'>(8.1.2.3)</a></div>an exception derived from <span class='texttt'>runtime_<span class='shy'></span>error</span><a class='hidden_link' href='#exec.bulk-8.1.2.sentence-1'>.</a></li></ul></div></div></li><li id='exec.bulk-8.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.bulk-8.1.3'>(8.1.3)</a></div><div class='texpara'><div id='exec.bulk-8.1.3.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> completes with <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>, then
  the asynchronous operation may invoke a subset of
  the invocations of <span class='texttt'>f</span>
  before the stopped completion handler<a class='hidden_link' href='#exec.bulk-8.1.3.sentence-1'>.</a></div></div></li></ul></div></li><li id='exec.bulk-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-8.2'>(8.2)</a></div><div class='texpara'><div id='exec.bulk-8.2.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> does not complete with <span class='texttt'>set_<span class='shy'></span>value</span>, then
the completion is forwarded to <span class='texttt'>recv</span><a class='hidden_link' href='#exec.bulk-8.2.sentence-1'>.</a></div></div></li><li id='exec.bulk-8.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-8.3'>(8.3)</a></div><div class='texpara'><div id='exec.bulk-8.3.sentence-1' class='sentence'>For <span class='texttt'><i >bulk-algo</i></span>,
the parameter <span class='texttt'>policy</span> describes
the manner in which
the execution of the asynchronous operations corresponding to these algorithms
may be parallelized and
the manner in which
they apply <span class='texttt'>f</span><a class='hidden_link' href='#exec.bulk-8.3.sentence-1'>.</a></div> <div id='exec.bulk-8.3.sentence-2' class='sentence'>Permissions and requirements
on parallel algorithm element access functions (<a href='algorithms.parallel.exec' title='26.3.3&emsp;Effect of execution policies on algorithm execution'>[algorithms.<span class='shy'></span>parallel.<span class='shy'></span>exec]</a>)
apply to <span class='texttt'>f</span><a class='hidden_link' href='#exec.bulk-8.3.sentence-2'>.</a></div></div></li></ul></div></div><div class='para nonNormativeOnly' id='exec.bulk-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4401'>#</a></div><div class='texpara'><div id='exec.bulk-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.bulk-note-2'>2</a></i>:&ensp;<div id='exec.bulk-9.sentence-1' class='sentence'>The asynchronous operation corresponding to
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span>
can complete with <span class='texttt'>set_<span class='shy'></span>stopped</span> if cancellation is requested or
ignore cancellation requests<a class='hidden_link' href='#exec.bulk-9.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div id='exec.when.all' class='section'><h4 ><a class='secnum' href='#exec.when.all' style='min-width:95pt'>33.9.12.12</a> <span class='texttt'>execution&#x200b;::&#x200b;when_<span class='shy'></span>all</span> <a class='abbr_ref' href='exec.when.all'>[exec.when.all]</a></h4><div class='para' id='exec.when.all-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4411'>#</a></div><div class='texpara'><div id='exec.when.all-1.sentence-1' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span>
both adapt multiple input senders into a sender
that completes when all input senders have completed<a class='hidden_link' href='#exec.when.all-1.sentence-1'>.</a></div> <div id='exec.when.all-1.sentence-2' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> only accepts senders
with a single value completion signature and
on success concatenates all the input senders' value result datums
into its own value completion operation<a class='hidden_link' href='#exec.when.all-1.sentence-2'>.</a></div> <div id='exec.when.all-1.sentence-3' class='sentence'><span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is semantically equivalent to
w<span class='texttt'>hen_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>sndrs</span> is a pack of subexpressions
whose types model <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.when.all-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.when.all-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4424'>#</a></div><div class='texpara'><div id='exec.when.all-2.sentence-1' class='sentence'>The names <span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span> denote
customization point objects<a class='hidden_link' href='#exec.when.all-2.sentence-1'>.</a></div> <div id='exec.when.all-2.sentence-2' class='sentence'>Let <span class='texttt'>sndrs</span> be a pack of subexpressions,
let <span class='texttt'>Sndrs</span> be a pack of the types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, and
let <span class='texttt'>CD</span> be
the type <span class='texttt'>common_<span class='shy'></span>type_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-2.sentence-2'>.</a></div> <div id='exec.when.all-2.sentence-3' class='sentence'>Let <span class='texttt'>CD2</span> be <span class='texttt'>CD</span> if <span class='texttt'>CD</span> is well-formed, and
<span class='texttt'>default_<span class='shy'></span>domain</span> otherwise<a class='hidden_link' href='#exec.when.all-2.sentence-3'>.</a></div> <div id='exec.when.all-2.sentence-4' class='sentence'>The expressions <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> are ill-formed
if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.when.all-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>0</span></span>, or</li><li id='exec.when.all-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndrs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.when.all-2.sentence-4'>.</a></li></ul></div></div></div><div class='para' id='exec.when.all-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4443'>#</a></div><div class='texpara'><div id='exec.when.all-3.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='exec.when.all-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4449'>#</a></div><div class='texpara'><div id='exec.when.all-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<when_all_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cwhen_all_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>when_all_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='exec.when.all-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4469'>#</a></div><div class='texpara'><div id='exec.when.all-5.sentence-1' class='sentence'>Let <span class='texttt'><i >make-when-all-env</i></span> be
the following exposition-only function template:
<a class='index' id='lib:make-when-all-env'></a>
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >make-when-all-env</i><span class='parenthesis'>(</span>inplace_stop_source<span class='operator'>&amp;</span> stop_src,               <span class='comment'>// <i >exposition only</i></span>
                                   Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
<span class='curlybracket'>}</span>
</span></div> <div id='exec.when.all-5.sentence-2' class='sentence'>
Returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='exec.when.all-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-5.1'>(5.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____'><span class='texttt'><i >queryable</i></span></span></a>, and</li><li id='exec.when.all-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-5.2'>(5.2)</a></div><span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >stop-src</i></span><span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and</li><li id='exec.when.all-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-5.3'>(5.3)</a></div>given a query object <span class='texttt'>q</span>
with type other than <span class='mathit'>cv</span> <span class='texttt'>stop_<span class='shy'></span>token_<span class='shy'></span>t</span> and
whose type satisfies <span id='conceptref:forwarding-query_'><span class='texttt'><i >forwarding-query</i></span></span>,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.when.all-5.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='exec.when.all-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4495'>#</a></div><div class='texpara'><div id='exec.when.all-6.sentence-1' class='sentence'>Let <span class='texttt'><i >when-all-env</i></span> be an alias template such that
<span class='texttt'><i >when-all-env</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span></span> denotes the type
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >make-<br/>when-all-env</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>inplace_<span class='shy'></span>stop_<span class='shy'></span>source<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.when.all-6.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:impls-for<when_all_t>,check-types'><div id='lib:check-types,impls-for<when_all_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cwhen_all_t%3e'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.when.all-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4507'>#</a></div><div class='texpara'><div id='exec.when.all-7.sentence-1' class='sentence'>Let <span class='texttt'>Is</span> be the pack of integral template arguments of
the <span class='texttt'>integer_<span class='shy'></span>sequence</span> specialization denoted by
<span class='texttt'><span class='texttt'><i >indices-for</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-7.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.when.all-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4512'>#</a></div><div class='texpara'><div id='exec.when.all-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Child<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span>Child, <i >when-all-env</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span>cs<span class='operator'>.</span><i >count-of</i><span class='parenthesis'>(</span>set_value<span class='parenthesis'>)</span> <span class='anglebracket'>&gt;</span><span class='operator'>=</span> <span class='literal'>2</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>; <span class='comment'>// see <a href='exec.snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
<span class='curlybracket'>}</span>;
<span class='parenthesis'>(</span>fn<span class='operator'>.</span><span class='keyword'>template</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr, Is<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#exec.when.all-8.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.when.all-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4527'>#</a></div><div class='texpara'><div id='exec.when.all-9.sentence-1' class='sentence'><i >Throws</i>: Any exception thrown as a result of evaluating the <i >Effects</i>, or
an exception of an unspecified type
derived from <span class='texttt'>exception</span> when <span class='texttt'>CD</span> is ill-formed<a class='hidden_link' href='#exec.when.all-9.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.when.all-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4534'>#</a></div><div class='texpara'><div id='exec.when.all-10.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>CD, default_domain<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_domain, CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4548'>#</a></div><div class='texpara'><div id='exec.when.all-11.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, State<span class='operator'>&amp;</span> state, <span class='keyword'>const</span> Receiver<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >make-when-all-env</i><span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop-src</i>, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4558'>#</a></div><div class='texpara'><div id='exec.when.all-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;
<span class='curlybracket'>}</span>
</span>
where <span class='math'><span class='mathalpha'>e</span></span> is the expression
<span class='codeblock'>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='operator'>.</span>apply<span class='parenthesis'>(</span><i >make-state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and where <span class='texttt'><i >make-state</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>enum</span> <span class='keyword'>class</span> <i >disposition</i> <span class='curlybracket'>{</span> <i >started</i>, <i >error</i>, <i >stopped</i> <span class='curlybracket'>}</span>;             <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >make-state</i> <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sndrs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span>, Sndrs<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> sndrs<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> values_tuple <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> errors_variant <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_callback <span class='operator'>=</span> stop_callback_for_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
      <span class='keyword'>void</span> <i >arrive</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                        <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='literal'>0</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='operator'>-</span>count<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <i >complete</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

      atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >count</i><span class='curlybracket'>{</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;                   <span class='comment'>// <i >exposition only</i></span>
      inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                           <span class='comment'>// <i >exposition only</i></span>
      atomic<span class='anglebracket'>&lt;</span><i >disposition</i><span class='anglebracket'>&gt;</span> disp<span class='curlybracket'>{</span><i >disposition</i><span class='operator'>::</span><i >started</i><span class='curlybracket'>}</span>;           <span class='comment'>// <i >exposition only</i></span>
      errors_variant <i >errors</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                  <span class='comment'>// <i >exposition only</i></span>
      values_tuple <i >values</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                    <span class='comment'>// <i >exposition only</i></span>
      optional<span class='anglebracket'>&lt;</span>stop_callback<span class='anglebracket'>&gt;</span> <i >on_stop</i><span class='curlybracket'>{</span>nullopt<span class='curlybracket'>}</span>;                 <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.when.all-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4605'>#</a></div><div class='texpara'><div id='exec.when.all-13.sentence-1' class='sentence'>Let <span class='texttt'><i >copy-fail</i></span> be <span class='texttt'>exception_<span class='shy'></span>ptr</span>
if decay-copying any of the child senders' result datums can potentially throw;
otherwise, <span class='texttt'><i >none-such</i></span>,
where <span class='texttt'><i >none-such</i></span> is an unspecified empty class type<a class='hidden_link' href='#exec.when.all-13.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4611'>#</a></div><div class='texpara'><div id='exec.when.all-14.sentence-1' class='sentence'>The alias <span class='texttt'>values_<span class='shy'></span>tuple</span> denotes the type
<span class='codeblock'>tuple<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndrs, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>, <i >decayed-tuple</i>, optional<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
if that type is well-formed; otherwise, <span class='texttt'>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-14.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4618'>#</a></div><div class='texpara'><div id='exec.when.all-15.sentence-1' class='sentence'>The alias <span class='texttt'>errors_<span class='shy'></span>variant</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span><i >none-such</i>, <span class='texttt'><i >copy-fail</i></span>, Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
with duplicate types removed,
where <span class='texttt'>Es</span> is the pack of the decayed types
of all the child senders' possible error result datums<a class='hidden_link' href='#exec.when.all-15.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-16'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4625'>#</a></div><div class='texpara'><div id='exec.when.all-16.sentence-1' class='sentence'>The member
<span class='texttt'><span class='keyword'>void</span> <span class='texttt'><i >state-type</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span></span>
behaves as follows:
<ul class='itemize'><li id='exec.when.all-16.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-16.1'>(16.1)</a></div>If <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >started</i></span></span>,
evaluates:
<span class='codeblock'><span class='keyword'>auto</span> tie <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> set <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
apply<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> opts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>set, tuple_cat<span class='parenthesis'>(</span>tie<span class='parenthesis'>(</span><span class='operator'>*</span>opts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  values<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-16.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-16.2'>(16.2)</a></div>Otherwise,
if <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >error</i></span></span>,
evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span> error<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Error, <i >none-such</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>,
  errors<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-16.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-16.3'>(16.3)</a></div>Otherwise, evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.when.all-17'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4666'>#</a></div><div class='texpara'><div id='exec.when.all-17.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ops<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Ops<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
    get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >on_stop.</i>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='parenthesis'>(</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-18'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4685'>#</a></div><div class='texpara'><div id='exec.when.all-18.sentence-1' class='sentence'>The member <span class='texttt'><i ><span class='texttt'>impls<span class='operator'>-</span><span class='keyword'>for</span></span>&lt;when_<span class='shy'></span>all_<span class='shy'></span>t&gt;&#x200b;::&#x200b;<span class='texttt'><i >complete</i></span></i></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Set, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>this</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> complete, Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Set, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i> <span class='operator'>!</span><span class='operator'>=</span> state<span class='operator'>.</span>disp<span class='operator'>.</span>exchange<span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-ERROR</i><span class='parenthesis'>(</span>state<span class='operator'>.</span>errors, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span> expected <span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i>;
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp<span class='operator'>.</span>compare_exchange_strong<span class='parenthesis'>(</span>expected, <i >disposition</i><span class='operator'>::</span><i >stopped</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>State<span class='operator'>::</span>values<span class='parenthesis'>)</span>, tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp <span class='operator'>=</span><span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> opt <span class='operator'>=</span> get<span class='anglebracket'>&lt;</span>Index<span class='operator'>::</span>value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>state<span class='operator'>.</span>values<span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-VALUE</i><span class='parenthesis'>(</span>complete, opt, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  state<span class='operator'>.</span><i >arrive</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-ERROR</i></span><span class='parenthesis'>(</span>v, e<span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>v</span> and <span class='texttt'>e</span>, is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>exception_ptr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is potentially throwing;
otherwise, <span class='texttt'>v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>decltype<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>;
and where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-VALUE</i></span><span class='parenthesis'>(</span>c, o, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>c</span>, <span class='texttt'>o</span>, and pack of subexpressions <span class='texttt'>as</span>,
is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c<span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, state, rcvr, set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span></span>
is potentially throwing;
otherwise, <span class='texttt'>o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.when.all-18.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-19'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-19'>19</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4737'>#</a></div><div class='texpara'><div id='exec.when.all-19.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all_with_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.when.all-20'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4744'>#</a></div><div class='texpara'><div id='exec.when.all-20.sentence-2' class='sentence'>Given subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if
<span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> when_all<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.when.all-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.when.all-note-1'>1</a></i>:&ensp;<div id='exec.when.all-20.sentence-1' class='sentence'>This causes the <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> sender
to become <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span><a class='hidden_link' href='#exec.when.all-20.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='exec.into.variant' class='section'><h4 ><a class='secnum' href='#exec.into.variant' style='min-width:95pt'>33.9.12.13</a> <span class='texttt'>execution&#x200b;::&#x200b;into_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.into.variant'>[exec.into.variant]</a></h4><div class='para' id='exec.into.variant-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4765'>#</a></div><div class='texpara'><div id='exec.into.variant-1.sentence-1' class='sentence'><span class='texttt'>into_<span class='shy'></span>variant</span> adapts a sender with multiple value completion signatures
into a sender with just one value completion signature
consisting of a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#exec.into.variant-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4770'>#</a></div><div class='texpara'><div id='exec.into.variant-2.sentence-1' class='sentence'>The name <span class='texttt'>into_<span class='shy'></span>variant</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.into.variant-2.sentence-1'>.</a></div> <div id='exec.into.variant-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.into.variant-2.sentence-2'>.</a></div> <div id='exec.into.variant-2.sentence-3' class='sentence'>If <span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.into.variant-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.into.variant-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4776'>#</a></div><div class='texpara'><div id='exec.into.variant-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>into_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.into.variant-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4784'>#</a></div><div class='texpara'><div id='exec.into.variant-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>into_<span class='shy'></span>variant</span> as follows:
<span id='lib:impls-for<into_variant_t>,check-types'><span id='lib:check-types,impls-for<into_variant_t>'><span id='lib:impls-for<into_variant_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cinto_variant_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>into_variant_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>;   <span class='comment'>// see <a href='exec.snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></span></span></div></div></div><div class='para' id='exec.into.variant-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4805'>#</a></div><div class='texpara'><div id='exec.into.variant-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> type_identity<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.into.variant-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4815'>#</a></div><div class='texpara'><div id='exec.into.variant-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>auto</span>, State, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> variant_type <span class='operator'>=</span> <span class='keyword'>typename</span> State<span class='operator'>::</span>type;
    <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, variant_type<span class='parenthesis'>(</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='exec.stopped.opt' class='section'><h4 ><a class='secnum' href='#exec.stopped.opt' style='min-width:95pt'>33.9.12.14</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> <a class='abbr_ref' href='exec.stopped.opt'>[exec.stopped.opt]</a></h4><div class='para' id='exec.stopped.opt-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4832'>#</a></div><div class='texpara'><div id='exec.stopped.opt-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> maps a sender's stopped completion operation
into a value completion operation as a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-1'>.</a></div> <div id='exec.stopped.opt-1.sentence-2' class='sentence'>The sender's value completion operation
is also converted into an <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-2'>.</a></div> <div id='exec.stopped.opt-1.sentence-3' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4840'>#</a></div><div class='texpara'><div id='exec.stopped.opt-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.opt-2.sentence-1'>.</a></div> <div id='exec.stopped.opt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-2.sentence-2'>.</a></div> <div id='exec.stopped.opt-2.sentence-3' class='sentence'>The expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_optional, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.opt-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4849'>#</a></div><div class='texpara'><div id='exec.stopped.opt-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<stopped_as_optional_t>,check-types'><span id='lib:check-types,impls-for<stopped_as_optional_t>'><span id='lib:impls-for<stopped_as_optional_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cstopped_as_optional_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>stopped_as_optional_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <i >default-impls</i><span class='operator'>::</span><i >check-types</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><span class='keyword'>requires</span> <span class='curlybracket'>{</span>
          <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>void</span>, <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>,
                                                            <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>
          <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></span></span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#exec.stopped.opt-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.stopped.opt-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4872'>#</a></div><div class='texpara'><div id='exec.stopped.opt-4.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-4.sentence-1'>.</a></div> <div id='exec.stopped.opt-4.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise,
if <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is equivalent to <span class='texttt'><span class='texttt'><i >not-a-sender</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> V <span class='operator'>=</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
  then<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
       <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>V, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
         <span class='keyword'>return</span> optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>in_place, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
       <span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> just<span class='parenthesis'>(</span>optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='exec.stopped.err' class='section'><h4 ><a class='secnum' href='#exec.stopped.err' style='min-width:95pt'>33.9.12.15</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.stopped.err'>[exec.stopped.err]</a></h4><div class='para' id='exec.stopped.err-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4899'>#</a></div><div class='texpara'><div id='exec.stopped.err-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> maps an input sender's stopped completion operation
into an error completion operation as a custom error type<a class='hidden_link' href='#exec.stopped.err-1.sentence-1'>.</a></div> <div id='exec.stopped.err-1.sentence-2' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with an error<a class='hidden_link' href='#exec.stopped.err-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.stopped.err-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4905'>#</a></div><div class='texpara'><div id='exec.stopped.err-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.err-2.sentence-1'>.</a></div> <div id='exec.stopped.err-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>err</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-2.sentence-2'>.</a></div> <div id='exec.stopped.err-2.sentence-3' class='sentence'>If the type <span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________'><span class='texttt'>sender</span></span></a> or
if the type <span class='texttt'>Err</span> does not satisfy <a href='exec.general#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value__'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.stopped.err-2.sentence-3'>.</a></div> <div id='exec.stopped.err-2.sentence-4' class='sentence'>Otherwise, the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_error, err, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.err-2.sentence-4'>.</a></div></div></div><div class='para' id='exec.stopped.err-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4920'>#</a></div><div class='texpara'><div id='exec.stopped.err-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-3.sentence-1'>.</a></div> <div id='exec.stopped.err-3.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>error_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, err, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> E <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
  std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>err <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> just_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='exec.associate' class='section'><h4 ><a class='secnum' href='#exec.associate' style='min-width:95pt'>33.9.12.16</a> <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;associate</span> <a class='abbr_ref' href='exec.associate'>[exec.associate]</a></h4><div class='para' id='exec.associate-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4940'>#</a></div><div class='texpara'><div id='exec.associate-1.sentence-1' class='sentence'><span class='texttt'>associate</span> tries to associate
a sender with an async scope such that
the scope can track the lifetime of any asynchronous operations
created with the sender<a class='hidden_link' href='#exec.associate-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.associate-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4946'>#</a></div><div class='texpara'><div id='exec.associate-2.sentence-1' class='sentence'>Let <span class='texttt'><i >associate-data</i></span> be the following exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::associate-data'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='exec.scope.concepts#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >associate-data</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >wrap-sender</i> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      remove_cvref_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Token<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>wrap<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>explicit</span> <i >associate-data</i><span class='parenthesis'>(</span>Token t, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> s<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >sndr</i><span class='parenthesis'>(</span>t<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>s<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >token</i><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='operator'>!</span><i >token</i><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
        <i >sndr</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >associate-data</i><span class='parenthesis'>(</span><span class='keyword'>const</span> <i >associate-data</i><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_copy_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
               <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>other<span class='operator'>.</span><i >token</i><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

    <i >associate-data</i><span class='parenthesis'>(</span><i >associate-data</i><span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

    <span class='operator'>~</span><i >associate-data</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    optional<span class='anglebracket'>&lt;</span>pair<span class='anglebracket'>&lt;</span>Token, <i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      release<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    optional<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <i >sndr</i>;  <span class='comment'>// <i >exposition only</i></span>
    Token <i >token</i>;                 <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='exec.scope.concepts#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token_'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
    <i >associate-data</i><span class='parenthesis'>(</span>Token, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >associate-data</i><span class='anglebracket'>&lt;</span>Token, Sender<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='exec.associate-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4986'>#</a></div><div class='texpara'><div id='exec.associate-3.sentence-1' class='sentence'>For an <span class='texttt'><i >associate-data</i></span> object <span class='texttt'>a</span>,
<span class='texttt'>a<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>
if and only if
an association was successfully made and is owned by <span class='texttt'>a</span><a class='hidden_link' href='#exec.associate-3.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:execution::associate-data,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,constructor'>🔗</a></div><code class='itemdeclcode'><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='texttt'><i >associate-data</i></span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_copy_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
           <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>other<span class='operator'>.</span><span class='texttt'><i >token</i></span><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='exec.associate-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5000'>#</a></div><div class='texpara'><div id='exec.associate-4.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible___'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.associate-4.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.associate-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5004'>#</a></div><div class='texpara'><div id='exec.associate-5.sentence-1' class='sentence'><i >Effects</i>: Value-initializes <span class='texttt'><i >sndr</i></span> and
initializes <span class='texttt'><i >token</i></span> with <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >token</i></span></span><a class='hidden_link' href='#exec.associate-5.sentence-1'>.</a></div> <div id='exec.associate-5.sentence-2' class='sentence'>If <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
no further effects;
otherwise,
calls <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>try_<span class='shy'></span>associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and,
if that returns <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>emplace<span class='parenthesis'>(</span><span class='operator'>*</span>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span></span> and,
if that exits with an exception,
calls <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> before propagating the exception<a class='hidden_link' href='#exec.associate-5.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,constructor_'>🔗</a></div><code class='itemdeclcode'><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='texttt'><i >associate-data</i></span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='exec.associate-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5025'>#</a></div><div class='texpara'><div id='exec.associate-6.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >sndr</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span></span> and
initializes <span class='texttt'><i >token</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>other<span class='operator'>.</span>&#x200b;<span class='texttt'><i >token</i></span><span class='parenthesis'>)</span></span> and
then calls <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.associate-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,destructor'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='exec.associate-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5038'>#</a></div><div class='texpara'><div id='exec.associate-7.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns <span class='texttt'><span class='literal'>false</span></span> then no effect;
otherwise, invokes <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
before invoking <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.associate-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,release'><div id='lib:release,execution::associate-data'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:release,execution::associate-data'>🔗</a></div><code class='itemdeclcode'>optional<span class='anglebracket'>&lt;</span>pair<span class='anglebracket'>&lt;</span>Token, <span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
  release<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.associate-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5052'>#</a></div><div class='texpara'><div id='exec.associate-8.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns <span class='texttt'><span class='literal'>false</span></span> then
returns an <span class='texttt'>optional</span> that does not contain a value;
otherwise returns an <span class='texttt'>optional</span>
containing a value of type <span class='texttt'>pair<span class='anglebracket'>&lt;</span>Token, <span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span></span>
as if by:
<span class='codeblock'><span class='keyword'>return</span> optional<span class='parenthesis'>(</span>pair<span class='parenthesis'>(</span><i >token</i>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >sndr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='exec.associate-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5063'>#</a></div><div class='texpara'><div id='exec.associate-9.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >sndr</i></span> does not contain a value<a class='hidden_link' href='#exec.associate-9.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.associate-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5068'>#</a></div><div class='texpara'><div id='exec.associate-10.sentence-1' class='sentence'>The name <span class='texttt'>associate</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.associate-10.sentence-1'>.</a></div> <div id='exec.associate-10.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>token</span>:
<ul class='itemize'><li id='exec.associate-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.associate-10.1'>(10.1)</a></div>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
does not satisfy <a href='exec.scope.concepts#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token__'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a>, then
<span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is ill-formed.</li><li id='exec.associate-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.associate-10.2'>(10.2)</a></div>Otherwise,
the expression <span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
                 <i >make-sender</i><span class='parenthesis'>(</span>associate, <i >associate-data</i><span class='parenthesis'>(</span>token, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once.</li></ul></div></div></div><div class='para' id='exec.associate-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5088'>#</a></div><div class='texpara'><div id='exec.associate-11.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>associate_<span class='shy'></span>t</span> as follows:
<span id='lib:execution::impls-for<associate_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::impls-for%3cassociate_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>associate_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                    <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>                     <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>using</span> associate_data_t <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
        <span class='keyword'>using</span> child_type_t <span class='operator'>=</span> <span class='keyword'>typename</span> associate_data_t<span class='operator'>::</span><i >wrap-sender</i>;
        <span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>)</span>get_completion_signatures<span class='anglebracket'>&lt;</span>child_type_t, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='exec.associate-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5109'>#</a></div><div class='texpara'><div id='exec.associate-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:</div></div><div class='texpara'><span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data<span class='squarebracket'>]</span> <span class='operator'>=</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='keyword'>auto</span> dataParts <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

  <span class='keyword'>using</span> scope_tkn <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>first<span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> wrap_sender <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>second<span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> op_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>wrap_sender, Rcvr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>struct</span> op_state <span class='curlybracket'>{</span>
    <span class='keyword'>bool</span> <i >associated</i> <span class='operator'>=</span> <span class='literal'>false</span>;    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>union</span> <span class='curlybracket'>{</span>
      Rcvr<span class='operator'>*</span> <i >rcvr</i>;               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>struct</span> <span class='curlybracket'>{</span>
        scope_tkn <i >token</i>;        <span class='comment'>// <i >exposition only</i></span>
        op_t <i >op</i>;                <span class='comment'>// <i >exposition only</i></span>
      <span class='curlybracket'>}</span> <i >assoc</i>;                  <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>explicit</span> op_state<span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>addressof<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='keyword'>explicit</span> op_state<span class='parenthesis'>(</span>scope_tkn tkn, wrap_sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span> <span class='keyword'>try</span>
      <span class='operator'>:</span> <i >associated</i><span class='parenthesis'>(</span><span class='literal'>true</span><span class='parenthesis'>)</span>,
        <i >assoc</i><span class='parenthesis'>(</span>tkn, connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='curlybracket'>}</span>
    <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      tkn<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='keyword'>throw</span>;
    <span class='curlybracket'>}</span>

    op_state<span class='parenthesis'>(</span>op_state<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

    <span class='operator'>~</span>op_state<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >associated</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <i >assoc</i><span class='operator'>.</span><i >op</i><span class='operator'>.</span><span class='operator'>~</span>op_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >assoc</i><span class='operator'>.</span><i >token</i><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >assoc</i><span class='operator'>.</span><i >token</i><span class='operator'>.</span><span class='operator'>~</span>scope_tkn<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> <i >run</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>       <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >associated</i><span class='parenthesis'>)</span>
        start<span class='parenthesis'>(</span><i >assoc</i><span class='operator'>.</span><i >op</i><span class='parenthesis'>)</span>;
      <span class='keyword'>else</span>
        set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>if</span> <span class='parenthesis'>(</span>dataParts<span class='parenthesis'>)</span>
    <span class='keyword'>return</span> op_state<span class='curlybracket'>{</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>first<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>second<span class='parenthesis'>)</span>, rcvr<span class='curlybracket'>}</span>;
  <span class='keyword'>else</span>
    <span class='keyword'>return</span> op_state<span class='curlybracket'>{</span>rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='exec.associate-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5169'>#</a></div><div class='texpara'><div id='exec.associate-13.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span> is
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>connect_t, <i >wrap-sender</i>, Rcvr<span class='anglebracket'>&gt;</span>
</span>
where <span class='texttt'><i >wrap-sender</i></span> is the type
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >data-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >wrap-sender</i></span></span><a class='hidden_link' href='#exec.associate-13.sentence-1'>.</a></div></div></div><div class='para' id='exec.associate-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5180'>#</a></div><div class='texpara'><div id='exec.associate-14.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >run</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.associate-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.associate-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5189'>#</a></div><div class='texpara'><div id='exec.associate-15.sentence-1' class='sentence'>The evaluation of <span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span>
may cause side effects observable
via <span class='texttt'>token</span>'s associated async scope object<a class='hidden_link' href='#exec.associate-15.sentence-1'>.</a></div></div></div></div><div id='exec.stop.when' class='section'><h4 ><a class='secnum' href='#exec.stop.when' style='min-width:95pt'>33.9.12.17</a> Exposition-only <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;<span class='texttt'><i >stop-when</i></span></span> <a class='abbr_ref' href='exec.stop.when'>[exec.stop.when]</a></h4><div class='para' id='exec.stop.when-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stop.when-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5197'>#</a></div><div class='texpara'><div id='exec.stop.when-1.sentence-1' class='sentence'><span class='texttt'><i >stop-when</i></span> fuses an additional stop token <span class='texttt'>t</span>
into a sender so that, upon connecting to a receiver <span class='texttt'>r</span>,
the resulting operation state receives stop requests from both
<span class='texttt'>t</span> and the token returned from <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stop.when-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.stop.when-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stop.when-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5204'>#</a></div><div class='texpara'><div id='exec.stop.when-2.sentence-1' class='sentence'>The name <span class='texttt'><i >stop-when</i></span> denotes an exposition-only sender adaptor<a class='hidden_link' href='#exec.stop.when-2.sentence-1'>.</a></div> <div id='exec.stop.when-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>token</span>:
<ul class='itemize'><li id='exec.stop.when-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.stop.when-2.1'>(2.1)</a></div><div class='texpara'><div id='exec.stop.when-2.1.sentence-1' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
does not satisfy <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>,
then <span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.stop.when-2.1.sentence-1'>.</a></div></div></li><li id='exec.stop.when-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.stop.when-2.2'>(2.2)</a></div><div class='texpara'><div id='exec.stop.when-2.2.sentence-1' class='sentence'>Otherwise,
if <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> models
<a href='stoptoken.concepts#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> then
<span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>&#x200b;sndr, token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sndr</span><a class='hidden_link' href='#exec.stop.when-2.2.sentence-1'>.</a></div></div></li><li id='exec.stop.when-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.stop.when-2.3'>(2.3)</a></div><div class='texpara'><div id='exec.stop.when-2.3.sentence-1' class='sentence'>Otherwise,
<span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> returns a sender <span class='texttt'>osndr</span><a class='hidden_link' href='#exec.stop.when-2.3.sentence-1'>.</a></div> <div id='exec.stop.when-2.3.sentence-2' class='sentence'>If <span class='texttt'>osndr</span> is connected to a receiver <span class='texttt'>r</span>,
let <span class='texttt'>rtoken</span> be the result of <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stop.when-2.3.sentence-2'>.</a></div></div><div class='texpara'><ul class='itemize'><li id='exec.stop.when-2.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.stop.when-2.3.1'>(2.3.1)</a></div><div class='texpara'><div id='exec.stop.when-2.3.1.sentence-1' class='sentence'>If the type of <span class='texttt'>rtoken</span> models <a href='stoptoken.concepts#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token_'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> then
the effects of connecting <span class='texttt'>osndr</span> to <span class='texttt'>r</span>
are equivalent to
<span class='texttt'>connect<span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, token<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stop.when-2.3.1.sentence-1'>.</a></div></div></li><li id='exec.stop.when-2.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.stop.when-2.3.2'>(2.3.2)</a></div><div class='texpara'><div id='exec.stop.when-2.3.2.sentence-1' class='sentence'>Otherwise,
the effects of connecting <span class='texttt'>osndr</span> to <span class='texttt'>r</span>
are equivalent to
<span class='texttt'>connect<span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, stoken<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>)</span></span>
where <span class='texttt'>stoken</span> is an object of
an exposition-only type <span class='texttt'><i >stoken-t</i></span> such that:
  <ul class='itemize'><li id='exec.stop.when-2.3.2.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.stop.when-2.3.2.1'>(2.3.2.1)</a></div><span class='texttt'><i >stoken-t</i></span> models <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>;</li><li id='exec.stop.when-2.3.2.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.stop.when-2.3.2.2'>(2.3.2.2)</a></div><span class='texttt'>stoken<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
  <span class='texttt'>token<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>|</span><span class='operator'>|</span> rtoken<span class='operator'>.</span>stop_<span class='shy'></span>reques<span class='operator'>-</span><br/>ted<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;</li><li id='exec.stop.when-2.3.2.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.stop.when-2.3.2.3'>(2.3.2.3)</a></div><span class='texttt'>stoken<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
  <span class='texttt'>token<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>|</span><span class='operator'>|</span> rtoken<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>; and</li><li id='exec.stop.when-2.3.2.4'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#exec.stop.when-2.3.2.4'>(2.3.2.4)</a></div>for types <span class='texttt'>Fn</span> and <span class='texttt'>Init</span> such that both
  <span class='texttt'><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable____'><span class='texttt'>invocable</span></span></a><span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> and
  <span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>Fn, Init<span class='anglebracket'>&gt;</span></span>
  are modeled,
  <span class='texttt'><span class='texttt'><i >stoken-t</i></span><span class='operator'>&#x200b;::&#x200b;</span>callback_<span class='shy'></span>type<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> models
  <span class='texttt'><a href='stoptoken.concepts#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>Fn, <span class='texttt'><i >stoken-t</i></span>, Init<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.stop.when-2.3.2.sentence-1'>.</a> <div class='texpara'><div id='exec.stop.when-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.stop.when-note-1'>1</a></i>:&ensp;<div id='exec.stop.when-2.3.2.4.sentence-2' class='sentence'>For an object <span class='texttt'>fn</span> of type <span class='texttt'>Fn</span>
  constructed from a value, <span class='texttt'>init</span>, of type <span class='texttt'>Init</span>,
  registering <span class='texttt'>fn</span> using
  <span class='texttt'><span class='texttt'><i >stoken-t</i></span><span class='operator'>&#x200b;::&#x200b;</span>callback_<span class='shy'></span>type<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>stoken, init<span class='parenthesis'>)</span></span>
  results in an invocation of <span class='texttt'>fn</span> when
  a callback registered with <span class='texttt'>token</span> or <span class='texttt'>rtoken</span> would be invoked<a class='hidden_link' href='#exec.stop.when-2.3.2.4.sentence-2'>.</a></div> <div id='exec.stop.when-2.3.2.4.sentence-3' class='sentence'><span class='texttt'>fn</span> is invoked at most once<a class='hidden_link' href='#exec.stop.when-2.3.2.4.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></li></ul></div></div></li></ul></div></li></ul></div></div></div></div><div id='exec.spawn.future' class='section'><h4 ><a class='secnum' href='#exec.spawn.future' style='min-width:95pt'>33.9.12.18</a> <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;spawn_<span class='shy'></span>future</span> <a class='abbr_ref' href='exec.spawn.future'>[exec.spawn.future]</a></h4><div class='para' id='exec.spawn.future-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5273'>#</a></div><div class='texpara'><div id='exec.spawn.future-1.sentence-1' class='sentence'><span class='texttt'>spawn_<span class='shy'></span>future</span> attempts to associate the given input sender
with the given token's async scope and, on success,
eagerly starts the input sender;
the return value is a sender that, when connected and started,
completes with either
the result of the eagerly-started input sender or with
<span class='texttt'>set_<span class='shy'></span>stopped</span> if the input sender was not started<a class='hidden_link' href='#exec.spawn.future-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.spawn.future-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5282'>#</a></div><div class='texpara'><div id='exec.spawn.future-2.sentence-1' class='sentence'>The name <span class='texttt'>spawn_<span class='shy'></span>future</span> denotes a customization point object<a class='hidden_link' href='#exec.spawn.future-2.sentence-1'>.</a></div> <div id='exec.spawn.future-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>token</span>, and <span class='texttt'>env</span>,
<ul class='itemize'><li id='exec.spawn.future-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-2.1'>(2.1)</a></div>let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,</li><li id='exec.spawn.future-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-2.2'>(2.2)</a></div>let <span class='texttt'>Token</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>, and</li><li id='exec.spawn.future-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-2.3'>(2.3)</a></div>let <span class='texttt'>Env</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.spawn.future-2.sentence-2'>.</a></li></ul></div> <div id='exec.spawn.future-2.sentence-3' class='sentence'>
If any of
<span class='texttt'><a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>,
<span class='texttt'><a href='exec.scope.concepts#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token___'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span></span>, or
<span class='texttt'><a href='exec.queryable.concept#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____'><span class='texttt'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span></span>
are not satisfied,
the expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.spawn.future-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.spawn.future-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5297'>#</a></div><div class='texpara'><div id='exec.spawn.future-3.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-state-base</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-state-base'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-state-base'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state-base</i>;                                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sigs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>completion_signatures<span class='anglebracket'>&lt;</span>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>  <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >variant-t</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                                    <span class='comment'>// <i >exposition only</i></span>
    <i >variant-t</i> <i >result</i>;                                               <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='exec.spawn.future-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5315'>#</a></div><div class='texpara'><div id='exec.spawn.future-4.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be the pack of arguments to
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization provided as
a parameter to the <span class='texttt'><i >spawn-future-state-base</i></span> class template<a class='hidden_link' href='#exec.spawn.future-4.sentence-1'>.</a></div> <div id='exec.spawn.future-4.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template that
transforms a completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
into the tuple specialization <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.spawn.future-4.sentence-2'>.</a></div></div><div class='texpara'><ul class='itemize'><li id='exec.spawn.future-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-4.1'>(4.1)</a></div><div class='texpara'><div id='exec.spawn.future-4.1.sentence-1' class='sentence'>If <span class='texttt'>is_<span class='shy'></span>nothrow_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Arg<span class='anglebracket'>&gt;</span>, Arg<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
for every type <span class='texttt'>Arg</span>
in every parameter pack <span class='texttt'>Args</span>
in every completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
in <span class='texttt'>Sigs</span> then
<span class='texttt'><i >variant-t</i></span> denotes the type
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#exec.spawn.future-4.1.sentence-1'>.</a></div></div></li><li id='exec.spawn.future-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-4.2'>(4.2)</a></div><div class='texpara'><div id='exec.spawn.future-4.2.sentence-1' class='sentence'>Otherwise
<span class='texttt'><i >variant-t</i></span> denotes the type
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='anglebracket'>&gt;</span>, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>error_<span class='shy'></span>t, exception_<span class='shy'></span>ptr<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#exec.spawn.future-4.2.sentence-1'>.</a></div></div></li></ul></div></div><div class='para' id='exec.spawn.future-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5341'>#</a></div><div class='texpara'><div id='exec.spawn.future-5.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-receiver</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-receiver'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-receiver'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-receiver</i> <span class='curlybracket'>{</span>                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>Completions<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >state</i>;                <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <i >set-complete</i><span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>E<span class='operator'>&amp;</span><span class='operator'>&amp;</span> e<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <i >set-complete</i><span class='anglebracket'>&lt;</span>set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >set-complete</i><span class='anglebracket'>&lt;</span>set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> <i >set-complete</i><span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                    <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='keyword'>try</span> <span class='curlybracket'>{</span>
          <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>CPO, T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>CPO<span class='curlybracket'>{</span><span class='curlybracket'>}</span>,
                                                                   std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>;
            <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error_t<span class='curlybracket'>{</span><span class='curlybracket'>}</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='exec.spawn.future-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5387'>#</a></div><div class='texpara'><div id='exec.spawn.future-6.sentence-1' class='sentence'>Let <i >ssource-t</i> be an unspecified type
that models <a href='stoptoken.concepts#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source'><span class='texttt'><i >stoppable-source</i></span></span></a> and
let <span class='texttt'>ssource</span> be an lvalue of type <i >ssource-t</i><a class='hidden_link' href='#exec.spawn.future-6.sentence-1'>.</a></div> <div id='exec.spawn.future-6.sentence-2' class='sentence'>Let <span class='texttt'><i >stoken-t</i></span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>ssource<span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.spawn.future-6.sentence-2'>.</a></div> <div id='exec.spawn.future-6.sentence-3' class='sentence'>Let <span class='texttt'><i >future-spawned-sender</i></span> be the alias template:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
<span class='keyword'>using</span> <i >future-spawned-sender</i> <span class='operator'>=</span>                                   <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>decltype</span><span class='parenthesis'>(</span>write_env<span class='parenthesis'>(</span><i >stop-when</i><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span><i >stoken-t</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div><div class='para' id='exec.spawn.future-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5400'>#</a></div><div class='texpara'><div id='exec.spawn.future-7.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-state</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-state'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-state'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Alloc, <a href='exec.scope.concepts#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token____'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state</i>                                                 <span class='comment'>// <i >exposition only</i></span>
    <span class='operator'>:</span> <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>completion_signatures_of_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> <i >sigs-t</i> <span class='operator'>=</span>                                                          <span class='comment'>// <i >exposition only</i></span>
      completion_signatures_of_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >receiver-t</i> <span class='operator'>=</span>                                                      <span class='comment'>// <i >exposition only</i></span>
      <i >spawn-future-receiver</i><span class='anglebracket'>&lt;</span><i >sigs-t</i><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >op-t</i> <span class='operator'>=</span>                                                            <span class='comment'>// <i >exposition only</i></span>
      connect_result_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span>, <i >receiver-t</i><span class='anglebracket'>&gt;</span>;

    <i >spawn-future-state</i><span class='parenthesis'>(</span>Alloc alloc, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Token token, Env env<span class='parenthesis'>)</span>    <span class='comment'>// <i >exposition only</i></span>
      <span class='operator'>:</span> <i >alloc</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>alloc<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >op</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>
          write_env<span class='parenthesis'>(</span><i >stop-when</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >ssource</i><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
          <i >receiver-t</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >token</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >associated</i><span class='parenthesis'>(</span>token<span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='parenthesis'>(</span>associated<span class='parenthesis'>)</span>
            start<span class='parenthesis'>(</span><i >op</i><span class='parenthesis'>)</span>;
          <span class='keyword'>else</span>
            set_stopped<span class='parenthesis'>(</span><i >receiver-t</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >consume</i><span class='parenthesis'>(</span><a href='exec.recv.concepts#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver'><span class='tcode_in_codeblock'>receiver</span></span></a> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >abandon</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> <i >alloc-t</i> <span class='operator'>=</span>                                                         <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>typename</span> allocator_traits<span class='anglebracket'>&lt;</span>Alloc<span class='anglebracket'>&gt;</span><span class='operator'>::</span><span class='keyword'>template</span> rebind_alloc<span class='anglebracket'>&lt;</span><i >spawn-future-state</i><span class='anglebracket'>&gt;</span>;

    <i >alloc-t</i> <i >alloc</i>;                                                          <span class='comment'>// <i >exposition only</i></span>
    <i >ssource-t</i> <i >ssource</i>;                                                      <span class='comment'>// <i >exposition only</i></span>
    <i >op-t</i> <i >op</i>;                                                                <span class='comment'>// <i >exposition only</i></span>
    Token <i >token</i>;                                                            <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>bool</span> <i >associated</i>;                                                        <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> <i >destroy</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                                <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='exec.spawn.future-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5448'>#</a></div><div class='texpara'><div id='exec.spawn.future-8.sentence-1' class='sentence'>For purposes of determining the existence of a data race,
<span class='texttt'><i >complete</i></span>, <span class='texttt'><i >consume</i></span>, and <span class='texttt'><i >abandon</i></span>
behave as atomic operations (<a href='intro.multithread' title='6.10.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>)<a class='hidden_link' href='#exec.spawn.future-8.sentence-1'>.</a></div> <div id='exec.spawn.future-8.sentence-2' class='sentence'>These operations on a single object of a type
that is a specialization of <span class='texttt'><i >spawn-future-state</i></span>
appear to occur in a single total order<a class='hidden_link' href='#exec.spawn.future-8.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,complete'><div id='lib:complete,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:complete,execution::spawn-future-state'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='exec.spawn.future-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5462'>#</a></div><div class='texpara'><div id='exec.spawn.future-9.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='exec.spawn.future-9.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-9.1'>(9.1)</a></div>No effects if this invocation of <span class='texttt'><i >complete</i></span> happens before
an invocation of <span class='texttt'><i >consume</i></span> or <span class='texttt'><i >abandon</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>;</li><li id='exec.spawn.future-9.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-9.2'>(9.2)</a></div>otherwise,
if an invocation of <span class='texttt'><i >consume</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> happens before
this invocation of <span class='texttt'><i >complete</i></span> then
there is a receiver, <span class='texttt'>rcvr</span>, registered and
that receiver is completed as if by <span class='texttt'><span class='texttt'><i >consume</i></span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>;</li><li id='exec.spawn.future-9.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-9.3'>(9.3)</a></div>otherwise,
<span class='texttt'><i >destroy</i></span> is invoked<a class='hidden_link' href='#exec.spawn.future-9.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,consume'><div id='lib:consume,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:consume,execution::spawn-future-state'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >consume</i></span><span class='parenthesis'>(</span><a href='exec.recv.concepts#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_'><span class='texttt'>receiver</span></span></a> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='exec.spawn.future-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5486'>#</a></div><div class='texpara'><div id='exec.spawn.future-10.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='exec.spawn.future-10.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-10.1'>(10.1)</a></div>If this invocation of <span class='texttt'><i >consume</i></span> happens before
an invocation of <span class='texttt'><i >complete</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> then
<span class='texttt'>rcvr</span> is registered to be completed when
<span class='texttt'><i >complete</i></span> is subsequently invoked on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>;</li><li id='exec.spawn.future-10.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-10.2'>(10.2)</a></div>otherwise,
<span class='texttt'>rcvr</span> is completed as if by:
<span class='codeblock'>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='parenthesis'>)</span><span class='operator'>.</span>visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span>rcvr<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> tuple<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>remove_reference_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>tuple<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>, monostate<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      apply<span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='operator'>&amp;</span>rcvr<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> cpo, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> vals<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        cpo<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>vals<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>tuple<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,abandon'><div id='lib:abandon,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:abandon,execution::spawn-future-state'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >abandon</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='exec.spawn.future-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5517'>#</a></div><div class='texpara'><div id='exec.spawn.future-11.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='exec.spawn.future-11.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-11.1'>(11.1)</a></div>If this invocation of <span class='texttt'><i >abandon</i></span> happens before
an invocation of <span class='texttt'><i >complete</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> then
equivalent to:
<span class='codeblock'><i >ssource</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='exec.spawn.future-11.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.spawn.future-11.2'>(11.2)</a></div>otherwise,
<span class='texttt'><i >destroy</i></span> is invoked<a class='hidden_link' href='#exec.spawn.future-11.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,destroy'><div id='lib:destroy,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:destroy,execution::spawn-future-state'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >destroy</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='exec.spawn.future-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5539'>#</a></div><div class='texpara'><div id='exec.spawn.future-12.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> token <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >token</i><span class='parenthesis'>)</span>;
<span class='keyword'>bool</span> associated <span class='operator'>=</span> <span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >associated</i>;

<span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> alloc <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >alloc</i><span class='parenthesis'>)</span>;

  allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>destroy<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span><span class='parenthesis'>)</span>;
  allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>deallocate<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span>, <span class='literal'>1</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>if</span> <span class='parenthesis'>(</span>associated<span class='parenthesis'>)</span>
  token<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='exec.spawn.future-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5558'>#</a></div><div class='texpara'><div id='exec.spawn.future-13.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>spawn_<span class='shy'></span>future_<span class='shy'></span>t</span> as follows:</div></div><div class='texpara'><span id='lib:execution::impls-for<spawn_future_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::impls-for%3cspawn_future_t%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>spawn_future_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='exec.spawn.future-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5572'>#</a></div><div class='texpara'><div id='exec.spawn.future-14.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>spawn_<span class='shy'></span>future_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >consume</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.spawn.future-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5581'>#</a></div><div class='texpara'><div id='exec.spawn.future-15.sentence-1' class='sentence'>For the expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span>
let <span class='texttt'>new_<span class='shy'></span>sender</span> be the expression <span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> and
let <span class='texttt'>alloc</span> and <span class='texttt'>senv</span> be defined as follows:
<ul class='itemize'><li id='exec.spawn.future-15.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-15.1'>(15.1)</a></div>if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span>;</li><li id='exec.spawn.future-15.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-15.2'>(15.2)</a></div>otherwise,
if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>prop<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator, alloc<span class='parenthesis'>)</span>, env<span class='parenthesis'>)</span></span>;</li><li id='exec.spawn.future-15.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-15.3'>(15.3)</a></div>otherwise,
<span class='texttt'>alloc</span> is <span class='texttt'>allocator<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span><a class='hidden_link' href='#exec.spawn.future-15.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='exec.spawn.future-16'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5602'>#</a></div><div class='texpara'><div id='exec.spawn.future-16.sentence-1' class='sentence'>The expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span>
has the following effects:</div></div><div class='texpara'><ul class='itemize'><li id='exec.spawn.future-16.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-16.1'>(16.1)</a></div><div class='texpara'><div id='exec.spawn.future-16.1.sentence-1' class='sentence'>Uses <span class='texttt'>alloc</span> to allocate and construct an object <span class='texttt'>s</span> of
a type that is a specialization of <span class='texttt'><i >spawn-future-&#x200b;state</i></span>
from <span class='texttt'>alloc</span>, <span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>, <span class='texttt'>token</span>, and <span class='texttt'>senv</span><a class='hidden_link' href='#exec.spawn.future-16.1.sentence-1'>.</a></div> <div id='exec.spawn.future-16.1.sentence-2' class='sentence'>If an exception is thrown then
any constructed objects are destroyed and
any allocated memory is deallocated<a class='hidden_link' href='#exec.spawn.future-16.1.sentence-2'>.</a></div></div></li><li id='exec.spawn.future-16.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-16.2'>(16.2)</a></div><div class='texpara'><div id='exec.spawn.future-16.2.sentence-1' class='sentence'>Constructs an object <span class='texttt'>u</span> of
a type that is a specialization of <span class='texttt'>unique_<span class='shy'></span>ptr</span> such that:
  <ul class='itemize'><li id='exec.spawn.future-16.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.spawn.future-16.2.1'>(16.2.1)</a></div><span class='texttt'>u<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is equal to the address of <span class='texttt'>s</span>, and</li><li id='exec.spawn.future-16.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.spawn.future-16.2.2'>(16.2.2)</a></div><span class='texttt'>u<span class='operator'>.</span>get_<span class='shy'></span>deleter<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>u<span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is equivalent to
  <span class='texttt'>u<span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >abandon</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.spawn.future-16.2.sentence-1'>.</a></li></ul></div></div></li><li id='exec.spawn.future-16.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.spawn.future-16.3'>(16.3)</a></div><div class='texpara'><div id='exec.spawn.future-16.3.sentence-1' class='sentence'>Returns <span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>spawn_<span class='shy'></span>future, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>u<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.spawn.future-16.3.sentence-1'>.</a></div></div></li></ul></div></div><div class='para' id='exec.spawn.future-17'><div class='marginalizedparent'><a class='marginalized' href='#exec.spawn.future-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5630'>#</a></div><div class='texpara'><div id='exec.spawn.future-17.sentence-1' class='sentence'>The expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, execution<span class='operator'>&#x200b;::&#x200b;</span>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.spawn.future-17.sentence-1'>.</a></div></div></div></div></div></body></html>