<!DOCTYPE html><html lang='en'><head><title>[exec.adapt]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>34</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>34.9</a> Senders <a class='abbr_ref' href='exec.snd#exec.adapt'>[exec.snd]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>34.9.12</a> Sender adaptors <a class='abbr_ref'>[exec.adapt]</a></h3><div id='general' class='section'><h4 ><a class='secnum' href='#general' style='min-width:95pt'>34.9.12.1</a> General <a class='abbr_ref' href='exec.adapt.general'>[exec.adapt.general]</a></h4><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2639'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'>Subclause [exec.<span class='shy'></span>adapt] specifies a set of sender adaptors<a class='hidden_link' href='#general-1.sentence-1'>.</a></div></div></div><div class='para' id='general-2'><div class='marginalizedparent'><a class='marginalized' href='#general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2642'>#</a></div><div class='texpara'><div id='general-2.sentence-1' class='sentence'>The bitwise inclusive <span class='textsc'>or</span> operator is overloaded
for the purpose of creating sender chains<a class='hidden_link' href='#general-2.sentence-1'>.</a></div> <div id='general-2.sentence-2' class='sentence'>The adaptors also support function call syntax with equivalent semantics<a class='hidden_link' href='#general-2.sentence-2'>.</a></div></div></div><div class='para' id='general-3'><div class='marginalizedparent'><a class='marginalized' href='#general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2647'>#</a></div><div class='texpara'><div id='general-3.sentence-1' class='sentence'>Unless otherwise specified:
<ul class='itemize'><li id='general-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.1'>(3.1)</a></div><div class='texpara'><div id='general-3.1.sentence-1' class='sentence'>A sender adaptor is prohibited from causing observable effects,
apart from moving and copying its arguments,
before the returned sender is connected with a receiver using <span class='texttt'>connect</span>,
and <span class='texttt'>start</span> is called on the resulting operation state<a class='hidden_link' href='#general-3.1.sentence-1'>.</a></div></div></li><li id='general-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.2'>(3.2)</a></div><div class='texpara'><div id='general-3.2.sentence-1' class='sentence'>A parent sender (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) with a single child sender <span class='texttt'>sndr</span> has
an associated attribute object equal to
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> (<a href='exec.fwd.env' title='34.5.1&emsp;forwarding_&shy;query'>[exec.<span class='shy'></span>fwd.<span class='shy'></span>env]</a>)<a class='hidden_link' href='#general-3.2.sentence-1'>.</a></div></div></li><li id='general-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.3'>(3.3)</a></div><div class='texpara'><div id='general-3.3.sentence-1' class='sentence'>A parent sender with more than one child sender has
an associated attributes object equal to <span class='texttt'>empty_<span class='shy'></span>env<span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#general-3.3.sentence-1'>.</a></div></div></li><li id='general-3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.4'>(3.4)</a></div><div class='texpara'><div id='general-3.4.sentence-1' class='sentence'>When a parent sender is connected to a receiver <span class='texttt'>rcvr</span>,
any receiver used to connect a child sender has
an associated environment equal to <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#general-3.4.sentence-1'>.</a></div></div></li><li id='general-3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-3.5'>(3.5)</a></div><div class='texpara'><div id='general-3.5.sentence-1' class='sentence'>These requirements apply to any function
that is selected by the implementation of the sender adaptor<a class='hidden_link' href='#general-3.5.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='general-4'><div class='marginalizedparent'><a class='marginalized' href='#general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2671'>#</a></div><div class='texpara'><div id='general-4.sentence-1' class='sentence'>If a sender returned from a sender adaptor specified in [exec.<span class='shy'></span>adapt]
is specified to include <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>
among its set of completion signatures
where <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span>,
but the implementation does not potentially evaluate
an error completion operation with an <span class='texttt'>exception_<span class='shy'></span>ptr</span> argument,
the implementation is allowed to omit
the <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion signature from the set<a class='hidden_link' href='#general-4.sentence-1'>.</a></div></div></div></div><div id='obj' class='section'><h4 ><a class='secnum' href='#obj' style='min-width:95pt'>34.9.12.2</a> Closure objects <a class='abbr_ref' href='exec.adapt.obj'>[exec.adapt.obj]</a></h4><div class='para' id='obj-1'><div class='marginalizedparent'><a class='marginalized' href='#obj-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2683'>#</a></div><div class='texpara'><div id='obj-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_closure_object,pipeable' title='34.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_closure_object,pipeable'><i >pipeable sender adaptor closure object</i></span></a> is a function object
that accepts one or more <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='texttt'>sender</span></span></a> arguments and returns a <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-1.sentence-1'>.</a></div> <div id='obj-1.sentence-2' class='sentence'>For a pipeable sender adaptor closure object <span class='texttt'>c</span> and
an expression <span class='texttt'>sndr</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__'><span class='texttt'>sender</span></span></a>,
the following expressions are equivalent and yield a <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___'><span class='texttt'>sender</span></span></a>:
<span class='codeblock'>c<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>
sndr <span class='operator'>|</span> c
</span></div> <div id='obj-1.sentence-3' class='sentence'>
Given an additional pipeable sender adaptor closure object <span class='texttt'>d</span>,
the expression <span class='texttt'>c <span class='operator'>|</span> d</span> produces
another pipeable sender adaptor closure object <span class='texttt'>e</span>:</div></div><div class='texpara'><div id='obj-1.sentence-4' class='sentence'><span class='texttt'>e</span> is a perfect forwarding call wrapper (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>)
with the following properties:
<ul class='itemize'><li id='obj-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.1'>(1.1)</a></div><div class='texpara'><div id='obj-1.1.sentence-1' class='sentence'>Its target object is an object <span class='texttt'>d2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>d<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>d</span><a class='hidden_link' href='#obj-1.1.sentence-1'>.</a></div></div></li><li id='obj-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.2'>(1.2)</a></div><div class='texpara'><div id='obj-1.2.sentence-1' class='sentence'>It has one bound argument entity,
an object <span class='texttt'>c2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>c</span><a class='hidden_link' href='#obj-1.2.sentence-1'>.</a></div></div></li><li id='obj-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-1.3'>(1.3)</a></div><div class='texpara'><div id='obj-1.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>d2<span class='parenthesis'>(</span>c2<span class='parenthesis'>(</span>arg<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
where arg is the argument used in a function call expression of <span class='texttt'>e</span><a class='hidden_link' href='#obj-1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='obj-1.sentence-5' class='sentence'>
The expression <span class='texttt'>c <span class='operator'>|</span> d</span> is well-formed if and only if
the initializations of the state entities (<a href='func.def' title='22.10.3&emsp;Definitions'>[func.<span class='shy'></span>def]</a>) of <span class='texttt'>e</span>
are all well-formed<a class='hidden_link' href='#obj-1.sentence-5'>.</a></div></div></div><div class='para' id='obj-2'><div class='marginalizedparent'><a class='marginalized' href='#obj-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2716'>#</a></div><div class='texpara'><div id='obj-2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> of type <span class='texttt'>T</span> is
a pipeable sender adaptor closure object
if <span class='texttt'>T</span> models <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>T</span> has no other base classes
of type <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> for any other type <span class='texttt'>U</span>, and
<span class='texttt'>T</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-2.sentence-1'>.</a></div></div></div><div class='para' id='obj-3'><div class='marginalizedparent'><a class='marginalized' href='#obj-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2724'>#</a></div><div class='texpara'><div id='obj-3.sentence-1' class='sentence'>The template parameter <span class='texttt'>D</span> for <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure</span> can be
an incomplete type<a class='hidden_link' href='#obj-3.sentence-1'>.</a></div> <div id='obj-3.sentence-2' class='sentence'>Before any expression of type <span class='mathit'>cv</span> <span class='texttt'>D</span> appears as
an operand to the <span class='texttt'><span class='operator'>|</span></span> operator,
<span class='texttt'>D</span> shall be complete and
model <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>D<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#obj-3.sentence-2'>.</a></div> <div id='obj-3.sentence-3' class='sentence'>The behavior of an expression involving an object of type <span class='mathit'>cv</span> <span class='texttt'>D</span>
as an operand to the <span class='texttt'><span class='operator'>|</span></span> operator is undefined
if overload resolution selects a program-defined <span class='texttt'><span class='keyword'>operator</span><span class='operator'>|</span></span> function<a class='hidden_link' href='#obj-3.sentence-3'>.</a></div></div></div><div class='para' id='obj-4'><div class='marginalizedparent'><a class='marginalized' href='#obj-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2735'>#</a></div><div class='texpara'><div id='obj-4.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_object,pipeable' title='34.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_object,pipeable'><i >pipeable sender adaptor object</i></span></a> is a customization point object
that accepts a <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____'><span class='texttt'>sender</span></span></a> as its first argument and
returns a <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#obj-4.sentence-1'>.</a></div> <div id='obj-4.sentence-2' class='sentence'>If a pipeable sender adaptor object accepts only one argument,
then it is a pipeable sender adaptor closure object<a class='hidden_link' href='#obj-4.sentence-2'>.</a></div></div></div><div class='para' id='obj-5'><div class='marginalizedparent'><a class='marginalized' href='#obj-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2742'>#</a></div><div class='texpara'><div id='obj-5.sentence-1' class='sentence'>If a pipeable sender adaptor object adaptor accepts more than one argument,
then let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______'><span class='texttt'>sender</span></span></a>,
let <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be arguments
such that <span class='texttt'>adaptor<span class='parenthesis'>(</span>sndr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is a well-formed expression
as specified below, and
let <span class='texttt'>BoundArgs</span> be a pack that denotes <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#obj-5.sentence-1'>.</a></div> <div id='obj-5.sentence-2' class='sentence'>The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> produces
a pipeable sender adaptor closure object <span class='texttt'>f</span>
that is a perfect forwarding call wrapper with the following properties:
<ul class='itemize'><li id='obj-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.1'>(5.1)</a></div><div class='texpara'><div id='obj-5.1.sentence-1' class='sentence'>Its target object is a copy of adaptor<a class='hidden_link' href='#obj-5.1.sentence-1'>.</a></div></div></li><li id='obj-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.2'>(5.2)</a></div><div class='texpara'><div id='obj-5.2.sentence-1' class='sentence'>Its bound argument entities <span class='texttt'>bound_<span class='shy'></span>args</span> consist of
objects of types <span class='texttt'>BoundArgs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> direct-non-list-initialized with
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, respectively<a class='hidden_link' href='#obj-5.2.sentence-1'>.</a></div></div></li><li id='obj-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#obj-5.3'>(5.3)</a></div><div class='texpara'><div id='obj-5.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>adaptor<span class='parenthesis'>(</span>rcvr, bound_<span class='shy'></span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>rcvr</span> is
the argument used in a function call expression of <span class='texttt'>f</span><a class='hidden_link' href='#obj-5.3.sentence-1'>.</a></div></div></li></ul></div> <div id='obj-5.sentence-3' class='sentence'>
The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed if and only if
the initializations of the bound argument entities of the result,
as specified above, are all well-formed<a class='hidden_link' href='#obj-5.sentence-3'>.</a></div></div></div></div><div id='exec.starts.on' class='section'><h4 ><a class='secnum' href='#exec.starts.on' style='min-width:95pt'>34.9.12.3</a> <span class='texttt'>execution&#x200b;::&#x200b;starts_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.starts.on'>[exec.starts.on]</a></h4><div class='para' id='exec.starts.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2771'>#</a></div><div class='texpara'><div id='exec.starts.on-1.sentence-1' class='sentence'><span class='texttt'>starts_<span class='shy'></span>on</span> adapts an input sender into a sender
that will start on an execution agent belonging to
a particular scheduler's associated execution resource<a class='hidden_link' href='#exec.starts.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2776'>#</a></div><div class='texpara'><div id='exec.starts.on-2.sentence-1' class='sentence'>The name <span class='texttt'>starts_<span class='shy'></span>on</span> denotes a customization point object<a class='hidden_link' href='#exec.starts.on-2.sentence-1'>.</a></div> <div id='exec.starts.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.starts.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.starts.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2783'>#</a></div><div class='texpara'><div id='exec.starts.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>starts_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.starts.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2793'>#</a></div><div class='texpara'><div id='exec.starts.on-4.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>OutSndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-4.sentence-1'>.</a></div> <div id='exec.starts.on-4.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, starts_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed; otherwise
<ul class='itemize'><li id='exec.starts.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.1'>(4.1)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li><li id='exec.starts.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.2'>(4.2)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, sndr<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> let_value<span class='parenthesis'>(</span>
  schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>sndr <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.starts.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2819'>#</a></div><div class='texpara'><div id='exec.starts.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-1'>.</a></div> <div id='exec.starts.on-5.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-2'>.</a></div> <div id='exec.starts.on-5.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.starts.on-5.sentence-3'>.</a></div> <div id='exec.starts.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall start <span class='texttt'>sndr</span>
on an execution agent of the associated execution resource of <span class='texttt'>sch</span><a class='hidden_link' href='#exec.starts.on-5.sentence-4'>.</a></div> <div id='exec.starts.on-5.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.starts.on-5.sentence-5'>.</a></div></div></div></div><div id='exec.continues.on' class='section'><h4 ><a class='secnum' href='#exec.continues.on' style='min-width:95pt'>34.9.12.4</a> <span class='texttt'>execution&#x200b;::&#x200b;continues_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.continues.on'>[exec.continues.on]</a></h4><div class='para' id='exec.continues.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2836'>#</a></div><div class='texpara'><div id='exec.continues.on-1.sentence-1' class='sentence'><span class='texttt'>continues_<span class='shy'></span>on</span> adapts a sender into one
that completes on the specified scheduler<a class='hidden_link' href='#exec.continues.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2840'>#</a></div><div class='texpara'><div id='exec.continues.on-2.sentence-1' class='sentence'>The name <span class='texttt'>continues_<span class='shy'></span>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.continues.on-2.sentence-1'>.</a></div> <div id='exec.continues.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.continues.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.continues.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2847'>#</a></div><div class='texpara'><div id='exec.continues.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>continues_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.continues.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2855'>#</a></div><div class='texpara'><div id='exec.continues.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>continues_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>continues_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.continues.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2870'>#</a></div><div class='texpara'><div id='exec.continues.on-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-5.sentence-1'>.</a></div> <div id='exec.continues.on-5.sentence-3' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> schedule_from<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.continues.on-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.continues.on-note-1'>1</a></i>:&ensp;<div id='exec.continues.on-5.sentence-2' class='sentence'>This causes the <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> sender to become
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.continues.on-5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='exec.continues.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2887'>#</a></div><div class='texpara'><div id='exec.continues.on-6.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-1'>.</a></div> <div id='exec.continues.on-6.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-2'>.</a></div> <div id='exec.continues.on-6.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.continues.on-6.sentence-3'>.</a></div> <div id='exec.continues.on-6.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.continues.on-6.sentence-4'>.</a></div> <div id='exec.continues.on-6.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.continues.on-6.sentence-5'>.</a></div></div></div></div><div id='exec.schedule.from' class='section'><h4 ><a class='secnum' href='#exec.schedule.from' style='min-width:95pt'>34.9.12.5</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule_<span class='shy'></span>from</span> <a class='abbr_ref' href='exec.schedule.from'>[exec.schedule.from]</a></h4><div class='para' id='exec.schedule.from-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2906'>#</a></div><div class='texpara'><div id='exec.schedule.from-1.sentence-1' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> schedules work dependent on the completion of a sender
onto a scheduler's associated execution resource<a class='hidden_link' href='#exec.schedule.from-1.sentence-1'>.</a></div> <div id='exec.schedule.from-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.schedule.from-note-1'>1</a></i>:&ensp;<div id='exec.schedule.from-1.sentence-2' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> is not meant to be used in user code;
it is used in the implementation of <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.schedule.from-1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.schedule.from-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2914'>#</a></div><div class='texpara'><div id='exec.schedule.from-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule_<span class='shy'></span>from</span> denotes a customization point object<a class='hidden_link' href='#exec.schedule.from-2.sentence-1'>.</a></div> <div id='exec.schedule.from-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-2.sentence-2'>.</a></div> <div id='exec.schedule.from-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.schedule.from-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.schedule.from-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2923'>#</a></div><div class='texpara'><div id='exec.schedule.from-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>schedule_from, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.schedule.from-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2933'>#</a></div><div class='texpara'><div id='exec.schedule.from-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>schedule_<span class='shy'></span>from_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>schedule_from_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2947'>#</a></div><div class='texpara'><div id='exec.schedule.from-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2956'>#</a></div><div class='texpara'><div id='exec.schedule.from-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='keyword'>requires</span> <a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;

  <span class='keyword'>using</span> sched_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> receiver_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> operation_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span>sched_t<span class='anglebracket'>&gt;</span>, receiver_t<span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='literal'>nullptr</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    variant_t <i >async-result</i>;     <span class='comment'>// <i >exposition only</i></span>
    operation_t <i >op-state</i>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >state-type</i><span class='parenthesis'>(</span>sched_t sch, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <i >op-state</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>sch, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2984'>#</a></div><div class='texpara'><div id='exec.schedule.from-7.sentence-1' class='sentence'>Objects of the local class <span class='texttt'><i >state-type</i></span> can be used
to initialize a structured binding<a class='hidden_link' href='#exec.schedule.from-7.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2988'>#</a></div><div class='texpara'><div id='exec.schedule.from-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be
a pack of the arguments to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>child<span class='operator'>-</span>type<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.schedule.from-8.sentence-1'>.</a></div> <div id='exec.schedule.from-8.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
that transforms a completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> into
the tuple specialization <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.schedule.from-8.sentence-2'>.</a></div> <div id='exec.schedule.from-8.sentence-3' class='sentence'>Then <span class='texttt'>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#exec.schedule.from-8.sentence-3'>.</a></div></div></div><div class='para' id='exec.schedule.from-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2999'>#</a></div><div class='texpara'><div id='exec.schedule.from-9.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>t</span> is an alias for the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >receiver-type</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
    <i >state-type</i><span class='operator'>*</span> <i >state</i>;          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      visit<span class='parenthesis'>(</span>
        <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tuple<span class='operator'>&amp;</span> result<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>monostate, Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>args<span class='squarebracket'>]</span> <span class='operator'>=</span> result;
            tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>,
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >async-result</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3034'>#</a></div><div class='texpara'><div id='exec.schedule.from-10.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of the lambda is <span class='texttt'><span class='literal'>true</span></span>
if the construction of the returned <span class='texttt'><i >state-type</i></span> object
is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.schedule.from-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3040'>#</a></div><div class='texpara'><div id='exec.schedule.from-11.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> result_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>result_t, Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;

  <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>result_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span>valueless_by_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span>index<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span>;

  start<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >op-state</i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.schedule.from-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3062'>#</a></div><div class='texpara'><div id='exec.schedule.from-12.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-12.sentence-1'>.</a></div> <div id='exec.schedule.from-12.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.schedule.from-12.sentence-2'>.</a></div> <div id='exec.schedule.from-12.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.schedule.from-12.sentence-3'>.</a></div> <div id='exec.schedule.from-12.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.schedule.from-12.sentence-4'>.</a></div> <div id='exec.schedule.from-12.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.schedule.from-12.sentence-5'>.</a></div></div></div></div><div id='exec.on' class='section'><h4 ><a class='secnum' href='#exec.on' style='min-width:95pt'>34.9.12.6</a> <span class='texttt'>execution&#x200b;::&#x200b;on</span> <a class='abbr_ref' href='exec.on'>[exec.on]</a></h4><div class='para' id='exec.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3081'>#</a></div><div class='texpara'><div id='exec.on-1.sentence-1' class='sentence'>The <span class='texttt'>on</span> sender adaptor has two forms:
<ul class='itemize'><li id='exec.on-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.1'>(1.1)</a></div><div class='texpara'><div id='exec.on-1.1.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span>,
which starts a sender <span class='texttt'>sndr</span> on an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource and
that, upon <span class='texttt'>sndr</span>'s completion,
transfers execution back to the execution resource
on which the <span class='texttt'>on</span> sender was started<a class='hidden_link' href='#exec.on-1.1.sentence-1'>.</a></div></div></li><li id='exec.on-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.2'>(1.2)</a></div><div class='texpara'><div id='exec.on-1.2.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span>,
which upon completion of a sender <span class='texttt'>sndr</span>,
transfers execution to an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource,
then executes a sender adaptor closure <span class='texttt'>closure</span>
with the async results of the sender, and
that then transfers execution back to the execution resource
on which <span class='texttt'>sndr</span> completed<a class='hidden_link' href='#exec.on-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3102'>#</a></div><div class='texpara'><div id='exec.on-2.sentence-1' class='sentence'>The name <span class='texttt'>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.on-2.sentence-1'>.</a></div> <div id='exec.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
<span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed if any of the following is true:
<ul class='itemize'><li id='exec.on-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.2'>(2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr</span> is not
a pipeable sender adaptor closure object (<a href='#obj' title='34.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>), or</li><li id='exec.on-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.3'>(2.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr </span>is also a pipeable sender adaptor closure object<a class='hidden_link' href='#exec.on-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='exec.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3118'>#</a></div><div class='texpara'><div id='exec.on-3.sentence-1' class='sentence'>Otherwise, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________'><span class='texttt'>sender</span></span></a>,
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3128'>#</a></div><div class='texpara'><div id='exec.on-4.sentence-1' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>sch</span>, and <span class='texttt'>closure</span>, if
<ul class='itemize'><li id='exec.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.2'>(4.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.on-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.3'>(4.3)</a></div><span class='texttt'>closure</span> is not a pipeable sender adaptor closure object (<a href='#obj' title='34.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>),</li></ul>
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, <i >product-type</i><span class='curlybracket'>{</span>sch, closure<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.on-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3147'>#</a></div><div class='texpara'><div id='exec.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions,
let <span class='texttt'>OutSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>Env</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-5.sentence-1'>.</a></div> <div id='exec.on-5.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for__'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed<a class='hidden_link' href='#exec.on-5.sentence-2'>.</a></div></div></div><div class='para' id='exec.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3155'>#</a></div><div class='texpara'><div id='exec.on-6.sentence-1' class='sentence'>Otherwise:
Let <span class='texttt'><i >not-a-scheduler</i></span> be an unspecified empty class type, and
let <span class='texttt'><i >not-a-sender</i></span> be the exposition-only type:
<span class='codeblock'><span class='keyword'>struct</span> <i >not-a-sender</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;

  <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
where the member function <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> returns
an object of a type that is not
a specialization of the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#exec.on-6.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3172'>#</a></div><div class='texpara'><div id='exec.on-7.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3184'>#</a></div><div class='texpara'><div id='exec.on-8.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span>
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> continues_on<span class='parenthesis'>(</span>
      starts_on<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>sch, closure<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span> <i >query-with-default</i><span class='parenthesis'>(</span>
    get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span>,
    get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >write-env</i><span class='parenthesis'>(</span>
      continues_on<span class='parenthesis'>(</span>
        std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>closure<span class='parenthesis'>)</span><span class='parenthesis'>(</span>
          continues_on<span class='parenthesis'>(</span>
            <i >write-env</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >SCHED-ENV</i><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
            sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        orig_sch<span class='parenthesis'>)</span>,
      <i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3222'>#</a></div><div class='texpara'><div id='exec.on-9.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use
the return type of <span class='texttt'><span class='texttt'><i >not-a-sender</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span>
to inform users that their usage of <span class='texttt'>on</span> is incorrect
because there is no available scheduler onto which to restore execution<a class='hidden_link' href='#exec.on-9.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3229'>#</a></div><div class='texpara'><div id='exec.on-10.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-10.sentence-1'>.</a></div> <div id='exec.on-10.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-10.sentence-2'>.</a></div> <div id='exec.on-10.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-3'>.</a></div> <div id='exec.on-10.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.1'>(10.1)</a></div>remember the current scheduler, <span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li><li id='exec.on-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.2'>(10.2)</a></div>start <span class='texttt'>sndr</span> on an execution agent belonging to
sch's associated execution resource;</li><li id='exec.on-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.3'>(10.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1; and</li><li id='exec.on-10.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.4'>(10.4)</a></div>forward <span class='texttt'>sndr</span>'s async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-4'>.</a></li></ul></div> <div id='exec.on-10.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.on-10.sentence-5'>.</a></div></div></div><div class='para' id='exec.on-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3256'>#</a></div><div class='texpara'><div id='exec.on-11.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-11.sentence-1'>.</a></div> <div id='exec.on-11.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-11.sentence-2'>.</a></div> <div id='exec.on-11.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-11.sentence-3'>.</a></div> <div id='exec.on-11.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.1'>(11.1)</a></div>remember the current scheduler,
which is the first of the following expressions that is well-formed:
<ul class='itemize'><li id='exec.on-11.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-11.1.1'>(11.1.1)</a></div><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.on-11.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-11.1.2'>(11.1.2)</a></div><span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li></ul></li><li id='exec.on-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.2'>(11.2)</a></div>start <span class='texttt'>sndr</span> on the current execution agent;</li><li id='exec.on-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.3'>(11.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution to an agent
owned by sch's associated execution resource;</li><li id='exec.on-11.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.4'>(11.4)</a></div>forward <span class='texttt'>sndr</span>'s async result as if by
connecting and starting a sender <span class='texttt'>closure<span class='parenthesis'>(</span>S<span class='parenthesis'>)</span></span>,
where <span class='texttt'>S</span> is a sender
that completes synchronously with <span class='texttt'>sndr</span>'s async result; and</li><li id='exec.on-11.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.5'>(11.5)</a></div>upon completion of the operation started in the previous step,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1 and
forward the operation's async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-11.sentence-4'>.</a></li></ul></div> <div id='exec.on-11.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed on
an unspecified execution agent<a class='hidden_link' href='#exec.on-11.sentence-5'>.</a></div></div></div></div><div id='exec.then' class='section'><h4 ><a class='secnum' href='#exec.then' style='min-width:95pt'>34.9.12.7</a> <span class='texttt'>execution&#x200b;::&#x200b;then</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.then'>[exec.then]</a></h4><div class='para' id='exec.then-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3297'>#</a></div><div class='texpara'><div id='exec.then-1.sentence-1' class='sentence'><span class='texttt'>then</span> attaches an invocable as a continuation
for an input sender's value completion operation<a class='hidden_link' href='#exec.then-1.sentence-1'>.</a></div> <div id='exec.then-1.sentence-2' class='sentence'><span class='texttt'>upon_<span class='shy'></span>error</span> and <span class='texttt'>upon_<span class='shy'></span>stopped</span> do the same
for the error and stopped completion operations, respectively,
sending the result of the invocable as a value completion<a class='hidden_link' href='#exec.then-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.then-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3304'>#</a></div><div class='texpara'><div id='exec.then-2.sentence-1' class='sentence'>The names <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#exec.then-2.sentence-1'>.</a></div> <div id='exec.then-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >then-cpo</i></span> be one of
<span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, or <span class='texttt'>upon_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.then-2.sentence-2'>.</a></div> <div id='exec.then-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span> </span>is ill-formed<a class='hidden_link' href='#exec.then-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.then-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3314'>#</a></div><div class='texpara'><div id='exec.then-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >then-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.then-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.then-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3322'>#</a></div><div class='texpara'><div id='exec.then-4.sentence-1' class='sentence'>For <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.then-4.sentence-1'>.</a></div> <div id='exec.then-4.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >then-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >then-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
        <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> fn, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span>set<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr,
                          invoke<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
            Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.then-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3346'>#</a></div><div class='texpara'><div id='exec.then-5.sentence-1' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> has undefined behavior
unless it returns a sender<span class='texttt'>out_<span class='shy'></span>sndr</span> that
<ul class='itemize'><li id='exec.then-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-5.1'>(5.1)</a></div>invokes <span class='texttt'>f</span> or a copy of such
with the value, error, or stopped result datums of <span class='texttt'>sndr</span>
for <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>, respectively,
using the result value of <span class='texttt'>f</span> as <span class='texttt'>out_<span class='shy'></span>sndr</span>'s value completion, and</li><li id='exec.then-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-5.2'>(5.2)</a></div>forwards all other completion operations unchanged<a class='hidden_link' href='#exec.then-5.sentence-1'>.</a></li></ul></div></div></div></div><div id='exec.let' class='section'><h4 ><a class='secnum' href='#exec.let' style='min-width:95pt'>34.9.12.8</a> <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>value</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.let'>[exec.let]</a></h4><div class='para' id='exec.let-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3361'>#</a></div><div class='texpara'><div id='exec.let-1.sentence-1' class='sentence'><span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> transform
a sender's value, error, and stopped completions, respectively,
into a new child asynchronous operation
by passing the sender's result datums to a user-specified callable,
which returns a new sender that is connected and started<a class='hidden_link' href='#exec.let-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3368'>#</a></div><div class='texpara'><div id='exec.let-2.sentence-1' class='sentence'>For <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.let-2.sentence-1'>.</a></div> <div id='exec.let-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >let-cpo</i></span> be one of
<span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, or <span class='texttt'>let_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.let-2.sentence-2'>.</a></div> <div id='exec.let-2.sentence-3' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> be expression-equivalent to
the first well-formed expression below:
<ul class='itemize'><li id='exec.let-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.1'>(2.1)</a></div><span class='texttt'>SCHED<span class='operator'>-</span>ENV<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.2'>(2.2)</a></div><span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>domain, get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.3'>(2.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, empty_<span class='shy'></span>env<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li></ul></div></div></div><div class='para' id='exec.let-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3386'>#</a></div><div class='texpara'><div id='exec.let-3.sentence-1' class='sentence'>The names <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> denote
pipeable sender adaptor objects<a class='hidden_link' href='#exec.let-3.sentence-1'>.</a></div> <div id='exec.let-3.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
let <span class='texttt'>F</span> be the decayed type of <span class='texttt'>f</span><a class='hidden_link' href='#exec.let-3.sentence-2'>.</a></div> <div id='exec.let-3.sentence-3' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_'><span class='texttt'><i >movable-value</i></span></span></a>,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-3'>.</a></div> <div id='exec.let-3.sentence-4' class='sentence'>If <span class='texttt'>F</span> does not satisfy <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='texttt'>invocable</span></span></a>,
the expression <span class='texttt'>let_<span class='shy'></span>stopped<span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3397'>#</a></div><div class='texpara'><div id='exec.let-4.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >let-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.let-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3405'>#</a></div><div class='texpara'><div id='exec.let-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >let-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> <i >let-bind</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >let-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3421'>#</a></div><div class='texpara'><div id='exec.let-6.sentence-1' class='sentence'>Let <span class='texttt'><i >receiver2</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >receiver2</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >env</i>, <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    Env <i >env</i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3453'>#</a></div><div class='texpara'><div id='exec.let-7.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, fn, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>using</span> fn_t <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>using</span> env_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> args_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> ops2_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    fn_t <i >fn</i>;                    <span class='comment'>// <i >exposition only</i></span>
    env_t <i >env</i>;                  <span class='comment'>// <i >exposition only</i></span>
    args_variant_t <i >args</i>;        <span class='comment'>// <i >exposition only</i></span>
    ops2_variant_t <i >ops2</i>;        <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, <i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3474'>#</a></div><div class='texpara'><div id='exec.let-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-1'>.</a></div> <div id='exec.let-8.sentence-2' class='sentence'>Let <span class='texttt'>LetSigs</span> be a pack of those types in <span class='texttt'>Sigs</span>
with a return type of <span class='texttt'><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-2'>.</a></div> <div id='exec.let-8.sentence-3' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-3'>.</a></div> <div id='exec.let-8.sentence-4' class='sentence'>Then <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-8.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3487'>#</a></div><div class='texpara'><div id='exec.let-9.sentence-1' class='sentence'>Given a type <span class='texttt'>Tag</span> and a pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-sndr2</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-sndr2</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>Fn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-9.sentence-1'>.</a></div> <div id='exec.let-9.sentence-2' class='sentence'>Then <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>monostate, connect_result_t<span class='anglebracket'>&lt;</span><i >as-sndr2</i><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span>, <i >receiver2</i><span class='anglebracket'>&lt;</span>Rcvr, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-9.sentence-2'>.</a></div></div></div><div class='para' id='exec.let-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3499'>#</a></div><div class='texpara'><div id='exec.let-10.sentence-1' class='sentence'>The <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a> constraining the above lambda is satisfied
if and only if
the types <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> and <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> are well-formed<a class='hidden_link' href='#exec.let-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3504'>#</a></div><div class='texpara'><div id='exec.let-11.sentence-1' class='sentence'>The exposition-only function template <span class='texttt'><i >let-bind</i></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>using</span> args_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> mkop2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> connect<span class='parenthesis'>(</span>
    apply<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>fn<span class='parenthesis'>)</span>,
          state<span class='operator'>.</span>args<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>args_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >receiver2</i><span class='curlybracket'>{</span>rcvr, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>env<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
start<span class='parenthesis'>(</span>state<span class='operator'>.</span>ops2<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>mkop2<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >emplace-from</i><span class='curlybracket'>{</span>mkop2<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.let-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3518'>#</a></div><div class='texpara'><div id='exec.let-12.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span>let<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >let-bind</i><span class='parenthesis'>(</span>state, rcvr, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3532'>#</a></div><div class='texpara'><div id='exec.let-13.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions, and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-13.sentence-1'>.</a></div> <div id='exec.let-13.sentence-2' class='sentence'>If
<span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for___'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#exec.let-13.sentence-2'>.</a></div> <div id='exec.let-13.sentence-3' class='sentence'>Otherwise, it is equal to
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-13.sentence-3'>.</a></div></div></div><div class='para' id='exec.let-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3543'>#</a></div><div class='texpara'><div id='exec.let-14.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.let-14.sentence-1'>.</a></div> <div id='exec.let-14.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:
<ul class='itemize'><li id='exec.let-14.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.1'>(14.1)</a></div>invokes <span class='texttt'>f</span> when <span class='texttt'><i >set-cpo</i></span> is called
with <span class='texttt'>sndr</span>'s result datums,</li><li id='exec.let-14.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.2'>(14.2)</a></div>makes its completion dependent on
the completion of a sender returned by <span class='texttt'>f</span>, and</li><li id='exec.let-14.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.3'>(14.3)</a></div>propagates the other completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#exec.let-14.sentence-2'>.</a></li></ul></div></div></div></div><div id='exec.bulk' class='section'><h4 ><a class='secnum' href='#exec.bulk' style='min-width:95pt'>34.9.12.9</a> <span class='texttt'>execution&#x200b;::&#x200b;bulk</span> <a class='abbr_ref' href='exec.bulk'>[exec.bulk]</a></h4><div class='para' id='exec.bulk-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3565'>#</a></div><div class='texpara'><div id='exec.bulk-1.sentence-1' class='sentence'><span class='texttt'>bulk</span> runs a task repeatedly for every index in an index space<a class='hidden_link' href='#exec.bulk-1.sentence-1'>.</a></div></div><div class='texpara'><div id='exec.bulk-1.sentence-2' class='sentence'>The name <span class='texttt'>bulk</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.bulk-1.sentence-2'>.</a></div> <div id='exec.bulk-1.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>shape</span>, and <span class='texttt'>f</span>,
let <span class='texttt'>Shape</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.bulk-1.sentence-3'>.</a></div> <div id='exec.bulk-1.sentence-4' class='sentence'>If
<ul class='itemize'><li id='exec.bulk-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.1'>(1.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.bulk-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.2'>(1.2)</a></div><span class='texttt'>Shape</span> does not satisfy <a href='concepts.arithmetic#concept:integral' title='18.4.7&emsp;Arithmetic concepts&emsp;[concepts.arithmetic]'><span id='conceptref:integral'><span class='texttt'>integral</span></span></a>, or</li><li id='exec.bulk-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.3'>(1.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value__'><span class='texttt'><i >movable-value</i></span></span></a>,</li></ul>
<span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.bulk-1.sentence-4'>.</a></div></div></div><div class='para' id='exec.bulk-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3582'>#</a></div><div class='texpara'><div id='exec.bulk-2.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is expression-equivalent to:</div></div><div class='texpara'><div id='exec.bulk-2.sentence-2' class='sentence'><span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>bulk, <i >product-type</i><span class='curlybracket'>{</span>shape, f<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.bulk-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.bulk-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3591'>#</a></div><div class='texpara'><div id='exec.bulk-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.bulk-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3603'>#</a></div><div class='texpara'><div id='exec.bulk-4.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>for</span> <span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span> i <span class='operator'>=</span> <span class='literal'>0</span>; i <span class='anglebracket'>&lt;</span> shape; <span class='operator'>+</span><span class='operator'>+</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>i<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.bulk-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3624'>#</a></div><div class='texpara'><div id='exec.bulk-5.sentence-1' class='sentence'>The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above
is <span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-5.sentence-1'>.</a></div></div></div><div class='para' id='exec.bulk-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3630'>#</a></div><div class='texpara'><div id='exec.bulk-6.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-6.sentence-1'>.</a></div> <div id='exec.bulk-6.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started,
<ul class='itemize'><li id='exec.bulk-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-6.1'>(6.1)</a></div>on a value completion operation,
invokes <span class='texttt'>f<span class='parenthesis'>(</span>i, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
for every <span class='texttt'>i</span> of type <span class='texttt'>Shape</span> from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>,
where <span class='texttt'>args</span> is a pack of lvalue subexpressions
referring to the value completion result datums of the input sender, and</li><li id='exec.bulk-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-6.2'>(6.2)</a></div>propagates all completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#exec.bulk-6.sentence-2'>.</a></li></ul></div></div></div></div><div id='exec.split' class='section'><h4 ><a class='secnum' href='#exec.split' style='min-width:95pt'>34.9.12.10</a> <span class='texttt'>execution&#x200b;::&#x200b;split</span> <a class='abbr_ref' href='exec.split'>[exec.split]</a></h4><div class='para' id='exec.split-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3652'>#</a></div><div class='texpara'><div id='exec.split-1.sentence-1' class='sentence'><span class='texttt'>split</span> adapts an arbitrary sender
into a sender that can be connected multiple times<a class='hidden_link' href='#exec.split-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.split-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3656'>#</a></div><div class='texpara'><div id='exec.split-2.sentence-1' class='sentence'>Let <span class='texttt'><i >split-env</i></span> be the type of an environment
such that, given an instance <span class='texttt'>env</span>,
the expression <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed and
has type <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token<span class='operator'>.</span></span></div></div></div><div class='para' id='exec.split-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3662'>#</a></div><div class='texpara'><div id='exec.split-3.sentence-1' class='sentence'>The name <span class='texttt'>split</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.split-3.sentence-1'>.</a></div> <div id='exec.split-3.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-3.sentence-2'>.</a></div> <div id='exec.split-3.sentence-3' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >split-env</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.split-3.sentence-3'>.</a></div></div></div><div class='para' id='exec.split-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3668'>#</a></div><div class='texpara'><div id='exec.split-4.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>split, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.split-4.sentence-1'>.</a></div> <div id='exec.split-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.split-note-1'>1</a></i>:&ensp;<div id='exec.split-4.sentence-2' class='sentence'>The default implementation of <span class='texttt'>transform_<span class='shy'></span>sender</span>
will have the effect of connecting the sender to a receiver<a class='hidden_link' href='#exec.split-4.sentence-2'>.</a></div> <div id='exec.split-4.sentence-3' class='sentence'>It will return a sender with a different tag type<a class='hidden_link' href='#exec.split-4.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.split-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3680'>#</a></div><div class='texpara'><div id='exec.split-5.sentence-1' class='sentence'>Let <span class='texttt'><i >local-state</i></span> denote the following exposition-only class template:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='operator'>~</span><i >local-state-base</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >local-state</i> <span class='operator'>:</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >on-stop-callback</i> <span class='operator'>=</span>                                    <span class='comment'>// <i >exposition only</i></span>
      stop_callback_of_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <i >local-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='operator'>~</span><i >local-state</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    optional<span class='anglebracket'>&lt;</span><i >on-stop-callback</i><span class='anglebracket'>&gt;</span> <i >on_stop</i>;                         <span class='comment'>// <i >exposition only</i></span>
    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
    Rcvr<span class='operator'>*</span> <i >rcvr</i>;                                                 <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:1'>🔗</a></div><code class='itemdeclcode'><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3713'>#</a></div><div class='texpara'><div id='exec.split-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i> <span class='operator'>=</span> data<span class='operator'>.</span>sh_state<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i> <span class='operator'>=</span> addressof<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:2'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.split-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3729'>#</a></div><div class='texpara'><div id='exec.split-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'>sh_state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:3'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;
</code></div></div><div class='para' id='exec.split-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3742'>#</a></div><div class='texpara'><div id='exec.split-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> tupl<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>
      <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> tag, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >rcvr</i><span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>,
      tupl<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='exec.split-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3759'>#</a></div><div class='texpara'><div id='exec.split-9.sentence-1' class='sentence'>Let <span class='texttt'><i >split-receiver</i></span> denote
the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >split-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
      <span class='keyword'>try</span> <span class='curlybracket'>{</span>
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>;
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
      <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>notify<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_value, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_error, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>struct</span> <i >env</i> <span class='curlybracket'>{</span>                                                <span class='comment'>// <i >exposition only</i></span>
      <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh-state</i>;                             <span class='comment'>// <i >exposition only</i></span>

      inplace_stop_token query<span class='parenthesis'>(</span>get_stop_token_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >sh-state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>stop_src<span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;

    <i >env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >env</i><span class='curlybracket'>{</span><i >sh_state</i><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3811'>#</a></div><div class='texpara'><div id='exec.split-10.sentence-1' class='sentence'>Let <span class='texttt'><i >shared-state</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >shared-state</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> <i >variant-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-list-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >shared-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >start-op</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>

    inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                             <span class='comment'>// <i >exposition only</i></span>
    <i >variant-type</i> <i >result</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                      <span class='comment'>// <i >exposition only</i></span>
    <i >state-list-type</i> <i >waiting_states</i>;                             <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span> <i >completed</i><span class='curlybracket'>{</span><span class='literal'>false</span><span class='curlybracket'>}</span>;                              <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >ref_count</i><span class='curlybracket'>{</span><span class='literal'>1</span><span class='curlybracket'>}</span>;                                <span class='comment'>// <i >exposition only</i></span>
    connect_result_t<span class='anglebracket'>&lt;</span>Sndr, <i >split-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <i >op_state</i>;      <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3837'>#</a></div><div class='texpara'><div id='exec.split-11.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.split-11.sentence-1'>.</a></div> <div id='exec.split-11.sentence-2' class='sentence'>For type <span class='texttt'>Tag</span> and pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.split-11.sentence-2'>.</a></div> <div id='exec.split-11.sentence-3' class='sentence'>Then <span class='texttt'><i >variant-type</i></span> denotes the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span>set_stopped_t<span class='anglebracket'>&gt;</span>, tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
but with duplicate types removed<a class='hidden_link' href='#exec.split-11.sentence-3'>.</a></div></div></div><div class='para' id='exec.split-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3851'>#</a></div><div class='texpara'><div id='exec.split-12.sentence-1' class='sentence'>Let <span class='texttt'><i >state-list-type</i></span> be a type
that stores a list of pointers to <span class='texttt'><i >local-state-base</i></span> objects and
that permits atomic insertion<a class='hidden_link' href='#exec.split-12.sentence-1'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:4'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>explicit</span> <span class='texttt'><i >shared-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.split-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3861'>#</a></div><div class='texpara'><div id='exec.split-13.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >op_<span class='shy'></span>state</i></span> with the result of
<span class='texttt'>connect<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >split-receiver</i></span><span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-13.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.split-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3866'>#</a></div><div class='texpara'><div id='exec.split-14.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >waiting_<span class='shy'></span>states</i></span> is empty, and <span class='texttt'><i >completed</i></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.split-14.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:5'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3876'>#</a></div><div class='texpara'><div id='exec.split-15.sentence-1' class='sentence'><i >Effects</i>: Evaluates <span class='texttt'><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-15.sentence-1'>.</a></div> <div id='exec.split-15.sentence-2' class='sentence'>If <span class='texttt'>stop_<span class='shy'></span>src<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;
otherwise, evaluates <span class='texttt'>start<span class='parenthesis'>(</span><span class='texttt'><i >op_<span class='shy'></span>state</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-15.sentence-2'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:6'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-16'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3889'>#</a></div><div class='texpara'><div id='exec.split-16.sentence-1' class='sentence'><i >Effects</i>: Atomically does the following:
<ul class='itemize'><li id='exec.split-16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.split-16.1'>(16.1)</a></div>Sets <span class='texttt'>completed</span> to <span class='texttt'><span class='literal'>true</span></span>, and</li><li id='exec.split-16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.split-16.2'>(16.2)</a></div>Exchanges <span class='texttt'>waiting_<span class='shy'></span>states</span> with an empty list,
storing the old value in a local <span class='texttt'>prior_<span class='shy'></span>states</span><a class='hidden_link' href='#exec.split-16.sentence-1'>.</a></li></ul></div> <div id='exec.split-16.sentence-2' class='sentence'>
Then, for each pointer <span class='texttt'>p</span> in <span class='texttt'>prior_<span class='shy'></span>states</span>,
evaluates <span class='texttt'>p<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-16.sentence-2'>.</a></div> <div id='exec.split-16.sentence-3' class='sentence'>Finally, evaluates <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-16.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:7'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-17'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3909'>#</a></div><div class='texpara'><div id='exec.split-17.sentence-1' class='sentence'><i >Effects</i>: Increments <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#exec.split-17.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:8'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-18'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3919'>#</a></div><div class='texpara'><div id='exec.split-18.sentence-1' class='sentence'><i >Effects</i>: Decrements <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#exec.split-18.sentence-1'>.</a></div> <div id='exec.split-18.sentence-2' class='sentence'>If the new value of <span class='texttt'><i >ref_<span class='shy'></span>count</i></span> is <span class='texttt'><span class='literal'>0</span></span>,
calls <span class='texttt'><span class='keyword'>delete</span> <span class='keyword'>this</span></span><a class='hidden_link' href='#exec.split-18.sentence-2'>.</a></div></div></div></div><div class='para' id='exec.split-19'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3925'>#</a></div><div class='texpara'><div id='exec.split-19.sentence-1' class='sentence'><i >Synchronization</i>: If an evaluation of <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> does not
decrement the <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span> then
synchronizes with the evaluation of <span class='texttt'>dec<span class='operator'>-</span>ref<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that decrements <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span><a class='hidden_link' href='#exec.split-19.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.split-20'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3933'>#</a></div><div class='texpara'><div id='exec.split-20.sentence-1' class='sentence'>Let <span class='texttt'><i >split-impl-tag</i></span> be an empty exposition-only class type<a class='hidden_link' href='#exec.split-20.sentence-1'>.</a></div> <div id='exec.split-20.sentence-2' class='sentence'>Given an expression <span class='texttt'>sndr</span>,
the expression <span class='texttt'>split<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>auto</span><span class='operator'>*</span> sh_state <span class='operator'>=</span> <span class='keyword'>new</span> <i >shared-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
<span class='keyword'>return</span> <i >make-sender</i><span class='parenthesis'>(</span><i >split-impl-tag</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >shared-wrapper</i><span class='curlybracket'>{</span>sh_state, tag<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >shared-wrapper</i></span> is an exposition-only class
that manages the reference count of the <span class='texttt'><i >shared-state</i></span> object
pointed to by sh_state<a class='hidden_link' href='#exec.split-20.sentence-2'>.</a></div> <div id='exec.split-20.sentence-3' class='sentence'><span class='texttt'><i >shared-wrapper</i></span> models <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable'><span class='texttt'>copyable</span></span></a>
with move operations nulling out the moved-from object,
copy operations incrementing the reference count
by calling <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and
assignment operations performing a copy-and-swap operation<a class='hidden_link' href='#exec.split-20.sentence-3'>.</a></div> <div id='exec.split-20.sentence-4' class='sentence'>The destructor has no effect if sh_state is null;
otherwise, it decrements the reference count
by evaluating <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-20.sentence-4'>.</a></div></div></div><div class='para' id='exec.split-21'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-21'>21</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3954'>#</a></div><div class='texpara'><div id='exec.split-21.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >split-impl-tag</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >split-impl-tag</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-22'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-22'>22</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3967'>#</a></div><div class='texpara'><div id='exec.split-22.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to
the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >local-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-23'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-23'>23</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3978'>#</a></div><div class='texpara'><div id='exec.split-23.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
that has a function call operator equivalent to the following:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><i >local-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</span></div></div><div class='texpara'><div id='exec.split-23.sentence-2' class='sentence'><i >Effects</i>: If <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#exec.split-23.sentence-2'>.</a></div> <div id='exec.split-23.sentence-3' class='sentence'>Otherwise, does the following in order:
<ul class='itemize'><li id='exec.split-23.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.1'>(23.1)</a></div><div class='texpara'><div id='exec.split-23.1.sentence-1' class='sentence'>Evaluates
<span class='codeblock'>state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
  get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></li><li id='exec.split-23.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.2'>(23.2)</a></div><div class='texpara'><div id='exec.split-23.2.sentence-1' class='sentence'>Then atomically does the following:
<ul class='itemize'><li id='exec.split-23.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.split-23.2.1'>(23.2.1)</a></div>Reads the value <span class='texttt'>c</span> of
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span>, and</li><li id='exec.split-23.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.split-23.2.2'>(23.2.2)</a></div>Inserts <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> into
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>
if <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.split-23.2.sentence-1'>.</a></li></ul></div></div></li><li id='exec.split-23.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.3'>(23.3)</a></div><div class='texpara'><div id='exec.split-23.3.sentence-1' class='sentence'>If <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#exec.split-23.3.sentence-1'>.</a></div></div></li><li id='exec.split-23.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.4'>(23.4)</a></div><div class='texpara'><div id='exec.split-23.4.sentence-1' class='sentence'>Otherwise,
if <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> is the first item added to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-23.4.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='exec.when.all' class='section'><h4 ><a class='secnum' href='#exec.when.all' style='min-width:95pt'>34.9.12.11</a> <span class='texttt'>execution&#x200b;::&#x200b;when_<span class='shy'></span>all</span> <a class='abbr_ref' href='exec.when.all'>[exec.when.all]</a></h4><div class='para' id='exec.when.all-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4023'>#</a></div><div class='texpara'><div id='exec.when.all-1.sentence-1' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span>
both adapt multiple input senders into a sender
that completes when all input senders have completed<a class='hidden_link' href='#exec.when.all-1.sentence-1'>.</a></div> <div id='exec.when.all-1.sentence-2' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> only accepts senders
with a single value completion signature and
on success concatenates all the input senders' value result datums
into its own value completion operation<a class='hidden_link' href='#exec.when.all-1.sentence-2'>.</a></div> <div id='exec.when.all-1.sentence-3' class='sentence'><span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is semantically equivalent to
w<span class='texttt'>hen_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>sndrs</span> is a pack of subexpressions
whose types model <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.when.all-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.when.all-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4036'>#</a></div><div class='texpara'><div id='exec.when.all-2.sentence-1' class='sentence'>The names <span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span> denote
customization point objects<a class='hidden_link' href='#exec.when.all-2.sentence-1'>.</a></div> <div id='exec.when.all-2.sentence-2' class='sentence'>Let <span class='texttt'>sndrs</span> be a pack of subexpressions,
let <span class='texttt'>Sndrs</span> be a pack of the types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, and
let <span class='texttt'>CD</span> be
the type <span class='texttt'>common_<span class='shy'></span>type_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-2.sentence-2'>.</a></div> <div id='exec.when.all-2.sentence-3' class='sentence'>The expressions <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> are ill-formed
if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.when.all-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>0</span></span>, or</li><li id='exec.when.all-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndrs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='exec.when.all-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.3'>(2.3)</a></div><span class='texttt'>CD</span> is ill-formed<a class='hidden_link' href='#exec.when.all-2.sentence-3'>.</a></li></ul></div></div></div><div class='para' id='exec.when.all-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4055'>#</a></div><div class='texpara'><div id='exec.when.all-3.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='exec.when.all-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4061'>#</a></div><div class='texpara'><div id='exec.when.all-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>when_all_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4077'>#</a></div><div class='texpara'><div id='exec.when.all-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>CD, default_domain<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> empty_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_domain, CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4091'>#</a></div><div class='texpara'><div id='exec.when.all-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, State<span class='operator'>&amp;</span> state, <span class='keyword'>const</span> Receiver<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span>
    <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_stop_token, state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4102'>#</a></div><div class='texpara'><div id='exec.when.all-7.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;
<span class='curlybracket'>}</span>
</span>
where <span class='math'><span class='mathalpha'>e</span></span> is the expression
<span class='codeblock'>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='operator'>.</span>apply<span class='parenthesis'>(</span><i >make-state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and where <span class='texttt'><i >make-state</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
<span class='keyword'>concept</span> <a class='hidden_link' href='#concept:max-1-sender-in' title='34.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='concept:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a> <span class='operator'>=</span> <a href='exec.snd.concepts#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>                <span class='comment'>// <i >exposition only</i></span>
  <span class='parenthesis'>(</span>tuple_size_v<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, Env, tuple, tuple<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>;

<span class='keyword'>enum</span> <span class='keyword'>class</span> <i >disposition</i> <span class='curlybracket'>{</span> <i >started</i>, <i >error</i>, <i >stopped</i> <span class='curlybracket'>}</span>;             <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >make-state</i> <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:max-1-sender-in' title='34.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='conceptref:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a><span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sndrs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span>, Sndrs<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> sndrs<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> values_tuple <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> errors_variant <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_callback <span class='operator'>=</span> stop_callback_of_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
      <span class='keyword'>void</span> <i >arrive</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                        <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='literal'>0</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='operator'>-</span>count<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <i >complete</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

      atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >count</i><span class='curlybracket'>{</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;                   <span class='comment'>// <i >exposition only</i></span>
      inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                           <span class='comment'>// <i >exposition only</i></span>
      atomic<span class='anglebracket'>&lt;</span><i >disposition</i><span class='anglebracket'>&gt;</span> disp<span class='curlybracket'>{</span><i >disposition</i><span class='operator'>::</span><i >started</i><span class='curlybracket'>}</span>;           <span class='comment'>// <i >exposition only</i></span>
      errors_variant <i >errors</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                  <span class='comment'>// <i >exposition only</i></span>
      values_tuple <i >values</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                    <span class='comment'>// <i >exposition only</i></span>
      optional<span class='anglebracket'>&lt;</span>stop_callback<span class='anglebracket'>&gt;</span> <i >on_stop</i><span class='curlybracket'>{</span>nullopt<span class='curlybracket'>}</span>;                 <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.when.all-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4153'>#</a></div><div class='texpara'><div id='exec.when.all-8.sentence-1' class='sentence'>Let <span class='texttt'><i >copy-fail</i></span> be <span class='texttt'>exception_<span class='shy'></span>ptr</span>
if decay-copying any of the child senders' result datums can potentially throw;
otherwise, <span class='texttt'><i >none-such</i></span>,
where <span class='texttt'><i >none-such</i></span> is an unspecified empty class type<a class='hidden_link' href='#exec.when.all-8.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4159'>#</a></div><div class='texpara'><div id='exec.when.all-9.sentence-1' class='sentence'>The alias <span class='texttt'>values_<span class='shy'></span>tuple</span> denotes the type
<span class='codeblock'>tuple<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndrs, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, <i >decayed-tuple</i>, optional<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
if that type is well-formed; otherwise, <span class='texttt'>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-9.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4166'>#</a></div><div class='texpara'><div id='exec.when.all-10.sentence-1' class='sentence'>The alias <span class='texttt'>errors_<span class='shy'></span>variant</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span><span class='texttt'><i >none-such</i></span>, <span class='texttt'><i >copy-fail</i></span>, Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
with duplicate types removed,
where <span class='texttt'>Es</span> is the pack of the decayed types
of all the child senders' possible error result datums<a class='hidden_link' href='#exec.when.all-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4173'>#</a></div><div class='texpara'><div id='exec.when.all-11.sentence-1' class='sentence'>The member
<span class='texttt'><span class='keyword'>void</span> <span class='texttt'><i >state-type</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span></span>
behaves as follows:
<ul class='itemize'><li id='exec.when.all-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.1'>(11.1)</a></div>If <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >started</i></span></span>,
evaluates:
<span class='codeblock'><span class='keyword'>auto</span> tie <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> set <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
apply<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> opts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>set, tuple_cat<span class='parenthesis'>(</span>tie<span class='parenthesis'>(</span><span class='operator'>*</span>opts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  values<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.2'>(11.2)</a></div>Otherwise,
if <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >error</i></span></span>,
evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span> error<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Error, <i >none-such</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>,
  errors<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.3'>(11.3)</a></div>Otherwise, evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.when.all-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4214'>#</a></div><div class='texpara'><div id='exec.when.all-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ops<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Ops<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
    get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >on_stop.</i>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='parenthesis'>(</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4233'>#</a></div><div class='texpara'><div id='exec.when.all-13.sentence-1' class='sentence'>The member <span class='texttt'><i ><span class='texttt'>impls<span class='operator'>-</span><span class='keyword'>for</span></span>&lt;when_<span class='shy'></span>all_<span class='shy'></span>t&gt;&#x200b;::&#x200b;<span class='texttt'><i >complete</i></span></i></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Set, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>this</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> complete, Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Set, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i> <span class='operator'>!</span><span class='operator'>=</span> state<span class='operator'>.</span>disp<span class='operator'>.</span>exchange<span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-ERROR</i><span class='parenthesis'>(</span>state<span class='operator'>.</span>errors, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span> expected <span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i>;
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp<span class='operator'>.</span>compare_exchange_strong<span class='parenthesis'>(</span>expected, <i >disposition</i><span class='operator'>::</span><i >stopped</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>State<span class='operator'>::</span>values<span class='parenthesis'>)</span>, tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp <span class='operator'>=</span><span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> opt <span class='operator'>=</span> get<span class='anglebracket'>&lt;</span>Index<span class='operator'>::</span>value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>state<span class='operator'>.</span>values<span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-VALUE</i><span class='parenthesis'>(</span>complete, opt, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  state<span class='operator'>.</span><i >arrive</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-ERROR</i></span><span class='parenthesis'>(</span>v, e<span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>v</span> and <span class='texttt'>e</span>, is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>exception_ptr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is potentially throwing;
otherwise, <span class='texttt'>v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>decltype<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>;
and where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-VALUE</i></span><span class='parenthesis'>(</span>c, o, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>c</span>, <span class='texttt'>o</span>, and pack of subexpressions <span class='texttt'>as</span>,
is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c<span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, state, rcvr, set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span></span>
is potentially throwing;
otherwise, <span class='texttt'>o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.when.all-13.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4285'>#</a></div><div class='texpara'><div id='exec.when.all-14.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all_with_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.when.all-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4292'>#</a></div><div class='texpara'><div id='exec.when.all-15.sentence-2' class='sentence'>Given subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if
<span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> when_all<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.when.all-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.when.all-note-1'>1</a></i>:&ensp;<div id='exec.when.all-15.sentence-1' class='sentence'>This causes the <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> sender
to become <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span><a class='hidden_link' href='#exec.when.all-15.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='exec.into.variant' class='section'><h4 ><a class='secnum' href='#exec.into.variant' style='min-width:95pt'>34.9.12.12</a> <span class='texttt'>execution&#x200b;::&#x200b;into_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.into.variant'>[exec.into.variant]</a></h4><div class='para' id='exec.into.variant-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4313'>#</a></div><div class='texpara'><div id='exec.into.variant-1.sentence-1' class='sentence'><span class='texttt'>into_<span class='shy'></span>variant</span> adapts a sender with multiple value completion signatures
into a sender with just one value completion signature
consisting of a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#exec.into.variant-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4318'>#</a></div><div class='texpara'><div id='exec.into.variant-2.sentence-1' class='sentence'>The name <span class='texttt'>into_<span class='shy'></span>variant</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.into.variant-2.sentence-1'>.</a></div> <div id='exec.into.variant-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.into.variant-2.sentence-2'>.</a></div> <div id='exec.into.variant-2.sentence-3' class='sentence'>If <span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.into.variant-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.into.variant-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4324'>#</a></div><div class='texpara'><div id='exec.into.variant-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>into_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.into.variant-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4332'>#</a></div><div class='texpara'><div id='exec.into.variant-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='exec.snd.general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>into_<span class='shy'></span>variant</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>into_variant_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.into.variant-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4345'>#</a></div><div class='texpara'><div id='exec.into.variant-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> type_identity<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.into.variant-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4355'>#</a></div><div class='texpara'><div id='exec.into.variant-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>auto</span>, State, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> variant_type <span class='operator'>=</span> <span class='keyword'>typename</span> State<span class='operator'>::</span>type;
    <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, variant_type<span class='parenthesis'>(</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='exec.stopped.opt' class='section'><h4 ><a class='secnum' href='#exec.stopped.opt' style='min-width:95pt'>34.9.12.13</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> <a class='abbr_ref' href='exec.stopped.opt'>[exec.stopped.opt]</a></h4><div class='para' id='exec.stopped.opt-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4372'>#</a></div><div class='texpara'><div id='exec.stopped.opt-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> maps a sender's stopped completion operation
into a value completion operation as a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-1'>.</a></div> <div id='exec.stopped.opt-1.sentence-2' class='sentence'>The sender's value completion operation
is also converted into an <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-2'>.</a></div> <div id='exec.stopped.opt-1.sentence-3' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4380'>#</a></div><div class='texpara'><div id='exec.stopped.opt-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.opt-2.sentence-1'>.</a></div> <div id='exec.stopped.opt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-2.sentence-2'>.</a></div> <div id='exec.stopped.opt-2.sentence-3' class='sentence'>The expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_optional, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.opt-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4389'>#</a></div><div class='texpara'><div id='exec.stopped.opt-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-3.sentence-1'>.</a></div> <div id='exec.stopped.opt-3.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>, or
if the type <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
is ill-formed or <span class='texttt'><span class='keyword'>void</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> V <span class='operator'>=</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    then<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
         <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>V, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
           <span class='keyword'>return</span> optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>in_place, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
         <span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> just<span class='parenthesis'>(</span>optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='exec.stopped.err' class='section'><h4 ><a class='secnum' href='#exec.stopped.err' style='min-width:95pt'>34.9.12.14</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.stopped.err'>[exec.stopped.err]</a></h4><div class='para' id='exec.stopped.err-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4413'>#</a></div><div class='texpara'><div id='exec.stopped.err-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> maps an input sender's stopped completion operation
into an error completion operation as a custom error type<a class='hidden_link' href='#exec.stopped.err-1.sentence-1'>.</a></div> <div id='exec.stopped.err-1.sentence-2' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with an error<a class='hidden_link' href='#exec.stopped.err-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.stopped.err-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4419'>#</a></div><div class='texpara'><div id='exec.stopped.err-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.err-2.sentence-1'>.</a></div> <div id='exec.stopped.err-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>err</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-2.sentence-2'>.</a></div> <div id='exec.stopped.err-2.sentence-3' class='sentence'>If the type <span class='texttt'>Sndr</span> does not satisfy <a href='exec.snd.concepts#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________'><span class='texttt'>sender</span></span></a> or
if the type <span class='texttt'>Err</span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value___'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.stopped.err-2.sentence-3'>.</a></div> <div id='exec.stopped.err-2.sentence-4' class='sentence'>Otherwise, the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_error, err, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.err-2.sentence-4'>.</a></div></div></div><div class='para' id='exec.stopped.err-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4434'>#</a></div><div class='texpara'><div id='exec.stopped.err-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-3.sentence-1'>.</a></div> <div id='exec.stopped.err-3.sentence-2' class='sentence'>If <span class='texttt'><a href='exec.snd.concepts#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>error_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, err, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> E <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span>err <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> just_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div></body></html>