<!DOCTYPE html><html lang='en'><head><title>[concepts.equality]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>18</a> Concepts library <a class='abbr_ref' href='./#concepts'>[concepts]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>18.2</a> Equality preservation <a class='abbr_ref'>[concepts.equality]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L27'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>An expression is <a class='hidden_link' href='#def:expression,equality-preserving' title='18.2&emsp;Equality preservation&emsp;[concepts.equality]'><span id='def:expression,equality-preserving'><i >equality-preserving</i></span></a> if,
given equal inputs, the expression results in equal outputs<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>The inputs to an
expression are the set of the expression's operands<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>The output of an expression
is the expression's result and all operands modified by the expression<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>For the purposes of this subclause,
the operands of an expression are the largest subexpressions that include only:
<ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#1.1'>(1.1)</a></div>an <a href='expr.prim.id.general#nt:id-expression' title='7.5.5.1&emsp;General&emsp;[expr.prim.id.general]'><span id='ntref:id-expression'><span class='textsf'><i >id-expression</i></span></span></a> (<a href='expr.prim.id' title='7.5.5&emsp;Names'>[expr.<span class='shy'></span>prim.<span class='shy'></span>id]</a>), and</li><li id='1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#1.2'>(1.2)</a></div>invocations of the library function templates
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move</span>,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward</span>, and
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>declval</span> (<a href='forward' title='22.2.4&emsp;Forward/move helpers'>[forward]</a>, <a href='declval' title='22.2.6&emsp;Function template declval'>[declval]</a>)<a class='hidden_link' href='#1.sentence-4'>.</a></li></ul></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<div id='1.sentence-5' class='sentence'>The operands of the expression <span class='texttt'>a <span class='operator'>=</span> std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span></span> are
<span class='texttt'>a</span> and <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span></span><a class='hidden_link' href='#1.sentence-5'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L48'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>Not all input values need be valid for a given expression<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>:&ensp;<div id='2.sentence-2' class='sentence'>For integers <span class='texttt'>a</span> and <span class='texttt'>b</span>,
the expression <span class='texttt'>a <span class='operator'>/</span> b</span> is not well-defined
when <span class='texttt'>b</span> is <span class='texttt'><span class='literal'>0</span></span><a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>This does not preclude the expression <span class='texttt'>a <span class='operator'>/</span> b</span> being equality-preserving<a class='hidden_link' href='#2.sentence-3'>.</a></div> —&nbsp;<i>end example</i>]</div></div> <div id='2.sentence-4' class='sentence'>
The <a class='hidden_link' href='#def:expression,domain' title='18.2&emsp;Equality preservation&emsp;[concepts.equality]'><span id='def:expression,domain'><i >domain</i></span></a> of an expression is the set of
input values for which the expression is required to be well-defined<a class='hidden_link' href='#2.sentence-4'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L59'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Expressions required to be equality-preserving are further
required to be stable: two evaluations of such an expression with the same input
objects are required to have equal outputs absent any explicit intervening
modification of those input objects<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='3.sentence-2' class='sentence'>This requirement allows generic code to reason about the current values of
objects based on knowledge of the prior values as observed via
equality-preserving expressions<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>It effectively forbids spontaneous changes to
an object, changes to an object from another thread of execution, changes to an
object as side effects of non-modifying expressions, and changes to an object as
side effects of modifying a distinct object if those changes could be observable
to a library function via an equality-preserving expression that is required to
be valid for that object<a class='hidden_link' href='#3.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L75'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>Expressions declared in a <a href='expr.prim.req.general#nt:requires-expression' title='7.5.8.1&emsp;General&emsp;[expr.prim.req.general]'><span id='ntref:requires-expression'><span class='textsf'><i >requires-expression</i></span></span></a> in the library clauses are
required to be equality-preserving, except for those annotated with the comment
“not required to be equality-preserving<a class='hidden_link' href='#4.sentence-1'>.</a>”</div> <div id='4.sentence-2' class='sentence'>An expression so annotated
may be equality-preserving, but is not required to be so<a class='hidden_link' href='#4.sentence-2'>.</a></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L81'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>An expression that may alter the value of one or more of its inputs in a manner
observable to equality-preserving expressions is said to modify those inputs<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>The library clauses use a notational convention to specify which expressions declared
in a <a href='expr.prim.req.general#nt:requires-expression' title='7.5.8.1&emsp;General&emsp;[expr.prim.req.general]'><span id='ntref:requires-expression_'><span class='textsf'><i >requires-expression</i></span></span></a> modify which inputs: except where
otherwise specified, an expression operand that is a non-constant lvalue or
rvalue may be modified<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>Operands that are constant lvalues or rvalues are
required to not be modified<a class='hidden_link' href='#5.sentence-3'>.</a></div> <div id='5.sentence-4' class='sentence'>For the purposes of this subclause,
the cv-qualification and value category of each operand
are determined by assuming
that each template type parameter
denotes a cv-unqualified complete non-array object type<a class='hidden_link' href='#5.sentence-4'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L95'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>Where a <a href='expr.prim.req.general#nt:requires-expression' title='7.5.8.1&emsp;General&emsp;[expr.prim.req.general]'><span id='ntref:requires-expression__'><span class='textsf'><i >requires-expression</i></span></span></a> declares an expression that is
non-modifying for some constant lvalue operand, additional variations of that
expression that accept a non-constant lvalue or (possibly constant) rvalue for
the given operand are also required except where such an expression variation is
explicitly required with differing semantics<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>These
<a class='hidden_link' href='#def:implicit_expression_variations' id='def:implicit_expression_variations'><i>implicit expression variations</i></a> are required to meet the semantic
requirements of the declared expression<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='6.sentence-3' class='sentence'>The extent to which an implementation
validates the syntax of the variations is unspecified<a class='hidden_link' href='#6.sentence-3'>.</a></div></div></div><div class='para nonNormativeOnly' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L105'>#</a></div><div class='texpara'><div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>concept</span> C <span class='operator'>=</span> <span class='keyword'>requires</span><span class='parenthesis'>(</span>T a, T b, <span class='keyword'>const</span> T c, <span class='keyword'>const</span> T d<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c <span class='operator'>=</span><span class='operator'>=</span> d;           <span class='comment'>// #1</span>
  a <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span>; <span class='comment'>// #2</span>
  a <span class='operator'>=</span> c;            <span class='comment'>// #3</span>
<span class='curlybracket'>}</span>;
</span></div><div class='texpara'><div id='7.sentence-1' class='sentence'>For the above example:
<ul class='itemize'><li id='7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.1'>(7.1)</a></div><div class='texpara'><div id='7.1.sentence-1' class='sentence'>Expression #1 does not modify either of its operands, #2 modifies both of its
operands, and #3 modifies only its first operand <span class='texttt'>a</span><a class='hidden_link' href='#7.1.sentence-1'>.</a></div></div></li><li id='7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.2'>(7.2)</a></div><div class='texpara'><div id='7.2.sentence-1' class='sentence'>Expression #1 implicitly requires additional expression variations that meet
the requirements for <span class='texttt'>c <span class='operator'>=</span><span class='operator'>=</span> d</span> (including non-modification), as if the
expressions
<span class='codeblock'>                                            c  <span class='operator'>=</span><span class='operator'>=</span>           b;
          c  <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span>;               c  <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span>;
std<span class='operator'>::</span>move<span class='parenthesis'>(</span>c<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span>           d;      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>c<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span>           b;
std<span class='operator'>::</span>move<span class='parenthesis'>(</span>c<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span>;     std<span class='operator'>::</span>move<span class='parenthesis'>(</span>c<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span>;

          a  <span class='operator'>=</span><span class='operator'>=</span>           d;                a  <span class='operator'>=</span><span class='operator'>=</span>           b;
          a  <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span>;               a  <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span>;
std<span class='operator'>::</span>move<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span>           d;      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span>           b;
std<span class='operator'>::</span>move<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span>;     std<span class='operator'>::</span>move<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>b<span class='parenthesis'>)</span>;
</span>
had been declared as well<a class='hidden_link' href='#7.2.sentence-1'>.</a></div></div></li><li id='7.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.3'>(7.3)</a></div><div class='texpara'><div id='7.3.sentence-1' class='sentence'>Expression #3 implicitly requires additional expression variations that meet
the requirements for <span class='texttt'>a <span class='operator'>=</span> c</span> (including non-modification of the second
operand), as if the expressions <span class='texttt'>a <span class='operator'>=</span> b</span> and <span class='texttt'>a <span class='operator'>=</span> std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>c<span class='parenthesis'>)</span></span> had
been declared<a class='hidden_link' href='#7.3.sentence-1'>.</a></div> <div id='7.3.sentence-2' class='sentence'>Expression #3 does not implicitly require an expression
variation with a non-constant rvalue second operand, since expression #2
already specifies exactly such an expression explicitly<a class='hidden_link' href='#7.3.sentence-2'>.</a></div></div></li></ul></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/concepts.tex#L148'>#</a></div><div class='texpara'><div id='example-4' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-4'>4</a></i>:&ensp;<div id='8.sentence-1' class='sentence'>The following type <span class='texttt'>T</span> meets the explicitly stated syntactic requirements
of concept <span class='texttt'>C</span> above but does not meet the additional implicit
requirements:
<span class='codeblock'><span class='keyword'>struct</span> T <span class='curlybracket'>{</span>
  <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> T<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>true</span>; <span class='curlybracket'>}</span>
  <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
<span class='curlybracket'>}</span>;
</span></div></div><div class='texpara'><div id='8.sentence-2' class='sentence'><span class='texttt'>T</span> fails to meet the implicit requirements of <span class='texttt'>C</span>,
so <span class='texttt'>T</span> satisfies but does not model <span class='texttt'>C</span><a class='hidden_link' href='#8.sentence-2'>.</a></div> <div id='8.sentence-3' class='sentence'>Since implementations are not required to validate the syntax
of implicit requirements, it is unspecified whether an implementation diagnoses
as ill-formed a program that requires <span class='texttt'>C<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#8.sentence-3'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>