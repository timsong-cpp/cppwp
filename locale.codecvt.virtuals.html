<!DOCTYPE html><html lang='en'><head><title>[locale.codecvt.virtuals]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>25</a> Localization library <a class='abbr_ref' href='./#localization'>[localization]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>25.4</a> Standard <span class='texttt'>locale</span> categories <a class='abbr_ref' href='locale.categories#locale.codecvt.virtuals'>[locale.categories]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>25.4.1</a> The <span class='texttt'>ctype</span> category <a class='abbr_ref' href='category.ctype#locale.codecvt.virtuals'>[category.ctype]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>25.4.1.4</a> Class template <span class='texttt'>codecvt</span> <a class='abbr_ref' href='locale.codecvt#virtuals'>[locale.codecvt]</a></h4><h4 ><a class='secnum' style='min-width:133pt'>25.4.1.4.2</a> <span class='texttt'>codecvt</span> virtual functions <a class='abbr_ref'>[locale.codecvt.virtuals]</a></h4><span class='indexparent'><a class='index' id='lib:codecvt,do_out'></a></span><span class='indexparent'><a class='index' id='lib:do_out,codecvt'></a></span><span class='indexparent'><a class='index' id='lib:codecvt,do_in'></a></span><span class='indexparent'><a class='index' id='lib:do_in,codecvt'></a></span><code class='itemdecl'>result do_out(
    stateT&amp; state,
    const internT* from, const internT* from_end, const internT*&amp; from_next,
    externT* to, externT* to_end, externT*&amp; to_next) const;

result do_in(
    stateT&amp; state,
    const externT* from, const externT* from_end, const externT*&amp; from_next,
    internT* to, internT* to_end, internT*&amp; to_next) const;
</code><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2029'>#</a></div><div id='1.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
<span class='texttt'>(from &lt;= from_&shy;end &amp;&amp; to &lt;= to_&shy;end)</span>
well-defined and
<span class='texttt'>true</span>;
<span class='texttt'>state</span> initialized, if at the beginning of a sequence, or else equal to
the result of converting the preceding characters in the sequence<a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2037'>#</a></div><div id='2.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Translates characters in the source range
<span class='texttt'>[from, from_&shy;end)</span>,
placing the results in sequential positions starting at destination <span class='texttt'>to</span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>Converts no more than
<span class='texttt'>(from_&shy;end - from)</span>
source elements, and
stores no more than
<span class='texttt'>(to_&shy;end - to)</span>
destination elements<a class='hidden_link' href='#2.sentence-2'>.</a></div><div style='height:0.6em;display:block'></div><div id='2.sentence-3' class='sentence'>Stops if it encounters a character it cannot convert<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>It always leaves the <span class='texttt'>from_&shy;next</span> and <span class='texttt'>to_&shy;next</span> pointers
pointing one beyond the last element successfully converted<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>If returns
<span class='texttt'>noconv</span>,
<span class='texttt'>internT</span>
and
<span class='texttt'>externT</span>
are the same type and the converted sequence is
identical to the input sequence
<span class='texttt'>[from, from_next)</span><a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'><span class='texttt'>to_&shy;next</span> is set equal to <span class='texttt'>to</span>, the value of <span class='texttt'>state</span> is
unchanged, and there are no changes to the values in
<span class='texttt'>[to, to_&shy;end)</span><a class='hidden_link' href='#2.sentence-6'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2064'>#</a></div><div id='3.sentence-1' class='sentence'>A
<span class='texttt'>codecvt</span>
facet that is used by
<span class='texttt'>basic_&shy;filebuf</span> (<a href='file.streams'>[file.streams]</a>) shall have the property that if
<pre class='codeblock'>
do_out(state, from, from_end, from_next, to, to_end, to_next)</pre>
would return
<span class='texttt'>ok</span>,
where
<span class='texttt'>from != from_&shy;end</span>,
then
<pre class='codeblock'>
do_out(state, from, from + 1, from_next, to, to_end, to_next)</pre>
shall also return
<span class='texttt'>ok</span>,
and that if
<pre class='codeblock'>
do_in(state, from, from_end, from_next, to, to_end, to_next)</pre>
would return
<span class='texttt'>ok</span>,
where
<span class='texttt'>to != to_&shy;end</span>,
then
<pre class='codeblock'>
do_in(state, from, from_end, from_next, to, to + 1, to_next)</pre>
shall also return
<span class='texttt'>ok</span><a class='hidden_link' href='#3.sentence-1'>.</a><a class='footnotenum' href='#footnote-237'>237</a></div> <div id='3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-2' class='sentence'>As a result of operations on <span class='texttt'>state</span>, it can return <span class='texttt'>ok</span> or <span class='texttt'>partial</span> and set <span class='texttt'>from_&shy;next == from</span> and <span class='texttt'>to_&shy;next != to</span><a class='hidden_link' href='#3.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2106'>#</a></div><div id='4.sentence-1' class='sentence'><span class='textit'>Remarks:</span> 
Its operations on <span class='texttt'>state</span> are unspecified<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='4.sentence-2' class='sentence'>This argument can be used, for example, to maintain
shift state, to specify conversion options (such as count only), or to
identify a cache of seek offsets<a class='hidden_link' href='#4.sentence-2'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2115'>#</a></div><div id='5.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
An enumeration value, as summarized in Table <a href='#tab:localization.convert.result.values.out.in'>71</a><a class='hidden_link' href='#5.sentence-1'>.</a></div><div class='numberedTable' id='tab:localization.convert.result.values.out.in'>Table <a href='#tab:localization.convert.result.values.out.in'>71</a> — <span class='texttt'>do_&shy;in/do_&shy;out</span> result values<br><table ><tr class='rowsep'><td colspan='1' class='center'><div id='5.sentence-2' class='sentence'><b>Value</b></div></td><td colspan='1' class='center'><div id='5.sentence-3' class='sentence'><b>Meaning</b></div></td></tr><tr class='capsep'><td class='left'><div id='5.sentence-4' class='sentence'><span class='texttt'>ok</span></div></td><td class='justify'><div id='5.sentence-5' class='sentence'>completed the conversion</div></td></tr><tr ><td class='left'><div id='5.sentence-6' class='sentence'><span class='texttt'>partial</span></div></td><td class='justify'><div id='5.sentence-7' class='sentence'>not all source characters converted</div></td></tr><tr ><td class='left'><div id='5.sentence-8' class='sentence'><span class='texttt'>error</span></div></td><td class='justify'><div id='5.sentence-9' class='sentence'>encountered a character in <span class='texttt'>[from, from_&shy;end)</span>
that it could not convert</div></td></tr><tr ><td class='left'><div id='5.sentence-10' class='sentence'><span class='texttt'>noconv</span></div></td><td class='justify'><div id='5.sentence-11' class='sentence'><span class='texttt'>internT</span> and <span class='texttt'>externT</span> are the same type, and input
sequence is identical to converted sequence</div></td></tr></table></div><div id='5.sentence-12' class='sentence'>A return value of
<span class='texttt'>partial</span>,
if
<span class='texttt'>(from_&shy;next == from_&shy;end)</span>,
indicates that either the destination sequence has not absorbed all the
available destination elements, or that additional source elements are
needed before another destination element can be produced<a class='hidden_link' href='#5.sentence-12'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:codecvt,do_unshift'></a></span><span class='indexparent'><a class='index' id='lib:do_unshift,codecvt'></a></span><code class='itemdecl'>result do_unshift(stateT&amp; state, externT* to, externT* to_end, externT*&amp; to_next) const;
</code><div class='itemdescr'></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2148'>#</a></div><div id='6.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
<span class='texttt'>(to &lt;= to_&shy;end)</span>
well defined and <span class='texttt'>true</span>; state initialized, if at the beginning of a sequence,
or else equal to the result of converting the preceding characters in the
sequence<a class='hidden_link' href='#6.sentence-1'>.</a></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2155'>#</a></div><div id='7.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
Places characters starting at <span class='texttt'>to</span> that should be appended
to terminate a sequence when the current
<span class='texttt'>stateT</span>
is given by <span class='texttt'>state</span><a class='hidden_link' href='#7.sentence-1'>.</a><a class='footnotenum' href='#footnote-238'>238</a></div> <div id='7.sentence-2' class='sentence'>
Stores no more than
<span class='texttt'>(to_&shy;end - to)</span>
destination elements, and leaves the <span class='texttt'>to_&shy;next</span> pointer
pointing one beyond the last element successfully stored<a class='hidden_link' href='#7.sentence-2'>.</a></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2167'>#</a></div><div id='8.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
An enumeration value, as summarized in Table <a href='#tab:localization.convert.result.values.unshift'>72</a><a class='hidden_link' href='#8.sentence-1'>.</a></div><div class='numberedTable' id='tab:localization.convert.result.values.unshift'>Table <a href='#tab:localization.convert.result.values.unshift'>72</a> — <span class='texttt'>do_&shy;unshift</span> result values<br><table ><tr class='rowsep'><td colspan='1' class='center'><div id='8.sentence-2' class='sentence'><b>Value</b></div></td><td colspan='1' class='center'><div id='8.sentence-3' class='sentence'><b>Meaning</b></div></td></tr><tr class='capsep'><td class='left'><div id='8.sentence-4' class='sentence'><span class='texttt'>ok</span></div></td><td class='justify'><div id='8.sentence-5' class='sentence'>completed the sequence</div></td></tr><tr ><td class='left'><div id='8.sentence-6' class='sentence'><span class='texttt'>partial</span></div></td><td class='justify'><div id='8.sentence-7' class='sentence'>space for more than <span class='texttt'>to_&shy;end - to</span> destination elements was needed
to terminate a sequence given the value of <span class='texttt'>state</span></div></td></tr><tr ><td class='left'><div id='8.sentence-8' class='sentence'><span class='texttt'>error</span></div></td><td class='justify'><div id='8.sentence-9' class='sentence'>an unspecified error has occurred</div></td></tr><tr ><td class='left'><div id='8.sentence-10' class='sentence'><span class='texttt'>noconv</span></div></td><td class='justify'><div id='8.sentence-11' class='sentence'>no termination is needed for this <span class='texttt'>state_&shy;type</span></div></td></tr></table></div></div></div><span class='indexparent'><a class='index' id='lib:codecvt,do_encoding'></a></span><span class='indexparent'><a class='index' id='lib:do_encoding,codecvt'></a></span><code class='itemdecl'>int do_encoding() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2190'>#</a></div><div id='9.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<span class='texttt'>-1</span> if the encoding of the <span class='texttt'>externT</span> sequence is state-dependent; else the
constant number of <span class='texttt'>externT</span> characters needed to produce an internal
character; or <span class='texttt'>0</span> if this number is not a constant<a class='hidden_link' href='#9.sentence-1'>.</a><a class='footnotenum' href='#footnote-239'>239</a></div></div></div><span class='indexparent'><a class='index' id='lib:codecvt,do_always_noconv'></a></span><span class='indexparent'><a class='index' id='lib:do_always_noconv,codecvt'></a></span><code class='itemdecl'>bool do_always_noconv() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2207'>#</a></div><div id='10.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<span class='texttt'>true</span>
if
<span class='texttt'>do_&shy;in()</span>
and
<span class='texttt'>do_&shy;out()</span>
return
<span class='texttt'>noconv</span>
for all valid argument values<a class='hidden_link' href='#10.sentence-1'>.</a></div> <div id='10.sentence-2' class='sentence'><span class='texttt'>codecvt&lt;char, char, mbstate_&shy;t&gt;</span>
returns
<span class='texttt'>true</span><a class='hidden_link' href='#10.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:codecvt,do_length'></a></span><span class='indexparent'><a class='index' id='lib:do_length,codecvt'></a></span><code class='itemdecl'>int do_length(stateT&amp; state, const externT* from, const externT* from_end, size_t max) const;
</code><div class='itemdescr'></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2228'>#</a></div><div id='11.sentence-1' class='sentence'><span class='textit'>Requires:</span> 
<span class='texttt'>(from &lt;= from_&shy;end)</span>
well-defined and
<span class='texttt'>true</span>;
<span class='texttt'>state</span> initialized, if at the beginning of a sequence, or else equal to
the result of converting the preceding characters in the sequence<a class='hidden_link' href='#11.sentence-1'>.</a></div></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2236'>#</a></div><div id='12.sentence-1' class='sentence'><span class='textit'>Effects:</span> 
The effect on the <span class='texttt'>state</span> argument is “as if” it called
<span class='texttt'>do_&shy;in(state, from, from_&shy;end, from, to, to+max, to)</span>
for <span class='texttt'>to</span> pointing to a buffer of at least <span class='texttt'>max</span> elements<a class='hidden_link' href='#12.sentence-1'>.</a></div></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2242'>#</a></div><div id='13.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
<span class='texttt'>(from_&shy;next-from)</span>
where
<span class='texttt'>from_&shy;next</span>
is the largest value in the range
<span class='texttt'>[from, from_&shy;end]</span>
such that the sequence of values in the range
<span class='texttt'>[from, from_&shy;next)</span>
represents
<span class='texttt'>max</span>
or fewer valid complete characters of type
<span class='texttt'>internT</span><a class='hidden_link' href='#13.sentence-1'>.</a></div> <div id='13.sentence-2' class='sentence'>The specialization
<span class='texttt'>codecvt&lt;char, char, mbstate_&shy;t&gt;</span>,
returns the lesser of
<span class='texttt'>max</span>
and
<span class='texttt'>(from_&shy;end-from)</span><a class='hidden_link' href='#13.sentence-2'>.</a></div></div></div><span class='indexparent'><a class='index' id='lib:codecvt,do_max_length'></a></span><span class='indexparent'><a class='index' id='lib:do_max_length,codecvt'></a></span><code class='itemdecl'>int do_max_length() const noexcept;
</code><div class='itemdescr'></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4ba4e9c2c04b7680ac2a56b65c241ec10c427c3f/source/locales.tex#L2269'>#</a></div><div id='14.sentence-1' class='sentence'><span class='textit'>Returns:</span> 
The maximum value that
<span class='texttt'>do_&shy;length(state, from, from_&shy;end, 1)</span>
can return for any valid range
<span class='texttt'>[from, from_&shy;end)</span>
and
<span class='texttt'>stateT</span>
value
<span class='texttt'>state</span><a class='hidden_link' href='#14.sentence-1'>.</a></div> <div id='14.sentence-2' class='sentence'>The specialization
<span class='texttt'>codecvt&lt;char, char, mbstate_&shy;t&gt;&#x200b;::&#x200b;do_&shy;max_&shy;length()</span>
returns 1<a class='hidden_link' href='#14.sentence-2'>.</a></div></div></div><div class='footnote' id='footnote-237'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-237'>237)</a></div><div id='footnote-237.sentence-1' class='sentence'>Informally, this means that
<span class='texttt'>basic_&shy;filebuf</span>
assumes that the mappings from internal to external characters is
1 to N: a
<span class='texttt'>codecvt</span>
facet that is used by
<span class='texttt'>basic_&shy;filebuf</span>
must be able to translate characters one internal character at a time<a class='hidden_link' href='#footnote-237.sentence-1'>.</a></div></div><div class='footnote' id='footnote-238'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-238'>238)</a></div><div id='footnote-238.sentence-1' class='sentence'>Typically these will be characters to return the state to
<span class='texttt'>stateT()</span><a class='hidden_link' href='#footnote-238.sentence-1'>.</a></div></div><div class='footnote' id='footnote-239'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-239'>239)</a></div><div id='footnote-239.sentence-1' class='sentence'>If <span class='texttt'>encoding()</span>
yields <span class='texttt'>-1</span>, then more than <span class='texttt'>max_&shy;length()</span> <span class='texttt'>externT</span> elements
may be consumed when producing a single <span class='texttt'>internT</span> character, and additional
<span class='texttt'>externT</span> elements may appear at the end of a sequence after those that
yield the final <span class='texttt'>internT</span> character<a class='hidden_link' href='#footnote-239.sentence-1'>.</a></div></div></div></body></html>