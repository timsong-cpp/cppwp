<!DOCTYPE html><html lang='en'><head><title>[exec]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><div id='general' class='section'><h2 ><a class='secnum' href='#general' style='min-width:65pt'>33.1</a> General <a class='abbr_ref' href='exec.general'>[exec.general]</a></h2><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L6'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'>This Clause describes components
supporting execution of function objects (<a href='function.objects' title='22.10&emsp;Function objects'>[function.<span class='shy'></span>objects]</a>)<a class='hidden_link' href='#general-1.sentence-1'>.</a></div></div></div><div class='para' id='general-2'><div class='marginalizedparent'><a class='marginalized' href='#general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L10'>#</a></div><div class='texpara'><div id='general-2.sentence-1' class='sentence'>The following subclauses describe
the requirements, concepts, and components
for execution control primitives as summarized in Table <a href='#tab:exec.summary' title='Table 155: Execution control library summary'>155</a><a class='hidden_link' href='#general-2.sentence-1'>.</a></div></div><div class='texpara'><div class='numberedTable' id='tab:exec.summary'>Table <a href='#tab:exec.summary'>155</a> &mdash; Execution control library summary&emsp;<a href='./tab:exec.summary'>[tab:exec.summary]</a><br><table ><tr id='tab:exec.summary-row-1' class='rowsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-1'>ðŸ”—</a></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-1-column-2-sentence-1' class='sentence'><b>Subclause</b></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-1-column-3-sentence-1' class='sentence'><b>Header</b></div></div></td></tr><tr id='tab:exec.summary-row-2' class='capsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-2'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-2-column-1-sentence-1' class='sentence'><a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-2-column-2-sentence-1' class='sentence'>Schedulers</div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-2-column-3-sentence-1' class='sentence'><span class='texttt'><span class='anglebracket'>&lt;</span>execution<span class='anglebracket'>&gt;</span></span></div></div></td></tr><tr id='tab:exec.summary-row-3'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-3'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-3-column-1-sentence-1' class='sentence'><a href='#recv' title='33.7&emsp;Receivers'>[exec.<span class='shy'></span>recv]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-3-column-2-sentence-1' class='sentence'>Receivers</div></div></td><td class='empty left'></td></tr><tr id='tab:exec.summary-row-4'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-4'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-4-column-1-sentence-1' class='sentence'><a href='#opstate' title='33.8&emsp;Operation states'>[exec.<span class='shy'></span>opstate]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-4-column-2-sentence-1' class='sentence'>Operation states</div></div></td><td class='empty left'></td></tr><tr id='tab:exec.summary-row-5'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-5'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-5-column-1-sentence-1' class='sentence'><a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-5-column-2-sentence-1' class='sentence'>Senders</div></div></td><td class='empty left'></td></tr></table></div></div></div><div class='para' id='general-3'><div class='marginalizedparent'><a class='marginalized' href='#general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L22'>#</a></div><div class='texpara'><div id='general-3.sentence-1' class='sentence'>Table <a href='#tab:exec.pos' title='Table 156: Types of customization point objects in the execution control library'>156</a> shows
the types of customization point objects (<a href='customization.point.object' title='16.3.3.3.5&emsp;Customization Point Object types'>[customization.<span class='shy'></span>point.<span class='shy'></span>object]</a>)
used in the execution control library<a class='hidden_link' href='#general-3.sentence-1'>.</a></div></div><div class='texpara'><div class='numberedTable' id='tab:exec.pos'>Table <a href='#tab:exec.pos'>156</a> &mdash; Types of customization point objects in the execution control library&emsp;<a href='./tab:exec.pos'>[tab:exec.pos]</a><br><table ><tr id='tab:exec.pos-row-1' class='rowsep'><td class='center'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-1'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-1-column-1-sentence-1' class='sentence'><b>Customization point</b></div></div></td><td class='center'><div class='texpara'><div id='tab:exec.pos-row-1-column-2-sentence-1' class='sentence'><b>Purpose</b></div></div></td><td class='center'><div class='texpara'><div id='tab:exec.pos-row-1-column-3-sentence-1' class='sentence'><b>Examples</b></div></div></td></tr><tr id='tab:exec.pos-row-2'><td class='center'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-2'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-2-column-1-sentence-1' class='sentence'><b>object type</b></div></div></td><td class='empty left' style='width:23%'></td><td class='empty left' style='width:45%'></td></tr><tr id='tab:exec.pos-row-3' class='capsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-3'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-3-column-1-sentence-1' class='sentence'>core</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-3-column-2-sentence-1' class='sentence'>provide core execution functionality, and connection between core components</div></div></td><td class='left' style='width:45%'><div class='texpara'><div id='tab:exec.pos-row-3-column-3-sentence-1' class='sentence'>e.g., <a href='#lib:connect' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>connect</span></a>, <a href='#lib:start' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>start</span></a></div></div></td></tr><tr id='tab:exec.pos-row-4'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-4'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-4-column-1-sentence-1' class='sentence'>completion functions</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-4-column-2-sentence-1' class='sentence'>called by senders to announce the completion of the work (success, error, or cancellation)</div></div></td><td class='left' style='width:45%'><div class='texpara'><div id='tab:exec.pos-row-4-column-3-sentence-1' class='sentence'><a href='#lib:set_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>value</span></a>, <a href='#lib:set_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>error</span></a>, <a href='#lib:set_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>stopped</span></a></div></div></td></tr><tr id='tab:exec.pos-row-5'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-5'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-5-column-1-sentence-1' class='sentence'>senders</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-5-column-2-sentence-1' class='sentence'>allow the specialization of the provided sender algorithms</div></div></td><td class='left' style='width:45%'><div class='texpara'><ul class='itemize'><li >sender factories (e.g., <a href='#lib:schedule' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>schedule</span></a>, <a href='#lib:just' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>just</span></a>, <a href='#lib:read_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>read_<span class='shy'></span>env</span></a>)</li><li >sender adaptors (e.g., <a href='#lib:continues_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>continues_<span class='shy'></span>on</span></a>, <a href='#lib:then' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>then</span></a>, <a href='#lib:let_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>let_<span class='shy'></span>value</span></a>)</li><li >sender consumers (e.g., <a href='#lib:sync_wait' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>sync_<span class='shy'></span>wait</span></a>)</li></ul></div></td></tr><tr id='tab:exec.pos-row-6'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-6'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-6-column-1-sentence-1' class='sentence'>queries</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-6-column-2-sentence-1' class='sentence'>allow querying different properties of objects</div></div></td><td class='left' style='width:45%'><div class='texpara'><ul class='itemize'><li >general queries (e.g., <a href='#lib:get_allocator' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>allocator</span></a>, <a href='#lib:get_stop_token' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span></a>)</li><li >environment queries (e.g., <span class='texttt'>get_<span class='shy'></span>scheduler</span>, <a href='#lib:get_delegation_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span></a>)</li><li >scheduler queries (e.g., <a href='#lib:get_forward_progress_guarantee' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span></a>)</li><li >sender attribute queries (e.g., <a href='#lib:get_completion_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span></a>)</li></ul></div></td></tr></table></div></div></div><div class='para' id='general-4'><div class='marginalizedparent'><a class='marginalized' href='#general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L57'>#</a></div><div class='texpara'><div id='general-4.sentence-1' class='sentence'>This clause makes use of the following exposition-only entities<a class='hidden_link' href='#general-4.sentence-1'>.</a></div></div></div><div class='para' id='general-5'><div class='marginalizedparent'><a class='marginalized' href='#general-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L60'>#</a></div><div class='texpara'><div id='general-5.sentence-1' class='sentence'>For a subexpression <span class='texttt'>expr</span>,
let <span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> be
expression-equivalent to <span class='texttt'>expr</span><a class='hidden_link' href='#general-5.sentence-1'>.</a></div></div><div class='texpara'><div id='general-5.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#general-5.sentence-2'>.</a></div></div></div><div class='para' id='general-6'><div class='marginalizedparent'><a class='marginalized' href='#general-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L68'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='concept:movable-value'><span class='tcode_in_codeblock'><i >movable-value</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='parenthesis'>(</span><span class='operator'>!</span>is_array_v<span class='anglebracket'>&lt;</span>remove_reference_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='general-7'><div class='marginalizedparent'><a class='marginalized' href='#general-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L79'>#</a></div><div class='texpara'><div id='general-7.sentence-1' class='sentence'>For function types <span class='texttt'>F1</span> and <span class='texttt'>F2</span> denoting
<span class='texttt'>R1<span class='parenthesis'>(</span>Args1<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and <span class='texttt'>R2<span class='parenthesis'>(</span>Args2<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>, respectively,
<span class='texttt'><span class='texttt'><i >MATCHING-SIG</i></span><span class='parenthesis'>(</span>F1, F2<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span> if and only if
<span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>R1<span class='parenthesis'>(</span>Args1<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, R2<span class='parenthesis'>(</span>Args2<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#general-7.sentence-1'>.</a></div></div></div><div class='para' id='general-8'><div class='marginalizedparent'><a class='marginalized' href='#general-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L86'>#</a></div><div class='texpara'><div id='general-8.sentence-1' class='sentence'>For a subexpression <span class='texttt'>err</span>,
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'><span class='texttt'><i >AS-EXCEPT-PTR</i></span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span></span> be:
<ul class='itemize'><li id='general-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.1'>(8.1)</a></div><div class='texpara'><div id='general-8.1.sentence-1' class='sentence'><span class='texttt'>err</span> if <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span><a class='hidden_link' href='#general-8.1.sentence-1'>.</a></div></div><div class='texpara'><div id='general-8.1.sentence-2' class='sentence'><i >Preconditions</i>: <span class='texttt'><span class='operator'>!</span>err</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#general-8.1.sentence-2'>.</a></div></div></li><li id='general-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.2'>(8.2)</a></div><div class='texpara'><div id='general-8.2.sentence-1' class='sentence'>Otherwise,
<span class='texttt'>make_<span class='shy'></span>exception_<span class='shy'></span>ptr<span class='parenthesis'>(</span>system_<span class='shy'></span>error<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>error_<span class='shy'></span>code</span><a class='hidden_link' href='#general-8.2.sentence-1'>.</a></div></div></li><li id='general-8.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.3'>(8.3)</a></div><div class='texpara'><div id='general-8.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'>make_<span class='shy'></span>exception_<span class='shy'></span>ptr<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span></span><a class='hidden_link' href='#general-8.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='general-9'><div class='marginalizedparent'><a class='marginalized' href='#general-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L104'>#</a></div><div class='texpara'><div id='general-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>expr</span>,
let <span class='texttt'><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> be expression-equivalent to
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> x<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> x; <span class='curlybracket'>}</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span>
</span></div></div></div></div><div id='queryable' class='section'><h2 ><a class='secnum' href='#queryable' style='min-width:65pt'>33.2</a> Queries and queryables <a class='abbr_ref' href='exec.queryable'>[exec.queryable]</a></h2><div id='queryable.general' class='section'><h3 ><a class='secnum' href='#queryable.general' style='min-width:80pt'>33.2.1</a> General <a class='abbr_ref' href='exec.queryable.general'>[exec.queryable.general]</a></h3><div class='para' id='queryable.general-1'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L115'>#</a></div><div class='texpara'><div id='queryable.general-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:object,queryable' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:object,queryable'><i >queryable object</i></span></a> is
a read-only collection of key/value pair
where each key is a customization point object known as a <a class='hidden_link' href='#def:query_object' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:query_object'><i >query object</i></span></a><a class='hidden_link' href='#queryable.general-1.sentence-1'>.</a></div> <div id='queryable.general-1.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:query' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:query'><i >query</i></span></a> is an invocation of a query object
with a queryable object as its first argument and
a (possibly empty) set of additional arguments<a class='hidden_link' href='#queryable.general-1.sentence-2'>.</a></div> <div id='queryable.general-1.sentence-3' class='sentence'>A query imposes syntactic and semantic requirements on its invocations<a class='hidden_link' href='#queryable.general-1.sentence-3'>.</a></div></div></div><div class='para' id='queryable.general-2'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L124'>#</a></div><div class='texpara'><div id='queryable.general-2.sentence-1' class='sentence'>Let <span class='texttt'>q</span> be a query object,
let <span class='texttt'>args</span> be a (possibly empty) pack of subexpressions,
let <span class='texttt'>env</span> be a subexpression
that refers to a queryable object <span class='texttt'>o</span> of type <span class='texttt'>O</span>, and
let <span class='texttt'>cenv</span> be a subexpression referring to <span class='texttt'>o</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>cenv<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='keyword'>const</span> O<span class='operator'>&amp;</span></span><a class='hidden_link' href='#queryable.general-2.sentence-1'>.</a></div> <div id='queryable.general-2.sentence-2' class='sentence'>The expression <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equal to (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)
the expression <span class='texttt'>q<span class='parenthesis'>(</span>cenv, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#queryable.general-2.sentence-2'>.</a></div></div></div><div class='para' id='queryable.general-3'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L134'>#</a></div><div class='texpara'><div id='queryable.general-3.sentence-1' class='sentence'>The type of a query expression cannot be <span class='texttt'><span class='keyword'>void</span></span><a class='hidden_link' href='#queryable.general-3.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-4'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L137'>#</a></div><div class='texpara'><div id='queryable.general-4.sentence-1' class='sentence'>The expression <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is
equality-preserving (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>) and
does not modify the query object or the arguments<a class='hidden_link' href='#queryable.general-4.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-5'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L142'>#</a></div><div class='texpara'><div id='queryable.general-5.sentence-1' class='sentence'>If the expression <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed,
then it is expression-equivalent to <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#queryable.general-5.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-6'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L146'>#</a></div><div class='texpara'><div id='queryable.general-6.sentence-1' class='sentence'>Unless otherwise specified,
the result of a query is valid as long as the queryable object is valid<a class='hidden_link' href='#queryable.general-6.sentence-1'>.</a></div></div></div></div><div id='queryable.concept' class='section'><h3 ><a class='secnum' href='#queryable.concept' style='min-width:80pt'>33.2.2</a> <span class='texttt'>queryable</span> concept <a class='abbr_ref' href='exec.queryable.concept'>[exec.queryable.concept]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='concept:queryable'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='operator'>=</span> <a href='concept.destructible#concept:destructible' title='18.4.10&emsp;Concept destructible&emsp;[concept.destructible]'><span id='conceptref:destructible'><span class='tcode_in_codeblock'>destructible</span></span></a><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>;   <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>
</span></div><div class='para' id='queryable.concept-1'><div class='marginalizedparent'><a class='marginalized' href='#queryable.concept-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L159'>#</a></div><div class='texpara'><div id='queryable.concept-1.sentence-1' class='sentence'>The exposition-only <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable'><span class='texttt'><i >queryable</i></span></span></a> concept specifies
the constraints on the types of queryable objects<a class='hidden_link' href='#queryable.concept-1.sentence-1'>.</a></div></div></div><div class='para' id='queryable.concept-2'><div class='marginalizedparent'><a class='marginalized' href='#queryable.concept-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L163'>#</a></div><div class='texpara'><div id='queryable.concept-2.sentence-1' class='sentence'>Let <span class='texttt'>env</span> be an object of type <span class='texttt'>Env</span><a class='hidden_link' href='#queryable.concept-2.sentence-1'>.</a></div> <div id='queryable.concept-2.sentence-2' class='sentence'>The type <span class='texttt'>Env</span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_'><span class='texttt'><i >queryable</i></span></span></a>
if for each callable object <span class='texttt'>q</span> and a pack of subexpressions <span class='texttt'>args</span>,
if <span class='texttt'><span class='keyword'>requires</span> <span class='curlybracket'>{</span> q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span></span> is <span class='texttt'><span class='literal'>true</span></span> then
<span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> meets any semantic requirements imposed by <span class='texttt'>q</span><a class='hidden_link' href='#queryable.concept-2.sentence-2'>.</a></div></div></div></div></div><div id='async.ops' class='section'><h2 ><a class='secnum' href='#async.ops' style='min-width:65pt'>33.3</a> Asynchronous operations <a class='abbr_ref' href='exec.async.ops'>[exec.async.ops]</a></h2><div class='para' id='async.ops-1'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L172'>#</a></div><div class='texpara'><div id='async.ops-1.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:resource,execution' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:resource,execution'><i >execution resource</i></span></a> is a program entity that manages
a (possibly dynamic) set of execution agents (<a href='thread.req.lockable.general' title='32.2.5.1&emsp;General'>[thread.<span class='shy'></span>req.<span class='shy'></span>lockable.<span class='shy'></span>general]</a>),
which it uses to execute parallel work on behalf of callers<a class='hidden_link' href='#async.ops-1.sentence-1'>.</a></div> <div id='async.ops-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#async.ops-example-1'>1</a></i>:&ensp;<div id='async.ops-1.sentence-2' class='sentence'>The currently active thread,
a system-provided thread pool, and
uses of an API associated with an external hardware accelerator
are all examples of execution resources<a class='hidden_link' href='#async.ops-1.sentence-2'>.</a></div> â€”&nbsp;<i>end example</i>]</div></div> <div id='async.ops-1.sentence-3' class='sentence'>
Execution resources execute asynchronous operations<a class='hidden_link' href='#async.ops-1.sentence-3'>.</a></div> <div id='async.ops-1.sentence-4' class='sentence'>An execution resource is either valid or invalid<a class='hidden_link' href='#async.ops-1.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-2'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L185'>#</a></div><div class='texpara'><div id='async.ops-2.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:operation,asynchronous' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,asynchronous'><i >asynchronous operation</i></span></a> is
a distinct unit of program execution that
<ul class='itemize'><li id='async.ops-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.1'>(2.1)</a></div><div class='texpara'><div id='async.ops-2.1.sentence-1' class='sentence'>is explicitly created;</div></div></li><li id='async.ops-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.2'>(2.2)</a></div><div class='texpara'><div id='async.ops-2.2.sentence-1' class='sentence'>can be explicitly started once at most;</div></div></li><li id='async.ops-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.3'>(2.3)</a></div><div class='texpara'><div id='async.ops-2.3.sentence-1' class='sentence'>once started, eventually completes exactly once
with a (possibly empty) set of result datums and
in exactly one of three <a class='hidden_link' href='#def:disposition' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:disposition'><i >dispositions</i></span></a>:
success, failure, or cancellation;
<ul class='itemize'><li id='async.ops-2.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.1'>(2.3.1)</a></div><div class='texpara'><div id='async.ops-2.3.1.sentence-1' class='sentence'>A successful completion, also known as a <a class='hidden_link' href='#def:completion,value' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,value'><i >value completion</i></span></a>,
can have an arbitrary number of result datums<a class='hidden_link' href='#async.ops-2.3.1.sentence-1'>.</a></div></div></li><li id='async.ops-2.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.2'>(2.3.2)</a></div><div class='texpara'><div id='async.ops-2.3.2.sentence-1' class='sentence'>A failure completion, also known as an <a class='hidden_link' href='#def:completion,error' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,error'><i >error completion</i></span></a>,
has a single result datum<a class='hidden_link' href='#async.ops-2.3.2.sentence-1'>.</a></div></div></li><li id='async.ops-2.3.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.3'>(2.3.3)</a></div><div class='texpara'><div id='async.ops-2.3.3.sentence-1' class='sentence'>A cancellation completion, also known as a <a class='hidden_link' href='#def:completion,stopped' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,stopped'><i >stopped completion</i></span></a>,
has no result datum<a class='hidden_link' href='#async.ops-2.3.3.sentence-1'>.</a></div></div></li></ul></div> <div id='async.ops-2.3.sentence-2' class='sentence'>
An asynchronous operation's <a class='hidden_link' href='#def:result,async' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:result,async'><i >async result</i></span></a>
is its disposition and its (possibly empty) set of result datums<a class='hidden_link' href='#async.ops-2.3.sentence-2'>.</a></div></div></li><li id='async.ops-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.4'>(2.4)</a></div><div class='texpara'><div id='async.ops-2.4.sentence-1' class='sentence'>can complete on a different execution resource
than the execution resource on which it started; and</div></div></li><li id='async.ops-2.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.5'>(2.5)</a></div><div class='texpara'><div id='async.ops-2.5.sentence-1' class='sentence'>can create and start other asynchronous operations
called <a class='hidden_link' href='#def:operations,child' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operations,child'><i >child operations</i></span></a><a class='hidden_link' href='#async.ops-2.5.sentence-1'>.</a></div> <div id='async.ops-2.5.sentence-2' class='sentence'>A child operation is an asynchronous operation
that is created by the parent operation and,
if started, completes before the parent operation completes<a class='hidden_link' href='#async.ops-2.5.sentence-2'>.</a></div> <div id='async.ops-2.5.sentence-3' class='sentence'>A <a class='hidden_link' href='#def:operation,parent' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,parent'><i >parent operation</i></span></a> is the asynchronous operation
that created a particular child operation<a class='hidden_link' href='#async.ops-2.5.sentence-3'>.</a></div></div></li></ul></div> <div id='async.ops-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#async.ops-note-1'>1</a></i>:&ensp;<div id='async.ops-2.sentence-2' class='sentence'>An asynchronous operation can execute synchronously;
that is, it can complete during the execution of its start operation
on the thread of execution that started it<a class='hidden_link' href='#async.ops-2.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='async.ops-3'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L229'>#</a></div><div class='texpara'><div id='async.ops-3.sentence-1' class='sentence'>An asynchronous operation has associated state
known as its <a class='hidden_link' href='#def:state,operation' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:state,operation'><i >operation state</i></span></a><a class='hidden_link' href='#async.ops-3.sentence-1'>.</a></div></div></div><div class='para' id='async.ops-4'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L233'>#</a></div><div class='texpara'><div id='async.ops-4.sentence-1' class='sentence'>An asynchronous operation has an associated environment<a class='hidden_link' href='#async.ops-4.sentence-1'>.</a></div> <div id='async.ops-4.sentence-2' class='sentence'>An <a class='hidden_link' href='#def:environment' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:environment'><i >environment</i></span></a> is a queryable object (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)
representing the execution-time properties of the operation's caller<a class='hidden_link' href='#async.ops-4.sentence-2'>.</a></div> <div id='async.ops-4.sentence-3' class='sentence'>The caller of an asynchronous operation is
its parent operation or the function that created it<a class='hidden_link' href='#async.ops-4.sentence-3'>.</a></div></div></div><div class='para' id='async.ops-5'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L240'>#</a></div><div class='texpara'><div id='async.ops-5.sentence-1' class='sentence'>An asynchronous operation has an associated receiver<a class='hidden_link' href='#async.ops-5.sentence-1'>.</a></div> <div id='async.ops-5.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:receiver' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:receiver'><i >receiver</i></span></a> is an aggregation of three handlers
for the three asynchronous completion dispositions:
<ul class='itemize'><li id='async.ops-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.1'>(5.1)</a></div>a value completion handler for a value completion,</li><li id='async.ops-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.2'>(5.2)</a></div>an error completion handler for an error completion, and</li><li id='async.ops-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.3'>(5.3)</a></div>a stopped completion handler for a stopped completion<a class='hidden_link' href='#async.ops-5.sentence-2'>.</a></li></ul></div> <div id='async.ops-5.sentence-3' class='sentence'>
A receiver has an associated environment<a class='hidden_link' href='#async.ops-5.sentence-3'>.</a></div> <div id='async.ops-5.sentence-4' class='sentence'>An asynchronous operation's operation state owns the operation's receiver<a class='hidden_link' href='#async.ops-5.sentence-4'>.</a></div> <div id='async.ops-5.sentence-5' class='sentence'>The environment of an asynchronous operation
is equal to its receiver's environment<a class='hidden_link' href='#async.ops-5.sentence-5'>.</a></div></div></div><div class='para' id='async.ops-6'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L254'>#</a></div><div class='texpara'><div id='async.ops-6.sentence-1' class='sentence'>For each completion disposition, there is a <a class='hidden_link' href='#def:function,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:function,completion'><i >completion function</i></span></a><a class='hidden_link' href='#async.ops-6.sentence-1'>.</a></div> <div id='async.ops-6.sentence-2' class='sentence'>A completion function is
a customization point object (<a href='customization.point.object' title='16.3.3.3.5&emsp;Customization Point Object types'>[customization.<span class='shy'></span>point.<span class='shy'></span>object]</a>)
that accepts an asynchronous operation's receiver as the first argument and
the result datums of the asynchronous operation as additional arguments<a class='hidden_link' href='#async.ops-6.sentence-2'>.</a></div> <div id='async.ops-6.sentence-3' class='sentence'>The value completion function invokes
the receiver's value completion handler with the value result datums;
likewise for the error completion function and the stopped completion function<a class='hidden_link' href='#async.ops-6.sentence-3'>.</a></div> <div id='async.ops-6.sentence-4' class='sentence'>A completion function has
an associated type known as its <a class='hidden_link' href='#def:tag,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:tag,completion'><i >completion tag</i></span></a>
that is the unqualified type of the completion function<a class='hidden_link' href='#async.ops-6.sentence-4'>.</a></div> <div id='async.ops-6.sentence-5' class='sentence'>A valid invocation of a completion function is called
a <a class='hidden_link' href='#def:operation,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,completion'><i >completion operation</i></span></a><a class='hidden_link' href='#async.ops-6.sentence-5'>.</a></div></div></div><div class='para' id='async.ops-7'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L269'>#</a></div><div class='texpara'><div id='async.ops-7.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:lifetime_of_an_asynchronous_operation' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:lifetime_of_an_asynchronous_operation'><i >lifetime of an asynchronous operation</i></span></a>,
also known as the operation's <a class='hidden_link' href='#def:async_lifetime' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:async_lifetime'><i >async lifetime</i></span></a>,
begins when its start operation begins executing and
ends when its completion operation begins executing<a class='hidden_link' href='#async.ops-7.sentence-1'>.</a></div> <div id='async.ops-7.sentence-2' class='sentence'>If the lifetime of an asynchronous operation's associated operation state
ends before the lifetime of the asynchronous operation,
the behavior is undefined<a class='hidden_link' href='#async.ops-7.sentence-2'>.</a></div> <div id='async.ops-7.sentence-3' class='sentence'>After an asynchronous operation executes a completion operation,
its associated operation state is invalid<a class='hidden_link' href='#async.ops-7.sentence-3'>.</a></div> <div id='async.ops-7.sentence-4' class='sentence'>Accessing any part of an invalid operation state is undefined behavior<a class='hidden_link' href='#async.ops-7.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-8'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L281'>#</a></div><div class='texpara'><div id='async.ops-8.sentence-1' class='sentence'>An asynchronous operation shall not execute a completion operation
before its start operation has begun executing<a class='hidden_link' href='#async.ops-8.sentence-1'>.</a></div> <div id='async.ops-8.sentence-2' class='sentence'>After its start operation has begun executing,
exactly one completion operation shall execute<a class='hidden_link' href='#async.ops-8.sentence-2'>.</a></div> <div id='async.ops-8.sentence-3' class='sentence'>The lifetime of an asynchronous operation's operation state can end
during the execution of the completion operation<a class='hidden_link' href='#async.ops-8.sentence-3'>.</a></div></div></div><div class='para' id='async.ops-9'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L289'>#</a></div><div class='texpara'><div id='async.ops-9.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender'><i >sender</i></span></a> is a factory for one or more asynchronous operations<a class='hidden_link' href='#async.ops-9.sentence-1'>.</a></div> <div id='async.ops-9.sentence-2' class='sentence'><a class='hidden_link' href='#def:connect' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:connect'><i >Connecting</i></span></a> a sender and a receiver creates
an asynchronous operation<a class='hidden_link' href='#async.ops-9.sentence-2'>.</a></div> <div id='async.ops-9.sentence-3' class='sentence'>The asynchronous operation's associated receiver is equal to
the receiver used to create it, and
its associated environment is equal to
the environment associated with the receiver used to create it<a class='hidden_link' href='#async.ops-9.sentence-3'>.</a></div> <div id='async.ops-9.sentence-4' class='sentence'>The lifetime of an asynchronous operation's associated operation state
does not depend on the lifetimes of either the sender or the receiver
from which it was created<a class='hidden_link' href='#async.ops-9.sentence-4'>.</a></div> <div id='async.ops-9.sentence-5' class='sentence'>A sender is started when it is connected to a receiver and
the resulting asynchronous operation is started<a class='hidden_link' href='#async.ops-9.sentence-5'>.</a></div> <div id='async.ops-9.sentence-6' class='sentence'>A sender's async result is the async result of the asynchronous operation
created by connecting it to a receiver<a class='hidden_link' href='#async.ops-9.sentence-6'>.</a></div> <div id='async.ops-9.sentence-7' class='sentence'>A sender sends its results by way of the asynchronous operation(s) it produces,
and a receiver receives those results<a class='hidden_link' href='#async.ops-9.sentence-7'>.</a></div> <div id='async.ops-9.sentence-8' class='sentence'>A sender is either valid or invalid;
it becomes invalid when its parent sender (see below) becomes invalid<a class='hidden_link' href='#async.ops-9.sentence-8'>.</a></div></div></div><div class='para' id='async.ops-10'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L309'>#</a></div><div class='texpara'><div id='async.ops-10.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:scheduler' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:scheduler'><i >scheduler</i></span></a> is an abstraction of an execution resource
with a uniform, generic interface for scheduling work onto that resource<a class='hidden_link' href='#async.ops-10.sentence-1'>.</a></div> <div id='async.ops-10.sentence-2' class='sentence'>It is a factory for senders
whose asynchronous operations execute value completion operations
on an execution agent belonging to
the scheduler's associated execution resource<a class='hidden_link' href='#async.ops-10.sentence-2'>.</a></div> <div id='async.ops-10.sentence-3' class='sentence'>A <a class='hidden_link' href='#def:schedule-expression' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:schedule-expression'><i >schedule-expression</i></span></a> obtains such a sender from a scheduler<a class='hidden_link' href='#async.ops-10.sentence-3'>.</a></div> <div id='async.ops-10.sentence-4' class='sentence'>A <a class='hidden_link' href='#def:schedule_sender' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:schedule_sender'><i >schedule sender</i></span></a> is the result of a schedule expression<a class='hidden_link' href='#async.ops-10.sentence-4'>.</a></div> <div id='async.ops-10.sentence-5' class='sentence'>On success, an asynchronous operation produced by a schedule sender executes
a value completion operation with an empty set of result datums<a class='hidden_link' href='#async.ops-10.sentence-5'>.</a></div> <div id='async.ops-10.sentence-6' class='sentence'>Multiple schedulers can refer to the same execution resource<a class='hidden_link' href='#async.ops-10.sentence-6'>.</a></div> <div id='async.ops-10.sentence-7' class='sentence'>A scheduler can be valid or invalid<a class='hidden_link' href='#async.ops-10.sentence-7'>.</a></div> <div id='async.ops-10.sentence-8' class='sentence'>A scheduler becomes invalid when the execution resource to which it refers
becomes invalid,
as do any schedule senders obtained from the scheduler, and
any operation states obtained from those senders<a class='hidden_link' href='#async.ops-10.sentence-8'>.</a></div></div></div><div class='para' id='async.ops-11'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L327'>#</a></div><div class='texpara'><div id='async.ops-11.sentence-1' class='sentence'>An asynchronous operation has one or more associated completion schedulers
for each of its possible dispositions<a class='hidden_link' href='#async.ops-11.sentence-1'>.</a></div> <div id='async.ops-11.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:completion_scheduler' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion_scheduler'><i >completion scheduler</i></span></a> is a scheduler
whose associated execution resource is used to execute
a completion operation for an asynchronous operation<a class='hidden_link' href='#async.ops-11.sentence-2'>.</a></div> <div id='async.ops-11.sentence-3' class='sentence'>A value completion scheduler is a scheduler
on which an asynchronous operation's value completion operation can execute<a class='hidden_link' href='#async.ops-11.sentence-3'>.</a></div> <div id='async.ops-11.sentence-4' class='sentence'>Likewise for error completion schedulers and stopped completion schedulers<a class='hidden_link' href='#async.ops-11.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-12'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L337'>#</a></div><div class='texpara'><div id='async.ops-12.sentence-1' class='sentence'>A sender has an associated queryable object (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)
known as its <a class='hidden_link' href='#def:attribute' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:attribute'><i >attributes</i></span></a>
that describes various characteristics of the sender and
of the asynchronous operation(s) it produces<a class='hidden_link' href='#async.ops-12.sentence-1'>.</a></div> <div id='async.ops-12.sentence-2' class='sentence'>For each disposition,
there is a query object for reading the associated completion scheduler
from a sender's attributes;
i.e., a value completion scheduler query object
for reading a sender's value completion scheduler, etc<a class='hidden_link' href='#async.ops-12.sentence-2'>.</a></div> <div id='async.ops-12.sentence-3' class='sentence'>If a completion scheduler query is well-formed,
the returned completion scheduler is unique
for that disposition for any asynchronous operation the sender creates<a class='hidden_link' href='#async.ops-12.sentence-3'>.</a></div> <div id='async.ops-12.sentence-4' class='sentence'>A schedule sender is required to have a value completion scheduler attribute
whose value is equal to the scheduler that produced the schedule sender<a class='hidden_link' href='#async.ops-12.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-13'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L353'>#</a></div><div class='texpara'><div id='async.ops-13.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:completion_signature' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion_signature'><i >completion signature</i></span></a> is a function type
that describes a completion operation<a class='hidden_link' href='#async.ops-13.sentence-1'>.</a></div> <div id='async.ops-13.sentence-2' class='sentence'>An asynchronous operation has a finite set of possible completion signatures
corresponding to the completion operations
that the asynchronous operation potentially evaluates (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)<a class='hidden_link' href='#async.ops-13.sentence-2'>.</a></div> <div id='async.ops-13.sentence-3' class='sentence'>For a completion function <span class='texttt'>set</span>,
receiver <span class='texttt'>rcvr</span>, and
pack of arguments <span class='texttt'>args</span>,
let <span class='texttt'>c</span> be the completion operation <span class='texttt'>set<span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>F</span> be
the function type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>set<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#async.ops-13.sentence-3'>.</a></div> <div id='async.ops-13.sentence-4' class='sentence'>A completion signature <span class='texttt'>Sig</span> is associated with <span class='texttt'>c</span>
if and only if
<span class='texttt'><span class='texttt'><i >MATCHING-SIG</i></span><span class='parenthesis'>(</span>Sig, F<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span> (<a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#async.ops-13.sentence-4'>.</a></div> <div id='async.ops-13.sentence-5' class='sentence'>Together, a sender type and an environment type <span class='texttt'>Env</span> determine
the set of completion signatures of an asynchronous operation
that results from connecting the sender with a receiver
that has an environment of type <span class='texttt'>Env</span><a class='hidden_link' href='#async.ops-13.sentence-5'>.</a></div> <div id='async.ops-13.sentence-6' class='sentence'>The type of the receiver does not affect
an asynchronous operation's completion signatures,
only the type of the receiver's environment<a class='hidden_link' href='#async.ops-13.sentence-6'>.</a></div></div></div><div class='para' id='async.ops-14'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L376'>#</a></div><div class='texpara'><div id='async.ops-14.sentence-1' class='sentence'>A sender algorithm is a function that takes and/or returns a sender<a class='hidden_link' href='#async.ops-14.sentence-1'>.</a></div> <div id='async.ops-14.sentence-2' class='sentence'>There are three categories of sender algorithms:
<ul class='itemize'><li id='async.ops-14.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.1'>(14.1)</a></div><div class='texpara'><div id='async.ops-14.1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_factory' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_factory'><i >sender factory</i></span></a> is a function
that takes non-senders as arguments and that returns a sender<a class='hidden_link' href='#async.ops-14.1.sentence-1'>.</a></div></div></li><li id='async.ops-14.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.2'>(14.2)</a></div><div class='texpara'><div id='async.ops-14.2.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_adaptor'><i >sender adaptor</i></span></a> is a function
that constructs and returns a parent sender
from a set of one or more child senders and
a (possibly empty) set of additional arguments<a class='hidden_link' href='#async.ops-14.2.sentence-1'>.</a></div> <div id='async.ops-14.2.sentence-2' class='sentence'>An asynchronous operation created by a parent sender is
a parent operation to the child operations created by the child senders<a class='hidden_link' href='#async.ops-14.2.sentence-2'>.</a></div></div></li><li id='async.ops-14.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.3'>(14.3)</a></div><div class='texpara'><div id='async.ops-14.3.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_consumer' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_consumer'><i >sender consumer</i></span></a> is a function
that takes one or more senders and
a (possibly empty) set of additional arguments, and
whose return type is not the type of a sender<a class='hidden_link' href='#async.ops-14.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='execution.syn' class='section'><h2 ><a class='secnum' href='#execution.syn' style='min-width:65pt'>33.4</a> Header <span class='texttt'>&lt;execution&gt;</span> synopsis <a class='abbr_ref' href='execution.syn'>[execution.syn]</a></h2><div class='texpara'><span id='header:<execution>'><div class='marginalizedparent'><a class='itemDeclLink' href='#header:%3cexecution%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='execpol.type' title='26.3.6.2&emsp;Execution policy type trait'>[execpol.<span class='shy'></span>type]</a>, execution policy type trait</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> is_execution_policy;                 <span class='comment'>// freestanding</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> <span id='lib:is_execution_policy_v'><a class='hidden_link' href='#lib:is_execution_policy_v' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>is_execution_policy_v</a></span> <span class='operator'>=</span>      <span class='comment'>// freestanding</span>
      is_execution_policy<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>::</span>value;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='execpol.seq' title='26.3.6.3&emsp;Sequenced execution policy'>[execpol.<span class='shy'></span>seq]</a>, sequenced execution policy</span>
  <span class='keyword'>class</span> sequenced_policy;

  <span class='comment'>// <a href='execpol.par' title='26.3.6.4&emsp;Parallel execution policy'>[execpol.<span class='shy'></span>par]</a>, parallel execution policy</span>
  <span class='keyword'>class</span> parallel_policy;

  <span class='comment'>// <a href='execpol.parunseq' title='26.3.6.5&emsp;Parallel and unsequenced execution policy'>[execpol.<span class='shy'></span>parunseq]</a>, parallel and unsequenced execution policy</span>
  <span class='keyword'>class</span> parallel_unsequenced_policy;

  <span class='comment'>// <a href='execpol.unseq' title='26.3.6.6&emsp;Unsequenced execution policy'>[execpol.<span class='shy'></span>unseq]</a>, unsequenced execution policy</span>
  <span class='keyword'>class</span> unsequenced_policy;

  <span class='comment'>// <a href='execpol.objects' title='26.3.6.7&emsp;Execution policy objects'>[execpol.<span class='shy'></span>objects]</a>, execution policy objects</span>
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sequenced_policy            seq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> parallel_policy             par<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> parallel_unsequenced_policy par_unseq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> unsequenced_policy          unseq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>, helper concepts</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='index' id='conceptref:movable-value'></a><i >movable-value</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                          <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> From, <span class='keyword'>class</span> To<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <i >decays-to</i><a class='index' id='concept:decays-to'></a> <span class='operator'>=</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>From<span class='anglebracket'>&gt;</span>, To<span class='anglebracket'>&gt;</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <i >class-type</i><a class='index' id='concept:class-type'></a> <span class='operator'>=</span> <a class='index' id='conceptref:decays-to'></a><i >decays-to</i><span class='anglebracket'>&lt;</span>T, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> is_class_v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>, queryable objects</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='index' id='conceptref:queryable__'></a><i >queryable</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                              <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#queries' title='33.5&emsp;Queries'>[exec.<span class='shy'></span>queries]</a>, queries</span>
  <span class='keyword'>struct</span> <span id='lib:forwarding_query_t'><a class='hidden_link' href='#lib:forwarding_query_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>forwarding_query_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_allocator_t'><a class='hidden_link' href='#lib:get_allocator_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_allocator_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_stop_token_t'><a class='hidden_link' href='#lib:get_stop_token_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_stop_token_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> forwarding_query_t <span id='lib:forwarding_query'><a class='hidden_link' href='#lib:forwarding_query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>forwarding_query</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_allocator_t <span id='lib:get_allocator'><a class='hidden_link' href='#lib:get_allocator' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_allocator</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_stop_token_t <span id='lib:get_stop_token'><a class='hidden_link' href='#lib:get_stop_token' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_stop_token</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> stop_token_of_t <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_stop_token<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <i >forwarding-query</i><a class='index' id='concept:forwarding-query'></a> <span class='operator'>=</span> forwarding_query<span class='parenthesis'>(</span>T<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;           <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#queries' title='33.5&emsp;Queries'>[exec.<span class='shy'></span>queries]</a>, queries</span>
  <span class='keyword'>struct</span> <span id='lib:get_domain_t'><a class='hidden_link' href='#lib:get_domain_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_domain_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_scheduler_t'><a class='hidden_link' href='#lib:get_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_delegation_scheduler_t'><a class='hidden_link' href='#lib:get_delegation_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_delegation_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_forward_progress_guarantee_t'><a class='hidden_link' href='#lib:get_forward_progress_guarantee_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_forward_progress_guarantee_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:get_completion_scheduler_t'><a class='hidden_link' href='#lib:get_completion_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_completion_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_domain_t <span id='lib:get_domain'><a class='hidden_link' href='#lib:get_domain' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_domain</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_scheduler_t <span id='lib:get_scheduler'><a class='hidden_link' href='#lib:get_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_delegation_scheduler_t <span id='lib:get_delegation_scheduler'><a class='hidden_link' href='#lib:get_delegation_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_delegation_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>enum</span> <span class='keyword'>class</span> forward_progress_guarantee;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_forward_progress_guarantee_t <span id='lib:get_forward_progress_guarantee'><a class='hidden_link' href='#lib:get_forward_progress_guarantee' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_forward_progress_guarantee</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> get_completion_scheduler_t<span class='anglebracket'>&lt;</span>CPO<span class='anglebracket'>&gt;</span> <span id='lib:get_completion_scheduler'><a class='hidden_link' href='#lib:get_completion_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_completion_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <span id='lib:get_env_t'><a class='hidden_link' href='#lib:get_env_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_env_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_env_t <span id='lib:get_env'><a class='hidden_link' href='#lib:get_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_env</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:env_of_t'><a class='hidden_link' href='#lib:env_of_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>env_of_t</a></span> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#prop' title='33.11.1&emsp;Class template prop'>[exec.<span class='shy'></span>prop]</a>, class template <span class='tcode_in_codeblock'>prop</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> prop;

  <span class='comment'>// <a href='#env' title='33.11.2&emsp;Class template env'>[exec.<span class='shy'></span>env]</a>, class template <span class='tcode_in_codeblock'>env</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> env;

  <span class='comment'>// <a href='#domain.default' title='33.9.5&emsp;execution&#x200b;::&#x200b;default_&shy;domain'>[exec.<span class='shy'></span>domain.<span class='shy'></span>default]</a>, execution domains</span>
  <span class='keyword'>struct</span> default_domain;

  <span class='comment'>// <a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a>, schedulers</span>
  <span class='keyword'>struct</span> <span id='lib:scheduler_t'><a class='hidden_link' href='#lib:scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>scheduler_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='tcode_in_codeblock'>scheduler</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='comment'>// <a href='#recv' title='33.7&emsp;Receivers'>[exec.<span class='shy'></span>recv]</a>, receivers</span>
  <span class='keyword'>struct</span> <span id='lib:receiver_t'><a class='hidden_link' href='#lib:receiver_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>receiver_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver'><span class='tcode_in_codeblock'>receiver</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <span id='lib:set_value_t'><a class='hidden_link' href='#lib:set_value_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_value_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:set_error_t'><a class='hidden_link' href='#lib:set_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:set_stopped_t'><a class='hidden_link' href='#lib:set_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_value_t <span id='lib:set_value'><a class='hidden_link' href='#lib:set_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_value</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_error_t <span id='lib:set_error'><a class='hidden_link' href='#lib:set_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_stopped_t <span id='lib:set_stopped'><a class='hidden_link' href='#lib:set_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#opstate' title='33.8&emsp;Operation states'>[exec.<span class='shy'></span>opstate]</a>, operation states</span>
  <span class='keyword'>struct</span> <span id='lib:operation_state_t'><a class='hidden_link' href='#lib:operation_state_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>operation_state_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> O<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state'><span class='tcode_in_codeblock'>operation_<span class='shy'></span>state</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <span id='lib:start_t'><a class='hidden_link' href='#lib:start_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>start_t</a></span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> start_t <span id='lib:start'><a class='hidden_link' href='#lib:start' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>start</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a>, senders</span>
  <span class='keyword'>struct</span> <span id='lib:sender_t'><a class='hidden_link' href='#lib:sender_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sender_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >type-list</i>;                                           <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#getcomplsigs' title='33.9.9&emsp;execution&#x200b;::&#x200b;get_&shy;completion_&shy;signatures'>[exec.<span class='shy'></span>getcomplsigs]</a>, completion signatures</span>
  <span class='keyword'>struct</span> get_completion_signatures_t;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_completion_signatures_t get_completion_signatures <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> completion_signatures_of_t <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>get_completion_signatures_t, Sndr, Env<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >decayed-tuple</i> <span class='operator'>=</span> tuple<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >variant-or-empty</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                         <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple <span class='operator'>=</span> <i >decayed-tuple</i>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> value_types_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> error_types_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> sends_stopped <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >single-sender-value-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                 <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>; <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> tag_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='comment'>// <a href='#snd.transform' title='33.9.6&emsp;execution&#x200b;::&#x200b;transform_&shy;sender'>[exec.<span class='shy'></span>snd.<span class='shy'></span>transform]</a>, sender transformations</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>
      Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#snd.transform.env' title='33.9.7&emsp;execution&#x200b;::&#x200b;transform_&shy;env'>[exec.<span class='shy'></span>snd.<span class='shy'></span>transform.<span class='shy'></span>env]</a>, environment transformations</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>
      Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='comment'>// <a href='#snd.apply' title='33.9.8&emsp;execution&#x200b;::&#x200b;apply_&shy;sender'>[exec.<span class='shy'></span>snd.<span class='shy'></span>apply]</a>, sender algorithm application</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>
      Domain dom, Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#connect' title='33.9.10&emsp;execution&#x200b;::&#x200b;connect'>[exec.<span class='shy'></span>connect]</a>, the connect sender algorithm</span>
  <span class='keyword'>struct</span> <span id='lib:connect_t'><a class='hidden_link' href='#lib:connect_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect_t</a></span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> connect_t <span id='lib:connect'><a class='hidden_link' href='#lib:connect' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:connect_result_t'><a class='hidden_link' href='#lib:connect_result_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect_result_t</a></span> <span class='operator'>=</span>
      <span class='keyword'>decltype</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#factories' title='33.9.11&emsp;Sender factories'>[exec.<span class='shy'></span>factories]</a>, sender factories</span>
  <span class='keyword'>struct</span> <span id='lib:just_t'><a class='hidden_link' href='#lib:just_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:just_error_t'><a class='hidden_link' href='#lib:just_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:just_stopped_t'><a class='hidden_link' href='#lib:just_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:schedule_t'><a class='hidden_link' href='#lib:schedule_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_t <span id='lib:just'><a class='hidden_link' href='#lib:just' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_error_t <span id='lib:just_error'><a class='hidden_link' href='#lib:just_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_stopped_t <span id='lib:just_stopped'><a class='hidden_link' href='#lib:just_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> schedule_t <span id='lib:schedule'><a class='hidden_link' href='#lib:schedule' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> <i ><span class='texttt'>unspecified</span></i> <span id='lib:read_env'><a class='hidden_link' href='#lib:read_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>read_env</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_'><span class='tcode_in_codeblock'>scheduler</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:schedule_result_t'><a class='hidden_link' href='#lib:schedule_result_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_result_t</a></span> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a>, sender adaptors</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> D<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:sender_adaptor_closure'><a class='hidden_link' href='#lib:sender_adaptor_closure' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sender_adaptor_closure</a></span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <span id='lib:starts_on_t'><a class='hidden_link' href='#lib:starts_on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>starts_on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:continues_on_t'><a class='hidden_link' href='#lib:continues_on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>continues_on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:on_t'><a class='hidden_link' href='#lib:on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:schedule_from_t'><a class='hidden_link' href='#lib:schedule_from_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_from_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:then_t'><a class='hidden_link' href='#lib:then_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>then_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:upon_error_t'><a class='hidden_link' href='#lib:upon_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:upon_stopped_t'><a class='hidden_link' href='#lib:upon_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_value_t'><a class='hidden_link' href='#lib:let_value_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_value_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_error_t'><a class='hidden_link' href='#lib:let_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_stopped_t'><a class='hidden_link' href='#lib:let_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:bulk_t'><a class='hidden_link' href='#lib:bulk_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:split_t'><a class='hidden_link' href='#lib:split_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>split_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:when_all_t'><a class='hidden_link' href='#lib:when_all_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:when_all_with_variant_t'><a class='hidden_link' href='#lib:when_all_with_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_with_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:into_variant_t'><a class='hidden_link' href='#lib:into_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>into_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:stopped_as_optional_t'><a class='hidden_link' href='#lib:stopped_as_optional_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_optional_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:stopped_as_error_t'><a class='hidden_link' href='#lib:stopped_as_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> starts_on_t <span id='lib:starts_on'><a class='hidden_link' href='#lib:starts_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>starts_on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> continues_on_t <span id='lib:continues_on'><a class='hidden_link' href='#lib:continues_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>continues_on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> on_t <span id='lib:on'><a class='hidden_link' href='#lib:on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> schedule_from_t <span id='lib:schedule_from'><a class='hidden_link' href='#lib:schedule_from' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_from</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> then_t <span id='lib:then'><a class='hidden_link' href='#lib:then' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>then</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> upon_error_t <span id='lib:upon_error'><a class='hidden_link' href='#lib:upon_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> upon_stopped_t <span id='lib:upon_stopped'><a class='hidden_link' href='#lib:upon_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_value_t <span id='lib:let_value'><a class='hidden_link' href='#lib:let_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_value</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_error_t <span id='lib:let_error'><a class='hidden_link' href='#lib:let_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_stopped_t <span id='lib:let_stopped'><a class='hidden_link' href='#lib:let_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> bulk_t <span id='lib:bulk'><a class='hidden_link' href='#lib:bulk' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> split_t <span id='lib:split'><a class='hidden_link' href='#lib:split' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>split</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> when_all_t <span id='lib:when_all'><a class='hidden_link' href='#lib:when_all' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> when_all_with_variant_t <span id='lib:when_all_with_variant'><a class='hidden_link' href='#lib:when_all_with_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_with_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> into_variant_t <span id='lib:into_variant'><a class='hidden_link' href='#lib:into_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>into_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> stopped_as_optional_t <span id='lib:stopped_as_optional'><a class='hidden_link' href='#lib:stopped_as_optional' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_optional</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> stopped_as_error_t <span id='lib:stopped_as_error'><a class='hidden_link' href='#lib:stopped_as_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#util' title='33.10&emsp;Sender/receiver utilities'>[exec.<span class='shy'></span>util]</a>, sender and receiver utilities</span>
  <span class='comment'>// <a href='#util.cmplsig' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures'>[exec.<span class='shy'></span>util.<span class='shy'></span>cmplsig]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='index' id='conceptref:completion-signature'></a><i >completion-signature</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:completion-signature' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures&emsp;[exec.util.cmplsig]'><span id='conceptref:completion-signature_'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Fns<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:completion_signatures'><a class='hidden_link' href='#lib:completion_signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>completion_signatures</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sigs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='index' id='conceptref:valid-completion-signatures'></a><i >valid-completion-signatures</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;            <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#util.cmplsig.trans' title='33.10.2&emsp;execution&#x200b;::&#x200b;transform_&shy;completion_&shy;signatures'>[exec.<span class='shy'></span>util.<span class='shy'></span>cmplsig.<span class='shy'></span>trans]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>
    <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> InputSignatures,
    <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures__'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> AdditionalSignatures <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetValue <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>,
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetError <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>,
    <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures___'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> SetStopped <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span>set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> transform_completion_signatures <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>
    <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr,
    <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
    <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures____'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> AdditionalSignatures <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetValue <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>,
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetError <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>,
    <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_____'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> SetStopped <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span>set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> transform_completion_signatures_of <span class='operator'>=</span>
    transform_completion_signatures<span class='anglebracket'>&lt;</span>
      completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
      AdditionalSignatures, SetValue, SetError, SetStopped<span class='anglebracket'>&gt;</span>;

  <span class='comment'>// <a href='#run.loop' title='33.12.1&emsp;execution&#x200b;::&#x200b;run_&shy;loop'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop]</a>, run_loop</span>
  <span class='keyword'>class</span> run_loop;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#consumers' title='33.9.13&emsp;Sender consumers'>[exec.<span class='shy'></span>consumers]</a>, consumers</span>
  <span class='keyword'>struct</span> <span id='lib:sync_wait_t'><a class='hidden_link' href='#lib:sync_wait_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:sync_wait_with_variant_t'><a class='hidden_link' href='#lib:sync_wait_with_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_with_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sync_wait_t <span id='lib:sync_wait'><a class='hidden_link' href='#lib:sync_wait' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sync_wait_with_variant_t <span id='lib:sync_wait_with_variant'><a class='hidden_link' href='#lib:sync_wait_with_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_with_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#as.awaitable' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable'>[exec.<span class='shy'></span>as.<span class='shy'></span>awaitable]</a></span>
  <span class='keyword'>struct</span> <span id='lib:as_awaitable_t'><a class='hidden_link' href='#lib:as_awaitable_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>as_awaitable_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> as_awaitable_t <span id='lib:as_awaitable'><a class='hidden_link' href='#lib:as_awaitable' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>as_awaitable</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#with.awaitable.senders' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders'>[exec.<span class='shy'></span>with.<span class='shy'></span>awaitable.<span class='shy'></span>senders]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type_'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> with_awaitable_senders;
<span class='curlybracket'>}</span>
</span></span></div><div class='para' id='execution.syn-1'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L714'>#</a></div><div class='texpara'><div id='execution.syn-1.sentence-1' class='sentence'>The exposition-only type <span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
is defined as follows:
<ul class='itemize'><li id='execution.syn-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-1.1'>(1.1)</a></div>If <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Ts<span class='parenthesis'>)</span></span> is greater than zero,
<span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> denotes <span class='texttt'>variant<span class='anglebracket'>&lt;</span>Us<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
where <span class='texttt'>Us<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> is the pack <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
with duplicate types removed.</li><li id='execution.syn-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-1.2'>(1.2)</a></div>Otherwise, <span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> denotes
the exposition-only class type:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >empty-variant</i> <span class='curlybracket'>{</span>        <span class='comment'>// <i >exposition only</i></span>
    <i >empty-variant</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></li></ul></div></div></div><div class='para' id='execution.syn-2'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L735'>#</a></div><div class='texpara'><div id='execution.syn-2.sentence-1' class='sentence'>For types <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span>,
<span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is an alias for:
<ul class='itemize'><li id='execution.syn-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.1'>(2.1)</a></div><span class='texttt'>value_<span class='shy'></span>types_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env, decay_<span class='shy'></span>t, type_<span class='shy'></span>identity_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
if that type is well-formed,</li><li id='execution.syn-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.2'>(2.2)</a></div>Otherwise, <span class='texttt'><span class='keyword'>void</span></span>
if <span class='texttt'>value_<span class='shy'></span>types_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env, tuple, variant<span class='anglebracket'>&gt;</span></span> is
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> or <span class='texttt'>variant<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span>,</li><li id='execution.syn-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.3'>(2.3)</a></div>Otherwise, <span class='texttt'>value_<span class='shy'></span>types_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env, <span class='texttt'><i >decayed-tuple</i></span>, type_<span class='shy'></span>identity_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
if that type is well-formed,</li><li id='execution.syn-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.4'>(2.4)</a></div>Otherwise, <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is ill-formed<a class='hidden_link' href='#execution.syn-2.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='execution.syn-3'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L753'>#</a></div><div class='texpara'><div id='execution.syn-3.sentence-1' class='sentence'>The exposition-only concept <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender_'><span class='texttt'><i >single-sender</i></span></span></a> is defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:single-sender'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='curlybracket'>{</span>
        <span class='keyword'>typename</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='queries' class='section'><h2 ><a class='secnum' href='#queries' style='min-width:65pt'>33.5</a> Queries <a class='abbr_ref' href='exec.queries'>[exec.queries]</a></h2><div id='fwd.env' class='section'><h3 ><a class='secnum' href='#fwd.env' style='min-width:80pt'>33.5.1</a> <span class='texttt'>forwarding_<span class='shy'></span>query</span> <a class='abbr_ref' href='exec.fwd.env'>[exec.fwd.env]</a></h3><div class='para' id='fwd.env-1'><div class='marginalizedparent'><a class='marginalized' href='#fwd.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L769'>#</a></div><div class='texpara'><div id='fwd.env-1.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query</span> asks a query object
whether it should be forwarded through queryable adaptors<a class='hidden_link' href='#fwd.env-1.sentence-1'>.</a></div></div></div><div class='para' id='fwd.env-2'><div class='marginalizedparent'><a class='marginalized' href='#fwd.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L773'>#</a></div><div class='texpara'><div id='fwd.env-2.sentence-1' class='sentence'>The name <span class='texttt'>forwarding_<span class='shy'></span>query</span> denotes a query object<a class='hidden_link' href='#fwd.env-2.sentence-1'>.</a></div> <div id='fwd.env-2.sentence-2' class='sentence'>For some query object <span class='texttt'>q</span> of type <span class='texttt'>Q</span>,
<span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='fwd.env-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.1'>(2.1)</a></div><div class='texpara'><div id='fwd.env-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>q<span class='operator'>.</span>query<span class='parenthesis'>(</span>forwarding_<span class='shy'></span>query<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#fwd.env-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='fwd.env-2.1.sentence-2' class='sentence'><i >Mandates</i>: The expression above has type <span class='texttt'><span class='keyword'>bool</span></span> and
is a core constant expression if <span class='texttt'>q</span> is a core constant expression<a class='hidden_link' href='#fwd.env-2.1.sentence-2'>.</a></div></div></li><li id='fwd.env-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.2'>(2.2)</a></div><div class='texpara'><div id='fwd.env-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='literal'>true</span></span> if <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>Q, forwarding_<span class='shy'></span>query_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#fwd.env-2.2.sentence-1'>.</a></div></div></li><li id='fwd.env-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.3'>(2.3)</a></div><div class='texpara'><div id='fwd.env-2.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#fwd.env-2.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='get.allocator' class='section'><h3 ><a class='secnum' href='#get.allocator' style='min-width:80pt'>33.5.2</a> <span class='texttt'>get_<span class='shy'></span>allocator</span> <a class='abbr_ref' href='exec.get.allocator'>[exec.get.allocator]</a></h3><div class='para' id='get.allocator-1'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L793'>#</a></div><div class='texpara'><div id='get.allocator-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>allocator</span> asks a queryable object for its associated allocator<a class='hidden_link' href='#get.allocator-1.sentence-1'>.</a></div></div></div><div class='para' id='get.allocator-2'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L796'>#</a></div><div class='texpara'><div id='get.allocator-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>allocator</span> denotes a query object<a class='hidden_link' href='#get.allocator-2.sentence-1'>.</a></div> <div id='get.allocator-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.allocator-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.allocator-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies
<a href='allocator.requirements.general#concept:simple-allocator' title='16.4.4.6.1&emsp;General&emsp;[allocator.requirements.general]'><span id='conceptref:simple-allocator'><span class='texttt'><i >simple-allocator</i></span></span></a> (<a href='allocator.requirements.general' title='16.4.4.6.1&emsp;General'>[allocator.<span class='shy'></span>requirements.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#get.allocator-2.sentence-3'>.</a></div></div></div><div class='para' id='get.allocator-3'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L807'>#</a></div><div class='texpara'><div id='get.allocator-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator<span class='parenthesis'>)</span></span> is a core constant expression and
has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.allocator-3.sentence-1'>.</a></div></div></div></div><div id='get.stop.token' class='section'><h3 ><a class='secnum' href='#get.stop.token' style='min-width:80pt'>33.5.3</a> <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> <a class='abbr_ref' href='exec.get.stop.token'>[exec.get.stop.token]</a></h3><div class='para' id='get.stop.token-1'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L813'>#</a></div><div class='texpara'><div id='get.stop.token-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> asks a queryable object for an associated stop token<a class='hidden_link' href='#get.stop.token-1.sentence-1'>.</a></div></div></div><div class='para' id='get.stop.token-2'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L816'>#</a></div><div class='texpara'><div id='get.stop.token-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> denotes a query object<a class='hidden_link' href='#get.stop.token-2.sentence-1'>.</a></div> <div id='get.stop.token-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.stop.token-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.stop.token-2.1'>(2.1)</a></div><div class='texpara'><div id='get.stop.token-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#get.stop.token-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.stop.token-2.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a><a class='hidden_link' href='#get.stop.token-2.1.sentence-2'>.</a></div></div></li><li id='get.stop.token-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.stop.token-2.2'>(2.2)</a></div><div class='texpara'><div id='get.stop.token-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token<span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#get.stop.token-2.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.stop.token-3'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L832'>#</a></div><div class='texpara'><div id='get.stop.token-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> is a core constant expression and
has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.stop.token-3.sentence-1'>.</a></div></div></div></div><div id='get.env' class='section'><h3 ><a class='secnum' href='#get.env' style='min-width:80pt'>33.5.4</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.get.env'>[exec.get.env]</a></h3><div class='para' id='get.env-1'><div class='marginalizedparent'><a class='marginalized' href='#get.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L838'>#</a></div><div class='texpara'><div id='get.env-1.sentence-1' class='sentence'><span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#get.env-1.sentence-1'>.</a></div> <div id='get.env-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>o</span>,
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.env-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.env-1.1'>(1.1)</a></div><div class='texpara'><div id='get.env-1.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>o<span class='parenthesis'>)</span><span class='operator'>.</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#get.env-1.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.env-1.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies
<a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______'><span class='texttt'><i >queryable</i></span></span></a> (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)<a class='hidden_link' href='#get.env-1.1.sentence-2'>.</a></div></div></li><li id='get.env-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.env-1.2'>(1.2)</a></div><div class='texpara'><div id='get.env-1.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#get.env-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.env-2'><div class='marginalizedparent'><a class='marginalized' href='#get.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L854'>#</a></div><div class='texpara'><div id='get.env-2.sentence-1' class='sentence'>The value of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span></span> shall be valid while <span class='texttt'>o</span> is valid<a class='hidden_link' href='#get.env-2.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='get.env-3'><div class='marginalizedparent'><a class='marginalized' href='#get.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L857'>#</a></div><div class='texpara'><div id='get.env-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#get.env-note-1'>1</a></i>:&ensp;<div id='get.env-3.sentence-1' class='sentence'>When passed a sender object,
<span class='texttt'>get_<span class='shy'></span>env</span> returns the sender's associated attributes<a class='hidden_link' href='#get.env-3.sentence-1'>.</a></div> <div id='get.env-3.sentence-2' class='sentence'>When passed a receiver,
<span class='texttt'>get_<span class='shy'></span>env</span> returns the receiver's associated execution environment<a class='hidden_link' href='#get.env-3.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='get.domain' class='section'><h3 ><a class='secnum' href='#get.domain' style='min-width:80pt'>33.5.5</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>domain</span> <a class='abbr_ref' href='exec.get.domain'>[exec.get.domain]</a></h3><div class='para' id='get.domain-1'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L867'>#</a></div><div class='texpara'><div id='get.domain-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>domain</span> asks a queryable object
for its associated execution domain tag<a class='hidden_link' href='#get.domain-1.sentence-1'>.</a></div></div></div><div class='para' id='get.domain-2'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L871'>#</a></div><div class='texpara'><div id='get.domain-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>domain</span> denotes a query object<a class='hidden_link' href='#get.domain-2.sentence-1'>.</a></div> <div id='get.domain-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.domain-2.sentence-2'>.</a></div></div></div><div class='para' id='get.domain-3'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L877'>#</a></div><div class='texpara'><div id='get.domain-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.domain-3.sentence-1'>.</a></div></div></div></div><div id='get.scheduler' class='section'><h3 ><a class='secnum' href='#get.scheduler' style='min-width:80pt'>33.5.6</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.scheduler'>[exec.get.scheduler]</a></h3><div class='para' id='get.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L883'>#</a></div><div class='texpara'><div id='get.scheduler-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>scheduler</span> asks a queryable object for its associated scheduler<a class='hidden_link' href='#get.scheduler-1.sentence-1'>.</a></div></div></div><div class='para' id='get.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L886'>#</a></div><div class='texpara'><div id='get.scheduler-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>scheduler</span> denotes a query object<a class='hidden_link' href='#get.scheduler-2.sentence-1'>.</a></div> <div id='get.scheduler-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.scheduler-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.scheduler-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.scheduler-2.sentence-3'>.</a></div></div></div><div class='para' id='get.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L896'>#</a></div><div class='texpara'><div id='get.scheduler-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.scheduler-3.sentence-1'>.</a></div></div></div></div><div id='get.delegation.scheduler' class='section'><h3 ><a class='secnum' href='#get.delegation.scheduler' style='min-width:80pt'>33.5.7</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.delegation.scheduler'>[exec.get.delegation.scheduler]</a></h3><div class='para' id='get.delegation.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L902'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> asks a queryable object for a scheduler
that can be used to delegate work to
for the purpose of forward progress delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)<a class='hidden_link' href='#get.delegation.scheduler-1.sentence-1'>.</a></div></div></div><div class='para' id='get.delegation.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L907'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> denotes a query object<a class='hidden_link' href='#get.delegation.scheduler-2.sentence-1'>.</a></div> <div id='get.delegation.scheduler-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.delegation.scheduler-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.delegation.scheduler-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.delegation.scheduler-2.sentence-3'>.</a></div></div></div><div class='para' id='get.delegation.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L917'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.delegation.scheduler-3.sentence-1'>.</a></div></div></div></div><div id='get.fwd.progress' class='section'><h3 ><a class='secnum' href='#get.fwd.progress' style='min-width:80pt'>33.5.8</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> <a class='abbr_ref' href='exec.get.fwd.progress'>[exec.get.fwd.progress]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>enum</span> <span class='keyword'>class</span> <span id='lib:forward_progress_guarantee'><a class='hidden_link' href='#lib:forward_progress_guarantee' title='33.5.8&emsp;execution&#x200b;::&#x200b;get_&shy;forward_&shy;progress_&shy;guarantee&emsp;[exec.get.fwd.progress]'>forward_progress_guarantee</a></span> <span class='curlybracket'>{</span>
    concurrent,
    parallel,
    weakly_parallel
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='get.fwd.progress-1'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L933'>#</a></div><div class='texpara'><div id='get.fwd.progress-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> asks a scheduler about
the forward progress guarantee of execution agents
created by that scheduler's associated execution resource (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)<a class='hidden_link' href='#get.fwd.progress-1.sentence-1'>.</a></div></div></div><div class='para' id='get.fwd.progress-2'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L938'>#</a></div><div class='texpara'><div id='get.fwd.progress-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> denotes a query object<a class='hidden_link' href='#get.fwd.progress-2.sentence-1'>.</a></div> <div id='get.fwd.progress-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sch</span>, let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.fwd.progress-2.sentence-2'>.</a></div> <div id='get.fwd.progress-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____'><span class='texttt'>scheduler</span></span></a>,
<span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> is ill-formed<a class='hidden_link' href='#get.fwd.progress-2.sentence-3'>.</a></div> <div id='get.fwd.progress-2.sentence-4' class='sentence'>Otherwise,
<span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.fwd.progress-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.fwd.progress-2.1'>(2.1)</a></div><div class='texpara'><div id='get.fwd.progress-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
if that expression is well-formed<a class='hidden_link' href='#get.fwd.progress-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.fwd.progress-2.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above is <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span><a class='hidden_link' href='#get.fwd.progress-2.1.sentence-2'>.</a></div></div></li><li id='get.fwd.progress-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.fwd.progress-2.2'>(2.2)</a></div><div class='texpara'><div id='get.fwd.progress-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>weakly_<span class='shy'></span>parallel</span><a class='hidden_link' href='#get.fwd.progress-2.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.fwd.progress-3'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L956'>#</a></div><div class='texpara'><div id='get.fwd.progress-3.sentence-1' class='sentence'>If <span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> for some scheduler <span class='texttt'>sch</span>
returns <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>concurrent</span>,
all execution agents created by that scheduler's associated execution resource
shall provide the concurrent forward progress guarantee<a class='hidden_link' href='#get.fwd.progress-3.sentence-1'>.</a></div> <div id='get.fwd.progress-3.sentence-2' class='sentence'>If it returns <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>parallel</span>,
all such execution agents
shall provide at least the parallel forward progress guarantee<a class='hidden_link' href='#get.fwd.progress-3.sentence-2'>.</a></div></div></div></div><div id='get.compl.sched' class='section'><h3 ><a class='secnum' href='#get.compl.sched' style='min-width:80pt'>33.5.9</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.compl.sched'>[exec.get.compl.sched]</a></h3><div class='para' id='get.compl.sched-1'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L967'>#</a></div><div class='texpara'><div id='get.compl.sched-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag&gt;</i></span></span> obtains
the completion scheduler associated with a completion tag
from a sender's attributes<a class='hidden_link' href='#get.compl.sched-1.sentence-1'>.</a></div></div></div><div class='para' id='get.compl.sched-2'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L972'>#</a></div><div class='texpara'><div id='get.compl.sched-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span> denotes a query object template<a class='hidden_link' href='#get.compl.sched-2.sentence-1'>.</a></div> <div id='get.compl.sched-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>q</span>,
the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>
is ill-formed if <span class='texttt'><i >completion-tag</i></span> is not one of
<span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span>, <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t</span>, or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#get.compl.sched-2.sentence-2'>.</a></div> <div id='get.compl.sched-2.sentence-3' class='sentence'>Otherwise, <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>
is expression-equivalent to
<span class='codeblock'><i >MANDATE-NOTHROW</i><span class='parenthesis'>(</span><i >AS-CONST</i><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_completion_scheduler<span class='anglebracket'>&lt;</span><i >completion-tag</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.compl.sched-2.sentence-3'>.</a></div></div></div><div class='para' id='get.compl.sched-3'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L987'>#</a></div><div class='texpara'><div id='get.compl.sched-3.sentence-1' class='sentence'>Let <span class='texttt'><i >completion-fn</i></span> be a completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>);
let <span class='texttt'><i >completion-tag</i></span> be
the associated completion tag of <span class='texttt'><i >completion-fn</i></span>;
let <span class='texttt'>args</span> be a pack of subexpressions; and
let <span class='texttt'>sndr</span> be a subexpression
such that <span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span> and
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is well-formed and denotes a scheduler <span class='texttt'>sch</span><a class='hidden_link' href='#get.compl.sched-3.sentence-1'>.</a></div> <div id='get.compl.sched-3.sentence-2' class='sentence'>If an asynchronous operation
created by connecting <span class='texttt'>sndr</span> with a receiver <span class='texttt'>rcvr</span>
causes the evaluation of <span class='texttt'><span class='texttt'><i >completion-fn</i></span><span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
the behavior is undefined
unless the evaluation happens on an execution agent
that belongs to <span class='texttt'>sch</span>'s associated execution resource<a class='hidden_link' href='#get.compl.sched-3.sentence-2'>.</a></div></div></div><div class='para' id='get.compl.sched-4'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1003'>#</a></div><div class='texpara'><div id='get.compl.sched-4.sentence-1' class='sentence'>The expression
<span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span>
is a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.compl.sched-4.sentence-1'>.</a></div></div></div></div></div><div id='sched' class='section'><h2 ><a class='secnum' href='#sched' style='min-width:65pt'>33.6</a> Schedulers <a class='abbr_ref' href='exec.sched'>[exec.sched]</a></h2><div class='para' id='sched-1'><div class='marginalizedparent'><a class='marginalized' href='#sched-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1010'>#</a></div><div class='texpara'><div id='sched-1.sentence-1' class='sentence'>The <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______'><span class='texttt'>scheduler</span></span></a> concept defines
the requirements of a scheduler type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#sched-1.sentence-1'>.</a></div> <div id='sched-1.sentence-2' class='sentence'><span class='texttt'>schedule</span> is a customization point object
that accepts a scheduler<a class='hidden_link' href='#sched-1.sentence-2'>.</a></div> <div id='sched-1.sentence-3' class='sentence'>A valid invocation of <span class='texttt'>schedule</span> is a schedule-expression<a class='hidden_link' href='#sched-1.sentence-3'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='concept:scheduler'><span id='lib:scheduler'><span class='tcode_in_codeblock'>scheduler</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='operator'>::</span>scheduler_concept, scheduler_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span>Sch<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sch<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> schedule<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________'><span class='tcode_in_codeblock'>sender</span></span></a>;
        <span class='curlybracket'>{</span> <span class='keyword'>auto</span><span class='parenthesis'>(</span>get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
            get_env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>
              <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable'><span class='tcode_in_codeblock'>equality_<span class='shy'></span>comparable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable'><span class='tcode_in_codeblock'>copyable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='sched-2'><div class='marginalizedparent'><a class='marginalized' href='#sched-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1033'>#</a></div><div class='texpara'><div id='sched-2.sentence-1' class='sentence'>Let <span class='texttt'>Sch</span> be the type of a scheduler and
let <span class='texttt'>Env</span> be the type of an execution environment
for which <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>, Env<span class='anglebracket'>&gt;</span></span>
is satisfied<a class='hidden_link' href='#sched-2.sentence-1'>.</a></div> <div id='sched-2.sentence-2' class='sentence'>Then <span class='texttt'><a href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of'><span class='texttt'><i >sender-in-of</i></span></span></a><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>, Env<span class='anglebracket'>&gt;</span></span>
shall be modeled<a class='hidden_link' href='#sched-2.sentence-2'>.</a></div></div></div><div class='para' id='sched-3'><div class='marginalizedparent'><a class='marginalized' href='#sched-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1041'>#</a></div><div class='texpara'><div id='sched-3.sentence-1' class='sentence'>No operation required by
<span class='texttt'><a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable_'><span class='texttt'>copyable</span></span></a><span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> and
<span class='texttt'><a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable_'><span class='texttt'>equality_<span class='shy'></span>comparable</span></span></a><span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
shall exit via an exception<a class='hidden_link' href='#sched-3.sentence-1'>.</a></div> <div id='sched-3.sentence-2' class='sentence'>None of these operations,
nor a scheduler type's <span class='texttt'>schedule</span> function,
shall introduce data races
as a result of potentially concurrent (<a href='intro.races' title='6.9.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>) invocations
of those operations from different threads<a class='hidden_link' href='#sched-3.sentence-2'>.</a></div></div></div><div class='para' id='sched-4'><div class='marginalizedparent'><a class='marginalized' href='#sched-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1052'>#</a></div><div class='texpara'><div id='sched-4.sentence-1' class='sentence'>For any two values <span class='texttt'>sch1</span> and <span class='texttt'>sch2</span>
of some scheduler type <span class='texttt'>Sch</span>,
<span class='texttt'>sch1 <span class='operator'>=</span><span class='operator'>=</span> sch2</span> shall return <span class='texttt'><span class='literal'>true</span></span>
only if both <span class='texttt'>sch1</span> and <span class='texttt'>sch2</span> share
the same associated execution resource<a class='hidden_link' href='#sched-4.sentence-1'>.</a></div></div></div><div class='para' id='sched-5'><div class='marginalizedparent'><a class='marginalized' href='#sched-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1059'>#</a></div><div class='texpara'><div id='sched-5.sentence-1' class='sentence'>For a given scheduler expression <span class='texttt'>sch</span>,
the expression
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
shall compare equal to <span class='texttt'>sch</span><a class='hidden_link' href='#sched-5.sentence-1'>.</a></div></div></div><div class='para' id='sched-6'><div class='marginalizedparent'><a class='marginalized' href='#sched-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1065'>#</a></div><div class='texpara'><div id='sched-6.sentence-1' class='sentence'>For a given scheduler expression <span class='texttt'>sch</span>,
if the expression <span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is well-formed,
then the expression <span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is also well-formed and has the same type<a class='hidden_link' href='#sched-6.sentence-1'>.</a></div></div></div><div class='para' id='sched-7'><div class='marginalizedparent'><a class='marginalized' href='#sched-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1071'>#</a></div><div class='texpara'><div id='sched-7.sentence-1' class='sentence'>A scheduler type's destructor shall not block
pending completion of any receivers
connected to the sender objects returned from <span class='texttt'>schedule</span><a class='hidden_link' href='#sched-7.sentence-1'>.</a></div> <div id='sched-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sched-note-1'>1</a></i>:&ensp;<div id='sched-7.sentence-2' class='sentence'>The ability to wait for completion of submitted function objects
can be provided by the associated execution resource of the scheduler<a class='hidden_link' href='#sched-7.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='recv' class='section'><h2 ><a class='secnum' href='#recv' style='min-width:65pt'>33.7</a> Receivers <a class='abbr_ref' href='exec.recv'>[exec.recv]</a></h2><div id='recv.concepts' class='section'><h3 ><a class='secnum' href='#recv.concepts' style='min-width:80pt'>33.7.1</a> Receiver concepts <a class='abbr_ref' href='exec.recv.concepts'>[exec.recv.concepts]</a></h3><div class='para' id='recv.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1084'>#</a></div><div class='texpara'><div id='recv.concepts-1.sentence-1' class='sentence'>A receiver represents the continuation of an asynchronous operation<a class='hidden_link' href='#recv.concepts-1.sentence-1'>.</a></div> <div id='recv.concepts-1.sentence-2' class='sentence'>The <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_'><span class='texttt'>receiver</span></span></a> concept defines
the requirements for a receiver type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#recv.concepts-1.sentence-2'>.</a></div> <div id='recv.concepts-1.sentence-3' class='sentence'>The <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of_'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a> concept defines
the requirements for a receiver type that is usable as
the first argument of a set of completion operations
corresponding to a set of completion signatures<a class='hidden_link' href='#recv.concepts-1.sentence-3'>.</a></div> <div id='recv.concepts-1.sentence-4' class='sentence'>The <span class='texttt'>get_<span class='shy'></span>env</span> customization point object is used to access
a receiver's associated environment<a class='hidden_link' href='#recv.concepts-1.sentence-4'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:receiver'><span id='lib:receiver'><span class='tcode_in_codeblock'>receiver</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from__'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>::</span>receiver_concept, receiver_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span><span class='keyword'>const</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible_'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>       <span class='comment'>// rvalues are movable, and</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, Rcvr<span class='anglebracket'>&gt;</span>;   <span class='comment'>// lvalues are copyable</span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Signature, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:valid-completion-for' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:valid-completion-for'><span class='tcode_in_codeblock'><i >valid-completion-for</i></span></span></a> <span class='operator'>=</span>                 <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Signature<span class='operator'>*</span> sig<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
            <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>Tag, remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
        <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>(</span>sig<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-completions' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:has-completions'><span class='tcode_in_codeblock'><i >has-completions</i></span></span></a> <span class='operator'>=</span>                      <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Completions<span class='operator'>*</span> completions<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><a href='#concept:valid-completion-for' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:valid-completion-for'><span class='tcode_in_codeblock'><i >valid-completion-for</i></span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>Sigs<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>completion_signatures<span class='anglebracket'>&lt;</span>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>*</span><span class='parenthesis'>)</span>
        <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>(</span>completions<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:receiver_of'><span id='lib:receiver_of'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver__'><span class='tcode_in_codeblock'>receiver</span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:has-completions' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:has-completions'><span class='tcode_in_codeblock'><i >has-completions</i></span></span></a><span class='anglebracket'>&lt;</span>Rcvr, Completions<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='recv.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1126'>#</a></div><div class='texpara'><div id='recv.concepts-2.sentence-1' class='sentence'>Class types that are marked <span class='texttt'><span class='keyword'>final</span></span> do not model the <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver___'><span class='texttt'>receiver</span></span></a> concept<a class='hidden_link' href='#recv.concepts-2.sentence-1'>.</a></div></div></div><div class='para' id='recv.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1129'>#</a></div><div class='texpara'><div id='recv.concepts-3.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver and
let <span class='texttt'>op_<span class='shy'></span>state</span> be an operation state associated with
an asynchronous operation created by connecting <span class='texttt'>rcvr</span> with a sender<a class='hidden_link' href='#recv.concepts-3.sentence-1'>.</a></div> <div id='recv.concepts-3.sentence-2' class='sentence'>Let <span class='texttt'>token</span> be a stop token equal to
<span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#recv.concepts-3.sentence-2'>.</a></div> <div id='recv.concepts-3.sentence-3' class='sentence'><span class='texttt'>token</span> shall remain valid
for the duration of the asynchronous operation's lifetime (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#recv.concepts-3.sentence-3'>.</a></div> <div id='recv.concepts-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#recv.concepts-note-1'>1</a></i>:&ensp;<div id='recv.concepts-3.sentence-4' class='sentence'>This means that, unless it knows about further guarantees
provided by the type of <span class='texttt'>rcvr</span>,
the implementation of <span class='texttt'>op_<span class='shy'></span>state</span> cannot use <span class='texttt'>token</span>
after it executes a completion operation<a class='hidden_link' href='#recv.concepts-3.sentence-4'>.</a></div> <div id='recv.concepts-3.sentence-5' class='sentence'>This also implies that any stop callbacks registered on token
must be destroyed before the invocation of the completion operation<a class='hidden_link' href='#recv.concepts-3.sentence-5'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='set.value' class='section'><h3 ><a class='secnum' href='#set.value' style='min-width:80pt'>33.7.2</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>value</span> <a class='abbr_ref' href='exec.set.value'>[exec.set.value]</a></h3><div class='para' id='set.value-1'><div class='marginalizedparent'><a class='marginalized' href='#set.value-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1148'>#</a></div><div class='texpara'><div id='set.value-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>value</span> is a value completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.value-1.sentence-1'>.</a></div> <div id='set.value-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span><a class='hidden_link' href='#set.value-1.sentence-2'>.</a></div> <div id='set.value-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
for a subexpression <span class='texttt'>rcvr</span> and
pack of subexpressions <span class='texttt'>vs</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.value-1.sentence-3'>.</a></div> <div id='set.value-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span>vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.value-1.sentence-4'>.</a></div></div></div></div><div id='set.error' class='section'><h3 ><a class='secnum' href='#set.error' style='min-width:80pt'>33.7.3</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.set.error'>[exec.set.error]</a></h3><div class='para' id='set.error-1'><div class='marginalizedparent'><a class='marginalized' href='#set.error-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1160'>#</a></div><div class='texpara'><div id='set.error-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>error</span> is an error completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.error-1.sentence-1'>.</a></div> <div id='set.error-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t</span><a class='hidden_link' href='#set.error-1.sentence-2'>.</a></div> <div id='set.error-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, err<span class='parenthesis'>)</span></span>
for some <span class='texttt'>subexpressions</span> <span class='texttt'>rcvr</span> and <span class='texttt'>err</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.error-1.sentence-3'>.</a></div> <div id='set.error-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.error-1.sentence-4'>.</a></div></div></div></div><div id='set.stopped' class='section'><h3 ><a class='secnum' href='#set.stopped' style='min-width:80pt'>33.7.4</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.set.stopped'>[exec.set.stopped]</a></h3><div class='para' id='set.stopped-1'><div class='marginalizedparent'><a class='marginalized' href='#set.stopped-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1171'>#</a></div><div class='texpara'><div id='set.stopped-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>stopped</span> is a stopped completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.stopped-1.sentence-1'>.</a></div> <div id='set.stopped-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#set.stopped-1.sentence-2'>.</a></div> <div id='set.stopped-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>
for a subexpression <span class='texttt'>rcvr</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.stopped-1.sentence-3'>.</a></div> <div id='set.stopped-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.stopped-1.sentence-4'>.</a></div></div></div></div></div><div id='opstate' class='section'><h2 ><a class='secnum' href='#opstate' style='min-width:65pt'>33.8</a> Operation states <a class='abbr_ref' href='exec.opstate'>[exec.opstate]</a></h2><div id='opstate.general' class='section'><h3 ><a class='secnum' href='#opstate.general' style='min-width:80pt'>33.8.1</a> General <a class='abbr_ref' href='exec.opstate.general'>[exec.opstate.general]</a></h3><div class='para' id='opstate.general-1'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1184'>#</a></div><div class='texpara'><div id='opstate.general-1.sentence-1' class='sentence'>The <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state_'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> concept defines
the requirements of an operation state type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#opstate.general-1.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> O<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='concept:operation_state'><span id='lib:operation_state'><span class='tcode_in_codeblock'>operation_<span class='shy'></span>state</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from___'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> O<span class='operator'>::</span>operation_state_concept, operation_state_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      is_object_v<span class='anglebracket'>&lt;</span>O<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>O<span class='operator'>&amp;</span> o<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> start<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='opstate.general-2'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1199'>#</a></div><div class='texpara'><div id='opstate.general-2.sentence-1' class='sentence'>If an <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state__'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> object is destroyed
during the lifetime of its asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>),
the behavior is undefined<a class='hidden_link' href='#opstate.general-2.sentence-1'>.</a></div> <div id='opstate.general-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#opstate.general-note-1'>1</a></i>:&ensp;<div id='opstate.general-2.sentence-2' class='sentence'>The <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state___'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> concept does not impose requirements
on any operations other than destruction and <span class='texttt'>start</span>,
including copy and move operations<a class='hidden_link' href='#opstate.general-2.sentence-2'>.</a></div> <div id='opstate.general-2.sentence-3' class='sentence'>Invoking any such operation on an object
whose type models <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state____'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> can lead to undefined behavior<a class='hidden_link' href='#opstate.general-2.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='opstate.general-3'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1211'>#</a></div><div class='texpara'><div id='opstate.general-3.sentence-1' class='sentence'>The program is ill-formed
if it performs a copy or move construction or assignment operation on
an operation state object created by connecting a library-provided sender<a class='hidden_link' href='#opstate.general-3.sentence-1'>.</a></div></div></div></div><div id='opstate.start' class='section'><h3 ><a class='secnum' href='#opstate.start' style='min-width:80pt'>33.8.2</a> <span class='texttt'>execution&#x200b;::&#x200b;start</span> <a class='abbr_ref' href='exec.opstate.start'>[exec.opstate.start]</a></h3><div class='para' id='opstate.start-1'><div class='marginalizedparent'><a class='marginalized' href='#opstate.start-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1218'>#</a></div><div class='texpara'><div id='opstate.start-1.sentence-1' class='sentence'>The name <span class='texttt'>start</span> denotes a customization point object
that starts (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the asynchronous operation associated with the operation state object<a class='hidden_link' href='#opstate.start-1.sentence-1'>.</a></div> <div id='opstate.start-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>op</span>,
the expression <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> is ill-formed
if <span class='texttt'>op</span> is an rvalue<a class='hidden_link' href='#opstate.start-1.sentence-2'>.</a></div> <div id='opstate.start-1.sentence-3' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>op<span class='operator'>.</span>start<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#opstate.start-1.sentence-3'>.</a></div></div></div><div class='para' id='opstate.start-2'><div class='marginalizedparent'><a class='marginalized' href='#opstate.start-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1228'>#</a></div><div class='texpara'><div id='opstate.start-2.sentence-1' class='sentence'>If <span class='texttt'>op<span class='operator'>.</span>start<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> does not start (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the asynchronous operation associated with the operation state <span class='texttt'>op</span>,
the behavior of calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> is undefined<a class='hidden_link' href='#opstate.start-2.sentence-1'>.</a></div></div></div></div></div><div id='snd' class='section'><h2 ><a class='secnum' href='#snd' style='min-width:65pt'>33.9</a> Senders <a class='abbr_ref' href='exec.snd'>[exec.snd]</a></h2><div id='snd.general' class='section'><h3 ><a class='secnum' href='#snd.general' style='min-width:80pt'>33.9.1</a> General <a class='abbr_ref' href='exec.snd.general'>[exec.snd.general]</a></h3><div class='para' id='snd.general-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1237'>#</a></div><div class='texpara'><div id='snd.general-1.sentence-1' class='sentence'>Subclauses <a href='#factories' title='33.9.11&emsp;Sender factories'>[exec.<span class='shy'></span>factories]</a> and <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> define
customizable algorithms that return senders<a class='hidden_link' href='#snd.general-1.sentence-1'>.</a></div> <div id='snd.general-1.sentence-2' class='sentence'>Each algorithm has a default implementation<a class='hidden_link' href='#snd.general-1.sentence-2'>.</a></div> <div id='snd.general-1.sentence-3' class='sentence'>Let <span class='texttt'>sndr</span> be the result of an invocation of such an algorithm or
an object equal to the result (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>), and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.general-1.sentence-3'>.</a></div> <div id='snd.general-1.sentence-4' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver of type <span class='texttt'>Rcvr</span>
with associated environment <span class='texttt'>env</span> of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to_'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#snd.general-1.sentence-4'>.</a></div> <div id='snd.general-1.sentence-5' class='sentence'>For the default implementation of the algorithm that produced <span class='texttt'>sndr</span>,
connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
necessarily results in the potential evaluation (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>) of
a set of completion operations
whose first argument is a subexpression equal to <span class='texttt'>rcvr</span><a class='hidden_link' href='#snd.general-1.sentence-5'>.</a></div> <div id='snd.general-1.sentence-6' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of completion signatures corresponding to
this set of completion operations<a class='hidden_link' href='#snd.general-1.sentence-6'>.</a></div> <div id='snd.general-1.sentence-7' class='sentence'>Then the type of the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is
a specialization of
the class template <span class='texttt'>completion_<span class='shy'></span>signatures</span> (<a href='#util.cmplsig' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures'>[exec.<span class='shy'></span>util.<span class='shy'></span>cmplsig]</a>),
the set of whose template arguments is <span class='texttt'>Sigs</span><a class='hidden_link' href='#snd.general-1.sentence-7'>.</a></div> <div id='snd.general-1.sentence-8' class='sentence'>If a user-provided implementation of the algorithm
that produced <span class='texttt'>sndr</span> is selected instead of the default,
any completion signature
that is in the set of types
denoted by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> and
that is not part of <span class='texttt'>Sigs</span> shall correspond to
error or stopped completion operations,
unless otherwise specified<a class='hidden_link' href='#snd.general-1.sentence-8'>.</a></div></div></div></div><div id='snd.expos' class='section'><h3 ><a class='secnum' href='#snd.expos' style='min-width:80pt'>33.9.2</a> Exposition-only entities <a class='abbr_ref' href='exec.snd.expos'>[exec.snd.expos]</a></h3><div class='para' id='snd.expos-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1270'>#</a></div><div class='texpara'><div id='snd.expos-1.sentence-1' class='sentence'>Subclause <a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a> makes use of the following exposition-only entities<a class='hidden_link' href='#snd.expos-1.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1273'>#</a></div><div class='texpara'><div id='snd.expos-2.sentence-1' class='sentence'>For a queryable object <span class='texttt'>env</span>,
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is an expression
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________'><span class='texttt'><i >queryable</i></span></span></a>
such that for a query object <span class='texttt'>q</span> and
a pack of subexpressions <span class='texttt'>as</span>,
the expression <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed
if <span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>;
otherwise, it is expression-equivalent to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-2.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1283'>#</a></div><div class='texpara'><div id='snd.expos-3.sentence-1' class='sentence'>For a query object <span class='texttt'>q</span> and <span class='texttt'>a</span> subexpression <span class='texttt'>v</span>,
<span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>q, v<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________'><span class='texttt'><i >queryable</i></span></span></a>
such that the result of <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> has
a value equal to <span class='texttt'>v</span> (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)<a class='hidden_link' href='#snd.expos-3.sentence-1'>.</a></div> <div id='snd.expos-3.sentence-2' class='sentence'>Unless otherwise stated,
the object to which <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> refers remains valid
while <span class='texttt'>env</span> remains valid<a class='hidden_link' href='#snd.expos-3.sentence-2'>.</a></div></div></div><div class='para' id='snd.expos-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1293'>#</a></div><div class='texpara'><div id='snd.expos-4.sentence-1' class='sentence'>For two queryable objects <span class='texttt'>env1</span> and <span class='texttt'>env2</span>,
a query object <span class='texttt'>q</span>, and
a pack of subexpressions <span class='texttt'>as</span>,
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>env1, env2<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env3</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='snd.expos-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.1'>(4.1)</a></div><span class='texttt'>env1<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='snd.expos-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.2'>(4.2)</a></div>otherwise, <span class='texttt'>env2<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='snd.expos-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.3'>(4.3)</a></div>otherwise, <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#snd.expos-4.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='snd.expos-5'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1309'>#</a></div><div class='texpara'><div id='snd.expos-5.sentence-1' class='sentence'>The results of <span class='texttt'><i >FWD-ENV</i></span>, <span class='texttt'><i >MAKE-ENV</i></span>, and <span class='texttt'><i >JOIN-ENV</i></span>
can be context-dependent;
i.e., they can evaluate to expressions
with different types and value categories
in different contexts for the same arguments<a class='hidden_link' href='#snd.expos-5.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-6'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1316'>#</a></div><div class='texpara'><div id='snd.expos-6.sentence-1' class='sentence'>For a scheduler <span class='texttt'>sch</span>,
<span class='texttt'><span class='texttt'><i >SCHED-ATTRS</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o1</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span> is
an expression with the same type and value as <span class='texttt'>sch</span>
where <span class='texttt'>Tag</span> is one of <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span>, and
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-6.sentence-1'>.</a></div> <div id='snd.expos-6.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o2</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is a prvalue
with the same type and value as <span class='texttt'>sch</span>, and
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-6.sentence-2'>.</a></div></div></div><div class='para' id='snd.expos-7'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1332'>#</a></div><div class='texpara'><div id='snd.expos-7.sentence-1' class='sentence'>For two subexpressions <span class='texttt'>rcvr</span> and <span class='texttt'>expr</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='parenthesis'>(</span>expr, set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if the type of <span class='texttt'>expr</span> is <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-7.sentence-1'>.</a></div> <div id='snd.expos-7.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-EVAL</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  expr;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if <span class='texttt'>expr</span> is potentially-throwing; otherwise, <span class='texttt'>expr</span><a class='hidden_link' href='#snd.expos-7.sentence-2'>.</a></div> <div id='snd.expos-7.sentence-3' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is
<span class='codeblock'><i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >SET-VALUE</i><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>rcvr</span> is evaluated only once<a class='hidden_link' href='#snd.expos-7.sentence-3'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Default <span class='operator'>=</span> default_domain, <span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-8'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1359'>#</a></div><div class='texpara'><div id='snd.expos-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> is the type of the expression
<span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-8.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-9'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1363'>#</a></div><div class='texpara'><div id='snd.expos-9.sentence-1' class='sentence'><i >Effects</i>: If all of the types
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>)</span></span>,
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>)</span></span>, and<br/><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>)</span></span> are ill-formed,
<span class='texttt'>completion<span class='operator'>-</span>domain<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of type <span class='texttt'>Default</span><a class='hidden_link' href='#snd.expos-9.sentence-1'>.</a></div> <div id='snd.expos-9.sentence-2' class='sentence'>Otherwise, if they all share a common type (<a href='meta.trans.other' title='21.3.8.7&emsp;Other transformations'>[meta.<span class='shy'></span>trans.<span class='shy'></span>other]</a>)
(ignoring those types that are ill-formed),
then <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of that type<a class='hidden_link' href='#snd.expos-9.sentence-2'>.</a></div> <div id='snd.expos-9.sentence-3' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#snd.expos-9.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Env, <span class='keyword'>class</span> Default<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >query-with-default</i></span><span class='parenthesis'>(</span>
    Tag, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env, Default<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='snd.expos-10'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1385'>#</a></div><div class='texpara'><div id='snd.expos-10.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression <span class='texttt'>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span>
if that expression is well-formed;
otherwise, it is <span class='texttt'><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-10.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-11'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1390'>#</a></div><div class='texpara'><div id='snd.expos-11.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#snd.expos-11.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-12'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1394'>#</a></div><div class='texpara'><div id='snd.expos-12.sentence-1' class='sentence'><i >Remarks</i>: The expression in the noexcept clause is <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-12.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-13'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1405'>#</a></div><div class='texpara'><div id='snd.expos-13.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is
the decayed type of the first of the following expressions that is well-formed:
<ul class='itemize'><li id='snd.expos-13.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.1'>(13.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-13.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.2'>(13.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='snd.expos-13.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.3'>(13.3)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-late</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-14'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1426'>#</a></div><div class='texpara'><div id='snd.expos-14.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<ul class='itemize'><li id='snd.expos-14.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-14.1'>(14.1)</a></div>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>, then
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the type of the following expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
<div id='snd.expos-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-1'>1</a></i>:&ensp;<div id='snd.expos-14.1.sentence-1' class='sentence'>The <span class='texttt'>continues_<span class='shy'></span>on</span> algorithm works
in tandem with <span class='texttt'>schedule_<span class='shy'></span>from</span> (<a href='#schedule.from' title='33.9.12.5&emsp;execution&#x200b;::&#x200b;schedule_&shy;from'>[exec.<span class='shy'></span>schedule.<span class='shy'></span>from]</a>)
to give scheduler authors a way to customize both
how to transition onto (<span class='texttt'>continues_<span class='shy'></span>on</span>) and off of (<span class='texttt'>schedule_<span class='shy'></span>from</span>)
a given execution context<a class='hidden_link' href='#snd.expos-14.1.sentence-1'>.</a></div> <div id='snd.expos-14.1.sentence-2' class='sentence'>Thus, <span class='texttt'>continues_<span class='shy'></span>on</span> ignores the domain of the predecessor and
uses the domain of the destination scheduler to select a customization,
a property that is unique to <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#snd.expos-14.1.sentence-2'>.</a></div> <div id='snd.expos-14.1.sentence-3' class='sentence'>That is why it is given special treatment here<a class='hidden_link' href='#snd.expos-14.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></li><li id='snd.expos-14.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-14.2'>(14.2)</a></div>Otherwise,
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the first of the following expressions
that is well-formed and whose type is not <span class='texttt'><span class='keyword'>void</span></span>:
<ul class='itemize'><li id='snd.expos-14.2.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.1'>(14.2.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.2'>(14.2.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.3'>(14.2.3)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.4'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.4'>(14.2.4)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.5'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.5'>(14.2.5)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></li></ul></div></div></div></div><div class='para' id='snd.expos-15'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1470'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_'><span class='tcode_in_codeblock'><i >callable</i></span></span></a> Fun<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >emplace-from</i> <span class='curlybracket'>{</span>
  Fun <i >fun</i>;                                                      <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> type <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> type<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>

  <span class='keyword'>constexpr</span> type <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable_'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
<div id='snd.expos-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-2'>2</a></i>:&ensp;<div id='snd.expos-15.sentence-1' class='sentence'><span class='texttt'><i >emplace-from</i></span> is used to emplace non-movable types
into <span class='texttt'>tuple</span>, <span class='texttt'>optional</span>, <span class='texttt'>variant</span>, and similar types<a class='hidden_link' href='#snd.expos-15.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='snd.expos-16'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1492'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>struct</span> <i >on-stop-request</i> <span class='curlybracket'>{</span>
  inplace_stop_source<span class='operator'>&amp;</span> <i >stop-src</i>;       <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >stop-src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='snd.expos-17'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1500'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >product-type</i> <span class='curlybracket'>{</span>       <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >get</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span>     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div><div class='para nonNormativeOnly' id='snd.expos-18'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1518'>#</a></div><div class='texpara'><div id='snd.expos-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-3'>3</a></i>:&ensp;<div id='snd.expos-18.sentence-1' class='sentence'><span class='texttt'><i >product-type</i></span> is presented here in pseudo-code form
for the sake of exposition<a class='hidden_link' href='#snd.expos-18.sentence-1'>.</a></div> <div id='snd.expos-18.sentence-2' class='sentence'>It can be approximated in standard C++ with a tuple-like implementation
that takes care to keep the type an aggregate
that can be used as the initializer of a structured binding declaration<a class='hidden_link' href='#snd.expos-18.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div> <div id='snd.expos-note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-4'>4</a></i>:&ensp;<div id='snd.expos-18.sentence-3' class='sentence'>An expression of type <span class='texttt'><i >product-type</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.7&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#snd.expos-18.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >get</i></span><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-19'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1537'>#</a></div><div class='texpara'><div id='snd.expos-19.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='squarebracket'>[</span>I<span class='squarebracket'>]</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</span></div><div class='para' id='snd.expos-20'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1552'>#</a></div><div class='texpara'><div id='snd.expos-20.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement below is well-formed<a class='hidden_link' href='#snd.expos-20.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-21'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1556'>#</a></div><div class='texpara'><div id='snd.expos-21.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='snd.expos-22'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1564'>#</a></div><div class='texpara'><div id='snd.expos-22.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement above is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#snd.expos-22.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>Tag tag, Data<span class='operator'>&amp;</span><span class='operator'>&amp;</span> data, Child<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='snd.expos-23'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1577'>#</a></div><div class='texpara'><div id='snd.expos-23.sentence-1' class='sentence'><i >Mandates</i>: The following expressions are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='snd.expos-23.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-23.1'>(23.1)</a></div><span class='texttt'><a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular'><span class='texttt'>semiregular</span></span></a><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span></span></li><li id='snd.expos-23.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-23.2'>(23.2)</a></div><span class='texttt'><a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span></span></li><li id='snd.expos-23.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-23.3'>(23.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span></li></ul></div></div></div></div><div class='para' id='snd.expos-24'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1586'>#</a></div><div class='texpara'><div id='snd.expos-24.sentence-1' class='sentence'><i >Returns</i>: A prvalue of
type <span class='texttt'><span class='texttt'><i >basic-sender</i></span><span class='anglebracket'>&lt;</span>Tag, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span>, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
that has been direct-list-initialized with the forwarded arguments,
where <span class='texttt'><i >basic-sender</i></span> is the following exposition-only class template except as noted below<a class='hidden_link' href='#snd.expos-24.sentence-1'>.</a></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:completion-tag' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:completion-tag'><span class='tcode_in_codeblock'><i >completion-tag</i></span></span></a> <span class='operator'>=</span>                                      <span class='comment'>// <i >exposition only</i></span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_error_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_stopped_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:valid-specialization'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a> <span class='operator'>=</span>                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> T<span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>; <span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <i >default-impls</i> <span class='curlybracket'>{</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                  <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;       <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                              <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >state-type</i> <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                 <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >env-type</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>)</span>, Index,
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, size_t I <span class='operator'>=</span> <span class='literal'>0</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >child-type</i> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='keyword'>template</span> <i >get</i><span class='anglebracket'>&lt;</span>I<span class='operator'>+</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> remove_reference_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >indices-for</i>;           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-state</i> <span class='curlybracket'>{</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <i >basic-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
      , <i >state</i><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>

    Rcvr <i >rcvr</i>;                                                  <span class='comment'>// <i >exposition only</i></span>
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Index<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >env-type</i>, Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-t</i> <span class='operator'>=</span> <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>;                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> <i >complete</i> <span class='operator'>=</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >tag-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >complete</i>;   <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable__'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_value_t, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable___'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_error_t, Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_error_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable____'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_stopped_t<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >env-type</i><span class='anglebracket'>&lt;</span>Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >op</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >connect-all</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                         <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >connect-all-result</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>)</span>, <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span>, Sndr, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization_'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >state-type</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
             <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization__'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >connect-all-result</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-operation</i> <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>

    <i >connect-all-result</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >inner-ops</i>;              <span class='comment'>// <i >exposition only</i></span>

    <i >basic-operation</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>  <span class='comment'>// <i >exposition only</i></span>
      <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >inner-ops</i><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
    <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ops<span class='squarebracket'>]</span> <span class='operator'>=</span> <i >inner-ops</i>;
      <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >start</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, <span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, ops<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >completion-signatures-for</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-sender</i> <span class='operator'>:</span> <i >product-type</i><span class='anglebracket'>&lt;</span>Tag, Data, Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
    <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> index_sequence_for<span class='anglebracket'>&lt;</span>Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='operator'>*</span><span class='keyword'>this</span>;
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-attrs</i><span class='parenthesis'>(</span>data, child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to_'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver____'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>auto</span> connect<span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Rcvr rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>self<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to__'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >completion-signatures-for</i><span class='anglebracket'>&lt;</span>Self, Env<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='snd.expos-25'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-25'>25</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1727'>#</a></div><div class='texpara'><div id='snd.expos-25.sentence-1' class='sentence'>The default template argument for the <span class='texttt'>Data</span> template parameter
denotes an unspecified empty trivially copyable class type
that models <a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular_'><span class='texttt'>semiregular</span></span></a><a class='hidden_link' href='#snd.expos-25.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-26'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-26'>26</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1732'>#</a></div><div class='texpara'><div id='snd.expos-26.sentence-1' class='sentence'>It is unspecified whether a specialization of <span class='texttt'><i >basic-sender</i></span>
is an aggregate<a class='hidden_link' href='#snd.expos-26.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-27'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-27'>27</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1736'>#</a></div><div class='texpara'><div id='snd.expos-27.sentence-1' class='sentence'>An expression of type <span class='texttt'><i >basic-sender</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.7&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#snd.expos-27.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-28'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-28'>28</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1740'>#</a></div><div class='texpara'><div id='snd.expos-28.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-state</i></span> is
<span class='codeblock'>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable__'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>, <i >get-state-result</i><span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span>
 is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>, <i >get-state-result</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
</span>
where <span class='texttt'><i >get-state-result</i></span> is
<span class='codeblock'><i >call-result-t</i><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span>
</span></div></div></div><div class='para' id='snd.expos-29'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-29'>29</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1754'>#</a></div><div class='texpara'><div id='snd.expos-29.sentence-1' class='sentence'>The object <span class='texttt'><i >connect-all</i></span> is initialized with
a callable object equivalent to the following lambda:</div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, size_t<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Is<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  <span class='texttt'><i >basic-state</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> op, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, index_sequence<span class='anglebracket'>&lt;</span>Is<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
    <span class='keyword'>return</span> <span class='texttt'><i >product-type</i></span><span class='curlybracket'>{</span>connect<span class='parenthesis'>(</span>
      std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
      <span class='texttt'><i >basic-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr, integral_constant<span class='anglebracket'>&lt;</span>size_t, Is<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>op<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
</code></div></div><div class='para' id='snd.expos-30'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-30'>30</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1769'>#</a></div><div class='texpara'><div id='snd.expos-30.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement is well-formed<a class='hidden_link' href='#snd.expos-30.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-31'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-31'>31</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1773'>#</a></div><div class='texpara'><div id='snd.expos-31.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#snd.expos-31.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-32'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-32'>32</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1780'>#</a></div><div class='texpara'><div id='snd.expos-32.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-operation</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-state</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='snd.expos-33'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-33'>33</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1788'>#</a></div><div class='texpara'><div id='snd.expos-33.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the <span class='texttt'>connect</span> member function of <span class='texttt'><i >basic-sender</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='snd.expos-34'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-34'>34</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1795'>#</a></div><div class='texpara'><div id='snd.expos-34.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span> <span class='parenthesis'>(</span><i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='keyword'>else</span>
    <span class='keyword'>return</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-35'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-35'>35</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1807'>#</a></div><div class='texpara'><div id='snd.expos-35.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-36'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-36'>36</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1816'>#</a></div><div class='texpara'><div id='snd.expos-36.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-37'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-37'>37</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1826'>#</a></div><div class='texpara'><div id='snd.expos-37.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='parenthesis'>(</span>execution<span class='operator'>::</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-38'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-38'>38</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1835'>#</a></div><div class='texpara'><div id='snd.expos-38.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  Index, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_____'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>Tag, Rcvr, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>static_assert</span><span class='parenthesis'>(</span>Index<span class='operator'>::</span>value <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span><span class='parenthesis'>)</span>;
  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-39'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-39'>39</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1847'>#</a></div><div class='texpara'><div id='snd.expos-39.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span> let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-39.sentence-1'>.</a></div> <div id='snd.expos-39.sentence-2' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver
with an associated environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#snd.expos-39.sentence-2'>.</a></div> <div id='snd.expos-39.sentence-3' class='sentence'><span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> denotes
a specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span>,
the set of whose template arguments correspond to
the set of completion operations that are potentially evaluated
as a result of starting (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the operation state that results from connecting <span class='texttt'>sndr</span> and <span class='texttt'>rcvr</span><a class='hidden_link' href='#snd.expos-39.sentence-3'>.</a></div> <div id='snd.expos-39.sentence-4' class='sentence'>When <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
the type denoted by <span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>,
if any, is not a specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span><a class='hidden_link' href='#snd.expos-39.sentence-4'>.</a></div></div><div class='texpara'><div id='snd.expos-39.sentence-5' class='sentence'><i >Recommended practice</i>: When <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
implementations are encouraged to use the type
denoted by <span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
to communicate to users why<a class='hidden_link' href='#snd.expos-39.sentence-5'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:8'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >write-env</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span>;     <span class='comment'>// <i >exposition only</i></span>
</code></div></div><div class='para' id='snd.expos-40'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-40'>40</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1874'>#</a></div><div class='texpara'><div id='snd.expos-40.sentence-1' class='sentence'><span class='texttt'><i >write-env</i></span> is an exposition-only sender adaptor that,
when connected with a receiver <span class='texttt'>rcvr</span>,
connects the adapted sender with a receiver
whose execution environment is the result of
joining the <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________'><span class='texttt'><i >queryable</i></span></span></a> argument <span class='texttt'>env</span>
to the result of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-40.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-41'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-41'>41</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1882'>#</a></div><div class='texpara'><div id='snd.expos-41.sentence-1' class='sentence'>Let <span class='texttt'><i >write-env-t</i></span> be an exposition-only empty class type<a class='hidden_link' href='#snd.expos-41.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-42'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-42'>42</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1885'>#</a></div><div class='texpara'><div id='snd.expos-42.sentence-1' class='sentence'><i >Returns</i>: <span class='codeblock'><i >make-sender</i><span class='parenthesis'>(</span><i >write-env-t</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.expos-43'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-43'>43</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1891'>#</a></div><div class='texpara'><div id='snd.expos-43.sentence-1' class='sentence'><i >Remarks</i>: The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >write-env-t</i></span> as follows:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >write-env-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>;
</span></div> <div id='snd.expos-43.sentence-2' class='sentence'>
Invocation of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='snd.expos-43.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-43.1'>(43.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________'><span class='texttt'><i >queryable</i></span></span></a> and</li><li id='snd.expos-43.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-43.2'>(43.2)</a></div>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>state<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid,
otherwise, <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-43.sentence-2'>.</a></li></ul></div></div></div></div></div><div id='snd.concepts' class='section'><h3 ><a class='secnum' href='#snd.concepts' style='min-width:80pt'>33.9.3</a> Sender concepts <a class='abbr_ref' href='exec.snd.concepts'>[exec.snd.concepts]</a></h3><div class='para' id='snd.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1921'>#</a></div><div class='texpara'><div id='snd.concepts-1.sentence-1' class='sentence'>The <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________'><span class='texttt'>sender</span></span></a> concept defines
the requirements for a sender type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#snd.concepts-1.sentence-1'>.</a></div> <div id='snd.concepts-1.sentence-2' class='sentence'>The <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a> concept defines
the requirements for a sender type
that can create asynchronous operations given an associated environment type<a class='hidden_link' href='#snd.concepts-1.sentence-2'>.</a></div> <div id='snd.concepts-1.sentence-3' class='sentence'>The <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to__'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a> concept defines
the requirements for a sender type
that can connect with a specific receiver type<a class='hidden_link' href='#snd.concepts-1.sentence-3'>.</a></div> <div id='snd.concepts-1.sentence-4' class='sentence'>The <span class='texttt'>get_<span class='shy'></span>env</span> customization point object is used to access
a sender's associated attributes<a class='hidden_link' href='#snd.concepts-1.sentence-4'>.</a></div> <div id='snd.concepts-1.sentence-5' class='sentence'>The connect customization point object is used to connect (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
a sender and a receiver to produce an operation state<a class='hidden_link' href='#snd.concepts-1.sentence-5'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sigs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures______'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;            <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from____'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> Sndr<span class='operator'>::</span>sender_concept, sender_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:enable-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:is-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span>
      <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;                 <span class='comment'>// <a href='#awaitable' title='33.9.4&emsp;Awaitable helpers'>[exec.<span class='shy'></span>awaitable]</a></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender'><span id='lib:sender'><span class='tcode_in_codeblock'>sender</span></span></span></a> <span class='operator'>=</span>
      <span class='keyword'>bool</span><span class='parenthesis'>(</span><a href='#concept:enable-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible__'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from__'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Sndr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_in'><span id='lib:sender_in'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_completion_signatures<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>
          <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_______'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_to'><span id='lib:sender_to'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of__'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>Rcvr, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='snd.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1977'>#</a></div><div class='texpara'><div id='snd.concepts-2.sentence-1' class='sentence'>Given a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>rcvr</span> be a receiver
with an associated environment whose type is <span class='texttt'>Env</span><a class='hidden_link' href='#snd.concepts-2.sentence-1'>.</a></div> <div id='snd.concepts-2.sentence-2' class='sentence'>A completion operation is a <a class='hidden_link' href='#def:completion,permissible' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='def:completion,permissible'><i >permissible completion</i></span></a>
for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span>
if its completion signature appears in the argument list of the specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span> denoted by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.concepts-2.sentence-2'>.</a></div> <div id='snd.concepts-2.sentence-3' class='sentence'><span class='texttt'>Sndr</span> and <span class='texttt'>Env</span> model <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
if all the completion operations
that are potentially evaluated by connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state
are permissible completions for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span><a class='hidden_link' href='#snd.concepts-2.sentence-3'>.</a></div></div></div><div class='para' id='snd.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1992'>#</a></div><div class='texpara'><div id='snd.concepts-3.sentence-1' class='sentence'>A type models
the exposition-only concept <a class='hidden_link' href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:valid-completion-signatures'><span class='texttt'><i >valid-completion-signatures</i></span></span></a>
if it denotes a specialization of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#snd.concepts-3.sentence-1'>.</a></div></div></div><div class='para' id='snd.concepts-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L1998'>#</a></div><div class='texpara'><div id='snd.concepts-4.sentence-1' class='sentence'>The exposition-only concepts
<a href='#concept:sender-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-of'><span class='texttt'><i >sender-of</i></span></span></a> and <a href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of_'><span class='texttt'><i >sender-in-of</i></span></span></a>
define the requirements for a sender type
that completes with a given unique set of value result types<a class='hidden_link' href='#snd.concepts-4.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >value-signature</i> <span class='operator'>=</span> set_value_t<span class='parenthesis'>(</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-in-of'><span class='tcode_in_codeblock'><i >sender-in-of</i></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <i >MATCHING-SIG</i><span class='parenthesis'>(</span>                     <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
        set_value_t<span class='parenthesis'>(</span>Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
        value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, Env, <i >value-signature</i>, type_identity_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-of'><span class='tcode_in_codeblock'><i >sender-of</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of__'><span class='tcode_in_codeblock'><i >sender-in-of</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>, Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='snd.concepts-5'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2020'>#</a></div><div class='texpara'><div id='snd.concepts-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Sndr</span><a class='hidden_link' href='#snd.concepts-5.sentence-1'>.</a></div> <div id='snd.concepts-5.sentence-2' class='sentence'>The type <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is as follows:
<ul class='itemize'><li id='snd.concepts-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-5.1'>(5.1)</a></div>If the declaration
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>children<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
</span>
would be well-formed, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is
an alias for <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>tag<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>.</li><li id='snd.concepts-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-5.2'>(5.2)</a></div>Otherwise, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is ill-formed.</li></ul></div></div></div><div class='para' id='snd.concepts-6'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2036'>#</a></div><div class='texpara'><div id='snd.concepts-6.sentence-1' class='sentence'>Let <a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_'><span class='texttt'><i >sender-for</i></span></span></a> be an exposition-only concept defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-for'><span class='tcode_in_codeblock'><i >sender-for</i></span></span></a> <span class='operator'>=</span>
    <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Tag<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.concepts-7'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2047'>#</a></div><div class='texpara'><div id='snd.concepts-7.sentence-1' class='sentence'>For a type <span class='texttt'>T</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE-SIG</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
if <span class='texttt'>T</span> is <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, it denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.concepts-7.sentence-1'>.</a></div></div></div><div class='para' id='snd.concepts-8'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2053'>#</a></div><div class='texpara'><div id='snd.concepts-8.sentence-1' class='sentence'>Library-provided sender types
<ul class='itemize'><li id='snd.concepts-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-8.1'>(8.1)</a></div>always expose an overload of a member <span class='texttt'>connect</span>
that accepts an rvalue sender and</li><li id='snd.concepts-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-8.2'>(8.2)</a></div>only expose an overload of a member <span class='texttt'>connect</span>
that accepts an lvalue sender if they model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a><a class='hidden_link' href='#snd.concepts-8.sentence-1'>.</a></li></ul></div></div></div></div><div id='awaitable' class='section'><h3 ><a class='secnum' href='#awaitable' style='min-width:80pt'>33.9.4</a> Awaitable helpers <a class='abbr_ref' href='exec.awaitable'>[exec.awaitable]</a></h3><div class='para' id='awaitable-1'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2066'>#</a></div><div class='texpara'><div id='awaitable-1.sentence-1' class='sentence'>The sender concepts recognize awaitables as senders<a class='hidden_link' href='#awaitable-1.sentence-1'>.</a></div> <div id='awaitable-1.sentence-2' class='sentence'>For [exec], an <a class='hidden_link' href='#def:awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='def:awaitable'><i >awaitable</i></span></a> is an expression
that would be well-formed as the operand of a <span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span></span> expression
within a given context<a class='hidden_link' href='#awaitable-1.sentence-2'>.</a></div></div></div><div class='para' id='awaitable-2'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2072'>#</a></div><div class='texpara'><div id='awaitable-2.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>,
let <span class='texttt'><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span></span> be expression-equivalent to
the series of transformations and conversions applied to <span class='texttt'>c</span>
as the operand of an <a href='expr.await#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression'><span class='textsf'><i >await-expression</i></span></span></a> in a coroutine,
resulting in lvalue <span class='texttt'>e</span> as described by <a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>,
where <span class='texttt'>p</span> is an lvalue referring to the coroutine's promise,
which has type <span class='texttt'>Promise</span><a class='hidden_link' href='#awaitable-2.sentence-1'>.</a></div> <div id='awaitable-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#awaitable-note-1'>1</a></i>:&ensp;<div id='awaitable-2.sentence-2' class='sentence'>This includes the invocation of
the promise type's <span class='texttt'>await_<span class='shy'></span>transform</span> member if any,
the invocation of the <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>co_<span class='shy'></span>await</span></span>
picked by overload resolution if any, and
any necessary implicit conversions and materializations<a class='hidden_link' href='#awaitable-2.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='awaitable-3'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2088'>#</a></div><div class='texpara'><div id='awaitable-3.sentence-1' class='sentence'>Let <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable_'><span class='texttt'><i >is-awaitable</i></span></span></a> be the following exposition-only concept:
<span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> A, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaiter' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a> <span class='operator'>=</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>A<span class='operator'>&amp;</span> a, coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      a<span class='operator'>.</span>await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>1</span> <span class='operator'>:</span> <span class='literal'>0</span>;
      <span class='curlybracket'>{</span> a<span class='operator'>.</span>await_suspend<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result_'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a>;
      a<span class='operator'>.</span>await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> C, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a> <span class='operator'>=</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>C <span class='parenthesis'>(</span><span class='operator'>*</span>fc<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='curlybracket'>{</span> <i >GET-AWAITER</i><span class='parenthesis'>(</span>fc<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, p<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaiter' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='awaitable-3.sentence-2' class='sentence'><span class='texttt'><a class='hidden_link' href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:await-suspend-result'><span class='texttt'><i >await-suspend-result</i></span></span></a><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
if and only if one of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='awaitable-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.1'>(3.1)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>void</span></span>, or</li><li id='awaitable-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.2'>(3.2)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>bool</span></span>, or</li><li id='awaitable-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.3'>(3.3)</a></div><span class='texttt'>T</span> is a specialization of <span class='texttt'>coroutine_<span class='shy'></span>handle</span><a class='hidden_link' href='#awaitable-3.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='awaitable-4'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2119'>#</a></div><div class='texpara'><div id='awaitable-4.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is type <span class='texttt'>C</span>, and
an lvalue <span class='texttt'>p</span> of type <span class='texttt'>Promise</span>,
<span class='texttt'><span class='texttt'><i >await-result-<br>type</i></span><span class='anglebracket'>&lt;</span>C, Promise<span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span><span class='operator'>.</span>await_<span class='shy'></span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#awaitable-4.sentence-1'>.</a></div></div></div><div class='para' id='awaitable-5'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2126'>#</a></div><div class='texpara'><div id='awaitable-5.sentence-1' class='sentence'>Let <span class='texttt'><i >with-await-transform</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-as-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a> <span class='operator'>=</span>                                  <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> t, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable__'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Derived<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >with-await-transform</i> <span class='curlybracket'>{</span>                               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
        T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:has-as-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Derived<span class='anglebracket'>&gt;</span> T<span class='anglebracket'>&gt;</span>
        <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>
          <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='awaitable-6'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2152'>#</a></div><div class='texpara'><div id='awaitable-6.sentence-2' class='sentence'>Let <span class='texttt'><i >env-promise</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >env-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span> <span class='comment'>// <i >exposition only</i></span>
    <i ><span class='texttt'>unspecified</span></i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span>
<div id='awaitable-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#awaitable-note-2'>2</a></i>:&ensp;<div id='awaitable-6.sentence-1' class='sentence'>Specializations of <span class='texttt'><i >env-promise</i></span> are used only for the purpose of type computation;
its members need not be defined<a class='hidden_link' href='#awaitable-6.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='domain.default' class='section'><h3 ><a class='secnum' href='#domain.default' style='min-width:80pt'>33.9.5</a> <span class='texttt'>execution&#x200b;::&#x200b;default_<span class='shy'></span>domain</span> <a class='abbr_ref' href='exec.domain.default'>[exec.domain.default]</a></h3><div class='para' id='domain.default-1'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2176'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <span id='lib:default_domain'><a class='hidden_link' href='#lib:default_domain' title='33.9.5&emsp;execution&#x200b;::&#x200b;default_&shy;domain&emsp;[exec.domain.default]'>default_domain</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
        <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='lib:default_domain,transform_sender'><div id='lib:transform_sender,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_sender,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
<span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='domain.default-2'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2204'>#</a></div><div class='texpara'><div id='domain.default-2.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-2.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-3'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2212'>#</a></div><div class='texpara'><div id='domain.default-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-3.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-4'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2216'>#</a></div><div class='texpara'><div id='domain.default-4.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:default_domain,transform_env'><div id='lib:transform_env,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_env,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='domain.default-5'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2228'>#</a></div><div class='texpara'><div id='domain.default-5.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-5.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-6'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2236'>#</a></div><div class='texpara'><div id='domain.default-6.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#domain.default-6.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-7'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2240'>#</a></div><div class='texpara'><div id='domain.default-7.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:default_domain,apply_sender'><div id='lib:apply_sender,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:apply_sender,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='domain.default-8'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2253'>#</a></div><div class='texpara'><div id='domain.default-8.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='domain.default-9'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2259'>#</a></div><div class='texpara'><div id='domain.default-9.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'>e</span> is a well-formed expression<a class='hidden_link' href='#domain.default-9.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-10'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2263'>#</a></div><div class='texpara'><div id='domain.default-10.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-10.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-11'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2267'>#</a></div><div class='texpara'><div id='domain.default-11.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-11.sentence-1'>.</a></div></div></div></div></div><div id='snd.transform' class='section'><h3 ><a class='secnum' href='#snd.transform' style='min-width:80pt'>33.9.6</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.transform'>[exec.snd.transform]</a></h3><div class='texpara'><div id='lib:transform_sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________________________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.transform-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2285'>#</a></div><div class='texpara'><div id='snd.transform-1.sentence-1' class='sentence'>Let <span class='texttt'><i >transformed-sndr</i></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div> <div id='snd.transform-1.sentence-2' class='sentence'>
Let <span class='texttt'><i >final-sndr</i></span> be the expression <span class='texttt'><i >transformed-sndr</i></span>
if <span class='texttt'><i >transformed-sndr</i></span> and <span class='texttt'><i >sndr</i></span>
have the same type ignoring cv-qualifiers;
otherwise, it is
the expression <span class='texttt'>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>dom, <span class='texttt'><i >transformed-sndr</i></span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.transform-1.sentence-2'>.</a></div></div></div></div><div class='para' id='snd.transform-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2300'>#</a></div><div class='texpara'><div id='snd.transform-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><i >final-sndr</i></span><a class='hidden_link' href='#snd.transform-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.transform-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2304'>#</a></div><div class='texpara'><div id='snd.transform-3.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to
<span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='texttt'><i >final-sndr</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.transform-3.sentence-1'>.</a></div></div></div></div></div><div id='snd.transform.env' class='section'><h3 ><a class='secnum' href='#snd.transform.env' style='min-width:80pt'>33.9.7</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.snd.transform.env'>[exec.snd.transform.env]</a></h3><div class='texpara'><div id='lib:transform_env'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_env'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________________________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________________________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.transform.env-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2321'>#</a></div><div class='texpara'><div id='snd.transform.env-1.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.transform.env-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2331'>#</a></div><div class='texpara'><div id='snd.transform.env-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#snd.transform.env-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.transform.env-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2335'>#</a></div><div class='texpara'><div id='snd.transform.env-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#snd.transform.env-3.sentence-1'>.</a></div></div></div></div></div><div id='snd.apply' class='section'><h3 ><a class='secnum' href='#snd.apply' style='min-width:80pt'>33.9.8</a> <span class='texttt'>execution&#x200b;::&#x200b;apply_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.apply'>[exec.snd.apply]</a></h3><div class='texpara'><div id='lib:apply_sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:apply_sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Domain dom, Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.apply-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2352'>#</a></div><div class='texpara'><div id='snd.apply-1.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>e</span></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.apply-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2362'>#</a></div><div class='texpara'><div id='snd.apply-2.sentence-1' class='sentence'><i >Constraints</i>: The expression <span class='math'><span class='mathalpha'>e</span></span> is well-formed<a class='hidden_link' href='#snd.apply-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.apply-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2366'>#</a></div><div class='texpara'><div id='snd.apply-3.sentence-1' class='sentence'><i >Returns</i>: <span class='math'><span class='mathalpha'>e</span></span><a class='hidden_link' href='#snd.apply-3.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.apply-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2370'>#</a></div><div class='texpara'><div id='snd.apply-4.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.apply-4.sentence-1'>.</a></div></div></div></div></div><div id='getcomplsigs' class='section'><h3 ><a class='secnum' href='#getcomplsigs' style='min-width:80pt'>33.9.9</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> <a class='abbr_ref' href='exec.getcomplsigs'>[exec.getcomplsigs]</a></h3><div class='para' id='getcomplsigs-1'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2377'>#</a></div><div class='texpara'><div id='getcomplsigs-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> is a customization point object<a class='hidden_link' href='#getcomplsigs-1.sentence-1'>.</a></div> <div id='getcomplsigs-1.sentence-2' class='sentence'>Let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Sndr</span>, and
let <span class='texttt'>env</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Env</span><a class='hidden_link' href='#getcomplsigs-1.sentence-2'>.</a></div> <div id='getcomplsigs-1.sentence-3' class='sentence'>Let <span class='texttt'>new_<span class='shy'></span>sndr</span> be the expression
<span class='texttt'>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-late</i></span><span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr, env<span class='parenthesis'>)</span></span>, and
let <span class='texttt'>NewSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#getcomplsigs-1.sentence-3'>.</a></div> <div id='getcomplsigs-1.sentence-4' class='sentence'>Then <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='keyword'>void</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>, CS<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
except that <span class='texttt'><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> and <span class='texttt'><span class='keyword'>void</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> are
indeterminately sequenced,
where <span class='texttt'>CS</span> is:
<ul class='itemize'><li id='getcomplsigs-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#getcomplsigs-1.1'>(1.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='operator'>.</span>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that type is well-formed,</li><li id='getcomplsigs-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#getcomplsigs-1.2'>(1.2)</a></div>Otherwise, <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>NewSndr<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>completion_<span class='shy'></span>signatures</span>
if that type is well-formed,</li><li id='getcomplsigs-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#getcomplsigs-1.3'>(1.3)</a></div>Otherwise,
if <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable___'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>NewSndr, <span class='texttt'><i >env-promise</i></span><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
then:
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span><i >await-result-type</i><span class='anglebracket'>&lt;</span>NewSndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>,        <span class='comment'>//  (<a href='#snd.concepts' title='33.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a>)</span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></li><li id='getcomplsigs-1.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#getcomplsigs-1.4'>(1.4)</a></div>Otherwise, <span class='texttt'>CS</span> is ill-formed<a class='hidden_link' href='#getcomplsigs-1.sentence-4'>.</a></li></ul></div></div></div><div class='para' id='getcomplsigs-2'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2415'>#</a></div><div class='texpara'><div id='getcomplsigs-2.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be an rvalue
whose type <span class='texttt'>Rcvr</span> models <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_____'><span class='texttt'>receiver</span></span></a>, and
let <span class='texttt'>Sndr</span> be the type of a sender
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#getcomplsigs-2.sentence-1'>.</a></div> <div id='getcomplsigs-2.sentence-2' class='sentence'>Let <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be the template arguments of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#getcomplsigs-2.sentence-2'>.</a></div> <div id='getcomplsigs-2.sentence-3' class='sentence'>Let <span class='texttt'>CSO</span> be a completion function<a class='hidden_link' href='#getcomplsigs-2.sentence-3'>.</a></div> <div id='getcomplsigs-2.sentence-4' class='sentence'>If sender <span class='texttt'>Sndr</span> or its operation state cause
the expression <span class='texttt'>CSO<span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
to be potentially evaluated (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)
then there shall be a signature <span class='texttt'>Sig</span> in <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
such that
<span class='codeblock'><i >MATCHING-SIG</i><span class='parenthesis'>(</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>CSO<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, Sig<span class='parenthesis'>)</span>
</span>
is <span class='texttt'><span class='literal'>true</span></span> (<a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#getcomplsigs-2.sentence-4'>.</a></div></div></div></div><div id='connect' class='section'><h3 ><a class='secnum' href='#connect' style='min-width:80pt'>33.9.10</a> <span class='texttt'>execution&#x200b;::&#x200b;connect</span> <a class='abbr_ref' href='exec.connect'>[exec.connect]</a></h3><div class='para' id='connect-1'><div class='marginalizedparent'><a class='marginalized' href='#connect-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2436'>#</a></div><div class='texpara'><div id='connect-1.sentence-1' class='sentence'><span class='texttt'>connect</span> connects (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) a sender with a receiver<a class='hidden_link' href='#connect-1.sentence-1'>.</a></div></div></div><div class='para' id='connect-2'><div class='marginalizedparent'><a class='marginalized' href='#connect-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2439'>#</a></div><div class='texpara'><div id='connect-2.sentence-1' class='sentence'>The name <span class='texttt'>connect</span> denotes a customization point object<a class='hidden_link' href='#connect-2.sentence-1'>.</a></div> <div id='connect-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>rcvr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Rcvr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
let <span class='texttt'>new_<span class='shy'></span>sndr</span> be the expression
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >get-domain-late</i><span class='parenthesis'>(</span>sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and let <span class='texttt'>DS</span> and <span class='texttt'>DR</span> be
<span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>, respectively<a class='hidden_link' href='#connect-2.sentence-2'>.</a></div></div></div><div class='para' id='connect-3'><div class='marginalizedparent'><a class='marginalized' href='#connect-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2451'>#</a></div><div class='texpara'><div id='connect-3.sentence-1' class='sentence'>Let <span class='texttt'><i >connect-awaitable-promise</i></span> be the following exposition-only class:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >connect-awaitable-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

    <i >connect-awaitable-promise</i><span class='parenthesis'>(</span>DS<span class='operator'>&amp;</span>, DR<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    suspend_always initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> suspend_always final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='keyword'>return</span> noop_coroutine<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >operation-state-task</i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >operation-state-task</i><span class='curlybracket'>{</span>
        coroutine_handle<span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_promise<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    env_of_t<span class='anglebracket'>&lt;</span>DR<span class='anglebracket'>&gt;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    DR<span class='operator'>&amp;</span> <i >rcvr</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='connect-4'><div class='marginalizedparent'><a class='marginalized' href='#connect-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2485'>#</a></div><div class='texpara'><div id='connect-4.sentence-1' class='sentence'>Let <span class='texttt'><i >operation-state-task</i></span> be the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >operation-state-task</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> promise_type <span class='operator'>=</span> <i >connect-awaitable-promise</i>;

    <span class='keyword'>explicit</span> <i >operation-state-task</i><span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> coro<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <i >operation-state-task</i><span class='parenthesis'>(</span><i >operation-state-task</i><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span><i >operation-state-task</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <i >coro</i><span class='operator'>.</span>destroy<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >coro</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <i >coro</i>;                                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='connect-5'><div class='marginalizedparent'><a class='marginalized' href='#connect-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2507'>#</a></div><div class='texpara'><div id='connect-5.sentence-1' class='sentence'>Let <span class='texttt'>V</span> name the type
<span class='texttt'><span class='texttt'><i >await-result-type</i></span><span class='anglebracket'>&lt;</span>DS, <span class='texttt'><i >connect-awaitable-promise</i></span><span class='anglebracket'>&gt;</span></span>,
let <span class='texttt'>Sigs</span> name the type
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span>V<span class='parenthesis'>)</span>,         <span class='comment'>// see  (<a href='#snd.concepts' title='33.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a>)</span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span>
and let <span class='texttt'><i >connect-awaitable</i></span> be an exposition-only coroutine
defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fun, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <i >suspend-complete</i><span class='parenthesis'>(</span>Fun fun, Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> as<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, fun<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> fun<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

    <span class='keyword'>struct</span> awaiter <span class='curlybracket'>{</span>
      <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >fn</i><span class='parenthesis'>)</span> <i >fn</i>;                                     <span class='comment'>// <i >exposition only</i></span>

      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
      <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >fn</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> unreachable<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>return</span> awaiter<span class='curlybracket'>{</span><i >fn</i><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>

  <i >operation-state-task</i> <i >connect-awaitable</i><span class='parenthesis'>(</span>DS sndr, DR rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of___'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>DR, Sigs<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    exception_ptr ep;
    <span class='keyword'>try</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>V, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      ep <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
    <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_error, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ep<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='connect-6'><div class='marginalizedparent'><a class='marginalized' href='#connect-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2552'>#</a></div><div class='texpara'><div id='connect-6.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>sndr, rcvr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='connect-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.1'>(6.1)</a></div><div class='texpara'><div id='connect-6.1.sentence-1' class='sentence'><span class='texttt'>new_<span class='shy'></span>sndr<span class='operator'>.</span>connect<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span> if that expression is well-formed<a class='hidden_link' href='#connect-6.1.sentence-1'>.</a></div></div><div class='texpara'><div id='connect-6.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state_____'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a><a class='hidden_link' href='#connect-6.1.sentence-2'>.</a></div></div></li><li id='connect-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.2'>(6.2)</a></div><div class='texpara'><div id='connect-6.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >connect-awaitable</i></span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#connect-6.2.sentence-1'>.</a></div></div></li></ul></div></div><div class='texpara'><div id='connect-6.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver______'><span class='texttt'>receiver</span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#connect-6.sentence-2'>.</a></div></div></div></div><div id='factories' class='section'><h3 ><a class='secnum' href='#factories' style='min-width:80pt'>33.9.11</a> Sender factories <a class='abbr_ref' href='exec.factories'>[exec.factories]</a></h3><div id='schedule' class='section'><h4 ><a class='secnum' href='#schedule' style='min-width:95pt'>33.9.11.1</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule</span> <a class='abbr_ref' href='exec.schedule'>[exec.schedule]</a></h4><div class='para' id='schedule-1'><div class='marginalizedparent'><a class='marginalized' href='#schedule-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2572'>#</a></div><div class='texpara'><div id='schedule-1.sentence-1' class='sentence'><span class='texttt'>schedule</span> obtains a schedule sender (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
from a scheduler<a class='hidden_link' href='#schedule-1.sentence-1'>.</a></div></div></div><div class='para' id='schedule-2'><div class='marginalizedparent'><a class='marginalized' href='#schedule-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2576'>#</a></div><div class='texpara'><div id='schedule-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule</span> denotes a customization point object<a class='hidden_link' href='#schedule-2.sentence-1'>.</a></div> <div id='schedule-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sch</span>,
the expression <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule-2.sentence-2'>.</a></div></div></div><div class='para' id='schedule-3'><div class='marginalizedparent'><a class='marginalized' href='#schedule-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2582'>#</a></div><div class='texpara'><div id='schedule-3.sentence-1' class='sentence'><i >Mandates</i>: The type of <span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#schedule-3.sentence-1'>.</a></div></div></div><div class='para' id='schedule-4'><div class='marginalizedparent'><a class='marginalized' href='#schedule-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2586'>#</a></div><div class='texpara'><div id='schedule-4.sentence-1' class='sentence'>If the expression
<span class='codeblock'>get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> sch
</span>
is ill-formed or evaluates to <span class='texttt'><span class='literal'>false</span></span>,
the behavior of calling <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is undefined<a class='hidden_link' href='#schedule-4.sentence-1'>.</a></div></div></div></div><div id='just' class='section'><h4 ><a class='secnum' href='#just' style='min-width:95pt'>33.9.11.2</a> <span class='texttt'>execution&#x200b;::&#x200b;just</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.just'>[exec.just]</a></h4><div class='para' id='just-1'><div class='marginalizedparent'><a class='marginalized' href='#just-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2596'>#</a></div><div class='texpara'><div id='just-1.sentence-1' class='sentence'><span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> are sender factories
whose asynchronous operations complete synchronously in their start operation
with a value completion operation,
an error completion operation, or
a stopped completion operation, respectively<a class='hidden_link' href='#just-1.sentence-1'>.</a></div></div></div><div class='para' id='just-2'><div class='marginalizedparent'><a class='marginalized' href='#just-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2603'>#</a></div><div class='texpara'><div id='just-2.sentence-1' class='sentence'>The names <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> denote
customization point objects<a class='hidden_link' href='#just-2.sentence-1'>.</a></div> <div id='just-2.sentence-2' class='sentence'>Let <span class='texttt'><i >just-cpo</i></span> be one of
<span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, or <span class='texttt'>just_<span class='shy'></span>stopped</span><a class='hidden_link' href='#just-2.sentence-2'>.</a></div> <div id='just-2.sentence-3' class='sentence'>For a pack of subexpressions <span class='texttt'>ts</span>,
let <span class='texttt'>Ts</span> be the pack of types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#just-2.sentence-3'>.</a></div> <div id='just-2.sentence-4' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >just-cpo</i></span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed if
<ul class='itemize'><li id='just-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.1'>(2.1)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value__'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='just-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.2'>(2.2)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>error</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='just-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.3'>(2.3)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>stopped</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#just-2.sentence-4'>.</a></li></ul></div></div><div class='texpara'><div id='just-2.sentence-5' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span><span class='texttt'><i >just-cpo</i></span>, <span class='texttt'><i >product-type</i></span><span class='curlybracket'>{</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#just-2.sentence-5'>.</a></div></div><div class='texpara'><div id='just-2.sentence-6' class='sentence'>For <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#just-2.sentence-6'>.</a></div> <div id='just-2.sentence-7' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >just-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >just-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
        <i >set-cpo</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='read.env' class='section'><h4 ><a class='secnum' href='#read.env' style='min-width:95pt'>33.9.11.3</a> <span class='texttt'>execution&#x200b;::&#x200b;read_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.read.env'>[exec.read.env]</a></h4><div class='para' id='read.env-1'><div class='marginalizedparent'><a class='marginalized' href='#read.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2645'>#</a></div><div class='texpara'><div id='read.env-1.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a sender factory for a sender
whose asynchronous operation completes synchronously in its start operation
with a value completion result equal to
a value read from the receiver's associated environment<a class='hidden_link' href='#read.env-1.sentence-1'>.</a></div></div></div><div class='para' id='read.env-2'><div class='marginalizedparent'><a class='marginalized' href='#read.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2651'>#</a></div><div class='texpara'><div id='read.env-2.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#read.env-2.sentence-1'>.</a></div> <div id='read.env-2.sentence-2' class='sentence'>For some query object <span class='texttt'>q</span>,
the expression <span class='texttt'>read_<span class='shy'></span>env<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>read_<span class='shy'></span>env, q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#read.env-2.sentence-2'>.</a></div></div></div><div class='para' id='read.env-3'><div class='marginalizedparent'><a class='marginalized' href='#read.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2657'>#</a></div><div class='texpara'><div id='read.env-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>read_<span class='shy'></span>env</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>read_env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> start <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> query, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, query<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div></div><div id='adapt' class='section'><h3 ><a class='secnum' href='#adapt' style='min-width:80pt'>33.9.12</a> Sender adaptors <a class='abbr_ref' href='exec.adapt'>[exec.adapt]</a></h3><div id='adapt.general' class='section'><h4 ><a class='secnum' href='#adapt.general' style='min-width:95pt'>33.9.12.1</a> General <a class='abbr_ref' href='exec.adapt.general'>[exec.adapt.general]</a></h4><div class='para' id='adapt.general-1'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2676'>#</a></div><div class='texpara'><div id='adapt.general-1.sentence-1' class='sentence'>Subclause <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> specifies a set of sender adaptors<a class='hidden_link' href='#adapt.general-1.sentence-1'>.</a></div></div></div><div class='para' id='adapt.general-2'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2679'>#</a></div><div class='texpara'><div id='adapt.general-2.sentence-1' class='sentence'>The bitwise inclusive <span class='textsc'>or</span> operator is overloaded
for the purpose of creating sender chains<a class='hidden_link' href='#adapt.general-2.sentence-1'>.</a></div> <div id='adapt.general-2.sentence-2' class='sentence'>The adaptors also support function call syntax with equivalent semantics<a class='hidden_link' href='#adapt.general-2.sentence-2'>.</a></div></div></div><div class='para' id='adapt.general-3'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2684'>#</a></div><div class='texpara'><div id='adapt.general-3.sentence-1' class='sentence'>Unless otherwise specified:
<ul class='itemize'><li id='adapt.general-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.1'>(3.1)</a></div><div class='texpara'><div id='adapt.general-3.1.sentence-1' class='sentence'>A sender adaptor is prohibited from causing observable effects,
apart from moving and copying its arguments,
before the returned sender is connected with a receiver using <span class='texttt'>connect</span>,
and <span class='texttt'>start</span> is called on the resulting operation state<a class='hidden_link' href='#adapt.general-3.1.sentence-1'>.</a></div></div></li><li id='adapt.general-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.2'>(3.2)</a></div><div class='texpara'><div id='adapt.general-3.2.sentence-1' class='sentence'>A parent sender (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) with a single child sender <span class='texttt'>sndr</span> has
an associated attribute object equal to
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> (<a href='#fwd.env' title='33.5.1&emsp;forwarding_&shy;query'>[exec.<span class='shy'></span>fwd.<span class='shy'></span>env]</a>)<a class='hidden_link' href='#adapt.general-3.2.sentence-1'>.</a></div></div></li><li id='adapt.general-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.3'>(3.3)</a></div><div class='texpara'><div id='adapt.general-3.3.sentence-1' class='sentence'>A parent sender with more than one child sender has
an associated attributes object equal to <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#adapt.general-3.3.sentence-1'>.</a></div></div></li><li id='adapt.general-3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.4'>(3.4)</a></div><div class='texpara'><div id='adapt.general-3.4.sentence-1' class='sentence'>When a parent sender is connected to a receiver <span class='texttt'>rcvr</span>,
any receiver used to connect a child sender has
an associated environment equal to <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#adapt.general-3.4.sentence-1'>.</a></div></div></li><li id='adapt.general-3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.5'>(3.5)</a></div><div class='texpara'><div id='adapt.general-3.5.sentence-1' class='sentence'>These requirements apply to any function
that is selected by the implementation of the sender adaptor<a class='hidden_link' href='#adapt.general-3.5.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='adapt.general-4'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2708'>#</a></div><div class='texpara'><div id='adapt.general-4.sentence-1' class='sentence'>If a sender returned from a sender adaptor specified in <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a>
is specified to include <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>
among its set of completion signatures
where <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span>,
but the implementation does not potentially evaluate
an error completion operation with an <span class='texttt'>exception_<span class='shy'></span>ptr</span> argument,
the implementation is allowed to omit
the <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion signature from the set<a class='hidden_link' href='#adapt.general-4.sentence-1'>.</a></div></div></div></div><div id='adapt.obj' class='section'><h4 ><a class='secnum' href='#adapt.obj' style='min-width:95pt'>33.9.12.2</a> Closure objects <a class='abbr_ref' href='exec.adapt.obj'>[exec.adapt.obj]</a></h4><div class='para' id='adapt.obj-1'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2720'>#</a></div><div class='texpara'><div id='adapt.obj-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_closure_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_closure_object,pipeable'><i >pipeable sender adaptor closure object</i></span></a> is a function object
that accepts one or more <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________'><span class='texttt'>sender</span></span></a> arguments and returns a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-1.sentence-1'>.</a></div> <div id='adapt.obj-1.sentence-2' class='sentence'>For a pipeable sender adaptor closure object <span class='texttt'>c</span> and
an expression <span class='texttt'>sndr</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________'><span class='texttt'>sender</span></span></a>,
the following expressions are equivalent and yield a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________'><span class='texttt'>sender</span></span></a>:
<span class='codeblock'>c<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>
sndr <span class='operator'>|</span> c
</span></div> <div id='adapt.obj-1.sentence-3' class='sentence'>
Given an additional pipeable sender adaptor closure object <span class='texttt'>d</span>,
the expression <span class='texttt'>c <span class='operator'>|</span> d</span> produces
another pipeable sender adaptor closure object <span class='texttt'>e</span>:</div></div><div class='texpara'><div id='adapt.obj-1.sentence-4' class='sentence'><span class='texttt'>e</span> is a perfect forwarding call wrapper (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>)
with the following properties:
<ul class='itemize'><li id='adapt.obj-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.1'>(1.1)</a></div><div class='texpara'><div id='adapt.obj-1.1.sentence-1' class='sentence'>Its target object is an object <span class='texttt'>d2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>d<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>d</span><a class='hidden_link' href='#adapt.obj-1.1.sentence-1'>.</a></div></div></li><li id='adapt.obj-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.2'>(1.2)</a></div><div class='texpara'><div id='adapt.obj-1.2.sentence-1' class='sentence'>It has one bound argument entity,
an object <span class='texttt'>c2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>c</span><a class='hidden_link' href='#adapt.obj-1.2.sentence-1'>.</a></div></div></li><li id='adapt.obj-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.3'>(1.3)</a></div><div class='texpara'><div id='adapt.obj-1.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>d2<span class='parenthesis'>(</span>c2<span class='parenthesis'>(</span>arg<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
where arg is the argument used in a function call expression of <span class='texttt'>e</span><a class='hidden_link' href='#adapt.obj-1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='adapt.obj-1.sentence-5' class='sentence'>
The expression <span class='texttt'>c <span class='operator'>|</span> d</span> is well-formed if and only if
the initializations of the state entities (<a href='func.def' title='22.10.3&emsp;Definitions'>[func.<span class='shy'></span>def]</a>) of <span class='texttt'>e</span>
are all well-formed<a class='hidden_link' href='#adapt.obj-1.sentence-5'>.</a></div></div></div><div class='para' id='adapt.obj-2'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2753'>#</a></div><div class='texpara'><div id='adapt.obj-2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> of type <span class='texttt'>T</span> is
a pipeable sender adaptor closure object
if <span class='texttt'>T</span> models <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_____'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>T</span> has no other base classes
of type <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> for any other type <span class='texttt'>U</span>, and
<span class='texttt'>T</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-2.sentence-1'>.</a></div></div></div><div class='para' id='adapt.obj-3'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2761'>#</a></div><div class='texpara'><div id='adapt.obj-3.sentence-1' class='sentence'>The template parameter <span class='texttt'>D</span> for <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure</span> can be
an incomplete type<a class='hidden_link' href='#adapt.obj-3.sentence-1'>.</a></div> <div id='adapt.obj-3.sentence-2' class='sentence'>Before any expression of type <span class='mathit'>cv</span> <span class='texttt'>D</span> appears as
an operand to the <span class='texttt'><span class='operator'>|</span></span> operator,
<span class='texttt'>D</span> shall be complete and
model <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from______'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>D<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#adapt.obj-3.sentence-2'>.</a></div> <div id='adapt.obj-3.sentence-3' class='sentence'>The behavior of an expression involving an object of type <span class='mathit'>cv</span> <span class='texttt'>D</span>
as an operand to the <span class='texttt'><span class='operator'>|</span></span> operator is undefined
if overload resolution selects a program-defined <span class='texttt'><span class='keyword'>operator</span><span class='operator'>|</span></span> function<a class='hidden_link' href='#adapt.obj-3.sentence-3'>.</a></div></div></div><div class='para' id='adapt.obj-4'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2772'>#</a></div><div class='texpara'><div id='adapt.obj-4.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_object,pipeable'><i >pipeable sender adaptor object</i></span></a> is a customization point object
that accepts a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________'><span class='texttt'>sender</span></span></a> as its first argument and
returns a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-4.sentence-1'>.</a></div> <div id='adapt.obj-4.sentence-2' class='sentence'>If a pipeable sender adaptor object accepts only one argument,
then it is a pipeable sender adaptor closure object<a class='hidden_link' href='#adapt.obj-4.sentence-2'>.</a></div></div></div><div class='para' id='adapt.obj-5'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2779'>#</a></div><div class='texpara'><div id='adapt.obj-5.sentence-1' class='sentence'>If a pipeable sender adaptor object adaptor accepts more than one argument,
then let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________'><span class='texttt'>sender</span></span></a>,
let <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be arguments
such that <span class='texttt'>adaptor<span class='parenthesis'>(</span>sndr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is a well-formed expression
as specified below, and
let <span class='texttt'>BoundArgs</span> be a pack that denotes <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#adapt.obj-5.sentence-1'>.</a></div> <div id='adapt.obj-5.sentence-2' class='sentence'>The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> produces
a pipeable sender adaptor closure object <span class='texttt'>f</span>
that is a perfect forwarding call wrapper with the following properties:
<ul class='itemize'><li id='adapt.obj-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.1'>(5.1)</a></div><div class='texpara'><div id='adapt.obj-5.1.sentence-1' class='sentence'>Its target object is a copy of adaptor<a class='hidden_link' href='#adapt.obj-5.1.sentence-1'>.</a></div></div></li><li id='adapt.obj-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.2'>(5.2)</a></div><div class='texpara'><div id='adapt.obj-5.2.sentence-1' class='sentence'>Its bound argument entities <span class='texttt'>bound_<span class='shy'></span>args</span> consist of
objects of types <span class='texttt'>BoundArgs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> direct-non-list-initialized with
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, respectively<a class='hidden_link' href='#adapt.obj-5.2.sentence-1'>.</a></div></div></li><li id='adapt.obj-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.3'>(5.3)</a></div><div class='texpara'><div id='adapt.obj-5.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>adaptor<span class='parenthesis'>(</span>rcvr, bound_<span class='shy'></span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>rcvr</span> is
the argument used in a function call expression of <span class='texttt'>f</span><a class='hidden_link' href='#adapt.obj-5.3.sentence-1'>.</a></div></div></li></ul></div> <div id='adapt.obj-5.sentence-3' class='sentence'>
The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed if and only if
the initializations of the bound argument entities of the result,
as specified above, are all well-formed<a class='hidden_link' href='#adapt.obj-5.sentence-3'>.</a></div></div></div></div><div id='starts.on' class='section'><h4 ><a class='secnum' href='#starts.on' style='min-width:95pt'>33.9.12.3</a> <span class='texttt'>execution&#x200b;::&#x200b;starts_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.starts.on'>[exec.starts.on]</a></h4><div class='para' id='starts.on-1'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2808'>#</a></div><div class='texpara'><div id='starts.on-1.sentence-1' class='sentence'><span class='texttt'>starts_<span class='shy'></span>on</span> adapts an input sender into a sender
that will start on an execution agent belonging to
a particular scheduler's associated execution resource<a class='hidden_link' href='#starts.on-1.sentence-1'>.</a></div></div></div><div class='para' id='starts.on-2'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2813'>#</a></div><div class='texpara'><div id='starts.on-2.sentence-1' class='sentence'>The name <span class='texttt'>starts_<span class='shy'></span>on</span> denotes a customization point object<a class='hidden_link' href='#starts.on-2.sentence-1'>.</a></div> <div id='starts.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_______'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#starts.on-2.sentence-2'>.</a></div></div></div><div class='para' id='starts.on-3'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2820'>#</a></div><div class='texpara'><div id='starts.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>starts_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#starts.on-3.sentence-1'>.</a></div></div></div><div class='para' id='starts.on-4'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2830'>#</a></div><div class='texpara'><div id='starts.on-4.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>OutSndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#starts.on-4.sentence-1'>.</a></div> <div id='starts.on-4.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for__'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, starts_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed; otherwise
<ul class='itemize'><li id='starts.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#starts.on-4.1'>(4.1)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li><li id='starts.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#starts.on-4.2'>(4.2)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, sndr<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> let_value<span class='parenthesis'>(</span>
  schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>sndr <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='starts.on-5'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2856'>#</a></div><div class='texpara'><div id='starts.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#starts.on-5.sentence-1'>.</a></div> <div id='starts.on-5.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#starts.on-5.sentence-2'>.</a></div> <div id='starts.on-5.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#starts.on-5.sentence-3'>.</a></div> <div id='starts.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall start <span class='texttt'>sndr</span>
on an execution agent of the associated execution resource of <span class='texttt'>sch</span><a class='hidden_link' href='#starts.on-5.sentence-4'>.</a></div> <div id='starts.on-5.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#starts.on-5.sentence-5'>.</a></div></div></div></div><div id='continues.on' class='section'><h4 ><a class='secnum' href='#continues.on' style='min-width:95pt'>33.9.12.4</a> <span class='texttt'>execution&#x200b;::&#x200b;continues_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.continues.on'>[exec.continues.on]</a></h4><div class='para' id='continues.on-1'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2873'>#</a></div><div class='texpara'><div id='continues.on-1.sentence-1' class='sentence'><span class='texttt'>continues_<span class='shy'></span>on</span> adapts a sender into one
that completes on the specified scheduler<a class='hidden_link' href='#continues.on-1.sentence-1'>.</a></div></div></div><div class='para' id='continues.on-2'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2877'>#</a></div><div class='texpara'><div id='continues.on-2.sentence-1' class='sentence'>The name <span class='texttt'>continues_<span class='shy'></span>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#continues.on-2.sentence-1'>.</a></div> <div id='continues.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler________'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#continues.on-2.sentence-2'>.</a></div></div></div><div class='para' id='continues.on-3'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2884'>#</a></div><div class='texpara'><div id='continues.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>continues_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#continues.on-3.sentence-1'>.</a></div></div></div><div class='para' id='continues.on-4'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2892'>#</a></div><div class='texpara'><div id='continues.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>continues_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>continues_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='continues.on-5'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2907'>#</a></div><div class='texpara'><div id='continues.on-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#continues.on-5.sentence-1'>.</a></div> <div id='continues.on-5.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for___'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> schedule_from<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='continues.on-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#continues.on-note-1'>1</a></i>:&ensp;<div id='continues.on-5.sentence-2' class='sentence'>This causes the <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> sender to become
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#continues.on-5.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='continues.on-6'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2924'>#</a></div><div class='texpara'><div id='continues.on-6.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#continues.on-6.sentence-1'>.</a></div> <div id='continues.on-6.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#continues.on-6.sentence-2'>.</a></div> <div id='continues.on-6.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#continues.on-6.sentence-3'>.</a></div> <div id='continues.on-6.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#continues.on-6.sentence-4'>.</a></div> <div id='continues.on-6.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#continues.on-6.sentence-5'>.</a></div></div></div></div><div id='schedule.from' class='section'><h4 ><a class='secnum' href='#schedule.from' style='min-width:95pt'>33.9.12.5</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule_<span class='shy'></span>from</span> <a class='abbr_ref' href='exec.schedule.from'>[exec.schedule.from]</a></h4><div class='para' id='schedule.from-1'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2943'>#</a></div><div class='texpara'><div id='schedule.from-1.sentence-1' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> schedules work dependent on the completion of a sender
onto a scheduler's associated execution resource<a class='hidden_link' href='#schedule.from-1.sentence-1'>.</a></div> <div id='schedule.from-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#schedule.from-note-1'>1</a></i>:&ensp;<div id='schedule.from-1.sentence-2' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> is not meant to be used in user code;
it is used in the implementation of <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#schedule.from-1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='schedule.from-2'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2951'>#</a></div><div class='texpara'><div id='schedule.from-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule_<span class='shy'></span>from</span> denotes a customization point object<a class='hidden_link' href='#schedule.from-2.sentence-1'>.</a></div> <div id='schedule.from-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule.from-2.sentence-2'>.</a></div> <div id='schedule.from-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_________'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#schedule.from-2.sentence-3'>.</a></div></div></div><div class='para' id='schedule.from-3'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2960'>#</a></div><div class='texpara'><div id='schedule.from-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>schedule_from, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#schedule.from-3.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-4'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2970'>#</a></div><div class='texpara'><div id='schedule.from-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>schedule_<span class='shy'></span>from_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>schedule_from_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-5'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2984'>#</a></div><div class='texpara'><div id='schedule.from-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-6'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L2993'>#</a></div><div class='texpara'><div id='schedule.from-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;

  <span class='keyword'>using</span> sched_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> receiver_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> operation_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span>sched_t<span class='anglebracket'>&gt;</span>, receiver_t<span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='literal'>nullptr</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    variant_t <i >async-result</i>;     <span class='comment'>// <i >exposition only</i></span>
    operation_t <i >op-state</i>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >state-type</i><span class='parenthesis'>(</span>sched_t sch, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <i >op-state</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>sch, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-7'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3021'>#</a></div><div class='texpara'><div id='schedule.from-7.sentence-1' class='sentence'>Objects of the local class <span class='texttt'><i >state-type</i></span> can be used
to initialize a structured binding<a class='hidden_link' href='#schedule.from-7.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-8'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3025'>#</a></div><div class='texpara'><div id='schedule.from-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be
a pack of the arguments to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#schedule.from-8.sentence-1'>.</a></div> <div id='schedule.from-8.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
that transforms a completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> into
the tuple specialization <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#schedule.from-8.sentence-2'>.</a></div> <div id='schedule.from-8.sentence-3' class='sentence'>Then <span class='texttt'>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#schedule.from-8.sentence-3'>.</a></div></div></div><div class='para' id='schedule.from-9'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3036'>#</a></div><div class='texpara'><div id='schedule.from-9.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>t</span> is an alias for the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >receiver-type</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
    <i >state-type</i><span class='operator'>*</span> <i >state</i>;          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      visit<span class='parenthesis'>(</span>
        <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tuple<span class='operator'>&amp;</span> result<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>monostate, Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>args<span class='squarebracket'>]</span> <span class='operator'>=</span> result;
            tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>,
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >async-result</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-10'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3071'>#</a></div><div class='texpara'><div id='schedule.from-10.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of the lambda is <span class='texttt'><span class='literal'>true</span></span>
if the construction of the returned <span class='texttt'><i >state-type</i></span> object
is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#schedule.from-10.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-11'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3077'>#</a></div><div class='texpara'><div id='schedule.from-11.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> result_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>result_t, Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>try</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>result_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='keyword'>return</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  start<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >op-state</i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='schedule.from-12'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3098'>#</a></div><div class='texpara'><div id='schedule.from-12.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule.from-12.sentence-1'>.</a></div> <div id='schedule.from-12.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#schedule.from-12.sentence-2'>.</a></div> <div id='schedule.from-12.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#schedule.from-12.sentence-3'>.</a></div> <div id='schedule.from-12.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#schedule.from-12.sentence-4'>.</a></div> <div id='schedule.from-12.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#schedule.from-12.sentence-5'>.</a></div></div></div></div><div id='on' class='section'><h4 ><a class='secnum' href='#on' style='min-width:95pt'>33.9.12.6</a> <span class='texttt'>execution&#x200b;::&#x200b;on</span> <a class='abbr_ref' href='exec.on'>[exec.on]</a></h4><div class='para' id='on-1'><div class='marginalizedparent'><a class='marginalized' href='#on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3117'>#</a></div><div class='texpara'><div id='on-1.sentence-1' class='sentence'>The <span class='texttt'>on</span> sender adaptor has two forms:
<ul class='itemize'><li id='on-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-1.1'>(1.1)</a></div><div class='texpara'><div id='on-1.1.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span>,
which starts a sender <span class='texttt'>sndr</span> on an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource and
that, upon <span class='texttt'>sndr</span>'s completion,
transfers execution back to the execution resource
on which the <span class='texttt'>on</span> sender was started<a class='hidden_link' href='#on-1.1.sentence-1'>.</a></div></div></li><li id='on-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-1.2'>(1.2)</a></div><div class='texpara'><div id='on-1.2.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span>,
which upon completion of a sender <span class='texttt'>sndr</span>,
transfers execution to an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource,
then executes a sender adaptor closure <span class='texttt'>closure</span>
with the async results of the sender, and
that then transfers execution back to the execution resource
on which <span class='texttt'>sndr</span> completed<a class='hidden_link' href='#on-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='on-2'><div class='marginalizedparent'><a class='marginalized' href='#on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3138'>#</a></div><div class='texpara'><div id='on-2.sentence-1' class='sentence'>The name <span class='texttt'>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#on-2.sentence-1'>.</a></div> <div id='on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
<span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='on-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__________'><span class='texttt'>scheduler</span></span></a>, or</li><li id='on-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.2'>(2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr</span> is not
a pipeable sender adaptor closure object (<a href='#adapt.obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>), or</li><li id='on-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.3'>(2.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr </span>is also a pipeable sender adaptor closure object<a class='hidden_link' href='#on-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='on-3'><div class='marginalizedparent'><a class='marginalized' href='#on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3154'>#</a></div><div class='texpara'><div id='on-3.sentence-1' class='sentence'>Otherwise, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________'><span class='texttt'>sender</span></span></a>,
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#on-3.sentence-1'>.</a></div></div></div><div class='para' id='on-4'><div class='marginalizedparent'><a class='marginalized' href='#on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3164'>#</a></div><div class='texpara'><div id='on-4.sentence-1' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>sch</span>, and <span class='texttt'>closure</span>, if
<ul class='itemize'><li id='on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___________'><span class='texttt'>scheduler</span></span></a>, or</li><li id='on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.2'>(4.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='on-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.3'>(4.3)</a></div><span class='texttt'>closure</span> is not a pipeable sender adaptor closure object (<a href='#adapt.obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>),</li></ul>
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, <i >product-type</i><span class='curlybracket'>{</span>sch, closure<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#on-4.sentence-1'>.</a></div></div></div><div class='para' id='on-5'><div class='marginalizedparent'><a class='marginalized' href='#on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3183'>#</a></div><div class='texpara'><div id='on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions,
let <span class='texttt'>OutSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>Env</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-5.sentence-1'>.</a></div> <div id='on-5.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed<a class='hidden_link' href='#on-5.sentence-2'>.</a></div></div></div><div class='para' id='on-6'><div class='marginalizedparent'><a class='marginalized' href='#on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3191'>#</a></div><div class='texpara'><div id='on-6.sentence-1' class='sentence'>Otherwise:
Let <span class='texttt'><i >not-a-scheduler</i></span> be an unspecified empty class type, and
let <span class='texttt'><i >not-a-sender</i></span> be the exposition-only type:
<span class='codeblock'><span class='keyword'>struct</span> <i >not-a-sender</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;

  <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
where the member function <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> returns
an object of a type that is not
a specialization of the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#on-6.sentence-1'>.</a></div></div></div><div class='para' id='on-7'><div class='marginalizedparent'><a class='marginalized' href='#on-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3208'>#</a></div><div class='texpara'><div id='on-7.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='on-8'><div class='marginalizedparent'><a class='marginalized' href='#on-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3220'>#</a></div><div class='texpara'><div id='on-8.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span>
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> continues_on<span class='parenthesis'>(</span>
      starts_on<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>sch, closure<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span> <i >query-with-default</i><span class='parenthesis'>(</span>
    get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span>,
    get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >write-env</i><span class='parenthesis'>(</span>
      continues_on<span class='parenthesis'>(</span>
        std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>closure<span class='parenthesis'>)</span><span class='parenthesis'>(</span>
          continues_on<span class='parenthesis'>(</span>
            <i >write-env</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >SCHED-ENV</i><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
            sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        orig_sch<span class='parenthesis'>)</span>,
      <i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='on-9'><div class='marginalizedparent'><a class='marginalized' href='#on-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3258'>#</a></div><div class='texpara'><div id='on-9.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use
the return type of <span class='texttt'><span class='texttt'><i >not-a-sender</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span>
to inform users that their usage of <span class='texttt'>on</span> is incorrect
because there is no available scheduler onto which to restore execution<a class='hidden_link' href='#on-9.sentence-1'>.</a></div></div></div><div class='para' id='on-10'><div class='marginalizedparent'><a class='marginalized' href='#on-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3265'>#</a></div><div class='texpara'><div id='on-10.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-10.sentence-1'>.</a></div> <div id='on-10.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#on-10.sentence-2'>.</a></div> <div id='on-10.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-10.sentence-3'>.</a></div> <div id='on-10.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='on-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.1'>(10.1)</a></div>remember the current scheduler, <span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li><li id='on-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.2'>(10.2)</a></div>start <span class='texttt'>sndr</span> on an execution agent belonging to
sch's associated execution resource;</li><li id='on-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.3'>(10.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1; and</li><li id='on-10.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.4'>(10.4)</a></div>forward <span class='texttt'>sndr</span>'s async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-10.sentence-4'>.</a></li></ul></div> <div id='on-10.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#on-10.sentence-5'>.</a></div></div></div><div class='para' id='on-11'><div class='marginalizedparent'><a class='marginalized' href='#on-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3292'>#</a></div><div class='texpara'><div id='on-11.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-11.sentence-1'>.</a></div> <div id='on-11.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#on-11.sentence-2'>.</a></div> <div id='on-11.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-11.sentence-3'>.</a></div> <div id='on-11.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='on-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-11.1'>(11.1)</a></div>remember the current scheduler,
which is the first of the following expressions that is well-formed:
<ul class='itemize'><li id='on-11.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#on-11.1.1'>(11.1.1)</a></div><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='on-11.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#on-11.1.2'>(11.1.2)</a></div><span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li></ul></li><li id='on-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-11.2'>(11.2)</a></div>start <span class='texttt'>sndr</span> on the current execution agent;</li><li id='on-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-11.3'>(11.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution to an agent
owned by sch's associated execution resource;</li><li id='on-11.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-11.4'>(11.4)</a></div>forward <span class='texttt'>sndr</span>'s async result as if by
connecting and starting a sender <span class='texttt'>closure<span class='parenthesis'>(</span>S<span class='parenthesis'>)</span></span>,
where <span class='texttt'>S</span> is a sender
that completes synchronously with <span class='texttt'>sndr</span>'s async result; and</li><li id='on-11.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-11.5'>(11.5)</a></div>upon completion of the operation started in the previous step,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1 and
forward the operation's async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-11.sentence-4'>.</a></li></ul></div> <div id='on-11.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed on
an unspecified execution agent<a class='hidden_link' href='#on-11.sentence-5'>.</a></div></div></div></div><div id='then' class='section'><h4 ><a class='secnum' href='#then' style='min-width:95pt'>33.9.12.7</a> <span class='texttt'>execution&#x200b;::&#x200b;then</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.then'>[exec.then]</a></h4><div class='para' id='then-1'><div class='marginalizedparent'><a class='marginalized' href='#then-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3333'>#</a></div><div class='texpara'><div id='then-1.sentence-1' class='sentence'><span class='texttt'>then</span> attaches an invocable as a continuation
for an input sender's value completion operation<a class='hidden_link' href='#then-1.sentence-1'>.</a></div> <div id='then-1.sentence-2' class='sentence'><span class='texttt'>upon_<span class='shy'></span>error</span> and <span class='texttt'>upon_<span class='shy'></span>stopped</span> do the same
for the error and stopped completion operations, respectively,
sending the result of the invocable as a value completion<a class='hidden_link' href='#then-1.sentence-2'>.</a></div></div></div><div class='para' id='then-2'><div class='marginalizedparent'><a class='marginalized' href='#then-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3340'>#</a></div><div class='texpara'><div id='then-2.sentence-1' class='sentence'>The names <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#then-2.sentence-1'>.</a></div> <div id='then-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >then-cpo</i></span> be one of
<span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, or <span class='texttt'>upon_<span class='shy'></span>stopped</span><a class='hidden_link' href='#then-2.sentence-2'>.</a></div> <div id='then-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value___'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span> </span>is ill-formed<a class='hidden_link' href='#then-2.sentence-3'>.</a></div></div></div><div class='para' id='then-3'><div class='marginalizedparent'><a class='marginalized' href='#then-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3350'>#</a></div><div class='texpara'><div id='then-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >then-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#then-3.sentence-1'>.</a></div></div></div><div class='para' id='then-4'><div class='marginalizedparent'><a class='marginalized' href='#then-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3358'>#</a></div><div class='texpara'><div id='then-4.sentence-1' class='sentence'>For <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#then-4.sentence-1'>.</a></div> <div id='then-4.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >then-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >then-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
        <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> fn, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span>set<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr,
                          invoke<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
            Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='then-5'><div class='marginalizedparent'><a class='marginalized' href='#then-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3382'>#</a></div><div class='texpara'><div id='then-5.sentence-1' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> has undefined behavior
unless it returns a sender <span class='texttt'>out_<span class='shy'></span>sndr</span> that
<ul class='itemize'><li id='then-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#then-5.1'>(5.1)</a></div>invokes <span class='texttt'>f</span> or a copy of such
with the value, error, or stopped result datums of <span class='texttt'>sndr</span>
for <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>, respectively,
using the result value of <span class='texttt'>f</span> as <span class='texttt'>out_<span class='shy'></span>sndr</span>'s value completion, and</li><li id='then-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#then-5.2'>(5.2)</a></div>forwards all other completion operations unchanged<a class='hidden_link' href='#then-5.sentence-1'>.</a></li></ul></div></div></div></div><div id='let' class='section'><h4 ><a class='secnum' href='#let' style='min-width:95pt'>33.9.12.8</a> <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>value</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.let'>[exec.let]</a></h4><div class='para' id='let-1'><div class='marginalizedparent'><a class='marginalized' href='#let-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3397'>#</a></div><div class='texpara'><div id='let-1.sentence-1' class='sentence'><span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> transform
a sender's value, error, and stopped completions, respectively,
into a new child asynchronous operation
by passing the sender's result datums to a user-specified callable,
which returns a new sender that is connected and started<a class='hidden_link' href='#let-1.sentence-1'>.</a></div></div></div><div class='para' id='let-2'><div class='marginalizedparent'><a class='marginalized' href='#let-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3404'>#</a></div><div class='texpara'><div id='let-2.sentence-1' class='sentence'>For <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#let-2.sentence-1'>.</a></div> <div id='let-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >let-cpo</i></span> be one of
<span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, or <span class='texttt'>let_<span class='shy'></span>stopped</span><a class='hidden_link' href='#let-2.sentence-2'>.</a></div> <div id='let-2.sentence-3' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> be expression-equivalent to
the first well-formed expression below:
<ul class='itemize'><li id='let-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.1'>(2.1)</a></div><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='let-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.2'>(2.2)</a></div><span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>domain, get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='let-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.3'>(2.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li></ul></div></div></div><div class='para' id='let-3'><div class='marginalizedparent'><a class='marginalized' href='#let-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3422'>#</a></div><div class='texpara'><div id='let-3.sentence-1' class='sentence'>The names <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> denote
pipeable sender adaptor objects<a class='hidden_link' href='#let-3.sentence-1'>.</a></div> <div id='let-3.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
let <span class='texttt'>F</span> be the decayed type of <span class='texttt'>f</span><a class='hidden_link' href='#let-3.sentence-2'>.</a></div> <div id='let-3.sentence-3' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value____'><span class='texttt'><i >movable-value</i></span></span></a>,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#let-3.sentence-3'>.</a></div> <div id='let-3.sentence-4' class='sentence'>If <span class='texttt'>F</span> does not satisfy <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='texttt'>invocable</span></span></a>,
the expression <span class='texttt'>let_<span class='shy'></span>stopped<span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#let-3.sentence-4'>.</a></div></div></div><div class='para' id='let-4'><div class='marginalizedparent'><a class='marginalized' href='#let-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3433'>#</a></div><div class='texpara'><div id='let-4.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >let-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#let-4.sentence-1'>.</a></div></div></div><div class='para' id='let-5'><div class='marginalizedparent'><a class='marginalized' href='#let-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3441'>#</a></div><div class='texpara'><div id='let-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >let-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> <i >let-bind</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >let-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='let-6'><div class='marginalizedparent'><a class='marginalized' href='#let-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3457'>#</a></div><div class='texpara'><div id='let-6.sentence-1' class='sentence'>Let <span class='texttt'><i >receiver2</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >receiver2</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
    <span class='curlybracket'>}</span>

    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    Env <i >env</i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div> <div id='let-6.sentence-2' class='sentence'>
Invocation of the function <span class='texttt'><span class='texttt'><i >receiver2</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env</span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='let-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-6.1'>(6.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________________________'><span class='texttt'><i >queryable</i></span></span></a> and</li><li id='let-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-6.2'>(6.2)</a></div>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'><span class='texttt'><i >env</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid,
otherwise <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#let-6.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='let-7'><div class='marginalizedparent'><a class='marginalized' href='#let-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3501'>#</a></div><div class='texpara'><div id='let-7.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, fn, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>using</span> fn_t <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>using</span> env_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> args_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> ops2_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    fn_t <i >fn</i>;                    <span class='comment'>// <i >exposition only</i></span>
    env_t <i >env</i>;                  <span class='comment'>// <i >exposition only</i></span>
    args_variant_t <i >args</i>;        <span class='comment'>// <i >exposition only</i></span>
    ops2_variant_t <i >ops2</i>;        <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, <i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='let-8'><div class='marginalizedparent'><a class='marginalized' href='#let-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3522'>#</a></div><div class='texpara'><div id='let-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-8.sentence-1'>.</a></div> <div id='let-8.sentence-2' class='sentence'>Let <span class='texttt'>LetSigs</span> be a pack of those types in <span class='texttt'>Sigs</span>
with a return type of <span class='texttt'><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-8.sentence-2'>.</a></div> <div id='let-8.sentence-3' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-8.sentence-3'>.</a></div> <div id='let-8.sentence-4' class='sentence'>Then <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
except with duplicate types removed<a class='hidden_link' href='#let-8.sentence-4'>.</a></div></div></div><div class='para' id='let-9'><div class='marginalizedparent'><a class='marginalized' href='#let-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3535'>#</a></div><div class='texpara'><div id='let-9.sentence-1' class='sentence'>Given a type <span class='texttt'>Tag</span> and a pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-sndr2</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-sndr2</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>Fn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-9.sentence-1'>.</a></div> <div id='let-9.sentence-2' class='sentence'>Then <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>monostate, connect_result_t<span class='anglebracket'>&lt;</span><i >as-sndr2</i><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span>, <i >receiver2</i><span class='anglebracket'>&lt;</span>Rcvr, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
except with duplicate types removed<a class='hidden_link' href='#let-9.sentence-2'>.</a></div></div></div><div class='para' id='let-10'><div class='marginalizedparent'><a class='marginalized' href='#let-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3547'>#</a></div><div class='texpara'><div id='let-10.sentence-1' class='sentence'>The <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a> constraining the above lambda is satisfied
if and only if
the types <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> and <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> are well-formed<a class='hidden_link' href='#let-10.sentence-1'>.</a></div></div></div><div class='para' id='let-11'><div class='marginalizedparent'><a class='marginalized' href='#let-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3552'>#</a></div><div class='texpara'><div id='let-11.sentence-1' class='sentence'>The exposition-only function template <span class='texttt'><i >let-bind</i></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>using</span> args_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> mkop2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> connect<span class='parenthesis'>(</span>
    apply<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>fn<span class='parenthesis'>)</span>,
          state<span class='operator'>.</span>args<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>args_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >receiver2</i><span class='curlybracket'>{</span>rcvr, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>env<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
start<span class='parenthesis'>(</span>state<span class='operator'>.</span>ops2<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>mkop2<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >emplace-from</i><span class='curlybracket'>{</span>mkop2<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='let-12'><div class='marginalizedparent'><a class='marginalized' href='#let-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3566'>#</a></div><div class='texpara'><div id='let-12.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span>let<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >let-bind</i><span class='parenthesis'>(</span>state, rcvr, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='let-13'><div class='marginalizedparent'><a class='marginalized' href='#let-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3580'>#</a></div><div class='texpara'><div id='let-13.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions, and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#let-13.sentence-1'>.</a></div> <div id='let-13.sentence-2' class='sentence'>If
<span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#let-13.sentence-2'>.</a></div> <div id='let-13.sentence-3' class='sentence'>Otherwise, it is equal to
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#let-13.sentence-3'>.</a></div></div></div><div class='para' id='let-14'><div class='marginalizedparent'><a class='marginalized' href='#let-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3591'>#</a></div><div class='texpara'><div id='let-14.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#let-14.sentence-1'>.</a></div> <div id='let-14.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:
<ul class='itemize'><li id='let-14.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-14.1'>(14.1)</a></div>invokes <span class='texttt'>f</span> when <span class='texttt'><i >set-cpo</i></span> is called
with <span class='texttt'>sndr</span>'s result datums,</li><li id='let-14.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-14.2'>(14.2)</a></div>makes its completion dependent on
the completion of a sender returned by <span class='texttt'>f</span>, and</li><li id='let-14.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-14.3'>(14.3)</a></div>propagates the other completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#let-14.sentence-2'>.</a></li></ul></div></div></div></div><div id='bulk' class='section'><h4 ><a class='secnum' href='#bulk' style='min-width:95pt'>33.9.12.9</a> <span class='texttt'>execution&#x200b;::&#x200b;bulk</span> <a class='abbr_ref' href='exec.bulk'>[exec.bulk]</a></h4><div class='para' id='bulk-1'><div class='marginalizedparent'><a class='marginalized' href='#bulk-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3613'>#</a></div><div class='texpara'><div id='bulk-1.sentence-1' class='sentence'><span class='texttt'>bulk</span> runs a task repeatedly for every index in an index space<a class='hidden_link' href='#bulk-1.sentence-1'>.</a></div></div><div class='texpara'><div id='bulk-1.sentence-2' class='sentence'>The name <span class='texttt'>bulk</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#bulk-1.sentence-2'>.</a></div> <div id='bulk-1.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>shape</span>, and <span class='texttt'>f</span>,
let <span class='texttt'>Shape</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#bulk-1.sentence-3'>.</a></div> <div id='bulk-1.sentence-4' class='sentence'>If
<ul class='itemize'><li id='bulk-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-1.1'>(1.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='bulk-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-1.2'>(1.2)</a></div><span class='texttt'>Shape</span> does not satisfy <a href='concepts.arithmetic#concept:integral' title='18.4.7&emsp;Arithmetic concepts&emsp;[concepts.arithmetic]'><span id='conceptref:integral'><span class='texttt'>integral</span></span></a>, or</li><li id='bulk-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-1.3'>(1.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_____'><span class='texttt'><i >movable-value</i></span></span></a>,</li></ul>
<span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#bulk-1.sentence-4'>.</a></div></div></div><div class='para' id='bulk-2'><div class='marginalizedparent'><a class='marginalized' href='#bulk-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3630'>#</a></div><div class='texpara'><div id='bulk-2.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is expression-equivalent to:</div></div><div class='texpara'><div id='bulk-2.sentence-2' class='sentence'><span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>bulk, <i >product-type</i><span class='curlybracket'>{</span>shape, f<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#bulk-2.sentence-2'>.</a></div></div></div><div class='para' id='bulk-3'><div class='marginalizedparent'><a class='marginalized' href='#bulk-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3639'>#</a></div><div class='texpara'><div id='bulk-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='bulk-4'><div class='marginalizedparent'><a class='marginalized' href='#bulk-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3651'>#</a></div><div class='texpara'><div id='bulk-4.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>for</span> <span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span> i <span class='operator'>=</span> <span class='literal'>0</span>; i <span class='anglebracket'>&lt;</span> shape; <span class='operator'>+</span><span class='operator'>+</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>i<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='bulk-5'><div class='marginalizedparent'><a class='marginalized' href='#bulk-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3672'>#</a></div><div class='texpara'><div id='bulk-5.sentence-1' class='sentence'>The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above
is <span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#bulk-5.sentence-1'>.</a></div></div></div><div class='para' id='bulk-6'><div class='marginalizedparent'><a class='marginalized' href='#bulk-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3678'>#</a></div><div class='texpara'><div id='bulk-6.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#bulk-6.sentence-1'>.</a></div> <div id='bulk-6.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started,
<ul class='itemize'><li id='bulk-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-6.1'>(6.1)</a></div>on a value completion operation,
invokes <span class='texttt'>f<span class='parenthesis'>(</span>i, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
for every <span class='texttt'>i</span> of type <span class='texttt'>Shape</span> in [<span class='texttt'><span class='texttt'><span class='literal'>0</span></span>, <span class='texttt'>shape</span></span>),
where <span class='texttt'>args</span> is a pack of lvalue subexpressions
referring to the value completion result datums of the input sender, and</li><li id='bulk-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-6.2'>(6.2)</a></div>propagates all completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#bulk-6.sentence-2'>.</a></li></ul></div></div></div></div><div id='split' class='section'><h4 ><a class='secnum' href='#split' style='min-width:95pt'>33.9.12.10</a> <span class='texttt'>execution&#x200b;::&#x200b;split</span> <a class='abbr_ref' href='exec.split'>[exec.split]</a></h4><div class='para' id='split-1'><div class='marginalizedparent'><a class='marginalized' href='#split-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3700'>#</a></div><div class='texpara'><div id='split-1.sentence-1' class='sentence'><span class='texttt'>split</span> adapts an arbitrary sender
into a sender that can be connected multiple times<a class='hidden_link' href='#split-1.sentence-1'>.</a></div></div></div><div class='para' id='split-2'><div class='marginalizedparent'><a class='marginalized' href='#split-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3704'>#</a></div><div class='texpara'><div id='split-2.sentence-1' class='sentence'>Let <span class='texttt'><i >split-env</i></span> be the type of an environment
such that, given an instance <span class='texttt'>env</span>,
the expression <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed and
has type <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token<span class='operator'>.</span></span></div></div></div><div class='para' id='split-3'><div class='marginalizedparent'><a class='marginalized' href='#split-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3710'>#</a></div><div class='texpara'><div id='split-3.sentence-1' class='sentence'>The name <span class='texttt'>split</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#split-3.sentence-1'>.</a></div> <div id='split-3.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-3.sentence-2'>.</a></div> <div id='split-3.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >split-env</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#split-3.sentence-3'>.</a></div></div></div><div class='para' id='split-4'><div class='marginalizedparent'><a class='marginalized' href='#split-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3716'>#</a></div><div class='texpara'><div id='split-4.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>split, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#split-4.sentence-1'>.</a></div> <div id='split-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#split-note-1'>1</a></i>:&ensp;<div id='split-4.sentence-2' class='sentence'>The default implementation of <span class='texttt'>transform_<span class='shy'></span>sender</span>
will have the effect of connecting the sender to a receiver<a class='hidden_link' href='#split-4.sentence-2'>.</a></div> <div id='split-4.sentence-3' class='sentence'>It will return a sender with a different tag type<a class='hidden_link' href='#split-4.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='split-5'><div class='marginalizedparent'><a class='marginalized' href='#split-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3728'>#</a></div><div class='texpara'><div id='split-5.sentence-1' class='sentence'>Let <span class='texttt'><i >local-state</i></span> denote the following exposition-only class template:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='operator'>~</span><i >local-state-base</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >local-state</i> <span class='operator'>:</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >on-stop-callback</i> <span class='operator'>=</span>                                    <span class='comment'>// <i >exposition only</i></span>
      stop_callback_for_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <i >local-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='operator'>~</span><i >local-state</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    optional<span class='anglebracket'>&lt;</span><i >on-stop-callback</i><span class='anglebracket'>&gt;</span> <i >on_stop</i>;                         <span class='comment'>// <i >exposition only</i></span>
    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
    Rcvr<span class='operator'>*</span> <i >rcvr</i>;                                                 <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='split-6'><div class='marginalizedparent'><a class='marginalized' href='#split-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3761'>#</a></div><div class='texpara'><div id='split-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i> <span class='operator'>=</span> data<span class='operator'>.</span>sh_state<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i> <span class='operator'>=</span> addressof<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='split-7'><div class='marginalizedparent'><a class='marginalized' href='#split-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3777'>#</a></div><div class='texpara'><div id='split-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'>sh_state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;
</code></div></div><div class='para' id='split-8'><div class='marginalizedparent'><a class='marginalized' href='#split-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3790'>#</a></div><div class='texpara'><div id='split-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> tupl<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>
      <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> tag, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >rcvr</i><span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>,
      tupl<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='split-9'><div class='marginalizedparent'><a class='marginalized' href='#split-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3807'>#</a></div><div class='texpara'><div id='split-9.sentence-1' class='sentence'>Let <span class='texttt'><i >split-receiver</i></span> denote
the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >split-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
      <span class='keyword'>try</span> <span class='curlybracket'>{</span>
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>;
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
      <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>notify<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_value, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_error, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>struct</span> <i >env</i> <span class='curlybracket'>{</span>                                                <span class='comment'>// <i >exposition only</i></span>
      <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh-state</i>;                             <span class='comment'>// <i >exposition only</i></span>

      inplace_stop_token query<span class='parenthesis'>(</span>get_stop_token_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >sh-state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>stop_src<span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;

    <i >env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >env</i><span class='curlybracket'>{</span><i >sh_state</i><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='split-10'><div class='marginalizedparent'><a class='marginalized' href='#split-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3859'>#</a></div><div class='texpara'><div id='split-10.sentence-1' class='sentence'>Let <span class='texttt'><i >shared-state</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >shared-state</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> <i >variant-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-list-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >shared-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >start-op</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>

    inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                             <span class='comment'>// <i >exposition only</i></span>
    <i >variant-type</i> <i >result</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                      <span class='comment'>// <i >exposition only</i></span>
    <i >state-list-type</i> <i >waiting_states</i>;                             <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span> <i >completed</i><span class='curlybracket'>{</span><span class='literal'>false</span><span class='curlybracket'>}</span>;                              <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >ref_count</i><span class='curlybracket'>{</span><span class='literal'>1</span><span class='curlybracket'>}</span>;                                <span class='comment'>// <i >exposition only</i></span>
    connect_result_t<span class='anglebracket'>&lt;</span>Sndr, <i >split-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <i >op_state</i>;      <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='split-11'><div class='marginalizedparent'><a class='marginalized' href='#split-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3885'>#</a></div><div class='texpara'><div id='split-11.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#split-11.sentence-1'>.</a></div> <div id='split-11.sentence-2' class='sentence'>For type <span class='texttt'>Tag</span> and pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#split-11.sentence-2'>.</a></div> <div id='split-11.sentence-3' class='sentence'>Then <span class='texttt'><i >variant-type</i></span> denotes the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span>set_stopped_t<span class='anglebracket'>&gt;</span>, tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
but with duplicate types removed<a class='hidden_link' href='#split-11.sentence-3'>.</a></div></div></div><div class='para' id='split-12'><div class='marginalizedparent'><a class='marginalized' href='#split-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3899'>#</a></div><div class='texpara'><div id='split-12.sentence-1' class='sentence'>Let <span class='texttt'><i >state-list-type</i></span> be a type
that stores a list of pointers to <span class='texttt'><i >local-state-base</i></span> objects and
that permits atomic insertion<a class='hidden_link' href='#split-12.sentence-1'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>explicit</span> <span class='texttt'><i >shared-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='split-13'><div class='marginalizedparent'><a class='marginalized' href='#split-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3909'>#</a></div><div class='texpara'><div id='split-13.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >op_<span class='shy'></span>state</i></span> with the result of
<span class='texttt'>connect<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >split-receiver</i></span><span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-13.sentence-1'>.</a></div></div></div></div><div class='para' id='split-14'><div class='marginalizedparent'><a class='marginalized' href='#split-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3914'>#</a></div><div class='texpara'><div id='split-14.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >waiting_<span class='shy'></span>states</i></span> is empty, and <span class='texttt'><i >completed</i></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#split-14.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='split-15'><div class='marginalizedparent'><a class='marginalized' href='#split-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3924'>#</a></div><div class='texpara'><div id='split-15.sentence-1' class='sentence'><i >Effects</i>: Evaluates <span class='texttt'><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-15.sentence-1'>.</a></div> <div id='split-15.sentence-2' class='sentence'>If <span class='texttt'>stop_<span class='shy'></span>src<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;
otherwise, evaluates <span class='texttt'>start<span class='parenthesis'>(</span><span class='texttt'><i >op_<span class='shy'></span>state</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-15.sentence-2'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='split-16'><div class='marginalizedparent'><a class='marginalized' href='#split-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3937'>#</a></div><div class='texpara'><div id='split-16.sentence-1' class='sentence'><i >Effects</i>: Atomically does the following:
<ul class='itemize'><li id='split-16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#split-16.1'>(16.1)</a></div>Sets <span class='texttt'>completed</span> to <span class='texttt'><span class='literal'>true</span></span>, and</li><li id='split-16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#split-16.2'>(16.2)</a></div>Exchanges <span class='texttt'>waiting_<span class='shy'></span>states</span> with an empty list,
storing the old value in a local <span class='texttt'>prior_<span class='shy'></span>states</span><a class='hidden_link' href='#split-16.sentence-1'>.</a></li></ul></div> <div id='split-16.sentence-2' class='sentence'>
Then, for each pointer <span class='texttt'>p</span> in <span class='texttt'>prior_<span class='shy'></span>states</span>,
evaluates <span class='texttt'>p<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-16.sentence-2'>.</a></div> <div id='split-16.sentence-3' class='sentence'>Finally, evaluates <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-16.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='split-17'><div class='marginalizedparent'><a class='marginalized' href='#split-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3957'>#</a></div><div class='texpara'><div id='split-17.sentence-1' class='sentence'><i >Effects</i>: Increments <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#split-17.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='split-itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#split-itemdecl:8'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='split-18'><div class='marginalizedparent'><a class='marginalized' href='#split-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3967'>#</a></div><div class='texpara'><div id='split-18.sentence-1' class='sentence'><i >Effects</i>: Decrements <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#split-18.sentence-1'>.</a></div> <div id='split-18.sentence-2' class='sentence'>If the new value of <span class='texttt'><i >ref_<span class='shy'></span>count</i></span> is <span class='texttt'><span class='literal'>0</span></span>,
calls <span class='texttt'><span class='keyword'>delete</span> <span class='keyword'>this</span></span><a class='hidden_link' href='#split-18.sentence-2'>.</a></div></div></div></div><div class='para' id='split-19'><div class='marginalizedparent'><a class='marginalized' href='#split-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3973'>#</a></div><div class='texpara'><div id='split-19.sentence-1' class='sentence'><i >Synchronization</i>: If an evaluation of <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> does not
decrement the <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span> then
synchronizes with the evaluation of <span class='texttt'>dec<span class='operator'>-</span>ref<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that decrements <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span><a class='hidden_link' href='#split-19.sentence-1'>.</a></div></div></div></div><div class='para' id='split-20'><div class='marginalizedparent'><a class='marginalized' href='#split-20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L3981'>#</a></div><div class='texpara'><div id='split-20.sentence-1' class='sentence'>Let <span class='texttt'><i >split-impl-tag</i></span> be an empty exposition-only class type<a class='hidden_link' href='#split-20.sentence-1'>.</a></div> <div id='split-20.sentence-2' class='sentence'>Given an expression <span class='texttt'>sndr</span>,
the expression <span class='texttt'>split<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>auto</span><span class='operator'>*</span> sh_state <span class='operator'>=</span> <span class='keyword'>new</span> <i >shared-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
<span class='keyword'>return</span> <i >make-sender</i><span class='parenthesis'>(</span><i >split-impl-tag</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >shared-wrapper</i><span class='curlybracket'>{</span>sh_state, tag<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >shared-wrapper</i></span> is an exposition-only class
that manages the reference count of the <span class='texttt'><i >shared-state</i></span> object
pointed to by sh_state<a class='hidden_link' href='#split-20.sentence-2'>.</a></div> <div id='split-20.sentence-3' class='sentence'><span class='texttt'><i >shared-wrapper</i></span> models <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable__'><span class='texttt'>copyable</span></span></a>
with move operations nulling out the moved-from object,
copy operations incrementing the reference count
by calling <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and
assignment operations performing a copy-and-swap operation<a class='hidden_link' href='#split-20.sentence-3'>.</a></div> <div id='split-20.sentence-4' class='sentence'>The destructor has no effect if sh_state is null;
otherwise, it decrements the reference count
by evaluating <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-20.sentence-4'>.</a></div></div></div><div class='para' id='split-21'><div class='marginalizedparent'><a class='marginalized' href='#split-21'>21</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4002'>#</a></div><div class='texpara'><div id='split-21.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >split-impl-tag</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >split-impl-tag</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='split-22'><div class='marginalizedparent'><a class='marginalized' href='#split-22'>22</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4015'>#</a></div><div class='texpara'><div id='split-22.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to
the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >local-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='split-23'><div class='marginalizedparent'><a class='marginalized' href='#split-23'>23</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4026'>#</a></div><div class='texpara'><div id='split-23.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
that has a function call operator equivalent to the following:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><i >local-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</span></div></div><div class='texpara'><div id='split-23.sentence-2' class='sentence'><i >Effects</i>: If <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#split-23.sentence-2'>.</a></div> <div id='split-23.sentence-3' class='sentence'>Otherwise, does the following in order:
<ul class='itemize'><li id='split-23.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#split-23.1'>(23.1)</a></div><div class='texpara'><div id='split-23.1.sentence-1' class='sentence'>Evaluates
<span class='codeblock'>state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
  get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></li><li id='split-23.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#split-23.2'>(23.2)</a></div><div class='texpara'><div id='split-23.2.sentence-1' class='sentence'>Then atomically does the following:
<ul class='itemize'><li id='split-23.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#split-23.2.1'>(23.2.1)</a></div>Reads the value <span class='texttt'>c</span> of
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span>, and</li><li id='split-23.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#split-23.2.2'>(23.2.2)</a></div>Inserts <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> into
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>
if <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#split-23.2.sentence-1'>.</a></li></ul></div></div></li><li id='split-23.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#split-23.3'>(23.3)</a></div><div class='texpara'><div id='split-23.3.sentence-1' class='sentence'>If <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#split-23.3.sentence-1'>.</a></div></div></li><li id='split-23.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#split-23.4'>(23.4)</a></div><div class='texpara'><div id='split-23.4.sentence-1' class='sentence'>Otherwise,
if <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> is the first item added to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#split-23.4.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='when.all' class='section'><h4 ><a class='secnum' href='#when.all' style='min-width:95pt'>33.9.12.11</a> <span class='texttt'>execution&#x200b;::&#x200b;when_<span class='shy'></span>all</span> <a class='abbr_ref' href='exec.when.all'>[exec.when.all]</a></h4><div class='para' id='when.all-1'><div class='marginalizedparent'><a class='marginalized' href='#when.all-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4071'>#</a></div><div class='texpara'><div id='when.all-1.sentence-1' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span>
both adapt multiple input senders into a sender
that completes when all input senders have completed<a class='hidden_link' href='#when.all-1.sentence-1'>.</a></div> <div id='when.all-1.sentence-2' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> only accepts senders
with a single value completion signature and
on success concatenates all the input senders' value result datums
into its own value completion operation<a class='hidden_link' href='#when.all-1.sentence-2'>.</a></div> <div id='when.all-1.sentence-3' class='sentence'><span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is semantically equivalent to
w<span class='texttt'>hen_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>sndrs</span> is a pack of subexpressions
whose types model <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#when.all-1.sentence-3'>.</a></div></div></div><div class='para' id='when.all-2'><div class='marginalizedparent'><a class='marginalized' href='#when.all-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4084'>#</a></div><div class='texpara'><div id='when.all-2.sentence-1' class='sentence'>The names <span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span> denote
customization point objects<a class='hidden_link' href='#when.all-2.sentence-1'>.</a></div> <div id='when.all-2.sentence-2' class='sentence'>Let <span class='texttt'>sndrs</span> be a pack of subexpressions,
let <span class='texttt'>Sndrs</span> be a pack of the types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, and
let <span class='texttt'>CD</span> be
the type <span class='texttt'>common_<span class='shy'></span>type_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#when.all-2.sentence-2'>.</a></div> <div id='when.all-2.sentence-3' class='sentence'>The expressions <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> are ill-formed
if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='when.all-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>0</span></span>, or</li><li id='when.all-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndrs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='when.all-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-2.3'>(2.3)</a></div><span class='texttt'>CD</span> is ill-formed<a class='hidden_link' href='#when.all-2.sentence-3'>.</a></li></ul></div></div></div><div class='para' id='when.all-3'><div class='marginalizedparent'><a class='marginalized' href='#when.all-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4103'>#</a></div><div class='texpara'><div id='when.all-3.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='when.all-4'><div class='marginalizedparent'><a class='marginalized' href='#when.all-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4109'>#</a></div><div class='texpara'><div id='when.all-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>when_all_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-5'><div class='marginalizedparent'><a class='marginalized' href='#when.all-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4125'>#</a></div><div class='texpara'><div id='when.all-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>CD, default_domain<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_domain, CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-6'><div class='marginalizedparent'><a class='marginalized' href='#when.all-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4139'>#</a></div><div class='texpara'><div id='when.all-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, State<span class='operator'>&amp;</span> state, <span class='keyword'>const</span> Receiver<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
<span class='curlybracket'>}</span>
</span></div> <div id='when.all-6.sentence-2' class='sentence'>
Returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='when.all-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-6.1'>(6.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________________________'><span class='texttt'><i >queryable</i></span></span></a>, and</li><li id='when.all-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-6.2'>(6.2)</a></div><span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >stop-src</i></span><span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and</li><li id='when.all-6.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-6.3'>(6.3)</a></div>given a query object <span class='texttt'>q</span> with type other than <span class='mathit'>cv</span> <span class='texttt'>stop_<span class='shy'></span>token_<span class='shy'></span>t</span>,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#when.all-6.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='when.all-7'><div class='marginalizedparent'><a class='marginalized' href='#when.all-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4160'>#</a></div><div class='texpara'><div id='when.all-7.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;
<span class='curlybracket'>}</span>
</span>
where <span class='math'><span class='mathalpha'>e</span></span> is the expression
<span class='codeblock'>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='operator'>.</span>apply<span class='parenthesis'>(</span><i >make-state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and where <span class='texttt'><i >make-state</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
<span class='keyword'>concept</span> <a class='hidden_link' href='#concept:max-1-sender-in' title='33.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='concept:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>                <span class='comment'>// <i >exposition only</i></span>
  <span class='parenthesis'>(</span>tuple_size_v<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, Env, tuple, tuple<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>;

<span class='keyword'>enum</span> <span class='keyword'>class</span> <i >disposition</i> <span class='curlybracket'>{</span> <i >started</i>, <i >error</i>, <i >stopped</i> <span class='curlybracket'>}</span>;             <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >make-state</i> <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:max-1-sender-in' title='33.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='conceptref:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a><span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sndrs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span>, Sndrs<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> sndrs<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> values_tuple <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> errors_variant <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_callback <span class='operator'>=</span> stop_callback_for_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
      <span class='keyword'>void</span> <i >arrive</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                        <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='literal'>0</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='operator'>-</span>count<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <i >complete</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

      atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >count</i><span class='curlybracket'>{</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;                   <span class='comment'>// <i >exposition only</i></span>
      inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                           <span class='comment'>// <i >exposition only</i></span>
      atomic<span class='anglebracket'>&lt;</span><i >disposition</i><span class='anglebracket'>&gt;</span> disp<span class='curlybracket'>{</span><i >disposition</i><span class='operator'>::</span><i >started</i><span class='curlybracket'>}</span>;           <span class='comment'>// <i >exposition only</i></span>
      errors_variant <i >errors</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                  <span class='comment'>// <i >exposition only</i></span>
      values_tuple <i >values</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                    <span class='comment'>// <i >exposition only</i></span>
      optional<span class='anglebracket'>&lt;</span>stop_callback<span class='anglebracket'>&gt;</span> <i >on_stop</i><span class='curlybracket'>{</span>nullopt<span class='curlybracket'>}</span>;                 <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='when.all-8'><div class='marginalizedparent'><a class='marginalized' href='#when.all-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4211'>#</a></div><div class='texpara'><div id='when.all-8.sentence-1' class='sentence'>Let <span class='texttt'><i >copy-fail</i></span> be <span class='texttt'>exception_<span class='shy'></span>ptr</span>
if decay-copying any of the child senders' result datums can potentially throw;
otherwise, <span class='texttt'><i >none-such</i></span>,
where <span class='texttt'><i >none-such</i></span> is an unspecified empty class type<a class='hidden_link' href='#when.all-8.sentence-1'>.</a></div></div></div><div class='para' id='when.all-9'><div class='marginalizedparent'><a class='marginalized' href='#when.all-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4217'>#</a></div><div class='texpara'><div id='when.all-9.sentence-1' class='sentence'>The alias <span class='texttt'>values_<span class='shy'></span>tuple</span> denotes the type
<span class='codeblock'>tuple<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndrs, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, <i >decayed-tuple</i>, optional<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
if that type is well-formed; otherwise, <span class='texttt'>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#when.all-9.sentence-1'>.</a></div></div></div><div class='para' id='when.all-10'><div class='marginalizedparent'><a class='marginalized' href='#when.all-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4224'>#</a></div><div class='texpara'><div id='when.all-10.sentence-1' class='sentence'>The alias <span class='texttt'>errors_<span class='shy'></span>variant</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span><span class='texttt'><i >none-such</i></span>, <span class='texttt'><i >copy-fail</i></span>, Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
with duplicate types removed,
where <span class='texttt'>Es</span> is the pack of the decayed types
of all the child senders' possible error result datums<a class='hidden_link' href='#when.all-10.sentence-1'>.</a></div></div></div><div class='para' id='when.all-11'><div class='marginalizedparent'><a class='marginalized' href='#when.all-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4231'>#</a></div><div class='texpara'><div id='when.all-11.sentence-1' class='sentence'>The member
<span class='texttt'><span class='keyword'>void</span> <span class='texttt'><i >state-type</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span></span>
behaves as follows:
<ul class='itemize'><li id='when.all-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-11.1'>(11.1)</a></div>If <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >started</i></span></span>,
evaluates:
<span class='codeblock'><span class='keyword'>auto</span> tie <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> set <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
apply<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> opts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>set, tuple_cat<span class='parenthesis'>(</span>tie<span class='parenthesis'>(</span><span class='operator'>*</span>opts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  values<span class='parenthesis'>)</span>;
</span></li><li id='when.all-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-11.2'>(11.2)</a></div>Otherwise,
if <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >error</i></span></span>,
evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span> error<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Error, <i >none-such</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>,
  errors<span class='parenthesis'>)</span>;
</span></li><li id='when.all-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-11.3'>(11.3)</a></div>Otherwise, evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='when.all-12'><div class='marginalizedparent'><a class='marginalized' href='#when.all-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4272'>#</a></div><div class='texpara'><div id='when.all-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ops<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Ops<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
    get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >on_stop.</i>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='parenthesis'>(</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-13'><div class='marginalizedparent'><a class='marginalized' href='#when.all-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4291'>#</a></div><div class='texpara'><div id='when.all-13.sentence-1' class='sentence'>The member <span class='texttt'><i ><span class='texttt'>impls<span class='operator'>-</span><span class='keyword'>for</span></span>&lt;when_<span class='shy'></span>all_<span class='shy'></span>t&gt;&#x200b;::&#x200b;<span class='texttt'><i >complete</i></span></i></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Set, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>this</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> complete, Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Set, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i> <span class='operator'>!</span><span class='operator'>=</span> state<span class='operator'>.</span>disp<span class='operator'>.</span>exchange<span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-ERROR</i><span class='parenthesis'>(</span>state<span class='operator'>.</span>errors, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span> expected <span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i>;
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp<span class='operator'>.</span>compare_exchange_strong<span class='parenthesis'>(</span>expected, <i >disposition</i><span class='operator'>::</span><i >stopped</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>State<span class='operator'>::</span>values<span class='parenthesis'>)</span>, tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp <span class='operator'>=</span><span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> opt <span class='operator'>=</span> get<span class='anglebracket'>&lt;</span>Index<span class='operator'>::</span>value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>state<span class='operator'>.</span>values<span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-VALUE</i><span class='parenthesis'>(</span>complete, opt, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  state<span class='operator'>.</span><i >arrive</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-ERROR</i></span><span class='parenthesis'>(</span>v, e<span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>v</span> and <span class='texttt'>e</span>, is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>exception_ptr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is potentially throwing;
otherwise, <span class='texttt'>v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>decltype<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>;
and where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-VALUE</i></span><span class='parenthesis'>(</span>c, o, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>c</span>, <span class='texttt'>o</span>, and pack of subexpressions <span class='texttt'>as</span>,
is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c<span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, state, rcvr, set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span></span>
is potentially throwing;
otherwise, <span class='texttt'>o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#when.all-13.sentence-1'>.</a></div></div></div><div class='para' id='when.all-14'><div class='marginalizedparent'><a class='marginalized' href='#when.all-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4343'>#</a></div><div class='texpara'><div id='when.all-14.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all_with_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='when.all-15'><div class='marginalizedparent'><a class='marginalized' href='#when.all-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4350'>#</a></div><div class='texpara'><div id='when.all-15.sentence-2' class='sentence'>Given subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if
<span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> when_all<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
<div id='when.all-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#when.all-note-1'>1</a></i>:&ensp;<div id='when.all-15.sentence-1' class='sentence'>This causes the <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> sender
to become <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span><a class='hidden_link' href='#when.all-15.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='into.variant' class='section'><h4 ><a class='secnum' href='#into.variant' style='min-width:95pt'>33.9.12.12</a> <span class='texttt'>execution&#x200b;::&#x200b;into_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.into.variant'>[exec.into.variant]</a></h4><div class='para' id='into.variant-1'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4371'>#</a></div><div class='texpara'><div id='into.variant-1.sentence-1' class='sentence'><span class='texttt'>into_<span class='shy'></span>variant</span> adapts a sender with multiple value completion signatures
into a sender with just one value completion signature
consisting of a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#into.variant-1.sentence-1'>.</a></div></div></div><div class='para' id='into.variant-2'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4376'>#</a></div><div class='texpara'><div id='into.variant-2.sentence-1' class='sentence'>The name <span class='texttt'>into_<span class='shy'></span>variant</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#into.variant-2.sentence-1'>.</a></div> <div id='into.variant-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#into.variant-2.sentence-2'>.</a></div> <div id='into.variant-2.sentence-3' class='sentence'>If <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#into.variant-2.sentence-3'>.</a></div></div></div><div class='para' id='into.variant-3'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4382'>#</a></div><div class='texpara'><div id='into.variant-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>into_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#into.variant-3.sentence-1'>.</a></div></div></div><div class='para' id='into.variant-4'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4390'>#</a></div><div class='texpara'><div id='into.variant-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>into_<span class='shy'></span>variant</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>into_variant_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='into.variant-5'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4403'>#</a></div><div class='texpara'><div id='into.variant-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> type_identity<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='into.variant-6'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4413'>#</a></div><div class='texpara'><div id='into.variant-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>auto</span>, State, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> variant_type <span class='operator'>=</span> <span class='keyword'>typename</span> State<span class='operator'>::</span>type;
    <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, variant_type<span class='parenthesis'>(</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='stopped.opt' class='section'><h4 ><a class='secnum' href='#stopped.opt' style='min-width:95pt'>33.9.12.13</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> <a class='abbr_ref' href='exec.stopped.opt'>[exec.stopped.opt]</a></h4><div class='para' id='stopped.opt-1'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4430'>#</a></div><div class='texpara'><div id='stopped.opt-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> maps a sender's stopped completion operation
into a value completion operation as a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-1'>.</a></div> <div id='stopped.opt-1.sentence-2' class='sentence'>The sender's value completion operation
is also converted into an <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-2'>.</a></div> <div id='stopped.opt-1.sentence-3' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-3'>.</a></div></div></div><div class='para' id='stopped.opt-2'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4438'>#</a></div><div class='texpara'><div id='stopped.opt-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#stopped.opt-2.sentence-1'>.</a></div> <div id='stopped.opt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.opt-2.sentence-2'>.</a></div> <div id='stopped.opt-2.sentence-3' class='sentence'>The expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_optional, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#stopped.opt-2.sentence-3'>.</a></div></div></div><div class='para' id='stopped.opt-3'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4447'>#</a></div><div class='texpara'><div id='stopped.opt-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.opt-3.sentence-1'>.</a></div> <div id='stopped.opt-3.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>, or
if the type <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
is ill-formed or <span class='texttt'><span class='keyword'>void</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> V <span class='operator'>=</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    then<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
         <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>V, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
           <span class='keyword'>return</span> optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>in_place, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
         <span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> just<span class='parenthesis'>(</span>optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='stopped.err' class='section'><h4 ><a class='secnum' href='#stopped.err' style='min-width:95pt'>33.9.12.14</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.stopped.err'>[exec.stopped.err]</a></h4><div class='para' id='stopped.err-1'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4471'>#</a></div><div class='texpara'><div id='stopped.err-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> maps an input sender's stopped completion operation
into an error completion operation as a custom error type<a class='hidden_link' href='#stopped.err-1.sentence-1'>.</a></div> <div id='stopped.err-1.sentence-2' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with an error<a class='hidden_link' href='#stopped.err-1.sentence-2'>.</a></div></div></div><div class='para' id='stopped.err-2'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4477'>#</a></div><div class='texpara'><div id='stopped.err-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#stopped.err-2.sentence-1'>.</a></div> <div id='stopped.err-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>err</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.err-2.sentence-2'>.</a></div> <div id='stopped.err-2.sentence-3' class='sentence'>If the type <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________'><span class='texttt'>sender</span></span></a> or
if the type <span class='texttt'>Err</span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value______'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#stopped.err-2.sentence-3'>.</a></div> <div id='stopped.err-2.sentence-4' class='sentence'>Otherwise, the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_error, err, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#stopped.err-2.sentence-4'>.</a></div></div></div><div class='para' id='stopped.err-3'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4492'>#</a></div><div class='texpara'><div id='stopped.err-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.err-3.sentence-1'>.</a></div> <div id='stopped.err-3.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for________'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>error_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, err, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> E <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span>err <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> just_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div><div id='consumers' class='section'><h3 ><a class='secnum' href='#consumers' style='min-width:80pt'>33.9.13</a> Sender consumers <a class='abbr_ref' href='exec.consumers'>[exec.consumers]</a></h3><div id='sync.wait' class='section'><h4 ><a class='secnum' href='#sync.wait' style='min-width:95pt'>33.9.13.1</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait</span> <a class='abbr_ref' href='exec.sync.wait'>[exec.sync.wait]</a></h4><div class='para' id='sync.wait-1'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4514'>#</a></div><div class='texpara'><div id='sync.wait-1.sentence-1' class='sentence'><span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> and <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span>
are used
to block the current thread of execution
until the specified sender completes and
to return its async result<a class='hidden_link' href='#sync.wait-1.sentence-1'>.</a></div> <div id='sync.wait-1.sentence-2' class='sentence'><span class='texttt'>sync_<span class='shy'></span>wait</span> mandates
that the input sender has exactly one value completion signature<a class='hidden_link' href='#sync.wait-1.sentence-2'>.</a></div></div></div><div class='para' id='sync.wait-2'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4523'>#</a></div><div class='texpara'><div id='sync.wait-2.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-env</i></span> be the following exposition-only class type:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >sync-wait-env</i> <span class='curlybracket'>{</span>
    execution<span class='operator'>::</span>run_loop<span class='operator'>*</span> <i >loop</i>;                                  <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_delegation_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='sync.wait-3'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4541'>#</a></div><div class='texpara'><div id='sync.wait-3.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-result-type</i></span> and
<span class='texttt'><i >sync-wait-with-variant-result-type</i></span>
be exposition-only alias templates defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i>, <i >decayed-tuple</i>,
               type_identity_t<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-with-variant-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='sync.wait-4'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4558'>#</a></div><div class='texpara'><div id='sync.wait-4.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> denotes a customization point object<a class='hidden_link' href='#sync.wait-4.sentence-1'>.</a></div> <div id='sync.wait-4.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-4.sentence-2'>.</a></div> <div id='sync.wait-4.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#sync.wait-4.sentence-3'>.</a></div> <div id='sync.wait-4.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to the following,
except that <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='sync.wait-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-4.1'>(4.1)</a></div><div class='texpara'><div id='sync.wait-4.1.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is well-formed<a class='hidden_link' href='#sync.wait-4.1.sentence-1'>.</a></div></div></li><li id='sync.wait-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-4.2'>(4.2)</a></div><div class='texpara'><div id='sync.wait-4.2.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the <span class='texttt'>apply_<span class='shy'></span>sender</span> expression above<a class='hidden_link' href='#sync.wait-4.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='sync.wait-5'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4578'>#</a></div><div class='texpara'><div id='sync.wait-5.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-state</i></span> and <span class='texttt'><i >sync-wait-receiver</i></span>
be the following exposition-only class templates:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-state</i> <span class='curlybracket'>{</span>                                      <span class='comment'>// <i >exposition only</i></span>
    execution<span class='operator'>::</span>run_loop <i >loop</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    exception_ptr <i >error</i>;                                        <span class='comment'>// <i >exposition only</i></span>
    <i >sync-wait-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <i >result</i>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-receiver</i> <span class='curlybracket'>{</span>                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> execution<span class='operator'>::</span>receiver_t;
    <i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <i >sync-wait-env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='operator'>&amp;</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-6'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4614'>#</a></div><div class='texpara'><div id='sync.wait-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-7'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4633'>#</a></div><div class='texpara'><div id='sync.wait-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> <i >AS-EXCEPT-PTR</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-8'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4647'>#</a></div><div class='texpara'><div id='sync.wait-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'><span class='texttt'><i >state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >loop</i></span><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-8.sentence-1'>.</a></div></div></div></div><div class='para' id='sync.wait-9'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4652'>#</a></div><div class='texpara'><div id='sync.wait-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-9.sentence-1'>.</a></div> <div id='sync.wait-9.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to___'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>sync_<span class='shy'></span>wait<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> state;
<span class='keyword'>auto</span> op <span class='operator'>=</span> connect<span class='parenthesis'>(</span>sndr, <i >sync-wait-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='operator'>&amp;</span>state<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span>;

state<span class='operator'>.</span><i >loop</i><span class='operator'>.</span>run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  rethrow_exception<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >result</i><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='sync.wait-10'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4670'>#</a></div><div class='texpara'><div id='sync.wait-10.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is undefined unless:
<ul class='itemize'><li id='sync.wait-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-10.1'>(10.1)</a></div><div class='texpara'><div id='sync.wait-10.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#sync.wait-10.1.sentence-1'>.</a></div> <div id='sync.wait-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sync.wait-note-1'>1</a></i>:&ensp;<div id='sync.wait-10.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait</span> achieves
forward progress guarantee delegation by providing a <span class='texttt'>run_<span class='shy'></span>loop</span> scheduler
via the <span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> query
on the <span class='texttt'><i >sync-wait-receiver</i></span>'s environment<a class='hidden_link' href='#sync.wait-10.1.sentence-2'>.</a></div> <div id='sync.wait-10.1.sentence-3' class='sentence'>The <span class='texttt'>run_<span class='shy'></span>loop</span> is driven by the current thread of execution<a class='hidden_link' href='#sync.wait-10.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='sync.wait-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-10.2'>(10.2)</a></div><div class='texpara'><div id='sync.wait-10.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='sync.wait-10.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.1'>(10.2.1)</a></div><div class='texpara'><div id='sync.wait-10.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in
a <span class='texttt'>tuple</span> in an engaged <span class='texttt'>optional</span> object<a class='hidden_link' href='#sync.wait-10.2.1.sentence-1'>.</a></div></div></li><li id='sync.wait-10.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.2'>(10.2.2)</a></div><div class='texpara'><div id='sync.wait-10.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#sync.wait-10.2.2.sentence-1'>.</a></div></div></li><li id='sync.wait-10.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.3'>(10.2.3)</a></div><div class='texpara'><div id='sync.wait-10.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#sync.wait-10.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div><div id='sync.wait.var' class='section'><h4 ><a class='secnum' href='#sync.wait.var' style='min-width:95pt'>33.9.13.2</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.sync.wait.var'>[exec.sync.wait.var]</a></h4><div class='para' id='sync.wait.var-1'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4700'>#</a></div><div class='texpara'><div id='sync.wait.var-1.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> denotes
a customization point object<a class='hidden_link' href='#sync.wait.var-1.sentence-1'>.</a></div> <div id='sync.wait.var-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait.var-1.sentence-2'>.</a></div> <div id='sync.wait.var-1.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#sync.wait.var-1.sentence-3'>.</a></div> <div id='sync.wait.var-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to the following,
except <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait_with_variant, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='sync.wait.var-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-1.1'>(1.1)</a></div><div class='texpara'><div id='sync.wait.var-1.1.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>
is well-formed<a class='hidden_link' href='#sync.wait.var-1.1.sentence-1'>.</a></div></div></li><li id='sync.wait.var-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-1.2'>(1.2)</a></div><div class='texpara'><div id='sync.wait.var-1.2.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the <span class='texttt'>apply_<span class='shy'></span>sender</span> expression above<a class='hidden_link' href='#sync.wait.var-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='sync.wait.var-2'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4723'>#</a></div><div class='texpara'><div id='sync.wait.var-2.sentence-1' class='sentence'>If <span class='texttt'><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable______'><span class='texttt'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>t, Sndr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#sync.wait.var-2.sentence-1'>.</a></div> <div id='sync.wait.var-2.sentence-2' class='sentence'>Otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>using</span> result_type <span class='operator'>=</span> <i >sync-wait-with-variant-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span> opt_value <span class='operator'>=</span> sync_wait<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>0</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span>opt_value<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>nullopt<span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='sync.wait.var-3'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4735'>#</a></div><div class='texpara'><div id='sync.wait.var-3.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is undefined unless:
<ul class='itemize'><li id='sync.wait.var-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-3.1'>(3.1)</a></div><div class='texpara'><div id='sync.wait.var-3.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#sync.wait.var-3.1.sentence-1'>.</a></div> <div id='sync.wait.var-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sync.wait.var-note-1'>1</a></i>:&ensp;<div id='sync.wait.var-3.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> achieves
forward progress guarantee delegation by relying on
the forward progress guarantee delegation provided by <span class='texttt'>sync_<span class='shy'></span>wait</span><a class='hidden_link' href='#sync.wait.var-3.1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='sync.wait.var-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-3.2'>(3.2)</a></div><div class='texpara'><div id='sync.wait.var-3.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='sync.wait.var-3.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.1'>(3.2.1)</a></div><div class='texpara'><div id='sync.wait.var-3.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in an engaged <span class='texttt'>optional</span> object
that contains a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#sync.wait.var-3.2.1.sentence-1'>.</a></div></div></li><li id='sync.wait.var-3.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.2'>(3.2.2)</a></div><div class='texpara'><div id='sync.wait.var-3.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#sync.wait.var-3.2.2.sentence-1'>.</a></div></div></li><li id='sync.wait.var-3.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.3'>(3.2.3)</a></div><div class='texpara'><div id='sync.wait.var-3.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#sync.wait.var-3.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div></div></div><div id='util' class='section'><h2 ><a class='secnum' href='#util' style='min-width:65pt'>33.10</a> Sender/receiver utilities <a class='abbr_ref' href='exec.util'>[exec.util]</a></h2><div id='util.cmplsig' class='section'><h3 ><a class='secnum' href='#util.cmplsig' style='min-width:80pt'>33.10.1</a> <span class='texttt'>execution&#x200b;::&#x200b;completion_<span class='shy'></span>signatures</span> <a class='abbr_ref' href='exec.util.cmplsig'>[exec.util.cmplsig]</a></h3><div class='para' id='util.cmplsig-1'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4766'>#</a></div><div class='texpara'><div id='util.cmplsig-1.sentence-1' class='sentence'><span class='texttt'>completion_<span class='shy'></span>signatures</span> is a type
that encodes a set of completion signatures (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#util.cmplsig-1.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='util.cmplsig-2'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4770'>#</a></div><div class='texpara'><div id='util.cmplsig-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#util.cmplsig-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> my_sender <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
  <span class='keyword'>using</span> completion_signatures <span class='operator'>=</span>
    execution<span class='operator'>::</span>completion_signatures<span class='anglebracket'>&lt;</span>
      set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>,
      set_value_t<span class='parenthesis'>(</span><span class='keyword'>int</span>, <span class='keyword'>float</span><span class='parenthesis'>)</span>,
      set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
      set_error_t<span class='parenthesis'>(</span>error_code<span class='parenthesis'>)</span>,
      set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>;
</span> <div id='util.cmplsig-2.sentence-1' class='sentence'>
Declares <span class='texttt'>my_<span class='shy'></span>sender</span> to be a sender
that can complete by calling one of the following
for a receiver expression <span class='texttt'>rcvr</span>:
<ul class='itemize'><li id='util.cmplsig-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-2.1'>(2.1)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span></li><li id='util.cmplsig-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-2.2'>(2.2)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, <span class='keyword'>int</span><span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span>, <span class='keyword'>float</span><span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='util.cmplsig-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-2.3'>(2.3)</a></div><span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, exception_<span class='shy'></span>ptr<span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='util.cmplsig-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-2.4'>(2.4)</a></div><span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, error_<span class='shy'></span>code<span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='util.cmplsig-2.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-2.5'>(2.5)</a></div><span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span></li></ul></div> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='util.cmplsig-3'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4796'>#</a></div><div class='texpara'><div id='util.cmplsig-3.sentence-1' class='sentence'>This subclause makes use of the following exposition-only entities:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:completion-signature' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures&emsp;[exec.util.cmplsig]'><span id='concept:completion-signature'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
</span></div></div></div><div class='para' id='util.cmplsig-4'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4803'>#</a></div><div class='texpara'><div id='util.cmplsig-4.sentence-1' class='sentence'>A type <span class='texttt'>Fn</span> satisfies <a href='#concept:completion-signature' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures&emsp;[exec.util.cmplsig]'><span id='conceptref:completion-signature__'><span class='texttt'><i >completion-signature</i></span></span></a>
if and only if it is a function type with one of the following forms:
<ul class='itemize'><li id='util.cmplsig-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-4.1'>(4.1)</a></div><div class='texpara'><div id='util.cmplsig-4.1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>Vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>Vs</span> is a pack of object or reference types<a class='hidden_link' href='#util.cmplsig-4.1.sentence-1'>.</a></div></div></li><li id='util.cmplsig-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-4.2'>(4.2)</a></div><div class='texpara'><div id='util.cmplsig-4.2.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>,
where <span class='texttt'>Err</span> is an object or reference type<a class='hidden_link' href='#util.cmplsig-4.2.sentence-1'>.</a></div></div></li><li id='util.cmplsig-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#util.cmplsig-4.3'>(4.3)</a></div><div class='texpara'><div id='util.cmplsig-4.3.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></div></div></li></ul></div></div></div><div class='para' id='util.cmplsig-5'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4817'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >indirect-meta-apply</i> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >meta-apply</i> <span class='operator'>=</span> T<span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;                              <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:always-true' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures&emsp;[exec.util.cmplsig]'><span id='concept:always-true'><span class='tcode_in_codeblock'><i >always-true</i></span></span></a> <span class='operator'>=</span> <span class='literal'>true</span>;                                   <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag,
         <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures________'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> Completions,
         <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple,
         <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >gather-signatures</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
</span></div></div><div class='para' id='util.cmplsig-6'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4835'>#</a></div><div class='texpara'><div id='util.cmplsig-6.sentence-1' class='sentence'>Let <span class='texttt'>Fns</span> be a pack of the arguments of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by <span class='texttt'>Completions</span>,
let <span class='texttt'>TagFns</span> be a pack of the function types in <span class='texttt'>Fns</span>
whose return types are <span class='texttt'>Tag</span>, and
let <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">Ts</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> be a pack of the function argument types
in the <span class='math'><span class='mathalpha'>n</span></span>-th type in <span class='texttt'>TagFns</span><a class='hidden_link' href='#util.cmplsig-6.sentence-1'>.</a></div> <div id='util.cmplsig-6.sentence-2' class='sentence'>Then, given two variadic templates <span class='texttt'>Tuple</span> and <span class='texttt'>Variant</span>,
the type <span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>Tag, Completions, Tuple, Variant<span class='anglebracket'>&gt;</span></span>
names the type
<span class='codeblock'><i >META-APPLY</i><span class='parenthesis'>(</span>Variant, <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
                    <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
                    &hellip;,
                    <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">m</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
where <span class='math'><span class='mathalpha'>m</span></span> is the size of the pack <span class='texttt'>TagFns</span> and
<span class='texttt'>META<span class='operator'>-</span>APPLY<span class='parenthesis'>(</span>T, As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>typename</span> <i >indirect-meta-apply</i><span class='anglebracket'>&lt;</span><i >always-true</i><span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><span class='keyword'>template</span> <i >meta-apply</i><span class='anglebracket'>&lt;</span>T, As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para nonNormativeOnly' id='util.cmplsig-7'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4857'>#</a></div><div class='texpara'><div id='util.cmplsig-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#util.cmplsig-note-1'>1</a></i>:&ensp;<div id='util.cmplsig-7.sentence-1' class='sentence'>The purpose of <span class='texttt'><i >META-APPLY</i></span> is to make it valid
to use non-variadic templates as <span class='texttt'>Variant</span> and <span class='texttt'>Tuple</span> arguments
to <span class='texttt'><i >gather-signatures</i></span><a class='hidden_link' href='#util.cmplsig-7.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='util.cmplsig-8'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4864'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:completion-signature' title='33.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures&emsp;[exec.util.cmplsig]'><span id='conceptref:completion-signature___'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Fns<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> completion_signatures <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple <span class='operator'>=</span> <i >decayed-tuple</i>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> value_types_of_t <span class='operator'>=</span>
      <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_value_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>, Tuple, Variant<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> error_types_of_t <span class='operator'>=</span>
      <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_error_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
                        type_identity_t, Variant<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> sends_stopped <span class='operator'>=</span>
      <span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><i >type-list</i><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
               <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_stopped_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
                                 <i >type-list</i>, <i >type-list</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='util.cmplsig.trans' class='section'><h3 ><a class='secnum' href='#util.cmplsig.trans' style='min-width:80pt'>33.10.2</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> <a class='abbr_ref' href='exec.util.cmplsig.trans'>[exec.util.cmplsig.trans]</a></h3><div class='para' id='util.cmplsig.trans-1'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4895'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-1.sentence-1' class='sentence'><span class='texttt'>transform_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> is an alias template
used to transform one set of completion signatures into another<a class='hidden_link' href='#util.cmplsig.trans-1.sentence-1'>.</a></div> <div id='util.cmplsig.trans-1.sentence-2' class='sentence'>It takes a set of completion signatures and
several other template arguments
that apply modifications to each completion signature in the set
to generate a new specialization of <span class='texttt'>completion_<span class='shy'></span>signature</span>s<a class='hidden_link' href='#util.cmplsig.trans-1.sentence-2'>.</a></div></div></div><div class='para nonNormativeOnly' id='util.cmplsig.trans-2'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4902'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#util.cmplsig.trans-example-1'>1</a></i>:&ensp;<div id='util.cmplsig.trans-2.sentence-1' class='sentence'>Given a sender <span class='texttt'>Sndr</span> and an environment <span class='texttt'>Env</span>,
adapt the completion signatures of <span class='texttt'>Sndr</span> by
lvalue-ref qualifying the values,
adding an additional <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion
if it is not already there, and
leaving the other completion signatures alone<a class='hidden_link' href='#util.cmplsig.trans-2.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> my_set_value_t <span class='operator'>=</span>
    completion_signatures<span class='anglebracket'>&lt;</span>
      set_value_t<span class='parenthesis'>(</span>add_lvalue_reference_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

<span class='keyword'>using</span> my_completion_signatures <span class='operator'>=</span>
  transform_completion_signatures<span class='anglebracket'>&lt;</span>
    completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
    completion_signatures<span class='anglebracket'>&lt;</span>set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>,
    my_set_value_t<span class='anglebracket'>&gt;</span>;
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='util.cmplsig.trans-3'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4924'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-3.sentence-1' class='sentence'>This subclause makes use of the following exposition-only entities:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >default-set-value</i> <span class='operator'>=</span>
    completion_signatures<span class='anglebracket'>&lt;</span>set_value_t<span class='parenthesis'>(</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Err<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >default-set-error</i> <span class='operator'>=</span>
    completion_signatures<span class='anglebracket'>&lt;</span>set_error_t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
</span></div></div></div><div class='para' id='util.cmplsig.trans-4'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4936'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_________'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> InputSignatures,
           <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures__________'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> AdditionalSignatures <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetValue <span class='operator'>=</span> <i >default-set-value</i>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> SetError <span class='operator'>=</span> <i >default-set-error</i>,
           <a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures___________'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> SetStopped <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span>set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> transform_completion_signatures <span class='operator'>=</span> completion_signatures<span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='util.cmplsig.trans-5'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4948'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-5.sentence-1' class='sentence'><span class='texttt'>SetValue</span> shall name an alias template
such that for any pack of types <span class='texttt'>As</span>,
the type <span class='texttt'>SetValue<span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> is either ill-formed or else
<span class='texttt'><a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures____________'><span class='texttt'><i >valid-completion-signatures</i></span></span></a><span class='anglebracket'>&lt;</span>SetValue<span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is satisfied<a class='hidden_link' href='#util.cmplsig.trans-5.sentence-1'>.</a></div> <div id='util.cmplsig.trans-5.sentence-2' class='sentence'><span class='texttt'>SetError</span> shall name an alias template
such that for any type <span class='texttt'>Err</span>,
<span class='texttt'>SetError<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> is either ill-formed or else
<span class='texttt'><a href='#concept:valid-completion-signatures' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_____________'><span class='texttt'><i >valid-completion-signatures</i></span></span></a><span class='anglebracket'>&lt;</span>SetError<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is satisfied<a class='hidden_link' href='#util.cmplsig.trans-5.sentence-2'>.</a></div></div></div><div class='para' id='util.cmplsig.trans-6'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4958'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-6.sentence-1' class='sentence'>Let <span class='texttt'>Vs</span> be a pack of the types in the <span class='texttt'><i >type-list</i></span> named by
<span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t, InputSignatures, SetValue, <span class='texttt'><i >type-list</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#util.cmplsig.trans-6.sentence-1'>.</a></div></div></div><div class='para' id='util.cmplsig.trans-7'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4962'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-7.sentence-1' class='sentence'>Let <span class='texttt'>Es</span> be a pack of the types in the <span class='texttt'><i >type-list</i></span> named by
<span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>error_<span class='shy'></span>t, InputSignatures, type_<span class='shy'></span>identity_<span class='shy'></span>t, <span class='texttt'><i >error-list</i></span><span class='anglebracket'>&gt;</span></span>,
where <span class='texttt'><i >error-list</i></span> is an alias template
such that <span class='texttt'><span class='texttt'><i >error-list</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> is
<span class='texttt'><span class='texttt'><i >type-list</i></span><span class='anglebracket'>&lt;</span>SetError<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#util.cmplsig.trans-7.sentence-1'>.</a></div></div></div><div class='para' id='util.cmplsig.trans-8'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4969'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-8.sentence-1' class='sentence'>Let <span class='texttt'>Ss</span> name the type <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span> if
<span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t, InputSignatures, <span class='texttt'><i >type-list</i></span>, <span class='texttt'><i >type-list</i></span><span class='anglebracket'>&gt;</span></span>
is an alias for the type <span class='texttt'><span class='texttt'><i >type-list</i></span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span>;
otherwise, <span class='texttt'>SetStopped</span><a class='hidden_link' href='#util.cmplsig.trans-8.sentence-1'>.</a></div></div></div><div class='para' id='util.cmplsig.trans-9'><div class='marginalizedparent'><a class='marginalized' href='#util.cmplsig.trans-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L4975'>#</a></div><div class='texpara'><div id='util.cmplsig.trans-9.sentence-1' class='sentence'>If any of the above types are ill-formed,
then
<span class='codeblock'>transform_completion_signatures<span class='anglebracket'>&lt;</span>InputSignatures, AdditionalSignatures,
                                SetValue, SetError, SetStopped<span class='anglebracket'>&gt;</span>
</span>
is ill-formed<a class='hidden_link' href='#util.cmplsig.trans-9.sentence-1'>.</a></div> <div id='util.cmplsig.trans-9.sentence-2' class='sentence'>Otherwise,
<span class='codeblock'>transform_completion_signatures<span class='anglebracket'>&lt;</span>InputSignatures, AdditionalSignatures,
                                SetValue, SetError, SetStopped<span class='anglebracket'>&gt;</span>
</span>
is the type <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
where <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> is the unique set of types in all the template arguments
of all the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specializations in the set
<span class='texttt'>AdditionalSignatures</span>, <span class='texttt'>Vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, <span class='texttt'>Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, <span class='texttt'>Ss</span><a class='hidden_link' href='#util.cmplsig.trans-9.sentence-2'>.</a></div></div></div></div></div><div id='envs' class='section'><h2 ><a class='secnum' href='#envs' style='min-width:65pt'>33.11</a> Queryable utilities <a class='abbr_ref' href='exec.envs'>[exec.envs]</a></h2><div id='prop' class='section'><h3 ><a class='secnum' href='#prop' style='min-width:80pt'>33.11.1</a> Class template <span class='texttt'>prop</span> <a class='abbr_ref' href='exec.prop'>[exec.prop]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span id='lib:prop'><a class='hidden_link' href='#lib:prop' title='33.11.1&emsp;Class template prop&emsp;[exec.prop]'>prop</a></span> <span class='curlybracket'>{</span>
    QueryTag <i >query_</i>;            <span class='comment'>// <i >exposition only</i></span>
    ValueType <i >value_</i>;           <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>constexpr</span> <span class='keyword'>const</span> ValueType<span class='operator'>&amp;</span> query<span class='parenthesis'>(</span>QueryTag<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >value_</i>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
    prop<span class='parenthesis'>(</span>QueryTag, ValueType<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> prop<span class='anglebracket'>&lt;</span>QueryTag, unwrap_reference_t<span class='anglebracket'>&lt;</span>ValueType<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='prop-1'><div class='marginalizedparent'><a class='marginalized' href='#prop-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5014'>#</a></div><div class='texpara'><div id='prop-1.sentence-1' class='sentence'>Class template <span class='texttt'>prop</span> is for building a queryable object
from a query object and a value<a class='hidden_link' href='#prop-1.sentence-1'>.</a></div></div></div><div class='para' id='prop-2'><div class='marginalizedparent'><a class='marginalized' href='#prop-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5018'>#</a></div><div class='texpara'><div id='prop-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_______'><span class='texttt'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>QueryTag, <span class='texttt'><i >prop-like</i></span><span class='anglebracket'>&lt;</span>ValueType<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is modeled,
where <span class='texttt'><i >prop-like</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >prop-like</i> <span class='curlybracket'>{</span>              <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>const</span> ValueType<span class='operator'>&amp;</span> query<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para nonNormativeOnly' id='prop-3'><div class='marginalizedparent'><a class='marginalized' href='#prop-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5030'>#</a></div><div class='texpara'><div id='prop-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#prop-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
sender <span class='keyword'>auto</span> parameterize_work<span class='parenthesis'>(</span>Sndr sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='comment'>// Make an environment such that <span class='tcode_in_codeblock'>get_<span class='shy'></span>allocator(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>alloc{}</span>.</span>
  <span class='keyword'>auto</span> e <span class='operator'>=</span> prop<span class='parenthesis'>(</span>get_allocator, my_alloc<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;

  <span class='comment'>// Parameterize the input sender so that it will use our custom execution environment.</span>
  <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>sndr, e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='prop-4'><div class='marginalizedparent'><a class='marginalized' href='#prop-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5044'>#</a></div><div class='texpara'><div id='prop-4.sentence-1' class='sentence'>Specializations of <span class='texttt'>prop</span> are not assignable<a class='hidden_link' href='#prop-4.sentence-1'>.</a></div></div></div></div><div id='env' class='section'><h3 ><a class='secnum' href='#env' style='min-width:80pt'>33.11.2</a> Class template <span class='texttt'>env</span> <a class='abbr_ref' href='exec.env'>[exec.env]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span id='lib:env'><a class='hidden_link' href='#lib:env' title='33.11.2&emsp;Class template env&emsp;[exec.env]'>env</a></span> <span class='curlybracket'>{</span>
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>;               <span class='comment'>// <i >exposition only</i></span>
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>;               <span class='comment'>// <i >exposition only</i></span>
      &#8942;
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span>;           <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
      <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> query<span class='parenthesis'>(</span>QueryTag q<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
    env<span class='parenthesis'>(</span>Envs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> env<span class='anglebracket'>&lt;</span>unwrap_reference_t<span class='anglebracket'>&lt;</span>Envs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='env-1'><div class='marginalizedparent'><a class='marginalized' href='#env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5067'>#</a></div><div class='texpara'><div id='env-1.sentence-1' class='sentence'>The class template <span class='texttt'>env</span> is used to construct a queryable object
from several queryable objects<a class='hidden_link' href='#env-1.sentence-1'>.</a></div> <div id='env-1.sentence-2' class='sentence'>Query invocations on the resulting object are resolved
by attempting to query each subobject in lexical order<a class='hidden_link' href='#env-1.sentence-2'>.</a></div></div></div><div class='para' id='env-2'><div class='marginalizedparent'><a class='marginalized' href='#env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5073'>#</a></div><div class='texpara'><div id='env-2.sentence-1' class='sentence'>Specializations of <span class='texttt'>env</span> are not assignable<a class='hidden_link' href='#env-2.sentence-1'>.</a></div></div></div><div class='para' id='env-3'><div class='marginalizedparent'><a class='marginalized' href='#env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5076'>#</a></div><div class='texpara'><div id='env-3.sentence-1' class='sentence'>It is unspecified
whether <span class='texttt'>env</span> supports initialization
using a parenthesized <a href='expr.post.general#nt:expression-list' title='7.6.1.1&emsp;General&emsp;[expr.post.general]'><span id='ntref:expression-list'><span class='textsf'><i >expression-list</i></span></span></a> (<a href='dcl.init' title='9.5&emsp;Initializers'>[dcl.<span class='shy'></span>init]</a>),
unless the <a href='expr.post.general#nt:expression-list' title='7.6.1.1&emsp;General&emsp;[expr.post.general]'><span id='ntref:expression-list_'><span class='textsf'><i >expression-list</i></span></span></a> consist of
a single element of type (possibly const) <span class='texttt'>env</span><a class='hidden_link' href='#env-3.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='env-4'><div class='marginalizedparent'><a class='marginalized' href='#env-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5083'>#</a></div><div class='texpara'><div id='env-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#env-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
sender <span class='keyword'>auto</span> parameterize_work<span class='parenthesis'>(</span>Sndr sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='comment'>// Make an environment such that:</span>
  <span class='comment'>//   <span class='tcode_in_codeblock'>get_<span class='shy'></span>allocator(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>alloc{}</span></span>
  <span class='comment'>//   <span class='tcode_in_codeblock'>get_<span class='shy'></span>scheduler(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>sched{}</span></span>
  <span class='keyword'>auto</span> e <span class='operator'>=</span> env<span class='curlybracket'>{</span>prop<span class='parenthesis'>(</span>get_allocator, my_alloc<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
               prop<span class='parenthesis'>(</span>get_scheduler, my_sched<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='curlybracket'>}</span>;

  <span class='comment'>// Parameterize the input sender so that it will use our custom execution environment.</span>
  <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>sndr, e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='texpara'><div id='lib:env,query'><div id='lib:query,env'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:query,env'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> query<span class='parenthesis'>(</span>QueryTag q<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='env-5'><div class='marginalizedparent'><a class='marginalized' href='#env-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5107'>#</a></div><div class='texpara'><div id='env-5.sentence-1' class='sentence'>Let <a href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='conceptref:has-query'><span class='texttt'><i >has-query</i></span></span></a> be the following exposition-only concept:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env, <span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='concept:has-query'><span class='tcode_in_codeblock'><i >has-query</i></span></span></a> <span class='operator'>=</span>                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      env<span class='operator'>.</span>query<span class='parenthesis'>(</span>QueryTag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;
</span></div></div></div></div><div class='para' id='env-6'><div class='marginalizedparent'><a class='marginalized' href='#env-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5117'>#</a></div><div class='texpara'><div id='env-6.sentence-1' class='sentence'>Let <span class='texttt'><i >fe</i></span> be the first element of
<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>, <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span>
such that the expression <span class='texttt'><span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#env-6.sentence-1'>.</a></div></div></div></div><div class='para' id='env-7'><div class='marginalizedparent'><a class='marginalized' href='#env-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5122'>#</a></div><div class='texpara'><div id='env-7.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><span class='parenthesis'>(</span><a href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='conceptref:has-query_'><span class='texttt'><i >has-query</i></span></span></a><span class='anglebracket'>&lt;</span>Envs, QueryTag<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#env-7.sentence-1'>.</a></div></div></div></div><div class='para' id='env-8'><div class='marginalizedparent'><a class='marginalized' href='#env-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5126'>#</a></div><div class='texpara'><div id='env-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> <span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span>;</span></div></div></div></div><div class='para' id='env-9'><div class='marginalizedparent'><a class='marginalized' href='#env-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5130'>#</a></div><div class='texpara'><div id='env-9.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is equivalent
to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#env-9.sentence-1'>.</a></div></div></div></div></div></div><div id='ctx' class='section'><h2 ><a class='secnum' href='#ctx' style='min-width:65pt'>33.12</a> Execution contexts <a class='abbr_ref' href='exec.ctx'>[exec.ctx]</a></h2><div id='run.loop' class='section'><h3 ><a class='secnum' href='#run.loop' style='min-width:80pt'>33.12.1</a> <span class='texttt'>execution&#x200b;::&#x200b;run_<span class='shy'></span>loop</span> <a class='abbr_ref' href='exec.run.loop'>[exec.run.loop]</a></h3><div id='run.loop.general' class='section'><h4 ><a class='secnum' href='#run.loop.general' style='min-width:95pt'>33.12.1.1</a> General <a class='abbr_ref' href='exec.run.loop.general'>[exec.run.loop.general]</a></h4><div class='para' id='run.loop.general-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5142'>#</a></div><div class='texpara'><div id='run.loop.general-1.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> is an execution resource on which work can be scheduled<a class='hidden_link' href='#run.loop.general-1.sentence-1'>.</a></div> <div id='run.loop.general-1.sentence-2' class='sentence'>It maintains a thread-safe first-in-first-out queue of work<a class='hidden_link' href='#run.loop.general-1.sentence-2'>.</a></div> <div id='run.loop.general-1.sentence-3' class='sentence'>Its <span class='texttt'>run</span> member function removes elements from the queue and
executes them in a loop on the thread of execution that calls <span class='texttt'>run</span><a class='hidden_link' href='#run.loop.general-1.sentence-3'>.</a></div></div></div><div class='para' id='run.loop.general-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5148'>#</a></div><div class='texpara'><div id='run.loop.general-2.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated <a class='hidden_link' href='#def:count' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:count'><i >count</i></span></a>
that corresponds to the number of work items that are in its queue<a class='hidden_link' href='#run.loop.general-2.sentence-1'>.</a></div> <div id='run.loop.general-2.sentence-2' class='sentence'>Additionally, a <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated state
that can be one of
<a class='hidden_link' href='#def:starting' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:starting'><i >starting</i></span></a>, <a class='hidden_link' href='#def:running' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:running'><i >running</i></span></a>, <a class='hidden_link' href='#def:finishing' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finishing'><i >finishing</i></span></a>, or <a class='hidden_link' href='#def:finished' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finished'><i >finished</i></span></a><a class='hidden_link' href='#run.loop.general-2.sentence-2'>.</a></div></div></div><div class='para' id='run.loop.general-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5155'>#</a></div><div class='texpara'><div id='run.loop.general-3.sentence-1' class='sentence'>Concurrent invocations of the member functions of <span class='texttt'>run_<span class='shy'></span>loop</span>
other than <span class='texttt'>run</span> and its destructor do not introduce data races<a class='hidden_link' href='#run.loop.general-3.sentence-1'>.</a></div> <div id='run.loop.general-3.sentence-2' class='sentence'>The member functions
<span class='texttt'><i >pop-front</i></span>, <span class='texttt'><i >push-back</i></span>, and <span class='texttt'>finish</span>
execute atomically<a class='hidden_link' href='#run.loop.general-3.sentence-2'>.</a></div></div></div><div class='para' id='run.loop.general-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5162'>#</a></div><div class='texpara'><div id='run.loop.general-4.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use an intrusive queue of operation states
to hold the work units to make scheduling allocation-free<a class='hidden_link' href='#run.loop.general-4.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:run_loop'><a class='hidden_link' href='#lib:run_loop' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'>run_loop</a></span> <span class='curlybracket'>{</span>
    <span class='comment'>// <a href='#run.loop.types' title='33.12.1.2&emsp;Associated types'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>types]</a>, associated types</span>
    <span class='keyword'>class</span> <i >run-loop-scheduler</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>class</span> <i >run-loop-sender</i>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>struct</span> <i >run-loop-opstate-base</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='literal'>0</span>;                               <span class='comment'>// <i >exposition only</i></span>
      run_loop<span class='operator'>*</span> <i >loop</i>;                                           <span class='comment'>// <i >exposition only</i></span>
      run<span class='operator'>-</span>loop<span class='operator'>-</span>opstate<span class='operator'>-</span>base<span class='operator'>*</span> <i >next</i>;                              <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >run-loop-opstate</i> <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

    <span class='comment'>// <a href='#run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >push-back</i><span class='parenthesis'>(</span><i >run-loop-opstate-base</i><span class='operator'>*</span><span class='parenthesis'>)</span>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#run.loop.ctor' title='33.12.1.3&emsp;Constructor and destructor'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>ctor]</a>, constructor and destructor</span>
    run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    run_loop<span class='parenthesis'>(</span>run_loop<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='#run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-scheduler</i> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='run.loop.types' class='section'><h4 ><a class='secnum' href='#run.loop.types' style='min-width:95pt'>33.12.1.2</a> Associated types <a class='abbr_ref' href='exec.run.loop.types'>[exec.run.loop.types]</a></h4><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-scheduler</i></span>;
</code></div></div><div class='para' id='run.loop.types-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5205'>#</a></div><div class='texpara'><div id='run.loop.types-1.sentence-1' class='sentence'><span class='texttt'><i >run-loop-scheduler</i></span> is an unspecified type
that models <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______________'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#run.loop.types-1.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5209'>#</a></div><div class='texpara'><div id='run.loop.types-2.sentence-1' class='sentence'>Instances of <span class='texttt'><i >run-loop-scheduler</i></span> remain valid
until the end of the lifetime of the <span class='texttt'>run_<span class='shy'></span>loop</span> instance
from which they were obtained<a class='hidden_link' href='#run.loop.types-2.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5214'>#</a></div><div class='texpara'><div id='run.loop.types-3.sentence-1' class='sentence'>Two instances of <span class='texttt'><i >run-loop-scheduler</i></span> compare equal
if and only if they were obtained from the same <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.types-3.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5218'>#</a></div><div class='texpara'><div id='run.loop.types-4.sentence-1' class='sentence'>Let <span class='texttt'><i >sch</i></span> be an expression of type <span class='texttt'><i >run-loop-scheduler</i></span><a class='hidden_link' href='#run.loop.types-4.sentence-1'>.</a></div> <div id='run.loop.types-4.sentence-2' class='sentence'>The expression <span class='texttt'>schedule<span class='parenthesis'>(</span><span class='texttt'><i >sch</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><i >run-loop-<br>sender</i></span> and
is not potentially-throwing if <span class='texttt'><i >sch</i></span> is not potentially-throwing<a class='hidden_link' href='#run.loop.types-4.sentence-2'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-sender</i></span>;
</code></div></div><div class='para' id='run.loop.types-5'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5228'>#</a></div><div class='texpara'><div id='run.loop.types-5.sentence-1' class='sentence'><span class='texttt'><i >run-loop-sender</i></span> is an exposition-only type
that satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#run.loop.types-5.sentence-1'>.</a></div> <div id='run.loop.types-5.sentence-2' class='sentence'>For any type <span class='texttt'>Env</span>,
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >run-loop-sender</i></span>, Env<span class='anglebracket'>&gt;</span></span> is
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='run.loop.types-6'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5237'>#</a></div><div class='texpara'><div id='run.loop.types-6.sentence-1' class='sentence'>An instance of <span class='texttt'><i >run-loop-sender</i></span> remains valid
until the end of the lifetime of its associated <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.types-6.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-7'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5241'>#</a></div><div class='texpara'><div id='run.loop.types-7.sentence-1' class='sentence'>Let <span class='texttt'><i >sndr</i></span> be an expression of type <span class='texttt'><i >run-loop-sender</i></span>,
let <span class='texttt'><i >rcvr</i></span> be an expression
such that <span class='texttt'><a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of____'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, CS<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
where <span class='texttt'>CS</span> is the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization above<a class='hidden_link' href='#run.loop.types-7.sentence-1'>.</a></div> <div id='run.loop.types-7.sentence-2' class='sentence'>Let <span class='texttt'>C</span> be either <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#run.loop.types-7.sentence-2'>.</a></div> <div id='run.loop.types-7.sentence-3' class='sentence'>Then:
<ul class='itemize'><li id='run.loop.types-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-7.1'>(7.1)</a></div><div class='texpara'><div id='run.loop.types-7.1.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span>, <span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
and is potentially-throwing if and only if
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is potentially-throwing<a class='hidden_link' href='#run.loop.types-7.1.sentence-1'>.</a></div></div></li><li id='run.loop.types-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-7.2'>(7.2)</a></div><div class='texpara'><div id='run.loop.types-7.2.sentence-1' class='sentence'>The expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>C<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is potentially-throwing if and only if <span class='texttt'><i >sndr</i></span> is potentially-throwing,
has type <span class='texttt'><i >run-loop-scheduler</i></span>, and
compares equal to the <span class='texttt'><i >run-loop-<br>scheduler</i></span> instance
from which <span class='texttt'><i >sndr</i></span> was obtained<a class='hidden_link' href='#run.loop.types-7.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span class='texttt'><i >run-loop-opstate</i></span>;
</code></div></div><div class='para' id='run.loop.types-8'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5267'>#</a></div><div class='texpara'><div id='run.loop.types-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>
inherits privately and unambiguously from <span class='texttt'><i >run-loop-opstate-base</i></span><a class='hidden_link' href='#run.loop.types-8.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-9'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5271'>#</a></div><div class='texpara'><div id='run.loop.types-9.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>o</span></span> be a non-const lvalue of type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>,
and let <span class='texttt'>REC<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> be a non-const lvalue reference to an instance of type <span class='texttt'>Rcvr</span>
that was initialized with the expression <span class='texttt'><i >rcvr</i></span>
passed to the invocation of connect that returned <span class='math'><span class='mathalpha'>o</span></span><a class='hidden_link' href='#run.loop.types-9.sentence-1'>.</a></div> <div id='run.loop.types-9.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='run.loop.types-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.1'>(9.1)</a></div>The object to which <span class='texttt'><span class='texttt'><i >REC</i></span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> refers
remains valid for the lifetime of the object to which <span class='math'><span class='mathalpha'>o</span></span> refers.</li><li id='run.loop.types-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.2'>(9.2)</a></div>The type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> overrides
<span class='texttt'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
such that <span class='texttt'><span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span>get_stop_token<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li><li id='run.loop.types-9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.3'>(9.3)</a></div>The expression <span class='texttt'>start<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >push-back</i><span class='parenthesis'>(</span>addressof<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li></ul></div></div></div></div><div id='run.loop.ctor' class='section'><h4 ><a class='secnum' href='#run.loop.ctor' style='min-width:95pt'>33.12.1.3</a> Constructor and destructor <a class='abbr_ref' href='exec.run.loop.ctor'>[exec.run.loop.ctor]</a></h4><div class='texpara'><div id='lib:run_loop,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='run.loop.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5311'>#</a></div><div class='texpara'><div id='run.loop.ctor-1.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >count</i></span> is <span class='texttt'><span class='literal'>0</span></span> and <span class='texttt'><i >state</i></span> is <span class='texttt'><i >starting</i></span><a class='hidden_link' href='#run.loop.ctor-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='run.loop.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5322'>#</a></div><div class='texpara'><div id='run.loop.ctor-2.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >count</i></span> is not <span class='texttt'><span class='literal'>0</span></span> or if <span class='texttt'><i >state</i></span> is <span class='texttt'><i >running</i></span>,
invokes <span class='texttt'>terminate</span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#run.loop.ctor-2.sentence-1'>.</a></div> <div id='run.loop.ctor-2.sentence-2' class='sentence'>Otherwise, has no effects<a class='hidden_link' href='#run.loop.ctor-2.sentence-2'>.</a></div></div></div></div></div><div id='run.loop.members' class='section'><h4 ><a class='secnum' href='#run.loop.members' style='min-width:95pt'>33.12.1.4</a> Member functions <a class='abbr_ref' href='exec.run.loop.members'>[exec.run.loop.members]</a></h4><div class='texpara'><div class='itemdecl' id='run.loop.members-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.members-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> <span class='texttt'><i >pop-front</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='run.loop.members-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5336'>#</a></div><div class='texpara'><div id='run.loop.members-1.sentence-1' class='sentence'><i >Effects</i>: Blocks (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>) until one of the following conditions is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='run.loop.members-1.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#run.loop.members-1.1'>(1.1)</a></div><span class='texttt'><i >count</i></span> is <span class='texttt'><span class='literal'>0</span></span> and <span class='texttt'><i >state</i></span> is <span class='texttt'><i >finishing</i></span>,
in which case <span class='texttt'><i >pop-front</i></span> sets <span class='texttt'><i >state</i></span> to <span class='texttt'><i >finished</i></span>
and returns <span class='texttt'><span class='literal'>nullptr</span></span>; or</li><li id='run.loop.members-1.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#run.loop.members-1.2'>(1.2)</a></div><span class='texttt'><i >count</i></span> is greater than <span class='texttt'><span class='literal'>0</span></span>,
in which case an item is removed from the front of the queue,
<span class='texttt'><i >count</i></span> is decremented by <span class='texttt'><span class='literal'>1</span></span>, and
the removed item is returned<a class='hidden_link' href='#run.loop.members-1.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.members-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.members-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >push-back</i></span><span class='parenthesis'>(</span><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> item<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='run.loop.members-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5357'>#</a></div><div class='texpara'><div id='run.loop.members-2.sentence-1' class='sentence'><i >Effects</i>: Adds <span class='texttt'>item</span> to the back of the queue and
increments <span class='texttt'><i >count</i></span> by <span class='texttt'><span class='literal'>1</span></span><a class='hidden_link' href='#run.loop.members-2.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5362'>#</a></div><div class='texpara'><div id='run.loop.members-3.sentence-1' class='sentence'><i >Synchronization</i>: This operation synchronizes with
the <span class='texttt'><i >pop-front</i></span> operation that obtains <span class='texttt'>item</span><a class='hidden_link' href='#run.loop.members-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,get_scheduler'><div id='lib:get_scheduler,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_scheduler,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-scheduler</i></span> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5374'>#</a></div><div class='texpara'><div id='run.loop.members-4.sentence-1' class='sentence'><i >Returns</i>: An instance of <span class='texttt'><i >run-loop-scheduler</i></span>
that can be used to schedule work onto this <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.members-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,run'><div id='lib:run,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-5'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5386'>#</a></div><div class='texpara'><div id='run.loop.members-5.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><i >state</i></span> is either <span class='texttt'><i >starting</i></span> or <span class='texttt'><i >finishing</i></span><a class='hidden_link' href='#run.loop.members-5.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-6'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5390'>#</a></div><div class='texpara'><div id='run.loop.members-6.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >state</i></span> is <span class='texttt'><i >starting</i></span>,
sets the <span class='texttt'><i >state</i></span> to <span class='texttt'><i >running</i></span>,
otherwise leaves <span class='texttt'><i >state</i></span> unchanged<a class='hidden_link' href='#run.loop.members-6.sentence-1'>.</a></div> <div id='run.loop.members-6.sentence-2' class='sentence'>Then, equivalent to:
<span class='codeblock'><span class='keyword'>while</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>*</span> op <span class='operator'>=</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div class='para' id='run.loop.members-7'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5402'>#</a></div><div class='texpara'><div id='run.loop.members-7.sentence-1' class='sentence'><i >Remarks</i>: When <span class='texttt'><i >state</i></span> changes, it does so without introducing data races<a class='hidden_link' href='#run.loop.members-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,finish'><div id='lib:finish,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:finish,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-8'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5413'>#</a></div><div class='texpara'><div id='run.loop.members-8.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><i >state</i></span> is either <span class='texttt'><i >starting</i></span> or <span class='texttt'><i >running</i></span><a class='hidden_link' href='#run.loop.members-8.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-9'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5417'>#</a></div><div class='texpara'><div id='run.loop.members-9.sentence-1' class='sentence'><i >Effects</i>: Changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >finishing</i></span><a class='hidden_link' href='#run.loop.members-9.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-10'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5421'>#</a></div><div class='texpara'><div id='run.loop.members-10.sentence-1' class='sentence'><i >Synchronization</i>: <span class='texttt'>finish</span> synchronizes with the <span class='texttt'><i >pop-front</i></span> operation
that returns <span class='texttt'><span class='literal'>nullptr</span></span><a class='hidden_link' href='#run.loop.members-10.sentence-1'>.</a></div></div></div></div></div></div></div><div id='coro.util' class='section'><h2 ><a class='secnum' href='#coro.util' style='min-width:65pt'>33.13</a> Coroutine utilities <a class='abbr_ref' href='exec.coro.util'>[exec.coro.util]</a></h2><div id='as.awaitable' class='section'><h3 ><a class='secnum' href='#as.awaitable' style='min-width:80pt'>33.13.1</a> <span class='texttt'>execution&#x200b;::&#x200b;as_<span class='shy'></span>awaitable</span> <a class='abbr_ref' href='exec.as.awaitable'>[exec.as.awaitable]</a></h3><div class='para' id='as.awaitable-1'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5431'>#</a></div><div class='texpara'><div id='as.awaitable-1.sentence-1' class='sentence'><span class='texttt'>as_<span class='shy'></span>awaitable</span> transforms an object into one
that is awaitable within a particular coroutine<a class='hidden_link' href='#as.awaitable-1.sentence-1'>.</a></div> <div id='as.awaitable-1.sentence-2' class='sentence'>Subclause <a href='#coro.util' title='33.13&emsp;Coroutine utilities'>[exec.<span class='shy'></span>coro.<span class='shy'></span>util]</a> makes use of
the following exposition-only entities:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:awaitable-sender' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable&emsp;[exec.as.awaitable]'><span id='concept:awaitable-sender'><span class='tcode_in_codeblock'><i >awaitable-sender</i></span></span></a> <span class='operator'>=</span>
      <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender__'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <i >awaitable-receiver</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>    <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> p<span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.convertible#concept:convertible_to' title='18.4.4&emsp;Concept convertible_&shy;to&emsp;[concept.convertible]'><span id='conceptref:convertible_to'><span class='tcode_in_codeblock'>convertible_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> <i >sender-awaitable</i>;                                     <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='as.awaitable-2'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5451'>#</a></div><div class='texpara'><div id='as.awaitable-2.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sender-awaitable</i></span><span class='anglebracket'>&lt;</span>Sndr, Promise<span class='anglebracket'>&gt;</span></span> is equivalent to:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> <i >sender-awaitable</i> <span class='curlybracket'>{</span>
    <span class='keyword'>struct</span> <i >unit</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >value-type</i> <span class='operator'>=</span>                                          <span class='comment'>// <i >exposition only</i></span>
      <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >result-type </i><span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      conditional_t<span class='anglebracket'>&lt;</span>is_void_v<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span>, unit, <i >value-type</i><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>struct</span> <i >awaitable-receiver</i>;                                  <span class='comment'>// <i >exposition only</i></span>

    variant<span class='anglebracket'>&lt;</span>monostate, <i >result-type</i>, exception_ptr<span class='anglebracket'>&gt;</span> <i >result</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;    <span class='comment'>// <i >exposition only</i></span>
    connect_result_t<span class='anglebracket'>&lt;</span>Sndr, <i >awaitable-receiver</i><span class='anglebracket'>&gt;</span> <i >state</i>;           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <i >sender-awaitable</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> start<span class='parenthesis'>(</span><i >state</i><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <i >value-type</i> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='as.awaitable-3'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5477'>#</a></div><div class='texpara'><div id='as.awaitable-3.sentence-1' class='sentence'><span class='texttt'><i >awaitable-receiver</i></span> is equivalent to:
<span class='codeblock'><span class='keyword'>struct</span> <i >awaitable-receiver</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
  variant<span class='anglebracket'>&lt;</span>monostate, <i >result-type</i>, exception_ptr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >result-ptr</i>;   <span class='comment'>// <i >exposition only</i></span>
  coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span> <i >continuation</i>;                       <span class='comment'>// <i >exposition only</i></span>
  <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='as.awaitable-4'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5488'>#</a></div><div class='texpara'><div id='as.awaitable-4.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be an rvalue expression of type <span class='texttt'><i >awaitable-receiver</i></span>,
let <span class='texttt'>crcvr</span> be a const lvalue that refers to <span class='texttt'>rcvr</span>,
let <span class='texttt'>vs</span> be a pack of subexpressions, and
let <span class='texttt'>err</span> be an expression of type <span class='texttt'>Err</span><a class='hidden_link' href='#as.awaitable-4.sentence-1'>.</a></div> <div id='as.awaitable-4.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='as.awaitable-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.1'>(4.1)</a></div>If <span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from___'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >result-type</i></span>, <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>vs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
is satisfied,
the expression <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span><br>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>1</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span> <div class='texpara'><div id='as.awaitable-4.1.sentence-2' class='sentence'>
Otherwise, <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#as.awaitable-4.1.sentence-2'>.</a></div></div></li><li id='as.awaitable-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.2'>(4.2)</a></div>The expression <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, err<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'>rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >AS-EXCEPT-PTR</i><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='as.awaitable-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.3'>(4.3)</a></div>The expression <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='as.awaitable-4.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.4'>(4.4)</a></div>For any expression <span class='texttt'>tag</span>
whose type satisfies <a href='#concept:forwarding-query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:forwarding-query'><span class='texttt'><i >forwarding-query</i></span></span></a> and
for any pack of subexpressions <span class='texttt'>as</span>,
<span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>crcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>tag, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>tag<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>as_const<span class='parenthesis'>(</span>crcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></li></ul></div></div></div><div class='texpara'><div class='itemdecl' id='as.awaitable-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#as.awaitable-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >sender-awaitable</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='as.awaitable-5'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5533'>#</a></div><div class='texpara'><div id='as.awaitable-5.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >state</i></span> with
<span class='codeblock'>connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
        <i >awaitable-receiver</i><span class='curlybracket'>{</span>addressof<span class='parenthesis'>(</span>result<span class='parenthesis'>)</span>, coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_promise<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='as.awaitable-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#as.awaitable-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >value-type</i></span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='as.awaitable-6'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5547'>#</a></div><div class='texpara'><div id='as.awaitable-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span><i >result</i><span class='operator'>.</span>index<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>2</span><span class='parenthesis'>)</span>
  rethrow_exception<span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >result</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>is_void_v<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>1</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >result</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='as.awaitable-7'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5558'>#</a></div><div class='texpara'><div id='as.awaitable-7.sentence-1' class='sentence'><span class='texttt'>as_<span class='shy'></span>awaitable</span> is a customization point object<a class='hidden_link' href='#as.awaitable-7.sentence-1'>.</a></div> <div id='as.awaitable-7.sentence-2' class='sentence'>For subexpressions <span class='texttt'>expr</span> and <span class='texttt'>p</span>
where <span class='texttt'>p</span> is an lvalue,
<span class='texttt'>Expr</span> names the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Promise</span> names the type <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>expr, p<span class='parenthesis'>)</span></span> is expression-equivalent to,
except that the evaluations of <span class='texttt'>expr</span> and <span class='texttt'>p</span>
are indeterminately sequenced:
<ul class='itemize'><li id='as.awaitable-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.1'>(7.1)</a></div><div class='texpara'><div id='as.awaitable-7.1.sentence-1' class='sentence'><span class='texttt'>expr<span class='operator'>.</span>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span></span> if that expression is well-formed<a class='hidden_link' href='#as.awaitable-7.1.sentence-1'>.</a></div></div><div class='texpara'><div id='as.awaitable-7.1.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable____'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>A, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
where <span class='texttt'>A</span> is the type of the expression above<a class='hidden_link' href='#as.awaitable-7.1.sentence-2'>.</a></div></div></li><li id='as.awaitable-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.2'>(7.2)</a></div><div class='texpara'><div id='as.awaitable-7.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span>
if <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable_____'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, U<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
where <span class='texttt'>U</span> is an unspecified class type
that is not <span class='texttt'>Promise</span> and
that lacks a member named <span class='texttt'>await_<span class='shy'></span>transform</span><a class='hidden_link' href='#as.awaitable-7.2.sentence-1'>.</a></div></div><div class='texpara'><div id='as.awaitable-7.2.sentence-2' class='sentence'><i >Preconditions</i>: <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable______'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span> and
the expression <span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span> expr</span>
in a coroutine with promise type <span class='texttt'>U</span> is expression-equivalent to
the same expression in a coroutine with promise type <span class='texttt'>Promise</span><a class='hidden_link' href='#as.awaitable-7.2.sentence-2'>.</a></div></div></li><li id='as.awaitable-7.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.3'>(7.3)</a></div><div class='texpara'><div id='as.awaitable-7.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >sender-awaitable</i></span><span class='curlybracket'>{</span>expr, p<span class='curlybracket'>}</span></span>
if <span class='texttt'><a href='#concept:awaitable-sender' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable&emsp;[exec.as.awaitable]'><span id='conceptref:awaitable-sender'><span class='texttt'><i >awaitable-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#as.awaitable-7.3.sentence-1'>.</a></div></div></li><li id='as.awaitable-7.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.4'>(7.4)</a></div><div class='texpara'><div id='as.awaitable-7.4.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#as.awaitable-7.4.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='with.awaitable.senders' class='section'><h3 ><a class='secnum' href='#with.awaitable.senders' style='min-width:80pt'>33.13.2</a> <span class='texttt'>execution&#x200b;::&#x200b;with_<span class='shy'></span>awaitable_<span class='shy'></span>senders</span> <a class='abbr_ref' href='exec.with.awaitable.senders'>[exec.with.awaitable.senders]</a></h3><div class='para' id='with.awaitable.senders-1'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5595'>#</a></div><div class='texpara'><div id='with.awaitable.senders-1.sentence-1' class='sentence'><span class='texttt'>with_<span class='shy'></span>awaitable_<span class='shy'></span>senders</span>,
when used as the base class of a coroutine promise type,
makes senders awaitable in that coroutine type<a class='hidden_link' href='#with.awaitable.senders-1.sentence-1'>.</a></div></div><div class='texpara'><div id='with.awaitable.senders-1.sentence-2' class='sentence'>In addition, it provides a default implementation of <span class='texttt'>unhandled_<span class='shy'></span>stopped</span>
such that if a sender completes by calling <span class='texttt'>set_<span class='shy'></span>stopped</span>,
it is treated as if an uncatchable "stopped" exception were thrown
from the <a href='expr.await#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_'><span class='textsf'><i >await-expression</i></span></span></a><a class='hidden_link' href='#with.awaitable.senders-1.sentence-2'>.</a></div> <div id='with.awaitable.senders-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#with.awaitable.senders-note-1'>1</a></i>:&ensp;<div id='with.awaitable.senders-1.sentence-3' class='sentence'>The coroutine is never resumed, and
the <span class='texttt'>unhandled_<span class='shy'></span>stopped</span> of the coroutine caller's promise type is called<a class='hidden_link' href='#with.awaitable.senders-1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type__'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>with_awaitable_senders</a></span> <span class='curlybracket'>{</span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OtherPromise<span class='anglebracket'>&gt;</span>
        <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>OtherPromise, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
      <span class='keyword'>void</span> set_continuation<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span id='lib:with_awaitable_senders,continuation'><span id='lib:continuation,with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders,continuation' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>continuation</a></span></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <i >continuation</i>; <span class='curlybracket'>}</span>

      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span id='lib:with_awaitable_senders,unhandled_stopped'><span id='lib:unhandled_stopped,with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders,unhandled_stopped' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>unhandled_stopped</a></span></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >stopped-handler</i><span class='parenthesis'>(</span><i >continuation</i><span class='operator'>.</span>address<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Value<span class='anglebracket'>&gt;</span>
      <i ><span class='texttt'>see below</span></i> await_transform<span class='parenthesis'>(</span>Value<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>;

    <span class='keyword'>private</span><span class='operator'>:</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>static</span> coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
        <i >default-unhandled-stopped</i><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>             <span class='comment'>// <i >exposition only</i></span>
        terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <i >continuation</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                        <span class='comment'>// <i >exposition only</i></span>
      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='parenthesis'>(</span><span class='operator'>*</span><i >stopped-handler</i><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span>   <span class='comment'>// <i >exposition only</i></span>
        <span class='operator'>&amp;</span><i >default-unhandled-stopped</i>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='lib:with_awaitable_senders,set_continuation'><div id='lib:set_continuation,with_awaitable_senders'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_continuation,with_awaitable_senders'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OtherPromise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>OtherPromise, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
<span class='keyword'>void</span> set_continuation<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='with.awaitable.senders-2'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5646'>#</a></div><div class='texpara'><div id='with.awaitable.senders-2.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >continuation</i> <span class='operator'>=</span> h;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span> <span class='keyword'>requires</span><span class='parenthesis'>(</span>OtherPromise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> other<span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span> <span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <i >stopped-handler</i> <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span> p<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_address<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>
      <span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <i >stopped-handler</i> <span class='operator'>=</span> <span class='operator'>&amp;</span><i >default-unhandled-stopped</i>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div class='texpara'><div id='lib:with_awaitable_senders,await_transform'><div id='lib:await_transform,with_awaitable_senders'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:await_transform,with_awaitable_senders'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Value<span class='anglebracket'>&gt;</span>
<span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>as_awaitable_t, Value, Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span> await_transform<span class='parenthesis'>(</span>Value<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='with.awaitable.senders-3'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exec.tex#L5669'>#</a></div><div class='texpara'><div id='with.awaitable.senders-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> as_awaitable<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>, <span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div></div></div></body></html>