<!DOCTYPE html><html lang='en'><head><title>[exec]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><div id='general' class='section'><h2 ><a class='secnum' href='#general' style='min-width:65pt'>33.1</a> General <a class='abbr_ref' href='exec.general'>[exec.general]</a></h2><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'>This Clause describes components
supporting execution of function objects (<a href='function.objects' title='22.10&emsp;Function objects'>[function.<span class='shy'></span>objects]</a>)<a class='hidden_link' href='#general-1.sentence-1'>.</a></div></div></div><div class='para' id='general-2'><div class='marginalizedparent'><a class='marginalized' href='#general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L10'>#</a></div><div class='texpara'><div id='general-2.sentence-1' class='sentence'>The following subclauses describe
the requirements, concepts, and components
for execution control primitives as summarized in Table <a href='#tab:exec.summary' title='Table 157: Execution control library summary'>157</a><a class='hidden_link' href='#general-2.sentence-1'>.</a></div></div><div class='texpara'><div class='numberedTable' id='tab:exec.summary'>Table <a href='#tab:exec.summary'>157</a> &mdash; Execution control library summary&emsp;<a href='./tab:exec.summary'>[tab:exec.summary]</a><br><table ><tr id='tab:exec.summary-row-1' class='rowsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-1'>ðŸ”—</a></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-1-column-2-sentence-1' class='sentence'><b>Subclause</b></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-1-column-3-sentence-1' class='sentence'><b>Header</b></div></div></td></tr><tr id='tab:exec.summary-row-2' class='capsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-2'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-2-column-1-sentence-1' class='sentence'><a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-2-column-2-sentence-1' class='sentence'>Schedulers</div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-2-column-3-sentence-1' class='sentence'><span class='texttt'><span class='anglebracket'>&lt;</span>execution<span class='anglebracket'>&gt;</span></span></div></div></td></tr><tr id='tab:exec.summary-row-3'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-3'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-3-column-1-sentence-1' class='sentence'><a href='#recv' title='33.7&emsp;Receivers'>[exec.<span class='shy'></span>recv]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-3-column-2-sentence-1' class='sentence'>Receivers</div></div></td><td class='empty left'></td></tr><tr id='tab:exec.summary-row-4'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-4'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-4-column-1-sentence-1' class='sentence'><a href='#opstate' title='33.8&emsp;Operation states'>[exec.<span class='shy'></span>opstate]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-4-column-2-sentence-1' class='sentence'>Operation states</div></div></td><td class='empty left'></td></tr><tr id='tab:exec.summary-row-5'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.summary-row-5'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.summary-row-5-column-1-sentence-1' class='sentence'><a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a></div></div></td><td class='left'><div class='texpara'><div id='tab:exec.summary-row-5-column-2-sentence-1' class='sentence'>Senders</div></div></td><td class='empty left'></td></tr></table></div></div></div><div class='para' id='general-3'><div class='marginalizedparent'><a class='marginalized' href='#general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L22'>#</a></div><div class='texpara'><div id='general-3.sentence-1' class='sentence'>Table <a href='#tab:exec.pos' title='Table 158: Types of customization point objects in the execution control library'>158</a> shows
the types of customization point objects (<a href='customization.point.object' title='16.3.3.3.5&emsp;Customization Point Object types'>[customization.<span class='shy'></span>point.<span class='shy'></span>object]</a>)
used in the execution control library<a class='hidden_link' href='#general-3.sentence-1'>.</a></div></div><div class='texpara'><div class='numberedTable' id='tab:exec.pos'>Table <a href='#tab:exec.pos'>158</a> &mdash; Types of customization point objects in the execution control library&emsp;<a href='./tab:exec.pos'>[tab:exec.pos]</a><br><table ><tr id='tab:exec.pos-row-1' class='rowsep'><td class='center'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-1'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-1-column-1-sentence-1' class='sentence'><b>Customization point</b></div></div></td><td class='center'><div class='texpara'><div id='tab:exec.pos-row-1-column-2-sentence-1' class='sentence'><b>Purpose</b></div></div></td><td class='center'><div class='texpara'><div id='tab:exec.pos-row-1-column-3-sentence-1' class='sentence'><b>Examples</b></div></div></td></tr><tr id='tab:exec.pos-row-2'><td class='center'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-2'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-2-column-1-sentence-1' class='sentence'><b>object type</b></div></div></td><td class='empty left' style='width:23%'></td><td class='empty left' style='width:45%'></td></tr><tr id='tab:exec.pos-row-3' class='capsep'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-3'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-3-column-1-sentence-1' class='sentence'>core</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-3-column-2-sentence-1' class='sentence'>provide core execution functionality, and connection between core components</div></div></td><td class='left' style='width:45%'><div class='texpara'><div id='tab:exec.pos-row-3-column-3-sentence-1' class='sentence'>e.g., <a href='#lib:connect' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>connect</span></a>, <a href='#lib:start' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>start</span></a></div></div></td></tr><tr id='tab:exec.pos-row-4'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-4'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-4-column-1-sentence-1' class='sentence'>completion functions</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-4-column-2-sentence-1' class='sentence'>called by senders to announce the completion of the work (success, error, or cancellation)</div></div></td><td class='left' style='width:45%'><div class='texpara'><div id='tab:exec.pos-row-4-column-3-sentence-1' class='sentence'><a href='#lib:set_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>value</span></a>, <a href='#lib:set_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>error</span></a>, <a href='#lib:set_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>set_<span class='shy'></span>stopped</span></a></div></div></td></tr><tr id='tab:exec.pos-row-5'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-5'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-5-column-1-sentence-1' class='sentence'>senders</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-5-column-2-sentence-1' class='sentence'>allow the specialization of the provided sender algorithms</div></div></td><td class='left' style='width:45%'><div class='texpara'><ul class='itemize'><li >sender factories (e.g., <a href='#lib:schedule' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>schedule</span></a>, <a href='#lib:just' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>just</span></a>, <a href='#lib:read_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>read_<span class='shy'></span>env</span></a>)</li><li >sender adaptors (e.g., <a href='#lib:continues_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>continues_<span class='shy'></span>on</span></a>, <a href='#lib:then' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>then</span></a>, <a href='#lib:let_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>let_<span class='shy'></span>value</span></a>)</li><li >sender consumers (e.g., <a href='#lib:sync_wait' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>sync_<span class='shy'></span>wait</span></a>)</li></ul></div></td></tr><tr id='tab:exec.pos-row-6'><td class='left'><div class='marginalizedparent'><a class='itemDeclLink' href='#tab:exec.pos-row-6'>ðŸ”—</a></div><div class='texpara'><div id='tab:exec.pos-row-6-column-1-sentence-1' class='sentence'>queries</div></div></td><td class='left' style='width:23%'><div class='texpara'><div id='tab:exec.pos-row-6-column-2-sentence-1' class='sentence'>allow querying different properties of objects</div></div></td><td class='left' style='width:45%'><div class='texpara'><ul class='itemize'><li >general queries (e.g., <a href='#lib:get_allocator' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>allocator</span></a>, <a href='#lib:get_stop_token' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span></a>)</li><li >environment queries (e.g., <span class='texttt'>get_<span class='shy'></span>scheduler</span>, <a href='#lib:get_delegation_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span></a>)</li><li >scheduler queries (e.g., <a href='#lib:get_forward_progress_guarantee' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span></a>)</li><li >sender attribute queries (e.g., <a href='#lib:get_completion_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span></a>)</li></ul></div></td></tr></table></div></div></div><div class='para' id='general-4'><div class='marginalizedparent'><a class='marginalized' href='#general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L57'>#</a></div><div class='texpara'><div id='general-4.sentence-1' class='sentence'>This clause makes use of the following exposition-only entities<a class='hidden_link' href='#general-4.sentence-1'>.</a></div></div></div><div class='para' id='general-5'><div class='marginalizedparent'><a class='marginalized' href='#general-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L60'>#</a></div><div class='texpara'><div id='general-5.sentence-1' class='sentence'>For a subexpression <span class='texttt'>expr</span>,
let <span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> be
expression-equivalent to <span class='texttt'>expr</span><a class='hidden_link' href='#general-5.sentence-1'>.</a></div></div><div class='texpara'><div id='general-5.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#general-5.sentence-2'>.</a></div></div></div><div class='para' id='general-6'><div class='marginalizedparent'><a class='marginalized' href='#general-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L68'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='concept:movable-value'><span class='tcode_in_codeblock'><i >movable-value</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='parenthesis'>(</span><span class='operator'>!</span>is_array_v<span class='anglebracket'>&lt;</span>remove_reference_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='general-7'><div class='marginalizedparent'><a class='marginalized' href='#general-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L79'>#</a></div><div class='texpara'><div id='general-7.sentence-1' class='sentence'>For function types <span class='texttt'>F1</span> and <span class='texttt'>F2</span> denoting
<span class='texttt'>R1<span class='parenthesis'>(</span>Args1<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and <span class='texttt'>R2<span class='parenthesis'>(</span>Args2<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>, respectively,
<span class='texttt'><span class='texttt'><i >MATCHING-SIG</i></span><span class='parenthesis'>(</span>F1, F2<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span> if and only if
<span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>R1<span class='parenthesis'>(</span>Args1<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, R2<span class='parenthesis'>(</span>Args2<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#general-7.sentence-1'>.</a></div></div></div><div class='para' id='general-8'><div class='marginalizedparent'><a class='marginalized' href='#general-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L86'>#</a></div><div class='texpara'><div id='general-8.sentence-1' class='sentence'>For a subexpression <span class='texttt'>err</span>,
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'><span class='texttt'><i >AS-EXCEPT-PTR</i></span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span></span> be:
<ul class='itemize'><li id='general-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.1'>(8.1)</a></div><div class='texpara'><div id='general-8.1.sentence-1' class='sentence'><span class='texttt'>err</span> if <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span><a class='hidden_link' href='#general-8.1.sentence-1'>.</a></div></div><div class='texpara'><div id='general-8.1.sentence-2' class='sentence'><i >Preconditions</i>: <span class='texttt'><span class='operator'>!</span>err</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#general-8.1.sentence-2'>.</a></div></div></li><li id='general-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.2'>(8.2)</a></div><div class='texpara'><div id='general-8.2.sentence-1' class='sentence'>Otherwise,
<span class='texttt'>make_<span class='shy'></span>exception_<span class='shy'></span>ptr<span class='parenthesis'>(</span>system_<span class='shy'></span>error<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>error_<span class='shy'></span>code</span><a class='hidden_link' href='#general-8.2.sentence-1'>.</a></div></div></li><li id='general-8.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#general-8.3'>(8.3)</a></div><div class='texpara'><div id='general-8.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'>make_<span class='shy'></span>exception_<span class='shy'></span>ptr<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span></span><a class='hidden_link' href='#general-8.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='general-9'><div class='marginalizedparent'><a class='marginalized' href='#general-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L104'>#</a></div><div class='texpara'><div id='general-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>expr</span>,
let <span class='texttt'><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span> be expression-equivalent to
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> x<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> x; <span class='curlybracket'>}</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span>
</span></div></div></div></div><div id='queryable' class='section'><h2 ><a class='secnum' href='#queryable' style='min-width:65pt'>33.2</a> Queries and queryables <a class='abbr_ref' href='exec.queryable'>[exec.queryable]</a></h2><div id='queryable.general' class='section'><h3 ><a class='secnum' href='#queryable.general' style='min-width:80pt'>33.2.1</a> General <a class='abbr_ref' href='exec.queryable.general'>[exec.queryable.general]</a></h3><div class='para' id='queryable.general-1'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L115'>#</a></div><div class='texpara'><div id='queryable.general-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:object,queryable' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:object,queryable'><i >queryable object</i></span></a> is
a read-only collection of key/value pair
where each key is a customization point object known as a <a class='hidden_link' href='#def:query_object' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:query_object'><i >query object</i></span></a><a class='hidden_link' href='#queryable.general-1.sentence-1'>.</a></div> <div id='queryable.general-1.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:query' title='33.2.1&emsp;General&emsp;[exec.queryable.general]'><span id='def:query'><i >query</i></span></a> is an invocation of a query object
with a queryable object as its first argument and
a (possibly empty) set of additional arguments<a class='hidden_link' href='#queryable.general-1.sentence-2'>.</a></div> <div id='queryable.general-1.sentence-3' class='sentence'>A query imposes syntactic and semantic requirements on its invocations<a class='hidden_link' href='#queryable.general-1.sentence-3'>.</a></div></div></div><div class='para' id='queryable.general-2'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L124'>#</a></div><div class='texpara'><div id='queryable.general-2.sentence-1' class='sentence'>Let <span class='texttt'>q</span> be a query object,
let <span class='texttt'>args</span> be a (possibly empty) pack of subexpressions,
let <span class='texttt'>env</span> be a subexpression
that refers to a queryable object <span class='texttt'>o</span> of type <span class='texttt'>O</span>, and
let <span class='texttt'>cenv</span> be a subexpression referring to <span class='texttt'>o</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>cenv<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='keyword'>const</span> O<span class='operator'>&amp;</span></span><a class='hidden_link' href='#queryable.general-2.sentence-1'>.</a></div> <div id='queryable.general-2.sentence-2' class='sentence'>The expression <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equal to (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)
the expression <span class='texttt'>q<span class='parenthesis'>(</span>cenv, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#queryable.general-2.sentence-2'>.</a></div></div></div><div class='para' id='queryable.general-3'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L134'>#</a></div><div class='texpara'><div id='queryable.general-3.sentence-1' class='sentence'>The type of a query expression cannot be <span class='texttt'><span class='keyword'>void</span></span><a class='hidden_link' href='#queryable.general-3.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-4'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L137'>#</a></div><div class='texpara'><div id='queryable.general-4.sentence-1' class='sentence'>The expression <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is
equality-preserving (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>) and
does not modify the query object or the arguments<a class='hidden_link' href='#queryable.general-4.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-5'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L142'>#</a></div><div class='texpara'><div id='queryable.general-5.sentence-1' class='sentence'>If the expression <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed,
then it is expression-equivalent to <span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#queryable.general-5.sentence-1'>.</a></div></div></div><div class='para' id='queryable.general-6'><div class='marginalizedparent'><a class='marginalized' href='#queryable.general-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L146'>#</a></div><div class='texpara'><div id='queryable.general-6.sentence-1' class='sentence'>Unless otherwise specified,
the result of a query is valid as long as the queryable object is valid<a class='hidden_link' href='#queryable.general-6.sentence-1'>.</a></div></div></div></div><div id='queryable.concept' class='section'><h3 ><a class='secnum' href='#queryable.concept' style='min-width:80pt'>33.2.2</a> <span class='texttt'>queryable</span> concept <a class='abbr_ref' href='exec.queryable.concept'>[exec.queryable.concept]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='concept:queryable'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='operator'>=</span> <a href='concept.destructible#concept:destructible' title='18.4.10&emsp;Concept destructible&emsp;[concept.destructible]'><span id='conceptref:destructible'><span class='tcode_in_codeblock'>destructible</span></span></a><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>;   <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>
</span></div><div class='para' id='queryable.concept-1'><div class='marginalizedparent'><a class='marginalized' href='#queryable.concept-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L159'>#</a></div><div class='texpara'><div id='queryable.concept-1.sentence-1' class='sentence'>The exposition-only <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable'><span class='texttt'><i >queryable</i></span></span></a> concept specifies
the constraints on the types of queryable objects<a class='hidden_link' href='#queryable.concept-1.sentence-1'>.</a></div></div></div><div class='para' id='queryable.concept-2'><div class='marginalizedparent'><a class='marginalized' href='#queryable.concept-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L163'>#</a></div><div class='texpara'><div id='queryable.concept-2.sentence-1' class='sentence'>Let <span class='texttt'>env</span> be an object of type <span class='texttt'>Env</span><a class='hidden_link' href='#queryable.concept-2.sentence-1'>.</a></div> <div id='queryable.concept-2.sentence-2' class='sentence'>The type <span class='texttt'>Env</span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_'><span class='texttt'><i >queryable</i></span></span></a>
if for each callable object <span class='texttt'>q</span> and a pack of subexpressions <span class='texttt'>args</span>,
if <span class='texttt'><span class='keyword'>requires</span> <span class='curlybracket'>{</span> q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span></span> is <span class='texttt'><span class='literal'>true</span></span> then
<span class='texttt'>q<span class='parenthesis'>(</span>env, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> meets any semantic requirements imposed by <span class='texttt'>q</span><a class='hidden_link' href='#queryable.concept-2.sentence-2'>.</a></div></div></div></div></div><div id='async.ops' class='section'><h2 ><a class='secnum' href='#async.ops' style='min-width:65pt'>33.3</a> Asynchronous operations <a class='abbr_ref' href='exec.async.ops'>[exec.async.ops]</a></h2><div class='para' id='async.ops-1'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L172'>#</a></div><div class='texpara'><div id='async.ops-1.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:resource,execution' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:resource,execution'><i >execution resource</i></span></a> is a program entity that manages
a (possibly dynamic) set of execution agents (<a href='thread.req.lockable.general' title='32.2.5.1&emsp;General'>[thread.<span class='shy'></span>req.<span class='shy'></span>lockable.<span class='shy'></span>general]</a>),
which it uses to execute parallel work on behalf of callers<a class='hidden_link' href='#async.ops-1.sentence-1'>.</a></div> <div id='async.ops-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#async.ops-example-1'>1</a></i>:&ensp;<div id='async.ops-1.sentence-2' class='sentence'>The currently active thread,
a system-provided thread pool, and
uses of an API associated with an external hardware accelerator
are all examples of execution resources<a class='hidden_link' href='#async.ops-1.sentence-2'>.</a></div> â€”&nbsp;<i>end example</i>]</div></div> <div id='async.ops-1.sentence-3' class='sentence'>
Execution resources execute asynchronous operations<a class='hidden_link' href='#async.ops-1.sentence-3'>.</a></div> <div id='async.ops-1.sentence-4' class='sentence'>An execution resource is either valid or invalid<a class='hidden_link' href='#async.ops-1.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-2'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L185'>#</a></div><div class='texpara'><div id='async.ops-2.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:operation,asynchronous' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,asynchronous'><i >asynchronous operation</i></span></a> is
a distinct unit of program execution that
<ul class='itemize'><li id='async.ops-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.1'>(2.1)</a></div><div class='texpara'><div id='async.ops-2.1.sentence-1' class='sentence'>is explicitly created;</div></div></li><li id='async.ops-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.2'>(2.2)</a></div><div class='texpara'><div id='async.ops-2.2.sentence-1' class='sentence'>can be explicitly started once at most;</div></div></li><li id='async.ops-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.3'>(2.3)</a></div><div class='texpara'><div id='async.ops-2.3.sentence-1' class='sentence'>once started, eventually completes exactly once
with a (possibly empty) set of result datums and
in exactly one of three <a class='hidden_link' href='#def:disposition' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:disposition'><i >dispositions</i></span></a>:
success, failure, or cancellation;
<ul class='itemize'><li id='async.ops-2.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.1'>(2.3.1)</a></div><div class='texpara'><div id='async.ops-2.3.1.sentence-1' class='sentence'>A successful completion, also known as a <a class='hidden_link' href='#def:completion,value' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,value'><i >value completion</i></span></a>,
can have an arbitrary number of result datums<a class='hidden_link' href='#async.ops-2.3.1.sentence-1'>.</a></div></div></li><li id='async.ops-2.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.2'>(2.3.2)</a></div><div class='texpara'><div id='async.ops-2.3.2.sentence-1' class='sentence'>A failure completion, also known as an <a class='hidden_link' href='#def:completion,error' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,error'><i >error completion</i></span></a>,
has a single result datum<a class='hidden_link' href='#async.ops-2.3.2.sentence-1'>.</a></div></div></li><li id='async.ops-2.3.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#async.ops-2.3.3'>(2.3.3)</a></div><div class='texpara'><div id='async.ops-2.3.3.sentence-1' class='sentence'>A cancellation completion, also known as a <a class='hidden_link' href='#def:completion,stopped' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion,stopped'><i >stopped completion</i></span></a>,
has no result datum<a class='hidden_link' href='#async.ops-2.3.3.sentence-1'>.</a></div></div></li></ul></div> <div id='async.ops-2.3.sentence-2' class='sentence'>
An asynchronous operation's <a class='hidden_link' href='#def:result,async' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:result,async'><i >async result</i></span></a>
is its disposition and its (possibly empty) set of result datums<a class='hidden_link' href='#async.ops-2.3.sentence-2'>.</a></div></div></li><li id='async.ops-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.4'>(2.4)</a></div><div class='texpara'><div id='async.ops-2.4.sentence-1' class='sentence'>can complete on a different execution resource
than the execution resource on which it started; and</div></div></li><li id='async.ops-2.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-2.5'>(2.5)</a></div><div class='texpara'><div id='async.ops-2.5.sentence-1' class='sentence'>can create and start other asynchronous operations
called <a class='hidden_link' href='#def:operations,child' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operations,child'><i >child operations</i></span></a><a class='hidden_link' href='#async.ops-2.5.sentence-1'>.</a></div> <div id='async.ops-2.5.sentence-2' class='sentence'>A child operation is an asynchronous operation
that is created by the parent operation and,
if started, completes before the parent operation completes<a class='hidden_link' href='#async.ops-2.5.sentence-2'>.</a></div> <div id='async.ops-2.5.sentence-3' class='sentence'>A <a class='hidden_link' href='#def:operation,parent' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,parent'><i >parent operation</i></span></a> is the asynchronous operation
that created a particular child operation<a class='hidden_link' href='#async.ops-2.5.sentence-3'>.</a></div></div></li></ul></div> <div id='async.ops-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#async.ops-note-1'>1</a></i>:&ensp;<div id='async.ops-2.sentence-2' class='sentence'>An asynchronous operation can execute synchronously;
that is, it can complete during the execution of its start operation
on the thread of execution that started it<a class='hidden_link' href='#async.ops-2.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='async.ops-3'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L229'>#</a></div><div class='texpara'><div id='async.ops-3.sentence-1' class='sentence'>An asynchronous operation has associated state
known as its <a class='hidden_link' href='#def:state,operation' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:state,operation'><i >operation state</i></span></a><a class='hidden_link' href='#async.ops-3.sentence-1'>.</a></div></div></div><div class='para' id='async.ops-4'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L233'>#</a></div><div class='texpara'><div id='async.ops-4.sentence-1' class='sentence'>An asynchronous operation has an associated environment<a class='hidden_link' href='#async.ops-4.sentence-1'>.</a></div> <div id='async.ops-4.sentence-2' class='sentence'>An <a class='hidden_link' href='#def:environment' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:environment'><i >environment</i></span></a> is a queryable object (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)
representing the execution-time properties of the operation's caller<a class='hidden_link' href='#async.ops-4.sentence-2'>.</a></div> <div id='async.ops-4.sentence-3' class='sentence'>The caller of an asynchronous operation is
its parent operation or the function that created it<a class='hidden_link' href='#async.ops-4.sentence-3'>.</a></div></div></div><div class='para' id='async.ops-5'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L240'>#</a></div><div class='texpara'><div id='async.ops-5.sentence-1' class='sentence'>An asynchronous operation has an associated receiver<a class='hidden_link' href='#async.ops-5.sentence-1'>.</a></div> <div id='async.ops-5.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:receiver' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:receiver'><i >receiver</i></span></a> is an aggregation of three handlers
for the three asynchronous completion dispositions:
<ul class='itemize'><li id='async.ops-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.1'>(5.1)</a></div>a value completion handler for a value completion,</li><li id='async.ops-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.2'>(5.2)</a></div>an error completion handler for an error completion, and</li><li id='async.ops-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-5.3'>(5.3)</a></div>a stopped completion handler for a stopped completion<a class='hidden_link' href='#async.ops-5.sentence-2'>.</a></li></ul></div> <div id='async.ops-5.sentence-3' class='sentence'>
A receiver has an associated environment<a class='hidden_link' href='#async.ops-5.sentence-3'>.</a></div> <div id='async.ops-5.sentence-4' class='sentence'>An asynchronous operation's operation state owns the operation's receiver<a class='hidden_link' href='#async.ops-5.sentence-4'>.</a></div> <div id='async.ops-5.sentence-5' class='sentence'>The environment of an asynchronous operation
is equal to its receiver's environment<a class='hidden_link' href='#async.ops-5.sentence-5'>.</a></div></div></div><div class='para' id='async.ops-6'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L254'>#</a></div><div class='texpara'><div id='async.ops-6.sentence-1' class='sentence'>For each completion disposition, there is a <a class='hidden_link' href='#def:function,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:function,completion'><i >completion function</i></span></a><a class='hidden_link' href='#async.ops-6.sentence-1'>.</a></div> <div id='async.ops-6.sentence-2' class='sentence'>A completion function is
a customization point object (<a href='customization.point.object' title='16.3.3.3.5&emsp;Customization Point Object types'>[customization.<span class='shy'></span>point.<span class='shy'></span>object]</a>)
that accepts an asynchronous operation's receiver as the first argument and
the result datums of the asynchronous operation as additional arguments<a class='hidden_link' href='#async.ops-6.sentence-2'>.</a></div> <div id='async.ops-6.sentence-3' class='sentence'>The value completion function invokes
the receiver's value completion handler with the value result datums;
likewise for the error completion function and the stopped completion function<a class='hidden_link' href='#async.ops-6.sentence-3'>.</a></div> <div id='async.ops-6.sentence-4' class='sentence'>A completion function has
an associated type known as its <a class='hidden_link' href='#def:tag,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:tag,completion'><i >completion tag</i></span></a>
that is the unqualified type of the completion function<a class='hidden_link' href='#async.ops-6.sentence-4'>.</a></div> <div id='async.ops-6.sentence-5' class='sentence'>A valid invocation of a completion function is called
a <a class='hidden_link' href='#def:operation,completion' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:operation,completion'><i >completion operation</i></span></a><a class='hidden_link' href='#async.ops-6.sentence-5'>.</a></div></div></div><div class='para' id='async.ops-7'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L269'>#</a></div><div class='texpara'><div id='async.ops-7.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:lifetime_of_an_asynchronous_operation' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:lifetime_of_an_asynchronous_operation'><i >lifetime of an asynchronous operation</i></span></a>,
also known as the operation's <a class='hidden_link' href='#def:async_lifetime' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:async_lifetime'><i >async lifetime</i></span></a>,
begins when its start operation begins executing and
ends when its completion operation begins executing<a class='hidden_link' href='#async.ops-7.sentence-1'>.</a></div> <div id='async.ops-7.sentence-2' class='sentence'>If the lifetime of an asynchronous operation's associated operation state
ends before the lifetime of the asynchronous operation,
the behavior is undefined<a class='hidden_link' href='#async.ops-7.sentence-2'>.</a></div> <div id='async.ops-7.sentence-3' class='sentence'>After an asynchronous operation executes a completion operation,
its associated operation state is invalid<a class='hidden_link' href='#async.ops-7.sentence-3'>.</a></div> <div id='async.ops-7.sentence-4' class='sentence'>Accessing any part of an invalid operation state is undefined behavior<a class='hidden_link' href='#async.ops-7.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-8'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L281'>#</a></div><div class='texpara'><div id='async.ops-8.sentence-1' class='sentence'>An asynchronous operation shall not execute a completion operation
before its start operation has begun executing<a class='hidden_link' href='#async.ops-8.sentence-1'>.</a></div> <div id='async.ops-8.sentence-2' class='sentence'>After its start operation has begun executing,
exactly one completion operation shall execute<a class='hidden_link' href='#async.ops-8.sentence-2'>.</a></div> <div id='async.ops-8.sentence-3' class='sentence'>The lifetime of an asynchronous operation's operation state can end
during the execution of the completion operation<a class='hidden_link' href='#async.ops-8.sentence-3'>.</a></div></div></div><div class='para' id='async.ops-9'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L289'>#</a></div><div class='texpara'><div id='async.ops-9.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender'><i >sender</i></span></a> is a factory for one or more asynchronous operations<a class='hidden_link' href='#async.ops-9.sentence-1'>.</a></div> <div id='async.ops-9.sentence-2' class='sentence'><a class='hidden_link' href='#def:connect' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:connect'><i >Connecting</i></span></a> a sender and a receiver creates
an asynchronous operation<a class='hidden_link' href='#async.ops-9.sentence-2'>.</a></div> <div id='async.ops-9.sentence-3' class='sentence'>The asynchronous operation's associated receiver is equal to
the receiver used to create it, and
its associated environment is equal to
the environment associated with the receiver used to create it<a class='hidden_link' href='#async.ops-9.sentence-3'>.</a></div> <div id='async.ops-9.sentence-4' class='sentence'>The lifetime of an asynchronous operation's associated operation state
does not depend on the lifetimes of either the sender or the receiver
from which it was created<a class='hidden_link' href='#async.ops-9.sentence-4'>.</a></div> <div id='async.ops-9.sentence-5' class='sentence'>A sender is started when it is connected to a receiver and
the resulting asynchronous operation is started<a class='hidden_link' href='#async.ops-9.sentence-5'>.</a></div> <div id='async.ops-9.sentence-6' class='sentence'>A sender's async result is the async result of the asynchronous operation
created by connecting it to a receiver<a class='hidden_link' href='#async.ops-9.sentence-6'>.</a></div> <div id='async.ops-9.sentence-7' class='sentence'>A sender sends its results by way of the asynchronous operation(s) it produces,
and a receiver receives those results<a class='hidden_link' href='#async.ops-9.sentence-7'>.</a></div> <div id='async.ops-9.sentence-8' class='sentence'>A sender is either valid or invalid;
it becomes invalid when its parent sender (see below) becomes invalid<a class='hidden_link' href='#async.ops-9.sentence-8'>.</a></div></div></div><div class='para' id='async.ops-10'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L309'>#</a></div><div class='texpara'><div id='async.ops-10.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:scheduler' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:scheduler'><i >scheduler</i></span></a> is an abstraction of an execution resource
with a uniform, generic interface for scheduling work onto that resource<a class='hidden_link' href='#async.ops-10.sentence-1'>.</a></div> <div id='async.ops-10.sentence-2' class='sentence'>It is a factory for senders
whose asynchronous operations execute value completion operations
on an execution agent belonging to
the scheduler's associated execution resource<a class='hidden_link' href='#async.ops-10.sentence-2'>.</a></div> <div id='async.ops-10.sentence-3' class='sentence'>A <a class='hidden_link' href='#def:schedule-expression' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:schedule-expression'><i >schedule-expression</i></span></a> obtains such a sender from a scheduler<a class='hidden_link' href='#async.ops-10.sentence-3'>.</a></div> <div id='async.ops-10.sentence-4' class='sentence'>A <a class='hidden_link' href='#def:schedule_sender' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:schedule_sender'><i >schedule sender</i></span></a> is the result of a schedule expression<a class='hidden_link' href='#async.ops-10.sentence-4'>.</a></div> <div id='async.ops-10.sentence-5' class='sentence'>On success, an asynchronous operation produced by a schedule sender executes
a value completion operation with an empty set of result datums<a class='hidden_link' href='#async.ops-10.sentence-5'>.</a></div> <div id='async.ops-10.sentence-6' class='sentence'>Multiple schedulers can refer to the same execution resource<a class='hidden_link' href='#async.ops-10.sentence-6'>.</a></div> <div id='async.ops-10.sentence-7' class='sentence'>A scheduler can be valid or invalid<a class='hidden_link' href='#async.ops-10.sentence-7'>.</a></div> <div id='async.ops-10.sentence-8' class='sentence'>A scheduler becomes invalid when the execution resource to which it refers
becomes invalid,
as do any schedule senders obtained from the scheduler, and
any operation states obtained from those senders<a class='hidden_link' href='#async.ops-10.sentence-8'>.</a></div></div></div><div class='para' id='async.ops-11'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L327'>#</a></div><div class='texpara'><div id='async.ops-11.sentence-1' class='sentence'>An asynchronous operation has one or more associated completion schedulers
for each of its possible dispositions<a class='hidden_link' href='#async.ops-11.sentence-1'>.</a></div> <div id='async.ops-11.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:completion_scheduler' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion_scheduler'><i >completion scheduler</i></span></a> is a scheduler
whose associated execution resource is used to execute
a completion operation for an asynchronous operation<a class='hidden_link' href='#async.ops-11.sentence-2'>.</a></div> <div id='async.ops-11.sentence-3' class='sentence'>A value completion scheduler is a scheduler
on which an asynchronous operation's value completion operation can execute<a class='hidden_link' href='#async.ops-11.sentence-3'>.</a></div> <div id='async.ops-11.sentence-4' class='sentence'>Likewise for error completion schedulers and stopped completion schedulers<a class='hidden_link' href='#async.ops-11.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-12'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L337'>#</a></div><div class='texpara'><div id='async.ops-12.sentence-1' class='sentence'>A sender has an associated queryable object (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)
known as its <a class='hidden_link' href='#def:attribute' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:attribute'><i >attributes</i></span></a>
that describes various characteristics of the sender and
of the asynchronous operation(s) it produces<a class='hidden_link' href='#async.ops-12.sentence-1'>.</a></div> <div id='async.ops-12.sentence-2' class='sentence'>For each disposition,
there is a query object for reading the associated completion scheduler
from a sender's attributes;
i.e., a value completion scheduler query object
for reading a sender's value completion scheduler, etc<a class='hidden_link' href='#async.ops-12.sentence-2'>.</a></div> <div id='async.ops-12.sentence-3' class='sentence'>If a completion scheduler query is well-formed,
the returned completion scheduler is unique
for that disposition for any asynchronous operation the sender creates<a class='hidden_link' href='#async.ops-12.sentence-3'>.</a></div> <div id='async.ops-12.sentence-4' class='sentence'>A schedule sender is required to have a value completion scheduler attribute
whose value is equal to the scheduler that produced the schedule sender<a class='hidden_link' href='#async.ops-12.sentence-4'>.</a></div></div></div><div class='para' id='async.ops-13'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L353'>#</a></div><div class='texpara'><div id='async.ops-13.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:completion_signature' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:completion_signature'><i >completion signature</i></span></a> is a function type
that describes a completion operation<a class='hidden_link' href='#async.ops-13.sentence-1'>.</a></div> <div id='async.ops-13.sentence-2' class='sentence'>An asynchronous operation has a finite set of possible completion signatures
corresponding to the completion operations
that the asynchronous operation potentially evaluates (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)<a class='hidden_link' href='#async.ops-13.sentence-2'>.</a></div> <div id='async.ops-13.sentence-3' class='sentence'>For a completion function <span class='texttt'>set</span>,
receiver <span class='texttt'>rcvr</span>, and
pack of arguments <span class='texttt'>args</span>,
let <span class='texttt'>c</span> be the completion operation <span class='texttt'>set<span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>F</span> be
the function type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>set<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#async.ops-13.sentence-3'>.</a></div> <div id='async.ops-13.sentence-4' class='sentence'>A completion signature <span class='texttt'>Sig</span> is associated with <span class='texttt'>c</span>
if and only if
<span class='texttt'><span class='texttt'><i >MATCHING-SIG</i></span><span class='parenthesis'>(</span>Sig, F<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span> (<a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#async.ops-13.sentence-4'>.</a></div> <div id='async.ops-13.sentence-5' class='sentence'>Together, a sender type and an environment type <span class='texttt'>Env</span> determine
the set of completion signatures of an asynchronous operation
that results from connecting the sender with a receiver
that has an environment of type <span class='texttt'>Env</span><a class='hidden_link' href='#async.ops-13.sentence-5'>.</a></div> <div id='async.ops-13.sentence-6' class='sentence'>The type of the receiver does not affect
an asynchronous operation's completion signatures,
only the type of the receiver's environment<a class='hidden_link' href='#async.ops-13.sentence-6'>.</a></div> <div id='async.ops-13.sentence-7' class='sentence'>A <a class='hidden_link' href='#def:sender,non-dependent' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender,non-dependent'><i >non-dependent sender</i></span></a> is a sender type
whose completion signatures are knowable
independent of an execution environment<a class='hidden_link' href='#async.ops-13.sentence-7'>.</a></div></div></div><div class='para' id='async.ops-14'><div class='marginalizedparent'><a class='marginalized' href='#async.ops-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L379'>#</a></div><div class='texpara'><div id='async.ops-14.sentence-1' class='sentence'>A sender algorithm is a function that takes and/or returns a sender<a class='hidden_link' href='#async.ops-14.sentence-1'>.</a></div> <div id='async.ops-14.sentence-2' class='sentence'>There are three categories of sender algorithms:
<ul class='itemize'><li id='async.ops-14.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.1'>(14.1)</a></div><div class='texpara'><div id='async.ops-14.1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_factory' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_factory'><i >sender factory</i></span></a> is a function
that takes non-senders as arguments and that returns a sender<a class='hidden_link' href='#async.ops-14.1.sentence-1'>.</a></div></div></li><li id='async.ops-14.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.2'>(14.2)</a></div><div class='texpara'><div id='async.ops-14.2.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_adaptor'><i >sender adaptor</i></span></a> is a function
that constructs and returns a parent sender
from a set of one or more child senders and
a (possibly empty) set of additional arguments<a class='hidden_link' href='#async.ops-14.2.sentence-1'>.</a></div> <div id='async.ops-14.2.sentence-2' class='sentence'>An asynchronous operation created by a parent sender is
a parent operation to the child operations created by the child senders<a class='hidden_link' href='#async.ops-14.2.sentence-2'>.</a></div></div></li><li id='async.ops-14.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#async.ops-14.3'>(14.3)</a></div><div class='texpara'><div id='async.ops-14.3.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_consumer' title='33.3&emsp;Asynchronous operations&emsp;[exec.async.ops]'><span id='def:sender_consumer'><i >sender consumer</i></span></a> is a function
that takes one or more senders and
a (possibly empty) set of additional arguments, and
whose return type is not the type of a sender<a class='hidden_link' href='#async.ops-14.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='execution.syn' class='section'><h2 ><a class='secnum' href='#execution.syn' style='min-width:65pt'>33.4</a> Header <span class='texttt'>&lt;execution&gt;</span> synopsis <a class='abbr_ref' href='execution.syn'>[execution.syn]</a></h2><div class='texpara'><span id='header:<execution>'><div class='marginalizedparent'><a class='itemDeclLink' href='#header:%3cexecution%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='execpol.type' title='26.3.6.2&emsp;Execution policy type trait'>[execpol.<span class='shy'></span>type]</a>, execution policy type trait</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> is_execution_policy;                 <span class='comment'>// freestanding</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> <span id='lib:is_execution_policy_v'><a class='hidden_link' href='#lib:is_execution_policy_v' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>is_execution_policy_v</a></span> <span class='operator'>=</span>      <span class='comment'>// freestanding</span>
      is_execution_policy<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>::</span>value;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='execpol.seq' title='26.3.6.3&emsp;Sequenced execution policy'>[execpol.<span class='shy'></span>seq]</a>, sequenced execution policy</span>
  <span class='keyword'>class</span> sequenced_policy;

  <span class='comment'>// <a href='execpol.par' title='26.3.6.4&emsp;Parallel execution policy'>[execpol.<span class='shy'></span>par]</a>, parallel execution policy</span>
  <span class='keyword'>class</span> parallel_policy;

  <span class='comment'>// <a href='execpol.parunseq' title='26.3.6.5&emsp;Parallel and unsequenced execution policy'>[execpol.<span class='shy'></span>parunseq]</a>, parallel and unsequenced execution policy</span>
  <span class='keyword'>class</span> parallel_unsequenced_policy;

  <span class='comment'>// <a href='execpol.unseq' title='26.3.6.6&emsp;Unsequenced execution policy'>[execpol.<span class='shy'></span>unseq]</a>, unsequenced execution policy</span>
  <span class='keyword'>class</span> unsequenced_policy;

  <span class='comment'>// <a href='execpol.objects' title='26.3.6.7&emsp;Execution policy objects'>[execpol.<span class='shy'></span>objects]</a>, execution policy objects</span>
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sequenced_policy            seq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> parallel_policy             par<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> parallel_unsequenced_policy par_unseq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> unsequenced_policy          unseq<span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>, helper concepts</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value'><span class='tcode_in_codeblock'><i >movable-value</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                          <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> From, <span class='keyword'>class</span> To<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:decays-to'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a> <span class='operator'>=</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>From<span class='anglebracket'>&gt;</span>, To<span class='anglebracket'>&gt;</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:class-type'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> <span class='operator'>=</span> <a href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span>T, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> is_class_v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>, queryable objects</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                              <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#queries' title='33.5&emsp;Queries'>[exec.<span class='shy'></span>queries]</a>, queries</span>
  <span class='keyword'>struct</span> <span id='lib:forwarding_query_t'><a class='hidden_link' href='#lib:forwarding_query_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>forwarding_query_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_allocator_t'><a class='hidden_link' href='#lib:get_allocator_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_allocator_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_stop_token_t'><a class='hidden_link' href='#lib:get_stop_token_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_stop_token_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> forwarding_query_t <span id='lib:forwarding_query'><a class='hidden_link' href='#lib:forwarding_query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>forwarding_query</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_allocator_t <span id='lib:get_allocator'><a class='hidden_link' href='#lib:get_allocator' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_allocator</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_stop_token_t <span id='lib:get_stop_token'><a class='hidden_link' href='#lib:get_stop_token' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_stop_token</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> stop_token_of_t <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_stop_token<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:forwarding-query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:forwarding-query'><span class='tcode_in_codeblock'><i >forwarding-query</i></span></span></a> <span class='operator'>=</span> forwarding_query<span class='parenthesis'>(</span>T<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;           <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#queries' title='33.5&emsp;Queries'>[exec.<span class='shy'></span>queries]</a>, queries</span>
  <span class='keyword'>struct</span> <span id='lib:get_domain_t'><a class='hidden_link' href='#lib:get_domain_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_domain_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_scheduler_t'><a class='hidden_link' href='#lib:get_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_delegation_scheduler_t'><a class='hidden_link' href='#lib:get_delegation_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_delegation_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:get_forward_progress_guarantee_t'><a class='hidden_link' href='#lib:get_forward_progress_guarantee_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_forward_progress_guarantee_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:get_completion_scheduler_t'><a class='hidden_link' href='#lib:get_completion_scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_completion_scheduler_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> get_await_completion_adaptor_t <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_domain_t <span id='lib:get_domain'><a class='hidden_link' href='#lib:get_domain' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_domain</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_scheduler_t <span id='lib:get_scheduler'><a class='hidden_link' href='#lib:get_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_delegation_scheduler_t <span id='lib:get_delegation_scheduler'><a class='hidden_link' href='#lib:get_delegation_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_delegation_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>enum</span> <span class='keyword'>class</span> forward_progress_guarantee;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_forward_progress_guarantee_t <span id='lib:get_forward_progress_guarantee'><a class='hidden_link' href='#lib:get_forward_progress_guarantee' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_forward_progress_guarantee</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> get_completion_scheduler_t<span class='anglebracket'>&lt;</span>CPO<span class='anglebracket'>&gt;</span> <span id='lib:get_completion_scheduler'><a class='hidden_link' href='#lib:get_completion_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_completion_scheduler</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_await_completion_adaptor_t get_await_completion_adaptor<span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <span id='lib:get_env_t'><a class='hidden_link' href='#lib:get_env_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_env_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> get_env_t <span id='lib:get_env'><a class='hidden_link' href='#lib:get_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>get_env</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:env_of_t'><a class='hidden_link' href='#lib:env_of_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>env_of_t</a></span> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#prop' title='33.11.1&emsp;Class template prop'>[exec.<span class='shy'></span>prop]</a>, class template <span class='tcode_in_codeblock'>prop</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> prop;

  <span class='comment'>// <a href='#env' title='33.11.2&emsp;Class template env'>[exec.<span class='shy'></span>env]</a>, class template <span class='tcode_in_codeblock'>env</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> env;

  <span class='comment'>// <a href='#domain.default' title='33.9.5&emsp;execution&#x200b;::&#x200b;default_&shy;domain'>[exec.<span class='shy'></span>domain.<span class='shy'></span>default]</a>, execution domains</span>
  <span class='keyword'>struct</span> default_domain;

  <span class='comment'>// <a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a>, schedulers</span>
  <span class='keyword'>struct</span> <span id='lib:scheduler_t'><a class='hidden_link' href='#lib:scheduler_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>scheduler_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='tcode_in_codeblock'>scheduler</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='comment'>// <a href='#recv' title='33.7&emsp;Receivers'>[exec.<span class='shy'></span>recv]</a>, receivers</span>
  <span class='keyword'>struct</span> <span id='lib:receiver_t'><a class='hidden_link' href='#lib:receiver_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>receiver_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver'><span class='tcode_in_codeblock'>receiver</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <span id='lib:set_value_t'><a class='hidden_link' href='#lib:set_value_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_value_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:set_error_t'><a class='hidden_link' href='#lib:set_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:set_stopped_t'><a class='hidden_link' href='#lib:set_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_value_t <span id='lib:set_value'><a class='hidden_link' href='#lib:set_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_value</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_error_t <span id='lib:set_error'><a class='hidden_link' href='#lib:set_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> set_stopped_t <span id='lib:set_stopped'><a class='hidden_link' href='#lib:set_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>set_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#opstate' title='33.8&emsp;Operation states'>[exec.<span class='shy'></span>opstate]</a>, operation states</span>
  <span class='keyword'>struct</span> <span id='lib:operation_state_t'><a class='hidden_link' href='#lib:operation_state_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>operation_state_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> O<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state'><span class='tcode_in_codeblock'>operation_<span class='shy'></span>state</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <span id='lib:start_t'><a class='hidden_link' href='#lib:start_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>start_t</a></span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> start_t <span id='lib:start'><a class='hidden_link' href='#lib:start' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>start</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a>, senders</span>
  <span class='keyword'>struct</span> <span id='lib:sender_t'><a class='hidden_link' href='#lib:sender_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sender_t</a></span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:dependent_sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:dependent_sender'><span class='tcode_in_codeblock'>dependent_<span class='shy'></span>sender</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >type-list</i>;                                           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >decayed-tuple</i> <span class='operator'>=</span> tuple<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >variant-or-empty</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                         <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple <span class='operator'>=</span> <i >decayed-tuple</i>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> value_types_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> error_types_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> sends_stopped <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >single-sender-value-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                 <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>; <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> tag_of_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='comment'>// <a href='#snd.transform' title='33.9.6&emsp;execution&#x200b;::&#x200b;transform_&shy;sender'>[exec.<span class='shy'></span>snd.<span class='shy'></span>transform]</a>, sender transformations</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>
      Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#snd.transform.env' title='33.9.7&emsp;execution&#x200b;::&#x200b;transform_&shy;env'>[exec.<span class='shy'></span>snd.<span class='shy'></span>transform.<span class='shy'></span>env]</a>, environment transformations</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>
      Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='comment'>// <a href='#snd.apply' title='33.9.8&emsp;execution&#x200b;::&#x200b;apply_&shy;sender'>[exec.<span class='shy'></span>snd.<span class='shy'></span>apply]</a>, sender algorithm application</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>
      Domain dom, Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#connect' title='33.9.10&emsp;execution&#x200b;::&#x200b;connect'>[exec.<span class='shy'></span>connect]</a>, the connect sender algorithm</span>
  <span class='keyword'>struct</span> <span id='lib:connect_t'><a class='hidden_link' href='#lib:connect_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect_t</a></span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> connect_t <span id='lib:connect'><a class='hidden_link' href='#lib:connect' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:connect_result_t'><a class='hidden_link' href='#lib:connect_result_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>connect_result_t</a></span> <span class='operator'>=</span>
      <span class='keyword'>decltype</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#factories' title='33.9.11&emsp;Sender factories'>[exec.<span class='shy'></span>factories]</a>, sender factories</span>
  <span class='keyword'>struct</span> <span id='lib:just_t'><a class='hidden_link' href='#lib:just_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:just_error_t'><a class='hidden_link' href='#lib:just_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:just_stopped_t'><a class='hidden_link' href='#lib:just_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:schedule_t'><a class='hidden_link' href='#lib:schedule_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_t <span id='lib:just'><a class='hidden_link' href='#lib:just' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_error_t <span id='lib:just_error'><a class='hidden_link' href='#lib:just_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> just_stopped_t <span id='lib:just_stopped'><a class='hidden_link' href='#lib:just_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>just_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> schedule_t <span id='lib:schedule'><a class='hidden_link' href='#lib:schedule' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> <i ><span class='texttt'>unspecified</span></i> <span id='lib:read_env'><a class='hidden_link' href='#lib:read_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>read_env</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_'><span class='tcode_in_codeblock'>scheduler</span></span></a> Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <span id='lib:schedule_result_t'><a class='hidden_link' href='#lib:schedule_result_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_result_t</a></span> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a>, sender adaptors</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> D<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:sender_adaptor_closure'><a class='hidden_link' href='#lib:sender_adaptor_closure' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sender_adaptor_closure</a></span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <span id='lib:starts_on_t'><a class='hidden_link' href='#lib:starts_on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>starts_on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:continues_on_t'><a class='hidden_link' href='#lib:continues_on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>continues_on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:on_t'><a class='hidden_link' href='#lib:on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:schedule_from_t'><a class='hidden_link' href='#lib:schedule_from_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_from_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:then_t'><a class='hidden_link' href='#lib:then_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>then_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:upon_error_t'><a class='hidden_link' href='#lib:upon_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:upon_stopped_t'><a class='hidden_link' href='#lib:upon_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_value_t'><a class='hidden_link' href='#lib:let_value_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_value_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_error_t'><a class='hidden_link' href='#lib:let_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:let_stopped_t'><a class='hidden_link' href='#lib:let_stopped_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_stopped_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:bulk_t'><a class='hidden_link' href='#lib:bulk_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:bulk_chunked_t'><a class='hidden_link' href='#lib:bulk_chunked_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_chunked_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:bulk_unchunked_t'><a class='hidden_link' href='#lib:bulk_unchunked_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_unchunked_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:when_all_t'><a class='hidden_link' href='#lib:when_all_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:when_all_with_variant_t'><a class='hidden_link' href='#lib:when_all_with_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_with_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:into_variant_t'><a class='hidden_link' href='#lib:into_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>into_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:stopped_as_optional_t'><a class='hidden_link' href='#lib:stopped_as_optional_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_optional_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:stopped_as_error_t'><a class='hidden_link' href='#lib:stopped_as_error_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_error_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:associate_t'><a class='hidden_link' href='#lib:associate_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>associate_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:spawn_future_t'><a class='hidden_link' href='#lib:spawn_future_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>spawn_future_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> <i ><span class='texttt'>unspecified</span></i> <span id='lib:write_env'><a class='hidden_link' href='#lib:write_env' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>write_env</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> <i ><span class='texttt'>unspecified</span></i> <span id='lib:unstoppable'><a class='hidden_link' href='#lib:unstoppable' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>unstoppable</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> starts_on_t <span id='lib:starts_on'><a class='hidden_link' href='#lib:starts_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>starts_on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> continues_on_t <span id='lib:continues_on'><a class='hidden_link' href='#lib:continues_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>continues_on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> on_t <span id='lib:on'><a class='hidden_link' href='#lib:on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> schedule_from_t <span id='lib:schedule_from'><a class='hidden_link' href='#lib:schedule_from' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>schedule_from</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> then_t <span id='lib:then'><a class='hidden_link' href='#lib:then' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>then</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> upon_error_t <span id='lib:upon_error'><a class='hidden_link' href='#lib:upon_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> upon_stopped_t <span id='lib:upon_stopped'><a class='hidden_link' href='#lib:upon_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>upon_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_value_t <span id='lib:let_value'><a class='hidden_link' href='#lib:let_value' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_value</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_error_t <span id='lib:let_error'><a class='hidden_link' href='#lib:let_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> let_stopped_t <span id='lib:let_stopped'><a class='hidden_link' href='#lib:let_stopped' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>let_stopped</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> bulk_t <span id='lib:bulk'><a class='hidden_link' href='#lib:bulk' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> bulk_chunked_t <span id='lib:bulk_chunked'><a class='hidden_link' href='#lib:bulk_chunked' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_chunked</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> bulk_unchunked_t <span id='lib:bulk_unchunked'><a class='hidden_link' href='#lib:bulk_unchunked' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>bulk_unchunked</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> when_all_t <span id='lib:when_all'><a class='hidden_link' href='#lib:when_all' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> when_all_with_variant_t <span id='lib:when_all_with_variant'><a class='hidden_link' href='#lib:when_all_with_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>when_all_with_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> into_variant_t <span id='lib:into_variant'><a class='hidden_link' href='#lib:into_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>into_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> stopped_as_optional_t <span id='lib:stopped_as_optional'><a class='hidden_link' href='#lib:stopped_as_optional' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_optional</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> stopped_as_error_t <span id='lib:stopped_as_error'><a class='hidden_link' href='#lib:stopped_as_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>stopped_as_error</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> associate_t <span id='lib:associate'><a class='hidden_link' href='#lib:associate' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>associate</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> spawn_future_t <span id='lib:spawn_future'><a class='hidden_link' href='#lib:spawn_future' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>spawn_future</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#cmplsig' title='33.10&emsp;Completion signatures'>[exec.<span class='shy'></span>cmplsig]</a>, completion signatures</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:completion-signature' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='conceptref:completion-signature'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:completion-signature' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='conceptref:completion-signature_'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Fns<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:completion_signatures'><a class='hidden_link' href='#lib:completion_signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>completion_signatures</a></span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sigs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:valid-completion-signatures'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;            <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>struct</span> dependent_sender_error <span class='operator'>:</span> exception <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#getcomplsigs' title='33.9.9&emsp;execution&#x200b;::&#x200b;get_&shy;completion_&shy;signatures'>[exec.<span class='shy'></span>getcomplsigs]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>consteval</span> <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:valid-completion-signatures_'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> <span class='keyword'>auto</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> completion_signatures_of_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_completion_signatures<span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='comment'>// <a href='#run.loop' title='33.12.1&emsp;execution&#x200b;::&#x200b;run_&shy;loop'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop]</a>, run_loop</span>
  <span class='keyword'>class</span> run_loop;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#consumers' title='33.9.13&emsp;Sender consumers'>[exec.<span class='shy'></span>consumers]</a>, consumers</span>
  <span class='keyword'>struct</span> <span id='lib:sync_wait_t'><a class='hidden_link' href='#lib:sync_wait_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> <span id='lib:sync_wait_with_variant_t'><a class='hidden_link' href='#lib:sync_wait_with_variant_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_with_variant_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;

  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sync_wait_t <span id='lib:sync_wait'><a class='hidden_link' href='#lib:sync_wait' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> sync_wait_with_variant_t <span id='lib:sync_wait_with_variant'><a class='hidden_link' href='#lib:sync_wait_with_variant' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>sync_wait_with_variant</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#consumers' title='33.9.13&emsp;Sender consumers'>[exec.<span class='shy'></span>consumers]</a>, consumers</span>
  <span class='keyword'>struct</span> <span id='lib:spawn_t'><a class='hidden_link' href='#lib:spawn_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>spawn_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> spawn_t spawn<span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#as.awaitable' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable'>[exec.<span class='shy'></span>as.<span class='shy'></span>awaitable]</a></span>
  <span class='keyword'>struct</span> <span id='lib:as_awaitable_t'><a class='hidden_link' href='#lib:as_awaitable_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>as_awaitable_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> as_awaitable_t <span id='lib:as_awaitable'><a class='hidden_link' href='#lib:as_awaitable' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>as_awaitable</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#with.awaitable.senders' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders'>[exec.<span class='shy'></span>with.<span class='shy'></span>awaitable.<span class='shy'></span>senders]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type_'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> with_awaitable_senders;

  <span class='comment'>// <a href='#scope.concepts' title='33.14.1&emsp;Execution scope concepts'>[exec.<span class='shy'></span>scope.<span class='shy'></span>concepts]</a>, scope concepts</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='comment'>// <a href='#scope.simple.counting' title='33.14.2.2&emsp;Simple Counting Scope'>[exec.<span class='shy'></span>scope.<span class='shy'></span>simple.<span class='shy'></span>counting]</a></span>
  <span class='keyword'>class</span> simple_counting_scope;

  <span class='comment'>// <a href='#scope.counting' title='33.14.2.3&emsp;Counting Scope'>[exec.<span class='shy'></span>scope.<span class='shy'></span>counting]</a></span>
  <span class='keyword'>class</span> counting_scope;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#par.scheduler' title='33.15&emsp;Parallel scheduler'>[exec.<span class='shy'></span>par.<span class='shy'></span>scheduler]</a>, parallel scheduler</span>
  <span class='keyword'>class</span> <span id='lib:parallel_scheduler'><a class='hidden_link' href='#lib:parallel_scheduler' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>parallel_scheduler</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  parallel_scheduler get_parallel_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='comment'>// <a href='#sysctxrepl' title='33.16&emsp;Namespace system_&shy;context_&shy;replaceability'>[exec.<span class='shy'></span>sysctxrepl]</a>, namespace <span class='tcode_in_codeblock'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability</span></span>
<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution<span class='operator'>::</span><span id='lib:system_context_replaceability'><a class='hidden_link' href='#lib:system_context_replaceability' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>system_context_replaceability</a></span> <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> receiver_proxy;
  <span class='keyword'>struct</span> bulk_item_receiver_proxy;
  <span class='keyword'>struct</span> parallel_scheduler_backend;

  shared_ptr<span class='anglebracket'>&lt;</span>parallel_scheduler_backend<span class='anglebracket'>&gt;</span> query_parallel_scheduler_backend<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#affine.on' title='33.13.3&emsp;execution&#x200b;::&#x200b;affine_&shy;on'>[exec.<span class='shy'></span>affine.<span class='shy'></span>on]</a></span>
  <span class='keyword'>struct</span> <span id='lib:affine_on_t'><a class='hidden_link' href='#lib:affine_on_t' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>affine_on_t</a></span> <span class='curlybracket'>{</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> affine_on_t <span id='lib:affine_on'><a class='hidden_link' href='#lib:affine_on' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>affine_on</a></span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#inline.scheduler' title='33.13.4&emsp;execution&#x200b;::&#x200b;inline_&shy;scheduler'>[exec.<span class='shy'></span>inline.<span class='shy'></span>scheduler]</a></span>
  <span class='keyword'>class</span> <span id='lib:inline_scheduler'><a class='hidden_link' href='#lib:inline_scheduler' title='33.13.4&emsp;execution&#x200b;::&#x200b;inline_&shy;scheduler&emsp;[exec.inline.scheduler]'>inline_scheduler</a></span>;

  <span class='comment'>// <a href='#task.scheduler' title='33.13.5&emsp;execution&#x200b;::&#x200b;task_&shy;scheduler'>[exec.<span class='shy'></span>task.<span class='shy'></span>scheduler]</a></span>
  <span class='keyword'>class</span> <span id='lib:task_scheduler'><a class='hidden_link' href='#lib:task_scheduler' title='33.13.5&emsp;execution&#x200b;::&#x200b;task_&shy;scheduler&emsp;[exec.task.scheduler]'>task_scheduler</a></span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span id='lib:with_error'><a class='hidden_link' href='#lib:with_error' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'>with_error</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> type <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span>;
    type error;
  <span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
    with_error<span class='parenthesis'>(</span>E<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> with_error<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__'><span class='tcode_in_codeblock'>scheduler</span></span></a> Sch<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> change_coroutine_scheduler <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> type <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>;
    type scheduler;
  <span class='curlybracket'>}</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___'><span class='tcode_in_codeblock'>scheduler</span></span></a> Sch<span class='anglebracket'>&gt;</span>
    change_coroutine_scheduler<span class='parenthesis'>(</span>Sch<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> change_coroutine_scheduler<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>;

  <span class='comment'>// <a href='#task' title='33.13.6&emsp;execution&#x200b;::&#x200b;task'>[exec.<span class='shy'></span>task]</a></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Environment<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> <span id='lib:task'><a class='hidden_link' href='#lib:task' title='33.13.6.2&emsp;Class template task&emsp;[task.class]'>task</a></span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='para' id='execution.syn-1'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L770'>#</a></div><div class='texpara'><div id='execution.syn-1.sentence-1' class='sentence'>The exposition-only type <span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
is defined as follows:
<ul class='itemize'><li id='execution.syn-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-1.1'>(1.1)</a></div>If <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Ts<span class='parenthesis'>)</span></span> is greater than zero,
<span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> denotes <span class='texttt'>variant<span class='anglebracket'>&lt;</span>Us<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
where <span class='texttt'>Us<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> is the pack <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
with duplicate types removed.</li><li id='execution.syn-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-1.2'>(1.2)</a></div>Otherwise, <span class='texttt'><span class='texttt'><i >variant-or-empty</i></span><span class='anglebracket'>&lt;</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> denotes
the exposition-only class type:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >empty-variant</i> <span class='curlybracket'>{</span>        <span class='comment'>// <i >exposition only</i></span>
    <i >empty-variant</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></li></ul></div></div></div><div class='para' id='execution.syn-2'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L791'>#</a></div><div class='texpara'><div id='execution.syn-2.sentence-1' class='sentence'>For type <span class='texttt'>Sndr</span> and pack of types <span class='texttt'>Env</span>,
let <span class='texttt'>CS</span> be <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#execution.syn-2.sentence-1'>.</a></div> <div id='execution.syn-2.sentence-2' class='sentence'>Then <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> is ill-formed
if <span class='texttt'>CS</span> is ill-formed or
if <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&gt;</span> <span class='literal'>1</span></span> is <span class='texttt'><span class='literal'>true</span></span>;
otherwise, it is an alias for:
<ul class='itemize'><li id='execution.syn-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.1'>(2.1)</a></div><span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t, CS, decay_<span class='shy'></span>t, type_<span class='shy'></span>identity_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
if that type is well-formed,</li><li id='execution.syn-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.2'>(2.2)</a></div>Otherwise, <span class='texttt'><span class='keyword'>void</span></span>
if <span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t, CS, tuple, variant<span class='anglebracket'>&gt;</span></span> is
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> or <span class='texttt'>variant<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span>,</li><li id='execution.syn-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.3'>(2.3)</a></div>Otherwise, <span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t, CS, <span class='texttt'><i >decayed-tuple</i></span>, type_<span class='shy'></span>identity_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
if that<br/> type is well-formed,</li><li id='execution.syn-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#execution.syn-2.4'>(2.4)</a></div>Otherwise, <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> is ill-formed<a class='hidden_link' href='#execution.syn-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='execution.syn-3'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L813'>#</a></div><div class='texpara'><div id='execution.syn-3.sentence-1' class='sentence'>The exposition-only concept <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender_'><span class='texttt'><i >single-sender</i></span></span></a> is defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:single-sender'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='curlybracket'>{</span>
        <span class='keyword'>typename</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='execution.syn-4'><div class='marginalizedparent'><a class='marginalized' href='#execution.syn-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L825'>#</a></div><div class='texpara'><div id='execution.syn-4.sentence-1' class='sentence'>A type satisfies and models the exposition-only concept
<a class='hidden_link' href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='concept:valid-completion-signatures'><span class='texttt'><i >valid-completion-signatures</i></span></span></a> if
it is a specialization of the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#execution.syn-4.sentence-1'>.</a></div></div></div></div><div id='queries' class='section'><h2 ><a class='secnum' href='#queries' style='min-width:65pt'>33.5</a> Queries <a class='abbr_ref' href='exec.queries'>[exec.queries]</a></h2><div id='fwd.env' class='section'><h3 ><a class='secnum' href='#fwd.env' style='min-width:80pt'>33.5.1</a> <span class='texttt'>forwarding_<span class='shy'></span>query</span> <a class='abbr_ref' href='exec.fwd.env'>[exec.fwd.env]</a></h3><div class='para' id='fwd.env-1'><div class='marginalizedparent'><a class='marginalized' href='#fwd.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L834'>#</a></div><div class='texpara'><div id='fwd.env-1.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query</span> asks a query object
whether it should be forwarded through queryable adaptors<a class='hidden_link' href='#fwd.env-1.sentence-1'>.</a></div></div></div><div class='para' id='fwd.env-2'><div class='marginalizedparent'><a class='marginalized' href='#fwd.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L838'>#</a></div><div class='texpara'><div id='fwd.env-2.sentence-1' class='sentence'>The name <span class='texttt'>forwarding_<span class='shy'></span>query</span> denotes a query object<a class='hidden_link' href='#fwd.env-2.sentence-1'>.</a></div> <div id='fwd.env-2.sentence-2' class='sentence'>For some query object <span class='texttt'>q</span> of type <span class='texttt'>Q</span>,
<span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='fwd.env-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.1'>(2.1)</a></div><div class='texpara'><div id='fwd.env-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>q<span class='operator'>.</span>query<span class='parenthesis'>(</span>forwarding_<span class='shy'></span>query<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#fwd.env-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='fwd.env-2.1.sentence-2' class='sentence'><i >Mandates</i>: The expression above has type <span class='texttt'><span class='keyword'>bool</span></span> and
is a core constant expression if <span class='texttt'>q</span> is a core constant expression<a class='hidden_link' href='#fwd.env-2.1.sentence-2'>.</a></div></div></li><li id='fwd.env-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.2'>(2.2)</a></div><div class='texpara'><div id='fwd.env-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='literal'>true</span></span> if <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>Q, forwarding_<span class='shy'></span>query_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#fwd.env-2.2.sentence-1'>.</a></div></div></li><li id='fwd.env-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#fwd.env-2.3'>(2.3)</a></div><div class='texpara'><div id='fwd.env-2.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#fwd.env-2.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='get.allocator' class='section'><h3 ><a class='secnum' href='#get.allocator' style='min-width:80pt'>33.5.2</a> <span class='texttt'>get_<span class='shy'></span>allocator</span> <a class='abbr_ref' href='exec.get.allocator'>[exec.get.allocator]</a></h3><div class='para' id='get.allocator-1'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L858'>#</a></div><div class='texpara'><div id='get.allocator-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>allocator</span> asks a queryable object for its associated allocator<a class='hidden_link' href='#get.allocator-1.sentence-1'>.</a></div></div></div><div class='para' id='get.allocator-2'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L861'>#</a></div><div class='texpara'><div id='get.allocator-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>allocator</span> denotes a query object<a class='hidden_link' href='#get.allocator-2.sentence-1'>.</a></div> <div id='get.allocator-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.allocator-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.allocator-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies
<a href='allocator.requirements.general#concept:simple-allocator' title='16.4.4.6.1&emsp;General&emsp;[allocator.requirements.general]'><span id='conceptref:simple-allocator'><span class='texttt'><i >simple-allocator</i></span></span></a> (<a href='allocator.requirements.general' title='16.4.4.6.1&emsp;General'>[allocator.<span class='shy'></span>requirements.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#get.allocator-2.sentence-3'>.</a></div></div></div><div class='para' id='get.allocator-3'><div class='marginalizedparent'><a class='marginalized' href='#get.allocator-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L872'>#</a></div><div class='texpara'><div id='get.allocator-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator<span class='parenthesis'>)</span></span> is a core constant expression and
has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.allocator-3.sentence-1'>.</a></div></div></div></div><div id='get.stop.token' class='section'><h3 ><a class='secnum' href='#get.stop.token' style='min-width:80pt'>33.5.3</a> <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> <a class='abbr_ref' href='exec.get.stop.token'>[exec.get.stop.token]</a></h3><div class='para' id='get.stop.token-1'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L878'>#</a></div><div class='texpara'><div id='get.stop.token-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> asks a queryable object for an associated stop token<a class='hidden_link' href='#get.stop.token-1.sentence-1'>.</a></div></div></div><div class='para' id='get.stop.token-2'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L881'>#</a></div><div class='texpara'><div id='get.stop.token-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token</span> denotes a query object<a class='hidden_link' href='#get.stop.token-2.sentence-1'>.</a></div> <div id='get.stop.token-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.stop.token-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.stop.token-2.1'>(2.1)</a></div><div class='texpara'><div id='get.stop.token-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#get.stop.token-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.stop.token-2.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a><a class='hidden_link' href='#get.stop.token-2.1.sentence-2'>.</a></div></div></li><li id='get.stop.token-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.stop.token-2.2'>(2.2)</a></div><div class='texpara'><div id='get.stop.token-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token<span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#get.stop.token-2.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.stop.token-3'><div class='marginalizedparent'><a class='marginalized' href='#get.stop.token-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L897'>#</a></div><div class='texpara'><div id='get.stop.token-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> is a core constant expression and
has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.stop.token-3.sentence-1'>.</a></div></div></div></div><div id='get.env' class='section'><h3 ><a class='secnum' href='#get.env' style='min-width:80pt'>33.5.4</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.get.env'>[exec.get.env]</a></h3><div class='para' id='get.env-1'><div class='marginalizedparent'><a class='marginalized' href='#get.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L903'>#</a></div><div class='texpara'><div id='get.env-1.sentence-1' class='sentence'><span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#get.env-1.sentence-1'>.</a></div> <div id='get.env-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>o</span>,
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.env-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.env-1.1'>(1.1)</a></div><div class='texpara'><div id='get.env-1.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>o<span class='parenthesis'>)</span><span class='operator'>.</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is well-formed<a class='hidden_link' href='#get.env-1.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.env-1.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies
<a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______'><span class='texttt'><i >queryable</i></span></span></a> (<a href='#queryable' title='33.2&emsp;Queries and queryables'>[exec.<span class='shy'></span>queryable]</a>)<a class='hidden_link' href='#get.env-1.1.sentence-2'>.</a></div></div></li><li id='get.env-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.env-1.2'>(1.2)</a></div><div class='texpara'><div id='get.env-1.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#get.env-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.env-2'><div class='marginalizedparent'><a class='marginalized' href='#get.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L919'>#</a></div><div class='texpara'><div id='get.env-2.sentence-1' class='sentence'>The value of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span></span> shall be valid while <span class='texttt'>o</span> is valid<a class='hidden_link' href='#get.env-2.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='get.env-3'><div class='marginalizedparent'><a class='marginalized' href='#get.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L922'>#</a></div><div class='texpara'><div id='get.env-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#get.env-note-1'>1</a></i>:&ensp;<div id='get.env-3.sentence-1' class='sentence'>When passed a sender object,
<span class='texttt'>get_<span class='shy'></span>env</span> returns the sender's associated attributes<a class='hidden_link' href='#get.env-3.sentence-1'>.</a></div> <div id='get.env-3.sentence-2' class='sentence'>When passed a receiver,
<span class='texttt'>get_<span class='shy'></span>env</span> returns the receiver's associated execution environment<a class='hidden_link' href='#get.env-3.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='get.domain' class='section'><h3 ><a class='secnum' href='#get.domain' style='min-width:80pt'>33.5.5</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>domain</span> <a class='abbr_ref' href='exec.get.domain'>[exec.get.domain]</a></h3><div class='para' id='get.domain-1'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L932'>#</a></div><div class='texpara'><div id='get.domain-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>domain</span> asks a queryable object
for its associated execution domain tag<a class='hidden_link' href='#get.domain-1.sentence-1'>.</a></div></div></div><div class='para' id='get.domain-2'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L936'>#</a></div><div class='texpara'><div id='get.domain-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>domain</span> denotes a query object<a class='hidden_link' href='#get.domain-2.sentence-1'>.</a></div> <div id='get.domain-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.domain-2.sentence-2'>.</a></div></div></div><div class='para' id='get.domain-3'><div class='marginalizedparent'><a class='marginalized' href='#get.domain-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L942'>#</a></div><div class='texpara'><div id='get.domain-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.domain-3.sentence-1'>.</a></div></div></div></div><div id='get.scheduler' class='section'><h3 ><a class='secnum' href='#get.scheduler' style='min-width:80pt'>33.5.6</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.scheduler'>[exec.get.scheduler]</a></h3><div class='para' id='get.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L948'>#</a></div><div class='texpara'><div id='get.scheduler-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>scheduler</span> asks a queryable object for its associated scheduler<a class='hidden_link' href='#get.scheduler-1.sentence-1'>.</a></div></div></div><div class='para' id='get.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L951'>#</a></div><div class='texpara'><div id='get.scheduler-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>scheduler</span> denotes a query object<a class='hidden_link' href='#get.scheduler-2.sentence-1'>.</a></div> <div id='get.scheduler-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.scheduler-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.scheduler-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.scheduler-2.sentence-3'>.</a></div></div></div><div class='para' id='get.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#get.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L961'>#</a></div><div class='texpara'><div id='get.scheduler-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.scheduler-3.sentence-1'>.</a></div></div></div></div><div id='get.delegation.scheduler' class='section'><h3 ><a class='secnum' href='#get.delegation.scheduler' style='min-width:80pt'>33.5.7</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.delegation.scheduler'>[exec.get.delegation.scheduler]</a></h3><div class='para' id='get.delegation.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L967'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> asks a queryable object for a scheduler
that can be used to delegate work to
for the purpose of forward progress delegation (<a href='intro.progress' title='6.10.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)<a class='hidden_link' href='#get.delegation.scheduler-1.sentence-1'>.</a></div></div></div><div class='para' id='get.delegation.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L972'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> denotes a query object<a class='hidden_link' href='#get.delegation.scheduler-2.sentence-1'>.</a></div> <div id='get.delegation.scheduler-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.delegation.scheduler-2.sentence-2'>.</a></div></div><div class='texpara'><div id='get.delegation.scheduler-2.sentence-3' class='sentence'><i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.delegation.scheduler-2.sentence-3'>.</a></div></div></div><div class='para' id='get.delegation.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#get.delegation.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L982'>#</a></div><div class='texpara'><div id='get.delegation.scheduler-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is
a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.delegation.scheduler-3.sentence-1'>.</a></div></div></div></div><div id='get.fwd.progress' class='section'><h3 ><a class='secnum' href='#get.fwd.progress' style='min-width:80pt'>33.5.8</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> <a class='abbr_ref' href='exec.get.fwd.progress'>[exec.get.fwd.progress]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>enum</span> <span class='keyword'>class</span> <span id='lib:forward_progress_guarantee'><a class='hidden_link' href='#lib:forward_progress_guarantee' title='33.5.8&emsp;execution&#x200b;::&#x200b;get_&shy;forward_&shy;progress_&shy;guarantee&emsp;[exec.get.fwd.progress]'>forward_progress_guarantee</a></span> <span class='curlybracket'>{</span>
    concurrent,
    parallel,
    weakly_parallel
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='get.fwd.progress-1'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L998'>#</a></div><div class='texpara'><div id='get.fwd.progress-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> asks a scheduler about
the forward progress guarantee of execution agents
created by that scheduler's associated execution resource (<a href='intro.progress' title='6.10.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)<a class='hidden_link' href='#get.fwd.progress-1.sentence-1'>.</a></div></div></div><div class='para' id='get.fwd.progress-2'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1003'>#</a></div><div class='texpara'><div id='get.fwd.progress-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> denotes a query object<a class='hidden_link' href='#get.fwd.progress-2.sentence-1'>.</a></div> <div id='get.fwd.progress-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sch</span>, let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#get.fwd.progress-2.sentence-2'>.</a></div> <div id='get.fwd.progress-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______'><span class='texttt'>scheduler</span></span></a>,
<span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span> is ill-formed<a class='hidden_link' href='#get.fwd.progress-2.sentence-3'>.</a></div> <div id='get.fwd.progress-2.sentence-4' class='sentence'>Otherwise,
<span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='get.fwd.progress-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.fwd.progress-2.1'>(2.1)</a></div><div class='texpara'><div id='get.fwd.progress-2.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span><span class='texttt'><i >AS-CONST</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
if that expression is well-formed<a class='hidden_link' href='#get.fwd.progress-2.1.sentence-1'>.</a></div></div><div class='texpara'><div id='get.fwd.progress-2.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above is <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee</span><a class='hidden_link' href='#get.fwd.progress-2.1.sentence-2'>.</a></div></div></li><li id='get.fwd.progress-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#get.fwd.progress-2.2'>(2.2)</a></div><div class='texpara'><div id='get.fwd.progress-2.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>weakly_<span class='shy'></span>parallel</span><a class='hidden_link' href='#get.fwd.progress-2.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='get.fwd.progress-3'><div class='marginalizedparent'><a class='marginalized' href='#get.fwd.progress-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1021'>#</a></div><div class='texpara'><div id='get.fwd.progress-3.sentence-1' class='sentence'>If <span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> for some scheduler <span class='texttt'>sch</span>
returns <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>concurrent</span>,
all execution agents created by that scheduler's associated execution resource
shall provide the concurrent forward progress guarantee<a class='hidden_link' href='#get.fwd.progress-3.sentence-1'>.</a></div> <div id='get.fwd.progress-3.sentence-2' class='sentence'>If it returns <span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>parallel</span>,
all such execution agents
shall provide at least the parallel forward progress guarantee<a class='hidden_link' href='#get.fwd.progress-3.sentence-2'>.</a></div></div></div></div><div id='get.compl.sched' class='section'><h3 ><a class='secnum' href='#get.compl.sched' style='min-width:80pt'>33.5.9</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.get.compl.sched'>[exec.get.compl.sched]</a></h3><div class='para' id='get.compl.sched-1'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1032'>#</a></div><div class='texpara'><div id='get.compl.sched-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag&gt;</i></span></span> obtains
the completion scheduler associated with a completion tag
from a sender's attributes<a class='hidden_link' href='#get.compl.sched-1.sentence-1'>.</a></div></div></div><div class='para' id='get.compl.sched-2'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1037'>#</a></div><div class='texpara'><div id='get.compl.sched-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler</span> denotes a query object template<a class='hidden_link' href='#get.compl.sched-2.sentence-1'>.</a></div> <div id='get.compl.sched-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>q</span>,
the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>
is ill-formed if <span class='texttt'><i >completion-tag</i></span> is not one of
<span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span>, <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t</span>, or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#get.compl.sched-2.sentence-2'>.</a></div> <div id='get.compl.sched-2.sentence-3' class='sentence'>Otherwise, <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>
is expression-equivalent to
<span class='codeblock'><i >MANDATE-NOTHROW</i><span class='parenthesis'>(</span><i >AS-CONST</i><span class='parenthesis'>(</span>q<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_completion_scheduler<span class='anglebracket'>&lt;</span><i >completion-tag</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: If the expression above is well-formed,
its type satisfies <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_______'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#get.compl.sched-2.sentence-3'>.</a></div></div></div><div class='para' id='get.compl.sched-3'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1052'>#</a></div><div class='texpara'><div id='get.compl.sched-3.sentence-1' class='sentence'>Let <span class='texttt'><i >completion-fn</i></span> be a completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>);
let <span class='texttt'><i >completion-tag</i></span> be
the associated completion tag of <span class='texttt'><i >completion-fn</i></span>;
let <span class='texttt'>args</span> be a pack of subexpressions; and
let <span class='texttt'>sndr</span> be a subexpression
such that <span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span> and
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is well-formed and denotes a scheduler <span class='texttt'>sch</span><a class='hidden_link' href='#get.compl.sched-3.sentence-1'>.</a></div> <div id='get.compl.sched-3.sentence-2' class='sentence'>If an asynchronous operation
created by connecting <span class='texttt'>sndr</span> with a receiver <span class='texttt'>rcvr</span>
causes the evaluation of <span class='texttt'><span class='texttt'><i >completion-fn</i></span><span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
the behavior is undefined
unless the evaluation happens on an execution agent
that belongs to <span class='texttt'>sch</span>'s associated execution resource<a class='hidden_link' href='#get.compl.sched-3.sentence-2'>.</a></div></div></div><div class='para' id='get.compl.sched-4'><div class='marginalizedparent'><a class='marginalized' href='#get.compl.sched-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1068'>#</a></div><div class='texpara'><div id='get.compl.sched-4.sentence-1' class='sentence'>The expression
<span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >completion-tag</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span>
is a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.compl.sched-4.sentence-1'>.</a></div></div></div></div><div id='get.await.adapt' class='section'><h3 ><a class='secnum' href='#get.await.adapt' style='min-width:80pt'>33.5.10</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>await_<span class='shy'></span>completion_<span class='shy'></span>adaptor</span> <a class='abbr_ref' href='exec.get.await.adapt'>[exec.get.await.adapt]</a></h3><div class='para' id='get.await.adapt-1'><div class='marginalizedparent'><a class='marginalized' href='#get.await.adapt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1075'>#</a></div><div class='texpara'><div id='get.await.adapt-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>await_<span class='shy'></span>completion_<span class='shy'></span>adaptor</span> asks a queryable object for
its associated awaitable completion adaptor<a class='hidden_link' href='#get.await.adapt-1.sentence-1'>.</a></div></div></div><div class='para' id='get.await.adapt-2'><div class='marginalizedparent'><a class='marginalized' href='#get.await.adapt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1079'>#</a></div><div class='texpara'><div id='get.await.adapt-2.sentence-1' class='sentence'>The name <span class='texttt'>get_<span class='shy'></span>await_<span class='shy'></span>completion_<span class='shy'></span>adaptor</span> denotes a query object<a class='hidden_link' href='#get.await.adapt-2.sentence-1'>.</a></div> <div id='get.await.adapt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>env</span>,
<span class='codeblock'>get_await_completion_adaptor<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>
</span>
is expression-equivalent to
<span class='codeblock'><i >MANDATE-NOTHROW</i><span class='parenthesis'>(</span><i >AS-CONST</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>get_await_completion_adaptor<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='get.await.adapt-3'><div class='marginalizedparent'><a class='marginalized' href='#get.await.adapt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1090'>#</a></div><div class='texpara'><div id='get.await.adapt-3.sentence-1' class='sentence'><span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>execution<span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>await_<span class='shy'></span>completion_<span class='shy'></span>adaptor<span class='parenthesis'>)</span></span>
is a core constant expression and has value <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#get.await.adapt-3.sentence-1'>.</a></div></div></div></div></div><div id='sched' class='section'><h2 ><a class='secnum' href='#sched' style='min-width:65pt'>33.6</a> Schedulers <a class='abbr_ref' href='exec.sched'>[exec.sched]</a></h2><div class='para' id='sched-1'><div class='marginalizedparent'><a class='marginalized' href='#sched-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1096'>#</a></div><div class='texpara'><div id='sched-1.sentence-1' class='sentence'>The <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler________'><span class='texttt'>scheduler</span></span></a> concept defines
the requirements of a scheduler type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#sched-1.sentence-1'>.</a></div> <div id='sched-1.sentence-2' class='sentence'><span class='texttt'>schedule</span> is a customization point object
that accepts a scheduler<a class='hidden_link' href='#sched-1.sentence-2'>.</a></div> <div id='sched-1.sentence-3' class='sentence'>A valid invocation of <span class='texttt'>schedule</span> is a schedule-expression<a class='hidden_link' href='#sched-1.sentence-3'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='concept:scheduler'><span id='lib:scheduler'><span class='tcode_in_codeblock'>scheduler</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='operator'>::</span>scheduler_concept, scheduler_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span>Sch<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sch<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> schedule<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______'><span class='tcode_in_codeblock'>sender</span></span></a>;
        <span class='curlybracket'>{</span> <span class='keyword'>auto</span><span class='parenthesis'>(</span>get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
            get_env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>
              <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable'><span class='tcode_in_codeblock'>equality_<span class='shy'></span>comparable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable'><span class='tcode_in_codeblock'>copyable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='sched-2'><div class='marginalizedparent'><a class='marginalized' href='#sched-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1119'>#</a></div><div class='texpara'><div id='sched-2.sentence-1' class='sentence'>Let <span class='texttt'>Sch</span> be the type of a scheduler and
let <span class='texttt'>Env</span> be the type of an execution environment
for which <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>, Env<span class='anglebracket'>&gt;</span></span>
is satisfied<a class='hidden_link' href='#sched-2.sentence-1'>.</a></div> <div id='sched-2.sentence-2' class='sentence'>Then <span class='texttt'><a href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of'><span class='texttt'><i >sender-in-of</i></span></span></a><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>, Env<span class='anglebracket'>&gt;</span></span>
shall be modeled<a class='hidden_link' href='#sched-2.sentence-2'>.</a></div></div></div><div class='para' id='sched-3'><div class='marginalizedparent'><a class='marginalized' href='#sched-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1127'>#</a></div><div class='texpara'><div id='sched-3.sentence-1' class='sentence'>No operation required by
<span class='texttt'><a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable_'><span class='texttt'>copyable</span></span></a><span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> and
<span class='texttt'><a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable_'><span class='texttt'>equality_<span class='shy'></span>comparable</span></span></a><span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
shall exit via an exception<a class='hidden_link' href='#sched-3.sentence-1'>.</a></div> <div id='sched-3.sentence-2' class='sentence'>None of these operations,
nor a scheduler type's <span class='texttt'>schedule</span> function,
shall introduce data races
as a result of potentially concurrent (<a href='intro.races' title='6.10.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>) invocations
of those operations from different threads<a class='hidden_link' href='#sched-3.sentence-2'>.</a></div></div></div><div class='para' id='sched-4'><div class='marginalizedparent'><a class='marginalized' href='#sched-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1138'>#</a></div><div class='texpara'><div id='sched-4.sentence-1' class='sentence'>For any two values <span class='texttt'>sch1</span> and <span class='texttt'>sch2</span>
of some scheduler type <span class='texttt'>Sch</span>,
<span class='texttt'>sch1 <span class='operator'>=</span><span class='operator'>=</span> sch2</span> shall return <span class='texttt'><span class='literal'>true</span></span>
only if both <span class='texttt'>sch1</span> and <span class='texttt'>sch2</span> share
the same associated execution resource<a class='hidden_link' href='#sched-4.sentence-1'>.</a></div></div></div><div class='para' id='sched-5'><div class='marginalizedparent'><a class='marginalized' href='#sched-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1145'>#</a></div><div class='texpara'><div id='sched-5.sentence-1' class='sentence'>For a given scheduler expression <span class='texttt'>sch</span>,
the expression
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
shall compare equal to <span class='texttt'>sch</span><a class='hidden_link' href='#sched-5.sentence-1'>.</a></div></div></div><div class='para' id='sched-6'><div class='marginalizedparent'><a class='marginalized' href='#sched-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1151'>#</a></div><div class='texpara'><div id='sched-6.sentence-1' class='sentence'>For a given scheduler expression <span class='texttt'>sch</span>,
if the expression <span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is well-formed,
then the expression <span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is also well-formed and has the same type<a class='hidden_link' href='#sched-6.sentence-1'>.</a></div></div></div><div class='para' id='sched-7'><div class='marginalizedparent'><a class='marginalized' href='#sched-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1157'>#</a></div><div class='texpara'><div id='sched-7.sentence-1' class='sentence'>A scheduler type's destructor shall not block
pending completion of any receivers
connected to the sender objects returned from <span class='texttt'>schedule</span><a class='hidden_link' href='#sched-7.sentence-1'>.</a></div> <div id='sched-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sched-note-1'>1</a></i>:&ensp;<div id='sched-7.sentence-2' class='sentence'>The ability to wait for completion of submitted function objects
can be provided by the associated execution resource of the scheduler<a class='hidden_link' href='#sched-7.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='recv' class='section'><h2 ><a class='secnum' href='#recv' style='min-width:65pt'>33.7</a> Receivers <a class='abbr_ref' href='exec.recv'>[exec.recv]</a></h2><div id='recv.concepts' class='section'><h3 ><a class='secnum' href='#recv.concepts' style='min-width:80pt'>33.7.1</a> Receiver concepts <a class='abbr_ref' href='exec.recv.concepts'>[exec.recv.concepts]</a></h3><div class='para' id='recv.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1170'>#</a></div><div class='texpara'><div id='recv.concepts-1.sentence-1' class='sentence'>A receiver represents the continuation of an asynchronous operation<a class='hidden_link' href='#recv.concepts-1.sentence-1'>.</a></div> <div id='recv.concepts-1.sentence-2' class='sentence'>The <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_'><span class='texttt'>receiver</span></span></a> concept defines
the requirements for a receiver type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#recv.concepts-1.sentence-2'>.</a></div> <div id='recv.concepts-1.sentence-3' class='sentence'>The <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of_'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a> concept defines
the requirements for a receiver type that is usable as
the first argument of a set of completion operations
corresponding to a set of completion signatures<a class='hidden_link' href='#recv.concepts-1.sentence-3'>.</a></div> <div id='recv.concepts-1.sentence-4' class='sentence'>The <span class='texttt'>get_<span class='shy'></span>env</span> customization point object is used to access
a receiver's associated environment<a class='hidden_link' href='#recv.concepts-1.sentence-4'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:receiver'><span id='lib:receiver'><span class='tcode_in_codeblock'>receiver</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from__'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>::</span>receiver_concept, receiver_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span><span class='keyword'>const</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible_'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>       <span class='comment'>// rvalues are movable, and</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, Rcvr<span class='anglebracket'>&gt;</span>;   <span class='comment'>// lvalues are copyable</span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Signature, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:valid-completion-for' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:valid-completion-for'><span class='tcode_in_codeblock'><i >valid-completion-for</i></span></span></a> <span class='operator'>=</span>                 <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Signature<span class='operator'>*</span> sig<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
            <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>Tag, remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
        <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>(</span>sig<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-completions' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:has-completions'><span class='tcode_in_codeblock'><i >has-completions</i></span></span></a> <span class='operator'>=</span>                      <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Completions<span class='operator'>*</span> completions<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><a href='#concept:valid-completion-for' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:valid-completion-for'><span class='tcode_in_codeblock'><i >valid-completion-for</i></span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>Sigs<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>completion_signatures<span class='anglebracket'>&lt;</span>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>*</span><span class='parenthesis'>)</span>
        <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>(</span>completions<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='concept:receiver_of'><span id='lib:receiver_of'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver__'><span class='tcode_in_codeblock'>receiver</span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:has-completions' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:has-completions'><span class='tcode_in_codeblock'><i >has-completions</i></span></span></a><span class='anglebracket'>&lt;</span>Rcvr, Completions<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='recv.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1212'>#</a></div><div class='texpara'><div id='recv.concepts-2.sentence-1' class='sentence'>Class types that are marked <span class='texttt'><span class='keyword'>final</span></span> do not model the <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver___'><span class='texttt'>receiver</span></span></a> concept<a class='hidden_link' href='#recv.concepts-2.sentence-1'>.</a></div></div></div><div class='para' id='recv.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#recv.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1215'>#</a></div><div class='texpara'><div id='recv.concepts-3.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver and
let <span class='texttt'>op_<span class='shy'></span>state</span> be an operation state associated with
an asynchronous operation created by connecting <span class='texttt'>rcvr</span> with a sender<a class='hidden_link' href='#recv.concepts-3.sentence-1'>.</a></div> <div id='recv.concepts-3.sentence-2' class='sentence'>Let <span class='texttt'>token</span> be a stop token equal to
<span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#recv.concepts-3.sentence-2'>.</a></div> <div id='recv.concepts-3.sentence-3' class='sentence'><span class='texttt'>token</span> shall remain valid
for the duration of the asynchronous operation's lifetime (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#recv.concepts-3.sentence-3'>.</a></div> <div id='recv.concepts-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#recv.concepts-note-1'>1</a></i>:&ensp;<div id='recv.concepts-3.sentence-4' class='sentence'>This means that, unless it knows about further guarantees
provided by the type of <span class='texttt'>rcvr</span>,
the implementation of <span class='texttt'>op_<span class='shy'></span>state</span> cannot use <span class='texttt'>token</span>
after it executes a completion operation<a class='hidden_link' href='#recv.concepts-3.sentence-4'>.</a></div> <div id='recv.concepts-3.sentence-5' class='sentence'>This also implies that any stop callbacks registered on token
must be destroyed before the invocation of the completion operation<a class='hidden_link' href='#recv.concepts-3.sentence-5'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='set.value' class='section'><h3 ><a class='secnum' href='#set.value' style='min-width:80pt'>33.7.2</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>value</span> <a class='abbr_ref' href='exec.set.value'>[exec.set.value]</a></h3><div class='para' id='set.value-1'><div class='marginalizedparent'><a class='marginalized' href='#set.value-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1234'>#</a></div><div class='texpara'><div id='set.value-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>value</span> is a value completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.value-1.sentence-1'>.</a></div> <div id='set.value-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span><a class='hidden_link' href='#set.value-1.sentence-2'>.</a></div> <div id='set.value-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
for a subexpression <span class='texttt'>rcvr</span> and
pack of subexpressions <span class='texttt'>vs</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.value-1.sentence-3'>.</a></div> <div id='set.value-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span>vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.value-1.sentence-4'>.</a></div></div></div></div><div id='set.error' class='section'><h3 ><a class='secnum' href='#set.error' style='min-width:80pt'>33.7.3</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.set.error'>[exec.set.error]</a></h3><div class='para' id='set.error-1'><div class='marginalizedparent'><a class='marginalized' href='#set.error-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1246'>#</a></div><div class='texpara'><div id='set.error-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>error</span> is an error completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.error-1.sentence-1'>.</a></div> <div id='set.error-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t</span><a class='hidden_link' href='#set.error-1.sentence-2'>.</a></div> <div id='set.error-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, err<span class='parenthesis'>)</span></span>
for some <span class='texttt'>subexpressions</span> <span class='texttt'>rcvr</span> and <span class='texttt'>err</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.error-1.sentence-3'>.</a></div> <div id='set.error-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.error-1.sentence-4'>.</a></div></div></div></div><div id='set.stopped' class='section'><h3 ><a class='secnum' href='#set.stopped' style='min-width:80pt'>33.7.4</a> <span class='texttt'>execution&#x200b;::&#x200b;set_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.set.stopped'>[exec.set.stopped]</a></h3><div class='para' id='set.stopped-1'><div class='marginalizedparent'><a class='marginalized' href='#set.stopped-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1257'>#</a></div><div class='texpara'><div id='set.stopped-1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>stopped</span> is a stopped completion function (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#set.stopped-1.sentence-1'>.</a></div> <div id='set.stopped-1.sentence-2' class='sentence'>Its associated completion tag is <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#set.stopped-1.sentence-2'>.</a></div> <div id='set.stopped-1.sentence-3' class='sentence'>The expression <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>
for a subexpression <span class='texttt'>rcvr</span> is ill-formed
if <span class='texttt'>rcvr</span> is an lvalue or an rvalue of const type<a class='hidden_link' href='#set.stopped-1.sentence-3'>.</a></div> <div id='set.stopped-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#set.stopped-1.sentence-4'>.</a></div></div></div></div></div><div id='opstate' class='section'><h2 ><a class='secnum' href='#opstate' style='min-width:65pt'>33.8</a> Operation states <a class='abbr_ref' href='exec.opstate'>[exec.opstate]</a></h2><div id='opstate.general' class='section'><h3 ><a class='secnum' href='#opstate.general' style='min-width:80pt'>33.8.1</a> General <a class='abbr_ref' href='exec.opstate.general'>[exec.opstate.general]</a></h3><div class='para' id='opstate.general-1'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1270'>#</a></div><div class='texpara'><div id='opstate.general-1.sentence-1' class='sentence'>The <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state_'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> concept defines
the requirements of an operation state type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#opstate.general-1.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> O<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='concept:operation_state'><span id='lib:operation_state'><span class='tcode_in_codeblock'>operation_<span class='shy'></span>state</span></span></span></a> <span class='operator'>=</span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from___'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> O<span class='operator'>::</span>operation_state_concept, operation_state_t<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>O<span class='operator'>&amp;</span> o<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        start<span class='parenthesis'>(</span>o<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='opstate.general-2'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1284'>#</a></div><div class='texpara'><div id='opstate.general-2.sentence-1' class='sentence'>If an <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state__'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> object is destroyed
during the lifetime of its asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>),
the behavior is undefined<a class='hidden_link' href='#opstate.general-2.sentence-1'>.</a></div> <div id='opstate.general-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#opstate.general-note-1'>1</a></i>:&ensp;<div id='opstate.general-2.sentence-2' class='sentence'>The <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state___'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> concept does not impose requirements
on any operations other than destruction and <span class='texttt'>start</span>,
including copy and move operations<a class='hidden_link' href='#opstate.general-2.sentence-2'>.</a></div> <div id='opstate.general-2.sentence-3' class='sentence'>Invoking any such operation on an object
whose type models <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state____'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> can lead to undefined behavior<a class='hidden_link' href='#opstate.general-2.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='opstate.general-3'><div class='marginalizedparent'><a class='marginalized' href='#opstate.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1296'>#</a></div><div class='texpara'><div id='opstate.general-3.sentence-1' class='sentence'>The program is ill-formed
if it performs a copy or move construction or assignment operation on
an operation state object created by connecting a library-provided sender<a class='hidden_link' href='#opstate.general-3.sentence-1'>.</a></div></div></div></div><div id='opstate.start' class='section'><h3 ><a class='secnum' href='#opstate.start' style='min-width:80pt'>33.8.2</a> <span class='texttt'>execution&#x200b;::&#x200b;start</span> <a class='abbr_ref' href='exec.opstate.start'>[exec.opstate.start]</a></h3><div class='para' id='opstate.start-1'><div class='marginalizedparent'><a class='marginalized' href='#opstate.start-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1303'>#</a></div><div class='texpara'><div id='opstate.start-1.sentence-1' class='sentence'>The name <span class='texttt'>start</span> denotes a customization point object
that starts (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the asynchronous operation associated with the operation state object<a class='hidden_link' href='#opstate.start-1.sentence-1'>.</a></div> <div id='opstate.start-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>op</span>,
the expression <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> is ill-formed
if <span class='texttt'>op</span> is an rvalue<a class='hidden_link' href='#opstate.start-1.sentence-2'>.</a></div> <div id='opstate.start-1.sentence-3' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >MANDATE-NOTHROW</i></span><span class='parenthesis'>(</span>op<span class='operator'>.</span>start<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#opstate.start-1.sentence-3'>.</a></div></div></div><div class='para' id='opstate.start-2'><div class='marginalizedparent'><a class='marginalized' href='#opstate.start-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1313'>#</a></div><div class='texpara'><div id='opstate.start-2.sentence-1' class='sentence'>If <span class='texttt'>op<span class='operator'>.</span>start<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> does not start (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the asynchronous operation associated with the operation state <span class='texttt'>op</span>,
the behavior of calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> is undefined<a class='hidden_link' href='#opstate.start-2.sentence-1'>.</a></div></div></div></div></div><div id='snd' class='section'><h2 ><a class='secnum' href='#snd' style='min-width:65pt'>33.9</a> Senders <a class='abbr_ref' href='exec.snd'>[exec.snd]</a></h2><div id='snd.general' class='section'><h3 ><a class='secnum' href='#snd.general' style='min-width:80pt'>33.9.1</a> General <a class='abbr_ref' href='exec.snd.general'>[exec.snd.general]</a></h3><div class='para' id='snd.general-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1322'>#</a></div><div class='texpara'><div id='snd.general-1.sentence-1' class='sentence'>Subclauses <a href='#factories' title='33.9.11&emsp;Sender factories'>[exec.<span class='shy'></span>factories]</a> and <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> define
customizable algorithms that return senders<a class='hidden_link' href='#snd.general-1.sentence-1'>.</a></div> <div id='snd.general-1.sentence-2' class='sentence'>Each algorithm has a default implementation<a class='hidden_link' href='#snd.general-1.sentence-2'>.</a></div> <div id='snd.general-1.sentence-3' class='sentence'>Let <span class='texttt'>sndr</span> be the result of an invocation of such an algorithm or
an object equal to the result (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>), and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.general-1.sentence-3'>.</a></div> <div id='snd.general-1.sentence-4' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver of type <span class='texttt'>Rcvr</span>
with associated environment <span class='texttt'>env</span> of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to_'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#snd.general-1.sentence-4'>.</a></div> <div id='snd.general-1.sentence-5' class='sentence'>For the default implementation of the algorithm that produced <span class='texttt'>sndr</span>,
connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
necessarily results in the potential evaluation (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>) of
a set of completion operations
whose first argument is a subexpression equal to <span class='texttt'>rcvr</span><a class='hidden_link' href='#snd.general-1.sentence-5'>.</a></div> <div id='snd.general-1.sentence-6' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of completion signatures corresponding to
this set of completion operations, and
let <span class='texttt'>CS</span> be
the type of the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.general-1.sentence-6'>.</a></div> <div id='snd.general-1.sentence-7' class='sentence'>Then <span class='texttt'>CS</span> is
a specialization of
the class template <span class='texttt'>completion_<span class='shy'></span>signatures</span> (<a href='#cmplsig' title='33.10&emsp;Completion signatures'>[exec.<span class='shy'></span>cmplsig]</a>),
the set of whose template arguments is <span class='texttt'>Sigs</span><a class='hidden_link' href='#snd.general-1.sentence-7'>.</a></div> <div id='snd.general-1.sentence-8' class='sentence'>If none of the types in <span class='texttt'>Sigs</span> are dependent on the type <span class='texttt'>Env</span>, then
the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is well-formed and
its type is <span class='texttt'>CS</span><a class='hidden_link' href='#snd.general-1.sentence-8'>.</a></div> <div id='snd.general-1.sentence-9' class='sentence'>If a user-provided implementation of the algorithm
that produced <span class='texttt'>sndr</span> is selected instead of the default:</div></div><div class='texpara'><ul class='itemize'><li id='snd.general-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.general-1.1'>(1.1)</a></div><div class='texpara'><div id='snd.general-1.1.sentence-1' class='sentence'>Any completion signature
that is in the set of types
denoted by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> and
that is not part of <span class='texttt'>Sigs</span> shall correspond to
error or stopped completion operations,
unless otherwise specified<a class='hidden_link' href='#snd.general-1.1.sentence-1'>.</a></div></div></li><li id='snd.general-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.general-1.2'>(1.2)</a></div><div class='texpara'><div id='snd.general-1.2.sentence-1' class='sentence'>If none of the types in <span class='texttt'>Sigs</span> are dependent on the type <span class='texttt'>Env</span>, then
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> and
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
shall denote the same type<a class='hidden_link' href='#snd.general-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div id='snd.expos' class='section'><h3 ><a class='secnum' href='#snd.expos' style='min-width:80pt'>33.9.2</a> Exposition-only entities <a class='abbr_ref' href='exec.snd.expos'>[exec.snd.expos]</a></h3><div class='para' id='snd.expos-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1370'>#</a></div><div class='texpara'><div id='snd.expos-1.sentence-1' class='sentence'>Subclause <a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a> makes use of the following exposition-only entities<a class='hidden_link' href='#snd.expos-1.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1373'>#</a></div><div class='texpara'><div id='snd.expos-2.sentence-1' class='sentence'><a class='index' id='lib:FWD-ENV'></a>For a queryable object <span class='texttt'>env</span>,
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is an expression
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________'><span class='texttt'><i >queryable</i></span></span></a>
such that for a query object <span class='texttt'>q</span> and
a pack of subexpressions <span class='texttt'>as</span>,
the expression <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed
if <span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>;
otherwise, it is expression-equivalent to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-2.sentence-1'>.</a></div> <div id='snd.expos-2.sentence-2' class='sentence'><a class='index' id='lib:FWD-ENV-T'></a>The type <span class='texttt'><span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span></span> is
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-2.sentence-2'>.</a></div></div></div><div class='para' id='snd.expos-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1387'>#</a></div><div class='texpara'><div id='snd.expos-3.sentence-1' class='sentence'>For a query object <span class='texttt'>q</span> and <span class='texttt'>a</span> subexpression <span class='texttt'>v</span>,
<span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>q, v<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________'><span class='texttt'><i >queryable</i></span></span></a>
such that the result of <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> has
a value equal to <span class='texttt'>v</span> (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)<a class='hidden_link' href='#snd.expos-3.sentence-1'>.</a></div> <div id='snd.expos-3.sentence-2' class='sentence'>Unless otherwise stated,
the object to which <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> refers remains valid
while <span class='texttt'>env</span> remains valid<a class='hidden_link' href='#snd.expos-3.sentence-2'>.</a></div></div></div><div class='para' id='snd.expos-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1397'>#</a></div><div class='texpara'><div id='snd.expos-4.sentence-1' class='sentence'>For two queryable objects <span class='texttt'>env1</span> and <span class='texttt'>env2</span>,
a query object <span class='texttt'>q</span>, and
a pack of subexpressions <span class='texttt'>as</span>,
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>env1, env2<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env3</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='snd.expos-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.1'>(4.1)</a></div><span class='texttt'>env1<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='snd.expos-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.2'>(4.2)</a></div>otherwise, <span class='texttt'>env2<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='snd.expos-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.expos-4.3'>(4.3)</a></div>otherwise, <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#snd.expos-4.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='snd.expos-5'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1413'>#</a></div><div class='texpara'><div id='snd.expos-5.sentence-1' class='sentence'>The results of <span class='texttt'><i >FWD-ENV</i></span>, <span class='texttt'><i >MAKE-ENV</i></span>, and <span class='texttt'><i >JOIN-ENV</i></span>
can be context-dependent;
i.e., they can evaluate to expressions
with different types and value categories
in different contexts for the same arguments<a class='hidden_link' href='#snd.expos-5.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-6'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1420'>#</a></div><div class='texpara'><div id='snd.expos-6.sentence-1' class='sentence'>For a scheduler <span class='texttt'>sch</span>,
<span class='texttt'><span class='texttt'><i >SCHED-ATTRS</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o1</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span> is
an expression with the same type and value as <span class='texttt'>sch</span>
where <span class='texttt'>Tag</span> is one of <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span>, and
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-6.sentence-1'>.</a></div> <div id='snd.expos-6.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o2</span>
whose type satisfies <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is a prvalue
with the same type and value as <span class='texttt'>sch</span>, and
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-6.sentence-2'>.</a></div></div></div><div class='para' id='snd.expos-7'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1436'>#</a></div><div class='texpara'><div id='snd.expos-7.sentence-1' class='sentence'>For two subexpressions <span class='texttt'>rcvr</span> and <span class='texttt'>expr</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='parenthesis'>(</span>expr, set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if the type of <span class='texttt'>expr</span> is <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-7.sentence-1'>.</a></div> <div id='snd.expos-7.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-EVAL</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  expr;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if <span class='texttt'>expr</span> is potentially-throwing; otherwise, <span class='texttt'>expr</span><a class='hidden_link' href='#snd.expos-7.sentence-2'>.</a></div> <div id='snd.expos-7.sentence-3' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is
<span class='codeblock'><i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >SET-VALUE</i><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>rcvr</span> is evaluated only once<a class='hidden_link' href='#snd.expos-7.sentence-3'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Default <span class='operator'>=</span> default_domain, <span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-8'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1463'>#</a></div><div class='texpara'><div id='snd.expos-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> is the type of the expression
<span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-8.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-9'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1467'>#</a></div><div class='texpara'><div id='snd.expos-9.sentence-1' class='sentence'><i >Effects</i>: If all of the types
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>)</span></span>,
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>)</span></span>, and<br/><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>)</span></span> are ill-formed,
<span class='texttt'>completion<span class='operator'>-</span>domain<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of type <span class='texttt'>Default</span><a class='hidden_link' href='#snd.expos-9.sentence-1'>.</a></div> <div id='snd.expos-9.sentence-2' class='sentence'>Otherwise, if they all share a common type (<a href='meta.trans.other' title='21.3.9.7&emsp;Other transformations'>[meta.<span class='shy'></span>trans.<span class='shy'></span>other]</a>)
(ignoring those types that are ill-formed),
then <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of that type<a class='hidden_link' href='#snd.expos-9.sentence-2'>.</a></div> <div id='snd.expos-9.sentence-3' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#snd.expos-9.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Env, <span class='keyword'>class</span> Default<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >query-with-default</i></span><span class='parenthesis'>(</span>
    Tag, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env, Default<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='snd.expos-10'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1489'>#</a></div><div class='texpara'><div id='snd.expos-10.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression <span class='texttt'>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span>
if that expression is well-formed;
otherwise, it is <span class='texttt'><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-10.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-11'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1494'>#</a></div><div class='texpara'><div id='snd.expos-11.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#snd.expos-11.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-12'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1498'>#</a></div><div class='texpara'><div id='snd.expos-12.sentence-1' class='sentence'><i >Remarks</i>: The expression in the noexcept clause is <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-12.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-13'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1509'>#</a></div><div class='texpara'><div id='snd.expos-13.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is
the decayed type of the first of the following expressions that is well-formed:
<ul class='itemize'><li id='snd.expos-13.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.1'>(13.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-13.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.2'>(13.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='snd.expos-13.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-13.3'>(13.3)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-late</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-14'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1530'>#</a></div><div class='texpara'><div id='snd.expos-14.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<ul class='itemize'><li id='snd.expos-14.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-14.1'>(14.1)</a></div>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>, then
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the type of the following expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
<div id='snd.expos-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-1'>1</a></i>:&ensp;<div id='snd.expos-14.1.sentence-1' class='sentence'>The <span class='texttt'>continues_<span class='shy'></span>on</span> algorithm works
in tandem with <span class='texttt'>schedule_<span class='shy'></span>from</span> (<a href='#schedule.from' title='33.9.12.7&emsp;execution&#x200b;::&#x200b;schedule_&shy;from'>[exec.<span class='shy'></span>schedule.<span class='shy'></span>from]</a>)
to give scheduler authors a way to customize both
how to transition onto (<span class='texttt'>continues_<span class='shy'></span>on</span>) and off of (<span class='texttt'>schedule_<span class='shy'></span>from</span>)
a given execution context<a class='hidden_link' href='#snd.expos-14.1.sentence-1'>.</a></div> <div id='snd.expos-14.1.sentence-2' class='sentence'>Thus, <span class='texttt'>continues_<span class='shy'></span>on</span> ignores the domain of the predecessor and
uses the domain of the destination scheduler to select a customization,
a property that is unique to <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#snd.expos-14.1.sentence-2'>.</a></div> <div id='snd.expos-14.1.sentence-3' class='sentence'>That is why it is given special treatment here<a class='hidden_link' href='#snd.expos-14.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></li><li id='snd.expos-14.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-14.2'>(14.2)</a></div>Otherwise,
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the first of the following expressions
that is well-formed and whose type is not <span class='texttt'><span class='keyword'>void</span></span>:
<ul class='itemize'><li id='snd.expos-14.2.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.1'>(14.2.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.2'>(14.2.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.3'>(14.2.3)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.4'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.4'>(14.2.4)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-14.2.5'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#snd.expos-14.2.5'>(14.2.5)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></li></ul></div></div></div></div><div class='para' id='snd.expos-15'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1574'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_'><span class='tcode_in_codeblock'><i >callable</i></span></span></a> Fun<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >emplace-from</i> <span class='curlybracket'>{</span>
  Fun <i >fun</i>;                                                      <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> type <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> type<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>

  <span class='keyword'>constexpr</span> type <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable_'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
<div id='snd.expos-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-2'>2</a></i>:&ensp;<div id='snd.expos-15.sentence-1' class='sentence'><span class='texttt'><i >emplace-from</i></span> is used to emplace non-movable types
into <span class='texttt'>tuple</span>, <span class='texttt'>optional</span>, <span class='texttt'>variant</span>, and similar types<a class='hidden_link' href='#snd.expos-15.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='snd.expos-16'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1596'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>struct</span> <i >on-stop-request</i> <span class='curlybracket'>{</span>
  inplace_stop_source<span class='operator'>&amp;</span> <i >stop-src</i>;       <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >stop-src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='snd.expos-17'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1604'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >product-type</i> <span class='curlybracket'>{</span>       <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
    &#8942;
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >get</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span>     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div><div class='para nonNormativeOnly' id='snd.expos-18'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1622'>#</a></div><div class='texpara'><div id='snd.expos-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-3'>3</a></i>:&ensp;<div id='snd.expos-18.sentence-1' class='sentence'><span class='texttt'><i >product-type</i></span> is presented here in pseudo-code form
for the sake of exposition<a class='hidden_link' href='#snd.expos-18.sentence-1'>.</a></div> <div id='snd.expos-18.sentence-2' class='sentence'>It can be approximated in standard C++ with a tuple-like implementation
that takes care to keep the type an aggregate
that can be used as the initializer of a structured binding declaration<a class='hidden_link' href='#snd.expos-18.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div> <div id='snd.expos-note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-4'>4</a></i>:&ensp;<div id='snd.expos-18.sentence-3' class='sentence'>An expression of type <span class='texttt'><i >product-type</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.7&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#snd.expos-18.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >get</i></span><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='snd.expos-19'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1641'>#</a></div><div class='texpara'><div id='snd.expos-19.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='squarebracket'>[</span>I<span class='squarebracket'>]</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</span></div><div class='para' id='snd.expos-20'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1656'>#</a></div><div class='texpara'><div id='snd.expos-20.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement below is well-formed<a class='hidden_link' href='#snd.expos-20.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-21'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1660'>#</a></div><div class='texpara'><div id='snd.expos-21.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='snd.expos-22'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1668'>#</a></div><div class='texpara'><div id='snd.expos-22.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement above is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#snd.expos-22.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-23'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-23'>23</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1675'>#</a></div><div class='texpara'><div id='snd.expos-23.sentence-1' class='sentence'>Let <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization'><span class='texttt'><i >valid-specialization</i></span></span></a> be the following concept:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:valid-specialization'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a> <span class='operator'>=</span>                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> T<span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>; <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>Tag tag, Data<span class='operator'>&amp;</span><span class='operator'>&amp;</span> data, Child<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='snd.expos-24'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1691'>#</a></div><div class='texpara'><div id='snd.expos-24.sentence-1' class='sentence'><i >Mandates</i>: The following expressions are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='snd.expos-24.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-24.1'>(24.1)</a></div><span class='texttt'><a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular'><span class='texttt'>semiregular</span></span></a><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span></span></li><li id='snd.expos-24.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-24.2'>(24.2)</a></div><span class='texttt'><a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span></span></li><li id='snd.expos-24.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-24.3'>(24.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span></li><li id='snd.expos-24.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-24.4'>(24.4)</a></div><span class='texttt'><a href='#concept:dependent_sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:dependent_sender_'><span class='texttt'>dependent_<span class='shy'></span>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>,
where <span class='texttt'>Sndr</span> is <span class='texttt'><span class='texttt'><i >basic-sender</i></span><span class='anglebracket'>&lt;</span>Tag, Data,<br/>Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
as defined below<a class='hidden_link' href='#snd.expos-24.sentence-1'>.</a> <div class='texpara'><div id='snd.expos-24.4.sentence-2' class='sentence'><i >Recommended practice</i>: If evaluation of <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> results in
an uncaught exception from
the evaluation of <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,
the implementation should include information about that exception in
the resulting diagnostic<a class='hidden_link' href='#snd.expos-24.4.sentence-2'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='snd.expos-25'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1711'>#</a></div><div class='texpara'><div id='snd.expos-25.sentence-1' class='sentence'><i >Returns</i>: A prvalue of
type <span class='texttt'><span class='texttt'><i >basic-sender</i></span><span class='anglebracket'>&lt;</span>Tag, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span>, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
that has been direct-list-initialized with the forwarded arguments,
where <span class='texttt'><i >basic-sender</i></span> is the following exposition-only class template except as noted below<a class='hidden_link' href='#snd.expos-25.sentence-1'>.</a></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:completion-tag' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:completion-tag'><span class='tcode_in_codeblock'><i >completion-tag</i></span></span></a> <span class='operator'>=</span>                                      <span class='comment'>// <i >exposition only</i></span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_error_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_stopped_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>struct</span> <i >default-impls</i> <span class='curlybracket'>{</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                  <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                 <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                      <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                          <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                              <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >state-type</i> <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                 <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >env-type</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>)</span>, Index,
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >data-type</i> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='keyword'>template</span> <i >get</i><span class='anglebracket'>&lt;</span><span class='literal'>1</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, size_t I <span class='operator'>=</span> <span class='literal'>0</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >child-type</i> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='keyword'>template</span> <i >get</i><span class='anglebracket'>&lt;</span>I<span class='operator'>+</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> remove_reference_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >indices-for</i>;                    <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-state</i> <span class='curlybracket'>{</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <i >basic-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
      , <i >state</i><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>

    Rcvr <i >rcvr</i>;                                                  <span class='comment'>// <i >exposition only</i></span>
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Index<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization_'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >env-type</i>, Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-t</i> <span class='operator'>=</span> <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>;                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> <i >complete</i> <span class='operator'>=</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >tag-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >complete</i>;         <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable__'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_value_t, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable___'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_error_t, Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_error_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable____'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_stopped_t<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >env-type</i><span class='anglebracket'>&lt;</span>Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >op</i>;                                <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >connect-all</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                       <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >connect-all-result</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>)</span>, <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span>, Sndr, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization__'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >state-type</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
             <a href='#concept:valid-specialization' title='33.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization___'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >connect-all-result</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-operation</i> <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>            <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>

    <i >connect-all-result</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >inner-ops</i>;                   <span class='comment'>// <i >exposition only</i></span>

    <i >basic-operation</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>               <span class='comment'>// <i >exposition only</i></span>
      <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >inner-ops</i><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
    <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ops<span class='squarebracket'>]</span> <span class='operator'>=</span> <i >inner-ops</i>;
      <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >start</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, <span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, ops<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-sender</i> <span class='operator'>:</span> <i >product-type</i><span class='anglebracket'>&lt;</span>Tag, Data, Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
    <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> index_sequence_for<span class='anglebracket'>&lt;</span>Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;           <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='operator'>*</span><span class='keyword'>this</span>;
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-attrs</i><span class='parenthesis'>(</span>data, child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to_'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver____'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>auto</span> connect<span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Rcvr rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>self<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:decays-to' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to__'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='snd.expos-26'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-26'>26</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1848'>#</a></div><div class='texpara'><div id='snd.expos-26.sentence-1' class='sentence'>The default template argument for the <span class='texttt'>Data</span> template parameter
denotes an unspecified empty trivially copyable class type
that models <a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular_'><span class='texttt'>semiregular</span></span></a><a class='hidden_link' href='#snd.expos-26.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-27'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-27'>27</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1853'>#</a></div><div class='texpara'><div id='snd.expos-27.sentence-1' class='sentence'>It is unspecified whether a specialization of <span class='texttt'><i >basic-sender</i></span>
is an aggregate<a class='hidden_link' href='#snd.expos-27.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-28'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-28'>28</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1857'>#</a></div><div class='texpara'><div id='snd.expos-28.sentence-1' class='sentence'>An expression of type <span class='texttt'><i >basic-sender</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.7&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#snd.expos-28.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-29'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-29'>29</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1861'>#</a></div><div class='texpara'><div id='snd.expos-29.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-state</i></span> is
<span class='codeblock'>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable__'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>, <i >get-state-result</i><span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span>
 is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>, <i >get-state-result</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
</span>
where <span class='texttt'><i >get-state-result</i></span> is
<span class='codeblock'><i >call-result-t</i><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span>
</span></div></div></div><div class='para' id='snd.expos-30'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-30'>30</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1875'>#</a></div><div class='texpara'><div id='snd.expos-30.sentence-1' class='sentence'>The object <span class='texttt'><i >connect-all</i></span> is initialized with
a callable object equivalent to the following lambda:</div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, size_t<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Is<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  <span class='texttt'><i >basic-state</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> op, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, index_sequence<span class='anglebracket'>&lt;</span>Is<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
    <span class='keyword'>return</span> <span class='texttt'><i >product-type</i></span><span class='curlybracket'>{</span>connect<span class='parenthesis'>(</span>
      std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
      <span class='texttt'><i >basic-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr, integral_constant<span class='anglebracket'>&lt;</span>size_t, Is<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>op<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
</code></div></div><div class='para' id='snd.expos-31'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-31'>31</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1890'>#</a></div><div class='texpara'><div id='snd.expos-31.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement is well-formed<a class='hidden_link' href='#snd.expos-31.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-32'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-32'>32</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1894'>#</a></div><div class='texpara'><div id='snd.expos-32.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#snd.expos-32.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-33'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-33'>33</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1901'>#</a></div><div class='texpara'><div id='snd.expos-33.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-operation</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-state</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='snd.expos-34'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-34'>34</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1909'>#</a></div><div class='texpara'><div id='snd.expos-34.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the <span class='texttt'>connect</span> member function of <span class='texttt'><i >basic-sender</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='snd.expos-35'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-35'>35</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1916'>#</a></div><div class='texpara'><div id='snd.expos-35.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span> <span class='parenthesis'>(</span><i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='keyword'>else</span>
    <span class='keyword'>return</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-36'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-36'>36</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1928'>#</a></div><div class='texpara'><div id='snd.expos-36.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-37'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-37'>37</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1937'>#</a></div><div class='texpara'><div id='snd.expos-37.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> <i >allocator-aware-forward</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-38'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-38'>38</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1947'>#</a></div><div class='texpara'><div id='snd.expos-38.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='parenthesis'>(</span>execution<span class='operator'>::</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.expos-39'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-39'>39</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1956'>#</a></div><div class='texpara'><div id='snd.expos-39.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  Index, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_____'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>Tag, Rcvr, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>static_assert</span><span class='parenthesis'>(</span>Index<span class='operator'>::</span>value <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span><span class='parenthesis'>)</span>;
  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div id='lib:default-impls,check-types'><div id='lib:check-types,default-impls'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,default-impls'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >default-impls</i></span><span class='operator'>::</span><span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='snd.expos-40'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-40'>40</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1975'>#</a></div><div class='texpara'><div id='snd.expos-40.sentence-1' class='sentence'>Let <span class='texttt'>Is</span> be the pack of integral template arguments of
the <span class='texttt'>integer_<span class='shy'></span>sequence</span> specialization denoted by
<span class='texttt'><span class='texttt'><i >ndices-for</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.expos-40.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-41'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-41'>41</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1980'>#</a></div><div class='texpara'><div id='snd.expos-41.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='parenthesis'>(</span>get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr, Is<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para nonNormativeOnly' id='snd.expos-42'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-42'>42</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L1987'>#</a></div><div class='texpara'><div id='snd.expos-note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#snd.expos-note-5'>5</a></i>:&ensp;<div id='snd.expos-42.sentence-1' class='sentence'>For any types <span class='texttt'>T</span> and <span class='texttt'>S</span>, and pack <span class='texttt'>E</span>,
let <span class='texttt'>e</span> be the expression
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >check-types</i></span><span class='anglebracket'>&lt;</span>S, E<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-42.sentence-1'>.</a></div> <div id='snd.expos-42.sentence-2' class='sentence'>Then exactly one of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='snd.expos-42.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-42.1'>(42.1)</a></div><span class='texttt'>e</span> is ill-formed, or</li><li id='snd.expos-42.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-42.2'>(42.2)</a></div>the evaluation of <span class='texttt'>e</span> exits with an exception, or</li><li id='snd.expos-42.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-42.3'>(42.3)</a></div><span class='texttt'>e</span> is a core constant expression<a class='hidden_link' href='#snd.expos-42.sentence-2'>.</a></li></ul></div> <div id='snd.expos-42.sentence-3' class='sentence'>
When <span class='texttt'>e</span> is a core constant expression,
the pack <span class='texttt'>S, E<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> uniquely determines a set of completion signatures<a class='hidden_link' href='#snd.expos-42.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='texpara'><div id='lib:basic-sender,get_completion_signatures'><div id='lib:get_completion_signatures,basic-sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_completion_signatures,basic-sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >basic-sender</i></span><span class='anglebracket'>&lt;</span>Tag, Data, Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>get_completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='snd.expos-43'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-43'>43</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2011'>#</a></div><div class='texpara'><div id='snd.expos-43.sentence-1' class='sentence'>Let <span class='texttt'>Rcvr</span> be the type of a receiver whose
environment has type <span class='texttt'>E</span>, where
<span class='texttt'>E</span> is the first type in the list <span class='texttt'>Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.expos-43.sentence-1'>.</a></div> <div id='snd.expos-43.sentence-2' class='sentence'>Let <span class='texttt'><i >CHECK-TYPES</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> be the expression
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>template</span> <span class='texttt'><i >check-types</i></span><span class='anglebracket'>&lt;</span><br/>Sndr, E<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>CS</span> be a type determined as follows:</div></div><div class='texpara'><ul class='itemize'><li id='snd.expos-43.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-43.1'>(43.1)</a></div><div class='texpara'><div id='snd.expos-43.1.sentence-1' class='sentence'>If <span class='texttt'><span class='texttt'><i >CHECK-TYPES</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is a core constant expression,
let <span class='texttt'>op</span> be an lvalue subexpression
whose type is <span class='texttt'>connect_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.expos-43.1.sentence-1'>.</a></div> <div id='snd.expos-43.1.sentence-2' class='sentence'>Then <span class='texttt'>CS</span> is the specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span>
the set of whose template arguments
correspond to the set of completion operations
that are potentially evaluated (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)
as a result of evaluating <span class='texttt'>op<span class='operator'>.</span>start<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-43.1.sentence-2'>.</a></div></div></li><li id='snd.expos-43.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-43.2'>(43.2)</a></div><div class='texpara'><div id='snd.expos-43.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>CS</span> is <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.expos-43.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='snd.expos-44'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-44'>44</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2034'>#</a></div><div class='texpara'><div id='snd.expos-44.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><span class='texttt'><i >CHECK-TYPES</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is a well-formed expression<a class='hidden_link' href='#snd.expos-44.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-45'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-45'>45</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2038'>#</a></div><div class='texpara'><div id='snd.expos-45.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >CHECK-TYPES</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> CS<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='snd.expos-46'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-46'>46</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2047'>#</a></div><div class='texpara'><a class='index' id='lib:overload-set'></a>
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Fns<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >overload-set</i> <span class='operator'>:</span> Fns<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> Fns<span class='operator'>::</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>;
<span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='snd.expos-47'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-47'>47</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2057'>#</a></div><div class='texpara'><div id='snd.expos-47.sentence-1' class='sentence'><a class='index' id='lib:not-a-sender'></a>
<a class='index' id='lib:get_completion_signatures,not-a-sender'></a><a class='index' id='lib:not-a-sender,get_completion_signatures'></a>
<span class='codeblock'><span class='keyword'>struct</span> <i >not-a-sender</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> completion_signatures<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#snd.expos-47.sentence-1'>.</a></div></div></div><div class='para' id='snd.expos-48'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-48'>48</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2074'>#</a></div><div class='texpara'><div id='snd.expos-48.sentence-1' class='sentence'><a class='index' id='lib:decay-copyable-result-datums'></a>
<span class='codeblock'><span class='keyword'>constexpr</span> <span class='keyword'>void</span> <i >decay-copyable-result-datums</i><span class='parenthesis'>(</span><span class='keyword'>auto</span> cs<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><span class='parenthesis'>(</span>is_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span>, Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
      <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#snd.expos-48.sentence-1'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:10'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:10'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >write-env</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span>;     <span class='comment'>// <i >exposition only</i></span>
</code></div></div><div class='para' id='snd.expos-49'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-49'>49</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2094'>#</a></div><div class='texpara'><div id='snd.expos-49.sentence-1' class='sentence'><span class='texttt'><i >write-env</i></span> is an exposition-only sender adaptor that,
when connected with a receiver <span class='texttt'>rcvr</span>,
connects the adapted sender with a receiver
whose execution environment is the result of
joining the <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________'><span class='texttt'><i >queryable</i></span></span></a> argument <span class='texttt'>env</span>
to the result of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-49.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-50'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-50'>50</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2102'>#</a></div><div class='texpara'><div id='snd.expos-50.sentence-1' class='sentence'>Let <span class='texttt'><i >write-env-t</i></span> be an exposition-only empty class type<a class='hidden_link' href='#snd.expos-50.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.expos-51'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-51'>51</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2105'>#</a></div><div class='texpara'><div id='snd.expos-51.sentence-1' class='sentence'><i >Returns</i>: <span class='codeblock'><i >make-sender</i><span class='parenthesis'>(</span><i >write-env-t</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.expos-52'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-52'>52</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2111'>#</a></div><div class='texpara'><div id='snd.expos-52.sentence-1' class='sentence'><i >Remarks</i>: The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >write-env-t</i></span> as follows:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >write-env-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>;
</span></div> <div id='snd.expos-52.sentence-2' class='sentence'>
Invocation of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='snd.expos-52.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-52.1'>(52.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________'><span class='texttt'><i >queryable</i></span></span></a> and</li><li id='snd.expos-52.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-52.2'>(52.2)</a></div>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>state<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid,
otherwise, <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-52.sentence-2'>.</a></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='snd.expos-itemdecl:11'><div class='marginalizedparent'><a class='itemDeclLink' href='#snd.expos-itemdecl:11'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Context<span class='anglebracket'>&gt;</span>
  <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >allocator-aware-forward</i></span><span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> obj, Context<span class='operator'>&amp;</span><span class='operator'>&amp;</span> context<span class='parenthesis'>)</span>;       <span class='comment'>// <i >exposition only</i></span>
</code></div></div><div class='para' id='snd.expos-53'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-53'>53</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2145'>#</a></div><div class='texpara'><div id='snd.expos-53.sentence-1' class='sentence'><span class='texttt'><i >allocator-aware-forward</i></span> is an exposition-only function used to
either create a new object of type <span class='texttt'>T</span> from <span class='texttt'>obj</span>
or forward <span class='texttt'>obj</span> depending on whether an allocator is available<a class='hidden_link' href='#snd.expos-53.sentence-1'>.</a></div> <div id='snd.expos-53.sentence-2' class='sentence'>If the environment associated with <span class='texttt'>context</span> provides an allocator
(i.e., the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>context<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is valid,
let <span class='texttt'><i >alloc</i></span> be the result of this expression
and let <span class='texttt'>P</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.expos-53.sentence-2'>.</a></div></div></div></div><div class='para' id='snd.expos-54'><div class='marginalizedparent'><a class='marginalized' href='#snd.expos-54'>54</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2154'>#</a></div><div class='texpara'><div id='snd.expos-54.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='snd.expos-54.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-54.1'>(54.1)</a></div>If <span class='texttt'><i >alloc</i></span> is not defined, returns <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>obj<span class='parenthesis'>)</span></span>,</li><li id='snd.expos-54.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-54.2'>(54.2)</a></div>otherwise if <span class='texttt'>P</span> is a specialization of <span class='texttt'><i >product-type</i></span>,
returns an object of type <span class='texttt'>P</span> whose elements are initialized using
<span class='codeblock'>make_obj_using_allocator<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>, <i >alloc</i><span class='parenthesis'>)</span>
</span>
where <span class='texttt'>e</span> is the corresponding element of <span class='texttt'>obj</span>,</li><li id='snd.expos-54.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#snd.expos-54.3'>(54.3)</a></div>otherwise, returns <span class='texttt'>make_<span class='shy'></span>obj_<span class='shy'></span>using_<span class='shy'></span>allocator<span class='anglebracket'>&lt;</span>P<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>obj<span class='parenthesis'>)</span>, <span class='texttt'><i >alloc</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.expos-54.sentence-1'>.</a></li></ul></div></div></div></div></div><div id='snd.concepts' class='section'><h3 ><a class='secnum' href='#snd.concepts' style='min-width:80pt'>33.9.3</a> Sender concepts <a class='abbr_ref' href='exec.snd.concepts'>[exec.snd.concepts]</a></h3><div class='para' id='snd.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2173'>#</a></div><div class='texpara'><div id='snd.concepts-1.sentence-1' class='sentence'>The <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________'><span class='texttt'>sender</span></span></a> concept defines
the requirements for a sender type (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#snd.concepts-1.sentence-1'>.</a></div> <div id='snd.concepts-1.sentence-2' class='sentence'>The <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a> concept defines
the requirements for a sender type
that can create asynchronous operations given an associated environment type<a class='hidden_link' href='#snd.concepts-1.sentence-2'>.</a></div> <div id='snd.concepts-1.sentence-3' class='sentence'>The <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to__'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a> concept defines
the requirements for a sender type
that can connect with a specific receiver type<a class='hidden_link' href='#snd.concepts-1.sentence-3'>.</a></div> <div id='snd.concepts-1.sentence-4' class='sentence'>The <span class='texttt'>get_<span class='shy'></span>env</span> customization point object is used to access
a sender's associated attributes<a class='hidden_link' href='#snd.concepts-1.sentence-4'>.</a></div> <div id='snd.concepts-1.sentence-5' class='sentence'>The connect customization point object is used to connect (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
a sender and a receiver to produce an operation state<a class='hidden_link' href='#snd.concepts-1.sentence-5'>.</a></div></div><div class='texpara'><span id='lib:is-dependent-sender-helper'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:is-dependent-sender-helper'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>auto</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-constant' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:is-constant'><span class='tcode_in_codeblock'><i >is-constant</i></span></span></a> <span class='operator'>=</span> <span class='literal'>true</span>;                                 <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from____'><span class='tcode_in_codeblock'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> Sndr<span class='operator'>::</span>sender_concept, sender_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:enable-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:is-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span>
      <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;                 <span class='comment'>// <a href='#awaitable' title='33.9.4&emsp;Awaitable helpers'>[exec.<span class='shy'></span>awaitable]</a></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> enable_sender <span class='operator'>=</span> <a href='#concept:enable-sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>consteval</span> <span class='keyword'>bool</span> <i >is-dependent-sender-helper</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>try</span> <span class='curlybracket'>{</span>           <span class='comment'>// <i >exposition only</i></span>
      get_completion_signatures<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='keyword'>return</span> <span class='literal'>false</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span>dependent_sender_error<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='literal'>true</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender'><span id='lib:sender'><span class='tcode_in_codeblock'>sender</span></span></span></a> <span class='operator'>=</span>
      enable_sender<span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible__'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from__'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Sndr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_in'><span id='lib:sender_in'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='parenthesis'>(</span><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:is-constant' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:is-constant'><span class='tcode_in_codeblock'><i >is-constant</i></span></span></a><span class='anglebracket'>&lt;</span>get_completion_signatures<span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:dependent_sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:dependent_sender'><span id='lib:dependent_sender'><span class='tcode_in_codeblock'>dependent_<span class='shy'></span>sender</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> bool_constant<span class='anglebracket'>&lt;</span><i >is-dependent-sender-helper</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>value;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_to'><span id='lib:sender_to'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of__'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>Rcvr, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='snd.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2243'>#</a></div><div class='texpara'><div id='snd.concepts-2.sentence-1' class='sentence'>For a type <span class='texttt'>Sndr</span>, if
<span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span> and
<span class='texttt'><a href='#concept:dependent_sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:dependent_sender__'><span class='texttt'>dependent_<span class='shy'></span>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then <span class='texttt'>Sndr</span> is a non-dependent sender (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#snd.concepts-2.sentence-1'>.</a></div></div></div><div class='para' id='snd.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2249'>#</a></div><div class='texpara'><div id='snd.concepts-3.sentence-1' class='sentence'>Given a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>rcvr</span> be a receiver
with an associated environment whose type is <span class='texttt'>Env</span><a class='hidden_link' href='#snd.concepts-3.sentence-1'>.</a></div> <div id='snd.concepts-3.sentence-2' class='sentence'>A completion operation is a <a class='hidden_link' href='#def:completion,permissible' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='def:completion,permissible'><i >permissible completion</i></span></a>
for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span>
if its completion signature appears in the argument list of the specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span> denoted by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#snd.concepts-3.sentence-2'>.</a></div> <div id='snd.concepts-3.sentence-3' class='sentence'><span class='texttt'>Sndr</span> and <span class='texttt'>Env</span> model <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
if all the completion operations
that are potentially evaluated by connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state
are permissible completions for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span><a class='hidden_link' href='#snd.concepts-3.sentence-3'>.</a></div></div></div><div class='para' id='snd.concepts-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2264'>#</a></div><div class='texpara'><div id='snd.concepts-4.sentence-1' class='sentence'><i >Remarks</i>: Pursuant to <a href='namespace.std' title='16.4.5.2.1&emsp;Namespace std'>[namespace.<span class='shy'></span>std]</a>,
users may specialize <span class='texttt'>enable_<span class='shy'></span>sender</span> to
<span class='texttt'><span class='literal'>true</span></span> for cv-unqualified program-defined types that
model <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________'><span class='texttt'>sender</span></span></a>, and
<span class='texttt'><span class='literal'>false</span></span> for types that do not<a class='hidden_link' href='#snd.concepts-4.sentence-1'>.</a></div> <div id='snd.concepts-4.sentence-2' class='sentence'>Such specializations shall
be usable in constant expressions (<a href='expr.const' title='7.7&emsp;Constant expressions'>[expr.<span class='shy'></span>const]</a>) and
have type <span class='texttt'><span class='keyword'>const</span> <span class='keyword'>bool</span></span><a class='hidden_link' href='#snd.concepts-4.sentence-2'>.</a></div></div></div><div class='para' id='snd.concepts-5'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2275'>#</a></div><div class='texpara'><div id='snd.concepts-5.sentence-1' class='sentence'>The exposition-only concepts
<a href='#concept:sender-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-of'><span class='texttt'><i >sender-of</i></span></span></a> and <a href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of_'><span class='texttt'><i >sender-in-of</i></span></span></a>
define the requirements for a sender type
that completes with a given unique set of value result types<a class='hidden_link' href='#snd.concepts-5.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >value-signature</i> <span class='operator'>=</span> set_value_t<span class='parenthesis'>(</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> SetValue, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-in-of-impl' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-in-of-impl'><span class='tcode_in_codeblock'><i >sender-in-of-impl</i></span></span></a> <span class='operator'>=</span>                             <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <i >MATCHING-SIG</i><span class='parenthesis'>(</span>SetValue,                                <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
                   <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_value_t,           <span class='comment'>// see <a href='#cmplsig' title='33.10&emsp;Completion signatures'>[exec.<span class='shy'></span>cmplsig]</a></span>
                                     completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>,
                                     <i >value-signature</i>,
                                     type_identity_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-in-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-in-of'><span class='tcode_in_codeblock'><i >sender-in-of</i></span></span></a> <span class='operator'>=</span>                                  <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:sender-in-of-impl' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of-impl'><span class='tcode_in_codeblock'><i >sender-in-of-impl</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, set_value_t<span class='parenthesis'>(</span>Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, Env<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-of' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-of'><span class='tcode_in_codeblock'><i >sender-of</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:sender-in-of-impl' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of-impl_'><span class='tcode_in_codeblock'><i >sender-in-of-impl</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, set_value_t<span class='parenthesis'>(</span>Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='snd.concepts-6'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2304'>#</a></div><div class='texpara'><div id='snd.concepts-6.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Sndr</span><a class='hidden_link' href='#snd.concepts-6.sentence-1'>.</a></div> <div id='snd.concepts-6.sentence-2' class='sentence'>The type <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is as follows:
<ul class='itemize'><li id='snd.concepts-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-6.1'>(6.1)</a></div>If the declaration
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>children<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
</span>
would be well-formed, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is
an alias for <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>tag<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>.</li><li id='snd.concepts-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-6.2'>(6.2)</a></div>Otherwise, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is ill-formed.</li></ul></div></div></div><div class='para' id='snd.concepts-7'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2320'>#</a></div><div class='texpara'><div id='snd.concepts-7.sentence-1' class='sentence'>Let <a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_'><span class='texttt'><i >sender-for</i></span></span></a> be an exposition-only concept defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-for'><span class='tcode_in_codeblock'><i >sender-for</i></span></span></a> <span class='operator'>=</span>
    <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Tag<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='snd.concepts-8'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2331'>#</a></div><div class='texpara'><div id='snd.concepts-8.sentence-1' class='sentence'>For a type <span class='texttt'>T</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE-SIG</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
if <span class='texttt'>T</span> is <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, it denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.concepts-8.sentence-1'>.</a></div></div></div><div class='para' id='snd.concepts-9'><div class='marginalizedparent'><a class='marginalized' href='#snd.concepts-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2337'>#</a></div><div class='texpara'><div id='snd.concepts-9.sentence-1' class='sentence'>Library-provided sender types
<ul class='itemize'><li id='snd.concepts-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-9.1'>(9.1)</a></div>always expose an overload of a member <span class='texttt'>connect</span>
that accepts an rvalue sender and</li><li id='snd.concepts-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#snd.concepts-9.2'>(9.2)</a></div>only expose an overload of a member <span class='texttt'>connect</span>
that accepts an lvalue sender if they model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a><a class='hidden_link' href='#snd.concepts-9.sentence-1'>.</a></li></ul></div></div></div></div><div id='awaitable' class='section'><h3 ><a class='secnum' href='#awaitable' style='min-width:80pt'>33.9.4</a> Awaitable helpers <a class='abbr_ref' href='exec.awaitable'>[exec.awaitable]</a></h3><div class='para' id='awaitable-1'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2350'>#</a></div><div class='texpara'><div id='awaitable-1.sentence-1' class='sentence'>The sender concepts recognize awaitables as senders<a class='hidden_link' href='#awaitable-1.sentence-1'>.</a></div> <div id='awaitable-1.sentence-2' class='sentence'>For [exec], an <a class='hidden_link' href='#def:awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='def:awaitable'><i >awaitable</i></span></a> is an expression
that would be well-formed as the operand of a <span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span></span> expression
within a given context<a class='hidden_link' href='#awaitable-1.sentence-2'>.</a></div></div></div><div class='para' id='awaitable-2'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2356'>#</a></div><div class='texpara'><div id='awaitable-2.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>,
let <span class='texttt'><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span></span> be expression-equivalent to
the series of transformations and conversions applied to <span class='texttt'>c</span>
as the operand of an <a href='expr.await#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression'><span class='textsf'><i >await-expression</i></span></span></a> in a coroutine,
resulting in lvalue <span class='texttt'>e</span> as described by <a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>,
where <span class='texttt'>p</span> is an lvalue referring to the coroutine's promise,
which has type <span class='texttt'>Promise</span><a class='hidden_link' href='#awaitable-2.sentence-1'>.</a></div> <div id='awaitable-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#awaitable-note-1'>1</a></i>:&ensp;<div id='awaitable-2.sentence-2' class='sentence'>This includes the invocation of
the promise type's <span class='texttt'>await_<span class='shy'></span>transform</span> member if any,
the invocation of the <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>co_<span class='shy'></span>await</span></span>
picked by overload resolution if any, and
any necessary implicit conversions and materializations<a class='hidden_link' href='#awaitable-2.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><div id='awaitable-2.sentence-3' class='sentence'>Let <span class='texttt'><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span></span> be
expression-equivalent to <span class='texttt'><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, q<span class='parenthesis'>)</span></span>
where <span class='texttt'>q</span> is an lvalue of
an unspecified empty class type <span class='texttt'><i >none-such</i></span> that
lacks an <span class='texttt'>await_<span class='shy'></span>transform</span> member, and
where <span class='texttt'>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span><i >none-such</i><span class='anglebracket'>&gt;</span></span> behaves as
<span class='texttt'>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#awaitable-2.sentence-3'>.</a></div></div></div><div class='para' id='awaitable-3'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2380'>#</a></div><div class='texpara'><div id='awaitable-3.sentence-1' class='sentence'>Let <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable_'><span class='texttt'><i >is-awaitable</i></span></span></a> be the following exposition-only concept:
<span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> A, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaiter' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a> <span class='operator'>=</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>A<span class='operator'>&amp;</span> a, coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      a<span class='operator'>.</span>await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>1</span> <span class='operator'>:</span> <span class='literal'>0</span>;
      <span class='curlybracket'>{</span> a<span class='operator'>.</span>await_suspend<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result_'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a>;
      a<span class='operator'>.</span>await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> C, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a> <span class='operator'>=</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>C <span class='parenthesis'>(</span><span class='operator'>*</span>fc<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>, Promise<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='curlybracket'>{</span> <i >GET-AWAITER</i><span class='parenthesis'>(</span>fc<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, p<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaiter' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='awaitable-3.sentence-2' class='sentence'><span class='texttt'><a class='hidden_link' href='#concept:await-suspend-result' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:await-suspend-result'><span class='texttt'><i >await-suspend-result</i></span></span></a><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
if and only if one of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='awaitable-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.1'>(3.1)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>void</span></span>, or</li><li id='awaitable-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.2'>(3.2)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>bool</span></span>, or</li><li id='awaitable-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#awaitable-3.3'>(3.3)</a></div><span class='texttt'>T</span> is a specialization of <span class='texttt'>coroutine_<span class='shy'></span>handle</span><a class='hidden_link' href='#awaitable-3.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='awaitable-4'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2411'>#</a></div><div class='texpara'><div id='awaitable-4.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is type <span class='texttt'>C</span>, and
an lvalue <span class='texttt'>p</span> of type <span class='texttt'>Promise</span>,
<span class='texttt'><span class='texttt'><i >await-result-<br>type</i></span><span class='anglebracket'>&lt;</span>C, Promise<span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span><span class='operator'>.</span>await_<span class='shy'></span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'><span class='texttt'><i >await-result-type</i></span><span class='anglebracket'>&lt;</span>C<span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='operator'>.</span>await_<span class='shy'></span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#awaitable-4.sentence-1'>.</a></div></div></div><div class='para' id='awaitable-5'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2420'>#</a></div><div class='texpara'><div id='awaitable-5.sentence-1' class='sentence'>Let <span class='texttt'><i >with-await-transform</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-as-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a> <span class='operator'>=</span>                                  <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> t, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable__'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Derived<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >with-await-transform</i> <span class='curlybracket'>{</span>                               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
        T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:has-as-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Derived<span class='anglebracket'>&gt;</span> T<span class='anglebracket'>&gt;</span>
        <span class='keyword'>auto</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>
          <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
          <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='awaitable-6'><div class='marginalizedparent'><a class='marginalized' href='#awaitable-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2447'>#</a></div><div class='texpara'><div id='awaitable-6.sentence-2' class='sentence'>Let <span class='texttt'><i >env-promise</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >env-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span> <span class='comment'>// <i >exposition only</i></span>
    <i ><span class='texttt'>unspecified</span></i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span>
<div id='awaitable-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#awaitable-note-2'>2</a></i>:&ensp;<div id='awaitable-6.sentence-1' class='sentence'>Specializations of <span class='texttt'><i >env-promise</i></span> are used only for the purpose of type computation;
its members need not be defined<a class='hidden_link' href='#awaitable-6.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='domain.default' class='section'><h3 ><a class='secnum' href='#domain.default' style='min-width:80pt'>33.9.5</a> <span class='texttt'>execution&#x200b;::&#x200b;default_<span class='shy'></span>domain</span> <a class='abbr_ref' href='exec.domain.default'>[exec.domain.default]</a></h3><div class='para' id='domain.default-1'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2471'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <span id='lib:default_domain'><a class='hidden_link' href='#lib:default_domain' title='33.9.5&emsp;execution&#x200b;::&#x200b;default_&shy;domain&emsp;[exec.domain.default]'>default_domain</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
        <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='lib:default_domain,transform_sender'><div id='lib:transform_sender,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_sender,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
<span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='domain.default-2'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2499'>#</a></div><div class='texpara'><div id='domain.default-2.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-2.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-3'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2507'>#</a></div><div class='texpara'><div id='domain.default-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-3.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-4'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2511'>#</a></div><div class='texpara'><div id='domain.default-4.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:default_domain,transform_env'><div id='lib:transform_env,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_env,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='domain.default-5'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2523'>#</a></div><div class='texpara'><div id='domain.default-5.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-5.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-6'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2531'>#</a></div><div class='texpara'><div id='domain.default-6.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#domain.default-6.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-7'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2535'>#</a></div><div class='texpara'><div id='domain.default-7.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:default_domain,apply_sender'><div id='lib:apply_sender,default_domain'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:apply_sender,default_domain'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='domain.default-8'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2548'>#</a></div><div class='texpara'><div id='domain.default-8.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='domain.default-9'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2554'>#</a></div><div class='texpara'><div id='domain.default-9.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'>e</span> is a well-formed expression<a class='hidden_link' href='#domain.default-9.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-10'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2558'>#</a></div><div class='texpara'><div id='domain.default-10.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#domain.default-10.sentence-1'>.</a></div></div></div></div><div class='para' id='domain.default-11'><div class='marginalizedparent'><a class='marginalized' href='#domain.default-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2562'>#</a></div><div class='texpara'><div id='domain.default-11.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#domain.default-11.sentence-1'>.</a></div></div></div></div></div><div id='snd.transform' class='section'><h3 ><a class='secnum' href='#snd.transform' style='min-width:80pt'>33.9.6</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.transform'>[exec.snd.transform]</a></h3><div class='texpara'><div id='lib:transform_sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________________________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>constexpr</span> <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.transform-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2580'>#</a></div><div class='texpara'><div id='snd.transform-1.sentence-1' class='sentence'>Let <span class='texttt'><i >transformed-sndr</i></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div> <div id='snd.transform-1.sentence-2' class='sentence'>
Let <span class='texttt'><i >final-sndr</i></span> be the expression <span class='texttt'><i >transformed-sndr</i></span>
if <span class='texttt'><i >transformed-sndr</i></span> and <span class='texttt'><i >sndr</i></span>
have the same type ignoring cv-qualifiers;
otherwise, it is
the expression <span class='texttt'>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>dom, <span class='texttt'><i >transformed-sndr</i></span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.transform-1.sentence-2'>.</a></div></div></div></div><div class='para' id='snd.transform-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2595'>#</a></div><div class='texpara'><div id='snd.transform-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><i >final-sndr</i></span><a class='hidden_link' href='#snd.transform-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.transform-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2599'>#</a></div><div class='texpara'><div id='snd.transform-3.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to
<span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='texttt'><i >final-sndr</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.transform-3.sentence-1'>.</a></div></div></div></div></div><div id='snd.transform.env' class='section'><h3 ><a class='secnum' href='#snd.transform.env' style='min-width:80pt'>33.9.7</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.snd.transform.env'>[exec.snd.transform.env]</a></h3><div class='texpara'><div id='lib:transform_env'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:transform_env'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________'><span class='texttt'>sender</span></span></a> Sndr, <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________________________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________________________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.transform.env-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2616'>#</a></div><div class='texpara'><div id='snd.transform.env-1.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.transform.env-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2626'>#</a></div><div class='texpara'><div id='snd.transform.env-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#snd.transform.env-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.transform.env-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.transform.env-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2630'>#</a></div><div class='texpara'><div id='snd.transform.env-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#snd.transform.env-3.sentence-1'>.</a></div></div></div></div></div><div id='snd.apply' class='section'><h3 ><a class='secnum' href='#snd.apply' style='min-width:80pt'>33.9.8</a> <span class='texttt'>execution&#x200b;::&#x200b;apply_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.apply'>[exec.snd.apply]</a></h3><div class='texpara'><div id='lib:apply_sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:apply_sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <span class='keyword'>class</span> Tag, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Domain dom, Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div></div><div class='para' id='snd.apply-1'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2647'>#</a></div><div class='texpara'><div id='snd.apply-1.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>e</span></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='snd.apply-2'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2657'>#</a></div><div class='texpara'><div id='snd.apply-2.sentence-1' class='sentence'><i >Constraints</i>: The expression <span class='math'><span class='mathalpha'>e</span></span> is well-formed<a class='hidden_link' href='#snd.apply-2.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.apply-3'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2661'>#</a></div><div class='texpara'><div id='snd.apply-3.sentence-1' class='sentence'><i >Returns</i>: <span class='math'><span class='mathalpha'>e</span></span><a class='hidden_link' href='#snd.apply-3.sentence-1'>.</a></div></div></div></div><div class='para' id='snd.apply-4'><div class='marginalizedparent'><a class='marginalized' href='#snd.apply-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2665'>#</a></div><div class='texpara'><div id='snd.apply-4.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#snd.apply-4.sentence-1'>.</a></div></div></div></div></div><div id='getcomplsigs' class='section'><h3 ><a class='secnum' href='#getcomplsigs' style='min-width:80pt'>33.9.9</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> <a class='abbr_ref' href='exec.getcomplsigs'>[exec.getcomplsigs]</a></h3><div class='texpara'><a class='index' id='lib:get_completion_signatures'></a></div><div class='texpara'><div class='itemdecl' id='getcomplsigs-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#getcomplsigs-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>consteval</span> <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:valid-completion-signatures__'><span class='texttt'><i >valid-completion-signatures</i></span></span></a> <span class='keyword'>auto</span>;
</code></div></div><div class='para' id='getcomplsigs-1'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2680'>#</a></div><div class='texpara'><div id='getcomplsigs-1.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>except</span></span> be an rvalue subexpression of
an unspecified class type <span class='math'><span class='mathalpha'>Except</span></span> such that
<span class='texttt'><a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible___'><span class='texttt'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span><span class='math'><span class='mathalpha'>Except</span></span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_____'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='math'><span class='mathalpha'>Except</span></span>, exception<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#getcomplsigs-1.sentence-1'>.</a></div> <div id='getcomplsigs-1.sentence-2' class='sentence'>Let <span class='texttt'><i >CHECKED-COMPLSIGS</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span></span> be <span class='math'><span class='mathalpha'>e</span></span>
if <span class='math'><span class='mathalpha'>e</span></span> is a core constant expression whose
type satisfies <a href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:valid-completion-signatures___'><span class='texttt'><i >valid-completion-signatures</i></span></span></a>;
otherwise, it is the following expression:
<span class='codeblock'><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span>, <span class='keyword'>throw</span> <span class='math'><span class='mathalpha'>except</span></span>, completion_signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div> <div id='getcomplsigs-1.sentence-3' class='sentence'>
Let <span class='texttt'><i >get-complsigs</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
be expression-equivalent to
<span class='texttt'>remove_<span class='shy'></span>reference_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>template get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#getcomplsigs-1.sentence-3'>.</a></div> <div id='getcomplsigs-1.sentence-4' class='sentence'>Let <span class='texttt'>NewSndr</span> be <span class='texttt'>Sndr</span>
if <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span></span> is <span class='texttt'><span class='literal'>true</span></span>;
otherwise, <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>s</span></span><span class='parenthesis'>)</span></span>
where <span class='math'><span class='mathalpha'>s</span></span> is the following expression:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-late</i><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
  declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>,
  declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='getcomplsigs-2'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2706'>#</a></div><div class='texpara'><div id='getcomplsigs-2.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#getcomplsigs-2.sentence-1'>.</a></div></div></div></div><div class='para' id='getcomplsigs-3'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2710'>#</a></div><div class='texpara'><div id='getcomplsigs-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;</span>
where <span class='math'><span class='mathalpha'>e</span></span> is expression-equivalent to the following:
<ul class='itemize'><li id='getcomplsigs-3.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#getcomplsigs-3.1'>(3.1)</a></div><div class='texpara'><div id='getcomplsigs-3.1.sentence-1' class='sentence'><span class='texttt'><i >CHECKED-COMPLSIGS</i><span class='parenthesis'>(</span><i >get-complsigs</i><span class='anglebracket'>&lt;</span>NewSndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'><i >get-complsigs</i><span class='anglebracket'>&lt;</span>NewSndr, Env<br/><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
is a well-formed expression<a class='hidden_link' href='#getcomplsigs-3.1.sentence-1'>.</a></div></div></li><li id='getcomplsigs-3.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#getcomplsigs-3.2'>(3.2)</a></div><div class='texpara'><div id='getcomplsigs-3.2.sentence-1' class='sentence'>Otherwise,
<span class='texttt'><i >CHECKED-COMPLSIGS</i><span class='parenthesis'>(</span><i >get-complsigs</i><span class='anglebracket'>&lt;</span>NewSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'><i >get-complsigs</i><span class='anglebracket'>&lt;</span>NewSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
is a well-formed expression<a class='hidden_link' href='#getcomplsigs-3.2.sentence-1'>.</a></div></div></li><li id='getcomplsigs-3.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#getcomplsigs-3.3'>(3.3)</a></div><div class='texpara'><div id='getcomplsigs-3.3.sentence-1' class='sentence'>Otherwise,
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span><i >await-result-type</i><span class='anglebracket'>&lt;</span>NewSndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>,   <span class='comment'>// <a href='#snd.concepts' title='33.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a></span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span>
if <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable___'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>NewSndr, <span class='texttt'><i >env-promise</i></span><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#getcomplsigs-3.3.sentence-1'>.</a></div></div></li><li id='getcomplsigs-3.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#getcomplsigs-3.4'>(3.4)</a></div><div class='texpara'><div id='getcomplsigs-3.4.sentence-1' class='sentence'>Otherwise,
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>throw</span> <i >dependent-sender-error</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span><br/>Env<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
where <span class='texttt'><i >dependent-sender-error</i></span> is
<span class='texttt'>dependent_<span class='shy'></span>sender_<span class='shy'></span>error</span> or
an unspecified type derived publicly and unambiguously from
<span class='texttt'>dependent_<span class='shy'></span>sender_<span class='shy'></span>error</span><a class='hidden_link' href='#getcomplsigs-3.4.sentence-1'>.</a></div></div></li><li id='getcomplsigs-3.5'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#getcomplsigs-3.5'>(3.5)</a></div><div class='texpara'><div id='getcomplsigs-3.5.sentence-1' class='sentence'>Otherwise,
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>throw</span> <span class='math'><span class='mathalpha'>except</span></span>, completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#getcomplsigs-3.5.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='getcomplsigs-4'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2751'>#</a></div><div class='texpara'><div id='getcomplsigs-4.sentence-1' class='sentence'>Given a type <span class='texttt'>Env</span>, if
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> and
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
are both well-formed,
they shall denote the same type<a class='hidden_link' href='#getcomplsigs-4.sentence-1'>.</a></div></div></div></div><div class='para' id='getcomplsigs-5'><div class='marginalizedparent'><a class='marginalized' href='#getcomplsigs-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2759'>#</a></div><div class='texpara'><div id='getcomplsigs-5.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be an rvalue
whose type <span class='texttt'>Rcvr</span> models <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_____'><span class='texttt'>receiver</span></span></a>, and
let <span class='texttt'>Sndr</span> be the type of a sender
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#getcomplsigs-5.sentence-1'>.</a></div> <div id='getcomplsigs-5.sentence-2' class='sentence'>Let <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be the template arguments of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#getcomplsigs-5.sentence-2'>.</a></div> <div id='getcomplsigs-5.sentence-3' class='sentence'>Let <span class='texttt'>CSO</span> be a completion function<a class='hidden_link' href='#getcomplsigs-5.sentence-3'>.</a></div> <div id='getcomplsigs-5.sentence-4' class='sentence'>If sender <span class='texttt'>Sndr</span> or its operation state cause
the expression <span class='texttt'>CSO<span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
to be potentially evaluated (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)
then there shall be a signature <span class='texttt'>Sig</span> in <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
such that
<span class='codeblock'><i >MATCHING-SIG</i><span class='parenthesis'>(</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>CSO<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, Sig<span class='parenthesis'>)</span>
</span>
is <span class='texttt'><span class='literal'>true</span></span> (<a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#getcomplsigs-5.sentence-4'>.</a></div></div></div></div><div id='connect' class='section'><h3 ><a class='secnum' href='#connect' style='min-width:80pt'>33.9.10</a> <span class='texttt'>execution&#x200b;::&#x200b;connect</span> <a class='abbr_ref' href='exec.connect'>[exec.connect]</a></h3><div class='para' id='connect-1'><div class='marginalizedparent'><a class='marginalized' href='#connect-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2780'>#</a></div><div class='texpara'><div id='connect-1.sentence-1' class='sentence'><span class='texttt'>connect</span> connects (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) a sender with a receiver<a class='hidden_link' href='#connect-1.sentence-1'>.</a></div></div></div><div class='para' id='connect-2'><div class='marginalizedparent'><a class='marginalized' href='#connect-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2783'>#</a></div><div class='texpara'><div id='connect-2.sentence-1' class='sentence'>The name <span class='texttt'>connect</span> denotes a customization point object<a class='hidden_link' href='#connect-2.sentence-1'>.</a></div> <div id='connect-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>rcvr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Rcvr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
let <span class='texttt'>new_<span class='shy'></span>sndr</span> be the expression
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >get-domain-late</i><span class='parenthesis'>(</span>sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and let <span class='texttt'>DS</span> and <span class='texttt'>DR</span> be
<span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>, respectively<a class='hidden_link' href='#connect-2.sentence-2'>.</a></div></div></div><div class='para' id='connect-3'><div class='marginalizedparent'><a class='marginalized' href='#connect-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2795'>#</a></div><div class='texpara'><div id='connect-3.sentence-1' class='sentence'>Let <span class='texttt'><i >connect-awaitable-promise</i></span> be the following exposition-only class:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >connect-awaitable-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

    <i >connect-awaitable-promise</i><span class='parenthesis'>(</span>DS<span class='operator'>&amp;</span>, DR<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    suspend_always initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> suspend_always final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='keyword'>return</span> noop_coroutine<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >operation-state-task</i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >operation-state-task</i><span class='curlybracket'>{</span>
        coroutine_handle<span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_promise<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    env_of_t<span class='anglebracket'>&lt;</span>DR<span class='anglebracket'>&gt;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    DR<span class='operator'>&amp;</span> <i >rcvr</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='connect-4'><div class='marginalizedparent'><a class='marginalized' href='#connect-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2829'>#</a></div><div class='texpara'><div id='connect-4.sentence-1' class='sentence'>Let <span class='texttt'><i >operation-state-task</i></span> be the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >operation-state-task</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> promise_type <span class='operator'>=</span> <i >connect-awaitable-promise</i>;

    <span class='keyword'>explicit</span> <i >operation-state-task</i><span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> coro<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <i >operation-state-task</i><span class='parenthesis'>(</span><i >operation-state-task</i><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span><i >operation-state-task</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <i >coro</i><span class='operator'>.</span>destroy<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >coro</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <i >coro</i>;                                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='connect-5'><div class='marginalizedparent'><a class='marginalized' href='#connect-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2851'>#</a></div><div class='texpara'><div id='connect-5.sentence-1' class='sentence'>Let <span class='texttt'>V</span> name the type
<span class='texttt'><span class='texttt'><i >await-result-type</i></span><span class='anglebracket'>&lt;</span>DS, <span class='texttt'><i >connect-awaitable-promise</i></span><span class='anglebracket'>&gt;</span></span>,
let <span class='texttt'>Sigs</span> name the type
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span>V<span class='parenthesis'>)</span>,         <span class='comment'>// see <a href='#snd.concepts' title='33.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a></span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span>
and let <span class='texttt'><i >connect-awaitable</i></span> be an exposition-only coroutine
defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fun, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <i >suspend-complete</i><span class='parenthesis'>(</span>Fun fun, Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> as<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, fun<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> fun<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

    <span class='keyword'>struct</span> awaiter <span class='curlybracket'>{</span>
      <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >fn</i><span class='parenthesis'>)</span> <i >fn</i>;                                     <span class='comment'>// <i >exposition only</i></span>

      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
      <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >fn</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> unreachable<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>return</span> awaiter<span class='curlybracket'>{</span><i >fn</i><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>

  <i >operation-state-task</i> <i >connect-awaitable</i><span class='parenthesis'>(</span>DS sndr, DR rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of___'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>DR, Sigs<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    exception_ptr ep;
    <span class='keyword'>try</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>V, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      ep <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
    <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_error, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ep<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='connect-6'><div class='marginalizedparent'><a class='marginalized' href='#connect-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2896'>#</a></div><div class='texpara'><div id='connect-6.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>sndr, rcvr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='connect-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.1'>(6.1)</a></div><div class='texpara'><div id='connect-6.1.sentence-1' class='sentence'><span class='texttt'>new_<span class='shy'></span>sndr<span class='operator'>.</span>connect<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span> if that expression is well-formed<a class='hidden_link' href='#connect-6.1.sentence-1'>.</a></div></div><div class='texpara'><div id='connect-6.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state_____'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a><a class='hidden_link' href='#connect-6.1.sentence-2'>.</a></div></div></li><li id='connect-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.2'>(6.2)</a></div><div class='texpara'><div id='connect-6.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >connect-awaitable</i></span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#connect-6.2.sentence-1'>.</a></div></div></li></ul></div> <div id='connect-6.sentence-2' class='sentence'>
Except that <span class='texttt'>rcvr</span> is evaluated only once<a class='hidden_link' href='#connect-6.sentence-2'>.</a></div></div><div class='texpara'><div id='connect-6.sentence-3' class='sentence'><i >Mandates</i>: The following are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='connect-6.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.3'>(6.3)</a></div><span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span></li><li id='connect-6.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#connect-6.4'>(6.4)</a></div><span class='texttt'><a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of____'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>Rcvr, completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span></li></ul></div></div></div></div><div id='factories' class='section'><h3 ><a class='secnum' href='#factories' style='min-width:80pt'>33.9.11</a> Sender factories <a class='abbr_ref' href='exec.factories'>[exec.factories]</a></h3><div id='schedule' class='section'><h4 ><a class='secnum' href='#schedule' style='min-width:95pt'>33.9.11.1</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule</span> <a class='abbr_ref' href='exec.schedule'>[exec.schedule]</a></h4><div class='para' id='schedule-1'><div class='marginalizedparent'><a class='marginalized' href='#schedule-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2923'>#</a></div><div class='texpara'><div id='schedule-1.sentence-1' class='sentence'><span class='texttt'>schedule</span> obtains a schedule sender (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
from a scheduler<a class='hidden_link' href='#schedule-1.sentence-1'>.</a></div></div></div><div class='para' id='schedule-2'><div class='marginalizedparent'><a class='marginalized' href='#schedule-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2927'>#</a></div><div class='texpara'><div id='schedule-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule</span> denotes a customization point object<a class='hidden_link' href='#schedule-2.sentence-1'>.</a></div> <div id='schedule-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sch</span>,
the expression <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule-2.sentence-2'>.</a></div></div></div><div class='para' id='schedule-3'><div class='marginalizedparent'><a class='marginalized' href='#schedule-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2933'>#</a></div><div class='texpara'><div id='schedule-3.sentence-1' class='sentence'><i >Mandates</i>: The type of <span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#schedule-3.sentence-1'>.</a></div></div></div><div class='para' id='schedule-4'><div class='marginalizedparent'><a class='marginalized' href='#schedule-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2937'>#</a></div><div class='texpara'><div id='schedule-4.sentence-1' class='sentence'>If the expression
<span class='codeblock'>get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> sch
</span>
is ill-formed or evaluates to <span class='texttt'><span class='literal'>false</span></span>,
the behavior of calling <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is undefined<a class='hidden_link' href='#schedule-4.sentence-1'>.</a></div></div></div></div><div id='just' class='section'><h4 ><a class='secnum' href='#just' style='min-width:95pt'>33.9.11.2</a> <span class='texttt'>execution&#x200b;::&#x200b;just</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.just'>[exec.just]</a></h4><div class='para' id='just-1'><div class='marginalizedparent'><a class='marginalized' href='#just-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2947'>#</a></div><div class='texpara'><div id='just-1.sentence-1' class='sentence'><span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> are sender factories
whose asynchronous operations complete synchronously in their start operation
with a value completion operation,
an error completion operation, or
a stopped completion operation, respectively<a class='hidden_link' href='#just-1.sentence-1'>.</a></div></div></div><div class='para' id='just-2'><div class='marginalizedparent'><a class='marginalized' href='#just-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2954'>#</a></div><div class='texpara'><div id='just-2.sentence-1' class='sentence'>The names <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> denote
customization point objects<a class='hidden_link' href='#just-2.sentence-1'>.</a></div> <div id='just-2.sentence-2' class='sentence'>Let <span class='texttt'><i >just-cpo</i></span> be one of
<span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, or <span class='texttt'>just_<span class='shy'></span>stopped</span><a class='hidden_link' href='#just-2.sentence-2'>.</a></div> <div id='just-2.sentence-3' class='sentence'>For a pack of subexpressions <span class='texttt'>ts</span>,
let <span class='texttt'>Ts</span> be the pack of types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#just-2.sentence-3'>.</a></div> <div id='just-2.sentence-4' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >just-cpo</i></span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed if
<ul class='itemize'><li id='just-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.1'>(2.1)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value__'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='just-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.2'>(2.2)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>error</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='just-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#just-2.3'>(2.3)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>stopped</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#just-2.sentence-4'>.</a></li></ul></div></div><div class='texpara'><div id='just-2.sentence-5' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span><span class='texttt'><i >just-cpo</i></span>, <span class='texttt'><i >product-type</i></span><span class='curlybracket'>{</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#just-2.sentence-5'>.</a></div></div><div class='texpara'><div id='just-2.sentence-6' class='sentence'>For <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#just-2.sentence-6'>.</a></div> <div id='just-2.sentence-7' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >just-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >just-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
        <i >set-cpo</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='read.env' class='section'><h4 ><a class='secnum' href='#read.env' style='min-width:95pt'>33.9.11.3</a> <span class='texttt'>execution&#x200b;::&#x200b;read_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.read.env'>[exec.read.env]</a></h4><div class='para' id='read.env-1'><div class='marginalizedparent'><a class='marginalized' href='#read.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L2996'>#</a></div><div class='texpara'><div id='read.env-1.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a sender factory for a sender
whose asynchronous operation completes synchronously in its start operation
with a value completion result equal to
a value read from the receiver's associated environment<a class='hidden_link' href='#read.env-1.sentence-1'>.</a></div></div></div><div class='para' id='read.env-2'><div class='marginalizedparent'><a class='marginalized' href='#read.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3002'>#</a></div><div class='texpara'><div id='read.env-2.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#read.env-2.sentence-1'>.</a></div> <div id='read.env-2.sentence-2' class='sentence'>For some query object <span class='texttt'>q</span>,
the expression <span class='texttt'>read_<span class='shy'></span>env<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>read_<span class='shy'></span>env, q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#read.env-2.sentence-2'>.</a></div></div></div><div class='para' id='read.env-3'><div class='marginalizedparent'><a class='marginalized' href='#read.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3008'>#</a></div><div class='texpara'><div id='read.env-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>read_<span class='shy'></span>env</span> as follows:
<span id='lib:impls-for<decayed-typeof<read_env>>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cdecayed-typeof%3cread_env%3e%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>read_env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> start <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> query, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, query<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='texpara'><div id='lib:impls-for<decayed-typeof<read_env>>,check-types'><div id='lib:check-types,impls-for<decayed-typeof<read_env>>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cdecayed-typeof%3cread_env%3e%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='read.env-4'><div class='marginalizedparent'><a class='marginalized' href='#read.env-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3034'>#</a></div><div class='texpara'><div id='read.env-4.sentence-1' class='sentence'>Let <span class='texttt'>Q</span> be <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >data-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#read.env-4.sentence-1'>.</a></div></div></div></div><div class='para' id='read.env-5'><div class='marginalizedparent'><a class='marginalized' href='#read.env-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3037'>#</a></div><div class='texpara'><div id='read.env-5.sentence-1' class='sentence'><i >Throws</i>: An exception of an unspecified type derived from <span class='texttt'>exception</span> if
the expression <span class='texttt'>Q<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is ill-formed or has type <span class='texttt'><span class='keyword'>void</span></span>, where
<span class='texttt'>env</span> is an lvalue subexpression whose type is <span class='texttt'>Env</span><a class='hidden_link' href='#read.env-5.sentence-1'>.</a></div></div></div></div></div></div><div id='adapt' class='section'><h3 ><a class='secnum' href='#adapt' style='min-width:80pt'>33.9.12</a> Sender adaptors <a class='abbr_ref' href='exec.adapt'>[exec.adapt]</a></h3><div id='adapt.general' class='section'><h4 ><a class='secnum' href='#adapt.general' style='min-width:95pt'>33.9.12.1</a> General <a class='abbr_ref' href='exec.adapt.general'>[exec.adapt.general]</a></h4><div class='para' id='adapt.general-1'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3048'>#</a></div><div class='texpara'><div id='adapt.general-1.sentence-1' class='sentence'>Subclause <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> specifies a set of sender adaptors<a class='hidden_link' href='#adapt.general-1.sentence-1'>.</a></div></div></div><div class='para' id='adapt.general-2'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3051'>#</a></div><div class='texpara'><div id='adapt.general-2.sentence-1' class='sentence'>The bitwise inclusive <span class='textsc'>or</span> operator is overloaded
for the purpose of creating sender chains<a class='hidden_link' href='#adapt.general-2.sentence-1'>.</a></div> <div id='adapt.general-2.sentence-2' class='sentence'>The adaptors also support function call syntax with equivalent semantics<a class='hidden_link' href='#adapt.general-2.sentence-2'>.</a></div></div></div><div class='para' id='adapt.general-3'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3056'>#</a></div><div class='texpara'><div id='adapt.general-3.sentence-1' class='sentence'>Unless otherwise specified:
<ul class='itemize'><li id='adapt.general-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.1'>(3.1)</a></div><div class='texpara'><div id='adapt.general-3.1.sentence-1' class='sentence'>A sender adaptor is prohibited from causing observable effects,
apart from moving and copying its arguments,
before the returned sender is connected with a receiver using <span class='texttt'>connect</span>,
and <span class='texttt'>start</span> is called on the resulting operation state<a class='hidden_link' href='#adapt.general-3.1.sentence-1'>.</a></div></div></li><li id='adapt.general-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.2'>(3.2)</a></div><div class='texpara'><div id='adapt.general-3.2.sentence-1' class='sentence'>A parent sender (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) with a single child sender <span class='texttt'>sndr</span> has
an associated attribute object equal to
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> (<a href='#fwd.env' title='33.5.1&emsp;forwarding_&shy;query'>[exec.<span class='shy'></span>fwd.<span class='shy'></span>env]</a>)<a class='hidden_link' href='#adapt.general-3.2.sentence-1'>.</a></div></div></li><li id='adapt.general-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.3'>(3.3)</a></div><div class='texpara'><div id='adapt.general-3.3.sentence-1' class='sentence'>A parent sender with more than one child sender has
an associated attributes object equal to <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#adapt.general-3.3.sentence-1'>.</a></div></div></li><li id='adapt.general-3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.4'>(3.4)</a></div><div class='texpara'><div id='adapt.general-3.4.sentence-1' class='sentence'>When a parent sender is connected to a receiver <span class='texttt'>rcvr</span>,
any receiver used to connect a child sender has
an associated environment equal to <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#adapt.general-3.4.sentence-1'>.</a></div></div></li><li id='adapt.general-3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.5'>(3.5)</a></div><div class='texpara'><div id='adapt.general-3.5.sentence-1' class='sentence'>An adaptor whose child senders are all non-dependent (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
is itself non-dependent<a class='hidden_link' href='#adapt.general-3.5.sentence-1'>.</a></div></div></li><li id='adapt.general-3.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.6'>(3.6)</a></div><div class='texpara'><div id='adapt.general-3.6.sentence-1' class='sentence'>These requirements apply to any function
that is selected by the implementation of the sender adaptor<a class='hidden_link' href='#adapt.general-3.6.sentence-1'>.</a></div></div></li><li id='adapt.general-3.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.general-3.7'>(3.7)</a></div><div class='texpara'><div id='adapt.general-3.7.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use
the completion signatures of the adaptors
to communicate type errors to users and
to propagate any such type errors from child senders<a class='hidden_link' href='#adapt.general-3.7.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='adapt.general-4'><div class='marginalizedparent'><a class='marginalized' href='#adapt.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3089'>#</a></div><div class='texpara'><div id='adapt.general-4.sentence-1' class='sentence'>If a sender returned from a sender adaptor specified in <a href='#adapt' title='33.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a>
is specified to include <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>
among its set of completion signatures
where <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span>,
but the implementation does not potentially evaluate
an error completion operation with an <span class='texttt'>exception_<span class='shy'></span>ptr</span> argument,
the implementation is allowed to omit
the <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion signature from the set<a class='hidden_link' href='#adapt.general-4.sentence-1'>.</a></div></div></div></div><div id='adapt.obj' class='section'><h4 ><a class='secnum' href='#adapt.obj' style='min-width:95pt'>33.9.12.2</a> Closure objects <a class='abbr_ref' href='exec.adapt.obj'>[exec.adapt.obj]</a></h4><div class='para' id='adapt.obj-1'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3101'>#</a></div><div class='texpara'><div id='adapt.obj-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_closure_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_closure_object,pipeable'><i >pipeable sender adaptor closure object</i></span></a> is a function object
that accepts one or more <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________'><span class='texttt'>sender</span></span></a> arguments and returns a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-1.sentence-1'>.</a></div> <div id='adapt.obj-1.sentence-2' class='sentence'>For a pipeable sender adaptor closure object <span class='texttt'>c</span> and
an expression <span class='texttt'>sndr</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________'><span class='texttt'>sender</span></span></a>,
the following expressions are equivalent and yield a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________'><span class='texttt'>sender</span></span></a>:
<span class='codeblock'>c<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>
sndr <span class='operator'>|</span> c
</span></div> <div id='adapt.obj-1.sentence-3' class='sentence'>
Given an additional pipeable sender adaptor closure object <span class='texttt'>d</span>,
the expression <span class='texttt'>c <span class='operator'>|</span> d</span> produces
another pipeable sender adaptor closure object <span class='texttt'>e</span>:</div></div><div class='texpara'><div id='adapt.obj-1.sentence-4' class='sentence'><span class='texttt'>e</span> is a perfect forwarding call wrapper (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>)
with the following properties:
<ul class='itemize'><li id='adapt.obj-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.1'>(1.1)</a></div><div class='texpara'><div id='adapt.obj-1.1.sentence-1' class='sentence'>Its target object is an object <span class='texttt'>d2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>d<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>d</span><a class='hidden_link' href='#adapt.obj-1.1.sentence-1'>.</a></div></div></li><li id='adapt.obj-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.2'>(1.2)</a></div><div class='texpara'><div id='adapt.obj-1.2.sentence-1' class='sentence'>It has one bound argument entity,
an object <span class='texttt'>c2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>c</span><a class='hidden_link' href='#adapt.obj-1.2.sentence-1'>.</a></div></div></li><li id='adapt.obj-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-1.3'>(1.3)</a></div><div class='texpara'><div id='adapt.obj-1.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>d2<span class='parenthesis'>(</span>c2<span class='parenthesis'>(</span>arg<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
where arg is the argument used in a function call expression of <span class='texttt'>e</span><a class='hidden_link' href='#adapt.obj-1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='adapt.obj-1.sentence-5' class='sentence'>
The expression <span class='texttt'>c <span class='operator'>|</span> d</span> is well-formed if and only if
the initializations of the state entities (<a href='func.def' title='22.10.3&emsp;Definitions'>[func.<span class='shy'></span>def]</a>) of <span class='texttt'>e</span>
are all well-formed<a class='hidden_link' href='#adapt.obj-1.sentence-5'>.</a></div></div></div><div class='para' id='adapt.obj-2'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3134'>#</a></div><div class='texpara'><div id='adapt.obj-2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> of type <span class='texttt'>T</span> is
a pipeable sender adaptor closure object
if <span class='texttt'>T</span> models <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from______'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>T</span> has no other base classes
of type <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> for any other type <span class='texttt'>U</span>, and
<span class='texttt'>T</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-2.sentence-1'>.</a></div></div></div><div class='para' id='adapt.obj-3'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3142'>#</a></div><div class='texpara'><div id='adapt.obj-3.sentence-1' class='sentence'>The template parameter <span class='texttt'>D</span> for <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure</span> can be
an incomplete type<a class='hidden_link' href='#adapt.obj-3.sentence-1'>.</a></div> <div id='adapt.obj-3.sentence-2' class='sentence'>Before any expression of type <span class='mathit'>cv</span> <span class='texttt'>D</span> appears as
an operand to the <span class='texttt'><span class='operator'>|</span></span> operator,
<span class='texttt'>D</span> shall be complete and
model <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_______'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>D<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#adapt.obj-3.sentence-2'>.</a></div> <div id='adapt.obj-3.sentence-3' class='sentence'>The behavior of an expression involving an object of type <span class='mathit'>cv</span> <span class='texttt'>D</span>
as an operand to the <span class='texttt'><span class='operator'>|</span></span> operator is undefined
if overload resolution selects a program-defined <span class='texttt'><span class='keyword'>operator</span><span class='operator'>|</span></span> function<a class='hidden_link' href='#adapt.obj-3.sentence-3'>.</a></div></div></div><div class='para' id='adapt.obj-4'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3153'>#</a></div><div class='texpara'><div id='adapt.obj-4.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_object,pipeable' title='33.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_object,pipeable'><i >pipeable sender adaptor object</i></span></a> is a customization point object
that accepts a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________'><span class='texttt'>sender</span></span></a> as its first argument and
returns a <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#adapt.obj-4.sentence-1'>.</a></div> <div id='adapt.obj-4.sentence-2' class='sentence'>If a pipeable sender adaptor object accepts only one argument,
then it is a pipeable sender adaptor closure object<a class='hidden_link' href='#adapt.obj-4.sentence-2'>.</a></div></div></div><div class='para' id='adapt.obj-5'><div class='marginalizedparent'><a class='marginalized' href='#adapt.obj-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3160'>#</a></div><div class='texpara'><div id='adapt.obj-5.sentence-1' class='sentence'>If a pipeable sender adaptor object adaptor accepts more than one argument,
then let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________'><span class='texttt'>sender</span></span></a>,
let <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be arguments
such that <span class='texttt'>adaptor<span class='parenthesis'>(</span>sndr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is a well-formed expression
as specified below, and
let <span class='texttt'>BoundArgs</span> be a pack that denotes <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#adapt.obj-5.sentence-1'>.</a></div> <div id='adapt.obj-5.sentence-2' class='sentence'>The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> produces
a pipeable sender adaptor closure object <span class='texttt'>f</span>
that is a perfect forwarding call wrapper with the following properties:
<ul class='itemize'><li id='adapt.obj-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.1'>(5.1)</a></div><div class='texpara'><div id='adapt.obj-5.1.sentence-1' class='sentence'>Its target object is a copy of adaptor<a class='hidden_link' href='#adapt.obj-5.1.sentence-1'>.</a></div></div></li><li id='adapt.obj-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.2'>(5.2)</a></div><div class='texpara'><div id='adapt.obj-5.2.sentence-1' class='sentence'>Its bound argument entities <span class='texttt'>bound_<span class='shy'></span>args</span> consist of
objects of types <span class='texttt'>BoundArgs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> direct-non-list-initialized with
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, respectively<a class='hidden_link' href='#adapt.obj-5.2.sentence-1'>.</a></div></div></li><li id='adapt.obj-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#adapt.obj-5.3'>(5.3)</a></div><div class='texpara'><div id='adapt.obj-5.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>adaptor<span class='parenthesis'>(</span>rcvr, bound_<span class='shy'></span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>rcvr</span> is
the argument used in a function call expression of <span class='texttt'>f</span><a class='hidden_link' href='#adapt.obj-5.3.sentence-1'>.</a></div></div></li></ul></div> <div id='adapt.obj-5.sentence-3' class='sentence'>
The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed if and only if
the initializations of the bound argument entities of the result,
as specified above, are all well-formed<a class='hidden_link' href='#adapt.obj-5.sentence-3'>.</a></div></div></div></div><div id='write.env' class='section'><h4 ><a class='secnum' href='#write.env' style='min-width:95pt'>33.9.12.3</a> <span class='texttt'>execution&#x200b;::&#x200b;write_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.write.env'>[exec.write.env]</a></h4><div class='para' id='write.env-1'><div class='marginalizedparent'><a class='marginalized' href='#write.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3189'>#</a></div><div class='texpara'><div id='write.env-1.sentence-1' class='sentence'><span class='texttt'>write_<span class='shy'></span>env</span> is a sender adaptor
that accepts a sender and a queryable object, and
that returns a sender that,
when connected with a receiver <span class='texttt'>rcvr</span>,
connects the adapted sender with a receiver
whose execution environment is the result of
joining the <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________________________'><span class='texttt'><i >queryable</i></span></span></a> object
to the result of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-1.sentence-1'>.</a></div></div></div><div class='para' id='write.env-2'><div class='marginalizedparent'><a class='marginalized' href='#write.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3199'>#</a></div><div class='texpara'><div id='write.env-2.sentence-1' class='sentence'><span class='texttt'>write_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#write.env-2.sentence-1'>.</a></div> <div id='write.env-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________________________'><span class='texttt'><i >queryable</i></span></span></a>,
the expression <span class='texttt'>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#write.env-2.sentence-2'>.</a></div> <div id='write.env-2.sentence-3' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>write_<span class='shy'></span>env, env, sndr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-2.sentence-3'>.</a></div></div></div><div class='para' id='write.env-3'><div class='marginalizedparent'><a class='marginalized' href='#write.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3208'>#</a></div><div class='texpara'><div id='write.env-3.sentence-1' class='sentence'>Let <span class='texttt'><i >write-env-t</i></span> denote the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-3.sentence-1'>.</a></div> <div id='write.env-3.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >write-env-t</i></span> as follows:
<span id='lib:impls-for<write-env-t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cwrite-env-t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >write-env-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >join-env</i><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>

  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >join-env</i><span class='parenthesis'>(</span>state, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></span></div> <div id='write.env-3.sentence-3' class='sentence'>
Invocation of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >join-env</i></span></span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='write.env-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#write.env-3.1'>(3.1)</a></div><div class='texpara'><div id='write.env-3.1.sentence-1' class='sentence'><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________________________'><span class='texttt'><i >queryable</i></span></span></a> and</div></div></li><li id='write.env-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#write.env-3.2'>(3.2)</a></div><div class='texpara'><div id='write.env-3.2.sentence-1' class='sentence'>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>state<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid,
otherwise, <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-3.2.sentence-1'>.</a></div></div></li><li id='write.env-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#write.env-3.3'>(3.3)</a></div><div class='texpara'><div id='write.env-3.3.sentence-1' class='sentence'>For a type <span class='texttt'>Sndr</span> and a pack of types <span class='texttt'>Env</span>,
let <span class='texttt'>State</span> be <span class='texttt'><span class='texttt'><i >data-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> and
let <span class='texttt'>JoinEnv</span> be the pack
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >join-env</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>State<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-3.3.sentence-1'>.</a></div> <div id='write.env-3.3.sentence-2' class='sentence'>Then <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >write-<br/>env-t</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >check-types</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
is expression-equivalent to
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span><br/><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, JoinEnv<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#write.env-3.3.sentence-2'>.</a></div></div></li></ul></div></div></div></div><div id='unstoppable' class='section'><h4 ><a class='secnum' href='#unstoppable' style='min-width:95pt'>33.9.12.4</a> <span class='texttt'>execution&#x200b;::&#x200b;unstoppable</span> <a class='abbr_ref' href='exec.unstoppable'>[exec.unstoppable]</a></h4><div class='para' id='unstoppable-1'><div class='marginalizedparent'><a class='marginalized' href='#unstoppable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3253'>#</a></div><div class='texpara'><div id='unstoppable-1.sentence-1' class='sentence'><span class='texttt'>unstoppable</span> is a sender adaptor
that connects its inner sender
with a receiver that has the execution environment of the outer receiver
but with an object of type <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token</span>
as the result of the <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token query</span><a class='hidden_link' href='#unstoppable-1.sentence-1'>.</a></div></div></div><div class='para' id='unstoppable-2'><div class='marginalizedparent'><a class='marginalized' href='#unstoppable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3260'>#</a></div><div class='texpara'><div id='unstoppable-2.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
<span class='texttt'>unstoppable<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, never_<span class='shy'></span>stop_<span class='shy'></span>token<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#unstoppable-2.sentence-1'>.</a></div></div></div></div><div id='starts.on' class='section'><h4 ><a class='secnum' href='#starts.on' style='min-width:95pt'>33.9.12.5</a> <span class='texttt'>execution&#x200b;::&#x200b;starts_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.starts.on'>[exec.starts.on]</a></h4><div class='para' id='starts.on-1'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3267'>#</a></div><div class='texpara'><div id='starts.on-1.sentence-1' class='sentence'><span class='texttt'>starts_<span class='shy'></span>on</span> adapts an input sender into a sender
that will start on an execution agent belonging to
a particular scheduler's associated execution resource<a class='hidden_link' href='#starts.on-1.sentence-1'>.</a></div></div></div><div class='para' id='starts.on-2'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3272'>#</a></div><div class='texpara'><div id='starts.on-2.sentence-1' class='sentence'>The name <span class='texttt'>starts_<span class='shy'></span>on</span> denotes a customization point object<a class='hidden_link' href='#starts.on-2.sentence-1'>.</a></div> <div id='starts.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_________'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#starts.on-2.sentence-2'>.</a></div></div></div><div class='para' id='starts.on-3'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3279'>#</a></div><div class='texpara'><div id='starts.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>starts_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#starts.on-3.sentence-1'>.</a></div></div></div><div class='para' id='starts.on-4'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3289'>#</a></div><div class='texpara'><div id='starts.on-4.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>OutSndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#starts.on-4.sentence-1'>.</a></div> <div id='starts.on-4.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for__'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, starts_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed; otherwise
<ul class='itemize'><li id='starts.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#starts.on-4.1'>(4.1)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li><li id='starts.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#starts.on-4.2'>(4.2)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, sndr<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> let_value<span class='parenthesis'>(</span>
  schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>sndr <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='starts.on-5'><div class='marginalizedparent'><a class='marginalized' href='#starts.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3315'>#</a></div><div class='texpara'><div id='starts.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#starts.on-5.sentence-1'>.</a></div> <div id='starts.on-5.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#starts.on-5.sentence-2'>.</a></div> <div id='starts.on-5.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#starts.on-5.sentence-3'>.</a></div> <div id='starts.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall start <span class='texttt'>sndr</span>
on an execution agent of the associated execution resource of <span class='texttt'>sch</span><a class='hidden_link' href='#starts.on-5.sentence-4'>.</a></div> <div id='starts.on-5.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#starts.on-5.sentence-5'>.</a></div></div></div></div><div id='continues.on' class='section'><h4 ><a class='secnum' href='#continues.on' style='min-width:95pt'>33.9.12.6</a> <span class='texttt'>execution&#x200b;::&#x200b;continues_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.continues.on'>[exec.continues.on]</a></h4><div class='para' id='continues.on-1'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3332'>#</a></div><div class='texpara'><div id='continues.on-1.sentence-1' class='sentence'><span class='texttt'>continues_<span class='shy'></span>on</span> adapts a sender into one
that completes on the specified scheduler<a class='hidden_link' href='#continues.on-1.sentence-1'>.</a></div></div></div><div class='para' id='continues.on-2'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3336'>#</a></div><div class='texpara'><div id='continues.on-2.sentence-1' class='sentence'>The name <span class='texttt'>continues_<span class='shy'></span>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#continues.on-2.sentence-1'>.</a></div> <div id='continues.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__________'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#continues.on-2.sentence-2'>.</a></div></div></div><div class='para' id='continues.on-3'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3343'>#</a></div><div class='texpara'><div id='continues.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>continues_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#continues.on-3.sentence-1'>.</a></div></div></div><div class='para' id='continues.on-4'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3351'>#</a></div><div class='texpara'><div id='continues.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>continues_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>continues_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='continues.on-5'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3366'>#</a></div><div class='texpara'><div id='continues.on-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#continues.on-5.sentence-1'>.</a></div> <div id='continues.on-5.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for___'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> schedule_from<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='continues.on-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#continues.on-note-1'>1</a></i>:&ensp;<div id='continues.on-5.sentence-2' class='sentence'>This causes the <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> sender to become
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#continues.on-5.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='continues.on-6'><div class='marginalizedparent'><a class='marginalized' href='#continues.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3383'>#</a></div><div class='texpara'><div id='continues.on-6.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#continues.on-6.sentence-1'>.</a></div> <div id='continues.on-6.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#continues.on-6.sentence-2'>.</a></div> <div id='continues.on-6.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#continues.on-6.sentence-3'>.</a></div> <div id='continues.on-6.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#continues.on-6.sentence-4'>.</a></div> <div id='continues.on-6.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#continues.on-6.sentence-5'>.</a></div></div></div></div><div id='schedule.from' class='section'><h4 ><a class='secnum' href='#schedule.from' style='min-width:95pt'>33.9.12.7</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule_<span class='shy'></span>from</span> <a class='abbr_ref' href='exec.schedule.from'>[exec.schedule.from]</a></h4><div class='para' id='schedule.from-1'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3402'>#</a></div><div class='texpara'><div id='schedule.from-1.sentence-1' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> schedules work dependent on the completion of a sender
onto a scheduler's associated execution resource<a class='hidden_link' href='#schedule.from-1.sentence-1'>.</a></div> <div id='schedule.from-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#schedule.from-note-1'>1</a></i>:&ensp;<div id='schedule.from-1.sentence-2' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> is not meant to be used in user code;
it is used in the implementation of <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#schedule.from-1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='schedule.from-2'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3410'>#</a></div><div class='texpara'><div id='schedule.from-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule_<span class='shy'></span>from</span> denotes a customization point object<a class='hidden_link' href='#schedule.from-2.sentence-1'>.</a></div> <div id='schedule.from-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule.from-2.sentence-2'>.</a></div> <div id='schedule.from-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___________'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#schedule.from-2.sentence-3'>.</a></div></div></div><div class='para' id='schedule.from-3'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3419'>#</a></div><div class='texpara'><div id='schedule.from-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>schedule_from, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#schedule.from-3.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-4'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3429'>#</a></div><div class='texpara'><div id='schedule.from-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>schedule_<span class='shy'></span>from_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<schedule_from_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cschedule_from_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>schedule_from_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='schedule.from-5'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3447'>#</a></div><div class='texpara'><div id='schedule.from-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-6'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3456'>#</a></div><div class='texpara'><div id='schedule.from-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;

  <span class='keyword'>using</span> sched_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> receiver_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> operation_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span>sched_t<span class='anglebracket'>&gt;</span>, receiver_t<span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='literal'>nullptr</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    variant_t <i >async-result</i>;     <span class='comment'>// <i >exposition only</i></span>
    operation_t <i >op-state</i>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >state-type</i><span class='parenthesis'>(</span>sched_t sch, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <i >op-state</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>sch, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div id='lib:impls-for<schedule_from_t>,check-types'><div id='lib:check-types,impls-for<schedule_from_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cschedule_from_t%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='schedule.from-7'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3491'>#</a></div><div class='texpara'><div id='schedule.from-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'>get_completion_signatures<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>;   <span class='comment'>// see <a href='#snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
</span></div></div></div></div><div class='para' id='schedule.from-8'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3501'>#</a></div><div class='texpara'><div id='schedule.from-8.sentence-1' class='sentence'>Objects of the local class <span class='texttt'><i >state-type</i></span> can be used
to initialize a structured binding<a class='hidden_link' href='#schedule.from-8.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-9'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3505'>#</a></div><div class='texpara'><div id='schedule.from-9.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be
a pack of the arguments to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#schedule.from-9.sentence-1'>.</a></div> <div id='schedule.from-9.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template such that
<span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>, and
let <span class='texttt'><i >is-nothrow-decay-copy-sig</i></span> be a variable template such that
<span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='texttt'><i >is-nothrow-decay-copy-sig</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><br/><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span> is
a constant expression of type <span class='texttt'><span class='keyword'>bool</span></span> and
equal to <span class='texttt'><span class='parenthesis'>(</span>is_<span class='shy'></span>nothrow_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span>, Args<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule.from-9.sentence-2'>.</a></div> <div id='schedule.from-9.sentence-3' class='sentence'>Let <span class='texttt'><i >error-completion</i></span> be a pack consisting of
the type <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>exception_<span class='shy'></span>ptr<span class='parenthesis'>)</span></span>
if <span class='texttt'><span class='parenthesis'>(</span><span class='texttt'><i >is-nothrow-decay-copy-sig</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
and an empty pack otherwise<a class='hidden_link' href='#schedule.from-9.sentence-3'>.</a></div> <div id='schedule.from-9.sentence-4' class='sentence'>Then <span class='texttt'>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, <span class='texttt'><i >error-completion</i></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#schedule.from-9.sentence-4'>.</a></div></div></div><div class='para' id='schedule.from-10'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3524'>#</a></div><div class='texpara'><div id='schedule.from-10.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>t</span> is an alias for the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >receiver-type</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
    <i >state-type</i><span class='operator'>*</span> <i >state</i>;          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      visit<span class='parenthesis'>(</span>
        <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tuple<span class='operator'>&amp;</span> result<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>monostate, Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>args<span class='squarebracket'>]</span> <span class='operator'>=</span> result;
            tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>,
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >async-result</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='schedule.from-11'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3559'>#</a></div><div class='texpara'><div id='schedule.from-11.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of the lambda is <span class='texttt'><span class='literal'>true</span></span>
if the construction of the returned <span class='texttt'><i >state-type</i></span> object
is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#schedule.from-11.sentence-1'>.</a></div></div></div><div class='para' id='schedule.from-12'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3565'>#</a></div><div class='texpara'><div id='schedule.from-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> result_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span>, Args<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;

  <span class='keyword'>try</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>result_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>nothrow<span class='parenthesis'>)</span>
      state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span>set_error_t,
                                                exception_ptr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
  start<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >op-state</i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='schedule.from-13'><div class='marginalizedparent'><a class='marginalized' href='#schedule.from-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3585'>#</a></div><div class='texpara'><div id='schedule.from-13.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#schedule.from-13.sentence-1'>.</a></div> <div id='schedule.from-13.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#schedule.from-13.sentence-2'>.</a></div> <div id='schedule.from-13.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#schedule.from-13.sentence-3'>.</a></div> <div id='schedule.from-13.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#schedule.from-13.sentence-4'>.</a></div> <div id='schedule.from-13.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#schedule.from-13.sentence-5'>.</a></div></div></div></div><div id='on' class='section'><h4 ><a class='secnum' href='#on' style='min-width:95pt'>33.9.12.8</a> <span class='texttt'>execution&#x200b;::&#x200b;on</span> <a class='abbr_ref' href='exec.on'>[exec.on]</a></h4><div class='para' id='on-1'><div class='marginalizedparent'><a class='marginalized' href='#on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3604'>#</a></div><div class='texpara'><div id='on-1.sentence-1' class='sentence'>The <span class='texttt'>on</span> sender adaptor has two forms:
<ul class='itemize'><li id='on-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-1.1'>(1.1)</a></div><div class='texpara'><div id='on-1.1.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span>,
which starts a sender <span class='texttt'>sndr</span> on an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource and
that, upon <span class='texttt'>sndr</span>'s completion,
transfers execution back to the execution resource
on which the <span class='texttt'>on</span> sender was started<a class='hidden_link' href='#on-1.1.sentence-1'>.</a></div></div></li><li id='on-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-1.2'>(1.2)</a></div><div class='texpara'><div id='on-1.2.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span>,
which upon completion of a sender <span class='texttt'>sndr</span>,
transfers execution to an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource,
then executes a sender adaptor closure <span class='texttt'>closure</span>
with the async results of the sender, and
that then transfers execution back to the execution resource
on which <span class='texttt'>sndr</span> completed<a class='hidden_link' href='#on-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='on-2'><div class='marginalizedparent'><a class='marginalized' href='#on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3625'>#</a></div><div class='texpara'><div id='on-2.sentence-1' class='sentence'>The name <span class='texttt'>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#on-2.sentence-1'>.</a></div> <div id='on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
<span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='on-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____________'><span class='texttt'>scheduler</span></span></a>, or</li><li id='on-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.2'>(2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr</span> is not
a pipeable sender adaptor closure object (<a href='#adapt.obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>), or</li><li id='on-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-2.3'>(2.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr </span>is also a pipeable sender adaptor closure object<a class='hidden_link' href='#on-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='on-3'><div class='marginalizedparent'><a class='marginalized' href='#on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3641'>#</a></div><div class='texpara'><div id='on-3.sentence-1' class='sentence'>Otherwise, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________'><span class='texttt'>sender</span></span></a>,
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-with-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#on-3.sentence-1'>.</a></div></div></div><div class='para' id='on-4'><div class='marginalizedparent'><a class='marginalized' href='#on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3651'>#</a></div><div class='texpara'><div id='on-4.sentence-1' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>sch</span>, and <span class='texttt'>closure</span>, if
<ul class='itemize'><li id='on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____________'><span class='texttt'>scheduler</span></span></a>, or</li><li id='on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.2'>(4.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='on-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-4.3'>(4.3)</a></div><span class='texttt'>closure</span> is not a pipeable sender adaptor closure object (<a href='#adapt.obj' title='33.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>),</li></ul>
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, <i >product-type</i><span class='curlybracket'>{</span>sch, closure<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#on-4.sentence-1'>.</a></div></div></div><div class='para' id='on-5'><div class='marginalizedparent'><a class='marginalized' href='#on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3670'>#</a></div><div class='texpara'><div id='on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions,
let <span class='texttt'>OutSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>Env</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-5.sentence-1'>.</a></div> <div id='on-5.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed<a class='hidden_link' href='#on-5.sentence-2'>.</a></div></div></div><div class='para' id='on-6'><div class='marginalizedparent'><a class='marginalized' href='#on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3678'>#</a></div><div class='texpara'><div id='on-6.sentence-1' class='sentence'>Otherwise:
Let <span class='texttt'><i >not-a-scheduler</i></span> be an unspecified empty class type<a class='hidden_link' href='#on-6.sentence-1'>.</a></div></div></div><div class='para' id='on-7'><div class='marginalizedparent'><a class='marginalized' href='#on-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3682'>#</a></div><div class='texpara'><div id='on-7.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='on-8'><div class='marginalizedparent'><a class='marginalized' href='#on-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3694'>#</a></div><div class='texpara'><div id='on-8.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_______________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span>
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> continues_on<span class='parenthesis'>(</span>
      starts_on<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>sch, closure<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span> <i >query-with-default</i><span class='parenthesis'>(</span>
    get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span>,
    get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>
      continues_on<span class='parenthesis'>(</span>
        std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>closure<span class='parenthesis'>)</span><span class='parenthesis'>(</span>
          continues_on<span class='parenthesis'>(</span>
            write_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >SCHED-ENV</i><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
            sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        orig_sch<span class='parenthesis'>)</span>,
      <i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='on-9'><div class='marginalizedparent'><a class='marginalized' href='#on-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3732'>#</a></div><div class='texpara'><div id='on-9.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-9.sentence-1'>.</a></div> <div id='on-9.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#on-9.sentence-2'>.</a></div> <div id='on-9.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-9.sentence-3'>.</a></div> <div id='on-9.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='on-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-9.1'>(9.1)</a></div>remember the current scheduler, <span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li><li id='on-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-9.2'>(9.2)</a></div>start <span class='texttt'>sndr</span> on an execution agent belonging to
<span class='texttt'>sch</span>'s associated execution resource;</li><li id='on-9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-9.3'>(9.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1; and</li><li id='on-9.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-9.4'>(9.4)</a></div>forward <span class='texttt'>sndr</span>'s async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-9.sentence-4'>.</a></li></ul></div> <div id='on-9.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#on-9.sentence-5'>.</a></div></div></div><div class='para' id='on-10'><div class='marginalizedparent'><a class='marginalized' href='#on-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3759'>#</a></div><div class='texpara'><div id='on-10.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#on-10.sentence-1'>.</a></div> <div id='on-10.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#on-10.sentence-2'>.</a></div> <div id='on-10.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-10.sentence-3'>.</a></div> <div id='on-10.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='on-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.1'>(10.1)</a></div>remember the current scheduler,
which is the first of the following expressions that is well-formed:
<ul class='itemize'><li id='on-10.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#on-10.1.1'>(10.1.1)</a></div><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='on-10.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#on-10.1.2'>(10.1.2)</a></div><span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li></ul></li><li id='on-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.2'>(10.2)</a></div>start <span class='texttt'>sndr</span> on the current execution agent;</li><li id='on-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.3'>(10.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution to an agent
owned by <span class='texttt'>sch</span>'s associated execution resource;</li><li id='on-10.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.4'>(10.4)</a></div>forward <span class='texttt'>sndr</span>'s async result as if by
connecting and starting a sender <span class='texttt'>closure<span class='parenthesis'>(</span>S<span class='parenthesis'>)</span></span>,
where <span class='texttt'>S</span> is a sender
that completes synchronously with <span class='texttt'>sndr</span>'s async result; and</li><li id='on-10.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#on-10.5'>(10.5)</a></div>upon completion of the operation started in the previous step,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1 and
forward the operation's async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#on-10.sentence-4'>.</a></li></ul></div> <div id='on-10.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed on
an unspecified execution agent<a class='hidden_link' href='#on-10.sentence-5'>.</a></div></div></div></div><div id='then' class='section'><h4 ><a class='secnum' href='#then' style='min-width:95pt'>33.9.12.9</a> <span class='texttt'>execution&#x200b;::&#x200b;then</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.then'>[exec.then]</a></h4><div class='para' id='then-1'><div class='marginalizedparent'><a class='marginalized' href='#then-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3800'>#</a></div><div class='texpara'><div id='then-1.sentence-1' class='sentence'><span class='texttt'>then</span> attaches an invocable as a continuation
for an input sender's value completion operation<a class='hidden_link' href='#then-1.sentence-1'>.</a></div> <div id='then-1.sentence-2' class='sentence'><span class='texttt'>upon_<span class='shy'></span>error</span> and <span class='texttt'>upon_<span class='shy'></span>stopped</span> do the same
for the error and stopped completion operations, respectively,
sending the result of the invocable as a value completion<a class='hidden_link' href='#then-1.sentence-2'>.</a></div></div></div><div class='para' id='then-2'><div class='marginalizedparent'><a class='marginalized' href='#then-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3807'>#</a></div><div class='texpara'><div id='then-2.sentence-1' class='sentence'>The names <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#then-2.sentence-1'>.</a></div> <div id='then-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >then-cpo</i></span> be one of
<span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, or <span class='texttt'>upon_<span class='shy'></span>stopped</span><a class='hidden_link' href='#then-2.sentence-2'>.</a></div> <div id='then-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value___'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span> </span>is ill-formed<a class='hidden_link' href='#then-2.sentence-3'>.</a></div></div></div><div class='para' id='then-3'><div class='marginalizedparent'><a class='marginalized' href='#then-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3817'>#</a></div><div class='texpara'><div id='then-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >then-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#then-3.sentence-1'>.</a></div></div></div><div class='para' id='then-4'><div class='marginalizedparent'><a class='marginalized' href='#then-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3825'>#</a></div><div class='texpara'><div id='then-4.sentence-1' class='sentence'>For <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#then-4.sentence-1'>.</a></div> <div id='then-4.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >then-cpo</i></span> as follows:
<span id='lib:impls-for<decayed-typeof<then-cpo>>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cdecayed-typeof%3cthen-cpo%3e%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >then-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
        <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> fn, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span>set<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr,
                          invoke<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
            Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='texpara'><div id='lib:impls-for<decayed-typeof<then-cpo>>,check-types'><div id='lib:check-types,impls-for<decayed-typeof<then-cpo>>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cdecayed-typeof%3cthen-cpo%3e%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='then-5'><div class='marginalizedparent'><a class='marginalized' href='#then-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3860'>#</a></div><div class='texpara'><div id='then-5.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_value_t<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='tcode_in_codeblock'>invocable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='curlybracket'>{</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#then-5.sentence-1'>.</a></div></div></div></div><div class='para' id='then-6'><div class='marginalizedparent'><a class='marginalized' href='#then-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3875'>#</a></div><div class='texpara'><div id='then-6.sentence-1' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> has undefined behavior
unless it returns a sender <span class='texttt'>out_<span class='shy'></span>sndr</span> that
<ul class='itemize'><li id='then-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#then-6.1'>(6.1)</a></div>invokes <span class='texttt'>f</span> or a copy of such
with the value, error, or stopped result datums of <span class='texttt'>sndr</span>
for <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>, respectively,
using the result value of <span class='texttt'>f</span> as <span class='texttt'>out_<span class='shy'></span>sndr</span>'s value completion, and</li><li id='then-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#then-6.2'>(6.2)</a></div>forwards all other completion operations unchanged<a class='hidden_link' href='#then-6.sentence-1'>.</a></li></ul></div></div></div></div><div id='let' class='section'><h4 ><a class='secnum' href='#let' style='min-width:95pt'>33.9.12.10</a> <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>value</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.let'>[exec.let]</a></h4><div class='para' id='let-1'><div class='marginalizedparent'><a class='marginalized' href='#let-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3890'>#</a></div><div class='texpara'><div id='let-1.sentence-1' class='sentence'><span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> transform
a sender's value, error, and stopped completions, respectively,
into a new child asynchronous operation
by passing the sender's result datums to a user-specified callable,
which returns a new sender that is connected and started<a class='hidden_link' href='#let-1.sentence-1'>.</a></div></div></div><div class='para' id='let-2'><div class='marginalizedparent'><a class='marginalized' href='#let-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3897'>#</a></div><div class='texpara'><div id='let-2.sentence-1' class='sentence'>For <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#let-2.sentence-1'>.</a></div> <div id='let-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >let-cpo</i></span> be one of
<span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, or <span class='texttt'>let_<span class='shy'></span>stopped</span><a class='hidden_link' href='#let-2.sentence-2'>.</a></div> <div id='let-2.sentence-3' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> be expression-equivalent to
the first well-formed expression below:
<ul class='itemize'><li id='let-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.1'>(2.1)</a></div><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='let-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.2'>(2.2)</a></div><span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>domain, get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='let-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-2.3'>(2.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li></ul></div></div></div><div class='para' id='let-3'><div class='marginalizedparent'><a class='marginalized' href='#let-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3915'>#</a></div><div class='texpara'><div id='let-3.sentence-1' class='sentence'>The names <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> denote
pipeable sender adaptor objects<a class='hidden_link' href='#let-3.sentence-1'>.</a></div> <div id='let-3.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
let <span class='texttt'>F</span> be the decayed type of <span class='texttt'>f</span><a class='hidden_link' href='#let-3.sentence-2'>.</a></div> <div id='let-3.sentence-3' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value____'><span class='texttt'><i >movable-value</i></span></span></a>,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#let-3.sentence-3'>.</a></div> <div id='let-3.sentence-4' class='sentence'>If <span class='texttt'>F</span> does not satisfy <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable_'><span class='texttt'>invocable</span></span></a>,
the expression <span class='texttt'>let_<span class='shy'></span>stopped<span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#let-3.sentence-4'>.</a></div></div></div><div class='para' id='let-4'><div class='marginalizedparent'><a class='marginalized' href='#let-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3926'>#</a></div><div class='texpara'><div id='let-4.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >let-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#let-4.sentence-1'>.</a></div></div></div><div class='para' id='let-5'><div class='marginalizedparent'><a class='marginalized' href='#let-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3934'>#</a></div><div class='texpara'><div id='let-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >let-cpo</i></span> as follows:
<span id='lib:impls-for<decayed-typeof<let-cpo>>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cdecayed-typeof%3clet-cpo%3e%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> <i >let-bind</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >let-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='let-6'><div class='marginalizedparent'><a class='marginalized' href='#let-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L3954'>#</a></div><div class='texpara'><div id='let-6.sentence-1' class='sentence'>Let <span class='texttt'><i >receiver2</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >receiver2</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
    <span class='curlybracket'>}</span>

    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    Env <i >env</i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div> <div id='let-6.sentence-2' class='sentence'>
Invocation of the function <span class='texttt'><span class='texttt'><i >receiver2</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>env</span>
returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='let-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-6.1'>(6.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________________________'><span class='texttt'><i >queryable</i></span></span></a> and</li><li id='let-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-6.2'>(6.2)</a></div>given a query object <span class='texttt'>q</span>,
the expression <span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'><span class='texttt'><i >env</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> if that expression is valid;
otherwise,
if the type of <span class='texttt'>q</span> satisfies <a href='#concept:forwarding-query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:forwarding-query'><span class='texttt'><i >forwarding-query</i></span></span></a>,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent
to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span>;
otherwise,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#let-6.sentence-2'>.</a></li></ul></div></div></div><div class='texpara'><div id='lib:impls-for<decayed-typeof<let-cpo>>,check-types'><div id='lib:check-types,impls-for<decayed-typeof<let-cpo>>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cdecayed-typeof%3clet-cpo%3e%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='let-7'><div class='marginalizedparent'><a class='marginalized' href='#let-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4009'>#</a></div><div class='texpara'><div id='let-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>using</span> LetFn <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><i >is-valid-let-sender</i><span class='parenthesis'>)</span>   <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='parenthesis'>(</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span>, and
where <span class='texttt'><i >is-valid-let-sender</i></span> is <span class='texttt'><span class='literal'>true</span></span> if and only if
all of the following are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='let-7.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#let-7.1'>(7.1)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from___'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span>, Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span></li><li id='let-7.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#let-7.2'>(7.2)</a></div><span class='texttt'><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable__'><span class='texttt'>invocable</span></span></a><span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span></li><li id='let-7.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#let-7.3'>(7.3)</a></div><span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>invoke_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span></li><li id='let-7.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#let-7.4'>(7.4)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>invoke_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>LetFn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>, <i >env-t</i><br/><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span></li></ul>
where <span class='texttt'><i >env-t</i></span> is the pack
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#let-7.sentence-1'>.</a></div></div></div></div><div class='para' id='let-8'><div class='marginalizedparent'><a class='marginalized' href='#let-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4036'>#</a></div><div class='texpara'><div id='let-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, fn, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>using</span> fn_t <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>using</span> env_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> args_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> ops2_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    fn_t <i >fn</i>;                    <span class='comment'>// <i >exposition only</i></span>
    env_t <i >env</i>;                  <span class='comment'>// <i >exposition only</i></span>
    args_variant_t <i >args</i>;        <span class='comment'>// <i >exposition only</i></span>
    ops2_variant_t <i >ops2</i>;        <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><i >allocator-aware-forward</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, rcvr<span class='parenthesis'>)</span>,
                    <i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='let-9'><div class='marginalizedparent'><a class='marginalized' href='#let-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4058'>#</a></div><div class='texpara'><div id='let-9.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-9.sentence-1'>.</a></div> <div id='let-9.sentence-2' class='sentence'>Let <span class='texttt'>LetSigs</span> be a pack of those types in <span class='texttt'>Sigs</span>
with a return type of <span class='texttt'><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-9.sentence-2'>.</a></div> <div id='let-9.sentence-3' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-9.sentence-3'>.</a></div> <div id='let-9.sentence-4' class='sentence'>Then <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
except with duplicate types removed<a class='hidden_link' href='#let-9.sentence-4'>.</a></div></div></div><div class='para' id='let-10'><div class='marginalizedparent'><a class='marginalized' href='#let-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4071'>#</a></div><div class='texpara'><div id='let-10.sentence-1' class='sentence'>Given a type <span class='texttt'>Tag</span> and a pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-sndr2</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-sndr2</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>F, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#let-10.sentence-1'>.</a></div> <div id='let-10.sentence-2' class='sentence'>Then <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>monostate, connect_result_t<span class='anglebracket'>&lt;</span><i >as-sndr2</i><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span>, <i >receiver2</i><span class='anglebracket'>&lt;</span>Rcvr, env_t<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
except with duplicate types removed<a class='hidden_link' href='#let-10.sentence-2'>.</a></div></div></div><div class='para' id='let-11'><div class='marginalizedparent'><a class='marginalized' href='#let-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4083'>#</a></div><div class='texpara'><div id='let-11.sentence-1' class='sentence'>The <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a> constraining the above lambda is satisfied
if and only if
the types <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> and <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> are well-formed<a class='hidden_link' href='#let-11.sentence-1'>.</a></div></div></div><div class='para' id='let-12'><div class='marginalizedparent'><a class='marginalized' href='#let-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4088'>#</a></div><div class='texpara'><div id='let-12.sentence-1' class='sentence'>The exposition-only function template <span class='texttt'><i >let-bind</i></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>using</span> args_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> mkop2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> connect<span class='parenthesis'>(</span>
    apply<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>fn<span class='parenthesis'>)</span>,
          state<span class='operator'>.</span>args<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>args_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >receiver2</i><span class='curlybracket'>{</span>rcvr, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>env<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
start<span class='parenthesis'>(</span>state<span class='operator'>.</span>ops2<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>mkop2<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >emplace-from</i><span class='curlybracket'>{</span>mkop2<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='let-13'><div class='marginalizedparent'><a class='marginalized' href='#let-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4102'>#</a></div><div class='texpara'><div id='let-13.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span>let<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >let-bind</i><span class='parenthesis'>(</span>state, rcvr, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='let-14'><div class='marginalizedparent'><a class='marginalized' href='#let-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4116'>#</a></div><div class='texpara'><div id='let-14.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions, and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#let-14.sentence-1'>.</a></div> <div id='let-14.sentence-2' class='sentence'>If
<span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#let-14.sentence-2'>.</a></div> <div id='let-14.sentence-3' class='sentence'>Otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='let-15'><div class='marginalizedparent'><a class='marginalized' href='#let-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4130'>#</a></div><div class='texpara'><div id='let-15.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#let-15.sentence-1'>.</a></div> <div id='let-15.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:
<ul class='itemize'><li id='let-15.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-15.1'>(15.1)</a></div>invokes <span class='texttt'>f</span> when <span class='texttt'><i >set-cpo</i></span> is called
with <span class='texttt'>sndr</span>'s result datums,</li><li id='let-15.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-15.2'>(15.2)</a></div>makes its completion dependent on
the completion of a sender returned by <span class='texttt'>f</span>, and</li><li id='let-15.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#let-15.3'>(15.3)</a></div>propagates the other completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#let-15.sentence-2'>.</a></li></ul></div></div></div></div><div id='bulk' class='section'><h4 ><a class='secnum' href='#bulk' style='min-width:95pt'>33.9.12.11</a> <span class='texttt'>execution&#x200b;::&#x200b;bulk</span>, <span class='texttt'>execution&#x200b;::&#x200b;bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>execution&#x200b;::&#x200b;bulk_<span class='shy'></span>unchunked</span> <a class='abbr_ref' href='exec.bulk'>[exec.bulk]</a></h4><div class='para' id='bulk-1'><div class='marginalizedparent'><a class='marginalized' href='#bulk-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4152'>#</a></div><div class='texpara'><div id='bulk-1.sentence-1' class='sentence'><span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>
run a task repeatedly for every index in an index space<a class='hidden_link' href='#bulk-1.sentence-1'>.</a></div></div></div><div class='para' id='bulk-2'><div class='marginalizedparent'><a class='marginalized' href='#bulk-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4156'>#</a></div><div class='texpara'><div id='bulk-2.sentence-1' class='sentence'>The names <span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, and <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#bulk-2.sentence-1'>.</a></div> <div id='bulk-2.sentence-2' class='sentence'>Let <span class='texttt'><i >bulk-algo</i></span> be either
<span class='texttt'>bulk</span>, <span class='texttt'>bulk_<span class='shy'></span>chunked</span>, or <span class='texttt'>bulk_<span class='shy'></span>unchunked</span><a class='hidden_link' href='#bulk-2.sentence-2'>.</a></div> <div id='bulk-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>policy</span>, <span class='texttt'>shape</span>, and <span class='texttt'>f</span>,
let
<span class='texttt'>Policy</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>policy<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>Shape</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
<span class='texttt'>Func</span> be <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#bulk-2.sentence-3'>.</a></div> <div id='bulk-2.sentence-4' class='sentence'>If
<ul class='itemize'><li id='bulk-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='bulk-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-2.2'>(2.2)</a></div><span class='texttt'>is_<span class='shy'></span>execution_<span class='shy'></span>policy_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>Policy<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='bulk-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-2.3'>(2.3)</a></div><span class='texttt'>Shape</span> does not satisfy <a href='concepts.arithmetic#concept:integral' title='18.4.7&emsp;Arithmetic concepts&emsp;[concepts.arithmetic]'><span id='conceptref:integral'><span class='texttt'>integral</span></span></a>, or</li><li id='bulk-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-2.4'>(2.4)</a></div><span class='texttt'>Func</span> does not model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible_'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>,</li></ul>
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#bulk-2.sentence-4'>.</a></div></div></div><div class='para' id='bulk-3'><div class='marginalizedparent'><a class='marginalized' href='#bulk-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4179'>#</a></div><div class='texpara'><div id='bulk-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span>
is expression-equivalent to:</div></div><div class='texpara'><div id='bulk-3.sentence-2' class='sentence'><span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>
    <i >bulk-algo</i>, <i >product-type</i><span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i>, Shape, Func<span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>policy, shape, f<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#bulk-3.sentence-2'>.</a></div> <div id='bulk-3.sentence-3' class='sentence'>The first template argument of <span class='texttt'><i >product-type</i></span> is <span class='texttt'>Policy</span>
if <span class='texttt'>Policy</span> models <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible__'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>, and
<span class='texttt'><span class='keyword'>const</span> Policy<span class='operator'>&amp;</span></span> otherwise<a class='hidden_link' href='#bulk-3.sentence-3'>.</a></div></div></div><div class='para' id='bulk-4'><div class='marginalizedparent'><a class='marginalized' href='#bulk-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4193'>#</a></div><div class='texpara'><div id='bulk-4.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions such that
<span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#bulk-4.sentence-1'>.</a></div> <div id='bulk-4.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, bulk_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>, then
the expression <span class='texttt'>bulk<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>policy, shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
<span class='keyword'>auto</span> new_f <span class='operator'>=</span> <span class='squarebracket'>[</span>func <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span>Shape begin, Shape end, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> vs<span class='parenthesis'>)</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span>begin, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>while</span> <span class='parenthesis'>(</span>begin <span class='operator'>!</span><span class='operator'>=</span> end<span class='parenthesis'>)</span> func<span class='parenthesis'>(</span>begin<span class='operator'>+</span><span class='operator'>+</span>, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> bulk_chunked<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, policy, shape, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>new_f<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='bulk-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#bulk-note-1'>1</a></i>:&ensp;<div id='bulk-4.sentence-2' class='sentence'>This causes the <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> sender to be
expressed in terms of <span class='texttt'>bulk_<span class='shy'></span>chunked<span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> when
it is connected to a receiver whose
execution domain does not customize <span class='texttt'>bulk</span><a class='hidden_link' href='#bulk-4.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='bulk-5'><div class='marginalizedparent'><a class='marginalized' href='#bulk-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4215'>#</a></div><div class='texpara'><div id='bulk-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>chunked_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<bulk_chunked_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cbulk_chunked_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_chunked_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div> <div id='bulk-5.sentence-2' class='sentence'>
The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>chunked_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>policy, shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        f<span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div> <div id='bulk-5.sentence-3' class='sentence'>
The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above is
<span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#bulk-5.sentence-3'>.</a></div></div></div><div class='para' id='bulk-6'><div class='marginalizedparent'><a class='marginalized' href='#bulk-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4253'>#</a></div><div class='texpara'><div id='bulk-6.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>unchunked_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_unchunked_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div> <div id='bulk-6.sentence-2' class='sentence'>
The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>unchunked_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>for</span> <span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span> i <span class='operator'>=</span> <span class='literal'>0</span>; i <span class='anglebracket'>&lt;</span> shape; <span class='operator'>+</span><span class='operator'>+</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>i<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div> <div id='bulk-6.sentence-3' class='sentence'>
The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause__'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above
is <span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#bulk-6.sentence-3'>.</a></div></div></div><div class='texpara'><div id='lib:impls-for<bulk_t>,check-types'><div id='lib:check-types,impls-for<bulk_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cbulk_t%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='bulk-7'><div class='marginalizedparent'><a class='marginalized' href='#bulk-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4296'>#</a></div><div class='texpara'><div id='bulk-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_value_t<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable___'><span class='tcode_in_codeblock'>invocable</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, Ts<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
cs<span class='operator'>.</span><i >for-each</i><span class='parenthesis'>(</span><i >overload-set</i><span class='parenthesis'>(</span>fn, <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#bulk-7.sentence-1'>.</a></div></div></div></div><div class='para' id='bulk-8'><div class='marginalizedparent'><a class='marginalized' href='#bulk-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4311'>#</a></div><div class='texpara'><div id='bulk-8.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#bulk-8.sentence-1'>.</a></div> <div id='bulk-8.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:</div></div><div class='texpara'><ul class='itemize'><li id='bulk-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-8.1'>(8.1)</a></div><div class='texpara'><div id='bulk-8.1.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> has a successful completion, where
<span class='texttt'>args</span> is a pack of lvalue subexpressions
referring to the value completion result datums of <span class='texttt'>sndr</span>, or
decayed copies of those values if they model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible___'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a>,
then:</div></div><div class='texpara'><ul class='itemize'><li id='bulk-8.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#bulk-8.1.1'>(8.1.1)</a></div><div class='texpara'><div id='bulk-8.1.1.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> also completes successfully, then:</div></div><div class='texpara'><ul class='itemize'><li id='bulk-8.1.1.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.1.1'>(8.1.1.1)</a></div><div class='texpara'><div id='bulk-8.1.1.1.sentence-1' class='sentence'>for <span class='texttt'>bulk</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span>
    from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>;</div></div></li><li id='bulk-8.1.1.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.1.2'>(8.1.1.2)</a></div><div class='texpara'><div id='bulk-8.1.1.2.sentence-1' class='sentence'>for <span class='texttt'>bulk_<span class='shy'></span>unchunked</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span>
    from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>;</div></div><div class='texpara'><div id='bulk-8.1.1.2.sentence-2' class='sentence'><i >Recommended practice</i>: The underlying scheduler should execute each iteration
    on a distinct execution agent<a class='hidden_link' href='#bulk-8.1.1.2.sentence-2'>.</a></div></div></li><li id='bulk-8.1.1.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.1.3'>(8.1.1.3)</a></div><div class='texpara'><div id='bulk-8.1.1.3.sentence-1' class='sentence'>for <span class='texttt'>bulk_<span class='shy'></span>chunked</span>,
    invokes <span class='texttt'>f<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>b</span></span>, <span class='math'><span class='mathalpha'>e</span></span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> zero or more times
    with pairs of <span class='math'><span class='mathalpha'>b</span></span> and <span class='math'><span class='mathalpha'>e</span></span> of type <span class='texttt'>Shape</span>
    in range [<span class='texttt'><span class='texttt'><span class='literal'>0</span></span>, <span class='texttt'>shape</span></span>],
    such that <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">&lt;</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">e</span></span></span></span></span></span> and
    for every <span class='math'><span class='mathalpha'>i</span></span> of type <span class='texttt'>Shape</span> from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>,
    there is exactly one invocation with a pair <span class='math'><span class='mathalpha'>b</span></span> and <span class='math'><span class='mathalpha'>e</span></span>,
    such that <span class='math'><span class='mathalpha'>i</span></span> is in the range [<span class='texttt'><span class='math'><span class='mathalpha'>b</span></span>, <span class='math'><span class='mathalpha'>e</span></span></span>)<a class='hidden_link' href='#bulk-8.1.1.3.sentence-1'>.</a></div></div></li></ul></div></li><li id='bulk-8.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#bulk-8.1.2'>(8.1.2)</a></div><div class='texpara'><div id='bulk-8.1.2.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> completes with <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, eptr<span class='parenthesis'>)</span></span>, then
  the asynchronous operation may invoke a subset of
  the invocations of <span class='texttt'>f</span>
  before the error completion handler is called, and
  <span class='texttt'>eptr</span> is an <span class='texttt'>exception_<span class='shy'></span>ptr</span> containing either:
    <ul class='itemize'><li id='bulk-8.1.2.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.2.1'>(8.1.2.1)</a></div>an exception thrown by an invocation of <span class='texttt'>f</span>, or</li><li id='bulk-8.1.2.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.2.2'>(8.1.2.2)</a></div>a <span class='texttt'>bad_<span class='shy'></span>alloc</span> exception if
    the implementation fails to allocate required resources, or</li><li id='bulk-8.1.2.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#bulk-8.1.2.3'>(8.1.2.3)</a></div>an exception derived from <span class='texttt'>runtime_<span class='shy'></span>error</span><a class='hidden_link' href='#bulk-8.1.2.sentence-1'>.</a></li></ul></div></div></li><li id='bulk-8.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#bulk-8.1.3'>(8.1.3)</a></div><div class='texpara'><div id='bulk-8.1.3.sentence-1' class='sentence'>If <span class='texttt'>out_<span class='shy'></span>sndr</span> completes with <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>, then
  the asynchronous operation may invoke a subset of
  the invocations of <span class='texttt'>f</span>
  before the stopped completion handler<a class='hidden_link' href='#bulk-8.1.3.sentence-1'>.</a></div></div></li></ul></div></li><li id='bulk-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-8.2'>(8.2)</a></div><div class='texpara'><div id='bulk-8.2.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> does not complete with <span class='texttt'>set_<span class='shy'></span>value</span>, then
the completion is forwarded to <span class='texttt'>recv</span><a class='hidden_link' href='#bulk-8.2.sentence-1'>.</a></div></div></li><li id='bulk-8.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#bulk-8.3'>(8.3)</a></div><div class='texpara'><div id='bulk-8.3.sentence-1' class='sentence'>For <span class='texttt'><i >bulk-algo</i></span>,
the parameter <span class='texttt'>policy</span> describes
the manner in which
the execution of the asynchronous operations corresponding to these algorithms
may be parallelized and
the manner in which
they apply <span class='texttt'>f</span><a class='hidden_link' href='#bulk-8.3.sentence-1'>.</a></div> <div id='bulk-8.3.sentence-2' class='sentence'>Permissions and requirements
on parallel algorithm element access functions (<a href='algorithms.parallel.exec' title='26.3.3&emsp;Effect of execution policies on algorithm execution'>[algorithms.<span class='shy'></span>parallel.<span class='shy'></span>exec]</a>)
apply to <span class='texttt'>f</span><a class='hidden_link' href='#bulk-8.3.sentence-2'>.</a></div></div></li></ul></div></div><div class='para nonNormativeOnly' id='bulk-9'><div class='marginalizedparent'><a class='marginalized' href='#bulk-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4401'>#</a></div><div class='texpara'><div id='bulk-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#bulk-note-2'>2</a></i>:&ensp;<div id='bulk-9.sentence-1' class='sentence'>The asynchronous operation corresponding to
<span class='texttt'><i >bulk-algo</i><span class='parenthesis'>(</span>sndr, policy, shape, f<span class='parenthesis'>)</span></span>
can complete with <span class='texttt'>set_<span class='shy'></span>stopped</span> if cancellation is requested or
ignore cancellation requests<a class='hidden_link' href='#bulk-9.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div id='when.all' class='section'><h4 ><a class='secnum' href='#when.all' style='min-width:95pt'>33.9.12.12</a> <span class='texttt'>execution&#x200b;::&#x200b;when_<span class='shy'></span>all</span> <a class='abbr_ref' href='exec.when.all'>[exec.when.all]</a></h4><div class='para' id='when.all-1'><div class='marginalizedparent'><a class='marginalized' href='#when.all-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4411'>#</a></div><div class='texpara'><div id='when.all-1.sentence-1' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span>
both adapt multiple input senders into a sender
that completes when all input senders have completed<a class='hidden_link' href='#when.all-1.sentence-1'>.</a></div> <div id='when.all-1.sentence-2' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> only accepts senders
with a single value completion signature and
on success concatenates all the input senders' value result datums
into its own value completion operation<a class='hidden_link' href='#when.all-1.sentence-2'>.</a></div> <div id='when.all-1.sentence-3' class='sentence'><span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is semantically equivalent to
w<span class='texttt'>hen_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>sndrs</span> is a pack of subexpressions
whose types model <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#when.all-1.sentence-3'>.</a></div></div></div><div class='para' id='when.all-2'><div class='marginalizedparent'><a class='marginalized' href='#when.all-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4424'>#</a></div><div class='texpara'><div id='when.all-2.sentence-1' class='sentence'>The names <span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span> denote
customization point objects<a class='hidden_link' href='#when.all-2.sentence-1'>.</a></div> <div id='when.all-2.sentence-2' class='sentence'>Let <span class='texttt'>sndrs</span> be a pack of subexpressions,
let <span class='texttt'>Sndrs</span> be a pack of the types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, and
let <span class='texttt'>CD</span> be
the type <span class='texttt'>common_<span class='shy'></span>type_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#when.all-2.sentence-2'>.</a></div> <div id='when.all-2.sentence-3' class='sentence'>Let <span class='texttt'>CD2</span> be <span class='texttt'>CD</span> if <span class='texttt'>CD</span> is well-formed, and
<span class='texttt'>default_<span class='shy'></span>domain</span> otherwise<a class='hidden_link' href='#when.all-2.sentence-3'>.</a></div> <div id='when.all-2.sentence-4' class='sentence'>The expressions <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> are ill-formed
if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='when.all-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>0</span></span>, or</li><li id='when.all-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndrs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#when.all-2.sentence-4'>.</a></li></ul></div></div></div><div class='para' id='when.all-3'><div class='marginalizedparent'><a class='marginalized' href='#when.all-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4443'>#</a></div><div class='texpara'><div id='when.all-3.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='when.all-4'><div class='marginalizedparent'><a class='marginalized' href='#when.all-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4449'>#</a></div><div class='texpara'><div id='when.all-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<when_all_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cwhen_all_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>when_all_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='when.all-5'><div class='marginalizedparent'><a class='marginalized' href='#when.all-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4469'>#</a></div><div class='texpara'><div id='when.all-5.sentence-1' class='sentence'>Let <span class='texttt'><i >make-when-all-env</i></span> be
the following exposition-only function template:
<a class='index' id='lib:make-when-all-env'></a>
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >make-when-all-env</i><span class='parenthesis'>(</span>inplace_stop_source<span class='operator'>&amp;</span> stop_src,               <span class='comment'>// <i >exposition only</i></span>
                                   Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
<span class='curlybracket'>}</span>
</span></div> <div id='when.all-5.sentence-2' class='sentence'>
Returns an object <span class='texttt'>e</span> such that
<ul class='itemize'><li id='when.all-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-5.1'>(5.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> models <a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________________________'><span class='texttt'><i >queryable</i></span></span></a>, and</li><li id='when.all-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-5.2'>(5.2)</a></div><span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >stop-src</i></span><span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and</li><li id='when.all-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-5.3'>(5.3)</a></div>given a query object <span class='texttt'>q</span>
with type other than <span class='mathit'>cv</span> <span class='texttt'>stop_<span class='shy'></span>token_<span class='shy'></span>t</span> and
whose type satisfies <span id='conceptref:forwarding-query_'><span class='texttt'><i >forwarding-query</i></span></span>,
<span class='texttt'>e<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#when.all-5.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='when.all-6'><div class='marginalizedparent'><a class='marginalized' href='#when.all-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4495'>#</a></div><div class='texpara'><div id='when.all-6.sentence-1' class='sentence'>Let <span class='texttt'><i >when-all-env</i></span> be an alias template such that
<span class='texttt'><i >when-all-env</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span></span> denotes the type
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >make-<br/>when-all-env</i></span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>inplace_<span class='shy'></span>stop_<span class='shy'></span>source<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#when.all-6.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:impls-for<when_all_t>,check-types'><div id='lib:check-types,impls-for<when_all_t>'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:check-types,impls-for%3cwhen_all_t%3e'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <span class='texttt'><i >check-types</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='when.all-7'><div class='marginalizedparent'><a class='marginalized' href='#when.all-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4507'>#</a></div><div class='texpara'><div id='when.all-7.sentence-1' class='sentence'>Let <span class='texttt'>Is</span> be the pack of integral template arguments of
the <span class='texttt'>integer_<span class='shy'></span>sequence</span> specialization denoted by
<span class='texttt'><span class='texttt'><i >indices-for</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#when.all-7.sentence-1'>.</a></div></div></div></div><div class='para' id='when.all-8'><div class='marginalizedparent'><a class='marginalized' href='#when.all-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4512'>#</a></div><div class='texpara'><div id='when.all-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Child<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span>Child, <i >when-all-env</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span>cs<span class='operator'>.</span><i >count-of</i><span class='parenthesis'>(</span>set_value<span class='parenthesis'>)</span> <span class='anglebracket'>&gt;</span><span class='operator'>=</span> <span class='literal'>2</span><span class='parenthesis'>)</span>
    <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>; <span class='comment'>// see <a href='#snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
<span class='curlybracket'>}</span>;
<span class='parenthesis'>(</span>fn<span class='operator'>.</span><span class='keyword'>template</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr, Is<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#when.all-8.sentence-1'>.</a></div></div></div></div><div class='para' id='when.all-9'><div class='marginalizedparent'><a class='marginalized' href='#when.all-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4527'>#</a></div><div class='texpara'><div id='when.all-9.sentence-1' class='sentence'><i >Throws</i>: Any exception thrown as a result of evaluating the <i >Effects</i>, or
an exception of an unspecified type
derived from <span class='texttt'>exception</span> when <span class='texttt'>CD</span> is ill-formed<a class='hidden_link' href='#when.all-9.sentence-1'>.</a></div></div></div></div><div class='para' id='when.all-10'><div class='marginalizedparent'><a class='marginalized' href='#when.all-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4534'>#</a></div><div class='texpara'><div id='when.all-10.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>CD, default_domain<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_domain, CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-11'><div class='marginalizedparent'><a class='marginalized' href='#when.all-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4548'>#</a></div><div class='texpara'><div id='when.all-11.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, State<span class='operator'>&amp;</span> state, <span class='keyword'>const</span> Receiver<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >make-when-all-env</i><span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop-src</i>, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-12'><div class='marginalizedparent'><a class='marginalized' href='#when.all-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4558'>#</a></div><div class='texpara'><div id='when.all-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;
<span class='curlybracket'>}</span>
</span>
where <span class='math'><span class='mathalpha'>e</span></span> is the expression
<span class='codeblock'>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='operator'>.</span>apply<span class='parenthesis'>(</span><i >make-state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and where <span class='texttt'><i >make-state</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>enum</span> <span class='keyword'>class</span> <i >disposition</i> <span class='curlybracket'>{</span> <i >started</i>, <i >error</i>, <i >stopped</i> <span class='curlybracket'>}</span>;             <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >make-state</i> <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sndrs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span>, Sndrs<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> sndrs<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> values_tuple <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> errors_variant <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_callback <span class='operator'>=</span> stop_callback_for_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
      <span class='keyword'>void</span> <i >arrive</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                        <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='literal'>0</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='operator'>-</span>count<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <i >complete</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

      atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >count</i><span class='curlybracket'>{</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;                   <span class='comment'>// <i >exposition only</i></span>
      inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                           <span class='comment'>// <i >exposition only</i></span>
      atomic<span class='anglebracket'>&lt;</span><i >disposition</i><span class='anglebracket'>&gt;</span> disp<span class='curlybracket'>{</span><i >disposition</i><span class='operator'>::</span><i >started</i><span class='curlybracket'>}</span>;           <span class='comment'>// <i >exposition only</i></span>
      errors_variant <i >errors</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                  <span class='comment'>// <i >exposition only</i></span>
      values_tuple <i >values</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                    <span class='comment'>// <i >exposition only</i></span>
      optional<span class='anglebracket'>&lt;</span>stop_callback<span class='anglebracket'>&gt;</span> <i >on_stop</i><span class='curlybracket'>{</span>nullopt<span class='curlybracket'>}</span>;                 <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='when.all-13'><div class='marginalizedparent'><a class='marginalized' href='#when.all-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4605'>#</a></div><div class='texpara'><div id='when.all-13.sentence-1' class='sentence'>Let <span class='texttt'><i >copy-fail</i></span> be <span class='texttt'>exception_<span class='shy'></span>ptr</span>
if decay-copying any of the child senders' result datums can potentially throw;
otherwise, <span class='texttt'><i >none-such</i></span>,
where <span class='texttt'><i >none-such</i></span> is an unspecified empty class type<a class='hidden_link' href='#when.all-13.sentence-1'>.</a></div></div></div><div class='para' id='when.all-14'><div class='marginalizedparent'><a class='marginalized' href='#when.all-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4611'>#</a></div><div class='texpara'><div id='when.all-14.sentence-1' class='sentence'>The alias <span class='texttt'>values_<span class='shy'></span>tuple</span> denotes the type
<span class='codeblock'>tuple<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndrs, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>, <i >decayed-tuple</i>, optional<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
if that type is well-formed; otherwise, <span class='texttt'>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#when.all-14.sentence-1'>.</a></div></div></div><div class='para' id='when.all-15'><div class='marginalizedparent'><a class='marginalized' href='#when.all-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4618'>#</a></div><div class='texpara'><div id='when.all-15.sentence-1' class='sentence'>The alias <span class='texttt'>errors_<span class='shy'></span>variant</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span><i >none-such</i>, <span class='texttt'><i >copy-fail</i></span>, Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
with duplicate types removed,
where <span class='texttt'>Es</span> is the pack of the decayed types
of all the child senders' possible error result datums<a class='hidden_link' href='#when.all-15.sentence-1'>.</a></div></div></div><div class='para' id='when.all-16'><div class='marginalizedparent'><a class='marginalized' href='#when.all-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4625'>#</a></div><div class='texpara'><div id='when.all-16.sentence-1' class='sentence'>The member
<span class='texttt'><span class='keyword'>void</span> <span class='texttt'><i >state-type</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span></span>
behaves as follows:
<ul class='itemize'><li id='when.all-16.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-16.1'>(16.1)</a></div>If <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >started</i></span></span>,
evaluates:
<span class='codeblock'><span class='keyword'>auto</span> tie <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> set <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
apply<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> opts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>set, tuple_cat<span class='parenthesis'>(</span>tie<span class='parenthesis'>(</span><span class='operator'>*</span>opts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  values<span class='parenthesis'>)</span>;
</span></li><li id='when.all-16.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-16.2'>(16.2)</a></div>Otherwise,
if <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >error</i></span></span>,
evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span> error<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Error, <i >none-such</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>,
  errors<span class='parenthesis'>)</span>;
</span></li><li id='when.all-16.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#when.all-16.3'>(16.3)</a></div>Otherwise, evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='when.all-17'><div class='marginalizedparent'><a class='marginalized' href='#when.all-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4666'>#</a></div><div class='texpara'><div id='when.all-17.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ops<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Ops<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
    get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >on_stop.</i>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='parenthesis'>(</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='when.all-18'><div class='marginalizedparent'><a class='marginalized' href='#when.all-18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4685'>#</a></div><div class='texpara'><div id='when.all-18.sentence-1' class='sentence'>The member <span class='texttt'><i ><span class='texttt'>impls<span class='operator'>-</span><span class='keyword'>for</span></span>&lt;when_<span class='shy'></span>all_<span class='shy'></span>t&gt;&#x200b;::&#x200b;<span class='texttt'><i >complete</i></span></i></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Set, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>this</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> complete, Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Set, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i> <span class='operator'>!</span><span class='operator'>=</span> state<span class='operator'>.</span>disp<span class='operator'>.</span>exchange<span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-ERROR</i><span class='parenthesis'>(</span>state<span class='operator'>.</span>errors, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span> expected <span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i>;
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp<span class='operator'>.</span>compare_exchange_strong<span class='parenthesis'>(</span>expected, <i >disposition</i><span class='operator'>::</span><i >stopped</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>State<span class='operator'>::</span>values<span class='parenthesis'>)</span>, tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp <span class='operator'>=</span><span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> opt <span class='operator'>=</span> get<span class='anglebracket'>&lt;</span>Index<span class='operator'>::</span>value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>state<span class='operator'>.</span>values<span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-VALUE</i><span class='parenthesis'>(</span>complete, opt, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  state<span class='operator'>.</span><i >arrive</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-ERROR</i></span><span class='parenthesis'>(</span>v, e<span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>v</span> and <span class='texttt'>e</span>, is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>exception_ptr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is potentially throwing;
otherwise, <span class='texttt'>v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>decltype<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>;
and where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-VALUE</i></span><span class='parenthesis'>(</span>c, o, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>c</span>, <span class='texttt'>o</span>, and pack of subexpressions <span class='texttt'>as</span>,
is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c<span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, state, rcvr, set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span></span>
is potentially throwing;
otherwise, <span class='texttt'>o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#when.all-18.sentence-1'>.</a></div></div></div><div class='para' id='when.all-19'><div class='marginalizedparent'><a class='marginalized' href='#when.all-19'>19</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4737'>#</a></div><div class='texpara'><div id='when.all-19.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all_with_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='when.all-20'><div class='marginalizedparent'><a class='marginalized' href='#when.all-20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4744'>#</a></div><div class='texpara'><div id='when.all-20.sentence-2' class='sentence'>Given subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if
<span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> when_all<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
<div id='when.all-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#when.all-note-1'>1</a></i>:&ensp;<div id='when.all-20.sentence-1' class='sentence'>This causes the <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> sender
to become <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span><a class='hidden_link' href='#when.all-20.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='into.variant' class='section'><h4 ><a class='secnum' href='#into.variant' style='min-width:95pt'>33.9.12.13</a> <span class='texttt'>execution&#x200b;::&#x200b;into_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.into.variant'>[exec.into.variant]</a></h4><div class='para' id='into.variant-1'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4765'>#</a></div><div class='texpara'><div id='into.variant-1.sentence-1' class='sentence'><span class='texttt'>into_<span class='shy'></span>variant</span> adapts a sender with multiple value completion signatures
into a sender with just one value completion signature
consisting of a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#into.variant-1.sentence-1'>.</a></div></div></div><div class='para' id='into.variant-2'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4770'>#</a></div><div class='texpara'><div id='into.variant-2.sentence-1' class='sentence'>The name <span class='texttt'>into_<span class='shy'></span>variant</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#into.variant-2.sentence-1'>.</a></div> <div id='into.variant-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#into.variant-2.sentence-2'>.</a></div> <div id='into.variant-2.sentence-3' class='sentence'>If <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#into.variant-2.sentence-3'>.</a></div></div></div><div class='para' id='into.variant-3'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4776'>#</a></div><div class='texpara'><div id='into.variant-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>into_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#into.variant-3.sentence-1'>.</a></div></div></div><div class='para' id='into.variant-4'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4784'>#</a></div><div class='texpara'><div id='into.variant-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>into_<span class='shy'></span>variant</span> as follows:
<span id='lib:impls-for<into_variant_t>,check-types'><span id='lib:check-types,impls-for<into_variant_t>'><span id='lib:impls-for<into_variant_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cinto_variant_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>into_variant_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span> cs <span class='operator'>=</span> get_completion_signatures<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >decay-copyable-result-datums</i><span class='parenthesis'>(</span>cs<span class='parenthesis'>)</span>;   <span class='comment'>// see <a href='#snd.expos' title='33.9.2&emsp;Exposition-only entities'>[exec.<span class='shy'></span>snd.<span class='shy'></span>expos]</a></span>
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></span></span></div></div></div><div class='para' id='into.variant-5'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4805'>#</a></div><div class='texpara'><div id='into.variant-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> type_identity<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='into.variant-6'><div class='marginalizedparent'><a class='marginalized' href='#into.variant-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4815'>#</a></div><div class='texpara'><div id='into.variant-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>auto</span>, State, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> variant_type <span class='operator'>=</span> <span class='keyword'>typename</span> State<span class='operator'>::</span>type;
    <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, variant_type<span class='parenthesis'>(</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='stopped.opt' class='section'><h4 ><a class='secnum' href='#stopped.opt' style='min-width:95pt'>33.9.12.14</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> <a class='abbr_ref' href='exec.stopped.opt'>[exec.stopped.opt]</a></h4><div class='para' id='stopped.opt-1'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4832'>#</a></div><div class='texpara'><div id='stopped.opt-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> maps a sender's stopped completion operation
into a value completion operation as a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-1'>.</a></div> <div id='stopped.opt-1.sentence-2' class='sentence'>The sender's value completion operation
is also converted into an <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-2'>.</a></div> <div id='stopped.opt-1.sentence-3' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#stopped.opt-1.sentence-3'>.</a></div></div></div><div class='para' id='stopped.opt-2'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4840'>#</a></div><div class='texpara'><div id='stopped.opt-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#stopped.opt-2.sentence-1'>.</a></div> <div id='stopped.opt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.opt-2.sentence-2'>.</a></div> <div id='stopped.opt-2.sentence-3' class='sentence'>The expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_optional, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#stopped.opt-2.sentence-3'>.</a></div></div></div><div class='para' id='stopped.opt-3'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4849'>#</a></div><div class='texpara'><div id='stopped.opt-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t</span> as follows:
<span id='lib:impls-for<stopped_as_optional_t>,check-types'><span id='lib:check-types,impls-for<stopped_as_optional_t>'><span id='lib:impls-for<stopped_as_optional_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:impls-for%3cstopped_as_optional_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>stopped_as_optional_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <i >default-impls</i><span class='operator'>::</span><i >check-types</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><span class='keyword'>requires</span> <span class='curlybracket'>{</span>
          <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>void</span>, <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>,
                                                            <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>
          <span class='keyword'>throw</span> <i >unspecified-exception</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></span></span>
where <span class='texttt'><i >unspecified-exception</i></span> is
a type derived from <span class='texttt'>exception</span><a class='hidden_link' href='#stopped.opt-3.sentence-1'>.</a></div></div></div><div class='para' id='stopped.opt-4'><div class='marginalizedparent'><a class='marginalized' href='#stopped.opt-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4872'>#</a></div><div class='texpara'><div id='stopped.opt-4.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.opt-4.sentence-1'>.</a></div> <div id='stopped.opt-4.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for________'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise,
if <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <span class='texttt'><i >FWD-ENV-T</i></span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is equivalent to <span class='texttt'><span class='texttt'><i >not-a-sender</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> V <span class='operator'>=</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
  then<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
       <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>V, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
         <span class='keyword'>return</span> optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>in_place, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
       <span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> just<span class='parenthesis'>(</span>optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='stopped.err' class='section'><h4 ><a class='secnum' href='#stopped.err' style='min-width:95pt'>33.9.12.15</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.stopped.err'>[exec.stopped.err]</a></h4><div class='para' id='stopped.err-1'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4899'>#</a></div><div class='texpara'><div id='stopped.err-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> maps an input sender's stopped completion operation
into an error completion operation as a custom error type<a class='hidden_link' href='#stopped.err-1.sentence-1'>.</a></div> <div id='stopped.err-1.sentence-2' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with an error<a class='hidden_link' href='#stopped.err-1.sentence-2'>.</a></div></div></div><div class='para' id='stopped.err-2'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4905'>#</a></div><div class='texpara'><div id='stopped.err-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#stopped.err-2.sentence-1'>.</a></div> <div id='stopped.err-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>err</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.err-2.sentence-2'>.</a></div> <div id='stopped.err-2.sentence-3' class='sentence'>If the type <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________________'><span class='texttt'>sender</span></span></a> or
if the type <span class='texttt'>Err</span> does not satisfy <a href='#concept:movable-value' title='33.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_____'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#stopped.err-2.sentence-3'>.</a></div> <div id='stopped.err-2.sentence-4' class='sentence'>Otherwise, the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_error, err, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#stopped.err-2.sentence-4'>.</a></div></div></div><div class='para' id='stopped.err-3'><div class='marginalizedparent'><a class='marginalized' href='#stopped.err-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4920'>#</a></div><div class='texpara'><div id='stopped.err-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stopped.err-3.sentence-1'>.</a></div> <div id='stopped.err-3.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_________'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>error_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, err, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> E <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
  std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>err <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> just_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='associate' class='section'><h4 ><a class='secnum' href='#associate' style='min-width:95pt'>33.9.12.16</a> <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;associate</span> <a class='abbr_ref' href='exec.associate'>[exec.associate]</a></h4><div class='para' id='associate-1'><div class='marginalizedparent'><a class='marginalized' href='#associate-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4940'>#</a></div><div class='texpara'><div id='associate-1.sentence-1' class='sentence'><span class='texttt'>associate</span> tries to associate
a sender with an async scope such that
the scope can track the lifetime of any asynchronous operations
created with the sender<a class='hidden_link' href='#associate-1.sentence-1'>.</a></div></div></div><div class='para' id='associate-2'><div class='marginalizedparent'><a class='marginalized' href='#associate-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4946'>#</a></div><div class='texpara'><div id='associate-2.sentence-1' class='sentence'>Let <span class='texttt'><i >associate-data</i></span> be the following exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::associate-data'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token_'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >associate-data</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >wrap-sender</i> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      remove_cvref_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Token<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>wrap<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>explicit</span> <i >associate-data</i><span class='parenthesis'>(</span>Token t, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> s<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >sndr</i><span class='parenthesis'>(</span>t<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>s<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >token</i><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='operator'>!</span><i >token</i><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
        <i >sndr</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >associate-data</i><span class='parenthesis'>(</span><span class='keyword'>const</span> <i >associate-data</i><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_copy_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
               <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>other<span class='operator'>.</span><i >token</i><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

    <i >associate-data</i><span class='parenthesis'>(</span><i >associate-data</i><span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

    <span class='operator'>~</span><i >associate-data</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    optional<span class='anglebracket'>&lt;</span>pair<span class='anglebracket'>&lt;</span>Token, <i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      release<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    optional<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <i >sndr</i>;  <span class='comment'>// <i >exposition only</i></span>
    Token <i >token</i>;                 <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token__'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
    <i >associate-data</i><span class='parenthesis'>(</span>Token, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >associate-data</i><span class='anglebracket'>&lt;</span>Token, Sender<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='associate-3'><div class='marginalizedparent'><a class='marginalized' href='#associate-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L4986'>#</a></div><div class='texpara'><div id='associate-3.sentence-1' class='sentence'>For an <span class='texttt'><i >associate-data</i></span> object <span class='texttt'>a</span>,
<span class='texttt'>a<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>
if and only if
an association was successfully made and is owned by <span class='texttt'>a</span><a class='hidden_link' href='#associate-3.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:execution::associate-data,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,constructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='texttt'><i >associate-data</i></span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_copy_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
           <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>other<span class='operator'>.</span><span class='texttt'><i >token</i></span><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='associate-4'><div class='marginalizedparent'><a class='marginalized' href='#associate-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5000'>#</a></div><div class='texpara'><div id='associate-4.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible____'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#associate-4.sentence-1'>.</a></div></div></div></div><div class='para' id='associate-5'><div class='marginalizedparent'><a class='marginalized' href='#associate-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5004'>#</a></div><div class='texpara'><div id='associate-5.sentence-1' class='sentence'><i >Effects</i>: Value-initializes <span class='texttt'><i >sndr</i></span> and
initializes <span class='texttt'><i >token</i></span> with <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >token</i></span></span><a class='hidden_link' href='#associate-5.sentence-1'>.</a></div> <div id='associate-5.sentence-2' class='sentence'>If <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
no further effects;
otherwise,
calls <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>try_<span class='shy'></span>associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and,
if that returns <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>emplace<span class='parenthesis'>(</span><span class='operator'>*</span>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span></span> and,
if that exits with an exception,
calls <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> before propagating the exception<a class='hidden_link' href='#associate-5.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,constructor_'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='texttt'><i >associate-data</i></span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='associate-6'><div class='marginalizedparent'><a class='marginalized' href='#associate-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5025'>#</a></div><div class='texpara'><div id='associate-6.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >sndr</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span></span> and
initializes <span class='texttt'><i >token</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>other<span class='operator'>.</span>&#x200b;<span class='texttt'><i >token</i></span><span class='parenthesis'>)</span></span> and
then calls <span class='texttt'>other<span class='operator'>.</span><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#associate-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::associate-data,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >associate-data</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='associate-7'><div class='marginalizedparent'><a class='marginalized' href='#associate-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5038'>#</a></div><div class='texpara'><div id='associate-7.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns <span class='texttt'><span class='literal'>false</span></span> then no effect;
otherwise, invokes <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
before invoking <span class='texttt'><span class='texttt'><i >token</i></span><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#associate-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::associate-data,release'><div id='lib:release,execution::associate-data'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:release,execution::associate-data'>ðŸ”—</a></div><code class='itemdeclcode'>optional<span class='anglebracket'>&lt;</span>pair<span class='anglebracket'>&lt;</span>Token, <span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
  release<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='associate-8'><div class='marginalizedparent'><a class='marginalized' href='#associate-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5052'>#</a></div><div class='texpara'><div id='associate-8.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><span class='texttt'><i >sndr</i></span><span class='operator'>.</span>has_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns <span class='texttt'><span class='literal'>false</span></span> then
returns an <span class='texttt'>optional</span> that does not contain a value;
otherwise returns an <span class='texttt'>optional</span>
containing a value of type <span class='texttt'>pair<span class='anglebracket'>&lt;</span>Token, <span class='texttt'><i >wrap-sender</i></span><span class='anglebracket'>&gt;</span></span>
as if by:
<span class='codeblock'><span class='keyword'>return</span> optional<span class='parenthesis'>(</span>pair<span class='parenthesis'>(</span><i >token</i>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >sndr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='associate-9'><div class='marginalizedparent'><a class='marginalized' href='#associate-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5063'>#</a></div><div class='texpara'><div id='associate-9.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >sndr</i></span> does not contain a value<a class='hidden_link' href='#associate-9.sentence-1'>.</a></div></div></div></div><div class='para' id='associate-10'><div class='marginalizedparent'><a class='marginalized' href='#associate-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5068'>#</a></div><div class='texpara'><div id='associate-10.sentence-1' class='sentence'>The name <span class='texttt'>associate</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#associate-10.sentence-1'>.</a></div> <div id='associate-10.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>token</span>:
<ul class='itemize'><li id='associate-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#associate-10.1'>(10.1)</a></div>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
does not satisfy <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token___'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a>, then
<span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is ill-formed.</li><li id='associate-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#associate-10.2'>(10.2)</a></div>Otherwise,
the expression <span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
                 <i >make-sender</i><span class='parenthesis'>(</span>associate, <i >associate-data</i><span class='parenthesis'>(</span>token, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once.</li></ul></div></div></div><div class='para' id='associate-11'><div class='marginalizedparent'><a class='marginalized' href='#associate-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5088'>#</a></div><div class='texpara'><div id='associate-11.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>associate_<span class='shy'></span>t</span> as follows:
<span id='lib:execution::impls-for<associate_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::impls-for%3cassociate_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>associate_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                    <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>consteval</span> <span class='keyword'>void</span> <i >check-types</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>                     <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>using</span> associate_data_t <span class='operator'>=</span> remove_cvref_t<span class='anglebracket'>&lt;</span><i >data-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
        <span class='keyword'>using</span> child_type_t <span class='operator'>=</span> <span class='keyword'>typename</span> associate_data_t<span class='operator'>::</span><i >wrap-sender</i>;
        <span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>)</span>get_completion_signatures<span class='anglebracket'>&lt;</span>child_type_t, <i >FWD-ENV-T</i><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div class='para' id='associate-12'><div class='marginalizedparent'><a class='marginalized' href='#associate-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5109'>#</a></div><div class='texpara'><div id='associate-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:</div></div><div class='texpara'><span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data<span class='squarebracket'>]</span> <span class='operator'>=</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='keyword'>auto</span> dataParts <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

  <span class='keyword'>using</span> scope_tkn <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>first<span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> wrap_sender <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>second<span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> op_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>wrap_sender, Rcvr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>struct</span> op_state <span class='curlybracket'>{</span>
    <span class='keyword'>bool</span> <i >associated</i> <span class='operator'>=</span> <span class='literal'>false</span>;    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>union</span> <span class='curlybracket'>{</span>
      Rcvr<span class='operator'>*</span> <i >rcvr</i>;               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>struct</span> <span class='curlybracket'>{</span>
        scope_tkn <i >token</i>;        <span class='comment'>// <i >exposition only</i></span>
        op_t <i >op</i>;                <span class='comment'>// <i >exposition only</i></span>
      <span class='curlybracket'>}</span> <i >assoc</i>;                  <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>explicit</span> op_state<span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>addressof<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='keyword'>explicit</span> op_state<span class='parenthesis'>(</span>scope_tkn tkn, wrap_sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span> <span class='keyword'>try</span>
      <span class='operator'>:</span> <i >associated</i><span class='parenthesis'>(</span><span class='literal'>true</span><span class='parenthesis'>)</span>,
        <i >assoc</i><span class='parenthesis'>(</span>tkn, connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='curlybracket'>}</span>
    <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      tkn<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='keyword'>throw</span>;
    <span class='curlybracket'>}</span>

    op_state<span class='parenthesis'>(</span>op_state<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

    <span class='operator'>~</span>op_state<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >associated</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <i >assoc</i><span class='operator'>.</span><i >op</i><span class='operator'>.</span><span class='operator'>~</span>op_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >assoc</i><span class='operator'>.</span><i >token</i><span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
        <i >assoc</i><span class='operator'>.</span><i >token</i><span class='operator'>.</span><span class='operator'>~</span>scope_tkn<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> <i >run</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>       <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >associated</i><span class='parenthesis'>)</span>
        start<span class='parenthesis'>(</span><i >assoc</i><span class='operator'>.</span><i >op</i><span class='parenthesis'>)</span>;
      <span class='keyword'>else</span>
        set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>if</span> <span class='parenthesis'>(</span>dataParts<span class='parenthesis'>)</span>
    <span class='keyword'>return</span> op_state<span class='curlybracket'>{</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>first<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>dataParts<span class='operator'>-</span><span class='anglebracket'>&gt;</span>second<span class='parenthesis'>)</span>, rcvr<span class='curlybracket'>}</span>;
  <span class='keyword'>else</span>
    <span class='keyword'>return</span> op_state<span class='curlybracket'>{</span>rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='associate-13'><div class='marginalizedparent'><a class='marginalized' href='#associate-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5169'>#</a></div><div class='texpara'><div id='associate-13.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span> is
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span><i >wrap-sender</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable___'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>connect_t, <i >wrap-sender</i>, Rcvr<span class='anglebracket'>&gt;</span>
</span>
where <span class='texttt'><i >wrap-sender</i></span> is the type
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >data-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >wrap-sender</i></span></span><a class='hidden_link' href='#associate-13.sentence-1'>.</a></div></div></div><div class='para' id='associate-14'><div class='marginalizedparent'><a class='marginalized' href='#associate-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5180'>#</a></div><div class='texpara'><div id='associate-14.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>associate_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >run</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='associate-15'><div class='marginalizedparent'><a class='marginalized' href='#associate-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5189'>#</a></div><div class='texpara'><div id='associate-15.sentence-1' class='sentence'>The evaluation of <span class='texttt'>associate<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span>
may cause side effects observable
via <span class='texttt'>token</span>'s associated async scope object<a class='hidden_link' href='#associate-15.sentence-1'>.</a></div></div></div></div><div id='stop.when' class='section'><h4 ><a class='secnum' href='#stop.when' style='min-width:95pt'>33.9.12.17</a> Exposition-only <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;<span class='texttt'><i >stop-when</i></span></span> <a class='abbr_ref' href='exec.stop.when'>[exec.stop.when]</a></h4><div class='para' id='stop.when-1'><div class='marginalizedparent'><a class='marginalized' href='#stop.when-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5197'>#</a></div><div class='texpara'><div id='stop.when-1.sentence-1' class='sentence'><span class='texttt'><i >stop-when</i></span> fuses an additional stop token <span class='texttt'>t</span>
into a sender so that, upon connecting to a receiver <span class='texttt'>r</span>,
the resulting operation state receives stop requests from both
<span class='texttt'>t</span> and the token returned from <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stop.when-1.sentence-1'>.</a></div></div></div><div class='para' id='stop.when-2'><div class='marginalizedparent'><a class='marginalized' href='#stop.when-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5204'>#</a></div><div class='texpara'><div id='stop.when-2.sentence-1' class='sentence'>The name <span class='texttt'><i >stop-when</i></span> denotes an exposition-only sender adaptor<a class='hidden_link' href='#stop.when-2.sentence-1'>.</a></div> <div id='stop.when-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>token</span>:
<ul class='itemize'><li id='stop.when-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stop.when-2.1'>(2.1)</a></div><div class='texpara'><div id='stop.when-2.1.sentence-1' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>
does not satisfy <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>,
then <span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#stop.when-2.1.sentence-1'>.</a></div></div></li><li id='stop.when-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stop.when-2.2'>(2.2)</a></div><div class='texpara'><div id='stop.when-2.2.sentence-1' class='sentence'>Otherwise,
if <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> models
<a href='stoptoken.concepts#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> then
<span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>&#x200b;sndr, token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sndr</span><a class='hidden_link' href='#stop.when-2.2.sentence-1'>.</a></div></div></li><li id='stop.when-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stop.when-2.3'>(2.3)</a></div><div class='texpara'><div id='stop.when-2.3.sentence-1' class='sentence'>Otherwise,
<span class='texttt'><span class='texttt'><i >stop-when</i></span><span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> returns a sender <span class='texttt'>osndr</span><a class='hidden_link' href='#stop.when-2.3.sentence-1'>.</a></div> <div id='stop.when-2.3.sentence-2' class='sentence'>If <span class='texttt'>osndr</span> is connected to a receiver <span class='texttt'>r</span>,
let <span class='texttt'>rtoken</span> be the result of <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>r<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#stop.when-2.3.sentence-2'>.</a></div></div><div class='texpara'><ul class='itemize'><li id='stop.when-2.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stop.when-2.3.1'>(2.3.1)</a></div><div class='texpara'><div id='stop.when-2.3.1.sentence-1' class='sentence'>If the type of <span class='texttt'>rtoken</span> models <a href='stoptoken.concepts#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token_'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> then
the effects of connecting <span class='texttt'>osndr</span> to <span class='texttt'>r</span>
are equivalent to
<span class='texttt'>connect<span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, token<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>)</span></span><a class='hidden_link' href='#stop.when-2.3.1.sentence-1'>.</a></div></div></li><li id='stop.when-2.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stop.when-2.3.2'>(2.3.2)</a></div><div class='texpara'><div id='stop.when-2.3.2.sentence-1' class='sentence'>Otherwise,
the effects of connecting <span class='texttt'>osndr</span> to <span class='texttt'>r</span>
are equivalent to
<span class='texttt'>connect<span class='parenthesis'>(</span>write_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, prop<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token, stoken<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>)</span></span>
where <span class='texttt'>stoken</span> is an object of
an exposition-only type <span class='texttt'><i >stoken-t</i></span> such that:
  <ul class='itemize'><li id='stop.when-2.3.2.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stop.when-2.3.2.1'>(2.3.2.1)</a></div><span class='texttt'><i >stoken-t</i></span> models <a href='stoptoken.concepts#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token__'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>;</li><li id='stop.when-2.3.2.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stop.when-2.3.2.2'>(2.3.2.2)</a></div><span class='texttt'>stoken<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
  <span class='texttt'>token<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>|</span><span class='operator'>|</span> rtoken<span class='operator'>.</span>stop_<span class='shy'></span>reques<span class='operator'>-</span><br/>ted<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;</li><li id='stop.when-2.3.2.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stop.when-2.3.2.3'>(2.3.2.3)</a></div><span class='texttt'>stoken<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
  <span class='texttt'>token<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>|</span><span class='operator'>|</span> rtoken<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>; and</li><li id='stop.when-2.3.2.4'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stop.when-2.3.2.4'>(2.3.2.4)</a></div>for types <span class='texttt'>Fn</span> and <span class='texttt'>Init</span> such that both
  <span class='texttt'><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable____'><span class='texttt'>invocable</span></span></a><span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> and
  <span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from____'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>Fn, Init<span class='anglebracket'>&gt;</span></span>
  are modeled,
  <span class='texttt'><span class='texttt'><i >stoken-t</i></span><span class='operator'>&#x200b;::&#x200b;</span>callback_<span class='shy'></span>type<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> models
  <span class='texttt'><a href='stoptoken.concepts#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>Fn, <span class='texttt'><i >stoken-t</i></span>, Init<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#stop.when-2.3.2.sentence-1'>.</a> <div class='texpara'><div id='stop.when-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stop.when-note-1'>1</a></i>:&ensp;<div id='stop.when-2.3.2.4.sentence-2' class='sentence'>For an object <span class='texttt'>fn</span> of type <span class='texttt'>Fn</span>
  constructed from a value, <span class='texttt'>init</span>, of type <span class='texttt'>Init</span>,
  registering <span class='texttt'>fn</span> using
  <span class='texttt'><span class='texttt'><i >stoken-t</i></span><span class='operator'>&#x200b;::&#x200b;</span>callback_<span class='shy'></span>type<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>stoken, init<span class='parenthesis'>)</span></span>
  results in an invocation of <span class='texttt'>fn</span> when
  a callback registered with <span class='texttt'>token</span> or <span class='texttt'>rtoken</span> would be invoked<a class='hidden_link' href='#stop.when-2.3.2.4.sentence-2'>.</a></div> <div id='stop.when-2.3.2.4.sentence-3' class='sentence'><span class='texttt'>fn</span> is invoked at most once<a class='hidden_link' href='#stop.when-2.3.2.4.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li></ul></div></div></li></ul></div></li></ul></div></div></div></div><div id='spawn.future' class='section'><h4 ><a class='secnum' href='#spawn.future' style='min-width:95pt'>33.9.12.18</a> <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;spawn_<span class='shy'></span>future</span> <a class='abbr_ref' href='exec.spawn.future'>[exec.spawn.future]</a></h4><div class='para' id='spawn.future-1'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5273'>#</a></div><div class='texpara'><div id='spawn.future-1.sentence-1' class='sentence'><span class='texttt'>spawn_<span class='shy'></span>future</span> attempts to associate the given input sender
with the given token's async scope and, on success,
eagerly starts the input sender;
the return value is a sender that, when connected and started,
completes with either
the result of the eagerly-started input sender or with
<span class='texttt'>set_<span class='shy'></span>stopped</span> if the input sender was not started<a class='hidden_link' href='#spawn.future-1.sentence-1'>.</a></div></div></div><div class='para' id='spawn.future-2'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5282'>#</a></div><div class='texpara'><div id='spawn.future-2.sentence-1' class='sentence'>The name <span class='texttt'>spawn_<span class='shy'></span>future</span> denotes a customization point object<a class='hidden_link' href='#spawn.future-2.sentence-1'>.</a></div> <div id='spawn.future-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>token</span>, and <span class='texttt'>env</span>,
<ul class='itemize'><li id='spawn.future-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-2.1'>(2.1)</a></div>let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,</li><li id='spawn.future-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-2.2'>(2.2)</a></div>let <span class='texttt'>Token</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>, and</li><li id='spawn.future-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-2.3'>(2.3)</a></div>let <span class='texttt'>Env</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#spawn.future-2.sentence-2'>.</a></li></ul></div> <div id='spawn.future-2.sentence-3' class='sentence'>
If any of
<span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>,
<span class='texttt'><a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token____'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span></span>, or
<span class='texttt'><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________________________________'><span class='texttt'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span></span>
are not satisfied,
the expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#spawn.future-2.sentence-3'>.</a></div></div></div><div class='para' id='spawn.future-3'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5297'>#</a></div><div class='texpara'><div id='spawn.future-3.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-state-base</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-state-base'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-state-base'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state-base</i>;                                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sigs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>completion_signatures<span class='anglebracket'>&lt;</span>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>  <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >variant-t</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                                    <span class='comment'>// <i >exposition only</i></span>
    <i >variant-t</i> <i >result</i>;                                               <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn.future-4'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5315'>#</a></div><div class='texpara'><div id='spawn.future-4.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be the pack of arguments to
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization provided as
a parameter to the <span class='texttt'><i >spawn-future-state-base</i></span> class template<a class='hidden_link' href='#spawn.future-4.sentence-1'>.</a></div> <div id='spawn.future-4.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template that
transforms a completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
into the tuple specialization <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#spawn.future-4.sentence-2'>.</a></div></div><div class='texpara'><ul class='itemize'><li id='spawn.future-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-4.1'>(4.1)</a></div><div class='texpara'><div id='spawn.future-4.1.sentence-1' class='sentence'>If <span class='texttt'>is_<span class='shy'></span>nothrow_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Arg<span class='anglebracket'>&gt;</span>, Arg<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
for every type <span class='texttt'>Arg</span>
in every parameter pack <span class='texttt'>Args</span>
in every completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
in <span class='texttt'>Sigs</span> then
<span class='texttt'><i >variant-t</i></span> denotes the type
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#spawn.future-4.1.sentence-1'>.</a></div></div></li><li id='spawn.future-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-4.2'>(4.2)</a></div><div class='texpara'><div id='spawn.future-4.2.sentence-1' class='sentence'>Otherwise
<span class='texttt'><i >variant-t</i></span> denotes the type
<span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='anglebracket'>&gt;</span>, tuple<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>error_<span class='shy'></span>t, exception_<span class='shy'></span>ptr<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#spawn.future-4.2.sentence-1'>.</a></div></div></li></ul></div></div><div class='para' id='spawn.future-5'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5341'>#</a></div><div class='texpara'><div id='spawn.future-5.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-receiver</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-receiver'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-receiver'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Completions<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-receiver</i> <span class='curlybracket'>{</span>                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>Completions<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >state</i>;                <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <i >set-complete</i><span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>E<span class='operator'>&amp;</span><span class='operator'>&amp;</span> e<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <i >set-complete</i><span class='anglebracket'>&lt;</span>set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >set-complete</i><span class='anglebracket'>&lt;</span>set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CPO, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> <i >set-complete</i><span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                    <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>, T<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='keyword'>try</span> <span class='curlybracket'>{</span>
          <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>CPO, T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>CPO<span class='curlybracket'>{</span><span class='curlybracket'>}</span>,
                                                                   std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>;
            <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error_t<span class='curlybracket'>{</span><span class='curlybracket'>}</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn.future-6'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5387'>#</a></div><div class='texpara'><div id='spawn.future-6.sentence-1' class='sentence'>Let <i >ssource-t</i> be an unspecified type
that models <a href='stoptoken.concepts#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source'><span class='texttt'><i >stoppable-source</i></span></span></a> and
let <span class='texttt'>ssource</span> be an lvalue of type <i >ssource-t</i><a class='hidden_link' href='#spawn.future-6.sentence-1'>.</a></div> <div id='spawn.future-6.sentence-2' class='sentence'>Let <span class='texttt'><i >stoken-t</i></span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>ssource<span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn.future-6.sentence-2'>.</a></div> <div id='spawn.future-6.sentence-3' class='sentence'>Let <span class='texttt'><i >future-spawned-sender</i></span> be the alias template:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
<span class='keyword'>using</span> <i >future-spawned-sender</i> <span class='operator'>=</span>                                   <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>decltype</span><span class='parenthesis'>(</span>write_env<span class='parenthesis'>(</span><i >stop-when</i><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span><i >stoken-t</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, declval<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div><div class='para' id='spawn.future-7'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5400'>#</a></div><div class='texpara'><div id='spawn.future-7.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-future-state</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-future-state'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-future-state'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Alloc, <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token_____'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-future-state</i>                                                 <span class='comment'>// <i >exposition only</i></span>
    <span class='operator'>:</span> <i >spawn-future-state-base</i><span class='anglebracket'>&lt;</span>completion_signatures_of_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> <i >sigs-t</i> <span class='operator'>=</span>                                                          <span class='comment'>// <i >exposition only</i></span>
      completion_signatures_of_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >receiver-t</i> <span class='operator'>=</span>                                                      <span class='comment'>// <i >exposition only</i></span>
      <i >spawn-future-receiver</i><span class='anglebracket'>&lt;</span><i >sigs-t</i><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >op-t</i> <span class='operator'>=</span>                                                            <span class='comment'>// <i >exposition only</i></span>
      connect_result_t<span class='anglebracket'>&lt;</span><i >future-spawned-sender</i><span class='anglebracket'>&lt;</span>Sender, Env<span class='anglebracket'>&gt;</span>, <i >receiver-t</i><span class='anglebracket'>&gt;</span>;

    <i >spawn-future-state</i><span class='parenthesis'>(</span>Alloc alloc, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Token token, Env env<span class='parenthesis'>)</span>    <span class='comment'>// <i >exposition only</i></span>
      <span class='operator'>:</span> <i >alloc</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>alloc<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >op</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>
          write_env<span class='parenthesis'>(</span><i >stop-when</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >ssource</i><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
          <i >receiver-t</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >token</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >associated</i><span class='parenthesis'>(</span>token<span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='parenthesis'>(</span>associated<span class='parenthesis'>)</span>
            start<span class='parenthesis'>(</span><i >op</i><span class='parenthesis'>)</span>;
          <span class='keyword'>else</span>
            set_stopped<span class='parenthesis'>(</span><i >receiver-t</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >consume</i><span class='parenthesis'>(</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver______'><span class='tcode_in_codeblock'>receiver</span></span></a> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >abandon</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> <i >alloc-t</i> <span class='operator'>=</span>                                                         <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>typename</span> allocator_traits<span class='anglebracket'>&lt;</span>Alloc<span class='anglebracket'>&gt;</span><span class='operator'>::</span><span class='keyword'>template</span> rebind_alloc<span class='anglebracket'>&lt;</span><i >spawn-future-state</i><span class='anglebracket'>&gt;</span>;

    <i >alloc-t</i> <i >alloc</i>;                                                          <span class='comment'>// <i >exposition only</i></span>
    <i >ssource-t</i> <i >ssource</i>;                                                      <span class='comment'>// <i >exposition only</i></span>
    <i >op-t</i> <i >op</i>;                                                                <span class='comment'>// <i >exposition only</i></span>
    Token <i >token</i>;                                                            <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>bool</span> <i >associated</i>;                                                        <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> <i >destroy</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                                <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn.future-8'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5448'>#</a></div><div class='texpara'><div id='spawn.future-8.sentence-1' class='sentence'>For purposes of determining the existence of a data race,
<span class='texttt'><i >complete</i></span>, <span class='texttt'><i >consume</i></span>, and <span class='texttt'><i >abandon</i></span>
behave as atomic operations (<a href='intro.multithread' title='6.10.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>)<a class='hidden_link' href='#spawn.future-8.sentence-1'>.</a></div> <div id='spawn.future-8.sentence-2' class='sentence'>These operations on a single object of a type
that is a specialization of <span class='texttt'><i >spawn-future-state</i></span>
appear to occur in a single total order<a class='hidden_link' href='#spawn.future-8.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,complete'><div id='lib:complete,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:complete,execution::spawn-future-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='spawn.future-9'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5462'>#</a></div><div class='texpara'><div id='spawn.future-9.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='spawn.future-9.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-9.1'>(9.1)</a></div>No effects if this invocation of <span class='texttt'><i >complete</i></span> happens before
an invocation of <span class='texttt'><i >consume</i></span> or <span class='texttt'><i >abandon</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>;</li><li id='spawn.future-9.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-9.2'>(9.2)</a></div>otherwise,
if an invocation of <span class='texttt'><i >consume</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> happens before
this invocation of <span class='texttt'><i >complete</i></span> then
there is a receiver, <span class='texttt'>rcvr</span>, registered and
that receiver is completed as if by <span class='texttt'><span class='texttt'><i >consume</i></span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span>;</li><li id='spawn.future-9.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-9.3'>(9.3)</a></div>otherwise,
<span class='texttt'><i >destroy</i></span> is invoked<a class='hidden_link' href='#spawn.future-9.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,consume'><div id='lib:consume,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:consume,execution::spawn-future-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >consume</i></span><span class='parenthesis'>(</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_______'><span class='texttt'>receiver</span></span></a> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='spawn.future-10'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5486'>#</a></div><div class='texpara'><div id='spawn.future-10.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='spawn.future-10.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-10.1'>(10.1)</a></div>If this invocation of <span class='texttt'><i >consume</i></span> happens before
an invocation of <span class='texttt'><i >complete</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> then
<span class='texttt'>rcvr</span> is registered to be completed when
<span class='texttt'><i >complete</i></span> is subsequently invoked on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>;</li><li id='spawn.future-10.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-10.2'>(10.2)</a></div>otherwise,
<span class='texttt'>rcvr</span> is completed as if by:
<span class='codeblock'>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='parenthesis'>)</span><span class='operator'>.</span>visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span>rcvr<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> tuple<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>remove_reference_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>tuple<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>, monostate<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      apply<span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='operator'>&amp;</span>rcvr<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> cpo, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> vals<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        cpo<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>vals<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>tuple<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,abandon'><div id='lib:abandon,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:abandon,execution::spawn-future-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >abandon</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='spawn.future-11'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5517'>#</a></div><div class='texpara'><div id='spawn.future-11.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='spawn.future-11.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-11.1'>(11.1)</a></div>If this invocation of <span class='texttt'><i >abandon</i></span> happens before
an invocation of <span class='texttt'><i >complete</i></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> then
equivalent to:
<span class='codeblock'><i >ssource</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='spawn.future-11.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#spawn.future-11.2'>(11.2)</a></div>otherwise,
<span class='texttt'><i >destroy</i></span> is invoked<a class='hidden_link' href='#spawn.future-11.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-future-state,destroy'><div id='lib:destroy,execution::spawn-future-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:destroy,execution::spawn-future-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >destroy</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='spawn.future-12'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5539'>#</a></div><div class='texpara'><div id='spawn.future-12.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> token <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >token</i><span class='parenthesis'>)</span>;
<span class='keyword'>bool</span> associated <span class='operator'>=</span> <span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >associated</i>;

<span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> alloc <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >alloc</i><span class='parenthesis'>)</span>;

  allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>destroy<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span><span class='parenthesis'>)</span>;
  allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>deallocate<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span>, <span class='literal'>1</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>if</span> <span class='parenthesis'>(</span>associated<span class='parenthesis'>)</span>
  token<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='spawn.future-13'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5558'>#</a></div><div class='texpara'><div id='spawn.future-13.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>spawn_<span class='shy'></span>future_<span class='shy'></span>t</span> as follows:</div></div><div class='texpara'><span id='lib:execution::impls-for<spawn_future_t>'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::impls-for%3cspawn_future_t%3e'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>spawn_future_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn.future-14'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5572'>#</a></div><div class='texpara'><div id='spawn.future-14.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>spawn_<span class='shy'></span>future_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >consume</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='spawn.future-15'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5581'>#</a></div><div class='texpara'><div id='spawn.future-15.sentence-1' class='sentence'>For the expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span>
let <span class='texttt'>new_<span class='shy'></span>sender</span> be the expression <span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> and
let <span class='texttt'>alloc</span> and <span class='texttt'>senv</span> be defined as follows:
<ul class='itemize'><li id='spawn.future-15.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-15.1'>(15.1)</a></div>if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span>;</li><li id='spawn.future-15.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-15.2'>(15.2)</a></div>otherwise,
if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>prop<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator, alloc<span class='parenthesis'>)</span>, env<span class='parenthesis'>)</span></span>;</li><li id='spawn.future-15.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-15.3'>(15.3)</a></div>otherwise,
<span class='texttt'>alloc</span> is <span class='texttt'>allocator<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span><a class='hidden_link' href='#spawn.future-15.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='spawn.future-16'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5602'>#</a></div><div class='texpara'><div id='spawn.future-16.sentence-1' class='sentence'>The expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span>
has the following effects:</div></div><div class='texpara'><ul class='itemize'><li id='spawn.future-16.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-16.1'>(16.1)</a></div><div class='texpara'><div id='spawn.future-16.1.sentence-1' class='sentence'>Uses <span class='texttt'>alloc</span> to allocate and construct an object <span class='texttt'>s</span> of
a type that is a specialization of <span class='texttt'><i >spawn-future-&#x200b;state</i></span>
from <span class='texttt'>alloc</span>, <span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>, <span class='texttt'>token</span>, and <span class='texttt'>senv</span><a class='hidden_link' href='#spawn.future-16.1.sentence-1'>.</a></div> <div id='spawn.future-16.1.sentence-2' class='sentence'>If an exception is thrown then
any constructed objects are destroyed and
any allocated memory is deallocated<a class='hidden_link' href='#spawn.future-16.1.sentence-2'>.</a></div></div></li><li id='spawn.future-16.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-16.2'>(16.2)</a></div><div class='texpara'><div id='spawn.future-16.2.sentence-1' class='sentence'>Constructs an object <span class='texttt'>u</span> of
a type that is a specialization of <span class='texttt'>unique_<span class='shy'></span>ptr</span> such that:
  <ul class='itemize'><li id='spawn.future-16.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#spawn.future-16.2.1'>(16.2.1)</a></div><span class='texttt'>u<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is equal to the address of <span class='texttt'>s</span>, and</li><li id='spawn.future-16.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#spawn.future-16.2.2'>(16.2.2)</a></div><span class='texttt'>u<span class='operator'>.</span>get_<span class='shy'></span>deleter<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>u<span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is equivalent to
  <span class='texttt'>u<span class='operator'>.</span>release<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >abandon</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn.future-16.2.sentence-1'>.</a></li></ul></div></div></li><li id='spawn.future-16.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn.future-16.3'>(16.3)</a></div><div class='texpara'><div id='spawn.future-16.3.sentence-1' class='sentence'>Returns <span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>spawn_<span class='shy'></span>future, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>u<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn.future-16.3.sentence-1'>.</a></div></div></li></ul></div></div><div class='para' id='spawn.future-17'><div class='marginalizedparent'><a class='marginalized' href='#spawn.future-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5630'>#</a></div><div class='texpara'><div id='spawn.future-17.sentence-1' class='sentence'>The expression <span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>spawn_<span class='shy'></span>future<span class='parenthesis'>(</span>sndr, token, execution<span class='operator'>&#x200b;::&#x200b;</span>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn.future-17.sentence-1'>.</a></div></div></div></div></div><div id='consumers' class='section'><h3 ><a class='secnum' href='#consumers' style='min-width:80pt'>33.9.13</a> Sender consumers <a class='abbr_ref' href='exec.consumers'>[exec.consumers]</a></h3><div id='sync.wait' class='section'><h4 ><a class='secnum' href='#sync.wait' style='min-width:95pt'>33.9.13.1</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait</span> <a class='abbr_ref' href='exec.sync.wait'>[exec.sync.wait]</a></h4><div class='para' id='sync.wait-1'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5638'>#</a></div><div class='texpara'><div id='sync.wait-1.sentence-1' class='sentence'><span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> and <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span>
are used
to block the current thread of execution
until the specified sender completes and
to return its async result<a class='hidden_link' href='#sync.wait-1.sentence-1'>.</a></div> <div id='sync.wait-1.sentence-2' class='sentence'><span class='texttt'>sync_<span class='shy'></span>wait</span> mandates
that the input sender has exactly one value completion signature<a class='hidden_link' href='#sync.wait-1.sentence-2'>.</a></div></div></div><div class='para' id='sync.wait-2'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5647'>#</a></div><div class='texpara'><div id='sync.wait-2.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-env</i></span> be the following exposition-only class type:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >sync-wait-env</i> <span class='curlybracket'>{</span>
    execution<span class='operator'>::</span>run_loop<span class='operator'>*</span> <i >loop</i>;                                  <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_delegation_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='sync.wait-3'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5665'>#</a></div><div class='texpara'><div id='sync.wait-3.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-result-type</i></span> and
<span class='texttt'><i >sync-wait-with-variant-result-type</i></span>
be exposition-only alias templates defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i>, <i >decayed-tuple</i>,
               type_identity_t<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-with-variant-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='sync.wait-4'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5682'>#</a></div><div class='texpara'><div id='sync.wait-4.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> denotes a customization point object<a class='hidden_link' href='#sync.wait-4.sentence-1'>.</a></div> <div id='sync.wait-4.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-4.sentence-2'>.</a></div> <div id='sync.wait-4.sentence-3' class='sentence'>The expression <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to the following,
except that <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='sync.wait-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-4.1'>(4.1)</a></div><div class='texpara'><div id='sync.wait-4.1.sentence-1' class='sentence'><span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#sync.wait-4.1.sentence-1'>.</a></div></div></li><li id='sync.wait-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-4.2'>(4.2)</a></div><div class='texpara'><div id='sync.wait-4.2.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is well-formed<a class='hidden_link' href='#sync.wait-4.2.sentence-1'>.</a></div></div></li><li id='sync.wait-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-4.3'>(4.3)</a></div><div class='texpara'><div id='sync.wait-4.3.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the <span class='texttt'>apply_<span class='shy'></span>sender</span> expression above<a class='hidden_link' href='#sync.wait-4.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='sync.wait-5'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5702'>#</a></div><div class='texpara'><div id='sync.wait-5.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-state</i></span> and <span class='texttt'><i >sync-wait-receiver</i></span>
be the following exposition-only class templates:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-state</i> <span class='curlybracket'>{</span>                                      <span class='comment'>// <i >exposition only</i></span>
    execution<span class='operator'>::</span>run_loop <i >loop</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    exception_ptr <i >error</i>;                                        <span class='comment'>// <i >exposition only</i></span>
    <i >sync-wait-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <i >result</i>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-receiver</i> <span class='curlybracket'>{</span>                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> execution<span class='operator'>::</span>receiver_t;
    <i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <i >sync-wait-env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='operator'>&amp;</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-6'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5738'>#</a></div><div class='texpara'><div id='sync.wait-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-7'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5757'>#</a></div><div class='texpara'><div id='sync.wait-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> <i >AS-EXCEPT-PTR</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='sync.wait-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#sync.wait-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sync.wait-8'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5771'>#</a></div><div class='texpara'><div id='sync.wait-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'><span class='texttt'><i >state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >loop</i></span><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-8.sentence-1'>.</a></div></div></div></div><div class='para' id='sync.wait-9'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5776'>#</a></div><div class='texpara'><div id='sync.wait-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait-9.sentence-1'>.</a></div> <div id='sync.wait-9.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to___'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>sync_<span class='shy'></span>wait<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> state;
<span class='keyword'>auto</span> op <span class='operator'>=</span> connect<span class='parenthesis'>(</span>sndr, <i >sync-wait-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='operator'>&amp;</span>state<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span>;

state<span class='operator'>.</span><i >loop</i><span class='operator'>.</span>run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  rethrow_exception<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >result</i><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='sync.wait-10'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5794'>#</a></div><div class='texpara'><div id='sync.wait-10.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is undefined unless:
<ul class='itemize'><li id='sync.wait-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-10.1'>(10.1)</a></div><div class='texpara'><div id='sync.wait-10.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.10.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#sync.wait-10.1.sentence-1'>.</a></div> <div id='sync.wait-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sync.wait-note-1'>1</a></i>:&ensp;<div id='sync.wait-10.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait</span> achieves
forward progress guarantee delegation by providing a <span class='texttt'>run_<span class='shy'></span>loop</span> scheduler
via the <span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> query
on the <span class='texttt'><i >sync-wait-receiver</i></span>'s environment<a class='hidden_link' href='#sync.wait-10.1.sentence-2'>.</a></div> <div id='sync.wait-10.1.sentence-3' class='sentence'>The <span class='texttt'>run_<span class='shy'></span>loop</span> is driven by the current thread of execution<a class='hidden_link' href='#sync.wait-10.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='sync.wait-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait-10.2'>(10.2)</a></div><div class='texpara'><div id='sync.wait-10.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='sync.wait-10.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.1'>(10.2.1)</a></div><div class='texpara'><div id='sync.wait-10.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in
a <span class='texttt'>tuple</span> in an engaged <span class='texttt'>optional</span> object<a class='hidden_link' href='#sync.wait-10.2.1.sentence-1'>.</a></div></div></li><li id='sync.wait-10.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.2'>(10.2.2)</a></div><div class='texpara'><div id='sync.wait-10.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#sync.wait-10.2.2.sentence-1'>.</a></div></div></li><li id='sync.wait-10.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait-10.2.3'>(10.2.3)</a></div><div class='texpara'><div id='sync.wait-10.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#sync.wait-10.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div><div id='sync.wait.var' class='section'><h4 ><a class='secnum' href='#sync.wait.var' style='min-width:95pt'>33.9.13.2</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.sync.wait.var'>[exec.sync.wait.var]</a></h4><div class='para' id='sync.wait.var-1'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5824'>#</a></div><div class='texpara'><div id='sync.wait.var-1.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> denotes
a customization point object<a class='hidden_link' href='#sync.wait.var-1.sentence-1'>.</a></div> <div id='sync.wait.var-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sync.wait.var-1.sentence-2'>.</a></div> <div id='sync.wait.var-1.sentence-3' class='sentence'>The expression <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to the following,
except <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait_with_variant, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='sync.wait.var-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-1.1'>(1.1)</a></div><div class='texpara'><div id='sync.wait.var-1.1.sentence-1' class='sentence'><span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#sync.wait.var-1.1.sentence-1'>.</a></div></div></li><li id='sync.wait.var-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-1.2'>(1.2)</a></div><div class='texpara'><div id='sync.wait.var-1.2.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>
is well-formed<a class='hidden_link' href='#sync.wait.var-1.2.sentence-1'>.</a></div></div></li><li id='sync.wait.var-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-1.3'>(1.3)</a></div><div class='texpara'><div id='sync.wait.var-1.3.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the <span class='texttt'>apply_<span class='shy'></span>sender</span> expression above<a class='hidden_link' href='#sync.wait.var-1.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='sync.wait.var-2'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5847'>#</a></div><div class='texpara'><div id='sync.wait.var-2.sentence-1' class='sentence'>The expression <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#sync.wait.var-2.sentence-1'>.</a></div> <div id='sync.wait.var-2.sentence-2' class='sentence'>Otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>using</span> result_type <span class='operator'>=</span> <i >sync-wait-with-variant-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span> opt_value <span class='operator'>=</span> sync_wait<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>0</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span>opt_value<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>nullopt<span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='sync.wait.var-3'><div class='marginalizedparent'><a class='marginalized' href='#sync.wait.var-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5858'>#</a></div><div class='texpara'><div id='sync.wait.var-3.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is undefined unless:
<ul class='itemize'><li id='sync.wait.var-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-3.1'>(3.1)</a></div><div class='texpara'><div id='sync.wait.var-3.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.10.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#sync.wait.var-3.1.sentence-1'>.</a></div> <div id='sync.wait.var-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#sync.wait.var-note-1'>1</a></i>:&ensp;<div id='sync.wait.var-3.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> achieves
forward progress guarantee delegation by relying on
the forward progress guarantee delegation provided by <span class='texttt'>sync_<span class='shy'></span>wait</span><a class='hidden_link' href='#sync.wait.var-3.1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='sync.wait.var-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#sync.wait.var-3.2'>(3.2)</a></div><div class='texpara'><div id='sync.wait.var-3.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='sync.wait.var-3.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.1'>(3.2.1)</a></div><div class='texpara'><div id='sync.wait.var-3.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in an engaged <span class='texttt'>optional</span> object
that contains a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#sync.wait.var-3.2.1.sentence-1'>.</a></div></div></li><li id='sync.wait.var-3.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.2'>(3.2.2)</a></div><div class='texpara'><div id='sync.wait.var-3.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#sync.wait.var-3.2.2.sentence-1'>.</a></div></div></li><li id='sync.wait.var-3.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#sync.wait.var-3.2.3'>(3.2.3)</a></div><div class='texpara'><div id='sync.wait.var-3.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#sync.wait.var-3.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div><div id='spawn' class='section'><h4 ><a class='secnum' href='#spawn' style='min-width:95pt'>33.9.13.3</a> <span class='texttt'>std&#x200b;::&#x200b;execution&#x200b;::&#x200b;spawn</span> <a class='abbr_ref' href='exec.spawn'>[exec.spawn]</a></h4><div class='para' id='spawn-1'><div class='marginalizedparent'><a class='marginalized' href='#spawn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5887'>#</a></div><div class='texpara'><div id='spawn-1.sentence-1' class='sentence'><span class='texttt'>spawn</span> attempts to associate the given input sender with
the given token's async scope and, on success,
eagerly starts the input sender<a class='hidden_link' href='#spawn-1.sentence-1'>.</a></div></div></div><div class='para' id='spawn-2'><div class='marginalizedparent'><a class='marginalized' href='#spawn-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5892'>#</a></div><div class='texpara'><div id='spawn-2.sentence-1' class='sentence'>The name <span class='texttt'>spawn</span> denotes a customization point object<a class='hidden_link' href='#spawn-2.sentence-1'>.</a></div> <div id='spawn-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>token</span>, and <span class='texttt'>env</span>,
<ul class='itemize'><li id='spawn-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-2.1'>(2.1)</a></div>let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,</li><li id='spawn-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-2.2'>(2.2)</a></div>let <span class='texttt'>Token</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>token<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>, and</li><li id='spawn-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-2.3'>(2.3)</a></div>let <span class='texttt'>Env</span> be <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#spawn-2.sentence-2'>.</a></li></ul></div> <div id='spawn-2.sentence-3' class='sentence'>
If any of
<span class='texttt'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>,
<span class='texttt'><a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token______'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span></span>, or
<span class='texttt'><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________________________________'><span class='texttt'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span></span>
are not satisfied,
the expression <span class='texttt'>spawn<span class='parenthesis'>(</span>&#x200b;sndr, token, env<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#spawn-2.sentence-3'>.</a></div></div></div><div class='para' id='spawn-3'><div class='marginalizedparent'><a class='marginalized' href='#spawn-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5907'>#</a></div><div class='texpara'><div id='spawn-3.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-state-base</i></span> be the exposition-only class:</div></div><div class='texpara'><span id='lib:execution::spawn-state-base'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-state-base'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >spawn-state-base</i> <span class='curlybracket'>{</span>                                 <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                   <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn-4'><div class='marginalizedparent'><a class='marginalized' href='#spawn-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5919'>#</a></div><div class='texpara'><div id='spawn-4.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-receiver</i></span> be the exposition-only class:</div></div><div class='texpara'><span id='lib:execution::spawn-receiver'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-receiver'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >spawn-receiver</i> <span class='curlybracket'>{</span>                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <i >spawn-state-base</i><span class='operator'>*</span> <i >state</i>;                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='spawn-5'><div class='marginalizedparent'><a class='marginalized' href='#spawn-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5935'>#</a></div><div class='texpara'><div id='spawn-5.sentence-1' class='sentence'>Let <span class='texttt'><i >spawn-state</i></span> be the exposition-only class template:</div></div><div class='texpara'><span id='lib:execution::spawn-state'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-state'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Alloc, <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token_______'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></a> Token, <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >spawn-state</i> <span class='operator'>:</span> <i >spawn-state-base</i> <span class='curlybracket'>{</span>                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >op-t</i> <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>Sender, <i >spawn-receiver</i><span class='anglebracket'>&gt;</span>;  <span class='comment'>// <i >exposition only</i></span>

    <i >spawn-state</i><span class='parenthesis'>(</span>Alloc alloc, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Token token<span class='parenthesis'>)</span>;   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >run</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                                             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> <i >alloc-t</i> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>typename</span> allocator_traits<span class='anglebracket'>&lt;</span>Alloc<span class='anglebracket'>&gt;</span><span class='operator'>::</span><span class='keyword'>template</span> rebind_alloc<span class='anglebracket'>&lt;</span><i >spawn-state</i><span class='anglebracket'>&gt;</span>;

    <i >alloc-t</i> <i >alloc</i>;                                          <span class='comment'>// <i >exposition only</i></span>
    <i >op-t</i> <i >op</i>;                                                <span class='comment'>// <i >exposition only</i></span>
    Token <i >token</i>;                                            <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> <i >destroy</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='texpara'><div id='lib:execution::spawn-state,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::spawn-state,constructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >spawn-state</i></span><span class='parenthesis'>(</span>Alloc alloc, Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Token token<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='spawn-6'><div class='marginalizedparent'><a class='marginalized' href='#spawn-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5968'>#</a></div><div class='texpara'><div id='spawn-6.sentence-1' class='sentence'><i >Effects</i>: Initializes
<span class='texttt'><i >alloc</i></span> with <span class='texttt'>alloc</span>,
<span class='texttt'><i >token</i></span> with <span class='texttt'>token</span>, and
<span class='texttt'><i >op</i></span> with:
<span class='codeblock'>connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >spawn-receiver</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-state,run'><div id='lib:run,execution::spawn-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run,execution::spawn-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >run</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='spawn-7'><div class='marginalizedparent'><a class='marginalized' href='#spawn-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L5985'>#</a></div><div class='texpara'><div id='spawn-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span><i >token</i><span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
  start<span class='parenthesis'>(</span><i >op</i><span class='parenthesis'>)</span>;
<span class='keyword'>else</span>
  <i >destroy</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-state,complete'><div id='lib:complete,execution::spawn-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:complete,execution::spawn-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;
</code></div></div></div></div><div class='para' id='spawn-8'><div class='marginalizedparent'><a class='marginalized' href='#spawn-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6002'>#</a></div><div class='texpara'><div id='spawn-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> token <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >token</i><span class='parenthesis'>)</span>;

<i >destroy</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
token<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:execution::spawn-state,destroy'><div id='lib:destroy,execution::spawn-state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:destroy,execution::spawn-state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >destroy</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='spawn-9'><div class='marginalizedparent'><a class='marginalized' href='#spawn-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6019'>#</a></div><div class='texpara'><div id='spawn-9.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span> alloc <span class='operator'>=</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >alloc</i><span class='parenthesis'>)</span>;

allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>destroy<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span><span class='parenthesis'>)</span>;
allocator_traits<span class='anglebracket'>&lt;</span><i >alloc-t</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>deallocate<span class='parenthesis'>(</span>alloc, <span class='keyword'>this</span>, <span class='literal'>1</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='spawn-10'><div class='marginalizedparent'><a class='marginalized' href='#spawn-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6030'>#</a></div><div class='texpara'><div id='spawn-10.sentence-1' class='sentence'>For the expression <span class='texttt'>spawn<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span>
let <span class='texttt'>new_<span class='shy'></span>sender</span> be the expression <span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> and
let <span class='texttt'>alloc</span> and <span class='texttt'>senv</span> be defined as follows:
<ul class='itemize'><li id='spawn-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-10.1'>(10.1)</a></div>if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span>,</li><li id='spawn-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-10.2'>(10.2)</a></div>otherwise
if the expression <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is well-formed, then
<span class='texttt'>alloc</span> is the result of <span class='texttt'>get_<span class='shy'></span>allocator<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>new_<span class='shy'></span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>prop<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator, alloc<span class='parenthesis'>)</span>, env<span class='parenthesis'>)</span></span>,</li><li id='spawn-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-10.3'>(10.3)</a></div>otherwise
<span class='texttt'>alloc</span> is <span class='texttt'>allocator<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>senv</span> is the expression <span class='texttt'>env</span><a class='hidden_link' href='#spawn-10.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='spawn-11'><div class='marginalizedparent'><a class='marginalized' href='#spawn-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6050'>#</a></div><div class='texpara'><div id='spawn-11.sentence-1' class='sentence'>The expression <span class='texttt'>spawn<span class='parenthesis'>(</span>sndr, token, env<span class='parenthesis'>)</span></span> is of type <span class='texttt'><span class='keyword'>void</span></span> and
has the following effects:
<ul class='itemize'><li id='spawn-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#spawn-11.1'>(11.1)</a></div>Uses <span class='texttt'>alloc</span> to allocate and construct an object <span class='texttt'>o</span> of
type that is a specialization of <span class='texttt'><span class='texttt'><i >spawn-state</i></span></span> from
<span class='texttt'>alloc</span>, <span class='texttt'>write_<span class='shy'></span>env<span class='parenthesis'>(</span>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, senv<span class='parenthesis'>)</span></span>, and <span class='texttt'>token</span>
and then
invokes <span class='texttt'>o<span class='operator'>.</span><span class='texttt'><i >run</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn-11.sentence-1'>.</a> <div class='texpara'><div id='spawn-11.1.sentence-2' class='sentence'>If an exception is thrown then
any constructed objects are destroyed and any allocated memory is deallocated<a class='hidden_link' href='#spawn-11.1.sentence-2'>.</a></div></div></li></ul></div></div></div><div class='para' id='spawn-12'><div class='marginalizedparent'><a class='marginalized' href='#spawn-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6065'>#</a></div><div class='texpara'><div id='spawn-12.sentence-1' class='sentence'>The expression <span class='texttt'>spawn<span class='parenthesis'>(</span>sndr, token<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>spawn<span class='parenthesis'>(</span>sndr, token, execution<span class='operator'>&#x200b;::&#x200b;</span>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>&#x200b;<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#spawn-12.sentence-1'>.</a></div></div></div></div></div></div><div id='cmplsig' class='section'><h2 ><a class='secnum' href='#cmplsig' style='min-width:65pt'>33.10</a> Completion signatures <a class='abbr_ref' href='exec.cmplsig'>[exec.cmplsig]</a></h2><div class='para' id='cmplsig-1'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6071'>#</a></div><div class='texpara'><div id='cmplsig-1.sentence-1' class='sentence'><span class='texttt'>completion_<span class='shy'></span>signatures</span> is a type
that encodes a set of completion signatures (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#cmplsig-1.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='cmplsig-2'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6075'>#</a></div><div class='texpara'><div id='cmplsig-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#cmplsig-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> my_sender <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
  <span class='keyword'>using</span> completion_signatures <span class='operator'>=</span>
    execution<span class='operator'>::</span>completion_signatures<span class='anglebracket'>&lt;</span>
      set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>,
      set_value_t<span class='parenthesis'>(</span><span class='keyword'>int</span>, <span class='keyword'>float</span><span class='parenthesis'>)</span>,
      set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
      set_error_t<span class='parenthesis'>(</span>error_code<span class='parenthesis'>)</span>,
      set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>;
</span> <div id='cmplsig-2.sentence-1' class='sentence'>
Declares <span class='texttt'>my_<span class='shy'></span>sender</span> to be a sender
that can complete by calling one of the following
for a receiver expression <span class='texttt'>rcvr</span>:
<ul class='itemize'><li id='cmplsig-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-2.1'>(2.1)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span></li><li id='cmplsig-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-2.2'>(2.2)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, <span class='keyword'>int</span><span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span>, <span class='keyword'>float</span><span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='cmplsig-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-2.3'>(2.3)</a></div><span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, exception_<span class='shy'></span>ptr<span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='cmplsig-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-2.4'>(2.4)</a></div><span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, error_<span class='shy'></span>code<span class='curlybracket'>{</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li><li id='cmplsig-2.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-2.5'>(2.5)</a></div><span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span></li></ul></div> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='cmplsig-3'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6101'>#</a></div><div class='texpara'><div id='cmplsig-3.sentence-1' class='sentence'>This subclause makes use of the following exposition-only entities:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:completion-signature' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='concept:completion-signature'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
</span></div></div></div><div class='para' id='cmplsig-4'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6108'>#</a></div><div class='texpara'><div id='cmplsig-4.sentence-1' class='sentence'>A type <span class='texttt'>Fn</span> satisfies <a href='#concept:completion-signature' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='conceptref:completion-signature__'><span class='texttt'><i >completion-signature</i></span></span></a>
if and only if it is a function type with one of the following forms:
<ul class='itemize'><li id='cmplsig-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-4.1'>(4.1)</a></div><div class='texpara'><div id='cmplsig-4.1.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>Vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>Vs</span> is a pack of object or reference types<a class='hidden_link' href='#cmplsig-4.1.sentence-1'>.</a></div></div></li><li id='cmplsig-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-4.2'>(4.2)</a></div><div class='texpara'><div id='cmplsig-4.2.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>,
where <span class='texttt'>Err</span> is an object or reference type<a class='hidden_link' href='#cmplsig-4.2.sentence-1'>.</a></div></div></li><li id='cmplsig-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#cmplsig-4.3'>(4.3)</a></div><div class='texpara'><div id='cmplsig-4.3.sentence-1' class='sentence'><span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></div></div></li></ul></div></div></div><div class='para' id='cmplsig-5'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6122'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >indirect-meta-apply</i> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >meta-apply</i> <span class='operator'>=</span> T<span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;                              <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:always-true' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='concept:always-true'><span class='tcode_in_codeblock'><i >always-true</i></span></span></a> <span class='operator'>=</span> <span class='literal'>true</span>;                                   <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag,
         <a href='#concept:valid-completion-signatures' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:valid-completion-signatures____'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> Completions,
         <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple,
         <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >gather-signatures</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
</span></div></div><div class='para' id='cmplsig-6'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6140'>#</a></div><div class='texpara'><div id='cmplsig-6.sentence-1' class='sentence'>Let <span class='texttt'>Fns</span> be a pack of the arguments of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by <span class='texttt'>Completions</span>,
let <span class='texttt'>TagFns</span> be a pack of the function types in <span class='texttt'>Fns</span>
whose return types are <span class='texttt'>Tag</span>, and
let <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">Ts</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> be a pack of the function argument types
in the <span class='math'><span class='mathalpha'>n</span></span>-th type in <span class='texttt'>TagFns</span><a class='hidden_link' href='#cmplsig-6.sentence-1'>.</a></div> <div id='cmplsig-6.sentence-2' class='sentence'>Then, given two variadic templates <span class='texttt'>Tuple</span> and <span class='texttt'>Variant</span>,
the type <span class='texttt'><span class='texttt'><i >gather-signatures</i></span><span class='anglebracket'>&lt;</span>Tag, Completions, Tuple, Variant<span class='anglebracket'>&gt;</span></span>
names the type
<span class='codeblock'><i >META-APPLY</i><span class='parenthesis'>(</span>Variant, <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
                    <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
                    &hellip;,
                    <i >META-APPLY</i><span class='parenthesis'>(</span>Tuple, Ts<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">m</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
where <span class='math'><span class='mathalpha'>m</span></span> is the size of the pack <span class='texttt'>TagFns</span> and
<span class='texttt'>META<span class='operator'>-</span>APPLY<span class='parenthesis'>(</span>T, As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>typename</span> <i >indirect-meta-apply</i><span class='anglebracket'>&lt;</span><i >always-true</i><span class='anglebracket'>&lt;</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><span class='keyword'>template</span> <i >meta-apply</i><span class='anglebracket'>&lt;</span>T, As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para nonNormativeOnly' id='cmplsig-7'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6162'>#</a></div><div class='texpara'><div id='cmplsig-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#cmplsig-note-1'>1</a></i>:&ensp;<div id='cmplsig-7.sentence-1' class='sentence'>The purpose of <span class='texttt'><i >META-APPLY</i></span> is to make it valid
to use non-variadic templates as <span class='texttt'>Variant</span> and <span class='texttt'>Tuple</span> arguments
to <span class='texttt'><i >gather-signatures</i></span><a class='hidden_link' href='#cmplsig-7.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='cmplsig-8'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6169'>#</a></div><div class='texpara'><span id='lib:execution::completion_signatures,count-of'><span id='lib:count-of,execution::completion_signatures'><span id='lib:execution::completion_signatures,for-each'><span id='lib:for-each,execution::completion_signatures'><span id='lib:execution::completion_signatures'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::completion_signatures'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:completion-signature' title='33.10&emsp;Completion signatures&emsp;[exec.cmplsig]'><span id='conceptref:completion-signature___'><span class='tcode_in_codeblock'><i >completion-signature</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Fns<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> completion_signatures <span class='curlybracket'>{</span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
        <span class='keyword'>static</span> <span class='keyword'>constexpr</span> size_t <i >count-of</i><span class='parenthesis'>(</span>Tag<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>; <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
        <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>void</span> <i >for-each</i><span class='parenthesis'>(</span>Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>               <span class='comment'>// <i >exposition only</i></span>
          <span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Fns<span class='operator'>*</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='literal'>nullptr</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Tuple <span class='operator'>=</span> <i >decayed-tuple</i>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> value_types_of_t <span class='operator'>=</span>
      <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_value_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>, Tuple, Variant<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
           <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> Variant <span class='operator'>=</span> <i >variant-or-empty</i><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> error_types_of_t <span class='operator'>=</span>
      <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_error_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
                        type_identity_t, Variant<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> sends_stopped <span class='operator'>=</span>
      <span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><i >type-list</i><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>,
               <i >gather-signatures</i><span class='anglebracket'>&lt;</span>set_stopped_t, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>,
                                 <i >type-list</i>, <i >type-list</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></span></span></span></span></div></div><div class='para' id='cmplsig-9'><div class='marginalizedparent'><a class='marginalized' href='#cmplsig-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6209'>#</a></div><div class='texpara'><div id='cmplsig-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>tag</span>,
let <span class='texttt'>Tag</span> be the decayed type of <span class='texttt'>tag</span><a class='hidden_link' href='#cmplsig-9.sentence-1'>.</a></div> <div id='cmplsig-9.sentence-2' class='sentence'><span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>Fns<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >count-of</i></span><span class='parenthesis'>(</span><br/>tag<span class='parenthesis'>)</span></span>
returns the count of function types in <span class='texttt'>Fns<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> that
are of the form <span class='texttt'>Tag<span class='parenthesis'>(</span>Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> where <span class='texttt'>Ts</span> is a pack of types<a class='hidden_link' href='#cmplsig-9.sentence-2'>.</a></div></div></div></div><div id='envs' class='section'><h2 ><a class='secnum' href='#envs' style='min-width:65pt'>33.11</a> Queryable utilities <a class='abbr_ref' href='exec.envs'>[exec.envs]</a></h2><div id='prop' class='section'><h3 ><a class='secnum' href='#prop' style='min-width:80pt'>33.11.1</a> Class template <span class='texttt'>prop</span> <a class='abbr_ref' href='exec.prop'>[exec.prop]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span id='lib:prop'><a class='hidden_link' href='#lib:prop' title='33.11.1&emsp;Class template prop&emsp;[exec.prop]'>prop</a></span> <span class='curlybracket'>{</span>
    QueryTag <i >query_</i>;            <span class='comment'>// <i >exposition only</i></span>
    ValueType <i >value_</i>;           <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>constexpr</span> <span class='keyword'>const</span> ValueType<span class='operator'>&amp;</span> query<span class='parenthesis'>(</span>QueryTag<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >value_</i>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag, <span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
    prop<span class='parenthesis'>(</span>QueryTag, ValueType<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> prop<span class='anglebracket'>&lt;</span>QueryTag, unwrap_reference_t<span class='anglebracket'>&lt;</span>ValueType<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='prop-1'><div class='marginalizedparent'><a class='marginalized' href='#prop-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6237'>#</a></div><div class='texpara'><div id='prop-1.sentence-1' class='sentence'>Class template <span class='texttt'>prop</span> is for building a queryable object
from a query object and a value<a class='hidden_link' href='#prop-1.sentence-1'>.</a></div></div></div><div class='para' id='prop-2'><div class='marginalizedparent'><a class='marginalized' href='#prop-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6241'>#</a></div><div class='texpara'><div id='prop-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable______'><span class='texttt'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>QueryTag, <span class='texttt'><i >prop-like</i></span><span class='anglebracket'>&lt;</span>ValueType<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is modeled,
where <span class='texttt'><i >prop-like</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> ValueType<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >prop-like</i> <span class='curlybracket'>{</span>              <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>const</span> ValueType<span class='operator'>&amp;</span> query<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para nonNormativeOnly' id='prop-3'><div class='marginalizedparent'><a class='marginalized' href='#prop-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6253'>#</a></div><div class='texpara'><div id='prop-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#prop-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
sender <span class='keyword'>auto</span> parameterize_work<span class='parenthesis'>(</span>Sndr sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='comment'>// Make an environment such that <span class='tcode_in_codeblock'>get_<span class='shy'></span>allocator(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>alloc{}</span>.</span>
  <span class='keyword'>auto</span> e <span class='operator'>=</span> prop<span class='parenthesis'>(</span>get_allocator, my_alloc<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;

  <span class='comment'>// Parameterize the input sender so that it will use our custom execution environment.</span>
  <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>sndr, e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='prop-4'><div class='marginalizedparent'><a class='marginalized' href='#prop-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6267'>#</a></div><div class='texpara'><div id='prop-4.sentence-1' class='sentence'>Specializations of <span class='texttt'>prop</span> are not assignable<a class='hidden_link' href='#prop-4.sentence-1'>.</a></div></div></div></div><div id='env' class='section'><h3 ><a class='secnum' href='#env' style='min-width:80pt'>33.11.2</a> Class template <span class='texttt'>env</span> <a class='abbr_ref' href='exec.env'>[exec.env]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:queryable' title='33.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________________________________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span id='lib:env'><a class='hidden_link' href='#lib:env' title='33.11.2&emsp;Class template env&emsp;[exec.env]'>env</a></span> <span class='curlybracket'>{</span>
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>;               <span class='comment'>// <i >exposition only</i></span>
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>;               <span class='comment'>// <i >exposition only</i></span>
      &#8942;
    Envs<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span> <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span>;           <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
      <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> query<span class='parenthesis'>(</span>QueryTag q<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Envs<span class='anglebracket'>&gt;</span>
    env<span class='parenthesis'>(</span>Envs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> env<span class='anglebracket'>&lt;</span>unwrap_reference_t<span class='anglebracket'>&lt;</span>Envs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='env-1'><div class='marginalizedparent'><a class='marginalized' href='#env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6290'>#</a></div><div class='texpara'><div id='env-1.sentence-1' class='sentence'>The class template <span class='texttt'>env</span> is used to construct a queryable object
from several queryable objects<a class='hidden_link' href='#env-1.sentence-1'>.</a></div> <div id='env-1.sentence-2' class='sentence'>Query invocations on the resulting object are resolved
by attempting to query each subobject in lexical order<a class='hidden_link' href='#env-1.sentence-2'>.</a></div></div></div><div class='para' id='env-2'><div class='marginalizedparent'><a class='marginalized' href='#env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6296'>#</a></div><div class='texpara'><div id='env-2.sentence-1' class='sentence'>Specializations of <span class='texttt'>env</span> are not assignable<a class='hidden_link' href='#env-2.sentence-1'>.</a></div></div></div><div class='para' id='env-3'><div class='marginalizedparent'><a class='marginalized' href='#env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6299'>#</a></div><div class='texpara'><div id='env-3.sentence-1' class='sentence'>It is unspecified
whether <span class='texttt'>env</span> supports initialization
using a parenthesized <a href='expr.post.general#nt:expression-list' title='7.6.1.1&emsp;General&emsp;[expr.post.general]'><span id='ntref:expression-list'><span class='textsf'><i >expression-list</i></span></span></a> (<a href='dcl.init' title='9.5&emsp;Initializers'>[dcl.<span class='shy'></span>init]</a>),
unless the <a href='expr.post.general#nt:expression-list' title='7.6.1.1&emsp;General&emsp;[expr.post.general]'><span id='ntref:expression-list_'><span class='textsf'><i >expression-list</i></span></span></a> consist of
a single element of type (possibly const) <span class='texttt'>env</span><a class='hidden_link' href='#env-3.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='env-4'><div class='marginalizedparent'><a class='marginalized' href='#env-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6306'>#</a></div><div class='texpara'><div id='env-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#env-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr<span class='anglebracket'>&gt;</span>
sender <span class='keyword'>auto</span> parameterize_work<span class='parenthesis'>(</span>Sndr sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='comment'>// Make an environment such that:</span>
  <span class='comment'>//   <span class='tcode_in_codeblock'>get_<span class='shy'></span>allocator(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>alloc{}</span></span>
  <span class='comment'>//   <span class='tcode_in_codeblock'>get_<span class='shy'></span>scheduler(env)</span> returns a reference to a copy of <span class='tcode_in_codeblock'>my_<span class='shy'></span>sched{}</span></span>
  <span class='keyword'>auto</span> e <span class='operator'>=</span> env<span class='curlybracket'>{</span>prop<span class='parenthesis'>(</span>get_allocator, my_alloc<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
               prop<span class='parenthesis'>(</span>get_scheduler, my_sched<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='curlybracket'>}</span>;

  <span class='comment'>// Parameterize the input sender so that it will use our custom execution environment.</span>
  <span class='keyword'>return</span> write_env<span class='parenthesis'>(</span>sndr, e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='texpara'><div id='lib:env,query'><div id='lib:query,env'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:query,env'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> query<span class='parenthesis'>(</span>QueryTag q<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='env-5'><div class='marginalizedparent'><a class='marginalized' href='#env-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6330'>#</a></div><div class='texpara'><div id='env-5.sentence-1' class='sentence'>Let <a href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='conceptref:has-query'><span class='texttt'><i >has-query</i></span></span></a> be the following exposition-only concept:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env, <span class='keyword'>class</span> QueryTag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='concept:has-query'><span class='tcode_in_codeblock'><i >has-query</i></span></span></a> <span class='operator'>=</span>                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      env<span class='operator'>.</span>query<span class='parenthesis'>(</span>QueryTag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;
</span></div></div></div></div><div class='para' id='env-6'><div class='marginalizedparent'><a class='marginalized' href='#env-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6340'>#</a></div><div class='texpara'><div id='env-6.sentence-1' class='sentence'>Let <span class='texttt'><i >fe</i></span> be the first element of
<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>, <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, <span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom textit"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-type-R" style="padding-top: 0.225em; padding-bottom: 0.298em;">envs</span></span></span></span><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-texatom"><span class="mjx-mrow"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">âˆ’</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span>
such that the expression <span class='texttt'><span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#env-6.sentence-1'>.</a></div></div></div></div><div class='para' id='env-7'><div class='marginalizedparent'><a class='marginalized' href='#env-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6345'>#</a></div><div class='texpara'><div id='env-7.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><span class='parenthesis'>(</span><a href='#concept:has-query' title='33.11.2&emsp;Class template env&emsp;[exec.env]'><span id='conceptref:has-query_'><span class='texttt'><i >has-query</i></span></span></a><span class='anglebracket'>&lt;</span>Envs, QueryTag<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#env-7.sentence-1'>.</a></div></div></div></div><div class='para' id='env-8'><div class='marginalizedparent'><a class='marginalized' href='#env-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6349'>#</a></div><div class='texpara'><div id='env-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> <span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span>;</span></div></div></div></div><div class='para' id='env-9'><div class='marginalizedparent'><a class='marginalized' href='#env-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6353'>#</a></div><div class='texpara'><div id='env-9.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is equivalent
to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='texttt'><i >fe</i></span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#env-9.sentence-1'>.</a></div></div></div></div></div></div><div id='ctx' class='section'><h2 ><a class='secnum' href='#ctx' style='min-width:65pt'>33.12</a> Execution contexts <a class='abbr_ref' href='exec.ctx'>[exec.ctx]</a></h2><div id='run.loop' class='section'><h3 ><a class='secnum' href='#run.loop' style='min-width:80pt'>33.12.1</a> <span class='texttt'>execution&#x200b;::&#x200b;run_<span class='shy'></span>loop</span> <a class='abbr_ref' href='exec.run.loop'>[exec.run.loop]</a></h3><div id='run.loop.general' class='section'><h4 ><a class='secnum' href='#run.loop.general' style='min-width:95pt'>33.12.1.1</a> General <a class='abbr_ref' href='exec.run.loop.general'>[exec.run.loop.general]</a></h4><div class='para' id='run.loop.general-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6365'>#</a></div><div class='texpara'><div id='run.loop.general-1.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> is an execution resource on which work can be scheduled<a class='hidden_link' href='#run.loop.general-1.sentence-1'>.</a></div> <div id='run.loop.general-1.sentence-2' class='sentence'>It maintains a thread-safe first-in-first-out queue of work<a class='hidden_link' href='#run.loop.general-1.sentence-2'>.</a></div> <div id='run.loop.general-1.sentence-3' class='sentence'>Its <span class='texttt'>run</span> member function removes elements from the queue and
executes them in a loop on the thread of execution that calls <span class='texttt'>run</span><a class='hidden_link' href='#run.loop.general-1.sentence-3'>.</a></div></div></div><div class='para' id='run.loop.general-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6371'>#</a></div><div class='texpara'><div id='run.loop.general-2.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated <a class='hidden_link' href='#def:count' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:count'><i >count</i></span></a>
that corresponds to the number of work items that are in its queue<a class='hidden_link' href='#run.loop.general-2.sentence-1'>.</a></div> <div id='run.loop.general-2.sentence-2' class='sentence'>Additionally, a <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated state
that can be one of
<a class='hidden_link' href='#def:starting' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:starting'><i >starting</i></span></a>, <a class='hidden_link' href='#def:running' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:running'><i >running</i></span></a>, <a class='hidden_link' href='#def:finishing' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finishing'><i >finishing</i></span></a>, or <a class='hidden_link' href='#def:finished' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finished'><i >finished</i></span></a><a class='hidden_link' href='#run.loop.general-2.sentence-2'>.</a></div></div></div><div class='para' id='run.loop.general-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6378'>#</a></div><div class='texpara'><div id='run.loop.general-3.sentence-1' class='sentence'>Concurrent invocations of the member functions of <span class='texttt'>run_<span class='shy'></span>loop</span>
other than <span class='texttt'>run</span> and its destructor do not introduce data races<a class='hidden_link' href='#run.loop.general-3.sentence-1'>.</a></div> <div id='run.loop.general-3.sentence-2' class='sentence'>The member functions
<span class='texttt'><i >pop-front</i></span>, <span class='texttt'><i >push-back</i></span>, and <span class='texttt'>finish</span>
execute atomically<a class='hidden_link' href='#run.loop.general-3.sentence-2'>.</a></div></div></div><div class='para' id='run.loop.general-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6385'>#</a></div><div class='texpara'><div id='run.loop.general-4.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use an intrusive queue of operation states
to hold the work units to make scheduling allocation-free<a class='hidden_link' href='#run.loop.general-4.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:run_loop'><a class='hidden_link' href='#lib:run_loop' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'>run_loop</a></span> <span class='curlybracket'>{</span>
    <span class='comment'>// <a href='#run.loop.types' title='33.12.1.2&emsp;Associated types'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>types]</a>, associated types</span>
    <span class='keyword'>class</span> <i >run-loop-scheduler</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>class</span> <i >run-loop-sender</i>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>struct</span> <i >run-loop-opstate-base</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='literal'>0</span>;                               <span class='comment'>// <i >exposition only</i></span>
      run_loop<span class='operator'>*</span> <i >loop</i>;                                           <span class='comment'>// <i >exposition only</i></span>
      <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >next</i>;                              <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >run-loop-opstate</i> <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

    <span class='comment'>// <a href='#run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >push-back</i><span class='parenthesis'>(</span><i >run-loop-opstate-base</i><span class='operator'>*</span><span class='parenthesis'>)</span>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#run.loop.ctor' title='33.12.1.3&emsp;Constructor and destructor'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>ctor]</a>, constructor and destructor</span>
    run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    run_loop<span class='parenthesis'>(</span>run_loop<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='#run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-scheduler</i> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='run.loop.types' class='section'><h4 ><a class='secnum' href='#run.loop.types' style='min-width:95pt'>33.12.1.2</a> Associated types <a class='abbr_ref' href='exec.run.loop.types'>[exec.run.loop.types]</a></h4><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-scheduler</i></span>;
</code></div></div><div class='para' id='run.loop.types-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6428'>#</a></div><div class='texpara'><div id='run.loop.types-1.sentence-1' class='sentence'><span class='texttt'><i >run-loop-scheduler</i></span> is an unspecified type
that models <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler________________'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#run.loop.types-1.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6432'>#</a></div><div class='texpara'><div id='run.loop.types-2.sentence-1' class='sentence'>Instances of <span class='texttt'><i >run-loop-scheduler</i></span> remain valid
until the end of the lifetime of the <span class='texttt'>run_<span class='shy'></span>loop</span> instance
from which they were obtained<a class='hidden_link' href='#run.loop.types-2.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6437'>#</a></div><div class='texpara'><div id='run.loop.types-3.sentence-1' class='sentence'>Two instances of <span class='texttt'><i >run-loop-scheduler</i></span> compare equal
if and only if they were obtained from the same <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.types-3.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6441'>#</a></div><div class='texpara'><div id='run.loop.types-4.sentence-1' class='sentence'>Let <span class='texttt'><i >sch</i></span> be an expression of type <span class='texttt'><i >run-loop-scheduler</i></span><a class='hidden_link' href='#run.loop.types-4.sentence-1'>.</a></div> <div id='run.loop.types-4.sentence-2' class='sentence'>The expression <span class='texttt'>schedule<span class='parenthesis'>(</span><span class='texttt'><i >sch</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><i >run-loop-<br>sender</i></span> and
is not potentially-throwing if <span class='texttt'><i >sch</i></span> is not potentially-throwing<a class='hidden_link' href='#run.loop.types-4.sentence-2'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-sender</i></span>;
</code></div></div><div class='para' id='run.loop.types-5'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6451'>#</a></div><div class='texpara'><div id='run.loop.types-5.sentence-1' class='sentence'><span class='texttt'><i >run-loop-sender</i></span> is an exposition-only type
that satisfies <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#run.loop.types-5.sentence-1'>.</a></div> <div id='run.loop.types-5.sentence-2' class='sentence'><span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >run-<br/>loop-sender</i></span><span class='anglebracket'>&gt;</span></span> is
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='run.loop.types-6'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6459'>#</a></div><div class='texpara'><div id='run.loop.types-6.sentence-1' class='sentence'>An instance of <span class='texttt'><i >run-loop-sender</i></span> remains valid
until the end of the lifetime of its associated <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.types-6.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-7'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6463'>#</a></div><div class='texpara'><div id='run.loop.types-7.sentence-1' class='sentence'>Let <span class='texttt'><i >sndr</i></span> be an expression of type <span class='texttt'><i >run-loop-sender</i></span>,
let <span class='texttt'><i >rcvr</i></span> be an expression
such that <span class='texttt'><a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of_____'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, CS<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
where <span class='texttt'>CS</span> is the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization above<a class='hidden_link' href='#run.loop.types-7.sentence-1'>.</a></div> <div id='run.loop.types-7.sentence-2' class='sentence'>Let <span class='texttt'>C</span> be either <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#run.loop.types-7.sentence-2'>.</a></div> <div id='run.loop.types-7.sentence-3' class='sentence'>Then:
<ul class='itemize'><li id='run.loop.types-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-7.1'>(7.1)</a></div><div class='texpara'><div id='run.loop.types-7.1.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span>, <span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
and is potentially-throwing if and only if
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is potentially-throwing<a class='hidden_link' href='#run.loop.types-7.1.sentence-1'>.</a></div></div></li><li id='run.loop.types-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-7.2'>(7.2)</a></div><div class='texpara'><div id='run.loop.types-7.2.sentence-1' class='sentence'>The expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>C<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is potentially-throwing if and only if <span class='texttt'><i >sndr</i></span> is potentially-throwing,
has type <span class='texttt'><i >run-loop-scheduler</i></span>, and
compares equal to the <span class='texttt'><i >run-loop-<br>scheduler</i></span> instance
from which <span class='texttt'><i >sndr</i></span> was obtained<a class='hidden_link' href='#run.loop.types-7.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.types-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.types-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span class='texttt'><i >run-loop-opstate</i></span>;
</code></div></div><div class='para' id='run.loop.types-8'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6489'>#</a></div><div class='texpara'><div id='run.loop.types-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>
inherits privately and unambiguously from <span class='texttt'><i >run-loop-opstate-base</i></span><a class='hidden_link' href='#run.loop.types-8.sentence-1'>.</a></div></div></div><div class='para' id='run.loop.types-9'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.types-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6493'>#</a></div><div class='texpara'><div id='run.loop.types-9.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>o</span></span> be a non-const lvalue of type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>,
and let <span class='texttt'>REC<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> be a non-const lvalue reference to an instance of type <span class='texttt'>Rcvr</span>
that was initialized with the expression <span class='texttt'><i >rcvr</i></span>
passed to the invocation of connect that returned <span class='math'><span class='mathalpha'>o</span></span><a class='hidden_link' href='#run.loop.types-9.sentence-1'>.</a></div> <div id='run.loop.types-9.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='run.loop.types-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.1'>(9.1)</a></div>The object to which <span class='texttt'><span class='texttt'><i >REC</i></span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> refers
remains valid for the lifetime of the object to which <span class='math'><span class='mathalpha'>o</span></span> refers.</li><li id='run.loop.types-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.2'>(9.2)</a></div>The type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> overrides
<span class='texttt'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
such that <span class='texttt'><span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span>get_stop_token<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li><li id='run.loop.types-9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#run.loop.types-9.3'>(9.3)</a></div>The expression <span class='texttt'>start<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >push-back</i><span class='parenthesis'>(</span>addressof<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li></ul></div></div></div></div><div id='run.loop.ctor' class='section'><h4 ><a class='secnum' href='#run.loop.ctor' style='min-width:95pt'>33.12.1.3</a> Constructor and destructor <a class='abbr_ref' href='exec.run.loop.ctor'>[exec.run.loop.ctor]</a></h4><div class='texpara'><div id='lib:run_loop,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='run.loop.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6533'>#</a></div><div class='texpara'><div id='run.loop.ctor-1.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >count</i></span> is <span class='texttt'><span class='literal'>0</span></span> and <span class='texttt'><i >state</i></span> is <span class='texttt'><i >starting</i></span><a class='hidden_link' href='#run.loop.ctor-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='run.loop.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6544'>#</a></div><div class='texpara'><div id='run.loop.ctor-2.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >count</i></span> is not <span class='texttt'><span class='literal'>0</span></span> or if <span class='texttt'><i >state</i></span> is <span class='texttt'><i >running</i></span>,
invokes <span class='texttt'>terminate</span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#run.loop.ctor-2.sentence-1'>.</a></div> <div id='run.loop.ctor-2.sentence-2' class='sentence'>Otherwise, has no effects<a class='hidden_link' href='#run.loop.ctor-2.sentence-2'>.</a></div></div></div></div></div><div id='run.loop.members' class='section'><h4 ><a class='secnum' href='#run.loop.members' style='min-width:95pt'>33.12.1.4</a> Member functions <a class='abbr_ref' href='exec.run.loop.members'>[exec.run.loop.members]</a></h4><div class='texpara'><div class='itemdecl' id='run.loop.members-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.members-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> <span class='texttt'><i >pop-front</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='run.loop.members-1'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6558'>#</a></div><div class='texpara'><div id='run.loop.members-1.sentence-1' class='sentence'><i >Effects</i>: Blocks (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>) until one of the following conditions is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='run.loop.members-1.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#run.loop.members-1.1'>(1.1)</a></div><span class='texttt'><i >count</i></span> is <span class='texttt'><span class='literal'>0</span></span> and <span class='texttt'><i >state</i></span> is <span class='texttt'><i >finishing</i></span>,
in which case <span class='texttt'><i >pop-front</i></span> sets <span class='texttt'><i >state</i></span> to <span class='texttt'><i >finished</i></span>
and returns <span class='texttt'><span class='literal'>nullptr</span></span>; or</li><li id='run.loop.members-1.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#run.loop.members-1.2'>(1.2)</a></div><span class='texttt'><i >count</i></span> is greater than <span class='texttt'><span class='literal'>0</span></span>,
in which case an item is removed from the front of the queue,
<span class='texttt'><i >count</i></span> is decremented by <span class='texttt'><span class='literal'>1</span></span>, and
the removed item is returned<a class='hidden_link' href='#run.loop.members-1.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='run.loop.members-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#run.loop.members-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >push-back</i></span><span class='parenthesis'>(</span><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> item<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='run.loop.members-2'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6579'>#</a></div><div class='texpara'><div id='run.loop.members-2.sentence-1' class='sentence'><i >Effects</i>: Adds <span class='texttt'>item</span> to the back of the queue and
increments <span class='texttt'><i >count</i></span> by <span class='texttt'><span class='literal'>1</span></span><a class='hidden_link' href='#run.loop.members-2.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-3'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6584'>#</a></div><div class='texpara'><div id='run.loop.members-3.sentence-1' class='sentence'><i >Synchronization</i>: This operation synchronizes with
the <span class='texttt'><i >pop-front</i></span> operation that obtains <span class='texttt'>item</span><a class='hidden_link' href='#run.loop.members-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,get_scheduler'><div id='lib:get_scheduler,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_scheduler,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-scheduler</i></span> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-4'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6596'>#</a></div><div class='texpara'><div id='run.loop.members-4.sentence-1' class='sentence'><i >Returns</i>: An instance of <span class='texttt'><i >run-loop-scheduler</i></span>
that can be used to schedule work onto this <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#run.loop.members-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,run'><div id='lib:run,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-5'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6608'>#</a></div><div class='texpara'><div id='run.loop.members-5.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><i >state</i></span> is either <span class='texttt'><i >starting</i></span> or <span class='texttt'><i >finishing</i></span><a class='hidden_link' href='#run.loop.members-5.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-6'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6612'>#</a></div><div class='texpara'><div id='run.loop.members-6.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >state</i></span> is <span class='texttt'><i >starting</i></span>,
sets the <span class='texttt'><i >state</i></span> to <span class='texttt'><i >running</i></span>,
otherwise leaves <span class='texttt'><i >state</i></span> unchanged<a class='hidden_link' href='#run.loop.members-6.sentence-1'>.</a></div> <div id='run.loop.members-6.sentence-2' class='sentence'>Then, equivalent to:
<span class='codeblock'><span class='keyword'>while</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>*</span> op <span class='operator'>=</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div class='para' id='run.loop.members-7'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6624'>#</a></div><div class='texpara'><div id='run.loop.members-7.sentence-1' class='sentence'><i >Remarks</i>: When <span class='texttt'><i >state</i></span> changes, it does so without introducing data races<a class='hidden_link' href='#run.loop.members-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,finish'><div id='lib:finish,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:finish,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='run.loop.members-8'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6635'>#</a></div><div class='texpara'><div id='run.loop.members-8.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><i >state</i></span> is either <span class='texttt'><i >starting</i></span> or <span class='texttt'><i >running</i></span><a class='hidden_link' href='#run.loop.members-8.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-9'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6639'>#</a></div><div class='texpara'><div id='run.loop.members-9.sentence-1' class='sentence'><i >Effects</i>: Changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >finishing</i></span><a class='hidden_link' href='#run.loop.members-9.sentence-1'>.</a></div></div></div></div><div class='para' id='run.loop.members-10'><div class='marginalizedparent'><a class='marginalized' href='#run.loop.members-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6643'>#</a></div><div class='texpara'><div id='run.loop.members-10.sentence-1' class='sentence'><i >Synchronization</i>: <span class='texttt'>finish</span> synchronizes with the <span class='texttt'><i >pop-front</i></span> operation
that returns <span class='texttt'><span class='literal'>nullptr</span></span><a class='hidden_link' href='#run.loop.members-10.sentence-1'>.</a></div></div></div></div></div></div></div><div id='coro.util' class='section'><h2 ><a class='secnum' href='#coro.util' style='min-width:65pt'>33.13</a> Coroutine utilities <a class='abbr_ref' href='exec.coro.util'>[exec.coro.util]</a></h2><div id='as.awaitable' class='section'><h3 ><a class='secnum' href='#as.awaitable' style='min-width:80pt'>33.13.1</a> <span class='texttt'>execution&#x200b;::&#x200b;as_<span class='shy'></span>awaitable</span> <a class='abbr_ref' href='exec.as.awaitable'>[exec.as.awaitable]</a></h3><div class='para' id='as.awaitable-1'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6653'>#</a></div><div class='texpara'><div id='as.awaitable-1.sentence-1' class='sentence'><span class='texttt'>as_<span class='shy'></span>awaitable</span> transforms an object into one
that is awaitable within a particular coroutine<a class='hidden_link' href='#as.awaitable-1.sentence-1'>.</a></div> <div id='as.awaitable-1.sentence-2' class='sentence'>Subclause <a href='#coro.util' title='33.13&emsp;Coroutine utilities'>[exec.<span class='shy'></span>coro.<span class='shy'></span>util]</a> makes use of
the following exposition-only entities:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:awaitable-sender' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable&emsp;[exec.as.awaitable]'><span id='concept:awaitable-sender'><span class='tcode_in_codeblock'><i >awaitable-sender</i></span></span></a> <span class='operator'>=</span>
      <a href='#concept:single-sender' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:single-sender__'><span class='tcode_in_codeblock'><i >single-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='#concept:sender_to' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <i >awaitable-receiver</i><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>    <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> p<span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.convertible#concept:convertible_to' title='18.4.4&emsp;Concept convertible_&shy;to&emsp;[concept.convertible]'><span id='conceptref:convertible_to'><span class='tcode_in_codeblock'>convertible_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-queryable-await-completion-adaptor' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable&emsp;[exec.as.awaitable]'><span id='concept:has-queryable-await-completion-adaptor'><span class='tcode_in_codeblock'><i >has-queryable-await-completion-adaptor</i></span></span></a> <span class='operator'>=</span>            <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sender<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        get_await_completion_adaptor<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>sender<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> <i >sender-awaitable</i>;                                     <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='as.awaitable-2'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6680'>#</a></div><div class='texpara'><div id='as.awaitable-2.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sender-awaitable</i></span><span class='anglebracket'>&lt;</span>Sndr, Promise<span class='anglebracket'>&gt;</span></span> is equivalent to:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> <i >sender-awaitable</i> <span class='curlybracket'>{</span>
    <span class='keyword'>struct</span> <i >unit</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >value-type</i> <span class='operator'>=</span>                                          <span class='comment'>// <i >exposition only</i></span>
      <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>using</span> <i >result-type </i><span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      conditional_t<span class='anglebracket'>&lt;</span>is_void_v<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span>, unit, <i >value-type</i><span class='anglebracket'>&gt;</span>;
    <span class='keyword'>struct</span> <i >awaitable-receiver</i>;                                  <span class='comment'>// <i >exposition only</i></span>

    variant<span class='anglebracket'>&lt;</span>monostate, <i >result-type</i>, exception_ptr<span class='anglebracket'>&gt;</span> <i >result</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;    <span class='comment'>// <i >exposition only</i></span>
    connect_result_t<span class='anglebracket'>&lt;</span>Sndr, <i >awaitable-receiver</i><span class='anglebracket'>&gt;</span> <i >state</i>;           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <i >sender-awaitable</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> start<span class='parenthesis'>(</span><i >state</i><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <i >value-type</i> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='as.awaitable-3'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6706'>#</a></div><div class='texpara'><div id='as.awaitable-3.sentence-1' class='sentence'><span class='texttt'><i >awaitable-receiver</i></span> is equivalent to:
<span class='codeblock'><span class='keyword'>struct</span> <i >awaitable-receiver</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
  variant<span class='anglebracket'>&lt;</span>monostate, <i >result-type</i>, exception_ptr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >result-ptr</i>;   <span class='comment'>// <i >exposition only</i></span>
  coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span> <i >continuation</i>;                       <span class='comment'>// <i >exposition only</i></span>
  <span class='comment'>// <i ><span class='texttt'>see below</span></i></span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='as.awaitable-4'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6717'>#</a></div><div class='texpara'><div id='as.awaitable-4.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be an rvalue expression of type <span class='texttt'><i >awaitable-receiver</i></span>,
let <span class='texttt'>crcvr</span> be a const lvalue that refers to <span class='texttt'>rcvr</span>,
let <span class='texttt'>vs</span> be a pack of subexpressions, and
let <span class='texttt'>err</span> be an expression of type <span class='texttt'>Err</span><a class='hidden_link' href='#as.awaitable-4.sentence-1'>.</a></div> <div id='as.awaitable-4.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='as.awaitable-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.1'>(4.1)</a></div>If <span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_____'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span><span class='texttt'><i >result-type</i></span>, <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>vs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
is satisfied,
the expression <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span><br>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>1</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span> <div class='texpara'><div id='as.awaitable-4.1.sentence-2' class='sentence'>
Otherwise, <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>rcvr, vs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#as.awaitable-4.1.sentence-2'>.</a></div></div></li><li id='as.awaitable-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.2'>(4.2)</a></div>The expression <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>rcvr, err<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'>rcvr<span class='operator'>.</span><i >result-ptr</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >AS-EXCEPT-PTR</i><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// see <a href='#general' title='33.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='as.awaitable-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.3'>(4.3)</a></div>The expression <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></li><li id='as.awaitable-4.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-4.4'>(4.4)</a></div>For any expression <span class='texttt'>tag</span>
whose type satisfies <a href='#concept:forwarding-query' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:forwarding-query__'><span class='texttt'><i >forwarding-query</i></span></span></a> and
for any pack of subexpressions <span class='texttt'>as</span>,
<span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>crcvr<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>tag, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>tag<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>as_const<span class='parenthesis'>(</span>crcvr<span class='operator'>.</span><i >continuation</i><span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></li></ul></div></div></div><div class='texpara'><div class='itemdecl' id='as.awaitable-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#as.awaitable-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >sender-awaitable</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='as.awaitable-5'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6762'>#</a></div><div class='texpara'><div id='as.awaitable-5.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >state</i></span> with
<span class='codeblock'>connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
        <i >awaitable-receiver</i><span class='curlybracket'>{</span>addressof<span class='parenthesis'>(</span>result<span class='parenthesis'>)</span>, coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_promise<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='as.awaitable-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#as.awaitable-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >value-type</i></span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='as.awaitable-6'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6776'>#</a></div><div class='texpara'><div id='as.awaitable-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span><i >result</i><span class='operator'>.</span>index<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>2</span><span class='parenthesis'>)</span>
  rethrow_exception<span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >result</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span>is_void_v<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span><i >value-type</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>1</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >result</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='as.awaitable-7'><div class='marginalizedparent'><a class='marginalized' href='#as.awaitable-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6787'>#</a></div><div class='texpara'><div id='as.awaitable-7.sentence-1' class='sentence'><span class='texttt'>as_<span class='shy'></span>awaitable</span> is a customization point object<a class='hidden_link' href='#as.awaitable-7.sentence-1'>.</a></div> <div id='as.awaitable-7.sentence-2' class='sentence'>For subexpressions <span class='texttt'>expr</span> and <span class='texttt'>p</span>
where <span class='texttt'>p</span> is an lvalue,
<span class='texttt'>Expr</span> names the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Promise</span> names the type <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>expr, p<span class='parenthesis'>)</span></span> is expression-equivalent to,
except that the evaluations of <span class='texttt'>expr</span> and <span class='texttt'>p</span>
are indeterminately sequenced:
<ul class='itemize'><li id='as.awaitable-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.1'>(7.1)</a></div><div class='texpara'><div id='as.awaitable-7.1.sentence-1' class='sentence'><span class='texttt'>expr<span class='operator'>.</span>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span></span> if that expression is well-formed<a class='hidden_link' href='#as.awaitable-7.1.sentence-1'>.</a></div></div><div class='texpara'><div id='as.awaitable-7.1.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable____'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>A, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
where <span class='texttt'>A</span> is the type of the expression above<a class='hidden_link' href='#as.awaitable-7.1.sentence-2'>.</a></div></div></li><li id='as.awaitable-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.2'>(7.2)</a></div><div class='texpara'><div id='as.awaitable-7.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span>
if <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable_____'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, U<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
where <span class='texttt'>U</span> is an unspecified class type
that is not <span class='texttt'>Promise</span> and
that lacks a member named <span class='texttt'>await_<span class='shy'></span>transform</span><a class='hidden_link' href='#as.awaitable-7.2.sentence-1'>.</a></div></div><div class='texpara'><div id='as.awaitable-7.2.sentence-2' class='sentence'><i >Preconditions</i>: <span class='texttt'><a href='#concept:is-awaitable' title='33.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable______'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span> and
the expression <span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span> expr</span>
in a coroutine with promise type <span class='texttt'>U</span> is expression-equivalent to
the same expression in a coroutine with promise type <span class='texttt'>Promise</span><a class='hidden_link' href='#as.awaitable-7.2.sentence-2'>.</a></div></div></li><li id='as.awaitable-7.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.3'>(7.3)</a></div><div class='texpara'><div id='as.awaitable-7.3.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >sender-awaitable</i></span><span class='curlybracket'>{</span><span class='texttt'><i >adapted-expr</i></span>, p<span class='curlybracket'>}</span></span>
if
<span class='codeblock'><i >has-queryable-await-completion-adaptor</i><span class='anglebracket'>&lt;</span>Expr<span class='anglebracket'>&gt;</span>
</span>
and
<span class='codeblock'><i >awaitable-sender</i><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><i >adapted-expr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, Promise<span class='anglebracket'>&gt;</span><span class='curlybracket'>}</span>
</span>
are both satisfied, where <span class='texttt'><i >adapted-expr</i></span> is
<span class='texttt'>get_<span class='shy'></span>await_<span class='shy'></span>completion_<span class='shy'></span>adaptor<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>expr<span class='parenthesis'>)</span></span>,
except that <span class='texttt'>expr</span> is evaluated only once<a class='hidden_link' href='#as.awaitable-7.3.sentence-1'>.</a></div></div></li><li id='as.awaitable-7.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.4'>(7.4)</a></div><div class='texpara'><div id='as.awaitable-7.4.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >sender-awaitable</i></span><span class='curlybracket'>{</span>expr, p<span class='curlybracket'>}</span></span>
if <span class='texttt'><a href='#concept:awaitable-sender' title='33.13.1&emsp;execution&#x200b;::&#x200b;as_&shy;awaitable&emsp;[exec.as.awaitable]'><span id='conceptref:awaitable-sender'><span class='texttt'><i >awaitable-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Expr, Promise<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#as.awaitable-7.4.sentence-1'>.</a></div></div></li><li id='as.awaitable-7.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#as.awaitable-7.5'>(7.5)</a></div><div class='texpara'><div id='as.awaitable-7.5.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#as.awaitable-7.5.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='with.awaitable.senders' class='section'><h3 ><a class='secnum' href='#with.awaitable.senders' style='min-width:80pt'>33.13.2</a> <span class='texttt'>execution&#x200b;::&#x200b;with_<span class='shy'></span>awaitable_<span class='shy'></span>senders</span> <a class='abbr_ref' href='exec.with.awaitable.senders'>[exec.with.awaitable.senders]</a></h3><div class='para' id='with.awaitable.senders-1'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6837'>#</a></div><div class='texpara'><div id='with.awaitable.senders-1.sentence-1' class='sentence'><span class='texttt'>with_<span class='shy'></span>awaitable_<span class='shy'></span>senders</span>,
when used as the base class of a coroutine promise type,
makes senders awaitable in that coroutine type<a class='hidden_link' href='#with.awaitable.senders-1.sentence-1'>.</a></div></div><div class='texpara'><div id='with.awaitable.senders-1.sentence-2' class='sentence'>In addition, it provides a default implementation of <span class='texttt'>unhandled_<span class='shy'></span>stopped</span>
such that if a sender completes by calling <span class='texttt'>set_<span class='shy'></span>stopped</span>,
it is treated as if an uncatchable "stopped" exception were thrown
from the <a href='expr.await#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_'><span class='textsf'><i >await-expression</i></span></span></a><a class='hidden_link' href='#with.awaitable.senders-1.sentence-2'>.</a></div> <div id='with.awaitable.senders-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#with.awaitable.senders-note-1'>1</a></i>:&ensp;<div id='with.awaitable.senders-1.sentence-3' class='sentence'>The coroutine is never resumed, and
the <span class='texttt'>unhandled_<span class='shy'></span>stopped</span> of the coroutine caller's promise type is called<a class='hidden_link' href='#with.awaitable.senders-1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type__'><span class='tcode_in_codeblock'><i >class-type</i></span></span></a> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <span id='lib:with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>with_awaitable_senders</a></span> <span class='curlybracket'>{</span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OtherPromise<span class='anglebracket'>&gt;</span>
        <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>OtherPromise, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
      <span class='keyword'>void</span> set_continuation<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span id='lib:with_awaitable_senders,continuation'><span id='lib:continuation,with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders,continuation' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>continuation</a></span></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <i >continuation</i>; <span class='curlybracket'>}</span>

      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span id='lib:with_awaitable_senders,unhandled_stopped'><span id='lib:unhandled_stopped,with_awaitable_senders'><a class='hidden_link' href='#lib:with_awaitable_senders,unhandled_stopped' title='33.13.2&emsp;execution&#x200b;::&#x200b;with_&shy;awaitable_&shy;senders&emsp;[exec.with.awaitable.senders]'>unhandled_stopped</a></span></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >stopped-handler</i><span class='parenthesis'>(</span><i >continuation</i><span class='operator'>.</span>address<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Value<span class='anglebracket'>&gt;</span>
      <i ><span class='texttt'>see below</span></i> await_transform<span class='parenthesis'>(</span>Value<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>;

    <span class='keyword'>private</span><span class='operator'>:</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>static</span> coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
        <i >default-unhandled-stopped</i><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>             <span class='comment'>// <i >exposition only</i></span>
        terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <i >continuation</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                        <span class='comment'>// <i >exposition only</i></span>
      coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='parenthesis'>(</span><span class='operator'>*</span><i >stopped-handler</i><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span>   <span class='comment'>// <i >exposition only</i></span>
        <span class='operator'>&amp;</span><i >default-unhandled-stopped</i>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='lib:with_awaitable_senders,set_continuation'><div id='lib:set_continuation,with_awaitable_senders'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_continuation,with_awaitable_senders'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OtherPromise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>OtherPromise, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
<span class='keyword'>void</span> set_continuation<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='with.awaitable.senders-2'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6888'>#</a></div><div class='texpara'><div id='with.awaitable.senders-2.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >continuation</i> <span class='operator'>=</span> h;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span> <span class='keyword'>requires</span><span class='parenthesis'>(</span>OtherPromise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> other<span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span> <span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <i >stopped-handler</i> <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span> p<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> coroutine_handle<span class='anglebracket'>&lt;</span>OtherPromise<span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_address<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>
      <span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <i >stopped-handler</i> <span class='operator'>=</span> <span class='operator'>&amp;</span><i >default-unhandled-stopped</i>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div class='texpara'><div id='lib:with_awaitable_senders,await_transform'><div id='lib:await_transform,with_awaitable_senders'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:await_transform,with_awaitable_senders'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Value<span class='anglebracket'>&gt;</span>
<span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>as_awaitable_t, Value, Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span> await_transform<span class='parenthesis'>(</span>Value<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='with.awaitable.senders-3'><div class='marginalizedparent'><a class='marginalized' href='#with.awaitable.senders-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6911'>#</a></div><div class='texpara'><div id='with.awaitable.senders-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> as_awaitable<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>, <span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div><div id='affine.on' class='section'><h3 ><a class='secnum' href='#affine.on' style='min-width:80pt'>33.13.3</a> <span class='texttt'>execution&#x200b;::&#x200b;affine_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.affine.on'>[exec.affine.on]</a></h3><div class='para' id='affine.on-1'><div class='marginalizedparent'><a class='marginalized' href='#affine.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6921'>#</a></div><div class='texpara'><div id='affine.on-1.sentence-1' class='sentence'><span class='texttt'>affine_<span class='shy'></span>on</span> adapts a sender into one that completes on
the specified scheduler<a class='hidden_link' href='#affine.on-1.sentence-1'>.</a></div> <div id='affine.on-1.sentence-2' class='sentence'>If the algorithm determines that the adapted sender already completes
on the correct scheduler it can avoid any scheduling operation<a class='hidden_link' href='#affine.on-1.sentence-2'>.</a></div></div></div><div class='para' id='affine.on-2'><div class='marginalizedparent'><a class='marginalized' href='#affine.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6927'>#</a></div><div class='texpara'><div id='affine.on-2.sentence-1' class='sentence'>The name <span class='texttt'>affine_<span class='shy'></span>on</span> denotes a pipeable sender adaptor
object<a class='hidden_link' href='#affine.on-2.sentence-1'>.</a></div> <div id='affine.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
does not satisfy <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_________________'><span class='texttt'>scheduler</span></span></a>, or <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
does not satisfy <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________________________________'><span class='texttt'>sender</span></span></a>, <span class='texttt'>affine_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#affine.on-2.sentence-2'>.</a></div></div></div><div class='para' id='affine.on-3'><div class='marginalizedparent'><a class='marginalized' href='#affine.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6935'>#</a></div><div class='texpara'><div id='affine.on-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>affine_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is
expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>affine_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#affine.on-3.sentence-1'>.</a></div></div></div><div class='para' id='affine.on-4'><div class='marginalizedparent'><a class='marginalized' href='#affine.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6943'>#</a></div><div class='texpara'><div id='affine.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>affine_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>affine_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='affine.on-5'><div class='marginalizedparent'><a class='marginalized' href='#affine.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6959'>#</a></div><div class='texpara'><div id='affine.on-5.sentence-1' class='sentence'>Let <span class='texttt'><i >out_<span class='shy'></span>sndr</i></span> be a subexpression denoting a sender
returned from <span class='texttt'>affine_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'><i >OutSndr</i></span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><i >out_<span class='shy'></span>sndr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#affine.on-5.sentence-1'>.</a></div> <div id='affine.on-5.sentence-2' class='sentence'>Let <span class='texttt'><i >out_<span class='shy'></span>rcvr</i></span> be a subexpression denoting a receiver that
has an environment of type <span class='texttt'>Env</span> such that <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >OutSndr</i>, Env<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#affine.on-5.sentence-2'>.</a></div> <div id='affine.on-5.sentence-3' class='sentence'>Let <span class='texttt'><i >op</i></span> be an lvalue referring to the operation state that
results from connecting <span class='texttt'><i >out_<span class='shy'></span>sndr</i></span> to <span class='texttt'><i >out_<span class='shy'></span>rcvr</i></span><a class='hidden_link' href='#affine.on-5.sentence-3'>.</a></div> <div id='affine.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span><i >op</i><span class='parenthesis'>)</span></span> will start <span class='texttt'>sndr</span> on the current
execution agent and execute completion operations on <span class='texttt'><i >out_<span class='shy'></span>rcvr</i></span>
on an execution agent of the execution resource associated with
<span class='texttt'>sch</span><a class='hidden_link' href='#affine.on-5.sentence-4'>.</a></div> <div id='affine.on-5.sentence-5' class='sentence'>If the current execution resource is the same as the execution
resource associated with <span class='texttt'>sch</span>, the completion operation on
<span class='texttt'><i >out_<span class='shy'></span>rcvr</i></span> may be called before <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> completes<a class='hidden_link' href='#affine.on-5.sentence-5'>.</a></div> <div id='affine.on-5.sentence-6' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails, an error completion on
<span class='texttt'><i >out_<span class='shy'></span>rcvr</i></span> shall be executed on an unspecified execution
agent<a class='hidden_link' href='#affine.on-5.sentence-6'>.</a></div></div></div></div><div id='inline.scheduler' class='section'><h3 ><a class='secnum' href='#inline.scheduler' style='min-width:80pt'>33.13.4</a> <span class='texttt'>execution&#x200b;::&#x200b;inline_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.inline.scheduler'>[exec.inline.scheduler]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:inline_scheduler_'><a class='hidden_link' href='#lib:inline_scheduler' title='33.13.4&emsp;execution&#x200b;::&#x200b;inline_&shy;scheduler&emsp;[exec.inline.scheduler]'>inline_scheduler</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>class</span> <i >inline-sender</i>;                <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver________'><span class='tcode_in_codeblock'>receiver</span></span></a> R<span class='anglebracket'>&gt;</span>
      <span class='keyword'>class</span> <i >inline-state</i>;               <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> scheduler_concept <span class='operator'>=</span> scheduler_t;

    <span class='keyword'>constexpr</span> <i >inline-sender</i> schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> inline_scheduler<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='inline.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#inline.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L6998'>#</a></div><div class='texpara'><div id='inline.scheduler-1.sentence-1' class='sentence'><span class='texttt'>inline_<span class='shy'></span>scheduler</span> is a class that models
<a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__________________'><span class='texttt'>scheduler</span></span></a> (<a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a>)<a class='hidden_link' href='#inline.scheduler-1.sentence-1'>.</a></div> <div id='inline.scheduler-1.sentence-2' class='sentence'>All objects of type <span class='texttt'>inline_<span class='shy'></span>scheduler</span> are equal<a class='hidden_link' href='#inline.scheduler-1.sentence-2'>.</a></div></div></div><div class='para' id='inline.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#inline.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7003'>#</a></div><div class='texpara'><div id='inline.scheduler-2.sentence-1' class='sentence'><span class='texttt'><i >inline-sender</i></span> is an exposition-only type that satisfies
<a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#inline.scheduler-2.sentence-1'>.</a></div> <div id='inline.scheduler-2.sentence-2' class='sentence'>The type <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >inline-sender</i></span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#inline.scheduler-2.sentence-2'>.</a></div></div></div><div class='para' id='inline.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#inline.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7009'>#</a></div><div class='texpara'><div id='inline.scheduler-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> be an expression of type <span class='texttt'><i >inline-sender</i></span>,
let <span class='texttt'>rcvr</span> be an expression such that
<span class='texttt'><a href='#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of______'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, CS<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
where <span class='texttt'>CS</span> is <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span>,
then:
<ul class='itemize'><li id='inline.scheduler-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#inline.scheduler-3.1'>(3.1)</a></div>the expression <span class='texttt'>connect<span class='parenthesis'>(</span>sndr, rcvr<span class='parenthesis'>)</span></span> has
type <span class='texttt'><span class='texttt'><i >inline-state</i></span><span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
and is potentially-throwing if and only if
<span class='texttt'><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>)</span>sndr, <span class='keyword'>auto</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is potentially-throwing, and</li><li id='inline.scheduler-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#inline.scheduler-3.2'>(3.2)</a></div>the expression
<span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> has
type&#x200b; <span class='texttt'>inline_<span class='shy'></span>scheduler</span> and is potentially-throwing
if and only if <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is potentially-throwing<a class='hidden_link' href='#inline.scheduler-3.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='inline.scheduler-4'><div class='marginalizedparent'><a class='marginalized' href='#inline.scheduler-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7026'>#</a></div><div class='texpara'><div id='inline.scheduler-4.sentence-1' class='sentence'>Let <span class='texttt'><i >o</i></span> be a non-<span class='texttt'><span class='keyword'>const</span></span> lvalue of type
<span class='texttt'><span class='texttt'><i >inline-state</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>, and let <span class='texttt'>REC<span class='parenthesis'>(</span><i >o</i><span class='parenthesis'>)</span></span> be
a non-<span class='texttt'><span class='keyword'>const</span></span> lvalue reference to an object of type <span class='texttt'>Rcvr</span> that
was initialized with the expression <span class='texttt'>rcvr</span> passed to an
invocation of <span class='texttt'>connect</span> that returned <span class='texttt'><i >o</i></span>, then:
<ul class='itemize'><li id='inline.scheduler-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#inline.scheduler-4.1'>(4.1)</a></div>the object to which <span class='texttt'>REC<span class='parenthesis'>(</span><i >o</i><span class='parenthesis'>)</span></span> refers remains valid for
the lifetime of the object to which <span class='texttt'><i >o</i></span> refers, and</li><li id='inline.scheduler-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#inline.scheduler-4.2'>(4.2)</a></div>the expression <span class='texttt'>start<span class='parenthesis'>(</span><i >o</i><span class='parenthesis'>)</span></span> is equivalent to
<span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>REC<span class='parenthesis'>(</span><i >o</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#inline.scheduler-4.sentence-1'>.</a></li></ul></div></div></div></div><div id='task.scheduler' class='section'><h3 ><a class='secnum' href='#task.scheduler' style='min-width:80pt'>33.13.5</a> <span class='texttt'>execution&#x200b;::&#x200b;task_<span class='shy'></span>scheduler</span> <a class='abbr_ref' href='exec.task.scheduler'>[exec.task.scheduler]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:task_scheduler_'><a class='hidden_link' href='#lib:task_scheduler' title='33.13.5&emsp;execution&#x200b;::&#x200b;task_&shy;scheduler&emsp;[exec.task.scheduler]'>task_scheduler</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>class</span> <i >ts-sender</i>;                    <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_________'><span class='tcode_in_codeblock'>receiver</span></span></a> R<span class='anglebracket'>&gt;</span>
      <span class='keyword'>class</span> <i >state</i>;                      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> scheduler_concept <span class='operator'>=</span> scheduler_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch, <span class='keyword'>class</span> Allocator <span class='operator'>=</span> allocator<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>task_scheduler, remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
        <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___________________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>explicit</span> task_scheduler<span class='parenthesis'>(</span>Sch<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sch, Allocator alloc <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;

    <i >ts-sender</i> schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>friend</span> <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> lhs, <span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>task_scheduler, Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
      <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____________________'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>
    <span class='keyword'>friend</span> <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> lhs, <span class='keyword'>const</span> Sch<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    shared_ptr<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span> <i >sch_</i>; <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='task.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7072'>#</a></div><div class='texpara'><div id='task.scheduler-1.sentence-1' class='sentence'><span class='texttt'>task_<span class='shy'></span>scheduler</span> is a class that models
<a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____________________'><span class='texttt'>scheduler</span></span></a> (<a href='#sched' title='33.6&emsp;Schedulers'>[exec.<span class='shy'></span>sched]</a>)<a class='hidden_link' href='#task.scheduler-1.sentence-1'>.</a></div> <div id='task.scheduler-1.sentence-2' class='sentence'>Given an object <span class='texttt'>s</span> of type <span class='texttt'>task_<span class='shy'></span>scheduler</span>, let
<span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span>s<span class='parenthesis'>)</span></span> be the object owned by <span class='texttt'>s<span class='operator'>.</span><span class='texttt'><i >sch_<span class='shy'></span></i></span></span><a class='hidden_link' href='#task.scheduler-1.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:task_scheduler,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task_scheduler,constructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch, <span class='keyword'>class</span> Allocator <span class='operator'>=</span> allocator<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span><span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>task_scheduler, remove_cvref_t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______________________'><span class='texttt'>scheduler</span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>
<span class='keyword'>explicit</span> task_scheduler<span class='parenthesis'>(</span>Sch<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sch, Allocator alloc <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7085'>#</a></div><div class='texpara'><div id='task.scheduler-2.sentence-1' class='sentence'><i >Effects</i>: Initialize <span class='texttt'><i >sch_<span class='shy'></span></i></span> with
<span class='texttt'>allocate_<span class='shy'></span>shared<span class='anglebracket'>&lt;</span>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>alloc,&#x200b; std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>&#x200b;<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.scheduler-2.sentence-1'>.</a></div></div></div></div><div class='para' id='task.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7090'>#</a></div><div class='texpara'><div id='task.scheduler-3.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should avoid the use of dynamically
allocated memory for small scheduler objects<a class='hidden_link' href='#task.scheduler-3.sentence-1'>.</a></div></div></div></div><div class='para' id='task.scheduler-4'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7095'>#</a></div><div class='texpara'><div id='task.scheduler-4.sentence-1' class='sentence'><i >Remarks</i>: Any allocations performed by construction of <span class='texttt'><i >ts-sender</i></span> or
<span class='texttt'><i >state</i></span> objects resulting from calls on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> are
performed using a copy of <span class='texttt'>alloc</span><a class='hidden_link' href='#task.scheduler-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task_scheduler,scheduler'><div id='lib:scheduler,task_scheduler'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:scheduler,task_scheduler'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >ts-sender</i></span> schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.scheduler-5'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7107'>#</a></div><div class='texpara'><div id='task.scheduler-5.sentence-1' class='sentence'><i >Effects</i>: Returns an object of type <span class='texttt'><i >ts-sender</i></span> containing a sender
initialized with <span class='texttt'>schedule<span class='parenthesis'>(</span>&#x200b;<span class='texttt'><i >SCHED</i></span>&#x200b;<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.scheduler-5.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task_scheduler,operator=='><div id='lib:operator==,task_scheduler'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator==,task_scheduler'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> lhs, <span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.scheduler-6'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7118'>#</a></div><div class='texpara'><div id='task.scheduler-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> lhs <span class='operator'>=</span><span class='operator'>=</span> <span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span>;</span></div></div></div></div><div class='texpara'><div id='lib:task_scheduler,operator==_'><div id='lib:operator==,task_scheduler_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator==,task_scheduler_'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>task_scheduler, Sch<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
        <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_______________________'><span class='texttt'>scheduler</span></span></a><span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span>
<span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> task_scheduler<span class='operator'>&amp;</span> lhs, <span class='keyword'>const</span> Sch<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.scheduler-7'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7131'>#</a></div><div class='texpara'><div id='task.scheduler-7.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>false</span></span> if type of <span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span>lhs<span class='parenthesis'>)</span></span> is not <span class='texttt'>Sch</span>,
otherwise <span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span>lhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> rhs;</span></div></div></div></div><div class='para' id='task.scheduler-8'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7137'>#</a></div><div class='texpara'><div id='task.scheduler-8.sentence-1' class='sentence'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> task_scheduler<span class='operator'>::</span><i >ts-sender</i> <span class='curlybracket'>{</span>     <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver__________'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
      <i >state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> connect<span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span>
<span class='texttt'><i >ts-sender</i></span> is an exposition-only class that models
<a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________________________________'><span class='texttt'>sender</span></span></a> (<a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a>) and for which
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >ts-sender</i></span><span class='anglebracket'>&gt;</span></span> denotes:
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>,
  set_error_t<span class='parenthesis'>(</span>error_code<span class='parenthesis'>)</span>,
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='task.scheduler-9'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7160'>#</a></div><div class='texpara'><div id='task.scheduler-9.sentence-1' class='sentence'>Let <span class='texttt'><i >sch</i></span> be an object of type <span class='texttt'>task_<span class='shy'></span>scheduler</span>
and let <span class='texttt'>sndr</span> be an object of type <span class='texttt'><i >ts-sender</i></span> obtained
from <span class='texttt'>schedule<span class='parenthesis'>(</span><i >sch</i><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.scheduler-9.sentence-1'>.</a></div> <div id='task.scheduler-9.sentence-2' class='sentence'>Then <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <i >sch</i></span>
is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#task.scheduler-9.sentence-2'>.</a></div> <div id='task.scheduler-9.sentence-3' class='sentence'>The object <span class='texttt'><span class='texttt'><i >SENDER</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is the sender object contained by
<span class='texttt'>sndr</span> or an object move constructed from it<a class='hidden_link' href='#task.scheduler-9.sentence-3'>.</a></div></div></div><div class='texpara'><div id='lib:task_scheduler::ts-sender,connect'><div id='lib:connect,task_scheduler::ts-sender'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:connect,task_scheduler::ts-sender'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver___________'><span class='texttt'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='texttt'><i >state</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> connect<span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.scheduler-10'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7175'>#</a></div><div class='texpara'><div id='task.scheduler-10.sentence-1' class='sentence'><i >Effects</i>: Let <span class='texttt'><i >r</i></span> be an object of a type that models <a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver____________'><span class='texttt'>receiver</span></span></a>
and whose completion handlers result in invoking the corresponding
completion handlers of <span class='texttt'>rcvr</span> or copy thereof<a class='hidden_link' href='#task.scheduler-10.sentence-1'>.</a></div> <div id='task.scheduler-10.sentence-2' class='sentence'>Returns an object of type <span class='texttt'><span class='texttt'><i >state</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> containing
an operation state object initialized with <span class='texttt'>connect<span class='parenthesis'>(</span><span class='texttt'><i >SENDER</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span>,
std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><i >r</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.scheduler-10.sentence-2'>.</a></div></div></div></div><div class='para' id='task.scheduler-11'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7185'>#</a></div><div class='texpara'><div id='task.scheduler-11.sentence-1' class='sentence'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_____________'><span class='tcode_in_codeblock'>receiver</span></span></a> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> task_scheduler<span class='operator'>::</span><i >state</i> <span class='curlybracket'>{</span>         <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span>
<span class='texttt'><i >state</i></span> is an exposition-only class template whose
specializations model <a href='#concept:operation_state' title='33.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state______'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a> (<a href='#opstate' title='33.8&emsp;Operation states'>[exec.<span class='shy'></span>opstate]</a>)<a class='hidden_link' href='#task.scheduler-11.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:task_scheduler::state,start'><div id='lib:start,task_scheduler::state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:start,task_scheduler::state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.scheduler-12'><div class='marginalizedparent'><a class='marginalized' href='#task.scheduler-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7205'>#</a></div><div class='texpara'><div id='task.scheduler-12.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'>start<span class='parenthesis'>(</span>st<span class='parenthesis'>)</span></span> where <span class='texttt'>st</span> is the operation
state object contained by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.scheduler-12.sentence-1'>.</a></div></div></div></div></div><div id='task' class='section'><h3 ><a class='secnum' href='#task' style='min-width:80pt'>33.13.6</a> <span class='texttt'>execution&#x200b;::&#x200b;task</span> <a class='abbr_ref' href='exec.task'>[exec.task]</a></h3><div id='task.overview' class='section'><h4 ><a class='secnum' href='#task.overview' style='min-width:95pt'>33.13.6.1</a> <span class='texttt'>task</span> overview <a class='abbr_ref' href='task.overview'>[task.overview]</a></h4><div class='para' id='task.overview-1'><div class='marginalizedparent'><a class='marginalized' href='#task.overview-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7215'>#</a></div><div class='texpara'><div id='task.overview-1.sentence-1' class='sentence'>The <span class='texttt'>task</span> class template represents a sender that can
be used as the return type of coroutines<a class='hidden_link' href='#task.overview-1.sentence-1'>.</a></div> <div id='task.overview-1.sentence-2' class='sentence'>The first template parameter <span class='texttt'>T</span> defines the type of the value
completion datum (<a href='#async.ops' title='33.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) if <span class='texttt'>T</span> is not <span class='texttt'><span class='keyword'>void</span></span><a class='hidden_link' href='#task.overview-1.sentence-2'>.</a></div> <div id='task.overview-1.sentence-3' class='sentence'>Otherwise, there are no value completion datums<a class='hidden_link' href='#task.overview-1.sentence-3'>.</a></div> <div id='task.overview-1.sentence-4' class='sentence'>Inside coroutines returning <span class='texttt'>task<span class='anglebracket'>&lt;</span>T, E<span class='anglebracket'>&gt;</span></span> the operand of
<span class='texttt'><span class='keyword'>co_<span class='shy'></span>return</span></span> (if any) becomes the argument of <span class='texttt'>set_<span class='shy'></span>value</span><a class='hidden_link' href='#task.overview-1.sentence-4'>.</a></div> <div id='task.overview-1.sentence-5' class='sentence'>The second template parameter <span class='texttt'>Environment</span> is used to customize
the behavior of <span class='texttt'>task</span><a class='hidden_link' href='#task.overview-1.sentence-5'>.</a></div></div></div></div><div id='task.class' class='section'><h4 ><a class='secnum' href='#task.class' style='min-width:95pt'>33.13.6.2</a> Class template <span class='texttt'>task</span> <a class='abbr_ref' href='task.class'>[task.class]</a></h4><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Environment<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> <span id='lib:task_'><a class='hidden_link' href='#lib:task' title='33.13.6.2&emsp;Class template task&emsp;[task.class]'>task</a></span> <span class='curlybracket'>{</span>
    <span class='comment'>// <a href='#task.state' title='33.13.6.4&emsp;Class template task&#x200b;::&#x200b;state'>[task.<span class='shy'></span>state]</a></span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver______________'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
      <span class='keyword'>class</span> <i >state</i>;                              <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
    <span class='keyword'>using</span> completion_signatures <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> allocator_type <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> scheduler_type <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_source_type <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_token_type <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>stop_source_type<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='keyword'>using</span> error_types <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

    <span class='comment'>// <a href='#task.promise' title='33.13.6.5&emsp;Class task&#x200b;::&#x200b;promise_&shy;type'>[task.<span class='shy'></span>promise]</a></span>
    <span class='keyword'>class</span> promise_type;

    task<span class='parenthesis'>(</span>task<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='operator'>~</span>task<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_______________'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
      <i >state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> connect<span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    coroutine_handle<span class='anglebracket'>&lt;</span>promise_type<span class='anglebracket'>&gt;</span> <i >handle</i>;      <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='task.class-1'><div class='marginalizedparent'><a class='marginalized' href='#task.class-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7260'>#</a></div><div class='texpara'><div id='task.class-1.sentence-1' class='sentence'><span class='texttt'>task<span class='anglebracket'>&lt;</span>T, E<span class='anglebracket'>&gt;</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________________________________'><span class='texttt'>sender</span></span></a> (<a href='#snd' title='33.9&emsp;Senders'>[exec.<span class='shy'></span>snd]</a>)
if <span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>void</span></span>, a reference type, or a <span class='mathit'>cv</span>-unqualified
non-array object type and <span class='texttt'>E</span> is a class type<a class='hidden_link' href='#task.class-1.sentence-1'>.</a></div> <div id='task.class-1.sentence-2' class='sentence'>Otherwise a program that instantiates the definition of <span class='texttt'>task<span class='anglebracket'>&lt;</span>T, E<span class='anglebracket'>&gt;</span></span>
is ill-formed<a class='hidden_link' href='#task.class-1.sentence-2'>.</a></div></div></div><div class='para' id='task.class-2'><div class='marginalizedparent'><a class='marginalized' href='#task.class-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7267'>#</a></div><div class='texpara'><div id='task.class-2.sentence-1' class='sentence'>The nested types of <span class='texttt'>task</span> template specializations
are determined based on the <span class='texttt'>Environment</span> parameter:
<ul class='itemize'><li id='task.class-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-2.1'>(2.1)</a></div><div class='texpara'><div id='task.class-2.1.sentence-1' class='sentence'><span class='texttt'>allocator_<span class='shy'></span>type</span> is <span class='texttt'>Environment<span class='operator'>&#x200b;::&#x200b;</span>allocator_<span class='shy'></span>type</span>
if that <a href='expr.prim.id.qual#nt:qualified-id' title='7.5.5.3&emsp;Qualified names&emsp;[expr.prim.id.qual]'><span id='ntref:qualified-id'><span class='textsf'><i >qualified-id</i></span></span></a> is valid and denotes a type,
<span class='texttt'>allocator<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span></span> otherwise<a class='hidden_link' href='#task.class-2.1.sentence-1'>.</a></div></div></li><li id='task.class-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-2.2'>(2.2)</a></div><div class='texpara'><div id='task.class-2.2.sentence-1' class='sentence'><span class='texttt'>scheduler_<span class='shy'></span>type</span> is <span class='texttt'>Environment<span class='operator'>&#x200b;::&#x200b;</span>scheduler_<span class='shy'></span>type</span>
if that <a href='expr.prim.id.qual#nt:qualified-id' title='7.5.5.3&emsp;Qualified names&emsp;[expr.prim.id.qual]'><span id='ntref:qualified-id_'><span class='textsf'><i >qualified-id</i></span></span></a> is valid and denotes a type,
<span class='texttt'>task_<span class='shy'></span>scheduler</span> otherwise<a class='hidden_link' href='#task.class-2.2.sentence-1'>.</a></div></div></li><li id='task.class-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-2.3'>(2.3)</a></div><div class='texpara'><div id='task.class-2.3.sentence-1' class='sentence'><span class='texttt'>stop_<span class='shy'></span>source_<span class='shy'></span>type</span> is <span class='texttt'>Environment<span class='operator'>&#x200b;::&#x200b;</span>stop_<span class='shy'></span>source_<span class='shy'></span>type</span>
if that <a href='expr.prim.id.qual#nt:qualified-id' title='7.5.5.3&emsp;Qualified names&emsp;[expr.prim.id.qual]'><span id='ntref:qualified-id__'><span class='textsf'><i >qualified-id</i></span></span></a> is valid and denotes a type,
<span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> otherwise<a class='hidden_link' href='#task.class-2.3.sentence-1'>.</a></div></div></li><li id='task.class-2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-2.4'>(2.4)</a></div><div class='texpara'><div id='task.class-2.4.sentence-1' class='sentence'><span class='texttt'>error_<span class='shy'></span>types</span> is <span class='texttt'>Environment<span class='operator'>&#x200b;::&#x200b;</span>error_<span class='shy'></span>types</span> if
that <a href='expr.prim.id.qual#nt:qualified-id' title='7.5.5.3&emsp;Qualified names&emsp;[expr.prim.id.qual]'><span id='ntref:qualified-id___'><span class='textsf'><i >qualified-id</i></span></span></a> is valid and denotes a type,
<span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>exception_<span class='shy'></span>ptr<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> otherwise<a class='hidden_link' href='#task.class-2.4.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='task.class-3'><div class='marginalizedparent'><a class='marginalized' href='#task.class-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7285'>#</a></div><div class='texpara'><div id='task.class-3.sentence-1' class='sentence'>A program is ill-formed if <span class='texttt'>error_<span class='shy'></span>types</span> is not a
specialization of <span class='texttt'>completion_<span class='shy'></span>signatures<span class='anglebracket'>&lt;</span>ErrorSigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> or
<span class='texttt'>ErrorSigs</span> contains an element which is not of the form
<span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>E<span class='parenthesis'>)</span></span> for some type <span class='texttt'>E</span><a class='hidden_link' href='#task.class-3.sentence-1'>.</a></div></div></div><div class='para' id='task.class-4'><div class='marginalizedparent'><a class='marginalized' href='#task.class-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7291'>#</a></div><div class='texpara'><div id='task.class-4.sentence-1' class='sentence'>The type alias <span class='texttt'>completion_<span class='shy'></span>signatures</span> is a specialization
of <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>completion_<span class='shy'></span>signatures</span> with the template
arguments (in unspecified order):
<ul class='itemize'><li id='task.class-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-4.1'>(4.1)</a></div><span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> if <span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>void</span></span>,
and <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> otherwise;</li><li id='task.class-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-4.2'>(4.2)</a></div>template arguments of the specialization of
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>completion_<span class='shy'></span>signatures</span> denoted by <span class='texttt'>error_<span class='shy'></span>types</span>;
and</li><li id='task.class-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#task.class-4.3'>(4.3)</a></div><span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.class-4.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='task.class-5'><div class='marginalizedparent'><a class='marginalized' href='#task.class-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7304'>#</a></div><div class='texpara'><div id='task.class-5.sentence-1' class='sentence'><span class='texttt'>allocator_<span class='shy'></span>type</span> shall meet the <i >Cpp17Allocator</i>
requirements<a class='hidden_link' href='#task.class-5.sentence-1'>.</a></div></div></div></div><div id='task.members' class='section'><h4 ><a class='secnum' href='#task.members' style='min-width:95pt'>33.13.6.3</a> <span class='texttt'>task</span> members <a class='abbr_ref' href='task.members'>[task.members]</a></h4><div class='texpara'><div id='lib:task,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>task<span class='parenthesis'>(</span>task<span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='task.members-1'><div class='marginalizedparent'><a class='marginalized' href='#task.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7315'>#</a></div><div class='texpara'><div id='task.members-1.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >handle</i></span> with <span class='texttt'>exchange<span class='parenthesis'>(</span>other<span class='operator'>.</span><span class='texttt'><i >handle</i></span>,
<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.members-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>task<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.members-2'><div class='marginalizedparent'><a class='marginalized' href='#task.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7326'>#</a></div><div class='texpara'><div id='task.members-2.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span><i >handle</i><span class='parenthesis'>)</span>
  <i >handle</i><span class='operator'>.</span>destroy<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:task,connect'><div id='lib:connect,task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:connect,task'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver________________'><span class='texttt'>receiver</span></span></a> R<span class='anglebracket'>&gt;</span>
  <span class='texttt'><i >state</i></span><span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> connect<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> recv<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.members-3'><div class='marginalizedparent'><a class='marginalized' href='#task.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7341'>#</a></div><div class='texpara'><div id='task.members-3.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><span class='keyword'>bool</span><span class='parenthesis'>(</span><span class='texttt'><i >handle</i></span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#task.members-3.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-4'><div class='marginalizedparent'><a class='marginalized' href='#task.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7345'>#</a></div><div class='texpara'><div id='task.members-4.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> <span class='texttt'><i >state</i></span><span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>exchange<span class='parenthesis'>(</span><span class='texttt'><i >handle</i></span>,
<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>, std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>recv<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;</span></div></div></div></div></div><div id='task.state' class='section'><h4 ><a class='secnum' href='#task.state' style='min-width:95pt'>33.13.6.4</a> <span class='texttt'>Class template <span class='texttt'>task&#x200b;::&#x200b;state</span></span> <a class='abbr_ref' href='task.state'>[task.state]</a></h4><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Environment<span class='anglebracket'>&gt;</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:receiver' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_________________'><span class='tcode_in_codeblock'>receiver</span></span></a> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> task<span class='anglebracket'>&lt;</span>T, Environment<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >state</i> <span class='curlybracket'>{</span>           <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
      <i >state</i><span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>promise_type<span class='anglebracket'>&gt;</span> h, R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rr<span class='parenthesis'>)</span>;

    <span class='operator'>~</span><i >state</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> <i >own-env-t</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    coroutine_handle<span class='anglebracket'>&lt;</span>promise_type<span class='anglebracket'>&gt;</span> <i >handle</i>;      <span class='comment'>// <i >exposition only</i></span>
    remove_cvref_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>           <i >rcvr</i>;        <span class='comment'>// <i >exposition only</i></span>
    <i >own-env-t</i>                      <i >own-env</i>;     <span class='comment'>// <i >exposition only</i></span>
    Environment                    <i >environment</i>; <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='task.state-1'><div class='marginalizedparent'><a class='marginalized' href='#task.state-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7378'>#</a></div><div class='texpara'><div id='task.state-1.sentence-1' class='sentence'>The type <span class='texttt'><i >own-env-t</i></span> is <span class='texttt'>Environment<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>template</span>
env_<span class='shy'></span>type<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>&#x200b;declval&#x200b;<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>&#x200b;<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>&#x200b;<span class='anglebracket'>&gt;</span></span> if that
<a href='expr.prim.id.qual#nt:qualified-id' title='7.5.5.3&emsp;Qualified names&emsp;[expr.prim.id.qual]'><span id='ntref:qualified-id____'><span class='textsf'><i >qualified-id</i></span></span></a> is valid and denotes a type, <span class='texttt'>env<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span> otherwise<a class='hidden_link' href='#task.state-1.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:task::state,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task::state,constructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='texttt'><i >state</i></span><span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span>promise_type<span class='anglebracket'>&gt;</span> h, R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rr<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.state-2'><div class='marginalizedparent'><a class='marginalized' href='#task.state-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7389'>#</a></div><div class='texpara'><div id='task.state-2.sentence-1' class='sentence'><i >Effects</i>: Initializes
<ul class='itemize'><li id='task.state-2.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-2.1'>(2.1)</a></div><span class='texttt'><i >handle</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span></span>;</li><li id='task.state-2.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-2.2'>(2.2)</a></div><span class='texttt'><i >rcvr</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rr<span class='parenthesis'>)</span></span>;</li><li id='task.state-2.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-2.3'>(2.3)</a></div><span class='texttt'><i >own-env</i></span>
with <span class='texttt'><span class='texttt'><i >own-env-t</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> if that expression
is valid and <span class='texttt'><span class='texttt'><i >own-env-t</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> otherwise<a class='hidden_link' href='#task.state-2.sentence-1'>.</a></li></ul></div> <div id='task.state-2.sentence-2' class='sentence'>
If neither of these expressions is valid, the program is ill-formed<a class='hidden_link' href='#task.state-2.sentence-2'>.</a></div> <div id='task.state-2.sentence-3' class='sentence'><span class='item'></span><span class='texttt'><i >environment</i></span> with <span class='texttt'>Environment<span class='parenthesis'>(</span><span class='texttt'><i >own-env</i></span><span class='parenthesis'>)</span></span> if that expression is
valid, otherwise <span class='texttt'>Environment<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if this expression is valid, otherwise <span class='texttt'>Environment<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.state-2.sentence-3'>.</a></div> <div id='task.state-2.sentence-4' class='sentence'>If neither of these expressions is valid, the program is ill-formed<a class='hidden_link' href='#task.state-2.sentence-4'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::state,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task::state,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >state</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.state-3'><div class='marginalizedparent'><a class='marginalized' href='#task.state-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7411'>#</a></div><div class='texpara'><div id='task.state-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span><i >handle</i><span class='parenthesis'>)</span>
  <i >handle</i><span class='operator'>.</span>destroy<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:task::state,start'><div id='lib:start,task::state'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:start,task::state'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.state-4'><div class='marginalizedparent'><a class='marginalized' href='#task.state-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7425'>#</a></div><div class='texpara'><div id='task.state-4.sentence-1' class='sentence'><i >Effects</i>: Let <span class='texttt'><i >prom</i></span> be the object <span class='texttt'><span class='texttt'><i >handle</i></span><span class='operator'>.</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.state-4.sentence-1'>.</a></div> <div id='task.state-4.sentence-2' class='sentence'>Associates <span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>, <span class='texttt'><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>, and <span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>
with <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> as follows:
<ul class='itemize'><li id='task.state-4.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.1'>(4.1)</a></div><div class='texpara'><div id='task.state-4.1.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.state-4.1.sentence-1'>.</a></div></div></li><li id='task.state-4.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.2'>(4.2)</a></div><div class='texpara'><div id='task.state-4.2.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span> is <span class='texttt'><i >rcvr</i></span><a class='hidden_link' href='#task.state-4.2.sentence-1'>.</a></div></div></li><li id='task.state-4.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.3'>(4.3)</a></div><div class='texpara'><div id='task.state-4.3.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span> is the object initialized
with <span class='texttt'>scheduler_<span class='shy'></span>type<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that expression is valid and <span class='texttt'>scheduler_<span class='shy'></span>type<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> otherwise<a class='hidden_link' href='#task.state-4.3.sentence-1'>.</a></div> <div id='task.state-4.3.sentence-2' class='sentence'>If neither of these expressions is valid, the program is ill-formed<a class='hidden_link' href='#task.state-4.3.sentence-2'>.</a></div></div></li></ul></div> <div id='task.state-4.sentence-3' class='sentence'>
Let <span class='texttt'><i >st</i></span> be <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.state-4.sentence-3'>.</a></div> <div id='task.state-4.sentence-4' class='sentence'>Initializes <span class='texttt'><i >prom</i><span class='operator'>.</span><span class='texttt'><i >token</i></span></span> and
<span class='texttt'><i >prom</i><span class='operator'>.</span><span class='texttt'><i >source</i></span></span> such that
<ul class='itemize'><li id='task.state-4.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.4'>(4.4)</a></div><span class='texttt'><i >prom</i><span class='operator'>.</span><span class='texttt'><i >token</i></span><span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
<span class='texttt'><i >st</i><span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;</li><li id='task.state-4.5'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.5'>(4.5)</a></div><span class='texttt'><i >prom</i><span class='operator'>.</span><span class='texttt'><i >token</i></span><span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
<span class='texttt'><i >st</i><span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>; and</li><li id='task.state-4.6'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.state-4.6'>(4.6)</a></div>for types <span class='texttt'>Fn</span> and <span class='texttt'>Init</span> such that both
<span class='texttt'><a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable_____'><span class='texttt'>invocable</span></span></a><span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> and
<span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from______'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>Fn, Init<span class='anglebracket'>&gt;</span></span> are modeled,
<span class='texttt'>stop_<span class='shy'></span>token_<span class='shy'></span>type<span class='operator'>&#x200b;::&#x200b;</span>callback_<span class='shy'></span>type<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span></span> models
<span class='texttt'><a href='stoptoken.concepts#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for_'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>Fn,&#x200b; stop_<span class='shy'></span>token_<span class='shy'></span>type, Init<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#task.state-4.sentence-4'>.</a></li></ul></div> <div id='task.state-4.sentence-5' class='sentence'>
After that invokes <span class='texttt'><span class='texttt'><i >handle</i></span><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.state-4.sentence-5'>.</a></div></div></div></div></div><div id='task.promise' class='section'><h4 ><a class='secnum' href='#task.promise' style='min-width:95pt'>33.13.6.5</a> Class <span class='texttt'>task&#x200b;::&#x200b;promise_<span class='shy'></span>type</span> <a class='abbr_ref' href='task.promise'>[task.promise]</a></h4><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Environment<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> task<span class='anglebracket'>&lt;</span>T, Environment<span class='anglebracket'>&gt;</span><span class='operator'>::</span>promise_type <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      promise_type<span class='parenthesis'>(</span><span class='keyword'>const</span> Args<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;

    task get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>auto</span> initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>auto</span> final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> uncaught_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                 <span class='comment'>// present only if <span class='tcode_in_codeblock'>is_<span class='shy'></span>void_<span class='shy'></span>v&lt;T&gt;</span> is <span class='tcode_in_codeblock'>true</span>;</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> V<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> return_value<span class='parenthesis'>(</span>V<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>;     <span class='comment'>// present only if <span class='tcode_in_codeblock'>is_<span class='shy'></span>void_<span class='shy'></span>v&lt;T&gt;</span> is <span class='tcode_in_codeblock'>false</span>;</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
      <i ><span class='texttt'>unspecified</span></i> yield_value<span class='parenthesis'>(</span>with_error<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span> error<span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> A<span class='anglebracket'>&gt;</span>
      <span class='keyword'>auto</span> await_transform<span class='parenthesis'>(</span>A<span class='operator'>&amp;</span><span class='operator'>&amp;</span> a<span class='parenthesis'>)</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
      <span class='keyword'>auto</span> await_transform<span class='parenthesis'>(</span>change_coroutine_scheduler<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span> sch<span class='parenthesis'>)</span>;

    <i ><span class='texttt'>unspecified</span></i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span><span class='operator'>*</span> <span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>size_t size, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span> pointer, size_t size<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> <i >error-variant</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;    <span class='comment'>// <i >exposition only</i></span>

    allocator_type    <i >alloc</i>;            <span class='comment'>// <i >exposition only</i></span>
    stop_source_type  <i >source</i>;           <span class='comment'>// <i >exposition only</i></span>
    stop_token_type   <i >token</i>;            <span class='comment'>// <i >exposition only</i></span>
    optional<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span>       <i >result</i>;           <span class='comment'>// <i >exposition only</i>; present only if <span class='tcode_in_codeblock'>is_<span class='shy'></span>void_<span class='shy'></span>v&lt;T&gt;</span> is <span class='tcode_in_codeblock'>false</span>;</span>
    <i >error-variant</i>     <i >errors</i>;           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='task.promise-1'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7507'>#</a></div><div class='texpara'><div id='task.promise-1.sentence-1' class='sentence'>Let <span class='texttt'><i >prom</i></span> be an object of <span class='texttt'>promise_<span class='shy'></span>type</span>
and let <span class='texttt'><i >tsk</i></span> be the <span class='texttt'>task</span> object
created by <span class='texttt'><i >prom</i><span class='operator'>.</span>get_<span class='shy'></span>return_<span class='shy'></span>object<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-1.sentence-1'>.</a></div> <div id='task.promise-1.sentence-2' class='sentence'>The description below
refers to objects <span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>,
<span class='texttt'><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>,
and <span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><i >prom</i><span class='parenthesis'>)</span></span>
associated with <span class='texttt'><i >tsk</i></span>
during evaluation of <span class='texttt'>task<span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >state</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>start</span>
for some receiver <span class='texttt'>Rcvr</span><a class='hidden_link' href='#task.promise-1.sentence-2'>.</a></div></div></div><div class='para' id='task.promise-2'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7519'>#</a></div><div class='texpara'><div id='task.promise-2.sentence-1' class='sentence'><span class='texttt'><i >error-variant</i></span> is a <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate,
remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>, with duplicate types removed, where <span class='texttt'>E<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
are template arguments of the specialization of
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>completion_<span class='shy'></span>signatures</span> denoted by
<span class='texttt'>error_<span class='shy'></span>types</span><a class='hidden_link' href='#task.promise-2.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:task::promise_type,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:task::promise_type,constructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  promise_type<span class='parenthesis'>(</span><span class='keyword'>const</span> Args<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.promise-3'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7532'>#</a></div><div class='texpara'><div id='task.promise-3.sentence-1' class='sentence'><i >Mandates</i>: The first parameter of type <span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span> (if any) is not
the last parameter<a class='hidden_link' href='#task.promise-3.sentence-1'>.</a></div></div></div></div><div class='para' id='task.promise-4'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7537'>#</a></div><div class='texpara'><div id='task.promise-4.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>Args</span> contains an element of type <span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span>
then <span class='texttt'><i >alloc</i></span> is initialized with the corresponding next
element of <span class='texttt'>args</span><a class='hidden_link' href='#task.promise-4.sentence-1'>.</a></div> <div id='task.promise-4.sentence-2' class='sentence'>Otherwise, <span class='texttt'><i >alloc</i></span> is initialized with <span class='texttt'>allocator_<span class='shy'></span>type<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-4.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,get_return_object'><div id='lib:get_return_object,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_return_object,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'>task get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-5'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7550'>#</a></div><div class='texpara'><div id='task.promise-5.sentence-1' class='sentence'><i >Returns</i>: A <span class='texttt'>task</span> object whose member <span class='texttt'><i >handle</i></span> is
<span class='texttt'>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span>promise_<span class='shy'></span>type<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>&#x200b;from_<span class='shy'></span>promise&#x200b;<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-5.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,initial_suspend'><div id='lib:initial_suspend,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:initial_suspend,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>auto</span> initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-6'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7561'>#</a></div><div class='texpara'><div id='task.promise-6.sentence-1' class='sentence'><i >Returns</i>: An awaitable object of unspecified type (<a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>) whose
member functions arrange for
<ul class='itemize'><li id='task.promise-6.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-6.1'>(6.1)</a></div>the calling coroutine to be suspended,</li><li id='task.promise-6.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-6.2'>(6.2)</a></div>the coroutine to be resumed on an execution agent of the
execution resource associated with <span class='texttt'><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-6.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,final_suspend'><div id='lib:final_suspend,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:final_suspend,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>auto</span> final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-7'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7577'>#</a></div><div class='texpara'><div id='task.promise-7.sentence-1' class='sentence'><i >Returns</i>: An awaitable object of unspecified type (<a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>) whose
member functions arrange for the completion of the asynchronous
operation associated with <span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span> by invoking:
<ul class='itemize'><li id='task.promise-7.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-7.1'>(7.1)</a></div><span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if <span class='texttt'><span class='texttt'><i >errors</i></span><span class='operator'>.</span>index<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is greater than zero and
<span class='texttt'>e</span> is the value held by <span class='texttt'><i >errors</i></span>, otherwise</li><li id='task.promise-7.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-7.2'>(7.2)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> if <span class='texttt'>is_<span class='shy'></span>void<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
and otherwise</li><li id='task.promise-7.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-7.3'>(7.3)</a></div><span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>*</span><span class='texttt'><i >result</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-7.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,yield_value'><div id='lib:yield_value,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:yield_value,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Err<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> yield_value<span class='parenthesis'>(</span>with_error<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span> err<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.promise-8'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7601'>#</a></div><div class='texpara'><div id='task.promise-8.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>err<span class='operator'>.</span>error<span class='parenthesis'>)</span></span> is convertible to exactly one of the
<span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t</span> argument types of <span class='texttt'>error_<span class='shy'></span>types</span><a class='hidden_link' href='#task.promise-8.sentence-1'>.</a></div> <div id='task.promise-8.sentence-2' class='sentence'>Let <span class='texttt'><i >Cerr</i></span> be that type<a class='hidden_link' href='#task.promise-8.sentence-2'>.</a></div></div></div></div><div class='para' id='task.promise-9'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7607'>#</a></div><div class='texpara'><div id='task.promise-9.sentence-1' class='sentence'><i >Returns</i>: An awaitable object of unspecified type (<a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>) whose
member functions arrange for the calling coroutine to be suspended
and then completes the asynchronous operation associated with
<span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span> by invoking <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
<i >Cerr</i><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>err<span class='operator'>.</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-9.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,await_transform'><div id='lib:await_transform,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:await_transform,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________________________________'><span class='texttt'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> await_transform<span class='parenthesis'>(</span>Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-10'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7622'>#</a></div><div class='texpara'><div id='task.promise-10.sentence-1' class='sentence'><i >Returns</i>: If <span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>inline_<span class='shy'></span>scheduler, scheduler_<span class='shy'></span>type<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
returns <span class='texttt'>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>&#x200b;std<span class='operator'>&#x200b;::&#x200b;</span>&#x200b;forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span>;
otherwise returns
<span class='texttt'>as_<span class='shy'></span>awaitable<span class='parenthesis'>(</span>affine_<span class='shy'></span>on<span class='parenthesis'>(</span>&#x200b;std<span class='operator'>&#x200b;::&#x200b;</span>&#x200b;forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-10.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,await_transform_'><div id='lib:await_transform,task::promise_type_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:await_transform,task::promise_type_'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sch<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> await_transform<span class='parenthesis'>(</span>change_coroutine_scheduler<span class='anglebracket'>&lt;</span>Sch<span class='anglebracket'>&gt;</span> sch<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-11'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7636'>#</a></div><div class='texpara'><div id='task.promise-11.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> await_transform<span class='parenthesis'>(</span>just<span class='parenthesis'>(</span>exchange<span class='parenthesis'>(</span><i >SCHED</i><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span>, scheduler_type<span class='parenthesis'>(</span>sch<span class='operator'>.</span>scheduler<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,uncaught_exception'><div id='lib:uncaught_exception,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:uncaught_exception,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> uncaught_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.promise-12'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7649'>#</a></div><div class='texpara'><div id='task.promise-12.sentence-1' class='sentence'><i >Effects</i>: If the signature <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>exception_<span class='shy'></span>ptr<span class='parenthesis'>)</span></span> is not an element
of <span class='texttt'>error_<span class='shy'></span>types</span>, calls <span class='texttt'>terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#task.promise-12.sentence-1'>.</a></div> <div id='task.promise-12.sentence-2' class='sentence'>Otherwise, stores <span class='texttt'>current_<span class='shy'></span>exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> into <span class='texttt'><i >errors</i></span><a class='hidden_link' href='#task.promise-12.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,unhandled_stopped'><div id='lib:unhandled_stopped,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:unhandled_stopped,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.promise-13'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7661'>#</a></div><div class='texpara'><div id='task.promise-13.sentence-1' class='sentence'><i >Effects</i>: Completes the asynchronous operation associated with <span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span>
by invoking <span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='texttt'><i >RCVR</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-13.sentence-1'>.</a></div></div></div></div><div class='para' id='task.promise-14'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7667'>#</a></div><div class='texpara'><div id='task.promise-14.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>noop_<span class='shy'></span>coroutine<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-14.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,get_env'><div id='lib:get_env,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_env,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><i ><span class='texttt'>unspecified</span></i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-15'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7677'>#</a></div><div class='texpara'><div id='task.promise-15.sentence-1' class='sentence'><i >Returns</i>: An object <span class='texttt'>env</span> such that queries are forwarded as follows:
<ul class='itemize'><li id='task.promise-15.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-15.1'>(15.1)</a></div><div class='texpara'><div id='task.promise-15.1.sentence-1' class='sentence'><span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> returns <span class='texttt'>scheduler_<span class='shy'></span>type<span class='parenthesis'>(</span><span class='texttt'><i >SCHED</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-15.1.sentence-1'>.</a></div></div></li><li id='task.promise-15.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-15.2'>(15.2)</a></div><div class='texpara'><div id='task.promise-15.2.sentence-1' class='sentence'><span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>allocator<span class='parenthesis'>)</span></span> returns <span class='texttt'><i >alloc</i></span><a class='hidden_link' href='#task.promise-15.2.sentence-1'>.</a></div></div></li><li id='task.promise-15.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-15.3'>(15.3)</a></div><div class='texpara'><div id='task.promise-15.3.sentence-1' class='sentence'><span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>)</span></span> returns <span class='texttt'><i >token</i></span><a class='hidden_link' href='#task.promise-15.3.sentence-1'>.</a></div></div></li><li id='task.promise-15.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-15.4'>(15.4)</a></div><div class='texpara'><div id='task.promise-15.4.sentence-1' class='sentence'>For any other query <span class='texttt'>q</span> and arguments <span class='texttt'>a<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> a
call to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, a<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> returns
<span class='texttt'><span class='texttt'><i >STATE</i></span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-15.4.sentence-1'>.</a></div> <div id='task.promise-15.4.sentence-2' class='sentence'><span class='texttt'>environment<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, a<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if this expression
is well-formed and <span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is well-formed and is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#task.promise-15.4.sentence-2'>.</a></div> <div id='task.promise-15.4.sentence-3' class='sentence'>Otherwise <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, a<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#task.promise-15.4.sentence-3'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,operator_new'><div id='lib:operator_new,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator_new,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span><span class='operator'>*</span> <span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>size_t size, <span class='keyword'>const</span> Args<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.promise-16'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7698'>#</a></div><div class='texpara'><div id='task.promise-16.sentence-1' class='sentence'>If there is no parameter with type <span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span> then let
<span class='texttt'><i >alloc</i></span> be <span class='texttt'>Allocator<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-16.sentence-1'>.</a></div> <div id='task.promise-16.sentence-2' class='sentence'>Let <span class='texttt'><i >arg_<span class='shy'></span>next</i></span> be the parameter following the first
<span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span> parameter (if any) and let <span class='texttt'><i >alloc</i></span>
be <span class='texttt'>Allocator<span class='parenthesis'>(</span><i >arg_<span class='shy'></span>next</i><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.promise-16.sentence-2'>.</a></div> <div id='task.promise-16.sentence-3' class='sentence'>Then <span class='texttt'>PAlloc</span> is <span class='texttt'>allocator_<span class='shy'></span>traits<span class='anglebracket'>&lt;</span>Allocator<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>template</span>
rebind_<span class='shy'></span>alloc&#x200b;<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> where <span class='texttt'>U</span> is an unspecified type
whose size and alignment are both <span class='texttt'>__STDCPP_<span class='shy'></span>DEFAULT_<span class='shy'></span>NEW_<span class='shy'></span>ALIGNMENT__</span><a class='hidden_link' href='#task.promise-16.sentence-3'>.</a></div></div></div></div><div class='para' id='task.promise-17'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7708'>#</a></div><div class='texpara'><div id='task.promise-17.sentence-1' class='sentence'><i >Mandates</i>: <ul class='itemize'><li id='task.promise-17.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-17.1'>(17.1)</a></div><div class='texpara'><div id='task.promise-17.1.sentence-1' class='sentence'>The first parameter of type <span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span> (if any) is not the last parameter<a class='hidden_link' href='#task.promise-17.1.sentence-1'>.</a></div></div></li><li id='task.promise-17.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-17.2'>(17.2)</a></div><div class='texpara'><div id='task.promise-17.2.sentence-1' class='sentence'><span class='texttt'>Allocator<span class='parenthesis'>(</span><i >arg_<span class='shy'></span>next</i><span class='parenthesis'>)</span></span> is a valid expression if there is a parameter
of type <span class='texttt'>allocator_<span class='shy'></span>arg_<span class='shy'></span>t</span><a class='hidden_link' href='#task.promise-17.2.sentence-1'>.</a></div></div></li><li id='task.promise-17.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.promise-17.3'>(17.3)</a></div><div class='texpara'><div id='task.promise-17.3.sentence-1' class='sentence'><span class='texttt'>allocator_<span class='shy'></span>traits<span class='anglebracket'>&lt;</span>PAlloc<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>pointer</span> is a pointer type<a class='hidden_link' href='#task.promise-17.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='task.promise-18'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7717'>#</a></div><div class='texpara'><div id='task.promise-18.sentence-1' class='sentence'><i >Effects</i>: Initializes an allocator <span class='texttt'>palloc</span> of type <span class='texttt'>PAlloc</span> with
<span class='texttt'><i >alloc</i></span><a class='hidden_link' href='#task.promise-18.sentence-1'>.</a></div> <div id='task.promise-18.sentence-2' class='sentence'>Uses <span class='texttt'>palloc</span> to allocate storage for the
smallest array of <span class='texttt'>U</span> sufficient to provide storage for a
coroutine state of size <span class='texttt'>size</span>, and unspecified additional
state necessary to ensure that <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>delete</span></span> can later
deallocate this memory block with an allocator equal to <span class='texttt'>palloc</span><a class='hidden_link' href='#task.promise-18.sentence-2'>.</a></div></div></div></div><div class='para' id='task.promise-19'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7727'>#</a></div><div class='texpara'><div id='task.promise-19.sentence-1' class='sentence'><i >Returns</i>: A pointer to the allocated storage<a class='hidden_link' href='#task.promise-19.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:task::promise_type,operator_delete'><div id='lib:operator_delete,task::promise_type'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator_delete,task::promise_type'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span> pointer, size_t size<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.promise-20'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7737'>#</a></div><div class='texpara'><div id='task.promise-20.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>pointer</span> was returned from an invocation of the above overload
of <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>new</span></span> with a size argument equal to <span class='texttt'>size</span><a class='hidden_link' href='#task.promise-20.sentence-1'>.</a></div></div></div></div><div class='para' id='task.promise-21'><div class='marginalizedparent'><a class='marginalized' href='#task.promise-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7742'>#</a></div><div class='texpara'><div id='task.promise-21.sentence-1' class='sentence'><i >Effects</i>: Deallocates the storage pointed to by <span class='texttt'>pointer</span> using an
allocator equal to that used to allocate it<a class='hidden_link' href='#task.promise-21.sentence-1'>.</a></div></div></div></div></div></div></div><div id='scope' class='section'><h2 ><a class='secnum' href='#scope' style='min-width:65pt'>33.14</a> Execution scope utilities <a class='abbr_ref' href='exec.scope'>[exec.scope]</a></h2><div id='scope.concepts' class='section'><h3 ><a class='secnum' href='#scope.concepts' style='min-width:80pt'>33.14.1</a> Execution scope concepts <a class='abbr_ref' href='exec.scope.concepts'>[exec.scope.concepts]</a></h3><div class='para' id='scope.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#scope.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7752'>#</a></div><div class='texpara'><div id='scope.concepts-1.sentence-1' class='sentence'>The <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token________'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a> concept defines the requirements on
a type <span class='texttt'>Token</span> that can be used to create associations
between senders and an async scope<a class='hidden_link' href='#scope.concepts-1.sentence-1'>.</a></div></div></div><div class='para' id='scope.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#scope.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7757'>#</a></div><div class='texpara'><div id='scope.concepts-2.sentence-1' class='sentence'>Let <i >test-sender</i> and <i >test-env</i>
be unspecified types such that
<span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >test-sender</i>, <i >test-env</i><span class='anglebracket'>&gt;</span></span>
is modeled<a class='hidden_link' href='#scope.concepts-2.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='concept:scope_token'><span id='lib:scope_token'><span class='tcode_in_codeblock'>scope_<span class='shy'></span>token</span></span></span></a> <span class='operator'>=</span>
      <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable__'><span class='tcode_in_codeblock'>copyable</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span><span class='parenthesis'>(</span><span class='keyword'>const</span> Token token<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> token<span class='operator'>.</span>try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
        <span class='curlybracket'>{</span> token<span class='operator'>.</span>disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________________________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span>;
        <span class='curlybracket'>{</span> token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span><i >test-sender</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >test-env</i><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='scope.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#scope.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7776'>#</a></div><div class='texpara'><div id='scope.concepts-3.sentence-1' class='sentence'>A type <span class='texttt'>Token</span> models <a href='#concept:scope_token' title='33.14.1&emsp;Execution scope concepts&emsp;[exec.scope.concepts]'><span id='conceptref:scope_token_________'><span class='texttt'>scope_<span class='shy'></span>token</span></span></a> only if:</div></div><div class='texpara'><ul class='itemize'><li id='scope.concepts-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#scope.concepts-3.1'>(3.1)</a></div>no exceptions are thrown from
copy construction,
move construction,
copy assignment, or
move assignment
of objects of type <span class='texttt'>Token</span>; and</li><li id='scope.concepts-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#scope.concepts-3.2'>(3.2)</a></div>given an lvalue <span class='texttt'>token</span> of type (possibly const) <span class='texttt'>Token</span>,
for all expressions <span class='texttt'>sndr</span> such that
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br/>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________________________________'><span class='texttt'>sender</span></span></a>:
  <ul class='itemize'><li id='scope.concepts-3.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#scope.concepts-3.2.1'>(3.2.1)</a></div><span class='texttt'>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is a valid expression,</li><li id='scope.concepts-3.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#scope.concepts-3.2.2'>(3.2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________________________________'><span class='texttt'>sender</span></span></a>, and</li><li id='scope.concepts-3.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#scope.concepts-3.2.3'>(3.2.3)</a></div><span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>token<span class='operator'>.</span>wrap<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, E<span class='anglebracket'>&gt;</span></span>
  contains the same completion signatures as
  <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, E<span class='anglebracket'>&gt;</span></span>
  for all types <span class='texttt'>E</span> such that
  <span class='texttt'><a href='#concept:sender_in' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, E<span class='anglebracket'>&gt;</span></span> is modeled.</li></ul></li></ul></div></div></div><div id='counting.scopes' class='section'><h3 ><a class='secnum' href='#counting.scopes' style='min-width:80pt'>33.14.2</a> Counting Scopes <a class='abbr_ref' href='exec.counting.scopes'>[exec.counting.scopes]</a></h3><div id='counting.scopes.general' class='section'><h4 ><a class='secnum' href='#counting.scopes.general' style='min-width:95pt'>33.14.2.1</a> General <a class='abbr_ref' href='exec.counting.scopes.general'>[exec.counting.scopes.general]</a></h4><div class='para' id='counting.scopes.general-1'><div class='marginalizedparent'><a class='marginalized' href='#counting.scopes.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7810'>#</a></div><div class='texpara'><div id='counting.scopes.general-1.sentence-1' class='sentence'>Scopes of type <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope</span> and <span class='texttt'>counting_<span class='shy'></span>scope</span>
maintain counts of associations<a class='hidden_link' href='#counting.scopes.general-1.sentence-1'>.</a></div> <div id='counting.scopes.general-1.sentence-2' class='sentence'>Let:
<ul class='itemize'><li id='counting.scopes.general-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.1'>(1.1)</a></div><span class='texttt'>Scope</span> be either <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope</span> or <span class='texttt'>counting_<span class='shy'></span>scope</span>,</li><li id='counting.scopes.general-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.2'>(1.2)</a></div><span class='texttt'>scope</span> be an object of type <span class='texttt'>Scope</span>,</li><li id='counting.scopes.general-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.3'>(1.3)</a></div><span class='texttt'>tkn</span> be an object of type <span class='texttt'>Scope<span class='operator'>&#x200b;::&#x200b;</span>token</span>
obtained from <span class='texttt'>scope<span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,</li><li id='counting.scopes.general-1.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.4'>(1.4)</a></div><span class='texttt'>jsndr</span> be a sender obtained from <span class='texttt'>scope<span class='operator'>.</span>join<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and</li><li id='counting.scopes.general-1.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.5'>(1.5)</a></div><span class='texttt'>op</span> be an operation state obtained from
connecting <span class='texttt'>jsndr</span> to a receiver<a class='hidden_link' href='#counting.scopes.general-1.sentence-2'>.</a></li></ul></div> <div id='counting.scopes.general-1.sentence-3' class='sentence'>
During its lifetime <span class='texttt'>scope</span> goes through different states
which govern what operations are allowed and the result of these operations:</div></div><div class='texpara'><ul class='itemize'><li id='counting.scopes.general-1.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.6'>(1.6)</a></div><div class='texpara'><div id='counting.scopes.general-1.6.sentence-1' class='sentence'><span class='texttt'><i >unused</i></span>:
a newly constructed object starts in the <span class='texttt'><i >unused</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.6.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.7'>(1.7)</a></div><div class='texpara'><div id='counting.scopes.general-1.7.sentence-1' class='sentence'><span class='texttt'><i >open</i></span>:
when <span class='texttt'>tkn<span class='operator'>.</span>try_<span class='shy'></span>associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called
while <span class='texttt'>scope</span> is in the <span class='texttt'><i >unused</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >open</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.7.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.8'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.8'>(1.8)</a></div><div class='texpara'><div id='counting.scopes.general-1.8.sentence-1' class='sentence'><span class='texttt'><i >open-and-joining</i></span>:
when the operation state <span class='texttt'>op</span> is started
while <span class='texttt'>scope</span> is in the <span class='texttt'><i >unused</i></span> or <span class='texttt'><i >open</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >open-and-joining</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.8.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.9'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.9'>(1.9)</a></div><div class='texpara'><div id='counting.scopes.general-1.9.sentence-1' class='sentence'><span class='texttt'><i >closed</i></span>:
when <span class='texttt'>scope<span class='operator'>.</span>close<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called
while <span class='texttt'>scope</span> is in the <span class='texttt'><i >open</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >closed</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.9.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.10'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.10'>(1.10)</a></div><div class='texpara'><div id='counting.scopes.general-1.10.sentence-1' class='sentence'><span class='texttt'><i >unused-and-closed</i></span>:
when <span class='texttt'>scope<span class='operator'>.</span>close<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called
while <span class='texttt'>scope</span> is in the <span class='texttt'><i >unused</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >unused-and-closed</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.10.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.11'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.11'>(1.11)</a></div><div class='texpara'><div id='counting.scopes.general-1.11.sentence-1' class='sentence'><span class='texttt'><i >closed-and-joining</i></span>:
when <span class='texttt'>scope<span class='operator'>.</span>close<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called
while <span class='texttt'>scope</span> is in the <span class='texttt'><i >open-and-joining</i></span> state or
the operation state <span class='texttt'>op</span> is started
while <span class='texttt'>scope</span> is in
the <span class='texttt'><i >closed</i></span> or <span class='texttt'><i >unused-and-closed</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >closed-and-joining</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.11.sentence-1'>.</a></div></div></li><li id='counting.scopes.general-1.12'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#counting.scopes.general-1.12'>(1.12)</a></div><div class='texpara'><div id='counting.scopes.general-1.12.sentence-1' class='sentence'><span class='texttt'><i >joined</i></span>:
when the count of assocations drops to zero
while <span class='texttt'>scope</span> is in
the <span class='texttt'><i >open-and-joining</i></span> or <span class='texttt'><i >closed-and-joining</i></span> state,
<span class='texttt'>scope</span> moves to the <span class='texttt'><i >joined</i></span> state<a class='hidden_link' href='#counting.scopes.general-1.12.sentence-1'>.</a></div></div></li></ul></div></div><div class='para' id='counting.scopes.general-2'><div class='marginalizedparent'><a class='marginalized' href='#counting.scopes.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7877'>#</a></div><div class='texpara'><div id='counting.scopes.general-2.sentence-1' class='sentence'><i >Recommended practice</i>: For <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope</span> and <span class='texttt'>counting_<span class='shy'></span>scope</span>,
implementations should store the state and the count of associations
in a single member of type <span class='texttt'>size_<span class='shy'></span>t</span><a class='hidden_link' href='#counting.scopes.general-2.sentence-1'>.</a></div></div></div><div class='para' id='counting.scopes.general-3'><div class='marginalizedparent'><a class='marginalized' href='#counting.scopes.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7883'>#</a></div><div class='texpara'><div id='counting.scopes.general-3.sentence-1' class='sentence'>Subclause <a href='#counting.scopes' title='33.14.2&emsp;Counting Scopes'>[exec.<span class='shy'></span>counting.<span class='shy'></span>scopes]</a> makes use of
the following exposition-only entities:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>struct</span> <i >scope-join-t</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;     <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>enum</span> <i >scope-state-type</i> <span class='curlybracket'>{</span>     <span class='comment'>// <i >exposition only</i></span>
  <i >unused</i>,                   <span class='comment'>// <i >exposition only</i></span>
  <i >open</i>,                     <span class='comment'>// <i >exposition only</i></span>
  <i >closed</i>,                   <span class='comment'>// <i >exposition only</i></span>
  <i >open-and-joining</i>,         <span class='comment'>// <i >exposition only</i></span>
  <i >closed-and-joining</i>,       <span class='comment'>// <i >exposition only</i></span>
  <i >unused-and-closed</i>,        <span class='comment'>// <i >exposition only</i></span>
  <i >joined</i>,                   <span class='comment'>// <i >exposition only</i></span>
<span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='counting.scopes.general-4'><div class='marginalizedparent'><a class='marginalized' href='#counting.scopes.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L7901'>#</a></div><div class='texpara'><div id='counting.scopes.general-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#snd.general' title='33.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >scope-join-t</i></span> as follows:</div></div><div class='texpara'><a class='index' id='lib:execution::impls-for<scope-join-t>'></a><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >scope-join-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Scope, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >state</i> <span class='curlybracket'>{</span>                          <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>struct</span> <i >rcvr-t</i> <span class='curlybracket'>{</span>                       <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

        Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                         <span class='comment'>// <i >exposition only</i></span>

        <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

        <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> E<span class='anglebracket'>&gt;</span>
          <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>E<span class='operator'>&amp;</span><span class='operator'>&amp;</span> e<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
            execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>

        <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

        <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>;

      <span class='keyword'>using</span> <i >sched-sender</i> <span class='operator'>=</span>                  <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>decltype</span><span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>get_scheduler<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='keyword'>using</span> <i >op-t</i> <span class='operator'>=</span>                          <span class='comment'>// <i >exposition only</i></span>
        connect_result_t<span class='anglebracket'>&lt;</span><i >sched-sender</i>, <i >rcvr-t</i><span class='anglebracket'>&gt;</span>;

      Scope<span class='operator'>*</span> <i >scope</i>;                         <span class='comment'>// <i >exposition only</i></span>
      Rcvr<span class='operator'>&amp;</span> <i >receiver</i>;                       <span class='comment'>// <i >exposition only</i></span>
      <i >op-t</i> <i >op</i>;                              <span class='comment'>// <i >exposition only</i></span>

      <i >state</i><span class='parenthesis'>(</span>Scope<span class='operator'>*</span> scope, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span>       <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable____'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>connect_t, <i >sched-sender</i>, <i >rcvr-t</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>
        <span class='operator'>:</span> <i >scope</i><span class='parenthesis'>(</span>scope<span class='parenthesis'>)</span>,
          <i >receiver</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>,
          <i >op</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>get_scheduler<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >rcvr-t</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>            <span class='comment'>// <i >exposition only</i></span>
        start<span class='parenthesis'>(</span><i >op</i><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete-inline</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>     <span class='comment'>// <i >exposition only</i></span>
        set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >receiver</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span>       <span class='comment'>// <i >exposition only</i></span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> sender, Rcvr<span class='operator'>&amp;</span> receiver<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, <i >data-type</i><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>sender<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span><span class='squarebracket'>[</span>_, self<span class='squarebracket'>]</span> <span class='operator'>=</span> sender;
        <span class='keyword'>return</span> <i >state</i><span class='parenthesis'>(</span>self, receiver<span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span>           <span class='comment'>// <i >exposition only</i></span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> s, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span>s<span class='operator'>.</span><i >scope</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >start-join-sender</i><span class='parenthesis'>(</span>s<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
          s<span class='operator'>.</span><i >complete-inline</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='scope.simple.counting' class='section'><h4 ><a class='secnum' href='#scope.simple.counting' style='min-width:95pt'>33.14.2.2</a> Simple Counting Scope <a class='abbr_ref' href='exec.scope.simple.counting'>[exec.scope.simple.counting]</a></h4><div id='scope.simple.counting.general' class='section'><h4 ><a class='secnum' href='#scope.simple.counting.general' style='min-width:110pt'>33.14.2.2.1</a> General <a class='abbr_ref' href='exec.scope.simple.counting.general'>[exec.scope.simple.counting.general]</a></h4><div class='texpara'><span id='lib:execution::simple_counting_scope'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::simple_counting_scope'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> simple_counting_scope <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#simple.counting.token' title='33.14.2.2.4&emsp;Token'>[exec.<span class='shy'></span>simple.<span class='shy'></span>counting.<span class='shy'></span>token]</a>, token</span>
    <span class='keyword'>struct</span> token;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> size_t max_associations <span class='operator'>=</span> <i ><span class='texttt'><a class='index' id=':value_of_std::execution::simple_counting_scope::max_associations'></a>implementation-defined</span></i>;

    <span class='comment'>// <a href='#simple.counting.ctor' title='33.14.2.2.2&emsp;Constructor and Destructor'>[exec.<span class='shy'></span>simple.<span class='shy'></span>counting.<span class='shy'></span>ctor]</a>, constructor and destructor</span>
    simple_counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    simple_counting_scope<span class='parenthesis'>(</span>simple_counting_scope<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>simple_counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='#simple.counting.mem' title='33.14.2.2.3&emsp;Members'>[exec.<span class='shy'></span>simple.<span class='shy'></span>counting.<span class='shy'></span>mem]</a>, members</span>
    token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> close<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>auto</span> join<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    size_t <i >count</i>;                                       <span class='comment'>// <i >exposition only</i></span>
    <i >scope-state-type</i> <i >state</i>;                             <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>bool</span> <i >try-associate</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >disassociate</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State<span class='anglebracket'>&gt;</span>
      <span class='keyword'>bool</span> <i >start-join-sender</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='para' id='scope.simple.counting.general-1'><div class='marginalizedparent'><a class='marginalized' href='#scope.simple.counting.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8012'>#</a></div><div class='texpara'><div id='scope.simple.counting.general-1.sentence-1' class='sentence'>For purposes of determining the existence of a data race,
<span class='texttt'>get_<span class='shy'></span>token</span>,
<span class='texttt'>close</span>,
<span class='texttt'>join</span>,
<span class='texttt'><i >try-associate</i></span>,
<span class='texttt'><i >disassociate</i></span>, and
<span class='texttt'><i >start-join-sender</i></span>
behave as atomic operations (<a href='intro.multithread' title='6.10.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>)<a class='hidden_link' href='#scope.simple.counting.general-1.sentence-1'>.</a></div> <div id='scope.simple.counting.general-1.sentence-2' class='sentence'>These operations on a single object of
type simple_counting_scope appear to occur in a single total order<a class='hidden_link' href='#scope.simple.counting.general-1.sentence-2'>.</a></div></div></div></div><div id='simple.counting.ctor' class='section'><h4 ><a class='secnum' href='#simple.counting.ctor' style='min-width:110pt'>33.14.2.2.2</a> Constructor and Destructor <a class='abbr_ref' href='exec.simple.counting.ctor'>[exec.simple.counting.ctor]</a></h4><div class='texpara'><div id='lib:execution::simple_counting_scope,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::simple_counting_scope,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>simple_counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='simple.counting.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8032'>#</a></div><div class='texpara'><div id='simple.counting.ctor-1.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >count</i></span> is <span class='texttt'><span class='literal'>0</span></span> and <span class='texttt'><i >state</i></span> is <span class='texttt'><i >unused</i></span><a class='hidden_link' href='#simple.counting.ctor-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::simple_counting_scope,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>simple_counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='simple.counting.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8043'>#</a></div><div class='texpara'><div id='simple.counting.ctor-2.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >state</i></span> is not one of
<span class='texttt'><i >joined</i></span>, <span class='texttt'><i >unused</i></span>, or <span class='texttt'><i >unused-and-closed</i></span>,
invokes <span class='texttt'>terminate</span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#simple.counting.ctor-2.sentence-1'>.</a></div> <div id='simple.counting.ctor-2.sentence-2' class='sentence'>Otherwise, has no effects<a class='hidden_link' href='#simple.counting.ctor-2.sentence-2'>.</a></div></div></div></div></div><div id='simple.counting.mem' class='section'><h4 ><a class='secnum' href='#simple.counting.mem' style='min-width:110pt'>33.14.2.2.3</a> Members <a class='abbr_ref' href='exec.simple.counting.mem'>[exec.simple.counting.mem]</a></h4><div class='texpara'><div id='lib:execution::simple_counting_scope,get_token'><div id='lib:get_token,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_token,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'>token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8059'>#</a></div><div class='texpara'><div id='simple.counting.mem-1.sentence-1' class='sentence'><i >Returns</i>: An object <span class='texttt'>t</span> of type <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope<span class='operator'>&#x200b;::&#x200b;</span>token</span> such that
<span class='texttt'>t<span class='operator'>.</span><span class='texttt'><i >scope</i></span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#simple.counting.mem-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,close'><div id='lib:close,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:close,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> close<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8071'>#</a></div><div class='texpara'><div id='simple.counting.mem-2.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >state</i></span> is
<ul class='itemize'><li id='simple.counting.mem-2.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-2.1'>(2.1)</a></div><span class='texttt'><i >unused</i></span>, then changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >unused-and-closed</i></span>;</li><li id='simple.counting.mem-2.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-2.2'>(2.2)</a></div><span class='texttt'><i >open</i></span>, then changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >closed</i></span>;</li><li id='simple.counting.mem-2.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-2.3'>(2.3)</a></div><span class='texttt'><i >open-and-joining</i></span>,
then changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >closed-and-joining</i></span>;</li><li id='simple.counting.mem-2.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-2.4'>(2.4)</a></div>otherwise, no effects<a class='hidden_link' href='#simple.counting.mem-2.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='simple.counting.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8086'>#</a></div><div class='texpara'><div id='simple.counting.mem-3.sentence-1' class='sentence'><i >Postconditions</i>: Any subsequent call to <span class='texttt'><span class='texttt'><i >try-associate</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> on <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>
returns <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#simple.counting.mem-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,join'><div id='lib:join,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:join,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________________________________________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>auto</span> join<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8098'>#</a></div><div class='texpara'><div id='simple.counting.mem-4.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span><span class='texttt'><i >scope-join-t</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#simple.counting.mem-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,try-associate'><div id='lib:try-associate,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:try-associate,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> <span class='texttt'><i >try-associate</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8109'>#</a></div><div class='texpara'><div id='simple.counting.mem-5.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >count</i></span> is equal to <span class='texttt'>max_<span class='shy'></span>associations</span>, then no effects<a class='hidden_link' href='#simple.counting.mem-5.sentence-1'>.</a></div> <div id='simple.counting.mem-5.sentence-2' class='sentence'>Otherwise, if <span class='texttt'><i >state</i></span> is
<ul class='itemize'><li id='simple.counting.mem-5.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-5.1'>(5.1)</a></div><span class='texttt'><i >unused</i></span>,
then increments <span class='texttt'><i >count</i></span> and changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >open</i></span>;</li><li id='simple.counting.mem-5.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-5.2'>(5.2)</a></div><span class='texttt'><i >open</i></span> or <span class='texttt'><i >open-and-joining</i></span>,
then increments <span class='texttt'><i >count</i></span>;</li><li id='simple.counting.mem-5.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-5.3'>(5.3)</a></div>otherwise, no effects<a class='hidden_link' href='#simple.counting.mem-5.sentence-2'>.</a></li></ul></div></div></div></div><div class='para' id='simple.counting.mem-6'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8124'>#</a></div><div class='texpara'><div id='simple.counting.mem-6.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> if <span class='texttt'><i >count</i></span> was incremented, <span class='texttt'><span class='literal'>false</span></span> otherwise<a class='hidden_link' href='#simple.counting.mem-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,disassociate'><div id='lib:disassociate,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:disassociate,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >disassociate</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-7'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8135'>#</a></div><div class='texpara'><div id='simple.counting.mem-7.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'><i >count</i></span> is greater than zero<a class='hidden_link' href='#simple.counting.mem-7.sentence-1'>.</a></div></div></div></div><div class='para' id='simple.counting.mem-8'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8139'>#</a></div><div class='texpara'><div id='simple.counting.mem-8.sentence-1' class='sentence'><i >Effects</i>: Decrements <span class='texttt'><i >count</i></span><a class='hidden_link' href='#simple.counting.mem-8.sentence-1'>.</a></div> <div id='simple.counting.mem-8.sentence-2' class='sentence'>If <span class='texttt'><i >count</i></span> is zero after decrementing and
<span class='texttt'><i >state</i></span> is <span class='texttt'><i >open-and-joining</i></span> or <span class='texttt'><i >closed-and-joining</i></span>,
changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >joined</i></span> and
calls <span class='texttt'><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> on all objects registered with <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#simple.counting.mem-8.sentence-2'>.</a></div> <div id='simple.counting.mem-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#simple.counting.mem-note-1'>1</a></i>:&ensp;<div id='simple.counting.mem-8.sentence-3' class='sentence'>Calling <span class='texttt'><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> on any registered object
can cause <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> to be destroyed<a class='hidden_link' href='#simple.counting.mem-8.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope,start-join-sender'><div id='lib:start-join-sender,execution::simple_counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:start-join-sender,execution::simple_counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State<span class='anglebracket'>&gt;</span>
  <span class='keyword'>bool</span> <span class='texttt'><i >start-join-sender</i></span><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> st<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.mem-9'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.mem-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8159'>#</a></div><div class='texpara'><div id='simple.counting.mem-9.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'><i >state</i></span> is
<ul class='itemize'><li id='simple.counting.mem-9.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-9.1'>(9.1)</a></div><span class='texttt'><i >unused</i></span>, <span class='texttt'><i >unused-and-closed</i></span>, or <span class='texttt'><i >joined</i></span>, then
changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >joined</i></span> and returns <span class='texttt'><span class='literal'>true</span></span>;</li><li id='simple.counting.mem-9.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-9.2'>(9.2)</a></div><span class='texttt'><i >open</i></span> or <span class='texttt'><i >open-and-joining</i></span>, then
changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >open-and-joining</i></span>,
registers <span class='texttt'>st</span> with <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and returns <span class='texttt'><span class='literal'>false</span></span>;</li><li id='simple.counting.mem-9.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#simple.counting.mem-9.3'>(9.3)</a></div><span class='texttt'><i >closed</i></span> or <span class='texttt'><i >closed-and-joining</i></span>, then
changes <span class='texttt'><i >state</i></span> to <span class='texttt'><i >closed-and-joining</i></span>,
registers <span class='texttt'>st</span> with <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and returns <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#simple.counting.mem-9.sentence-1'>.</a></li></ul></div></div></div></div></div><div id='simple.counting.token' class='section'><h4 ><a class='secnum' href='#simple.counting.token' style='min-width:110pt'>33.14.2.2.4</a> Token <a class='abbr_ref' href='exec.simple.counting.token'>[exec.simple.counting.token]</a></h4><div class='texpara'><span id='lib:execution::simple_counting_scope::token'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::simple_counting_scope::token'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> simple_counting_scope<span class='operator'>::</span>token <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
      Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> wrap<span class='parenthesis'>(</span>Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> snd<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    simple_counting_scope<span class='operator'>*</span> <i >scope</i>;   <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='texpara'><div id='lib:execution::simple_counting_scope::token,wrap'><div id='lib:wrap,execution::simple_counting_scope::token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wrap,execution::simple_counting_scope::token'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________________________________________________'><span class='texttt'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> wrap<span class='parenthesis'>(</span>Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> snd<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.token-1'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.token-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8201'>#</a></div><div class='texpara'><div id='simple.counting.token-1.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>snd<span class='parenthesis'>)</span></span><a class='hidden_link' href='#simple.counting.token-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope::token,try_associate'><div id='lib:try_associate,execution::simple_counting_scope::token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:try_associate,execution::simple_counting_scope::token'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.token-2'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.token-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8212'>#</a></div><div class='texpara'><div id='simple.counting.token-2.sentence-1' class='sentence'><i >Effects</i>: Equivalent to: <span class='texttt'><span class='keyword'>return</span> <span class='texttt'><i >scope</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >try-associate</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;</span></div></div></div></div><div class='texpara'><div id='lib:execution::simple_counting_scope::token,disassociate'><div id='lib:disassociate,execution::simple_counting_scope::token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:disassociate,execution::simple_counting_scope::token'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='simple.counting.token-3'><div class='marginalizedparent'><a class='marginalized' href='#simple.counting.token-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8223'>#</a></div><div class='texpara'><div id='simple.counting.token-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'><span class='texttt'><i >scope</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >disassociate</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#simple.counting.token-3.sentence-1'>.</a></div></div></div></div></div></div><div id='scope.counting' class='section'><h4 ><a class='secnum' href='#scope.counting' style='min-width:95pt'>33.14.2.3</a> Counting Scope <a class='abbr_ref' href='exec.scope.counting'>[exec.scope.counting]</a></h4><div class='texpara'><span id='lib:execution::counting_scope,token'><span id='lib:token,execution::counting_scope'><span id='lib:execution::counting_scope'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:execution::counting_scope'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> counting_scope <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>struct</span> token <span class='curlybracket'>{</span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
        <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>auto</span> wrap<span class='parenthesis'>(</span>Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> snd<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
      <span class='keyword'>bool</span> try_associate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
      <span class='keyword'>void</span> disassociate<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>private</span><span class='operator'>:</span>
      counting_scope<span class='operator'>*</span> <i >scope</i>;                            <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> size_t max_associations <span class='operator'>=</span> <i ><span class='texttt'><a class='index' id=':value_of_std::execution::counting_scope::max_associations'></a>implementation-defined</span></i>;

    counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    counting_scope<span class='parenthesis'>(</span>counting_scope<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>counting_scope<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> close<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________________________________________________'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>auto</span> join<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    size_t <i >count</i>;                                       <span class='comment'>// <i >exposition only</i></span>
    <i >scope-state-type</i> <i >state</i>;                             <span class='comment'>// <i >exposition only</i></span>
    inplace_stop_source <i >s_source</i>;                       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>bool</span> <i >try-associate</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >disassociate</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State<span class='anglebracket'>&gt;</span>
      <span class='keyword'>bool</span> <i >start-join-sender</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></span></span></div><div class='para' id='scope.counting-1'><div class='marginalizedparent'><a class='marginalized' href='#scope.counting-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8271'>#</a></div><div class='texpara'><div id='scope.counting-1.sentence-1' class='sentence'><span class='texttt'>counting_<span class='shy'></span>scope</span> differs from <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope</span> by
adding support for cancellation<a class='hidden_link' href='#scope.counting-1.sentence-1'>.</a></div> <div id='scope.counting-1.sentence-2' class='sentence'>Unless specified below, the semantics of members of <span class='texttt'>counting_<span class='shy'></span>scope</span>
are the same as the corresponding members of <span class='texttt'>simple_<span class='shy'></span>counting_<span class='shy'></span>scope</span><a class='hidden_link' href='#scope.counting-1.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:execution::counting_scope,get_token'><div id='lib:get_token,execution::counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_token,execution::counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'>token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='scope.counting-2'><div class='marginalizedparent'><a class='marginalized' href='#scope.counting-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8283'>#</a></div><div class='texpara'><div id='scope.counting-2.sentence-1' class='sentence'><i >Returns</i>: An object <span class='texttt'>t</span> of type <span class='texttt'>counting_<span class='shy'></span>scope<span class='operator'>&#x200b;::&#x200b;</span>token</span> such that
<span class='texttt'>t<span class='operator'>.</span><span class='texttt'><i >scope</i></span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#scope.counting-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::counting_scope,request_stop'><div id='lib:request_stop,execution::counting_scope'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:request_stop,execution::counting_scope'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='scope.counting-3'><div class='marginalizedparent'><a class='marginalized' href='#scope.counting-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8295'>#</a></div><div class='texpara'><div id='scope.counting-3.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'><span class='texttt'><i >s_<span class='shy'></span>source</i></span><span class='operator'>.</span>request_<span class='shy'></span>stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#scope.counting-3.sentence-1'>.</a></div></div></div></div><div class='para' id='scope.counting-4'><div class='marginalizedparent'><a class='marginalized' href='#scope.counting-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8299'>#</a></div><div class='texpara'><div id='scope.counting-4.sentence-1' class='sentence'><i >Remarks</i>: Calls to <span class='texttt'>request_<span class='shy'></span>stop</span> do not introduce data races<a class='hidden_link' href='#scope.counting-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:execution::counting_scope::token,wrap'><div id='lib:wrap,execution::counting_scope::token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wrap,execution::counting_scope::token'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________________________________________________'><span class='texttt'>sender</span></span></a> Sender<span class='anglebracket'>&gt;</span>
  <a href='#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________________________________________________________'><span class='texttt'>sender</span></span></a> <span class='keyword'>auto</span> counting_scope<span class='operator'>::</span>token<span class='operator'>::</span>wrap<span class='parenthesis'>(</span>Sender<span class='operator'>&amp;</span><span class='operator'>&amp;</span> snd<span class='parenthesis'>)</span> <span class='keyword'>const</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span>, Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='scope.counting-5'><div class='marginalizedparent'><a class='marginalized' href='#scope.counting-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8312'>#</a></div><div class='texpara'><div id='scope.counting-5.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> <i >stop-when</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sender<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>snd<span class='parenthesis'>)</span>, <i >scope</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >s_source</i><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div></div></div><div id='par.scheduler' class='section'><h2 ><a class='secnum' href='#par.scheduler' style='min-width:65pt'>33.15</a> Parallel scheduler <a class='abbr_ref' href='exec.par.scheduler'>[exec.par.scheduler]</a></h2><div class='para' id='par.scheduler-1'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8322'>#</a></div><div class='texpara'><div id='par.scheduler-1.sentence-1' class='sentence'><span class='texttt'>parallel_<span class='shy'></span>scheduler</span> models <a href='#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler________________________'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#par.scheduler-1.sentence-1'>.</a></div></div></div><div class='para' id='par.scheduler-2'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8325'>#</a></div><div class='texpara'><div id='par.scheduler-2.sentence-1' class='sentence'>Let <span class='texttt'>sch</span> be an object of type <span class='texttt'>parallel_<span class='shy'></span>scheduler</span>, and
let <span class='texttt'><span class='texttt'><i >BACKEND-OF</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> be <span class='texttt'><span class='operator'>*</span>ptr</span>,
where <span class='texttt'>sch</span> is associated with <span class='texttt'>ptr</span><a class='hidden_link' href='#par.scheduler-2.sentence-1'>.</a></div></div></div><div class='para' id='par.scheduler-3'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8330'>#</a></div><div class='texpara'><div id='par.scheduler-3.sentence-1' class='sentence'>The expression <span class='texttt'>get_<span class='shy'></span>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> returns
<span class='texttt'>forward_<span class='shy'></span>progress_<span class='shy'></span>guarantee<span class='operator'>&#x200b;::&#x200b;</span>parallel</span><a class='hidden_link' href='#par.scheduler-3.sentence-1'>.</a></div></div></div><div class='para' id='par.scheduler-4'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8334'>#</a></div><div class='texpara'><div id='par.scheduler-4.sentence-1' class='sentence'>Let <span class='texttt'>sch2</span> be an object of type <span class='texttt'>parallel_<span class='shy'></span>scheduler</span><a class='hidden_link' href='#par.scheduler-4.sentence-1'>.</a></div> <div id='par.scheduler-4.sentence-2' class='sentence'>Two objects <span class='texttt'>sch</span> and <span class='texttt'>sch2</span> compare equal if and only if
<span class='texttt'><span class='texttt'><i >BACKEND-OF</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> and
<span class='texttt'><span class='texttt'><i >BACKEND-OF</i></span><span class='parenthesis'>(</span>sch2<span class='parenthesis'>)</span></span> refer to the same object<a class='hidden_link' href='#par.scheduler-4.sentence-2'>.</a></div></div></div><div class='para' id='par.scheduler-5'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8340'>#</a></div><div class='texpara'><div id='par.scheduler-5.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver<a class='hidden_link' href='#par.scheduler-5.sentence-1'>.</a></div> <div id='par.scheduler-5.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:proxy' title='33.15&emsp;Parallel scheduler&emsp;[exec.par.scheduler]'><span id='def:proxy'><i >proxy</i></span></a> for <span class='texttt'>rcvr</span> with base <span class='texttt'>B</span> is
an lvalue <span class='texttt'>r</span> of type <span class='texttt'>B</span> such that:
<ul class='itemize'><li id='par.scheduler-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-5.1'>(5.1)</a></div><div class='texpara'><div id='par.scheduler-5.1.sentence-1' class='sentence'><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> has effects equivalent to
<span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-5.1.sentence-1'>.</a></div></div></li><li id='par.scheduler-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-5.2'>(5.2)</a></div><div class='texpara'><div id='par.scheduler-5.2.sentence-1' class='sentence'><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>, where <span class='texttt'>e</span> is an <span class='texttt'>exception_<span class='shy'></span>ptr</span> object,
has effects equivalent to <span class='texttt'>set_<span class='shy'></span>error<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>&#x200b;rcvr<span class='parenthesis'>)</span>, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-5.2.sentence-1'>.</a></div></div></li><li id='par.scheduler-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-5.3'>(5.3)</a></div><div class='texpara'><div id='par.scheduler-5.3.sentence-1' class='sentence'><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> has effects equivalent to
<span class='texttt'>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-5.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='par.scheduler-6'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8356'>#</a></div><div class='texpara'><div id='par.scheduler-6.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:preallocated_backend_storage_for_a_proxy' title='33.15&emsp;Parallel scheduler&emsp;[exec.par.scheduler]'><span id='def:preallocated_backend_storage_for_a_proxy'><i >preallocated backend storage for a proxy</i></span></a> <span class='texttt'>r</span> is
an object <span class='texttt'>s</span> of type <span class='texttt'>span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span></span>
such that the range <span class='texttt'>s</span> remains valid and may be overwritten
until one of <span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, or <span class='texttt'>set_<span class='shy'></span>stopped</span>
is called on <span class='texttt'>r</span><a class='hidden_link' href='#par.scheduler-6.sentence-1'>.</a></div> <div id='par.scheduler-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#par.scheduler-note-1'>1</a></i>:&ensp;<div id='par.scheduler-6.sentence-2' class='sentence'>The storage referenced by <span class='texttt'>s</span> can be used as temporary storage
for operations launched via calls to <span class='texttt'>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span><a class='hidden_link' href='#par.scheduler-6.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='par.scheduler-7'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8367'>#</a></div><div class='texpara'><div id='par.scheduler-7.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:proxy,bulk_chunked' title='33.15&emsp;Parallel scheduler&emsp;[exec.par.scheduler]'><span id='def:proxy,bulk_chunked'><i >bulk chunked proxy</i></span></a> for <span class='texttt'>rcvr</span>
with callable <span class='texttt'>f</span> and arguments <span class='texttt'>args</span>
is a proxy <span class='texttt'>r</span> for <span class='texttt'>rcvr</span>
with base <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability<span class='operator'>&#x200b;::&#x200b;</span>bulk_<span class='shy'></span>item_<span class='shy'></span>receiver_<span class='shy'></span>proxy</span>
such that
<span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>i, j<span class='parenthesis'>)</span></span> for indices <span class='texttt'>i</span> and <span class='texttt'>j</span>
has effects equivalent to <span class='texttt'>f<span class='parenthesis'>(</span>i, j, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-7.sentence-1'>.</a></div></div></div><div class='para' id='par.scheduler-8'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8376'>#</a></div><div class='texpara'><div id='par.scheduler-8.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:proxy,bulk_unchunked' title='33.15&emsp;Parallel scheduler&emsp;[exec.par.scheduler]'><span id='def:proxy,bulk_unchunked'><i >bulk unchunked proxy</i></span></a> for <span class='texttt'>rcvr</span>
with callable <span class='texttt'>f</span> and arguments <span class='texttt'>args</span>
is a proxy <span class='texttt'>r</span> for <span class='texttt'>rcvr</span>
with base <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability<span class='operator'>&#x200b;::&#x200b;</span>bulk_<span class='shy'></span>item_<span class='shy'></span>receiver_<span class='shy'></span>proxy</span>
such that
<span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>i, i <span class='operator'>+</span> <span class='literal'>1</span><span class='parenthesis'>)</span></span> for index <span class='texttt'>i</span>
has effects equivalent to <span class='texttt'>f<span class='parenthesis'>(</span>i, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-8.sentence-1'>.</a></div></div></div><div class='para' id='par.scheduler-9'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8385'>#</a></div><div class='texpara'><div id='par.scheduler-9.sentence-1' class='sentence'>Let <span class='texttt'>b</span> be <span class='texttt'><span class='texttt'><i >BACKEND-OF</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span>,
let <span class='texttt'>sndr</span> be the object returned by <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span>, and
let <span class='texttt'>rcvr</span> be a receiver<a class='hidden_link' href='#par.scheduler-9.sentence-1'>.</a></div> <div id='par.scheduler-9.sentence-2' class='sentence'>If <span class='texttt'>rcvr</span> is connected to <span class='texttt'>sndr</span> and
the resulting operation state is started, then:
<ul class='itemize'><li id='par.scheduler-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-9.1'>(9.1)</a></div><div class='texpara'><div id='par.scheduler-9.1.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> completes successfully,
then <span class='texttt'>b<span class='operator'>.</span>schedule<span class='parenthesis'>(</span>r, s<span class='parenthesis'>)</span></span> is called, where
<ul class='itemize'><li id='par.scheduler-9.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-9.1.1'>(9.1.1)</a></div><span class='texttt'>r</span> is a proxy for <span class='texttt'>rcvr</span>
with base <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability<span class='operator'>&#x200b;::&#x200b;</span>receiver_<span class='shy'></span>proxy</span> and</li><li id='par.scheduler-9.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-9.1.2'>(9.1.2)</a></div><span class='texttt'>s</span> is a preallocated backend storage for <span class='texttt'>r</span><a class='hidden_link' href='#par.scheduler-9.1.sentence-1'>.</a></li></ul></div></div></li><li id='par.scheduler-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-9.2'>(9.2)</a></div><div class='texpara'><div id='par.scheduler-9.2.sentence-1' class='sentence'>All other completion operations are forwarded unchanged<a class='hidden_link' href='#par.scheduler-9.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='par.scheduler-10'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8406'>#</a></div><div class='texpara'><div id='par.scheduler-10.sentence-1' class='sentence'><span class='texttt'>parallel_<span class='shy'></span>scheduler</span> provides a customized implementation of
the <span class='texttt'>bulk_<span class='shy'></span>chunked</span> algorithm (<a href='#bulk' title='33.9.12.11&emsp;execution&#x200b;::&#x200b;bulk, execution&#x200b;::&#x200b;bulk_&shy;chunked, and execution&#x200b;::&#x200b;bulk_&shy;unchunked'>[exec.<span class='shy'></span>bulk]</a>)<a class='hidden_link' href='#par.scheduler-10.sentence-1'>.</a></div> <div id='par.scheduler-10.sentence-2' class='sentence'>If a receiver <span class='texttt'>rcvr</span> is connected to the sender
returned by <span class='texttt'>bulk_<span class='shy'></span>chunked<span class='parenthesis'>(</span>sndr, pol, shape, f<span class='parenthesis'>)</span></span> and
the resulting operation state is started, then:
<ul class='itemize'><li id='par.scheduler-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-10.1'>(10.1)</a></div><div class='texpara'><div id='par.scheduler-10.1.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> completes with values <span class='texttt'>vals</span>,
let <span class='texttt'>args</span> be a pack of lvalue subexpressions designating <span class='texttt'>vals</span>,
then <span class='texttt'>b<span class='operator'>.</span>schedule_<span class='shy'></span>bulk_<span class='shy'></span>chunked<span class='parenthesis'>(</span>shape, r, s<span class='parenthesis'>)</span></span> is called, where
<ul class='itemize'><li id='par.scheduler-10.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-10.1.1'>(10.1.1)</a></div><span class='texttt'>r</span> is a bulk chunked proxy for <span class='texttt'>rcvr</span>
with callable <span class='texttt'>f</span> and arguments <span class='texttt'>args</span> and</li><li id='par.scheduler-10.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-10.1.2'>(10.1.2)</a></div><span class='texttt'>s</span> is a preallocated backend storage for <span class='texttt'>r</span><a class='hidden_link' href='#par.scheduler-10.1.sentence-1'>.</a></li></ul></div></div></li><li id='par.scheduler-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-10.2'>(10.2)</a></div><div class='texpara'><div id='par.scheduler-10.2.sentence-1' class='sentence'>All other completion operations are forwarded unchanged<a class='hidden_link' href='#par.scheduler-10.2.sentence-1'>.</a></div></div></li></ul></div> <div id='par.scheduler-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#par.scheduler-note-2'>2</a></i>:&ensp;<div id='par.scheduler-10.sentence-3' class='sentence'>Customizing the behavior of <span class='texttt'>bulk_<span class='shy'></span>chunked</span>
affects the default implementation of <span class='texttt'>bulk</span><a class='hidden_link' href='#par.scheduler-10.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='par.scheduler-11'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8432'>#</a></div><div class='texpara'><div id='par.scheduler-11.sentence-1' class='sentence'><span class='texttt'>parallel_<span class='shy'></span>scheduler</span> provides a customized implementation of
the <span class='texttt'>bulk_<span class='shy'></span>unchunked</span> algorithm (<a href='#bulk' title='33.9.12.11&emsp;execution&#x200b;::&#x200b;bulk, execution&#x200b;::&#x200b;bulk_&shy;chunked, and execution&#x200b;::&#x200b;bulk_&shy;unchunked'>[exec.<span class='shy'></span>bulk]</a>)<a class='hidden_link' href='#par.scheduler-11.sentence-1'>.</a></div> <div id='par.scheduler-11.sentence-2' class='sentence'>If a receiver <span class='texttt'>rcvr</span> is connected to the sender
returned by <span class='texttt'>bulk_<span class='shy'></span>unchunked<span class='parenthesis'>(</span>sndr, pol, shape, f<span class='parenthesis'>)</span></span> and
the resulting operation state is started, then:
<ul class='itemize'><li id='par.scheduler-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-11.1'>(11.1)</a></div><div class='texpara'><div id='par.scheduler-11.1.sentence-1' class='sentence'>If <span class='texttt'>sndr</span> completes with values <span class='texttt'>vals</span>,
let <span class='texttt'>args</span> be a pack of lvalue subexpressions designating <span class='texttt'>vals</span>,
then <span class='texttt'>b<span class='operator'>.</span>schedule_<span class='shy'></span>bulk_<span class='shy'></span>unchunked<span class='parenthesis'>(</span>shape, r, s<span class='parenthesis'>)</span></span> is called, where
<ul class='itemize'><li id='par.scheduler-11.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-11.1.1'>(11.1.1)</a></div><span class='texttt'>r</span> is a bulk unchunked proxy for <span class='texttt'>rcvr</span>
with callable <span class='texttt'>f</span> and arguments <span class='texttt'>args</span> and</li><li id='par.scheduler-11.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#par.scheduler-11.1.2'>(11.1.2)</a></div><span class='texttt'>s</span> is a preallocated backend storage for <span class='texttt'>r</span><a class='hidden_link' href='#par.scheduler-11.1.sentence-1'>.</a></li></ul></div></div></li><li id='par.scheduler-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#par.scheduler-11.2'>(11.2)</a></div><div class='texpara'><div id='par.scheduler-11.2.sentence-1' class='sentence'>All other completion operations are forwarded unchanged<a class='hidden_link' href='#par.scheduler-11.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='texpara'><div id='lib:get_parallel_scheduler'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_parallel_scheduler'>ðŸ”—</a></div><code class='itemdeclcode'>parallel_scheduler get_parallel_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='par.scheduler-12'><div class='marginalizedparent'><a class='marginalized' href='#par.scheduler-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8460'>#</a></div><div class='texpara'><div id='par.scheduler-12.sentence-1' class='sentence'><i >Effects</i>: Let <span class='texttt'>eb</span> be the result of <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability<span class='operator'>&#x200b;::&#x200b;</span>query_<span class='shy'></span>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#par.scheduler-12.sentence-1'>.</a></div> <div id='par.scheduler-12.sentence-2' class='sentence'>If <span class='texttt'>eb <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>nullptr</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'>terminate</span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#par.scheduler-12.sentence-2'>.</a></div> <div id='par.scheduler-12.sentence-3' class='sentence'>Otherwise, returns a <span class='texttt'>parallel_<span class='shy'></span>scheduler</span> object
associated with <span class='texttt'>eb</span><a class='hidden_link' href='#par.scheduler-12.sentence-3'>.</a></div></div></div></div></div><div id='sysctxrepl' class='section'><h2 ><a class='secnum' href='#sysctxrepl' style='min-width:65pt'>33.16</a> Namespace <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability</span> <a class='abbr_ref' href='exec.sysctxrepl'>[exec.sysctxrepl]</a></h2><div id='sysctxrepl.general' class='section'><h3 ><a class='secnum' href='#sysctxrepl.general' style='min-width:80pt'>33.16.1</a> General <a class='abbr_ref' href='exec.sysctxrepl.general'>[exec.sysctxrepl.general]</a></h3><div class='para' id='sysctxrepl.general-1'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8473'>#</a></div><div class='texpara'><div id='sysctxrepl.general-1.sentence-1' class='sentence'>Facilities in the <span class='texttt'>system_<span class='shy'></span>context_<span class='shy'></span>replaceability</span> namespace
allow users to replace the default implementation of <span class='texttt'>parallel_<span class='shy'></span>scheduler</span><a class='hidden_link' href='#sysctxrepl.general-1.sentence-1'>.</a></div></div></div></div><div id='sysctxrepl.query' class='section'><h3 ><a class='secnum' href='#sysctxrepl.query' style='min-width:80pt'>33.16.2</a> <span class='texttt'>query_<span class='shy'></span>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span> <a class='abbr_ref' href='exec.sysctxrepl.query'>[exec.sysctxrepl.query]</a></h3><div class='texpara'><div id='lib:query_parallel_scheduler_backend'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:query_parallel_scheduler_backend'>ðŸ”—</a></div><code class='itemdeclcode'>shared_ptr<span class='anglebracket'>&lt;</span>parallel_scheduler_backend<span class='anglebracket'>&gt;</span> query_parallel_scheduler_backend<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='sysctxrepl.query-1'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8484'>#</a></div><div class='texpara'><div id='sysctxrepl.query-1.sentence-1' class='sentence'><span class='texttt'>query_<span class='shy'></span>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns
the implementation object for a parallel scheduler<a class='hidden_link' href='#sysctxrepl.query-1.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.query-2'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8488'>#</a></div><div class='texpara'><div id='sysctxrepl.query-2.sentence-1' class='sentence'><i >Returns</i>: A non-null shared pointer to an object
that implements the <span class='texttt'>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span> interface<a class='hidden_link' href='#sysctxrepl.query-2.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.query-3'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8493'>#</a></div><div class='texpara'><div id='sysctxrepl.query-3.sentence-1' class='sentence'><i >Remarks</i>: This function is replaceable (<a href='dcl.fct.def.replace' title='9.6.5&emsp;Replaceable function definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>replace]</a>)<a class='hidden_link' href='#sysctxrepl.query-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution<span class='operator'>::</span>system_context_replaceability <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <span id='lib:receiver_proxy'><a class='hidden_link' href='#lib:receiver_proxy' title='33.16.2&emsp;query_&shy;parallel_&shy;scheduler_&shy;backend&emsp;[exec.sysctxrepl.query]'>receiver_proxy</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>virtual</span> <span class='operator'>~</span>receiver_proxy<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

  <span class='keyword'>protected</span><span class='operator'>:</span>
    <span class='keyword'>virtual</span> <span class='keyword'>bool</span> <i >query-env</i><span class='parenthesis'>(</span>unspecified<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> P, <i >class-type</i> Query<span class='anglebracket'>&gt;</span>
      optional<span class='anglebracket'>&lt;</span>P<span class='anglebracket'>&gt;</span> try_query<span class='parenthesis'>(</span>Query q<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <span id='lib:bulk_item_receiver_proxy'><a class='hidden_link' href='#lib:bulk_item_receiver_proxy' title='33.16.2&emsp;query_&shy;parallel_&shy;scheduler_&shy;backend&emsp;[exec.sysctxrepl.query]'>bulk_item_receiver_proxy</a></span> <span class='operator'>:</span> receiver_proxy <span class='curlybracket'>{</span>
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> execute<span class='parenthesis'>(</span>size_t, size_t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='sysctxrepl.query-4'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8521'>#</a></div><div class='texpara'><div id='sysctxrepl.query-4.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>proxy</span> represents a receiver
that will be notified
by the implementations of <span class='texttt'>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span>
to trigger the completion operations<a class='hidden_link' href='#sysctxrepl.query-4.sentence-1'>.</a></div> <div id='sysctxrepl.query-4.sentence-2' class='sentence'><span class='texttt'>bulk_<span class='shy'></span>item_<span class='shy'></span>receiver_<span class='shy'></span>proxy</span> is derived from <span class='texttt'>receiver_<span class='shy'></span>proxy</span> and
is used for <span class='texttt'>bulk_<span class='shy'></span>chunked</span> and <span class='texttt'>bulk_<span class='shy'></span>unchunked</span> customizations
that will also receive notifications
from implementations of <span class='texttt'>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span>
corresponding to different iterations<a class='hidden_link' href='#sysctxrepl.query-4.sentence-2'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='sysctxrepl.query-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#sysctxrepl.query-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> P, <a href='#concept:class-type' title='33.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:class-type___'><span class='texttt'><i >class-type</i></span></span></a> Query<span class='anglebracket'>&gt;</span>
  optional<span class='anglebracket'>&lt;</span>P<span class='anglebracket'>&gt;</span> <span id='lib:try_query'><a class='hidden_link' href='#lib:try_query' title='33.16.2&emsp;query_&shy;parallel_&shy;scheduler_&shy;backend&emsp;[exec.sysctxrepl.query]'>try_query</a></span><span class='parenthesis'>(</span>Query q<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='sysctxrepl.query-5'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8538'>#</a></div><div class='texpara'><div id='sysctxrepl.query-5.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'>P</span> is a cv-unqualified non-array object type<a class='hidden_link' href='#sysctxrepl.query-5.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.query-6'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8542'>#</a></div><div class='texpara'><div id='sysctxrepl.query-6.sentence-1' class='sentence'><i >Returns</i>: Let <span class='texttt'>env</span> be the environment of the receiver represented by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#sysctxrepl.query-6.sentence-1'>.</a></div> <div id='sysctxrepl.query-6.sentence-2' class='sentence'>If
<ul class='itemize'><li id='sysctxrepl.query-6.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.query-6.1'>(6.1)</a></div><span class='texttt'>Query</span> is not a member of an implementation-defined set
of supported queries; or</li><li id='sysctxrepl.query-6.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.query-6.2'>(6.2)</a></div><span class='texttt'>P</span> is not a member of an implementation-defined set
of supported result types for <span class='texttt'>Query</span>; or</li><li id='sysctxrepl.query-6.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.query-6.3'>(6.3)</a></div>the expression <span class='texttt'>q<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is not well-formed or
does not have type <span class='mathit'>cv</span> <span class='texttt'>P</span>,</li></ul>
then returns <span class='texttt'>nullopt</span><a class='hidden_link' href='#sysctxrepl.query-6.sentence-2'>.</a></div> <div id='sysctxrepl.query-6.sentence-3' class='sentence'>Otherwise, returns <span class='texttt'>q<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span><a class='hidden_link' href='#sysctxrepl.query-6.sentence-3'>.</a></div></div></div></div><div class='para' id='sysctxrepl.query-7'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.query-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8560'>#</a></div><div class='texpara'><div id='sysctxrepl.query-7.sentence-1' class='sentence'><i >Remarks</i>: <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token_<span class='shy'></span>t</span> is
in the implementation-defined set of supported queries, and
<span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span> is a member
of the implementation-defined set of supported result types
for <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token_<span class='shy'></span>t</span><a class='hidden_link' href='#sysctxrepl.query-7.sentence-1'>.</a></div></div></div></div></div><div id='sysctxrepl.psb' class='section'><h3 ><a class='secnum' href='#sysctxrepl.psb' style='min-width:80pt'>33.16.3</a> Class <span class='texttt'>parallel_<span class='shy'></span>scheduler_<span class='shy'></span>backend</span> <a class='abbr_ref' href='exec.sysctxrepl.psb'>[exec.sysctxrepl.psb]</a></h3><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution<span class='operator'>::</span>system_context_replaceability <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <span id='lib:parallel_scheduler_backend'><a class='hidden_link' href='#lib:parallel_scheduler_backend' title='33.16.3&emsp;Class parallel_&shy;scheduler_&shy;backend&emsp;[exec.sysctxrepl.psb]'>parallel_scheduler_backend</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>virtual</span> <span class='operator'>~</span>parallel_scheduler_backend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

    <span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule<span class='parenthesis'>(</span>receiver_proxy<span class='operator'>&amp;</span>, span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule_bulk_chunked<span class='parenthesis'>(</span>size_t, bulk_item_receiver_proxy<span class='operator'>&amp;</span>,
                                       span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule_bulk_unchunked<span class='parenthesis'>(</span>size_t, bulk_item_receiver_proxy<span class='operator'>&amp;</span>,
                                         span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><div id='lib:parallel_scheduler_backend,schedule'><div id='lib:schedule,parallel_scheduler_backend'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:schedule,parallel_scheduler_backend'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule<span class='parenthesis'>(</span>receiver_proxy<span class='operator'>&amp;</span> r, span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span> s<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
</code></div></div></div></div><div class='para' id='sysctxrepl.psb-1'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8591'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-1.sentence-1' class='sentence'><i >Preconditions</i>: The ends of
the lifetimes of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>,
the object referred to by <span class='texttt'>r</span>, and
any storage referenced by <span class='texttt'>s</span>
all happen after
the beginning of the evaluation of one of the expressions below<a class='hidden_link' href='#sysctxrepl.psb-1.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.psb-2'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8600'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-2.sentence-1' class='sentence'><i >Effects</i>: A derived class shall implement this function such that:
<ul class='itemize'><li id='sysctxrepl.psb-2.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-2.1'>(2.1)</a></div><div class='texpara'><div id='sysctxrepl.psb-2.1.sentence-1' class='sentence'>One of the following expressions is evaluated:
<ul class='itemize'><li id='sysctxrepl.psb-2.1.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-2.1.1'>(2.1.1)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if no error occurs, and the work is successful;</li><li id='sysctxrepl.psb-2.1.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-2.1.2'>(2.1.2)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>eptr<span class='parenthesis'>)</span></span>, if an error occurs,
where <span class='texttt'>eptr</span> is an object of type <span class='texttt'>exception_<span class='shy'></span>ptr</span>;</li><li id='sysctxrepl.psb-2.1.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-2.1.3'>(2.1.3)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if the work is canceled<a class='hidden_link' href='#sysctxrepl.psb-2.1.sentence-1'>.</a></li></ul></div></div></li><li id='sysctxrepl.psb-2.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-2.2'>(2.2)</a></div><div class='texpara'><div id='sysctxrepl.psb-2.2.sentence-1' class='sentence'>Any call to <span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> happens on
an execution agent of the execution context represented by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#sysctxrepl.psb-2.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='sysctxrepl.psb-3'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8620'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-3.sentence-1' class='sentence'><i >Remarks</i>: The storage referenced by <span class='texttt'>s</span>
may be used by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> as temporary storage
for the duration of the operation launched by this call<a class='hidden_link' href='#sysctxrepl.psb-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:parallel_scheduler_backend,schedule_bulk_chunked'><div id='lib:schedule_bulk_chunked,parallel_scheduler_backend'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:schedule_bulk_chunked,parallel_scheduler_backend'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule_bulk_chunked<span class='parenthesis'>(</span>size_t n, bulk_item_receiver_proxy<span class='operator'>&amp;</span> r,
                                   span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span> s<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
</code></div></div></div></div><div class='para' id='sysctxrepl.psb-4'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8634'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-4.sentence-1' class='sentence'><i >Preconditions</i>: The ends of
the lifetimes of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>,
the object referred to by <span class='texttt'>r</span>, and
any storage referenced by <span class='texttt'>s</span>
all happen after
the beginning of the evaluation of one of the expressions below<a class='hidden_link' href='#sysctxrepl.psb-4.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.psb-5'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8643'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-5.sentence-1' class='sentence'><i >Effects</i>: A derived class shall implement this function such that:
<ul class='itemize'><li id='sysctxrepl.psb-5.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.1'>(5.1)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.1.sentence-1' class='sentence'>Eventually, one of the following expressions is evaluated:
<ul class='itemize'><li id='sysctxrepl.psb-5.1.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-5.1.1'>(5.1.1)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if no error occurs, and the work is successful;</li><li id='sysctxrepl.psb-5.1.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-5.1.2'>(5.1.2)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>eptr<span class='parenthesis'>)</span></span>, if an error occurs,
where <span class='texttt'>eptr</span> is an object of type <span class='texttt'>exception_<span class='shy'></span>ptr</span>;</li><li id='sysctxrepl.psb-5.1.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-5.1.3'>(5.1.3)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if the work is canceled<a class='hidden_link' href='#sysctxrepl.psb-5.1.sentence-1'>.</a></li></ul></div></div></li><li id='sysctxrepl.psb-5.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.2'>(5.2)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.2.sentence-1' class='sentence'>If <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>b, e<span class='parenthesis'>)</span></span> is called,
then <span class='texttt'>b</span> and <span class='texttt'>e</span> are in the range [<span class='texttt'><span class='literal'>0</span>, n</span>) and
<span class='math'><span class='texttt'>b</span> &lt; <span class='texttt'>e</span></span><a class='hidden_link' href='#sysctxrepl.psb-5.2.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-5.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.3'>(5.3)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.3.sentence-1' class='sentence'>For each <span class='math'><span class='mathalpha'>i</span></span> in [<span class='texttt'><span class='literal'>0</span>, n</span>),
there is at most one call to <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>b, e<span class='parenthesis'>)</span></span>
such that <span class='math'><span class='mathalpha'>i</span></span> is in the range [<span class='texttt'>b, e</span>)<a class='hidden_link' href='#sysctxrepl.psb-5.3.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-5.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.4'>(5.4)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.4.sentence-1' class='sentence'>If <span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called,
then for each <span class='math'><span class='mathalpha'>i</span></span> in [<span class='texttt'><span class='literal'>0</span>, n</span>),
there is exactly one call to <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>b, e<span class='parenthesis'>)</span></span>
such that <span class='math'><span class='mathalpha'>i</span></span> is in the range [<span class='texttt'>b, e</span>)<a class='hidden_link' href='#sysctxrepl.psb-5.4.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-5.5'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.5'>(5.5)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.5.sentence-1' class='sentence'>All calls to <span class='texttt'>execute</span> on <span class='texttt'>r</span> happen before
the call to either <span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, or <span class='texttt'>set_<span class='shy'></span>stopped</span>
on <span class='texttt'>r</span><a class='hidden_link' href='#sysctxrepl.psb-5.5.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-5.6'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-5.6'>(5.6)</a></div><div class='texpara'><div id='sysctxrepl.psb-5.6.sentence-1' class='sentence'>All calls to <span class='texttt'>execute</span> and <span class='texttt'>set_<span class='shy'></span>value</span> on <span class='texttt'>r</span> are made
on execution agents of the execution context represented by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#sysctxrepl.psb-5.6.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='sysctxrepl.psb-6'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8680'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-6.sentence-1' class='sentence'><i >Remarks</i>: The storage referenced by <span class='texttt'>s</span> may be used by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>
as temporary storage for the duration of the operation launched by this call<a class='hidden_link' href='#sysctxrepl.psb-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:parallel_scheduler_backend,schedule_bulk_unchunked'><div id='lib:schedule_bulk_unchunked,parallel_scheduler_backend'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:schedule_bulk_unchunked,parallel_scheduler_backend'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>virtual</span> <span class='keyword'>void</span> schedule_bulk_unchunked<span class='parenthesis'>(</span>size_t n, bulk_item_receiver_proxy<span class='operator'>&amp;</span> r,
                                     span<span class='anglebracket'>&lt;</span>byte<span class='anglebracket'>&gt;</span> s<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;
</code></div></div></div></div><div class='para' id='sysctxrepl.psb-7'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8693'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-7.sentence-1' class='sentence'><i >Preconditions</i>: The ends of
the lifetimes of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>,
the object referred to by <span class='texttt'>r</span>, and
any storage referenced by <span class='texttt'>s</span>
all happen after
the beginning of the evaluation of one of the expressions below<a class='hidden_link' href='#sysctxrepl.psb-7.sentence-1'>.</a></div></div></div></div><div class='para' id='sysctxrepl.psb-8'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8702'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-8.sentence-1' class='sentence'><i >Effects</i>: A derived class shall implement this function such that:
<ul class='itemize'><li id='sysctxrepl.psb-8.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-8.1'>(8.1)</a></div><div class='texpara'><div id='sysctxrepl.psb-8.1.sentence-1' class='sentence'>Eventually, one of the following expressions is evaluated:
<ul class='itemize'><li id='sysctxrepl.psb-8.1.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-8.1.1'>(8.1.1)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if no error occurs, and the work is successful;</li><li id='sysctxrepl.psb-8.1.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-8.1.2'>(8.1.2)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>error<span class='parenthesis'>(</span>eptr<span class='parenthesis'>)</span></span>, if an error occurs,
where <span class='texttt'>eptr</span> is an object of type <span class='texttt'>exception_<span class='shy'></span>ptr</span>;</li><li id='sysctxrepl.psb-8.1.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#sysctxrepl.psb-8.1.3'>(8.1.3)</a></div><span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, if the work is canceled<a class='hidden_link' href='#sysctxrepl.psb-8.1.sentence-1'>.</a></li></ul></div></div></li><li id='sysctxrepl.psb-8.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-8.2'>(8.2)</a></div><div class='texpara'><div id='sysctxrepl.psb-8.2.sentence-1' class='sentence'>If <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span>b, e<span class='parenthesis'>)</span></span> is called,
then <span class='texttt'>b</span> is in the range [<span class='texttt'><span class='literal'>0</span>, n</span>) and
<span class='texttt'>e</span> is equal to <span class='texttt'>b <span class='operator'>+</span> <span class='literal'>1</span></span><a class='hidden_link' href='#sysctxrepl.psb-8.2.sentence-1'>.</a></div> <div id='sysctxrepl.psb-8.2.sentence-2' class='sentence'>For each <span class='math'><span class='mathalpha'>i</span></span> in [<span class='texttt'><span class='literal'>0</span>, n</span>),
there is at most one call to <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, <span class='math'><span class='mathalpha'>i</span></span> <span class='operator'>+</span> <span class='literal'>1</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sysctxrepl.psb-8.2.sentence-2'>.</a></div></div></li><li id='sysctxrepl.psb-8.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-8.3'>(8.3)</a></div><div class='texpara'><div id='sysctxrepl.psb-8.3.sentence-1' class='sentence'>If <span class='texttt'>r<span class='operator'>.</span>set_<span class='shy'></span>value<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is called,
then for each <span class='math'><span class='mathalpha'>i</span></span> in [<span class='texttt'><span class='literal'>0</span>, n</span>),
there is exactly one call to <span class='texttt'>r<span class='operator'>.</span>execute<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>i</span></span>, <span class='math'><span class='mathalpha'>i</span></span> <span class='operator'>+</span> <span class='literal'>1</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#sysctxrepl.psb-8.3.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-8.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-8.4'>(8.4)</a></div><div class='texpara'><div id='sysctxrepl.psb-8.4.sentence-1' class='sentence'>All calls to execute on <span class='texttt'>r</span> happen before
the call to either <span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, or <span class='texttt'>set_<span class='shy'></span>stopped</span>
on <span class='texttt'>r</span><a class='hidden_link' href='#sysctxrepl.psb-8.4.sentence-1'>.</a></div></div></li><li id='sysctxrepl.psb-8.5'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#sysctxrepl.psb-8.5'>(8.5)</a></div><div class='texpara'><div id='sysctxrepl.psb-8.5.sentence-1' class='sentence'>All calls to <span class='texttt'>execute</span> and <span class='texttt'>set_<span class='shy'></span>value</span> on <span class='texttt'>r</span> are made
on execution agents of the execution context represented by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#sysctxrepl.psb-8.5.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='sysctxrepl.psb-9'><div class='marginalizedparent'><a class='marginalized' href='#sysctxrepl.psb-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/454ba171cb14531639e641cb1200617fbf8d943f/source/exec.tex#L8736'>#</a></div><div class='texpara'><div id='sysctxrepl.psb-9.sentence-1' class='sentence'><i >Remarks</i>: The storage referenced by <span class='texttt'>s</span> may be used by <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>
as temporary storage for the duration of the operation launched by this call<a class='hidden_link' href='#sysctxrepl.psb-9.sentence-1'>.</a></div></div></div></div></div></div></div></body></html>