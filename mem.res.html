<!DOCTYPE html><html lang='en'><head><title>[mem.res]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>20</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><div id='mem.res'><h2 ><a class='secnum' style='min-width:88pt'>20.12</a> Memory resources <a class='abbr_ref'>[mem.res]</a></h2><div id='syn'><h3 ><a class='secnum' href='#syn' style='min-width:103pt'>20.12.1</a> Header <span class='texttt'>&lt;memory_&shy;resource&gt;</span> synopsis <a class='abbr_ref' href='mem.res.syn'>[mem.res.syn]</a></h3><p ><span class='indexparent'><a class='index' id='memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource'></a></span></p><pre class='codeblock'>
namespace std::pmr {
  <span class='comment'>// <a href='mem.res.class'>[mem.res.class]</a>, class <span class='texttt'>memory_&shy;resource</span>
</span>  class memory_resource;

  bool operator==(const memory_resource&amp; a, const memory_resource&amp; b) noexcept;
  bool operator!=(const memory_resource&amp; a, const memory_resource&amp; b) noexcept;

  <span class='comment'>// <a href='mem.poly.allocator.class'>[mem.poly.allocator.class]</a>, class template <span class='texttt'>polymorphic_&shy;allocator</span>
</span>  template &lt;class Tp&gt; class polymorphic_allocator;

  template &lt;class T1, class T2&gt;
    bool operator==(const polymorphic_allocator&lt;T1&gt;&amp; a,
                    const polymorphic_allocator&lt;T2&gt;&amp; b) noexcept;
  template &lt;class T1, class T2&gt;
    bool operator!=(const polymorphic_allocator&lt;T1&gt;&amp; a,
                    const polymorphic_allocator&lt;T2&gt;&amp; b) noexcept;

  <span class='comment'>// <a href='mem.res.global'>[mem.res.global]</a>, global memory resources
</span>  memory_resource* new_delete_resource() noexcept;
  memory_resource* null_memory_resource() noexcept;
  memory_resource* set_default_resource(memory_resource* r) noexcept;
  memory_resource* get_default_resource() noexcept;

  <span class='comment'>// <a href='mem.res.pool'>[mem.res.pool]</a>, pool resource classes
</span>  struct pool_options;
  class synchronized_pool_resource;
  class unsynchronized_pool_resource;
  class monotonic_buffer_resource;
}</pre></div><div id='class'><h3 ><a class='secnum' href='#class' style='min-width:103pt'>20.12.2</a> Class <span class='texttt'>memory_&shy;resource</span> <a class='abbr_ref' href='mem.res.class'>[mem.res.class]</a></h3><div class='para' id='class-1'><div class='marginalizedparent'><a class='marginalized' href='#class-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10863'>#</a></div><p >The <span class='texttt'>memory_&shy;resource</span> class is an abstract interface to an unbounded set of classes encapsulating memory resources.</p><p ><span class='indexparent'><a class='index' id='memory_resource'></a></span></p><pre class='codeblock'>
class memory_resource {
  static constexpr size_t max_align = alignof(max_align_t); <span class='comment'>// <i>exposition only</i>
</span>
public:
  virtual ~memory_resource();

  void* allocate(size_t bytes, size_t alignment = max_align);
  void deallocate(void* p, size_t bytes, size_t alignment = max_align);

  bool is_equal(const memory_resource&amp; other) const noexcept;

private:
  virtual void* do_allocate(size_t bytes, size_t alignment) = 0;
  virtual void do_deallocate(void* p, size_t bytes, size_t alignment) = 0;

  virtual bool do_is_equal(const memory_resource&amp; other) const noexcept = 0;
};</pre></div><div id='public'><h4 ><a class='secnum' href='#public' style='min-width:118pt'>20.12.2.1</a> <span class='texttt'>memory_&shy;resource</span> public member functions <a class='abbr_ref' href='mem.res.public'>[mem.res.public]</a></h4><p ><span class='indexparent'><a class='index' id='memory_resource,destructor'></a></span><code class='itemdecl'>
~memory_resource();
</code></p><div class='itemdescr'></div><div class='para' id='public-1'><div class='marginalizedparent'><a class='marginalized' href='#public-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10896'>#</a></div><p ><i>Effects:</i>
Destroys this <span class='texttt'>memory_&shy;resource</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='allocate,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,allocate'></a></span><code class='itemdecl'>
void* allocate(size_t bytes, size_t alignment = max_align);
</code></p><div class='itemdescr'></div><div class='para' id='public-2'><div class='marginalizedparent'><a class='marginalized' href='#public-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10907'>#</a></div><p ><i>Effects:</i>
Equivalent to: <span class='texttt'>return do_&shy;allocate(bytes, alignment);</span>
</p></div></div><p ><span class='indexparent'><a class='index' id='deallocate,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,deallocate'></a></span><code class='itemdecl'>
void deallocate(void* p, size_t bytes, size_t alignment = max_align);
</code></p><div class='itemdescr'></div><div class='para' id='public-3'><div class='marginalizedparent'><a class='marginalized' href='#public-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10918'>#</a></div><p ><i>Effects:</i>
Equivalent to: <span class='texttt'>do_&shy;deallocate(p, bytes, alignment);</span>
</p></div></div><p ><span class='indexparent'><a class='index' id='is_equal,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,is_equal'></a></span><code class='itemdecl'>
bool is_equal(const memory_resource&amp; other) const noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='public-4'><div class='marginalizedparent'><a class='marginalized' href='#public-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10929'>#</a></div><p ><i>Effects:</i>
Equivalent to: <span class='texttt'>return do_&shy;is_&shy;equal(other);</span>
</p></div></div></div><div id='private'><h4 ><a class='secnum' href='#private' style='min-width:118pt'>20.12.2.2</a> <span class='texttt'>memory_&shy;resource</span> private virtual member functions <a class='abbr_ref' href='mem.res.private'>[mem.res.private]</a></h4><p ><span class='indexparent'><a class='index' id='do_allocate,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,do_allocate'></a></span><code class='itemdecl'>
virtual void* do_allocate(size_t bytes, size_t alignment) = 0;
</code></p><div class='itemdescr'></div><div class='para' id='private-1'><div class='marginalizedparent'><a class='marginalized' href='#private-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10943'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>alignment</span> shall be a power of two.</p></div></div><div class='para' id='private-2'><div class='marginalizedparent'><a class='marginalized' href='#private-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10947'>#</a></div><p ><i>Returns:</i>
A derived class shall implement this function to return a pointer to allocated storage (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>) with a size of at least <span class='texttt'>bytes</span>.
The returned storage is aligned to the specified alignment, if such alignment is supported (<a href='basic.align'>[basic.align]</a>);
otherwise it is aligned to <span class='texttt'>max_&shy;align</span>.</p></div></div><div class='para' id='private-3'><div class='marginalizedparent'><a class='marginalized' href='#private-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10953'>#</a></div><p ><i>Throws:</i>
A derived class implementation shall throw an appropriate exception if it is unable to allocate memory with the requested size and alignment.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_deallocate,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,do_deallocate'></a></span><code class='itemdecl'>
virtual void do_deallocate(void* p, size_t bytes, size_t alignment) = 0;
</code></p><div class='itemdescr'></div><div class='para' id='private-4'><div class='marginalizedparent'><a class='marginalized' href='#private-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10964'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>p</span> shall have been returned from a prior call to <span class='texttt'>allocate(bytes, alignment)</span> on a memory resource equal to <span class='texttt'>*this</span>,
and the storage at <span class='texttt'>p</span> shall not yet have been deallocated.</p></div></div><div class='para' id='private-5'><div class='marginalizedparent'><a class='marginalized' href='#private-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10969'>#</a></div><p ><i>Effects:</i>
A derived class shall implement this function to dispose of allocated storage.</p></div></div><div class='para' id='private-6'><div class='marginalizedparent'><a class='marginalized' href='#private-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10973'>#</a></div><p ><i>Throws:</i>
Nothing.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_is_equal,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,do_is_equal'></a></span><code class='itemdecl'>
virtual bool do_is_equal(const memory_resource&amp; other) const noexcept = 0;
</code></p><div class='itemdescr'></div><div class='para' id='private-7'><div class='marginalizedparent'><a class='marginalized' href='#private-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L10984'>#</a></div><p ><i>Returns:</i>
A derived class shall implement this function to return <span class='texttt'>true</span> if memory allocated from <span class='texttt'>this</span> can be deallocated from <span class='texttt'>other</span> and vice-versa,
otherwise <span class='texttt'>false</span>.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The most-derived type of <span class='texttt'>other</span> might not match the type of <span class='texttt'>this</span>.
For a derived class <span class='texttt'>D</span>, a typical implementation of this function
will immediately return <span class='texttt'>false</span>
if <span class='texttt'>dynamic_&shy;cast&lt;const D*&gt;(&amp;other) == nullptr</span>.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p></div></div></div><div id='eq'><h4 ><a class='secnum' href='#eq' style='min-width:118pt'>20.12.2.3</a> <span class='texttt'>memory_&shy;resource</span> equality <a class='abbr_ref' href='mem.res.eq'>[mem.res.eq]</a></h4><p ><span class='indexparent'><a class='index' id='operator==,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,operator=='></a></span><code class='itemdecl'>
bool operator==(const memory_resource&amp; a, const memory_resource&amp; b) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='eq-1'><div class='marginalizedparent'><a class='marginalized' href='#eq-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11003'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>&amp;a == &amp;b || a.is_&shy;equal(b)</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='operator!=,memory_resource'></a></span><span class='indexparent'><a class='index' id='memory_resource,operator!='></a></span><code class='itemdecl'>
bool operator!=(const memory_resource&amp; a, const memory_resource&amp; b) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='eq-2'><div class='marginalizedparent'><a class='marginalized' href='#eq-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11014'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>!(a == b)</span>.
</p></div></div></div></div><div id='mem.poly.allocator.class'><h3 ><a class='secnum' href='#mem.poly.allocator.class' style='min-width:103pt'>20.12.3</a> Class template <span class='texttt'>polymorphic_&shy;allocator</span> <a class='abbr_ref' href='mem.poly.allocator.class'>[mem.poly.allocator.class]</a></h3><div class='para' id='mem.poly.allocator.class-1'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.class-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11021'>#</a></div><p >A specialization of class template <span class='texttt'>pmr&#x200b;::&#x200b;polymorphic_&shy;allocator</span>
conforms to the <span class='texttt'>Allocator</span> requirements (<a href='allocator.requirements'>[allocator.requirements]</a>).
Constructed with different memory resources,
different instances of the same specialization of <span class='texttt'>pmr&#x200b;::&#x200b;polymorphic_&shy;allocator</span>
can exhibit entirely different allocation behavior.
This runtime polymorphism allows objects that use <span class='texttt'>polymorphic_&shy;allocator</span>
to behave as if they used different allocator types at run time
even though they use the same static allocator type.</p><p ><span class='indexparent'><a class='index' id='polymorphic_allocator'></a></span></p><pre class='codeblock'>
template &lt;class Tp&gt;
class polymorphic_allocator {
  memory_resource* memory_rsrc; <span class='comment'>// <i>exposition only</i>
</span>
public:
  using value_type = Tp;

  <span class='comment'>// <a href='mem.poly.allocator.ctor'>[mem.poly.allocator.ctor]</a>, constructors
</span>  polymorphic_allocator() noexcept;
  polymorphic_allocator(memory_resource* r);

  polymorphic_allocator(const polymorphic_allocator&amp; other) = default;

  template &lt;class U&gt;
    polymorphic_allocator(const polymorphic_allocator&lt;U&gt;&amp; other) noexcept;

  polymorphic_allocator&amp;
    operator=(const polymorphic_allocator&amp; rhs) = delete;

  <span class='comment'>// <a href='mem.poly.allocator.mem'>[mem.poly.allocator.mem]</a>, member functions
</span>  Tp* allocate(size_t n);
  void deallocate(Tp* p, size_t n);

  template &lt;class T, class... Args&gt;
  void construct(T* p, Args&amp;&amp;... args);

  template &lt;class T1, class T2, class... Args1, class... Args2&gt;
    void construct(pair&lt;T1,T2&gt;* p, piecewise_construct_t,
                   tuple&lt;Args1...&gt; x, tuple&lt;Args2...&gt; y);
  template &lt;class T1, class T2&gt;
    void construct(pair&lt;T1,T2&gt;* p);
  template &lt;class T1, class T2, class U, class V&gt;
    void construct(pair&lt;T1,T2&gt;* p, U&amp;&amp; x, V&amp;&amp; y);
  template &lt;class T1, class T2, class U, class V&gt;
    void construct(pair&lt;T1,T2&gt;* p, const pair&lt;U, V&gt;&amp; pr);
  template &lt;class T1, class T2, class U, class V&gt;
    void construct(pair&lt;T1,T2&gt;* p, pair&lt;U, V&gt;&amp;&amp; pr);

  template &lt;class T&gt;
    void destroy(T* p);

  polymorphic_allocator select_on_container_copy_construction() const;

  memory_resource* resource() const;
};</pre></div><div id='mem.poly.allocator.ctor'><h4 ><a class='secnum' href='#mem.poly.allocator.ctor' style='min-width:118pt'>20.12.3.1</a> <span class='texttt'>polymorphic_&shy;allocator</span> constructors <a class='abbr_ref' href='mem.poly.allocator.ctor'>[mem.poly.allocator.ctor]</a></h4><p ><span class='indexparent'><a class='index' id='polymorphic_allocator,constructor'></a></span><code class='itemdecl'>
polymorphic_allocator() noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11089'>#</a></div><p ><i>Effects:</i>
Sets <span class='texttt'>memory_&shy;rsrc</span> to <span class='texttt'>get_&shy;default_&shy;resource()</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='polymorphic_allocator,constructor'></a></span><code class='itemdecl'>
polymorphic_allocator(memory_resource* r);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11100'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>r</span> is non-null.</p></div></div><div class='para' id='mem.poly.allocator.ctor-3'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11104'>#</a></div><p ><i>Effects:</i>
Sets <span class='texttt'>memory_&shy;rsrc</span> to <span class='texttt'>r</span>.</p></div></div><div class='para' id='mem.poly.allocator.ctor-4'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11108'>#</a></div><p ><i>Throws:</i>
Nothing.</p></div></div><div class='para' id='mem.poly.allocator.ctor-5'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11112'>#</a></div><p ><i>Notes:</i>
This constructor provides an implicit conversion from <span class='texttt'>memory_&shy;resource*</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='polymorphic_allocator,constructor'></a></span><code class='itemdecl'>
template &lt;class U&gt;
  polymorphic_allocator(const polymorphic_allocator&lt;U&gt;&amp; other) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.ctor-6'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.ctor-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11124'>#</a></div><p ><i>Effects:</i>
Sets <span class='texttt'>memory_&shy;rsrc</span> to <span class='texttt'>other.resource()</span>.
</p></div></div></div><div id='mem.poly.allocator.mem'><h4 ><a class='secnum' href='#mem.poly.allocator.mem' style='min-width:118pt'>20.12.3.2</a> <span class='texttt'>polymorphic_&shy;allocator</span> member functions <a class='abbr_ref' href='mem.poly.allocator.mem'>[mem.poly.allocator.mem]</a></h4><p ><span class='indexparent'><a class='index' id='allocate,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,allocate'></a></span><code class='itemdecl'>
Tp* allocate(size_t n);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11138'>#</a></div><p ><i>Returns:</i>
Equivalent to
</p><pre class='codeblock'>
return static_cast&lt;Tp*&gt;(memory_rsrc-&gt;allocate(n * sizeof(Tp), alignof(Tp)));</pre></div></div><p ><span class='indexparent'><a class='index' id='deallocate,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,deallocate'></a></span><code class='itemdecl'>
void deallocate(Tp* p, size_t n);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11152'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>p</span> was allocated from a memory resource <span class='texttt'>x</span>,
equal to <span class='texttt'>*memory_&shy;rsrc</span>,
using <span class='texttt'>x.allocate(n * sizeof(Tp), alignof(Tp))</span>.</p></div></div><div class='para' id='mem.poly.allocator.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11158'>#</a></div><p ><i>Effects:</i>
Equivalent to <span class='texttt'>memory_&shy;rsrc-&gt;deallocate(p, n * sizeof(Tp), alignof(Tp))</span>.</p></div></div><div class='para' id='mem.poly.allocator.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11162'>#</a></div><p ><i>Throws:</i>
Nothing.
</p></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T, class... Args&gt;
  void construct(T* p, Args&amp;&amp;... args);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11174'>#</a></div><p ><i>Requires:</i>
Uses-allocator construction of <span class='texttt'>T</span>
with allocator <span class='texttt'>resource()</span> (see <a href='allocator.uses.construction'>[allocator.uses.construction]</a>)
and constructor arguments <span class='texttt'>std&#x200b;::&#x200b;forward&lt;Args&gt;(args)...</span> is well-formed.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
Uses-allocator construction is always well formed
for types that do not use allocators.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]</p></div></div><div class='para' id='mem.poly.allocator.mem-6'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11183'>#</a></div><p ><i>Effects:</i>
Construct a <span class='texttt'>T</span> object in the storage
whose address is represented by <span class='texttt'>p</span>
by uses-allocator construction with allocator <span class='texttt'>resource()</span>
and constructor arguments <span class='texttt'>std&#x200b;::&#x200b;forward&lt;Args&gt;(args)...</span>.</p></div></div><div class='para' id='mem.poly.allocator.mem-7'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11190'>#</a></div><p ><i>Throws:</i>
Nothing unless the constructor for <span class='texttt'>T</span> throws.
</p></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T1, class T2, class... Args1, class... Args2&gt;
  void construct(pair&lt;T1,T2&gt;* p, piecewise_construct_t,
                 tuple&lt;Args1...&gt; x, tuple&lt;Args2...&gt; y);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-8'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11203'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
This method and the <span class='texttt'>construct</span> methods that follow
are overloads for piecewise construction of pairs (<a href='pairs.pair'>[pairs.pair]</a>).
<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]</p></div></div><div class='para' id='mem.poly.allocator.mem-9'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11209'>#</a></div><p ><i>Effects:</i>
Let <span class='texttt'>xprime</span> be a <span class='texttt'>tuple</span> constructed from <span class='texttt'>x</span>
according to the appropriate rule from the following list.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The following description can be summarized as
constructing a <span class='texttt'>pair&lt;T1, T2&gt;</span> object
in the storage whose address is represented by <span class='texttt'>p</span>,
as if by separate uses-allocator construction
with allocator <span class='texttt'>resource()</span> (<a href='allocator.uses.construction'>[allocator.uses.construction]</a>)
of <span class='texttt'>p-&gt;first</span> using the elements of <span class='texttt'>x</span>
and <span class='texttt'>p-&gt;second</span> using the elements of <span class='texttt'>y</span>.
<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p><ul class='itemize'><li id='mem.poly.allocator.mem-9.1'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.1'>(9.1)</a></div><p >If <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T1,memory_&shy;resource*&gt;</span> is <span class='texttt'>false</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T1,Args1...&gt;</span> is <span class='texttt'>true</span>,
<br/>
then <span class='texttt'>xprime</span> is <span class='texttt'>x</span>.
</p></li><li id='mem.poly.allocator.mem-9.2'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.2'>(9.2)</a></div><p >Otherwise, if <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T1,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T1,allocator_&shy;arg_&shy;t,memory_&shy;resource*,Args1...&gt;</span> is <span class='texttt'>true</span>,
<br/>
then <span class='texttt'>xprime</span> is <span class='texttt'>tuple_&shy;cat(make_&shy;tuple(allocator_&shy;arg, resource()), std&#x200b;::&#x200b;move(x))</span>.
</p></li><li id='mem.poly.allocator.mem-9.3'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.3'>(9.3)</a></div><p >Otherwise, if <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T1,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T1,Args1...,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>,
<br/>
then <span class='texttt'>xprime</span> is <span class='texttt'>tuple_&shy;cat(std&#x200b;::&#x200b;move(x), make_&shy;tuple(resource()))</span>.
</p></li><li id='mem.poly.allocator.mem-9.4'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.4'>(9.4)</a></div><p >Otherwise the program is ill formed.
</p></li></ul><p >Let <span class='texttt'>yprime</span> be a tuple constructed from <span class='texttt'>y</span>
according to the appropriate rule from the following list:
</p><ul class='itemize'><li id='mem.poly.allocator.mem-9.5'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.5'>(9.5)</a></div><p >If <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T2,memory_&shy;resource*&gt;</span> is <span class='texttt'>false</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T2,Args2...&gt;</span> is <span class='texttt'>true</span>,
<br/>
then <span class='texttt'>yprime</span> is <span class='texttt'>y</span>.
</p></li><li id='mem.poly.allocator.mem-9.6'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.6'>(9.6)</a></div><p >Otherwise, if <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T2,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T2,allocator_&shy;arg_&shy;t,memory_&shy;resource*,Args2...&gt;</span> is <span class='texttt'>true</span>,
<br/>
then <span class='texttt'>yprime</span> is <span class='texttt'>tuple_&shy;cat(make_&shy;tuple(allocator_&shy;arg, resource()), std&#x200b;::&#x200b;move(y))</span>.
</p></li><li id='mem.poly.allocator.mem-9.7'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.7'>(9.7)</a></div><p >Otherwise, if <span class='texttt'>uses_&shy;allocator_&shy;v&lt;T2,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>
<br/>
and
<span class='texttt'>is_&shy;constructible_&shy;v&lt;T2,Args2...,memory_&shy;resource*&gt;</span> is <span class='texttt'>true</span>,
<br/>
then
<span class='texttt'>yprime</span> is <span class='texttt'>tuple_&shy;cat(std&#x200b;::&#x200b;move(y), make_&shy;tuple(resource()))</span>.
</p></li><li id='mem.poly.allocator.mem-9.8'><div class='marginalizedparent' style='left:-10em'><a class='marginalized' href='#mem.poly.allocator.mem-9.8'>(9.8)</a></div><p >Otherwise the program is ill formed.
</p></li></ul><p >Then, using <span class='texttt'>piecewise_&shy;construct</span>, <span class='texttt'>xprime</span>, and <span class='texttt'>yprime</span>
as the constructor arguments,
this function constructs a <span class='texttt'>pair&lt;T1, T2&gt;</span> object
in the storage whose address is represented by <span class='texttt'>p</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T1, class T2&gt;
  void construct(pair&lt;T1,T2&gt;* p);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-10'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11289'>#</a></div><p ><i>Effects:</i>
Equivalent to:
</p><pre class='codeblock'>
construct(p, piecewise_construct, tuple&lt;&gt;(), tuple&lt;&gt;());</pre></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T1, class T2, class U, class V&gt;
  void construct(pair&lt;T1,T2&gt;* p, U&amp;&amp; x, V&amp;&amp; y);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-11'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11304'>#</a></div><p ><i>Effects:</i>
Equivalent to:
</p><pre class='codeblock'>
construct(p, piecewise_construct,
          forward_as_tuple(std::forward&lt;U&gt;(x)),
          forward_as_tuple(std::forward&lt;V&gt;(y)));</pre></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T1, class T2, class U, class V&gt;
  void construct(pair&lt;T1,T2&gt;* p, const pair&lt;U, V&gt;&amp; pr);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-12'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11321'>#</a></div><p ><i>Effects:</i>
Equivalent to:
</p><pre class='codeblock'>
construct(p, piecewise_construct,
          forward_as_tuple(pr.first),
          forward_as_tuple(pr.second));</pre></div></div><p ><span class='indexparent'><a class='index' id='construct,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,construct'></a></span><code class='itemdecl'>
template &lt;class T1, class T2, class U, class V&gt;
  void construct(pair&lt;T1,T2&gt;* p, pair&lt;U, V&gt;&amp;&amp; pr);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-13'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11338'>#</a></div><p ><i>Effects:</i>
Equivalent to:
</p><pre class='codeblock'>
construct(p, piecewise_construct,
          forward_as_tuple(std::forward&lt;U&gt;(pr.first)),
          forward_as_tuple(std::forward&lt;V&gt;(pr.second)));</pre></div></div><p ><span class='indexparent'><a class='index' id='destroy,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,destroy'></a></span><code class='itemdecl'>
template &lt;class T&gt;
  void destroy(T* p);
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-14'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11355'>#</a></div><p ><i>Effects:</i>
As if by <span class='texttt'>p-&gt;~T()</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='select_on_container_copy_construction,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,select_on_container_copy_construction'></a></span><code class='itemdecl'>
polymorphic_allocator select_on_container_copy_construction() const;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-15'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11366'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>polymorphic_&shy;allocator()</span>.</p></div></div><div class='para' id='mem.poly.allocator.mem-16'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11370'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The memory resource is not propagated.
<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p></div></div><p ><span class='indexparent'><a class='index' id='resource,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,resource'></a></span><code class='itemdecl'>
memory_resource* resource() const;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.mem-17'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.mem-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11382'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>memory_&shy;rsrc</span>.
</p></div></div></div><div id='mem.poly.allocator.eq'><h4 ><a class='secnum' href='#mem.poly.allocator.eq' style='min-width:118pt'>20.12.3.3</a> <span class='texttt'>polymorphic_&shy;allocator</span> equality <a class='abbr_ref' href='mem.poly.allocator.eq'>[mem.poly.allocator.eq]</a></h4><p ><span class='indexparent'><a class='index' id='operator==,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,operator=='></a></span><code class='itemdecl'>
template &lt;class T1, class T2&gt;
  bool operator==(const polymorphic_allocator&lt;T1&gt;&amp; a,
                  const polymorphic_allocator&lt;T2&gt;&amp; b) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.eq-1'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.eq-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11397'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>*a.resource() == *b.resource()</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='operator!=,polymorphic_allocator'></a></span><span class='indexparent'><a class='index' id='polymorphic_allocator,operator!='></a></span><code class='itemdecl'>
template &lt;class T1, class T2&gt;
  bool operator!=(const polymorphic_allocator&lt;T1&gt;&amp; a,
                  const polymorphic_allocator&lt;T2&gt;&amp; b) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='mem.poly.allocator.eq-2'><div class='marginalizedparent'><a class='marginalized' href='#mem.poly.allocator.eq-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11410'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>!(a == b)</span>.
</p></div></div></div></div><div id='global'><h3 ><a class='secnum' href='#global' style='min-width:103pt'>20.12.4</a> Access to program-wide <span class='texttt'>memory_&shy;resource</span> objects <a class='abbr_ref' href='mem.res.global'>[mem.res.global]</a></h3><p ><span class='indexparent'><a class='index' id='new_delete_resource'></a></span><code class='itemdecl'>
memory_resource* new_delete_resource() noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='global-1'><div class='marginalizedparent'><a class='marginalized' href='#global-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11424'>#</a></div><p ><i>Returns:</i>
A pointer to a static-duration object of a type derived from <span class='texttt'>memory_&shy;resource</span>
that can serve as a resource for allocating memory
using <span class='texttt'>&#x200b;::&#x200b;operator new</span> and <span class='texttt'>&#x200b;::&#x200b;operator delete</span>.
The same value is returned every time this function is called.
For a return value <span class='texttt'>p</span> and a memory resource <span class='texttt'>r</span>,
<span class='texttt'>p-&gt;is_&shy;equal(r)</span> returns <span class='texttt'>&amp;r == p</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='null_memory_resource'></a></span><code class='itemdecl'>
memory_resource* null_memory_resource() noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='global-2'><div class='marginalizedparent'><a class='marginalized' href='#global-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11440'>#</a></div><p ><i>Returns:</i>
A pointer to a static-duration object of a type derived from <span class='texttt'>memory_&shy;resource</span>
for which <span class='texttt'>allocate()</span> always throws <span class='texttt'>bad_&shy;alloc</span> and
for which <span class='texttt'>deallocate()</span> has no effect.
The same value is returned every time this function is called.
For a return value <span class='texttt'>p</span> and a memory resource <span class='texttt'>r</span>,
<span class='texttt'>p-&gt;is_&shy;equal(r)</span> returns <span class='texttt'>&amp;r == p</span>.
</p></div></div><div class='para' id='global-3'><div class='marginalizedparent'><a class='marginalized' href='#global-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11450'>#</a></div><p >The <a class='hidden_link' href='#def:default_memory_resource_pointer' id='def:default_memory_resource_pointer'><i>default memory resource pointer</i></a> is a pointer to a memory resource
that is used by certain facilities when an explicit memory resource
is not supplied through the interface.
Its initial value is the return value of <span class='texttt'>new_&shy;delete_&shy;resource()</span>.</p><p ><span class='indexparent'><a class='index' id='set_default_resource'></a></span><code class='itemdecl'>
memory_resource* set_default_resource(memory_resource* r) noexcept;
</code></p></div><div class='itemdescr'></div><div class='para' id='global-4'><div class='marginalizedparent'><a class='marginalized' href='#global-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11462'>#</a></div><p ><i>Effects:</i>
If <span class='texttt'>r</span> is non-null,
sets the value of the default memory resource pointer to <span class='texttt'>r</span>,
otherwise sets the default memory resource pointer to <span class='texttt'>new_&shy;delete_&shy;resource()</span>.</p></div></div><div class='para' id='global-5'><div class='marginalizedparent'><a class='marginalized' href='#global-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11468'>#</a></div><p ><i>Postconditions:</i>
<span class='texttt'>get_&shy;default_&shy;resource() == r</span>.</p></div></div><div class='para' id='global-6'><div class='marginalizedparent'><a class='marginalized' href='#global-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11472'>#</a></div><p ><i>Returns:</i>
The previous value of the default memory resource pointer.</p></div></div><div class='para' id='global-7'><div class='marginalizedparent'><a class='marginalized' href='#global-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11476'>#</a></div><p ><i>Remarks:</i>
Calling the <span class='texttt'>set_&shy;default_&shy;resource</span> and
<span class='texttt'>get_&shy;default_&shy;resource</span> functions shall not incur a data race.
A call to the <span class='texttt'>set_&shy;default_&shy;resource</span> function
shall synchronize with subsequent calls to
the <span class='texttt'>set_&shy;default_&shy;resource</span> and <span class='texttt'>get_&shy;default_&shy;resource</span> functions.
</p></div></div><p ><span class='indexparent'><a class='index' id='get_default_resource'></a></span><code class='itemdecl'>
memory_resource* get_default_resource() noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='global-8'><div class='marginalizedparent'><a class='marginalized' href='#global-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11491'>#</a></div><p ><i>Returns:</i>
The current value of the default memory resource pointer.
</p></div></div></div><div id='pool'><h3 ><a class='secnum' href='#pool' style='min-width:103pt'>20.12.5</a> Pool resource classes <a class='abbr_ref' href='mem.res.pool'>[mem.res.pool]</a></h3><div id='pool.overview'><h4 ><a class='secnum' href='#pool.overview' style='min-width:118pt'>20.12.5.1</a> Classes <span class='texttt'>synchronized_&shy;pool_&shy;resource</span> and <span class='texttt'>unsynchronized_&shy;pool_&shy;resource</span> <a class='abbr_ref' href='mem.res.pool.overview'>[mem.res.pool.overview]</a></h4><div class='para' id='pool.overview-1'><div class='marginalizedparent'><a class='marginalized' href='#pool.overview-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11500'>#</a></div><p >The <span class='texttt'>synchronized_&shy;pool_&shy;resource</span> and
<span class='texttt'>unsynchronized_&shy;pool_&shy;resource</span> classes
(collectively called <a class='hidden_link' href='#def:pool_resource_classes' id='def:pool_resource_classes'><i>pool resource classes</i></a>)
are general-purpose memory resources having the following qualities:
</p><ul class='itemize'><li id='pool.overview-1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#pool.overview-1.1'>(1.1)</a></div><p >Each resource frees its allocated memory on destruction,
even if <span class='texttt'>deallocate</span> has not been called for some of the allocated blocks.
</p></li><li id='pool.overview-1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#pool.overview-1.2'>(1.2)</a></div><p >A pool resource consists of a collection of <a class='hidden_link' href='#def:pools' id='def:pools'><i>pools</i></a>,
serving requests for different block sizes.
Each individual pool manages a collection of <a class='hidden_link' href='#def:chunks' id='def:chunks'><i>chunks</i></a>
that are in turn divided into blocks of uniform size,
returned via calls to <span class='texttt'>do_&shy;allocate</span>.
Each call to <span class='texttt'>do_&shy;allocate(size, alignment)</span> is dispatched
to the pool serving the smallest blocks accommodating at least <span class='texttt'>size</span> bytes.
</p></li><li id='pool.overview-1.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#pool.overview-1.3'>(1.3)</a></div><p >When a particular pool is exhausted,
allocating a block from that pool results in the allocation
of an additional chunk of memory from the <a class='hidden_link' href='#def:upstream_allocator' id='def:upstream_allocator'><i>upstream allocator</i></a>
(supplied at construction), thus replenishing the pool.
With each successive replenishment,
the chunk size obtained increases geometrically.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
By allocating memory in chunks,
the pooling strategy increases the chance that consecutive allocations
will be close together in memory.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p></li><li id='pool.overview-1.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#pool.overview-1.4'>(1.4)</a></div><p >Allocation requests that exceed the largest block size of any pool
are fulfilled directly from the upstream allocator.
</p></li><li id='pool.overview-1.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#pool.overview-1.5'>(1.5)</a></div><p >A <span class='texttt'>pool_&shy;options</span> struct may be passed to the pool resource constructors
to tune the largest block size and the maximum chunk size.
</p></li></ul></div><div class='para' id='pool.overview-2'><div class='marginalizedparent'><a class='marginalized' href='#pool.overview-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11536'>#</a></div><p >A <span class='texttt'>synchronized_&shy;pool_&shy;resource</span> may be accessed from multiple threads
without external synchronization
and may have thread-specific pools to reduce synchronization costs.
An <span class='texttt'>unsynchronized_&shy;pool_&shy;resource</span> class may not be accessed
from multiple threads simultaneously
and thus avoids the cost of synchronization entirely
in single-threaded applications.</p><p ><span class='indexparent'><a class='index' id='pool_options'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource'></a></span></p><pre class='codeblock'>
struct pool_options {
  size_t max_blocks_per_chunk = 0;
  size_t largest_required_pool_block = 0;
};

class synchronized_pool_resource : public memory_resource {
public:
  synchronized_pool_resource(const pool_options&amp; opts,
                             memory_resource* upstream);

  synchronized_pool_resource()
      : synchronized_pool_resource(pool_options(), get_default_resource()) {}
  explicit synchronized_pool_resource(memory_resource* upstream)
      : synchronized_pool_resource(pool_options(), upstream) {}
  explicit synchronized_pool_resource(const pool_options&amp; opts)
      : synchronized_pool_resource(opts, get_default_resource()) {}

  synchronized_pool_resource(const synchronized_pool_resource&amp;) = delete;
  virtual ~synchronized_pool_resource();

  synchronized_pool_resource&amp;
    operator=(const synchronized_pool_resource&amp;) = delete;

  void release();
  memory_resource* upstream_resource() const;
  pool_options options() const;

protected:
  void *do_allocate(size_t bytes, size_t alignment) override;
  void do_deallocate(void *p, size_t bytes, size_t alignment) override;

  bool do_is_equal(const memory_resource&amp; other) const noexcept override;
};

class unsynchronized_pool_resource : public memory_resource {
public:
  unsynchronized_pool_resource(const pool_options&amp; opts,
                               memory_resource* upstream);

  unsynchronized_pool_resource()
      : unsynchronized_pool_resource(pool_options(), get_default_resource()) {}
  explicit unsynchronized_pool_resource(memory_resource* upstream)
      : unsynchronized_pool_resource(pool_options(), upstream) {}
  explicit unsynchronized_pool_resource(const pool_options&amp; opts)
      : unsynchronized_pool_resource(opts, get_default_resource()) {}

  unsynchronized_pool_resource(const unsynchronized_pool_resource&amp;) = delete;
  virtual ~unsynchronized_pool_resource();

  unsynchronized_pool_resource&amp;
    operator=(const unsynchronized_pool_resource&amp;) = delete;

  void release();
  memory_resource *upstream_resource() const;
  pool_options options() const;

protected:
  void* do_allocate(size_t bytes, size_t alignment) override;
  void do_deallocate(void* p, size_t bytes, size_t alignment) override;

  bool do_is_equal(const memory_resource&amp; other) const noexcept override;
};</pre></div></div><div id='pool.options'><h4 ><a class='secnum' href='#pool.options' style='min-width:118pt'>20.12.5.2</a> <span class='texttt'>pool_&shy;options</span> data members <a class='abbr_ref' href='mem.res.pool.options'>[mem.res.pool.options]</a></h4><div class='para' id='pool.options-1'><div class='marginalizedparent'><a class='marginalized' href='#pool.options-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11615'>#</a></div><p >The members of <span class='texttt'>pool_&shy;options</span>
comprise a set of constructor options for pool resources.
The effect of each option on the pool resource behavior is described below:</p><p ><span class='indexparent'><a class='index' id='pool_options,max_blocks_per_chunk'></a></span><code class='itemdecl'>
size_t max_blocks_per_chunk;
</code></p></div><div class='itemdescr'></div><div class='para' id='pool.options-2'><div class='marginalizedparent'><a class='marginalized' href='#pool.options-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11626'>#</a></div><p >The maximum number of blocks that will be allocated at once
from the upstream memory resource (<a href='mem.res.monotonic.buffer'>[mem.res.monotonic.buffer]</a>)
to replenish a pool.
If the value of <span class='texttt'>max_&shy;blocks_&shy;per_&shy;chunk</span> is zero or
is greater than an <span class='indexparent'><a class='index' id='largest_supported_value_to_configure_the_maximum_number_of_blocks_to_replenish_a_pool'></a></span>implementation-defined
limit, that limit is used instead.
The implementation
may choose to use a smaller value than is specified in this field and
may use different values for different pools.
</p></div></div><p ><span class='indexparent'><a class='index' id='pool_options,largest_required_pool_block'></a></span><code class='itemdecl'>
size_t largest_required_pool_block;
</code></p><div class='itemdescr'></div><div class='para' id='pool.options-3'><div class='marginalizedparent'><a class='marginalized' href='#pool.options-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11644'>#</a></div><p >The largest allocation size that is required to be fulfilled
using the pooling mechanism.
Attempts to allocate a single block larger than this threshold
will be allocated directly from the upstream memory resource.
If <span class='texttt'>largest_&shy;required_&shy;pool_&shy;block</span> is zero or
is greater than an <span class='indexparent'><a class='index' id='largest_supported_value_to_configure_the_largest_allocation_satisfied_directly_by_a_pool'></a></span>implementation-defined
limit, that limit is used instead.
The implementation may choose a pass-through threshold
larger than specified in this field.
</p></div></div></div><div id='pool.ctor'><h4 ><a class='secnum' href='#pool.ctor' style='min-width:118pt'>20.12.5.3</a> Pool resource constructors and destructors <a class='abbr_ref' href='mem.res.pool.ctor'>[mem.res.pool.ctor]</a></h4><p ><span class='indexparent'><a class='index' id='synchronized_pool_resource,constructor'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,constructor'></a></span><code class='itemdecl'>
synchronized_pool_resource(const pool_options&amp; opts, memory_resource* upstream);
unsynchronized_pool_resource(const pool_options&amp; opts, memory_resource* upstream);
</code></p><div class='itemdescr'></div><div class='para' id='pool.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#pool.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11666'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>upstream</span> is the address of a valid memory resource.</p></div></div><div class='para' id='pool.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#pool.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11670'>#</a></div><p ><i>Effects:</i>
Constructs a pool resource object that will obtain memory from <span class='texttt'>upstream</span>
whenever the pool resource is unable to satisfy a memory request
from its own internal data structures.
The resulting object will hold a copy of <span class='texttt'>upstream</span>,
but will not own the resource to which <span class='texttt'>upstream</span> points.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The intention is that calls to <span class='texttt'>upstream-&gt;allocate()</span>
will be substantially fewer than calls to <span class='texttt'>this-&gt;allocate()</span>
in most cases.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
The behavior of the pooling mechanism is tuned
according to the value of the <span class='texttt'>opts</span> argument.</p></div></div><div class='para' id='pool.ctor-3'><div class='marginalizedparent'><a class='marginalized' href='#pool.ctor-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11684'>#</a></div><p ><i>Throws:</i>
Nothing unless <span class='texttt'>upstream-&gt;allocate()</span> throws.
It is unspecified if, or under what conditions,
this constructor calls <span class='texttt'>upstream-&gt;allocate()</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='synchronized_pool_resource,destructor'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,destructor'></a></span><code class='itemdecl'>
virtual ~synchronized_pool_resource();
virtual ~unsynchronized_pool_resource();
</code></p><div class='itemdescr'></div><div class='para' id='pool.ctor-4'><div class='marginalizedparent'><a class='marginalized' href='#pool.ctor-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11699'>#</a></div><p ><i>Effects:</i>
Calls <span class='texttt'>release()</span>.
</p></div></div></div><div id='pool.mem'><h4 ><a class='secnum' href='#pool.mem' style='min-width:118pt'>20.12.5.4</a> Pool resource members <a class='abbr_ref' href='mem.res.pool.mem'>[mem.res.pool.mem]</a></h4><p ><span class='indexparent'><a class='index' id='release,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,release'></a></span><span class='indexparent'><a class='index' id='release,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,release'></a></span><code class='itemdecl'>
void release();
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11713'>#</a></div><p ><i>Effects:</i>
Calls <span class='texttt'>upstream_&shy;resource()-&gt;deallocate()</span> as necessary
to release all allocated memory.
[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The memory is released back to <span class='texttt'>upstream_&shy;resource()</span>
even if <span class='texttt'>deallocate</span> has not been called
for some of the allocated blocks.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p></div></div><p ><span class='indexparent'><a class='index' id='upstream_resource,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,upstream_resource'></a></span><span class='indexparent'><a class='index' id='upstream_resource,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,upstream_resource'></a></span><code class='itemdecl'>
memory_resource* upstream_resource() const;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11730'>#</a></div><p ><i>Returns:</i>
The value of the <span class='texttt'>upstream</span> argument
provided to the constructor of this object.
</p></div></div><p ><span class='indexparent'><a class='index' id='options,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,options'></a></span><span class='indexparent'><a class='index' id='options,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,options'></a></span><code class='itemdecl'>
pool_options options() const;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11743'>#</a></div><p ><i>Returns:</i>
The options that control the pooling behavior of this resource.
The values in the returned struct may differ
from those supplied to the pool resource constructor in that
values of zero will be replaced with <span class='indexparent'><a class='index' id='default_configuration_of_a_pool'></a></span>implementation-defined
defaults, and sizes may be rounded to unspecified granularity.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_allocate,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,do_allocate'></a></span><span class='indexparent'><a class='index' id='do_allocate,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,do_allocate'></a></span><code class='itemdecl'>
void* do_allocate(size_t bytes, size_t alignment) override;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11759'>#</a></div><p ><i>Returns:</i>
A pointer to allocated storage (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>)
with a size of at least <span class='texttt'>bytes</span>.
The size and alignment of the allocated memory shall meet the requirements
for a class derived from <span class='texttt'>memory_&shy;resource</span> (<a href='mem.res'>[mem.res]</a>).</p></div></div><div class='para' id='pool.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11766'>#</a></div><p ><i>Effects:</i>
If the pool selected for a block of size <span class='texttt'>bytes</span>
is unable to satisfy the memory request from its own internal data structures,
it will call <span class='texttt'>upstream_&shy;resource()-&gt;allocate()</span> to obtain more memory.
If <span class='texttt'>bytes</span> is larger than that which the largest pool can handle,
then memory will be allocated using <span class='texttt'>upstream_&shy;resource()-&gt;allocate()</span>.</p></div></div><div class='para' id='pool.mem-6'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11774'>#</a></div><p ><i>Throws:</i>
Nothing unless <span class='texttt'>upstream_&shy;resource()-&gt;allocate()</span> throws.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_deallocate,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,do_deallocate'></a></span><span class='indexparent'><a class='index' id='do_deallocate,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,do_deallocate'></a></span><code class='itemdecl'>
void do_deallocate(void* p, size_t bytes, size_t alignment) override;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-7'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11786'>#</a></div><p ><i>Effects:</i>
Returns the memory at <span class='texttt'>p</span> to the pool.
It is unspecified if, or under what circumstances,
this operation will result in a call to <span class='texttt'>upstream_&shy;resource()-&gt;deallocate()</span>.</p></div></div><div class='para' id='pool.mem-8'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11792'>#</a></div><p ><i>Throws:</i>
Nothing.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_is_equal,synchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='synchronized_pool_resource,do_is_equal'></a></span><code class='itemdecl'>
bool synchronized_pool_resource::do_is_equal(
    const memory_resource&amp; other) const noexcept override;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-9'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11804'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>this == dynamic_&shy;cast&lt;const synchronized_&shy;pool_&shy;resource*&gt;(&amp;other)</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_is_equal,unsynchronized_pool_resource'></a></span><span class='indexparent'><a class='index' id='unsynchronized_pool_resource,do_is_equal'></a></span><code class='itemdecl'>
bool unsynchronized_pool_resource::do_is_equal(
    const memory_resource&amp; other) const noexcept override;
</code></p><div class='itemdescr'></div><div class='para' id='pool.mem-10'><div class='marginalizedparent'><a class='marginalized' href='#pool.mem-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11816'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>this == dynamic_&shy;cast&lt;const unsynchronized_&shy;pool_&shy;resource*&gt;(&amp;other)</span>.
</p></div></div></div></div><div id='monotonic.buffer'><h3 ><a class='secnum' href='#monotonic.buffer' style='min-width:103pt'>20.12.6</a> Class <span class='texttt'>monotonic_&shy;buffer_&shy;resource</span> <a class='abbr_ref' href='mem.res.monotonic.buffer'>[mem.res.monotonic.buffer]</a></h3><div class='para' id='monotonic.buffer-1'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11823'>#</a></div><p >A <span class='texttt'>monotonic_&shy;buffer_&shy;resource</span> is a special-purpose memory resource
intended for very fast memory allocations in situations
where memory is used to build up a few objects
and then is released all at once when the memory resource object is destroyed.
It has the following qualities:
</p><ul class='itemize'><li id='monotonic.buffer-1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#monotonic.buffer-1.1'>(1.1)</a></div><p >A call to <span class='texttt'>deallocate</span> has no effect,
thus the amount of memory consumed increases monotonically
until the resource is destroyed.
</p></li><li id='monotonic.buffer-1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#monotonic.buffer-1.2'>(1.2)</a></div><p >The program can supply an initial buffer,
which the allocator uses to satisfy memory requests.
</p></li><li id='monotonic.buffer-1.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#monotonic.buffer-1.3'>(1.3)</a></div><p >When the initial buffer (if any) is exhausted,
it obtains additional buffers from an <a class='hidden_link' href='#def:upstream' id='def:upstream'><i>upstream</i></a> memory resource
supplied at construction.
Each additional buffer is larger than the previous one,
following a geometric progression.
</p></li><li id='monotonic.buffer-1.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#monotonic.buffer-1.4'>(1.4)</a></div><p >It is intended for access from one thread of control at a time.
Specifically, calls to <span class='texttt'>allocate</span> and <span class='texttt'>deallocate</span>
do not synchronize with one another.
</p></li><li id='monotonic.buffer-1.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#monotonic.buffer-1.5'>(1.5)</a></div><p >It frees the allocated memory on destruction,
even if <span class='texttt'>deallocate</span> has not been called for some of the allocated blocks.
</p></li></ul><p ><span class='indexparent'><a class='index' id='monotonic_buffer_resource'></a></span></p><pre class='codeblock'>
class monotonic_buffer_resource : public memory_resource {
  memory_resource *upstream_rsrc; <span class='comment'>// <i>exposition only</i>
</span>  void *current_buffer;           <span class='comment'>// <i>exposition only</i>
</span>  size_t next_buffer_size;        <span class='comment'>// <i>exposition only</i>
</span>
public:
  explicit monotonic_buffer_resource(memory_resource *upstream);
  monotonic_buffer_resource(size_t initial_size, memory_resource *upstream);
  monotonic_buffer_resource(void *buffer, size_t buffer_size,
                            memory_resource *upstream);

  monotonic_buffer_resource()
      : monotonic_buffer_resource(get_default_resource()) {}
  explicit monotonic_buffer_resource(size_t initial_size)
      : monotonic_buffer_resource(initial_size, get_default_resource()) {}
  monotonic_buffer_resource(void *buffer, size_t buffer_size)
      : monotonic_buffer_resource(buffer, buffer_size, get_default_resource()) {}

  monotonic_buffer_resource(const monotonic_buffer_resource&amp;) = delete;

  virtual ~monotonic_buffer_resource();

  monotonic_buffer_resource
    operator=(const monotonic_buffer_resource&amp;) = delete;

  void release();
  memory_resource* upstream_resource() const;

protected:
  void* do_allocate(size_t bytes, size_t alignment) override;
  void do_deallocate(void* p, size_t bytes, size_t alignment) override;

  bool do_is_equal(const memory_resource&amp; other) const noexcept override;
};</pre></div><div id='monotonic.buffer.ctor'><h4 ><a class='secnum' href='#monotonic.buffer.ctor' style='min-width:118pt'>20.12.6.1</a> <span class='texttt'>monotonic_&shy;buffer_&shy;resource</span> constructor and destructor <a class='abbr_ref' href='mem.res.monotonic.buffer.ctor'>[mem.res.monotonic.buffer.ctor]</a></h4><p ><span class='indexparent'><a class='index' id='monotonic_buffer_resource,constructor'></a></span><code class='itemdecl'>
explicit monotonic_buffer_resource(memory_resource* upstream);
monotonic_buffer_resource(size_t initial_size, memory_resource* upstream);
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11899'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>upstream</span> shall be the address of a valid memory resource.
<span class='texttt'>initial_&shy;size</span>, if specified, shall be greater than zero.</p></div></div><div class='para' id='monotonic.buffer.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11904'>#</a></div><p ><i>Effects:</i>
Sets <span class='texttt'>upstream_&shy;rsrc</span> to <span class='texttt'>upstream</span> and
<span class='texttt'>current_&shy;buffer</span> to <span class='texttt'>nullptr</span>.
If <span class='texttt'>initial_&shy;size</span> is specified,
sets <span class='texttt'>next_&shy;buffer_&shy;size</span> to at least <span class='texttt'>initial_&shy;size</span>;
otherwise sets <span class='texttt'>next_&shy;buffer_&shy;size</span> to an
<span class='indexparent'><a class='index' id='default_next_buffer_size_for_a_monotonic_buffer_resource'></a></span>implementation-defined size.
</p></div></div><p ><span class='indexparent'><a class='index' id='monotonic_buffer_resource,constructor'></a></span><code class='itemdecl'>
monotonic_buffer_resource(void* buffer, size_t buffer_size, memory_resource* upstream);
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.ctor-3'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.ctor-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11920'>#</a></div><p ><i>Requires:</i>
<span class='texttt'>upstream</span> shall be the address of a valid memory resource.
<span class='texttt'>buffer_&shy;size</span> shall be no larger than the number of bytes in <span class='texttt'>buffer</span>.</p></div></div><div class='para' id='monotonic.buffer.ctor-4'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.ctor-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11925'>#</a></div><p ><i>Effects:</i>
Sets <span class='texttt'>upstream_&shy;rsrc</span> to <span class='texttt'>upstream</span>,
<span class='texttt'>current_&shy;buffer</span> to <span class='texttt'>buffer</span>, and
<span class='texttt'>next_&shy;buffer_&shy;size</span> to <span class='texttt'>buffer_&shy;size</span> (but not less than 1),
then increases <span class='texttt'>next_&shy;buffer_&shy;size</span>
by an <span class='indexparent'><a class='index' id='growth_factor_for_monotonic_buffer_resource'></a></span>implementation-defined growth factor (which need not be integral).
</p></div></div><p ><span class='indexparent'><a class='index' id='monotonic_buffer_resource,destructor'></a></span><code class='itemdecl'>
~monotonic_buffer_resource();
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.ctor-5'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.ctor-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11940'>#</a></div><p ><i>Effects:</i>
Calls <span class='texttt'>release()</span>.
</p></div></div></div><div id='monotonic.buffer.mem'><h4 ><a class='secnum' href='#monotonic.buffer.mem' style='min-width:118pt'>20.12.6.2</a> <span class='texttt'>monotonic_&shy;buffer_&shy;resource</span> members <a class='abbr_ref' href='mem.res.monotonic.buffer.mem'>[mem.res.monotonic.buffer.mem]</a></h4><p ><span class='indexparent'><a class='index' id='release,monotonic_buffer_resource'></a></span><span class='indexparent'><a class='index' id='monotonic_buffer_resource,release'></a></span><code class='itemdecl'>
void release();
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11954'>#</a></div><p ><i>Effects:</i>
Calls <span class='texttt'>upstream_&shy;rsrc-&gt;deallocate()</span> as necessary
to release all allocated memory.</p></div></div><div class='para' id='monotonic.buffer.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11959'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><i>Note:</i>
The memory is released back to <span class='texttt'>upstream_&shy;rsrc</span>
even if some blocks that were allocated from <span class='texttt'>this</span>
have not been deallocated from <span class='texttt'>this</span>.<i><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</i><span style='white-space:nowrap'>&thinsp;</span>]
</p></div></div><p ><span class='indexparent'><a class='index' id='upstream_resource,monotonic_buffer_resource'></a></span><span class='indexparent'><a class='index' id='monotonic_buffer_resource,upstream_resource'></a></span><code class='itemdecl'>
memory_resource* upstream_resource() const;
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11972'>#</a></div><p ><i>Returns:</i>
The value of <span class='texttt'>upstream_&shy;rsrc</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_allocate,monotonic_buffer_resource'></a></span><span class='indexparent'><a class='index' id='monotonic_buffer_resource,do_allocate'></a></span><code class='itemdecl'>
void* do_allocate(size_t bytes, size_t alignment) override;
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11983'>#</a></div><p ><i>Returns:</i>
A pointer to allocated storage (<a href='basic.stc.dynamic.deallocation'>[basic.stc.dynamic.deallocation]</a>)
with a size of at least <span class='texttt'>bytes</span>.
The size and alignment of the allocated memory shall meet the requirements
for a class derived from <span class='texttt'>memory_&shy;resource</span> (<a href='mem.res'>[mem.res]</a>).</p></div></div><div class='para' id='monotonic.buffer.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L11990'>#</a></div><p ><i>Effects:</i>
If the unused space in <span class='texttt'>current_&shy;buffer</span>
can fit a block with the specified <span class='texttt'>bytes</span> and <span class='texttt'>alignment</span>,
then allocate the return block from <span class='texttt'>current_&shy;buffer</span>;
otherwise set <span class='texttt'>current_&shy;buffer</span> to <span class='texttt'>upstream_&shy;rsrc-&gt;allocate(n, m)</span>,
where <span class='texttt'>n</span> is not less than <span class='texttt'>max(bytes, next_&shy;buffer_&shy;size)</span> and
<span class='texttt'>m</span> is not less than <span class='texttt'>alignment</span>,
and increase <span class='texttt'>next_&shy;buffer_&shy;size</span>
by an <span class='indexparent'><a class='index' id='growth_factor_for_monotonic_buffer_resource'></a></span>implementation-defined growth factor (which need not be integral),
then allocate the return block from the newly-allocated <span class='texttt'>current_&shy;buffer</span>.</p></div></div><div class='para' id='monotonic.buffer.mem-6'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L12002'>#</a></div><p ><i>Throws:</i>
Nothing unless <span class='texttt'>upstream_&shy;rsrc-&gt;allocate()</span> throws.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_deallocate,monotonic_buffer_resource'></a></span><span class='indexparent'><a class='index' id='monotonic_buffer_resource,do_deallocate'></a></span><code class='itemdecl'>
void do_deallocate(void* p, size_t bytes, size_t alignment) override;
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.mem-7'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L12013'>#</a></div><p ><i>Effects:</i>
None.</p></div></div><div class='para' id='monotonic.buffer.mem-8'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L12017'>#</a></div><p ><i>Throws:</i>
Nothing.</p></div></div><div class='para' id='monotonic.buffer.mem-9'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L12021'>#</a></div><p ><i>Remarks:</i>
Memory used by this resource increases monotonically until its destruction.
</p></div></div><p ><span class='indexparent'><a class='index' id='do_is_equal,monotonic_buffer_resource'></a></span><span class='indexparent'><a class='index' id='monotonic_buffer_resource,do_is_equal'></a></span><code class='itemdecl'>
bool do_is_equal(const memory_resource&amp; other) const noexcept override;
</code></p><div class='itemdescr'></div><div class='para' id='monotonic.buffer.mem-10'><div class='marginalizedparent'><a class='marginalized' href='#monotonic.buffer.mem-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/08fda7e637d27fa331a8fcfc64db98d52ae3b6fd/source/utilities.tex#L12032'>#</a></div><p ><i>Returns:</i>
<span class='texttt'>this == dynamic_&shy;cast&lt;const monotonic_&shy;buffer_&shy;resource*&gt;(&amp;other)</span>.
</p></div></div></div></div></div></div></body></html>