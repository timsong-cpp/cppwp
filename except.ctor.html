<!DOCTYPE html><html lang='en'><head><title>[except.ctor]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>14</a> Exception handling <a class='abbr_ref' href='./#except'>[except]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>14.3</a> Constructors and destructors <a class='abbr_ref'>[except.ctor]</a></h2><div class='texpara'><a class='index' id=':exception_handling,constructors_and_destructors'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/exceptions.tex#L365'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':unwinding,stack'></a>As control passes from the point where an exception is thrown
to a handler,
objects are destroyed by a process,
specified in this subclause, called <a class='hidden_link' href='#def:stack_unwinding' title='14.3&emsp;Constructors and destructors&emsp;[except.ctor]'><span id='def:stack_unwinding'><i >stack unwinding</i></span></a><a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/exceptions.tex#L372'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>Each object with automatic storage duration is destroyed if it has been
constructed, but not yet destroyed,
since the try block was entered<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>If an exception is thrown during the destruction of temporaries or
local variables for a <span id=':return'><span class='texttt'><span class='keyword'>return</span></span></span> statement (<a href='stmt.return' title='8.7.4&emsp;The return statement'>[stmt.<span class='shy'></span>return]</a>),
the destructor for the returned object (if any) is also invoked<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>The objects are destroyed in the reverse order of the completion
of their construction<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>: <span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> Y <span class='curlybracket'>{</span> <span class='operator'>~</span>Y<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='literal'>false</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>throw</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span> <span class='curlybracket'>}</span>;

A f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>try</span> <span class='curlybracket'>{</span>
    A a;
    Y y;
    A b;
    <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;      <span class='comment'>// #1</span>
  <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='curlybracket'>}</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;        <span class='comment'>// #2</span>
<span class='curlybracket'>}</span>
</span> <div id='2.sentence-4' class='sentence'>
At #1, the returned object of type <span class='texttt'>A</span> is constructed<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>Then, the local variable <span class='texttt'>b</span> is destroyed (<a href='stmt.jump' title='8.7&emsp;Jump statements'>[stmt.<span class='shy'></span>jump]</a>)<a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'>Next, the local variable <span class='texttt'>y</span> is destroyed,
causing stack unwinding,
resulting in the destruction of the returned object,
followed by the destruction of the local variable <span class='texttt'>a</span><a class='hidden_link' href='#2.sentence-6'>.</a></div> <div id='2.sentence-7' class='sentence'>Finally, the returned object is constructed again at #2<a class='hidden_link' href='#2.sentence-7'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/exceptions.tex#L407'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>If the initialization of an object
other than by delegating constructor
is terminated by an exception,
the destructor is invoked for
each of the object's subobjects
that were known to be initialized by the object's initialization and
whose initialization has completed (<a href='dcl.init' title='9.4&emsp;Initializers'>[dcl.<span class='shy'></span>init]</a>)<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>: <div id='3.sentence-2' class='sentence'>If such an object has a reference member
that extends the lifetime of a temporary object,
this ends the lifetime of the reference member,
so the lifetime of the temporary object is effectively not extended<a class='hidden_link' href='#3.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='3.sentence-3' class='sentence'><a class='index' id=':subobject,initialized,_known_to_be'></a>A subobject is <a class='hidden_link' href='#def:known_to_be_initialized' title='14.3&emsp;Constructors and destructors&emsp;[except.ctor]'><span id='def:known_to_be_initialized'><i >known to be initialized</i></span></a>
if its initialization is specified
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.1'>(3.1)</a></div>in <a href='class.base.init' title='11.9.3&emsp;Initializing bases and members'>[class.<span class='shy'></span>base.<span class='shy'></span>init]</a> for initialization by constructor,</li><li id='3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.2'>(3.2)</a></div>in <a href='class.copy.ctor' title='11.4.5.3&emsp;Copy/move constructors'>[class.<span class='shy'></span>copy.<span class='shy'></span>ctor]</a> for initialization by defaulted copy/move constructor,</li><li id='3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.3'>(3.3)</a></div>in <a href='class.inhctor.init' title='11.9.4&emsp;Initialization by inherited constructor'>[class.<span class='shy'></span>inhctor.<span class='shy'></span>init]</a> for initialization by inherited constructor,</li><li id='3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.4'>(3.4)</a></div>in <a href='dcl.init.aggr' title='9.4.2&emsp;Aggregates'>[dcl.<span class='shy'></span>init.<span class='shy'></span>aggr]</a> for aggregate initialization,</li><li id='3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.5'>(3.5)</a></div>in <a href='expr.prim.lambda.capture' title='7.5.5.3&emsp;Captures'>[expr.<span class='shy'></span>prim.<span class='shy'></span>lambda.<span class='shy'></span>capture]</a> for the initialization of
the closure object when evaluating a <a href='expr.prim.lambda.general#nt:lambda-expression' title='7.5.5.1&emsp;General&emsp;[expr.prim.lambda.general]'><span id='ntref:lambda-expression'><span class='textsf'><i >lambda-expression</i></span></span></a>,</li><li id='3.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.6'>(3.6)</a></div>in <a href='dcl.init.general' title='9.4.1&emsp;General'>[dcl.<span class='shy'></span>init.<span class='shy'></span>general]</a> for
default-initialization, value-initialization, or direct-initialization
of an array<a class='hidden_link' href='#3.sentence-3'>.</a></li></ul></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>: <div id='3.sentence-4' class='sentence'>This includes virtual base class subobjects
if the initialization
is for a complete object, and
can include variant members
that were nominated explicitly by
a <a href='class.base.init#nt:mem-initializer' title='11.9.3&emsp;Initializing bases and members&emsp;[class.base.init]'><span id='ntref:mem-initializer'><span class='textsf'><i >mem-initializer</i></span></span></a> or <a href='dcl.init.general#nt:designated-initializer-clause' title='9.4.1&emsp;General&emsp;[dcl.init.general]'><span id='ntref:designated-initializer-clause'><span class='textsf'><i >designated-initializer-clause</i></span></span></a> or
that have a default member initializer<a class='hidden_link' href='#3.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='3.sentence-5' class='sentence'>
If the destructor of an object is terminated by an exception,
each destructor invocation
that would be performed after executing the body of the destructor (<a href='class.dtor' title='11.4.7&emsp;Destructors'>[class.<span class='shy'></span>dtor]</a>) and
that has not yet begun execution
is performed<a class='hidden_link' href='#3.sentence-5'>.</a></div> <div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>: <div id='3.sentence-6' class='sentence'>This includes virtual base class subobjects if
the destructor was invoked for a complete object<a class='hidden_link' href='#3.sentence-6'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='3.sentence-7' class='sentence'>
The subobjects are destroyed in the reverse order of the completion of
their construction<a class='hidden_link' href='#3.sentence-7'>.</a></div> <div id='3.sentence-8' class='sentence'>Such destruction is sequenced before entering a
handler of the <a href='except.pre#nt:function-try-block' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:function-try-block'><span class='textsf'><i >function-try-block</i></span></span></a> of the constructor or destructor,
if any<a class='hidden_link' href='#3.sentence-8'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/exceptions.tex#L458'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>If the <a href='stmt.block#nt:compound-statement' title='8.4&emsp;Compound statement or block&emsp;[stmt.block]'><span id='ntref:compound-statement'><span class='textsf'><i >compound-statement</i></span></span></a>
of the <a href='dcl.fct.def.general#nt:function-body' title='9.5.1&emsp;In general&emsp;[dcl.fct.def.general]'><span id='ntref:function-body'><span class='textsf'><i >function-body</i></span></span></a>
of a delegating constructor
for an object exits via
an exception, the object's destructor is invoked<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>Such destruction is sequenced before entering a handler of the
<a href='except.pre#nt:function-try-block' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:function-try-block_'><span class='textsf'><i >function-try-block</i></span></span></a> of a delegating constructor for that object, if any<a class='hidden_link' href='#4.sentence-2'>.</a></div></div></div><div class='para nonNormativeOnly' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/exceptions.tex#L467'>#</a></div><div class='texpara'><div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>: <div id='5.sentence-1' class='sentence'>If the object was allocated by a <a href='expr.new#nt:new-expression' title='7.6.2.8&emsp;New&emsp;[expr.new]'><span id='ntref:new-expression'><span class='textsf'><i >new-expression</i></span></span></a> (<a href='expr.new' title='7.6.2.8&emsp;New'>[expr.<span class='shy'></span>new]</a>),
the matching <a href='basic.stc.dynamic.deallocation' title='6.7.5.5.3&emsp;Deallocation functions&emsp;[basic.stc.dynamic.deallocation]'>deallocation function</a>,
if any, is called to free the storage occupied by the object<a class='hidden_link' href='#5.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></body></html>