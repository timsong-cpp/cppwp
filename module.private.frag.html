<!DOCTYPE html><html lang='en'><head><title>[module.private.frag]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>10</a> Modules <a class='abbr_ref' href='./#module'>[module]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>10.5</a> Private module fragment <a class='abbr_ref'>[module.private.frag]</a></h2><pre class='bnf'><a class='nontermdef' href='#nt:private-module-fragment' id='nt:private-module-fragment'>private-module-fragment:</a>
&#9;module-keyword <span class='terminal'><span class='operator'>:</span></span> <span class='texttt'><span class='keyword'>private</span></span><span class='indexparent'><a class='index' id=':private'></a></span> <span class='terminal'>;</span> <a class='grammarterm' href='dcl.pre#nt:declaration-seq'>declaration-seq</a><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f471be1e24be13549e375af62e05b2b22ff17e12/source/modules.tex#L792'>#</a></div><div id='1.sentence-1' class='sentence'>A <a class='grammarterm' href='#nt:private-module-fragment'>private-module-fragment</a> shall appear only
in a primary module interface unit (<a href='module.unit'>[module.unit]</a>)<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>A module unit with a <a class='grammarterm' href='#nt:private-module-fragment'>private-module-fragment</a>
shall be the only module unit of its module;
no diagnostic is required<a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f471be1e24be13549e375af62e05b2b22ff17e12/source/modules.tex#L799'>#</a></div><div id='2.note-1' class='note'>[&nbsp;<a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-1' class='sentence'>A <a class='grammarterm' href='#nt:private-module-fragment'>private-module-fragment</a> ends
the portion of the module interface unit
that can affect the behavior of other translation units<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>A <a class='grammarterm' href='#nt:private-module-fragment'>private-module-fragment</a> allows a module
to be represented as a single translation unit
without making all of the contents of the module reachable to importers<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>The presence of a <a class='grammarterm' href='#nt:private-module-fragment'>private-module-fragment</a> affects:
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div>the point by which the definition of
an exported inline function
is required (<a href='dcl.inline'>[dcl.inline]</a>),</li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div>the point by which the definition of
an exported function with a placeholder return type
is required (<a href='dcl.spec.auto'>[dcl.spec.auto]</a>),</li><li id='2.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.3'>(2.3)</a></div>whether a declaration is required not to be an exposure (<a href='basic.link'>[basic.link]</a>),</li><li id='2.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.4'>(2.4)</a></div>where definitions for inline functions and templates
must appear (<a href='basic.def.odr'>[basic.def.odr]</a>, <a href='temp.pre'>[temp.pre]</a>),</li><li id='2.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.5'>(2.5)</a></div>the instantiation contexts of templates
instantiated before it (<a href='module.context'>[module.context]</a>), and</li><li id='2.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.6'>(2.6)</a></div>the reachability of declarations within it (<a href='module.reach'>[module.reach]</a>)<a class='hidden_link' href='#2.sentence-3'>.</a></li></ul></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f471be1e24be13549e375af62e05b2b22ff17e12/source/modules.tex#L835'>#</a></div><div id='3.example-1' class='example'>[&nbsp;<a class='example_link' href='#3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>export</span> <span class='keyword'>module</span> A;
<span class='keyword'>export</span> <span class='keyword'>inline</span> <span class='keyword'>void</span> fn_e<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;      <span class='comment'>// error: exported inline function <span class='tcode_in_codeblock'>fn_&shy;e</span> not defined</span>
                                <span class='comment'>// before private module fragment</span>
<span class='keyword'>inline</span> <span class='keyword'>void</span> fn_m<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;             <span class='comment'>// OK, module-linkage inline function</span>
<span class='keyword'>static</span> <span class='keyword'>void</span> fn_s<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>export</span> <span class='keyword'>struct</span> X;
<span class='keyword'>export</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span>X <span class='operator'>*</span>x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  fn_s<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                       <span class='comment'>// OK, call to static function in same translation unit</span>
  fn_m<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                       <span class='comment'>// OK, call to module-linkage inline function</span>
<span class='curlybracket'>}</span>
<span class='keyword'>export</span> X <span class='operator'>*</span>factory<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;            <span class='comment'>// OK</span>

<span class='keyword'>module</span> <span class='operator'>:</span><span class='keyword'>private</span>;
<span class='keyword'>struct</span> X <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                    <span class='comment'>// definition not reachable from importers of <span class='tcode_in_codeblock'>A</span></span>
X <span class='operator'>*</span>factory<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='keyword'>new</span> X <span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>void</span> fn_e<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
<span class='keyword'>void</span> fn_m<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
<span class='keyword'>void</span> fn_s<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div></body></html>