<!DOCTYPE html><html lang='en'><head><title>[expr.const]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>7</a> Expressions <a class='abbr_ref' href='./#expr'>[expr]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>7.7</a> Constant expressions <a class='abbr_ref'>[expr.const]</a></h2><span class='indexparent'><a class='index' id=':expression,constant'></a></span><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L6805'>#</a></div><div id='1.sentence-1' class='sentence'>Certain contexts require expressions that satisfy additional
requirements as detailed in this subclause; other contexts have different
semantics depending on whether or not an expression satisfies these requirements<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>Expressions that satisfy these requirements,
assuming that copy elision (<a href='class.copy.elision'>[class.copy.elision]</a>) is not performed,
are called
<span class='indexparent'><a class='index' id=':expression,constant_'></a></span><a class='hidden_link' href='#def:constant_expression' id='def:constant_expression'><i >constant expressions</i></a><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.note-1' class='note'>[&nbsp;<a class='note_link' href='#1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.sentence-3' class='sentence'>Constant expressions can be evaluated
during translation<a class='hidden_link' href='#1.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> <pre class='bnf'><a class='nontermdef' href='#nt:constant-expression' id='nt:constant-expression'>constant-expression:</a>
&#9;<a class='grammarterm' href='expr.cond#nt:conditional-expression'>conditional-expression</a>
</pre></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L6824'>#</a></div><div id='2.sentence-1' class='sentence'>A variable or temporary object <span class='texttt'>o</span> is <a class='hidden_link' href='#def:constant-initialized' id='def:constant-initialized'><i >constant-initialized</i></a> if
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div>either it has an initializer or
  its default-initialization results in some initialization being performed, and</li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div>the full-expression of its initialization is a constant expression
  when interpreted as a <a class='grammarterm' href='#nt:constant-expression'>constant-expression</a>,
  except that if <span class='texttt'>o</span> is an object,
  that full-expression
  may also invoke constexpr constructors
  for <span class='texttt'>o</span> and its subobjects
  even if those objects are of non-literal class types<a class='hidden_link' href='#2.sentence-1'>.</a> <div id='2.2.note-1' class='note'>[&nbsp;<a class='note_link' href='#2.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> Such a class may have a non-trivial destructor. Within this evaluation,
  <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>is_&shy;constant_&shy;evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> (<a href='meta.const.eval'>[meta.const.eval]</a>)
  returns <span class='texttt'><span class='literal'>true</span></span>. —&nbsp;<i>end note</i></div>&nbsp;]</div> </li></ul></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L6846'>#</a></div><div id='3.sentence-1' class='sentence'>A variable is <a class='hidden_link' href='#def:potentially-constant' id='def:potentially-constant'><i >potentially-constant</i></a> if
it is constexpr or
it has reference or const-qualified integral or enumeration type<a class='hidden_link' href='#3.sentence-1'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L6851'>#</a></div><div id='4.sentence-1' class='sentence'>A constant-initialized potentially-constant variable is
<a class='hidden_link' href='#def:usable_in_constant_expressions' id='def:usable_in_constant_expressions'><i >usable in constant expressions</i></a> at a point <span class='math'><span class='mathalpha'>P</span></span> if
its initializing declaration <span class='math'><span class='mathalpha'>D</span></span> is reachable from <span class='math'><span class='mathalpha'>P</span></span> and
<ul class='itemize'><li id='4.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.1'>(4.1)</a></div>it is constexpr,</li><li id='4.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.2'>(4.2)</a></div>it is not initialized to a TU-local value, or</li><li id='4.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.3'>(4.3)</a></div><span class='math'><span class='mathalpha'>P</span></span> is in the same translation unit as <span class='math'><span class='mathalpha'>D</span></span>.</li></ul></div> <div id='4.sentence-2' class='sentence'>
An object or reference is <a class='hidden_link' href='#def:usable_in_constant_expressions_' id='def:usable_in_constant_expressions_'><i >usable in constant expressions</i></a> if it is
<ul class='itemize'><li id='4.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.4'>(4.4)</a></div>a variable that is usable in constant expressions, or</li><li id='4.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.5'>(4.5)</a></div>a template parameter object (<a href='temp.param'>[temp.param]</a>), or</li><li id='4.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.6'>(4.6)</a></div>a string literal object (<a href='lex.string'>[lex.string]</a>), or</li><li id='4.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.7'>(4.7)</a></div>a temporary object of non-volatile const-qualified literal type
  whose lifetime is extended (<a href='class.temporary'>[class.temporary]</a>)
  to that of a variable that is usable in constant expressions, or</li><li id='4.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#4.8'>(4.8)</a></div>a non-mutable subobject or reference member of any of the above<a class='hidden_link' href='#4.sentence-2'>.</a></li></ul></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L6871'>#</a></div><div id='5.sentence-1' class='sentence'>An expression <span class='math'><span class='mathalpha'>E</span></span> is a <a class='hidden_link' href='#def:expression,core_constant' id='def:expression,core_constant'><i >core constant expression</i></a>
unless the evaluation of <span class='math'><span class='mathalpha'>E</span></span>, following the rules of the abstract
machine (<a href='intro.execution'>[intro.execution]</a>), would evaluate one of the following:
<ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.1'>(5.1)</a></div><span class='texttt'><span class='keyword'>this</span></span> (<a href='expr.prim.this'>[expr.prim.this]</a>), except in a constexpr
function (<a href='dcl.constexpr'>[dcl.constexpr]</a>) that is being evaluated as part
of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.2'>(5.2)</a></div>an invocation of a non-constexpr function
<div id='5.2.note-1' class='note'>[&nbsp;<a class='note_link' href='#5.2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> Overload resolution (<a href='over.match'>[over.match]</a>)
is applied as usual. —&nbsp;<i>end note</i></div>&nbsp;]</div> ;</li><li id='5.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.3'>(5.3)</a></div>an invocation of an undefined constexpr function;</li><li id='5.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.4'>(5.4)</a></div>an invocation of an instantiated constexpr function
that fails to satisfy the requirements
for a constexpr function;</li><li id='5.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.5'>(5.5)</a></div>an invocation of a virtual function (<a href='class.virtual'>[class.virtual]</a>)
for an object unless
  <ul class='itemize'><li id='5.5.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.5.1'>(5.5.1)</a></div>the object is usable in constant expressions or</li><li id='5.5.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.5.2'>(5.5.2)</a></div>its lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li></ul></li><li id='5.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.6'>(5.6)</a></div>an expression that would exceed the implementation-defined
limits (see <a href='implimits'>[implimits]</a>);</li><li id='5.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.7'>(5.7)</a></div>an operation that would have undefined behavior
as specified in <a href='intro'>[intro]</a> through <a href='cpp'>[cpp]</a>
of this document
<div id='5.7.note-2' class='note'>[&nbsp;<a class='note_link' href='#5.7.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> including,
for example, signed integer overflow (<a href='expr.prop'>[expr.prop]</a>), certain
pointer arithmetic (<a href='expr.add'>[expr.add]</a>), <a href='expr.mul'>division by
zero</a>, or certain <a href='expr.shift'>shift operations</a> —&nbsp;<i>end note</i></div>&nbsp;]</div> ;</li><li id='5.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.8'>(5.8)</a></div>an <a href='conv.lval'>lvalue-to-rvalue conversion</a> unless
it is applied to
<ul class='itemize'><li id='5.8.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.8.1'>(5.8.1)</a></div>a non-volatile glvalue that refers to an object that is
  usable in constant expressions, or</li><li id='5.8.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.8.2'>(5.8.2)</a></div>a non-volatile glvalue of literal type that refers to a non-volatile object
  whose lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li></ul></li><li id='5.9'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.9'>(5.9)</a></div>an <a href='conv.lval'>lvalue-to-rvalue conversion</a>
that is applied to a glvalue
that refers to a non-active member of a union or a subobject thereof;</li><li id='5.10'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.10'>(5.10)</a></div>an lvalue-to-rvalue conversion that is applied to
an object with an indeterminate value (<a href='basic.indet'>[basic.indet]</a>);</li><li id='5.11'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.11'>(5.11)</a></div>an invocation of an implicitly-defined copy/move constructor or
copy/move assignment operator
for a union whose active member (if any) is mutable,
unless the lifetime of the union object began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.12'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.12'>(5.12)</a></div>an <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> that refers to a variable or
data member of reference type
unless the reference has a preceding initialization and either
<ul class='itemize'><li id='5.12.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.12.1'>(5.12.1)</a></div>it is usable in constant expressions or</li><li id='5.12.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#5.12.2'>(5.12.2)</a></div>its lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li></ul></li><li id='5.13'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.13'>(5.13)</a></div>in a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>,
a reference to <span class='texttt'><span class='keyword'>this</span></span> or to a variable with
automatic storage duration defined outside that
<a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>, where
the reference would be an <a href='basic.def.odr'>odr-use</a>;
<div id='5.13.example-1' class='example'>[&nbsp;<a class='example_link' href='#5.13.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> n <span class='operator'>=</span> <span class='literal'>0</span>;
  <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>int</span> i <span class='operator'>=</span> n;        <span class='comment'>// OK, <span class='tcode_in_codeblock'>n</span> is not odr-used here</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>int</span> j <span class='operator'>=</span> <span class='operator'>*</span><span class='operator'>&amp;</span>n;      <span class='comment'>// error: <span class='tcode_in_codeblock'>&amp;n</span> would be an odr-use of <span class='tcode_in_codeblock'>n</span></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> 
<div id='5.13.note-3' class='note'>[&nbsp;<a class='note_link' href='#5.13.note-3'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> If the odr-use occurs in an invocation
of a function call operator of a closure type,
it no longer refers to <span class='texttt'><span class='keyword'>this</span></span> or to an enclosing automatic variable
due to the transformation (<a href='expr.prim.lambda.capture'>[expr.prim.lambda.capture]</a>)
of the <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> into
an access of the corresponding data member. <div id='5.13.example-2' class='example'>[&nbsp;<a class='example_link' href='#5.13.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>auto</span> monad <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> v<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> v; <span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> bind <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> m<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> fvm<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> fvm<span class='parenthesis'>(</span>m<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>;

<span class='comment'>// OK to capture objects with automatic storage duration created during constant expression evaluation.</span>
<span class='keyword'>static_assert</span><span class='parenthesis'>(</span>bind<span class='parenthesis'>(</span>monad<span class='parenthesis'>(</span><span class='literal'>2</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>monad<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> monad<span class='parenthesis'>(</span><span class='literal'>2</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </li><li id='5.14'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.14'>(5.14)</a></div>a conversion from type <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span><span class='operator'>*</span></span> to a pointer-to-object type;</li><li id='5.15'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.15'>(5.15)</a></div>a <span class='texttt'><span class='keyword'>reinterpret_&shy;cast</span></span> (<a href='expr.reinterpret.cast'>[expr.reinterpret.cast]</a>);</li><li id='5.16'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.16'>(5.16)</a></div>a modification of an object (<a href='expr.ass'>[expr.ass]</a>, <a href='expr.post.incr'>[expr.post.incr]</a>,
<a href='expr.pre.incr'>[expr.pre.incr]</a>)
unless it is applied to a non-volatile lvalue of literal type
that refers to a non-volatile object
whose lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.17'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.17'>(5.17)</a></div>a <a class='grammarterm' href='expr.new#nt:new-expression'>new-expression</a>,
unless the selected allocation function is
a replaceable global allocation function (<a href='new.delete.single'>[new.delete.single]</a>,
<a href='new.delete.array'>[new.delete.array]</a>) and
the allocated storage is deallocated within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.18'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.18'>(5.18)</a></div>a <a class='grammarterm' href='expr.delete#nt:delete-expression'>delete-expression</a>,
unless it deallocates a region of storage
allocated within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.19'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.19'>(5.19)</a></div>a call to an instance of
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>allocate</span> (<a href='allocator.members'>[allocator.members]</a>),
unless the allocated storage is deallocated within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.20'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.20'>(5.20)</a></div>a call to an instance of
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>deallocate</span> (<a href='allocator.members'>[allocator.members]</a>),
unless it deallocates a region of storage
allocated within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>;</li><li id='5.21'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.21'>(5.21)</a></div>an <a class='grammarterm' href='expr.await#nt:await-expression'>await-expression</a>;</li><li id='5.22'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.22'>(5.22)</a></div>a <a class='grammarterm' href='expr.yield#nt:yield-expression'>yield-expression</a>;</li><li id='5.23'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.23'>(5.23)</a></div>a three-way comparison (<a href='expr.spaceship'>[expr.spaceship]</a>),
relational (<a href='expr.rel'>[expr.rel]</a>), or equality (<a href='expr.eq'>[expr.eq]</a>)
operator where the result is unspecified;</li><li id='5.24'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.24'>(5.24)</a></div>a <a class='grammarterm' href='expr.throw#nt:throw-expression'>throw-expression</a> or
a dynamic cast (<a href='expr.dynamic.cast'>[expr.dynamic.cast]</a>) or <span class='texttt'><span class='keyword'>typeid</span></span> (<a href='expr.typeid'>[expr.typeid]</a>) expression
that would throw an exception;</li><li id='5.25'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.25'>(5.25)</a></div>an <a class='grammarterm' href='dcl.asm#nt:asm-declaration'>asm-declaration</a>; or</li><li id='5.26'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#5.26'>(5.26)</a></div>an invocation of the <span class='texttt'>va_&shy;arg</span> macro (<a href='cstdarg.syn'>[cstdarg.syn]</a>)<a class='hidden_link' href='#5.sentence-1'>.</a></li></ul></div><div id='5.sentence-2' class='sentence'>If <span class='math'><span class='mathalpha'>E</span></span> satisfies the constraints of a core constant expression, but
evaluation of <span class='math'><span class='mathalpha'>E</span></span> would evaluate an operation that has undefined behavior
as specified in <a href='library'>[library]</a> through <a href='thread'>[thread]</a> of this document, or
an invocation of the <span class='texttt'>va_&shy;start</span> macro (<a href='cstdarg.syn'>[cstdarg.syn]</a>),
it is unspecified whether <span class='math'><span class='mathalpha'>E</span></span> is a core constant expression<a class='hidden_link' href='#5.sentence-2'>.</a></div><div style='height:0.6em;display:block'></div><div id='5.example-3' class='example'>[&nbsp;<a class='example_link' href='#5.example-3'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> x;                              <span class='comment'>// not constant</span>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> A<span class='parenthesis'>(</span><span class='keyword'>bool</span> b<span class='parenthesis'>)</span> <span class='operator'>:</span> m<span class='parenthesis'>(</span>b<span class='operator'>?</span><span class='literal'>42</span><span class='operator'>:</span>x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
  <span class='keyword'>int</span> m;
<span class='curlybracket'>}</span>;
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> v <span class='operator'>=</span> A<span class='parenthesis'>(</span><span class='literal'>true</span><span class='parenthesis'>)</span><span class='operator'>.</span>m;        <span class='comment'>// OK: constructor call initializes <span class='tcode_in_codeblock'>m</span> with the value <span class='tcode_in_codeblock'>42</span></span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> w <span class='operator'>=</span> A<span class='parenthesis'>(</span><span class='literal'>false</span><span class='parenthesis'>)</span><span class='operator'>.</span>m;       <span class='comment'>// error: initializer for <span class='tcode_in_codeblock'>m</span> is <span class='tcode_in_codeblock'>x</span>, which is non-constant</span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f1<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>int</span> x <span class='operator'>=</span> k;              <span class='comment'>// error: <span class='tcode_in_codeblock'>x</span> is not initialized by a constant expression</span>
                                    <span class='comment'>// because lifetime of <span class='tcode_in_codeblock'>k</span> began outside the initializer of <span class='tcode_in_codeblock'>x</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f2<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> k;                        <span class='comment'>// OK: not required to be a constant expression</span>
                                    <span class='comment'>// because <span class='tcode_in_codeblock'>x</span> is not <span class='tcode_in_codeblock'>constexpr</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> incr<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>&amp;</span>n<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='operator'>+</span><span class='operator'>+</span>n;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> g<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>int</span> x <span class='operator'>=</span> incr<span class='parenthesis'>(</span>k<span class='parenthesis'>)</span>;        <span class='comment'>// error: <span class='tcode_in_codeblock'>incr(k)</span> is not a core constant expression</span>
                                    <span class='comment'>// because lifetime of <span class='tcode_in_codeblock'>k</span> began outside the expression <span class='tcode_in_codeblock'>incr(k)</span></span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> h<span class='parenthesis'>(</span><span class='keyword'>int</span> k<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> incr<span class='parenthesis'>(</span>k<span class='parenthesis'>)</span>;                  <span class='comment'>// OK: <span class='tcode_in_codeblock'>incr(k)</span> is not required to be a core constant expression</span>
  <span class='keyword'>return</span> x;
<span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> y <span class='operator'>=</span> h<span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>;             <span class='comment'>// OK: initializes <span class='tcode_in_codeblock'>y</span> with the value <span class='tcode_in_codeblock'>2</span></span>
                                    <span class='comment'>// <span class='tcode_in_codeblock'>h(1)</span> is a core constant expression because</span>
                                    <span class='comment'>// the lifetime of <span class='tcode_in_codeblock'>k</span> begins inside <span class='tcode_in_codeblock'>h(1)</span></span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7103'>#</a></div><div id='6.sentence-1' class='sentence'>For the purposes of determining
whether an expression <span class='math'><span class='mathalpha'>E</span></span> is a core constant expression,
the evaluation of a call to a member function of <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span>
as defined in <a href='allocator.members'>[allocator.members]</a>, where <span class='texttt'>T</span> is a literal type,
does not disqualify <span class='math'><span class='mathalpha'>E</span></span> from being a core constant expression,
even if the actual evaluation of such a call
would otherwise fail the requirements for a core constant expression<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>Similarly, the evaluation of a call to
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>, or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>
does not disqualify <span class='math'><span class='mathalpha'>E</span></span>
from being a core constant expression unless:
<ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.1'>(6.1)</a></div>for a call to <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span> or <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>construct_&shy;at</span>,
  the first argument, of type <span class='texttt'>T<span class='operator'>*</span></span>,
  does not point
  to storage allocated with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> or
  to an object whose lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>, or
  the evaluation of the underlying constructor call
  disqualifies <span class='math'><span class='mathalpha'>E</span></span> from being a core constant expression, or</li><li id='6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.2'>(6.2)</a></div>for a call to <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span> or <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>ranges<span class='operator'>&#x200b;::&#x200b;</span>destroy_&shy;at</span>,
  the first argument, of type <span class='texttt'>T<span class='operator'>*</span></span>,
  does not point
  to storage allocated with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>allocator<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> or
  to an object whose lifetime began within the evaluation of <span class='math'><span class='mathalpha'>E</span></span>, or
  the evaluation of the underlying destructor call
  disqualifies <span class='math'><span class='mathalpha'>E</span></span> from being a core constant expression<a class='hidden_link' href='#6.sentence-2'>.</a></li></ul></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7137'>#</a></div><div id='7.sentence-1' class='sentence'>An object <span class='texttt'>a</span> is said to have <a class='hidden_link' href='#def:destruction,constant' id='def:destruction,constant'><i >constant destruction</i></a> if:
<ul class='itemize'><li id='7.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.1'>(7.1)</a></div>it is not of class type nor (possibly multi-dimensional) array thereof, or</li><li id='7.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.2'>(7.2)</a></div>it is of class type or (possibly multi-dimensional) array thereof,
  that class type has a constexpr destructor, and
  for a hypothetical expression <span class='math'><span class='mathalpha'>E</span></span>
  whose only effect is to destroy <span class='texttt'>a</span>,
  <span class='math'><span class='mathalpha'>E</span></span> would be a core constant expression
  if the lifetime of <span class='texttt'>a</span> and its non-mutable subobjects
  (but not its mutable subobjects) were considered to start within <span class='math'><span class='mathalpha'>E</span></span><a class='hidden_link' href='#7.sentence-1'>.</a></li></ul></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7152'>#</a></div><div id='8.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:expression,integral_constant' id='def:expression,integral_constant'><i >integral constant expression</i></a>
is an expression of integral or
unscoped enumeration type, implicitly converted to a prvalue, where the converted expression is a core constant expression<a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='8.note-1' class='note'>[&nbsp;<a class='note_link' href='#8.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='8.sentence-2' class='sentence'>Such expressions may be
used as <a href='class.bit'>bit-field</a> lengths, as enumerator
initializers if the underlying type is not fixed (<a href='dcl.enum'>[dcl.enum]</a>),
and as <a href='dcl.align'>alignments</a><a class='hidden_link' href='#8.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7163'>#</a></div><div id='9.sentence-1' class='sentence'>If an expression of literal class type is used in a context where an
integral constant expression is required, then that expression is
contextually implicitly converted (<a href='conv'>[conv]</a>) to an integral or unscoped
enumeration type
and the selected conversion function shall be <span class='texttt'><span class='keyword'>constexpr</span></span><a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='9.example-1' class='example'>[&nbsp;<a class='example_link' href='#9.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> A<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='operator'>:</span> val<span class='parenthesis'>(</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> val; <span class='curlybracket'>}</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> <span class='keyword'>long</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>42</span>; <span class='curlybracket'>}</span>
<span class='keyword'>private</span><span class='operator'>:</span>
  <span class='keyword'>int</span> val;
<span class='curlybracket'>}</span>;
<span class='keyword'>constexpr</span> A a <span class='operator'>=</span> <span class='keyword'>alignof</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>;
<span class='keyword'>alignas</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='keyword'>int</span> n;               <span class='comment'>// error: ambiguous conversion</span>
<span class='keyword'>struct</span> B <span class='curlybracket'>{</span> <span class='keyword'>int</span> n <span class='operator'>:</span> a; <span class='curlybracket'>}</span>;        <span class='comment'>// error: ambiguous conversion</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7184'>#</a></div><div id='10.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:expression,converted_constant' id='def:expression,converted_constant'><i >converted constant expression</i></a>
of type <span class='texttt'>T</span> is an
expression, implicitly converted to type <span class='texttt'>T</span>, where
the converted expression is a constant expression and the
implicit conversion sequence contains only
<ul class='itemize'><li id='10.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.1'>(10.1)</a></div>user-defined conversions,</li><li id='10.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.2'>(10.2)</a></div><a href='conv.lval'>lvalue-to-rvalue conversions</a>,</li><li id='10.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.3'>(10.3)</a></div><a href='conv.array'>array-to-pointer conversions</a>,</li><li id='10.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.4'>(10.4)</a></div><a href='conv.func'>function-to-pointer conversions</a>,</li><li id='10.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.5'>(10.5)</a></div><a href='conv.qual'>qualification conversions</a>,</li><li id='10.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.6'>(10.6)</a></div><a href='conv.prom#def:integral_promotions'>integral promotions</a>,</li><li id='10.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.7'>(10.7)</a></div><a href='conv.integral'>integral conversions</a> other than
<a href='dcl.init.list#def:narrowing_conversion'>narrowing conversions</a>,</li><li id='10.8'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.8'>(10.8)</a></div><a href='conv.ptr#def:null_pointer_conversion'>null pointer conversions</a> from <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>nullptr_&shy;t</span>,</li><li id='10.9'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.9'>(10.9)</a></div><a href='conv.mem#def:null_member_pointer_conversion'>null member pointer conversions</a> from <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>nullptr_&shy;t</span>, and</li><li id='10.10'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.10'>(10.10)</a></div><a href='conv.fctptr'>function pointer conversions</a>,</li></ul>
and where the reference binding (if any) binds directly<a class='hidden_link' href='#10.sentence-1'>.</a></div> <div id='10.note-1' class='note'>[&nbsp;<a class='note_link' href='#10.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='10.sentence-2' class='sentence'>Such expressions may be used in <a href='expr.new'><span class='texttt'>new</span>
expressions</a>, as <a href='stmt.switch'>case expressions</a>,
as enumerator initializers if the underlying type is
<a href='dcl.enum#def:type,underlying,fixed'>fixed</a>, as <a href='dcl.array'>array</a> bounds, and
as non-type <a href='temp.arg'>template arguments</a><a class='hidden_link' href='#10.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='10.sentence-3' class='sentence'><span class='indexparent'><a class='index' id=':conversion,contextual_to_constant_expression_of_type_bool'></a></span>A <a class='hidden_link' href='#def:contextually_converted_constant_expression_of_type_bool' id='def:contextually_converted_constant_expression_of_type_bool'><i>contextually converted constant expression of type <span class='texttt'><span class='keyword'>bool</span></span></i></a> is
an expression, <a href='conv#def:conversion,contextual_to_bool'>contextually converted to <span class='texttt'>bool</span></a>,
where the converted expression is a constant expression and
the conversion sequence contains only the conversions above<a class='hidden_link' href='#10.sentence-3'>.</a></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7219'>#</a></div><div id='11.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:expression,constant' id='def:expression,constant'><i >constant expression</i></a> is either
a glvalue core constant expression that refers to
an entity that is a permitted result of a constant expression (as defined below), or
a prvalue core constant expression whose value
satisfies the following constraints:
<ul class='itemize'><li id='11.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#11.1'>(11.1)</a></div>if the value is an object of class type,
  each non-static data member of reference type refers to
  an entity that is a permitted result of a constant expression,</li><li id='11.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#11.2'>(11.2)</a></div>if the value is of pointer type, it contains
  the address of an object with static storage duration,
  the address past the end of such an object (<a href='expr.add'>[expr.add]</a>),
  the address of a non-immediate function,
  or a null pointer value,</li><li id='11.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#11.3'>(11.3)</a></div>if the value is of pointer-to-member-function type,
  it does not designate an immediate function, and</li><li id='11.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#11.4'>(11.4)</a></div>if the value is an object of class or array type,
  each subobject satisfies these constraints for the value<a class='hidden_link' href='#11.sentence-1'>.</a></li></ul></div> <div id='11.sentence-2' class='sentence'>
An entity is a
<a class='hidden_link' href='#def:constant_expression,permitted_result_of' id='def:constant_expression,permitted_result_of'><i >permitted result of a constant expression</i></a>
if it is an
object with static storage duration that either is not a temporary object or is
a temporary object whose value satisfies the above constraints, or if
it is a non-immediate function<a class='hidden_link' href='#11.sentence-2'>.</a></div> <div id='11.example-1' class='example'>[&nbsp;<a class='example_link' href='#11.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>consteval</span> <span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>42</span>; <span class='curlybracket'>}</span>
<span class='keyword'>consteval</span> <span class='keyword'>auto</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> f; <span class='curlybracket'>}</span>
<span class='keyword'>consteval</span> <span class='keyword'>int</span> h<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='parenthesis'>(</span><span class='operator'>*</span>p<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> p<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='keyword'>constexpr</span> <span class='keyword'>int</span> r <span class='operator'>=</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                          <span class='comment'>// OK</span>
<span class='keyword'>constexpr</span> <span class='keyword'>auto</span> e <span class='operator'>=</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// error: a pointer to an immediate function is</span>
                                                <span class='comment'>// not a permitted result of a constant expression</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7262'>#</a></div><div id='12.note-1' class='note'>[&nbsp;<a class='note_link' href='#12.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='12.sentence-1' class='sentence'>Since this document
imposes no restrictions on the accuracy of floating-point operations, it is unspecified whether the
evaluation of a floating-point expression during translation yields the same result as the
evaluation of the same expression (or the same operations on the same values) during program
execution<a class='hidden_link' href='#12.sentence-1'>.</a><a class='footnotenum' href='#footnote-79' id='footnoteref-79'>79</a></div> <div id='12.example-1' class='example'>[&nbsp;<a class='example_link' href='#12.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>bool</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>char</span> array<span class='squarebracket'>[</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='literal'>0.2</span> <span class='operator'>-</span> <span class='literal'>0.1</span> <span class='operator'>-</span> <span class='literal'>0.1</span><span class='parenthesis'>)</span><span class='squarebracket'>]</span>;   <span class='comment'>// Must be evaluated during translation</span>
    <span class='keyword'>int</span> size <span class='operator'>=</span> <span class='literal'>1</span> <span class='operator'>+</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='literal'>1</span> <span class='operator'>+</span> <span class='literal'>0.2</span> <span class='operator'>-</span> <span class='literal'>0.1</span> <span class='operator'>-</span> <span class='literal'>0.1</span><span class='parenthesis'>)</span>;    <span class='comment'>// May be evaluated at runtime</span>
    <span class='keyword'>return</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>array<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> size;
<span class='curlybracket'>}</span>
</pre> <div id='12.sentence-2' class='sentence'>
It is unspecified whether the value of <span class='texttt'>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> will be <span class='texttt'><span class='literal'>true</span></span> or <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#12.sentence-2'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7283'>#</a></div><div id='13.sentence-1' class='sentence'>An expression or conversion is in an <a class='hidden_link' href='#def:immediate_function_context' id='def:immediate_function_context'><i >immediate function context</i></a>
if it is potentially evaluated and
its innermost non-block scope is
a function parameter scope of an immediate function<a class='hidden_link' href='#13.sentence-1'>.</a></div> <div id='13.sentence-2' class='sentence'>An expression or conversion is an <a class='hidden_link' href='#def:immediate_invocation' id='def:immediate_invocation'><i >immediate invocation</i></a>
if it is a potentially-evaluated explicit or implicit invocation of
an immediate function and
is not in an immediate function context<a class='hidden_link' href='#13.sentence-2'>.</a></div> <div id='13.sentence-3' class='sentence'>An immediate invocation shall be a constant expression<a class='hidden_link' href='#13.sentence-3'>.</a></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7294'>#</a></div><div id='14.sentence-2' class='sentence'>An expression or conversion is <a class='hidden_link' href='#def:manifestly_constant-evaluated' id='def:manifestly_constant-evaluated'><i >manifestly constant-evaluated</i></a>
if it is:
<ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.1'>(14.1)</a></div>a <a class='grammarterm' href='#nt:constant-expression'>constant-expression</a>, or</li><li id='14.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.2'>(14.2)</a></div>the condition of a constexpr if statement (<a href='stmt.if'>[stmt.if]</a>), or</li><li id='14.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.3'>(14.3)</a></div>an immediate invocation, or</li><li id='14.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.4'>(14.4)</a></div>the result of substitution into an atomic constraint expression
to determine whether it is satisfied (<a href='temp.constr.atomic'>[temp.constr.atomic]</a>), or</li><li id='14.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.5'>(14.5)</a></div>the initializer of a variable
that is usable in constant expressions or
has constant initialization.<a class='footnotenum' href='#footnote-80' id='footnoteref-80'>80</a> <div id='14.5.example-1' class='example'>[&nbsp;<a class='example_link' href='#14.5.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> X <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
X<span class='anglebracket'>&lt;</span>std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span> x;                      <span class='comment'>// type <span class='tcode_in_codeblock'>X&lt;true&gt;</span></span>
<span class='keyword'>int</span> y;
<span class='keyword'>const</span> <span class='keyword'>int</span> a <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> y <span class='operator'>:</span> <span class='literal'>1</span>;     <span class='comment'>// dynamic initialization to 1</span>
<span class='keyword'>double</span> z<span class='squarebracket'>[</span>a<span class='squarebracket'>]</span>;                                            <span class='comment'>// error: <span class='tcode_in_codeblock'>a</span> is not usable</span>
                                                        <span class='comment'>// in constant expressions</span>
<span class='keyword'>const</span> <span class='keyword'>int</span> b <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>2</span> <span class='operator'>:</span> y;     <span class='comment'>// static initialization to 2</span>
<span class='keyword'>int</span> c <span class='operator'>=</span> y <span class='operator'>+</span> <span class='parenthesis'>(</span>std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>2</span> <span class='operator'>:</span> y<span class='parenthesis'>)</span>;     <span class='comment'>// dynamic initialization to <span class='tcode_in_codeblock'>y+y</span></span>

<span class='keyword'>constexpr</span> <span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> n <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>13</span> <span class='operator'>:</span> <span class='literal'>17</span>; <span class='comment'>// <span class='tcode_in_codeblock'>n</span> is 13</span>
  <span class='keyword'>int</span> m <span class='operator'>=</span> std<span class='operator'>::</span>is_constant_evaluated<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>13</span> <span class='operator'>:</span> <span class='literal'>17</span>;       <span class='comment'>// <span class='tcode_in_codeblock'>m</span> might be 13 or 17 (see below)</span>
  <span class='keyword'>char</span> arr<span class='squarebracket'>[</span>n<span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='comment'>// char[13]</span>
  <span class='keyword'>return</span> m <span class='operator'>+</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>arr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>int</span> p <span class='operator'>=</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                                            <span class='comment'>// <span class='tcode_in_codeblock'>m</span> is 13; initialized to 26</span>
<span class='keyword'>int</span> q <span class='operator'>=</span> p <span class='operator'>+</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                                        <span class='comment'>// <span class='tcode_in_codeblock'>m</span> is 17 for this call; initialized to 56</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </li></ul>
<div id='14.note-1' class='note'>[&nbsp;<a class='note_link' href='#14.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> A manifestly constant-evaluated expression
is evaluated even in an unevaluated operand. —&nbsp;<i>end note</i></div>&nbsp;]</div> </div></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ea10e25b784539f159580b58078ebe40f3179b20/source/expressions.tex#L7334'>#</a></div><div id='15.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':expression,potentially_constant_evaluated'></a></span>An expression or conversion is <a class='hidden_link' href='#def:potentially_constant_evaluated' id='def:potentially_constant_evaluated'><i >potentially constant evaluated</i></a>
if it is:
<ul class='itemize'><li id='15.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.1'>(15.1)</a></div>a manifestly constant-evaluated expression,</li><li id='15.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.2'>(15.2)</a></div>a potentially-evaluated expression (<a href='basic.def.odr'>[basic.def.odr]</a>),</li><li id='15.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.3'>(15.3)</a></div>an immediate subexpression of a <a class='grammarterm' href='dcl.init#nt:braced-init-list'>braced-init-list</a>,<a class='footnotenum' href='#footnote-81' id='footnoteref-81'>81</a></li><li id='15.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.4'>(15.4)</a></div>an expression of the form <span class='texttt'><span class='operator'>&amp;</span></span> <a class='grammarterm' href='expr.cast#nt:cast-expression'>cast-expression</a>
that occurs within a templated entity,<a class='footnotenum' href='#footnote-82' id='footnoteref-82'>82</a>
or</li><li id='15.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.5'>(15.5)</a></div>a subexpression of one of the above
that is not a subexpression of a nested unevaluated operand<a class='hidden_link' href='#15.sentence-1'>.</a></li></ul></div><div id='15.sentence-2' class='sentence'><span class='indexparent'><a class='index' id=':function,needed_for_constant_evaluation'></a></span><span class='indexparent'><a class='index' id=':variable,needed_for_constant_evaluation'></a></span>A function or variable is
<a class='hidden_link' href='#def:needed_for_constant_evaluation' id='def:needed_for_constant_evaluation'><i >needed for constant evaluation</i></a>
if it is:
<ul class='itemize'><li id='15.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.6'>(15.6)</a></div>a constexpr function that is named by an expression (<a href='basic.def.odr'>[basic.def.odr]</a>)
that is potentially constant evaluated, or</li><li id='15.7'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#15.7'>(15.7)</a></div>a variable whose name appears as a potentially constant evaluated expression
that is either a constexpr variable or
is of non-volatile const-qualified integral type or of reference type<a class='hidden_link' href='#15.sentence-2'>.</a></li></ul></div></div><div class='footnote' id='footnote-79'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-79'>79)</a></div><div id='footnote-79.sentence-1' class='sentence'>Nonetheless, implementations should provide consistent results,
irrespective of whether the evaluation was performed during translation and/or during program
execution<a class='hidden_link' href='#footnote-79.sentence-1'>.</a></div> <a href='#footnoteref-79'>⮥</a></div><div class='footnote' id='footnote-80'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-80'>80)</a></div><div id='footnote-80.sentence-1' class='sentence'>Testing this condition
may involve a trial evaluation of its initializer as described above<a class='hidden_link' href='#footnote-80.sentence-1'>.</a></div> <a href='#footnoteref-80'>⮥</a></div><div class='footnote' id='footnote-81'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-81'>81)</a></div><div id='footnote-81.sentence-1' class='sentence'>Constant evaluation may be necessary to determine whether a narrowing conversion is performed (<a href='dcl.init.list'>[dcl.init.list]</a>)<a class='hidden_link' href='#footnote-81.sentence-1'>.</a></div> <a href='#footnoteref-81'>⮥</a></div><div class='footnote' id='footnote-82'><div class='footnoteNumberParent'><a class='marginalized' href='#footnote-82'>82)</a></div><div id='footnote-82.sentence-1' class='sentence'>Constant evaluation may be necessary to determine whether such an expression is value-dependent (<a href='temp.dep.constexpr'>[temp.dep.constexpr]</a>)<a class='hidden_link' href='#footnote-82.sentence-1'>.</a></div> <a href='#footnoteref-82'>⮥</a></div></div></body></html>