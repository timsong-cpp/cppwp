<!DOCTYPE html><html lang='en'><head><title>[futures.promise]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Concurrency support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>33.10</a> Futures <a class='abbr_ref' href='futures#promise'>[futures]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>33.10.6</a> Class template <span class='texttt'>promise</span> <a class='abbr_ref'>[futures.promise]</a></h3><div class='texpara'><span id='lib:promise'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise'>ðŸ”—</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> promise <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Allocator<span class='anglebracket'>&gt;</span>
      promise<span class='parenthesis'>(</span>allocator_arg_t, <span class='keyword'>const</span> Allocator<span class='operator'>&amp;</span> a<span class='parenthesis'>)</span>;
    promise<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    promise<span class='parenthesis'>(</span><span class='keyword'>const</span> promise<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// assignment</span>
    promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> promise<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='comment'>// retrieving the result</span>
    future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// setting the result</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> set_exception<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;

    <span class='comment'>// setting the result with deferred notification</span>
    <span class='keyword'>void</span> set_value_at_thread_exit<span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> set_exception_at_thread_exit<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span> Alloc<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> uses_allocator<span class='anglebracket'>&lt;</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span>, Alloc<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10259'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>For the primary template, <span class='texttt'>R</span> shall be an object type that
meets the <i >Cpp17Destructible</i> requirements<a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10263'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>The implementation provides the template <span class='texttt'>promise</span> and two specializations,
<span class='texttt'>promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>promise<span class='anglebracket'>&lt;</span>&#x200b;<span class='keyword'>void</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>These differ only in the argument type
of the member functions <span class='texttt'>set_<span class='shy'></span>value</span> and <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>,
as set out in their descriptions, below<a class='hidden_link' href='#2.sentence-2'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10269'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>The <span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>exception</span>, <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>,
and <span class='texttt'>set_<span class='shy'></span>exception_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span> member functions behave as though
they acquire a single mutex associated with the promise object while updating the
promise object<a class='hidden_link' href='#3.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:promise,uses_allocator'><div id='lib:uses_allocator,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:uses_allocator,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span> Alloc<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> uses_allocator<span class='anglebracket'>&lt;</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span>, Alloc<span class='anglebracket'>&gt;</span>
    <span class='operator'>:</span> true_type <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
</code></div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10283'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>Alloc</span> meets
the <i >Cpp17Allocator</i> requirements (<a href='allocator.requirements.general' title='16.4.4.6.1&emsp;General'>[allocator.<span class='shy'></span>requirements.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Allocator<span class='anglebracket'>&gt;</span>
  promise<span class='parenthesis'>(</span>allocator_arg_t, <span class='keyword'>const</span> Allocator<span class='operator'>&amp;</span> a<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10297'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'><i >Effects</i>: Creates a shared state<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>The second
constructor uses the allocator <span class='texttt'>a</span> to allocate memory for the shared
state<a class='hidden_link' href='#5.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,constructor_'>ðŸ”—</a></div><code class='itemdeclcode'>promise<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10310'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'><i >Effects</i>: Transfers ownership of the shared state
of <span class='texttt'>rhs</span> (if any) to the newly-constructed object<a class='hidden_link' href='#6.sentence-1'>.</a></div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10315'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10326'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'><i >Effects</i>: Abandons any shared state (<a href='futures.state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#8.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,operator='><div id='lib:operator=,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,promise'>ðŸ”—</a></div><code class='itemdeclcode'>promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10337'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'><i >Effects</i>: Abandons any shared state (<a href='futures.state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>) and then as if
<span class='texttt'>promise<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>swap<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#9.sentence-1'>.</a></div></div></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10342'>#</a></div><div class='texpara'><div id='10.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#10.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,swap'><div id='lib:swap,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10353'>#</a></div><div class='texpara'><div id='11.sentence-1' class='sentence'><i >Effects</i>: Exchanges the shared state of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and <span class='texttt'>other</span><a class='hidden_link' href='#11.sentence-1'>.</a></div></div></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10357'>#</a></div><div class='texpara'><div id='12.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has the shared state (if any) that <span class='texttt'>other</span> had
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#12.sentence-1'>.</a></div> <div id='12.sentence-2' class='sentence'><span class='texttt'>other</span> has the shared state (if any) that
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> had prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#12.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,get_future'><div id='lib:get_future,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_future,promise'>ðŸ”—</a></div><code class='itemdeclcode'>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10370'>#</a></div><div class='texpara'><div id='13.sentence-1' class='sentence'><i >Synchronization</i>: Calls to this function do not introduce
data races  (<a href='intro.multithread' title='6.9.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>) with calls to
<span class='texttt'>set_<span class='shy'></span>value</span>,
<span class='texttt'>set_<span class='shy'></span>exception</span>,
<span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>, or
<span class='texttt'>set_<span class='shy'></span>exception_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span><a class='hidden_link' href='#13.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='13.sentence-2' class='sentence'>Such calls need not synchronize with each other<a class='hidden_link' href='#13.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10382'>#</a></div><div class='texpara'><div id='14.sentence-1' class='sentence'><i >Returns</i>: A <span class='texttt'>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span></span> object with the same shared state as
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#14.sentence-1'>.</a></div></div></div></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10387'>#</a></div><div class='texpara'><div id='15.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state or if
<span class='texttt'>get_<span class='shy'></span>future</span> has already been called on a <span class='texttt'>promise</span> with the same
shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#15.sentence-1'>.</a></div></div></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10393'>#</a></div><div class='texpara'><div id='16.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#16.1'>(16.1)</a></div><div class='texpara'><div id='16.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>already_<span class='shy'></span>retrieved</span> if <span class='texttt'>get_<span class='shy'></span>future</span> has already been called on
a <span class='texttt'>promise</span> with the same shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#16.1.sentence-1'>.</a></div></div></li><li id='16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#16.2'>(16.2)</a></div><div class='texpara'><div id='16.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#16.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_value'><div id='lib:set_value,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_value,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> promise<span class='operator'>::</span>set_value<span class='parenthesis'>(</span><span class='keyword'>const</span> R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10412'>#</a></div><div class='texpara'><div id='17.sentence-1' class='sentence'><i >Effects</i>: Atomically stores the value <span class='texttt'>r</span> in the shared state and
makes that state ready (<a href='futures.state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#17.sentence-1'>.</a></div></div></div></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10417'>#</a></div><div class='texpara'><div id='18.sentence-1' class='sentence'><i >Throws</i>: <ul class='itemize'><li id='18.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#18.1'>(18.1)</a></div><span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception, or</li><li id='18.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#18.2'>(18.2)</a></div>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</li><li id='18.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#18.3'>(18.3)</a></div>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#18.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10426'>#</a></div><div class='texpara'><div id='19.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='19.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#19.1'>(19.1)</a></div><div class='texpara'><div id='19.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#19.1.sentence-1'>.</a></div></div></li><li id='19.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#19.2'>(19.2)</a></div><div class='texpara'><div id='19.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#19.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_exception'><div id='lib:set_exception,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_exception,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_exception<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10441'>#</a></div><div class='texpara'><div id='20.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>p</span> is not null<a class='hidden_link' href='#20.sentence-1'>.</a></div></div></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10445'>#</a></div><div class='texpara'><div id='21.sentence-1' class='sentence'><i >Effects</i>: Atomically stores the exception pointer <span class='texttt'>p</span> in the shared state
and makes that state ready (<a href='futures.state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#21.sentence-1'>.</a></div></div></div></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10450'>#</a></div><div class='texpara'><div id='22.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#22.sentence-1'>.</a></div></div></div></div><div class='para' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10455'>#</a></div><div class='texpara'><div id='23.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='23.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#23.1'>(23.1)</a></div><div class='texpara'><div id='23.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#23.1.sentence-1'>.</a></div></div></li><li id='23.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#23.2'>(23.2)</a></div><div class='texpara'><div id='23.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#23.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_value_at_thread_exit'><div id='lib:set_value_at_thread_exit,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_value_at_thread_exit,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> promise<span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span><span class='keyword'>const</span> R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10473'>#</a></div><div class='texpara'><div id='24.sentence-1' class='sentence'><i >Effects</i>: Stores the value <span class='texttt'>r</span> in the shared state without making that
state ready immediately<a class='hidden_link' href='#24.sentence-1'>.</a></div> <div id='24.sentence-2' class='sentence'>Schedules that state to be made ready when the current
thread exits, after all objects of thread storage duration associated with the
current thread have been destroyed<a class='hidden_link' href='#24.sentence-2'>.</a></div></div></div></div><div class='para' id='25'><div class='marginalizedparent'><a class='marginalized' href='#25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10480'>#</a></div><div class='texpara'><div id='25.sentence-1' class='sentence'><i >Throws</i>: <ul class='itemize'><li id='25.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#25.1'>(25.1)</a></div><span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception, or</li><li id='25.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#25.2'>(25.2)</a></div>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</li><li id='25.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#25.3'>(25.3)</a></div>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#25.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='26'><div class='marginalizedparent'><a class='marginalized' href='#26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10489'>#</a></div><div class='texpara'><div id='26.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='26.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#26.1'>(26.1)</a></div><div class='texpara'><div id='26.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#26.1.sentence-1'>.</a></div></div></li><li id='26.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#26.2'>(26.2)</a></div><div class='texpara'><div id='26.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#26.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_exception_at_thread_exit'><div id='lib:set_exception_at_thread_exit,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_exception_at_thread_exit,promise'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_exception_at_thread_exit<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='27'><div class='marginalizedparent'><a class='marginalized' href='#27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10504'>#</a></div><div class='texpara'><div id='27.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>p</span> is not null<a class='hidden_link' href='#27.sentence-1'>.</a></div></div></div></div><div class='para' id='28'><div class='marginalizedparent'><a class='marginalized' href='#28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10508'>#</a></div><div class='texpara'><div id='28.sentence-1' class='sentence'><i >Effects</i>: Stores the exception pointer <span class='texttt'>p</span> in the shared state without
making that state ready immediately<a class='hidden_link' href='#28.sentence-1'>.</a></div> <div id='28.sentence-2' class='sentence'>Schedules that state to be made ready when
the current thread exits, after all objects of thread storage duration
associated with the current thread have been destroyed<a class='hidden_link' href='#28.sentence-2'>.</a></div></div></div></div><div class='para' id='29'><div class='marginalizedparent'><a class='marginalized' href='#29'>29</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10515'>#</a></div><div class='texpara'><div id='29.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if an error condition occurs<a class='hidden_link' href='#29.sentence-1'>.</a></div></div></div></div><div class='para' id='30'><div class='marginalizedparent'><a class='marginalized' href='#30'>30</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10519'>#</a></div><div class='texpara'><div id='30.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='30.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#30.1'>(30.1)</a></div><div class='texpara'><div id='30.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#30.1.sentence-1'>.</a></div></div></li><li id='30.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#30.2'>(30.2)</a></div><div class='texpara'><div id='30.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#30.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,swap_'><div id='lib:swap,promise_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,promise_'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> x, promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> y<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='31'><div class='marginalizedparent'><a class='marginalized' href='#31'>31</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8410aac1b84ec161b6990441acde53185f958135/source/threads.tex#L10535'>#</a></div><div class='texpara'><div id='31.sentence-1' class='sentence'><i >Effects</i>: As if by <span class='texttt'>x<span class='operator'>.</span>swap<span class='parenthesis'>(</span>y<span class='parenthesis'>)</span></span><a class='hidden_link' href='#31.sentence-1'>.</a></div></div></div></div></div></body></html>