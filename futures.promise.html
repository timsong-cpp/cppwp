<!DOCTYPE html><html lang='en'><head><title>[futures.promise]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>30</a> Thread support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>30.6</a> Futures <a class='abbr_ref' href='futures#promise'>[futures]</a></h2><div id='futures.promise'><h3 ><a class='secnum' style='min-width:103pt'>30.6.6</a> Class template <span class='texttt'>promise</span> <a class='abbr_ref'>[futures.promise]</a></h3><p ><span class='indexparent'><a class='index' id='promise'></a></span></p><pre class='codeblock'>
namespace std {
  template &lt;class R&gt;
  class promise {
  public:
    promise();
    template &lt;class Allocator&gt;
      promise(allocator_arg_t, const Allocator&amp; a);
    promise(promise&amp;&amp; rhs) noexcept;
    promise(const promise&amp; rhs) = delete;
    ~promise();

    <span class='comment'>// assignment
</span>    promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
    promise&amp; operator=(const promise&amp; rhs) = delete;
    void swap(promise&amp; other) noexcept;

    <span class='comment'>// retrieving the result
</span>    future&lt;R&gt; get_future();

    <span class='comment'>// setting the result
</span>    void set_value(<i><span class='texttt'>see below</span></i>);
    void set_exception(exception_ptr p);

    <span class='comment'>// setting the result with deferred notification
</span>    void set_value_at_thread_exit(<i><span class='texttt'>see below</span></i>);
    void set_exception_at_thread_exit(exception_ptr p);
  };
  template &lt;class R&gt;
    void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;
  template &lt;class R, class Alloc&gt;
    struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;;
}
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >The implementation shall provide the template <span class='texttt'>promise</span> and two specializations,
<span class='texttt'>promise&lt;R&amp;&gt;</span> and <span class='texttt'>promise&lt;void&gt;</span>. These differ only in the argument type
of the member functions <span class='texttt'>set_value</span> and <span class='texttt'>set_value_at_thread_exit</span>,
as set out in their descriptions, below.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >The <span class='texttt'>set_value</span>, <span class='texttt'>set_exception</span>, <span class='texttt'>set_value_at_thread_exit</span>,
and <span class='texttt'>set_exception_at_thread_exit</span> member functions behave as though
they acquire a single mutex associated with the promise object while updating the
promise object.</p><p ><span class='indexparent'><a class='index' id='uses_allocator,promise'></a></span><code class='itemdecl'>
template &lt;class R, class Alloc&gt;
  struct uses_allocator&lt;promise&lt;R&gt;, Alloc&gt;
    : true_type { };
</code></p></div><div class='itemdescr'></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><p ><i>Requires:</i> <span class='texttt'>Alloc</span> shall be an Allocator (<a href='allocator.requirements'>[allocator.requirements]</a>).
</p></div></div><p ><span class='indexparent'><a class='index' id='promise,constructor'></a></span><code class='itemdecl'>
promise();
template &lt;class Allocator&gt;
  promise(allocator_arg_t, const Allocator&amp; a);
</code></p><div class='itemdescr'></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><p ><i>Effects:</i> constructs a <span class='texttt'>promise</span> object and a shared state. The second
constructor uses the allocator <span class='texttt'>a</span> to allocate memory for the shared
state.
</p></div></div><p ><span class='indexparent'><a class='index' id='promise,constructor'></a></span><code class='itemdecl'>
promise(promise&amp;&amp; rhs) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><p ><i>Effects:</i> constructs a new <span class='texttt'>promise</span> object and transfers ownership of the shared state
of <span class='texttt'>rhs</span> (if any) to the newly-constructed object.</p></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><p ><i>Postconditions:</i> <span class='texttt'>rhs</span> has no shared state.
</p></div></div><p ><span class='indexparent'><a class='index' id='promise,destructor'></a></span><code class='itemdecl'>
~promise();
</code></p><div class='itemdescr'></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><p ><i>Effects:</i>
Abandons any shared state (<a href='futures.state'>[futures.state]</a>).
</p></div></div><p ><span class='indexparent'><a class='index' id='operator=,promise'></a></span><span class='indexparent'><a class='index' id='promise,operator='></a></span><code class='itemdecl'>
promise&amp; operator=(promise&amp;&amp; rhs) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><p ><i>Effects:</i>
Abandons any shared state (<a href='futures.state'>[futures.state]</a>) and then as if
<span class='texttt'>promise(std::move(rhs)).swap(*this)</span>.</p></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><p ><i>Returns:</i> <span class='texttt'>*this</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='swap,promise'></a></span><span class='indexparent'><a class='index' id='promise,swap'></a></span><code class='itemdecl'>
void swap(promise&amp; other) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><p ><i>Effects:</i> Exchanges the shared state of <span class='texttt'>*this</span> and <span class='texttt'>other</span>.</p></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><p ><i>Postconditions:</i> <span class='texttt'>*this</span> has the shared state (if any) that <span class='texttt'>other</span> had
prior to the call to <span class='texttt'>swap</span>. <span class='texttt'>other</span> has the shared state (if any) that
<span class='texttt'>*this</span> had prior to the call to <span class='texttt'>swap</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='get_future,promise'></a></span><span class='indexparent'><a class='index' id='promise,get_future'></a></span><code class='itemdecl'>
future&lt;R&gt; get_future();
</code></p><div class='itemdescr'></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><p ><i>Returns:</i> A <span class='texttt'>future&lt;R&gt;</span> object with the same shared state as
<span class='texttt'>*this</span>.</p></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><p ><i>Throws:</i> <span class='texttt'>future_error</span> if <span class='texttt'>*this</span> has no shared state or if
<span class='texttt'>get_future</span> has already been called on a <span class='texttt'>promise</span> with the same
shared state as <span class='texttt'>*this</span>.</p></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><p ><i>Error conditions:</i></p><ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.1'>(14.1)</a></div><p ><span class='texttt'>future_already_retrieved</span> if <span class='texttt'>get_future</span> has already been called on
a <span class='texttt'>promise</span> with the same shared state as <span class='texttt'>*this</span>.</p></li><li id='14.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.2'>(14.2)</a></div><p ><span class='texttt'>no_state</span> if <span class='texttt'>*this</span> has no shared state.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='set_value,promise'></a></span><span class='indexparent'><a class='index' id='promise,set_value'></a></span><code class='itemdecl'>
void promise::set_value(const R&amp; r);
void promise::set_value(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value(R&amp; r);
void promise&lt;void&gt;::set_value();
</code></p><div class='itemdescr'></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='itemdescr'><p ><i>Effects:</i> Atomically stores the value <span class='texttt'>r</span> in the shared state and
makes that state ready (<a href='futures.state'>[futures.state]</a>).</p></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='itemdescr'><p ><i>Throws:</i></p><ul class='itemize'><li id='16.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#16.1'>(16.1)</a></div><p ><span class='texttt'>future_error</span> if its shared state
already has a stored value or exception, or
</p></li><li id='16.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#16.2'>(16.2)</a></div><p >for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or
</p></li><li id='16.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#16.3'>(16.3)</a></div><p >for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span>.
</p></li></ul></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='itemdescr'><p ><i>Error conditions:</i>
</p><ul class='itemize'><li id='17.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#17.1'>(17.1)</a></div><p ><span class='texttt'>promise_already_satisfied</span> if its shared state
already has a stored value or exception.
</p></li><li id='17.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#17.2'>(17.2)</a></div><p ><span class='texttt'>no_state</span> if <span class='texttt'>*this</span> has no shared state.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='set_exception,promise'></a></span><span class='indexparent'><a class='index' id='promise,set_exception'></a></span><code class='itemdecl'>
void set_exception(exception_ptr p);
</code></p><div class='itemdescr'></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='itemdescr'><p ><i>Requires:</i> <span class='texttt'>p</span> is not null.</p></div></div><div class='para' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='itemdescr'><p ><i>Effects:</i> Atomically stores the exception pointer <span class='texttt'>p</span> in the shared state
and makes that state ready (<a href='futures.state'>[futures.state]</a>).</p></div></div><div class='para' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='itemdescr'><p ><i>Throws:</i> <span class='texttt'>future_error</span> if its shared state
already has a stored value or exception.</p></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='itemdescr'><p ><i>Error conditions:</i></p><ul class='itemize'><li id='21.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#21.1'>(21.1)</a></div><p ><span class='texttt'>promise_already_satisfied</span> if its shared state
already has a stored value or exception.
</p></li><li id='21.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#21.2'>(21.2)</a></div><p ><span class='texttt'>no_state</span> if <span class='texttt'>*this</span> has no shared state.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='set_value_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='promise,set_value_at_thread_exit'></a></span><code class='itemdecl'>
void promise::set_value_at_thread_exit(const R&amp; r);
void promise::set_value_at_thread_exit(R&amp;&amp; r);
void promise&lt;R&amp;&gt;::set_value_at_thread_exit(R&amp; r);
void promise&lt;void&gt;::set_value_at_thread_exit();
</code></p><div class='itemdescr'></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='itemdescr'><p ><i>Effects:</i> Stores the value <span class='texttt'>r</span> in the shared state without making that
state ready immediately. Schedules that state to be made ready when the current
thread exits, after all objects of thread storage duration associated with the
current thread have been destroyed.</p></div></div><div class='para' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='itemdescr'><p ><i>Throws:</i></p><ul class='itemize'><li id='23.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#23.1'>(23.1)</a></div><p ><span class='texttt'>future_error</span> if its shared state
already has a stored value or exception, or
</p></li><li id='23.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#23.2'>(23.2)</a></div><p >for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or
</p></li><li id='23.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#23.3'>(23.3)</a></div><p >for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span>.
</p></li></ul></div></div><div class='para' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='itemdescr'><p ><i>Error conditions:</i>
</p><ul class='itemize'><li id='24.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#24.1'>(24.1)</a></div><p ><span class='texttt'>promise_already_satisfied</span> if its shared state
already has a stored value or exception.
</p></li><li id='24.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#24.2'>(24.2)</a></div><p ><span class='texttt'>no_state</span> if <span class='texttt'>*this</span> has no shared state.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='set_exception_at_thread_exit,promise'></a></span><span class='indexparent'><a class='index' id='promise,set_exception_at_thread_exit'></a></span><code class='itemdecl'>
void set_exception_at_thread_exit(exception_ptr p);
</code></p><div class='itemdescr'></div><div class='para' id='25'><div class='marginalizedparent'><a class='marginalized' href='#25'>25</a></div><div class='itemdescr'><p ><i>Requires:</i> <span class='texttt'>p</span> is not null.</p></div></div><div class='para' id='26'><div class='marginalizedparent'><a class='marginalized' href='#26'>26</a></div><div class='itemdescr'><p ><i>Effects:</i> Stores the exception pointer <span class='texttt'>p</span> in the shared state without
making that state ready immediately. Schedules that state to be made ready when
the current thread exits, after all objects of thread storage duration
associated with the current thread have been destroyed.</p></div></div><div class='para' id='27'><div class='marginalizedparent'><a class='marginalized' href='#27'>27</a></div><div class='itemdescr'><p ><i>Throws:</i> <span class='texttt'>future_error</span> if an error condition occurs.</p></div></div><div class='para' id='28'><div class='marginalizedparent'><a class='marginalized' href='#28'>28</a></div><div class='itemdescr'><p ><i>Error conditions:</i>
</p><ul class='itemize'><li id='28.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#28.1'>(28.1)</a></div><p ><span class='texttt'>promise_already_satisfied</span> if its shared state
already has a stored value or exception.
</p></li><li id='28.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#28.2'>(28.2)</a></div><p ><span class='texttt'>no_state</span> if <span class='texttt'>*this</span> has no shared state.
</p></li></ul></div></div><p ><span class='indexparent'><a class='index' id='swap,promise'></a></span><span class='indexparent'><a class='index' id='promise,swap'></a></span><code class='itemdecl'>
template &lt;class R&gt;
  void swap(promise&lt;R&gt;&amp; x, promise&lt;R&gt;&amp; y) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='29'><div class='marginalizedparent'><a class='marginalized' href='#29'>29</a></div><div class='itemdescr'><p ><i>Effects:</i> As if by <span class='texttt'>x.swap(y)</span>.
</p></div></div></div></div></body></html>