<!DOCTYPE html><html lang='en'><head><title>[class.virtual]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>11</a> Classes <a class='abbr_ref' href='./#class'>[class]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>11.7</a> Derived classes <a class='abbr_ref' href='class.derived#class.virtual'>[class.derived]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>11.7.3</a> Virtual functions <a class='abbr_ref'>[class.virtual]</a></h3><div class='texpara'><a class='index' id=':function,virtual'></a><a class='index' id=':type,polymorphic'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3669'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>A non-static member function is a <a class='hidden_link' href='#def:function,virtual' title='11.7.3&emsp;Virtual functions&emsp;[class.virtual]'><span id='def:function,virtual'><i >virtual function</i></span></a>
if it is first declared with the keyword <span id=':virtual_'><span class='texttt'><span class='keyword'>virtual</span></span></span> or
if it overrides a virtual member function declared in a base class
(see below)<a class='hidden_link' href='#1.sentence-1'>.</a><a class='footnoteref' href='#footnote-93' id='footnoteref-93' title='The use of the virtual specifier in the declaration of an overriding function is valid but redundant (has empty semantics).'>93</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='1.sentence-2' class='sentence'>Virtual functions support dynamic binding and object-oriented
programming<a class='hidden_link' href='#1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='1.sentence-3' class='sentence'>
A class with a virtual member function is called a <a class='hidden_link' href='#def:class,polymorphic' title='11.7.3&emsp;Virtual functions&emsp;[class.virtual]'><span id='def:class,polymorphic'><i >polymorphic class</i></span></a><a class='hidden_link' href='#1.sentence-3'>.</a><a class='footnoteref' href='#footnote-94' id='footnoteref-94' title='If all virtual functions are immediate functions, the class is still polymorphic even if its internal representation does not otherwise require any additions for that polymorphic behavior.'>94</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3692'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>If a virtual member function <span class='math'><span class='mathalpha'>F</span></span> is declared in a class <span class='math'><span class='mathalpha'>B</span></span>, and,
in a class <span class='math'><span class='mathalpha'>D</span></span> derived (directly or indirectly) from <span class='math'><span class='mathalpha'>B</span></span>,
a declaration of a member function <span class='math'><span class='mathalpha'>G</span></span>
corresponds (<a href='basic.scope.scope' title='6.4.1&emsp;General'>[basic.<span class='shy'></span>scope.<span class='shy'></span>scope]</a>) to a declaration of <span class='math'><span class='mathalpha'>F</span></span>,
ignoring trailing <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a><i >s</i>,
then <span class='math'><span class='mathalpha'>G</span></span> <a class='hidden_link' href='#def:function,virtual,override' title='11.7.3&emsp;Virtual functions&emsp;[class.virtual]'><span id='def:function,virtual,override'><i >overrides</i></span></a><a class='footnoteref' href='#footnote-95' id='footnoteref-95' title='A function with the same name but a different parameter list ([over]) as a virtual function is not necessarily virtual and does not override. Access control ([class.access]) is not considered in determining overriding.'>95</a>
<span class='math'><span class='mathalpha'>F</span></span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>For convenience, we say that any virtual function overrides itself<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'><a class='index' id=':overrider,final'></a>A virtual member function <span class='math'><span class='mathalpha'>V</span></span> of a class object <span class='math'><span class='mathalpha'>S</span></span> is a <a class='hidden_link' href='#def:final_overrider' title='11.7.3&emsp;Virtual functions&emsp;[class.virtual]'><span id='def:final_overrider'><i >final
overrider</i></span></a> unless the most derived class (<a href='intro.object' title='6.7.2&emsp;Object model'>[intro.<span class='shy'></span>object]</a>) of which <span class='math'><span class='mathalpha'>S</span></span> is a
base class subobject (if any) has another member function that overrides <span class='math'><span class='mathalpha'>V</span></span><a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>In a derived class, if a virtual member function of a base class subobject
has more than one final overrider, the program is ill-formed<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> B <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> C <span class='operator'>:</span> B , <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> A<span class='operator'>::</span>f;
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> foo<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  C c;
  c<span class='operator'>.</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;            <span class='comment'>// calls <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;f</span>, the final overrider</span>
  c<span class='operator'>.</span>C<span class='operator'>::</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;         <span class='comment'>// calls <span class='tcode_in_codeblock'>A&#x200b;::&#x200b;f</span> because of the using-declaration</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div><div class='texpara'><div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span> <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> B <span class='operator'>:</span> A <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> C <span class='operator'>:</span> A <span class='curlybracket'>{</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> D <span class='operator'>:</span> B, C <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;            <span class='comment'>// OK, <span class='tcode_in_codeblock'>A&#x200b;::&#x200b;f</span> and <span class='tcode_in_codeblock'>C&#x200b;::&#x200b;f</span> are the final overriders</span>
                                <span class='comment'>// for the <span class='tcode_in_codeblock'>B</span> and <span class='tcode_in_codeblock'>C</span> subobjects, respectively</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3745'>#</a></div><div class='texpara'><div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>:&ensp;<div id='3.sentence-1' class='sentence'>A virtual member function does not have to be visible to be overridden,
for example,
<span class='codeblock'><span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> D <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> D2 <span class='operator'>:</span> D <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span>
the function <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span></span> in class <span class='texttt'>D</span> hides the virtual
function <span class='texttt'>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> in its base class <span class='texttt'>B</span>; <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span></span> is
not a virtual function<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>However, <span class='texttt'>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> declared in class
<span class='texttt'>D2</span> has the same name and the same parameter list as
<span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and therefore is a virtual function that overrides the
function <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> even though <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is not visible in
class <span class='texttt'>D2</span><a class='hidden_link' href='#3.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3769'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>If a virtual function <span class='texttt'>f</span> in some class <span class='texttt'>B</span> is marked with the
<a href='class.mem.general#nt:virt-specifier' title='11.4.1&emsp;General&emsp;[class.mem.general]'><span id='ntref:virt-specifier'><span class='textsf'><i >virt-specifier</i></span></span></a> <span id=':final'><span class='texttt'><span class='keyword'>final</span></span></span> and in a class <span class='texttt'>D</span> derived from <span class='texttt'>B</span>
a function <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span> overrides <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span>, the program is ill-formed<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>final</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;   <span class='comment'>// error: <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;f</span> attempts to override <span class='tcode_in_codeblock'>final</span> <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;f</span></span>
<span class='curlybracket'>}</span>;
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3785'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>If a virtual function is marked with the <a href='class.mem.general#nt:virt-specifier' title='11.4.1&emsp;General&emsp;[class.mem.general]'><span id='ntref:virt-specifier_'><span class='textsf'><i >virt-specifier</i></span></span></a> <span id=':override'><span class='texttt'><span class='keyword'>override</span></span></span> and
does not override a member function of a base class, the program is ill-formed<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='example-4' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-4'>4</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>long</span><span class='parenthesis'>)</span> <span class='keyword'>override</span>;        <span class='comment'>// error: wrong signature overriding <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;f</span></span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='keyword'>override</span>;         <span class='comment'>// OK</span>
<span class='curlybracket'>}</span>;
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3801'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>A virtual function shall not have a trailing <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> (<a href='dcl.decl' title='9.3&emsp;Declarators'>[dcl.<span class='shy'></span>decl]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='example-5' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-5'>5</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>requires</span> <span class='literal'>true</span>;       <span class='comment'>// error: virtual function cannot be constrained (<a href='temp.constr.decl' title='13.5.3&emsp;Constrained declarations'>[temp.<span class='shy'></span>constr.<span class='shy'></span>decl]</a>)</span>
<span class='curlybracket'>}</span>;
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3812'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'>The <a href='dcl.decl.general#nt:ref-qualifier' title='9.3.1&emsp;General&emsp;[dcl.decl.general]'><span id='ntref:ref-qualifier'><span class='textsf'><i >ref-qualifier</i></span></span></a>, or lack thereof, of an overriding function
shall be the same as that of the overridden function<a class='hidden_link' href='#7.sentence-1'>.</a></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3816'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'>The return type of an overriding function shall be either identical to
the return type of the overridden function or <a class='hidden_link' href='#def:return_type,covariant' title='11.7.3&emsp;Virtual functions&emsp;[class.virtual]'><span id='def:return_type,covariant'><i >covariant</i></span></a> with
the classes of the functions<a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='8.sentence-2' class='sentence'>If a function <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span> overrides a
function <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span>, the return types of the functions are covariant
if they satisfy the following criteria:
<ul class='itemize'><li id='8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#8.1'>(8.1)</a></div>both are pointers to classes, both are lvalue references to
classes, or both are rvalue references to classes<a class='footnoteref' href='#footnote-96' id='footnoteref-96' title='Multi-level pointers to classes or references to multi-level pointers to classes are not allowed.'>96</a></li><li id='8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#8.2'>(8.2)</a></div>the class in the return type of <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span> is the same class as
the class in the return type of <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span>, or is an unambiguous and
accessible direct or indirect base class of the class in the return type
of <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span></li><li id='8.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#8.3'>(8.3)</a></div>both pointers or references have the same cv-qualification and the
class type in the return type of <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span> has the same
cv-qualification as or less cv-qualification than the class type in the
return type of <span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span><a class='hidden_link' href='#8.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3841'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'>If the class type in the covariant return type of <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span> differs from that of
<span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span>, the class type in the return type of <span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span> shall be
complete at the locus (<a href='basic.scope.pdecl' title='6.4.2&emsp;Point of declaration'>[basic.<span class='shy'></span>scope.<span class='shy'></span>pdecl]</a>) of the overriding declaration or shall be the
class type <span class='texttt'>D</span><a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='9.sentence-2' class='sentence'>When the overriding function is called as the
final overrider of the overridden function, its result is converted to
the type returned by the (statically chosen) overridden
function (<a href='expr.call' title='7.6.1.3&emsp;Function call'>[expr.<span class='shy'></span>call]</a>)<a class='hidden_link' href='#9.sentence-2'>.</a></div> <div id='example-6' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-6'>6</a></i>:&ensp;<span class='codeblock'><span class='keyword'>class</span> B <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>class</span> D <span class='operator'>:</span> <span class='keyword'>private</span> B <span class='curlybracket'>{</span> <span class='keyword'>friend</span> <span class='keyword'>class</span> Derived; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> Base <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> vf1<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> vf2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> vf3<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> B<span class='operator'>*</span>   vf4<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> B<span class='operator'>*</span>   vf5<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> No_good <span class='operator'>:</span> <span class='keyword'>public</span> Base <span class='curlybracket'>{</span>
  D<span class='operator'>*</span>  vf4<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;        <span class='comment'>// error: <span class='tcode_in_codeblock'>B</span> (base class of <span class='tcode_in_codeblock'>D</span>) inaccessible</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>class</span> A;
<span class='keyword'>struct</span> Derived <span class='operator'>:</span> <span class='keyword'>public</span> Base <span class='curlybracket'>{</span>
    <span class='keyword'>void</span> vf1<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;     <span class='comment'>// virtual and overrides <span class='tcode_in_codeblock'>Base&#x200b;::&#x200b;vf1()</span></span>
    <span class='keyword'>void</span> vf2<span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span>;  <span class='comment'>// not virtual, hides <span class='tcode_in_codeblock'>Base&#x200b;::&#x200b;vf2()</span></span>
    <span class='keyword'>char</span> vf3<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;     <span class='comment'>// error: invalid difference in return type only</span>
    D<span class='operator'>*</span>   vf4<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;     <span class='comment'>// OK, returns pointer to derived class</span>
    A<span class='operator'>*</span>   vf5<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;     <span class='comment'>// error: returns pointer to incomplete class</span>
    <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  Derived d;
  Base<span class='operator'>*</span> bp <span class='operator'>=</span> <span class='operator'>&amp;</span>d;                <span class='comment'>// standard conversion:</span>
                                <span class='comment'>// <span class='tcode_in_codeblock'>Derived*</span> to <span class='tcode_in_codeblock'>Base*</span></span>
  bp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>vf1<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                    <span class='comment'>// calls <span class='tcode_in_codeblock'>Derived&#x200b;::&#x200b;vf1()</span></span>
  bp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>vf2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                    <span class='comment'>// calls <span class='tcode_in_codeblock'>Base&#x200b;::&#x200b;vf2()</span></span>
  bp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                      <span class='comment'>// calls <span class='tcode_in_codeblock'>Base&#x200b;::&#x200b;f()</span> (not virtual)</span>
  B<span class='operator'>*</span>  p <span class='operator'>=</span> bp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>vf4<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;            <span class='comment'>// calls <span class='tcode_in_codeblock'>Derived&#x200b;::&#x200b;vf4()</span> and converts the</span>
                                <span class='comment'>// result to <span class='tcode_in_codeblock'>B*</span></span>
  Derived<span class='operator'>*</span>  dp <span class='operator'>=</span> <span class='operator'>&amp;</span>d;
  D<span class='operator'>*</span>  q <span class='operator'>=</span> dp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>vf4<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;            <span class='comment'>// calls <span class='tcode_in_codeblock'>Derived&#x200b;::&#x200b;vf4()</span> and does not</span>
                                <span class='comment'>// convert the result to <span class='tcode_in_codeblock'>B*</span></span>
  dp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>vf2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                    <span class='comment'>// error: argument mismatch</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3893'>#</a></div><div class='texpara'><div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>:&ensp;<div id='10.sentence-1' class='sentence'>The interpretation of the call of a virtual function depends on the type
of the object for which it is called (the dynamic type), whereas the
interpretation of a call of a non-virtual member function depends only
on the type of the pointer or reference denoting that object (the static
type) (<a href='expr.call' title='7.6.1.3&emsp;Function call'>[expr.<span class='shy'></span>call]</a>)<a class='hidden_link' href='#10.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3902'>#</a></div><div class='texpara'><div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>:&ensp;<div id='11.sentence-1' class='sentence'>The <span id=':virtual__'><span class='texttt'><span class='keyword'>virtual</span></span></span> specifier implies membership, so a virtual function
cannot be a non-member (<a href='dcl.fct.spec' title='9.2.3&emsp;Function specifiers'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>spec]</a>) function<a class='hidden_link' href='#11.sentence-1'>.</a></div> <div id='11.sentence-2' class='sentence'>Nor can a virtual
function be a static member, since a virtual function call relies on a
specific object for determining which function to invoke<a class='hidden_link' href='#11.sentence-2'>.</a></div> <div id='11.sentence-3' class='sentence'>A virtual
function declared in one class can be declared a friend (<a href='class.friend' title='11.8.4&emsp;Friends'>[class.<span class='shy'></span>friend]</a>) in
another class<a class='hidden_link' href='#11.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3912'>#</a></div><div class='texpara'><div id='12.sentence-1' class='sentence'><a class='index' id=':definition,virtual_function'></a>A virtual function declared in a class shall be defined, or declared
pure (<a href='class.abstract' title='11.7.4&emsp;Abstract classes'>[class.<span class='shy'></span>abstract]</a>) in that class, or both; no diagnostic is
required (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)<a class='hidden_link' href='#12.sentence-1'>.</a></div> <a class='index' id=':friend,virtual_and'></a></div></div><div class='para nonNormativeOnly' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3919'>#</a></div><div class='texpara'><a class='index' id=':multiple_inheritance,virtual_and'></a><div id='example-7' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-7'>7</a></i>:&ensp;<div id='13.sentence-1' class='sentence'>Here are some uses of virtual functions with multiple base classes:
<span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> B1 <span class='operator'>:</span> A <span class='curlybracket'>{</span>                 <span class='comment'>// note non-virtual derivation</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> B2 <span class='operator'>:</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> B1, B2 <span class='curlybracket'>{</span>             <span class='comment'>// <span class='tcode_in_codeblock'>D</span> has two separate <span class='tcode_in_codeblock'>A</span> subobjects</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> foo<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  D   d;
<span class='comment'>//<span class='tcode_in_codeblock'>   A*  ap = &amp;d;</span>                  // would be ill-formed: ambiguous</span>
  B1<span class='operator'>*</span>  b1p <span class='operator'>=</span> <span class='operator'>&amp;</span>d;
  A<span class='operator'>*</span>   ap <span class='operator'>=</span> b1p;
  D<span class='operator'>*</span>   dp <span class='operator'>=</span> <span class='operator'>&amp;</span>d;
  ap<span class='operator'>-</span><span class='anglebracket'>&gt;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                      <span class='comment'>// calls <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;B1&#x200b;::&#x200b;f</span></span>
  dp<span class='operator'>-</span><span class='anglebracket'>&gt;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                      <span class='comment'>// error: ambiguous</span>
<span class='curlybracket'>}</span>
</span></div> <div id='13.sentence-2' class='sentence'>
In class <span class='texttt'>D</span> above there are two occurrences of class <span class='texttt'>A</span>
and hence two occurrences of the virtual member function <span class='texttt'>A<span class='operator'>&#x200b;::&#x200b;</span>f</span><a class='hidden_link' href='#13.sentence-2'>.</a></div> <div id='13.sentence-3' class='sentence'>The final overrider of <span class='texttt'>B1<span class='operator'>&#x200b;::&#x200b;</span>A<span class='operator'>&#x200b;::&#x200b;</span>f</span> is <span class='texttt'>B1<span class='operator'>&#x200b;::&#x200b;</span>f</span> and the final
overrider of <span class='texttt'>B2<span class='operator'>&#x200b;::&#x200b;</span>A<span class='operator'>&#x200b;::&#x200b;</span>f</span> is <span class='texttt'>B2<span class='operator'>&#x200b;::&#x200b;</span>f</span><a class='hidden_link' href='#13.sentence-3'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3955'>#</a></div><div class='texpara'><div id='example-8' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-8'>8</a></i>:&ensp;<div id='14.sentence-1' class='sentence'>The following example shows a function that does not have a unique final
overrider:
<span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> VB1 <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span>        <span class='comment'>// note virtual derivation</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> VB2 <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> Error <span class='operator'>:</span> VB1, VB2 <span class='curlybracket'>{</span>       <span class='comment'>// error</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> Okay <span class='operator'>:</span> VB1, VB2 <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div> <div id='14.sentence-2' class='sentence'>
Both <span class='texttt'>VB1<span class='operator'>&#x200b;::&#x200b;</span>f</span> and <span class='texttt'>VB2<span class='operator'>&#x200b;::&#x200b;</span>f</span> override <span class='texttt'>A<span class='operator'>&#x200b;::&#x200b;</span>f</span> but there
is no overrider of both of them in class <span class='texttt'>Error</span><a class='hidden_link' href='#14.sentence-2'>.</a></div> <div id='14.sentence-3' class='sentence'>This example is
therefore ill-formed<a class='hidden_link' href='#14.sentence-3'>.</a></div> <div id='14.sentence-4' class='sentence'>Class <span class='texttt'>Okay</span> is well-formed, however,
because <span class='texttt'>Okay<span class='operator'>&#x200b;::&#x200b;</span>f</span> is a final overrider<a class='hidden_link' href='#14.sentence-4'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L3985'>#</a></div><div class='texpara'><div id='example-9' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-9'>9</a></i>:&ensp;<div id='15.sentence-1' class='sentence'>The following example uses the well-formed classes from above<a class='hidden_link' href='#15.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>struct</span> VB1a <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span>       <span class='comment'>// does not declare <span class='tcode_in_codeblock'>f</span></span>
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> Da <span class='operator'>:</span> VB1a, VB2 <span class='curlybracket'>{</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> foe<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  VB1a<span class='operator'>*</span>  vb1ap <span class='operator'>=</span> <span class='keyword'>new</span> Da;
  vb1ap<span class='operator'>-</span><span class='anglebracket'>&gt;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                   <span class='comment'>// calls <span class='tcode_in_codeblock'>VB2&#x200b;::&#x200b;f</span></span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L4002'>#</a></div><div class='texpara'><div id='16.sentence-1' class='sentence'><a class='index' id=':operator,scope_resolution'></a><a class='index' id=':virtual_function_call'></a>Explicit qualification with the scope operator (<a href='expr.prim.id.qual' title='7.5.5.3&emsp;Qualified names'>[expr.<span class='shy'></span>prim.<span class='shy'></span>id.<span class='shy'></span>qual]</a>)
suppresses the virtual call mechanism<a class='hidden_link' href='#16.sentence-1'>.</a></div> <div id='example-10' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-10'>10</a></i>:&ensp;<span class='codeblock'><span class='keyword'>class</span> B <span class='curlybracket'>{</span> <span class='keyword'>public</span><span class='operator'>:</span> <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>class</span> D <span class='operator'>:</span> <span class='keyword'>public</span> B <span class='curlybracket'>{</span> <span class='keyword'>public</span><span class='operator'>:</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<span class='keyword'>void</span> D<span class='operator'>::</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='comment'>/* ... */</span> B<span class='operator'>::</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
</span></div><div class='texpara'><div id='16.sentence-2' class='sentence'>Here, the function call in
<span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span>
really does call
<span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span>f</span>
and not
<span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span>f</span><a class='hidden_link' href='#16.sentence-2'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L4023'>#</a></div><div class='texpara'><div id='17.sentence-1' class='sentence'>A deleted function (<a href='dcl.fct.def' title='9.5&emsp;Function definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def]</a>) shall
not override a function that is not deleted<a class='hidden_link' href='#17.sentence-1'>.</a></div> <div id='17.sentence-2' class='sentence'>Likewise,
a function that is not deleted shall not override a
deleted function<a class='hidden_link' href='#17.sentence-2'>.</a></div> </div></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/classes.tex#L4030'>#</a></div><div class='texpara'><div id='18.sentence-1' class='sentence'>A <span id=':consteval'><span class='texttt'><span class='keyword'>consteval</span></span></span> virtual function shall not override
a virtual function that is not <span id=':consteval_'><span class='texttt'><span class='keyword'>consteval</span></span></span><a class='hidden_link' href='#18.sentence-1'>.</a></div> <div id='18.sentence-2' class='sentence'>A <span id=':consteval__'><span class='texttt'><span class='keyword'>consteval</span></span></span> virtual function shall not be overridden by
a virtual function that is not <span id=':consteval___'><span class='texttt'><span class='keyword'>consteval</span></span></span><a class='hidden_link' href='#18.sentence-2'>.</a></div></div></div><div class='footnoteSeparator'></div><div class='footnote' id='footnote-93'><div class='texpara'><a class='footnotenum' href='#footnote-93'>93)</a><a class='footnoteBacklink' href='#footnoteref-93'>93)</a> <div id='footnote-93.sentence-1' class='sentence'>The use of the <span id=':virtual'><span class='texttt'><span class='keyword'>virtual</span></span></span> specifier in the
declaration of an overriding function is valid but redundant (has empty
semantics)<a class='hidden_link' href='#footnote-93.sentence-1'>.</a></div></div></div><div class='footnote' id='footnote-94'><div class='texpara'><a class='footnotenum' href='#footnote-94'>94)</a><a class='footnoteBacklink' href='#footnoteref-94'>94)</a> <div id='footnote-94.sentence-1' class='sentence'>If
all virtual functions are immediate functions,
the class is still polymorphic even if
its internal representation does not otherwise require
any additions for that polymorphic behavior<a class='hidden_link' href='#footnote-94.sentence-1'>.</a></div></div></div><div class='footnote' id='footnote-95'><div class='texpara'><a class='footnotenum' href='#footnote-95'>95)</a><a class='footnoteBacklink' href='#footnoteref-95'>95)</a> <div id='footnote-95.sentence-1' class='sentence'>A function
with the same name but a different parameter list (<a href='over' title='12&emsp;Overloading'>[over]</a>)
as a virtual function is not necessarily virtual and
does not override<a class='hidden_link' href='#footnote-95.sentence-1'>.</a></div> <div id='footnote-95.sentence-2' class='sentence'>Access control (<a href='class.access' title='11.8&emsp;Member access control'>[class.<span class='shy'></span>access]</a>) is not considered in
determining overriding<a class='hidden_link' href='#footnote-95.sentence-2'>.</a></div></div></div><div class='footnote' id='footnote-96'><div class='texpara'><a class='footnotenum' href='#footnote-96'>96)</a><a class='footnoteBacklink' href='#footnoteref-96'>96)</a> <div id='footnote-96.sentence-1' class='sentence'>Multi-level pointers to classes or references to multi-level pointers to
classes are not allowed<a class='hidden_link' href='#footnote-96.sentence-1'>.</a></div></div></div></div></body></html>