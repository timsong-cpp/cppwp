<!DOCTYPE html><html lang='en'><head><title>[class.free]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>11</a> Classes <a class='abbr_ref' href='./#class'>[class]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>11.4</a> Class members <a class='abbr_ref' href='class.mem#class.free'>[class.mem]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>11.4.11</a> Allocation and deallocation functions <a class='abbr_ref'>[class.free]</a></h3><div class='texpara'><a class='index' id=':free_store'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2841'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':new,type_of'></a><a class='index' id=':allocation_function,class-specific'></a>Any allocation function for a class
<span class='texttt'>T</span>
is a static member (even if not explicitly declared
<span id=':static'><span class='texttt'><span class='keyword'>static</span></span></span>)<a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2849'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>: <span class='codeblock'><span class='keyword'>class</span> Arena;
<span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span><span class='operator'>*</span> <span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>size_t, Arena<span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> D1 <span class='operator'>:</span> B <span class='curlybracket'>{</span>
<span class='curlybracket'>}</span>;

Arena<span class='operator'>*</span>  ap;
<span class='keyword'>void</span> foo<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>new</span> <span class='parenthesis'>(</span>ap<span class='parenthesis'>)</span> D1;      <span class='comment'>// calls <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;operator new(std&#x200b;::&#x200b;size_<span class='shy'></span>t, Arena*)</span></span>
  <span class='keyword'>new</span> D1<span class='squarebracket'>[</span>i<span class='squarebracket'>]</span>;        <span class='comment'>// calls <span class='tcode_in_codeblock'>&#x200b;::&#x200b;operator new[](std&#x200b;::&#x200b;size_<span class='shy'></span>t)</span></span>
  <span class='keyword'>new</span> D1;           <span class='comment'>// error: <span class='tcode_in_codeblock'>&#x200b;::&#x200b;operator new(std&#x200b;::&#x200b;size_<span class='shy'></span>t)</span> hidden</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2868'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'><a class='index' id=':delete,type_of'></a><a class='index' id=':deallocation_function,class-specific'></a>Any deallocation function for a class
<span class='texttt'>X</span>
is a static member (even if not explicitly declared
<span id=':static_'><span class='texttt'><span class='keyword'>static</span></span></span>)<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>: <span class='codeblock'><span class='keyword'>class</span> X <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>class</span> Y <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2889'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>Since member allocation and deallocation functions are
<span id=':static__'><span class='texttt'><span class='keyword'>static</span></span></span>
they cannot be virtual<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>: <div id='4.sentence-2' class='sentence'>However, when the
<a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression'><span class='textsf'><i >cast-expression</i></span></span></a>
of a
<a href='expr.delete#nt:delete-expression' title='7.6.2.9&emsp;Delete&emsp;[expr.delete]'><span id='ntref:delete-expression'><span class='textsf'><i >delete-expression</i></span></span></a>
refers to an object of class type with a virtual destructor,
because the deallocation function is chosen by the destructor
of the dynamic type of the object, the effect is the same in that case<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>For example,
<span class='codeblock'><span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='operator'>~</span>B<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> E <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> log_deletion<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span>E <span class='operator'>*</span>p, std<span class='operator'>::</span>destroying_delete_t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    p<span class='operator'>-</span><span class='anglebracket'>&gt;</span>log_deletion<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    p<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='operator'>~</span>E<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='operator'>::</span><span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span>p<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  B<span class='operator'>*</span> bp <span class='operator'>=</span> <span class='keyword'>new</span> D;
  <span class='keyword'>delete</span> bp;        <span class='comment'>// 1: uses <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;operator delete(void*)</span></span>
  bp <span class='operator'>=</span> <span class='keyword'>new</span> E;
  <span class='keyword'>delete</span> bp;        <span class='comment'>// 2: uses <span class='tcode_in_codeblock'>E&#x200b;::&#x200b;operator delete(E*, std&#x200b;::&#x200b;destroying_<span class='shy'></span>delete_<span class='shy'></span>t)</span></span>
<span class='curlybracket'>}</span>
</span></div> <div id='4.sentence-4' class='sentence'>
Here, storage for the object of class
<span class='texttt'>D</span>
is deallocated by
<span class='texttt'>D<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,
and
the object of class <span class='texttt'>E</span> is destroyed
and its storage is deallocated
by <span class='texttt'>E<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,
due to the virtual destructor<a class='hidden_link' href='#4.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>: <div id='4.sentence-5' class='sentence'>Virtual destructors have no effect on the deallocation function actually
called when the
<a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression_'><span class='textsf'><i >cast-expression</i></span></span></a>
of a
<a href='expr.delete#nt:delete-expression' title='7.6.2.9&emsp;Delete&emsp;[expr.delete]'><span id='ntref:delete-expression_'><span class='textsf'><i >delete-expression</i></span></span></a>
refers to an array of objects of class type<a class='hidden_link' href='#4.sentence-5'>.</a></div> <div id='4.sentence-6' class='sentence'>For example,
<span class='codeblock'><span class='keyword'>struct</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='operator'>~</span>B<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> B <span class='curlybracket'>{</span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  D<span class='operator'>*</span> dp <span class='operator'>=</span> <span class='keyword'>new</span> D<span class='squarebracket'>[</span>i<span class='squarebracket'>]</span>;
  <span class='keyword'>delete</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span> dp;     <span class='comment'>// uses <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;operator delete[](void*, std&#x200b;::&#x200b;size_<span class='shy'></span>t)</span></span>
  B<span class='operator'>*</span> bp <span class='operator'>=</span> <span class='keyword'>new</span> D<span class='squarebracket'>[</span>i<span class='squarebracket'>]</span>;
  <span class='keyword'>delete</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span> bp;      <span class='comment'>// undefined behavior</span>
<span class='curlybracket'>}</span>
</span></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2965'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>Access to the deallocation function is checked statically,
even if a different one is actually executed<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>: <div id='5.sentence-2' class='sentence'>For the call on line “// 1” above,
if
<span class='texttt'>B<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
had been private, the delete expression would have been ill-formed<a class='hidden_link' href='#5.sentence-2'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a4b1ffd9e65188ae19c29dffd2db42cb1558cee2/source/classes.tex#L2975'>#</a></div><div class='texpara'><div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>: <div id='6.sentence-1' class='sentence'>If a deallocation function has no explicit <a href='except.spec#nt:noexcept-specifier' title='14.5&emsp;Exception specifications&emsp;[except.spec]'><span id='ntref:noexcept-specifier'><span class='textsf'><i >noexcept-specifier</i></span></span></a>, it
has a non-throwing exception specification (<a href='except.spec' title='14.5&emsp;Exception specifications'>[except.<span class='shy'></span>spec]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></body></html>