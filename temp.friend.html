<!DOCTYPE html><html lang='en'><head><title>[temp.friend]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>17</a> Templates <a class='abbr_ref' href='./#temp'>[temp]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>17.5</a> Template declarations <a class='abbr_ref' href='temp.decls#temp.friend'>[temp.decls]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>17.5.4</a> Friends <a class='abbr_ref'>[temp.friend]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L1980'>#</a></div><p ><span class='indexparent'><a class='index' id=':friend,template_and'></a></span>A friend of a class or class template can be a function template or
class template, a specialization of a function template or class
template, or a non-template function or class.
For a friend function declaration that is not a template declaration:</p><ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.1'>(1.1)</a></div><p >if the name of the friend is a qualified or unqualified <i ><a href='temp.names#nt:template-id'>template-id</a></i>,
the friend declaration refers to a specialization of a function
template, otherwise,
</p></li><li id='1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.2'>(1.2)</a></div><p >if the name of the friend is a <i ><a href='expr.prim.id.qual#nt:qualified-id'>qualified-id</a></i> and a matching non-template
function is found in the specified class or namespace, the friend
declaration refers to that function, otherwise,
</p></li><li id='1.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.3'>(1.3)</a></div><p >if the name of the friend is a <i ><a href='expr.prim.id.qual#nt:qualified-id'>qualified-id</a></i> and a matching
function template
is found in the specified class
or namespace, the friend declaration refers to
the deduced specialization of that function template (<a href='temp.deduct.decl'>[temp.deduct.decl]</a>), otherwise,
</p></li><li id='1.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.4'>(1.4)</a></div><p >the name shall be an <i ><a href='expr.prim.id.unqual#nt:unqualified-id'>unqualified-id</a></i> that declares (or redeclares) a
non-template function.
</p></li></ul><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
template&lt;class T&gt; class task;
template&lt;class T&gt; task&lt;T&gt;* preempt(task&lt;T&gt;*);

template&lt;class T&gt; class task {
  friend void next_time();
  friend void process(task&lt;T&gt;*);
  friend task&lt;T&gt;* preempt&lt;T&gt;(task&lt;T&gt;*);
  template&lt;class C&gt; friend int func(C);

  friend class task&lt;int&gt;;
  template&lt;class P&gt; friend class frd;
};</pre><p >Here,
each specialization of the
<span class='texttt'>task</span>
class template has the function
<span class='texttt'>next_&shy;time</span>
as a friend;
because
<span class='texttt'>process</span>
does not have explicit
<i ><a href='temp.names#nt:template-argument'>template-argument</a></i><span class='textit'>s</span>,
each specialization of the
<span class='texttt'>task</span>
class template has an appropriately typed function
<span class='texttt'>process</span>
as a friend, and this friend is not a function template specialization;
because the friend
<span class='texttt'>preempt</span>
has an explicit
<i ><a href='temp.names#nt:template-argument'>template-argument</a></i>
<span class='texttt'>T</span>,
each specialization of the
<span class='texttt'>task</span>
class template has the appropriate specialization of the function
template
<span class='texttt'>preempt</span>
as a friend;
and each specialization of the
<span class='texttt'>task</span>
class template has all specializations of the function template
<span class='texttt'>func</span>
as friends.
Similarly,
each specialization of the
<span class='texttt'>task</span>
class template has the class template specialization
<span class='texttt'>task&lt;int&gt;</span>
as a friend, and has all specializations of the class template
<span class='texttt'>frd</span>
as friends.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2064'>#</a></div><p >A friend template may be declared within a class or class template.
A friend function template may be defined within a class or class
template, but a friend class template may not be defined in a class
or class template.
In these cases, all specializations of the friend class or friend function
template are friends of the class or class template granting friendship.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
class A {
  template&lt;class T&gt; friend class B;                 <span class='comment'>// OK
</span>  template&lt;class T&gt; friend void f(T){ <span class='tcode_in_codeblock'>/* ...&nbsp;*/</span> }   <span class='comment'>// OK
</span>};</pre><p ><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2080'>#</a></div><p >A template friend declaration specifies that all specializations of that
template, whether they are <a href='temp.inst'>implicitly instantiated</a>, <a href='temp.class.spec'>partially
specialized</a> or <a href='temp.expl.spec'>explicitly specialized</a>,
are friends of the class containing the template friend declaration.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
class X {
  template&lt;class T&gt; friend struct A;
  class Y { };
};

template&lt;class T&gt; struct A { X::Y ab; };            <span class='comment'>// OK
</span>template&lt;class T&gt; struct A&lt;T*&gt; { X::Y ab; };        <span class='comment'>// OK
</span></pre><p ><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2097'>#</a></div><p >A member of a class template may be declared to be a friend of a
non-template class.
In this case,
the corresponding member of every specialization of
the primary class template and
class template partial specializations thereof
is a friend of the class granting friendship.
For
explicit specializations and
specializations of partial specializations,
the corresponding member is the member (if any)
that has the same name, kind (type, function, class template, or function
template), template parameters, and signature as the member of the class
template instantiation that would otherwise have been generated.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> </p><pre class='codeblock'>
template&lt;class T&gt; struct A {
  struct B { };
  void f();
  struct D {
    void g();
  };
};
template&lt;&gt; struct A&lt;int&gt; {
  struct B { };
  int f();
  struct D {
    void g();
  };
};

class C {
  template&lt;class T&gt; friend struct A&lt;T&gt;::B;      <span class='comment'>// grants friendship to <span class='tcode_in_codeblock'>A&lt;int&gt;&#x200b;::&#x200b;B</span> even though
</span>                                                <span class='comment'>// it is not a specialization of <span class='tcode_in_codeblock'>A&lt;T&gt;&#x200b;::&#x200b;B</span>
</span>  template&lt;class T&gt; friend void A&lt;T&gt;::f();      <span class='comment'>// does not grant friendship to <span class='tcode_in_codeblock'>A&lt;int&gt;&#x200b;::&#x200b;f()</span>
</span>                                                <span class='comment'>// because its return type does not match
</span>  template&lt;class T&gt; friend void A&lt;T&gt;::D::g();   <span class='comment'>// does not grant friendship to <span class='tcode_in_codeblock'>A&lt;int&gt;&#x200b;::&#x200b;D&#x200b;::&#x200b;g()</span>
</span>                                                <span class='comment'>// because <span class='tcode_in_codeblock'>A&lt;int&gt;&#x200b;::&#x200b;D</span> is not a specialization of <span class='tcode_in_codeblock'>A&lt;T&gt;&#x200b;::&#x200b;D</span>
</span>};</pre><p ><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2141'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
A friend declaration may first declare a member of an enclosing namespace scope (<a href='temp.inject'>[temp.inject]</a>).
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2146'>#</a></div><p >A friend template shall not be declared in a local class.</p></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2149'>#</a></div><p >Friend declarations shall not declare partial specializations.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> </p><pre class='codeblock'>
template&lt;class T&gt; class A { };
class X {
  template&lt;class T&gt; friend class A&lt;T*&gt;;         <span class='comment'>// error
</span>};</pre><p ><span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/ae6271c88727c3fabe7dd8258f8687b369d83d6d/source/templates.tex#L2161'>#</a></div><p >When a friend declaration refers to a specialization of a function
template, the function parameter declarations shall not include
default arguments, nor shall the inline specifier be used in such a
declaration.</p></div></div></body></html>