<!DOCTYPE html><html lang='en'><head><title>[dcl.attr.depend]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>7</a> Declarations <a class='abbr_ref' href='./#dcl.dcl'>[dcl.dcl]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>7.6</a> Attributes <a class='abbr_ref' href='dcl.attr#depend'>[dcl.attr]</a></h2><div id='dcl.attr.depend'><h3 ><a class='secnum' style='min-width:103pt'>7.6.3</a> Carries dependency attribute <a class='abbr_ref'>[dcl.attr.depend]</a></h3><p ><span class='indexparent'><a class='index' id='attribute,carries_dependency'></a></span></p><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >The <i ><a href='dcl.attr.grammar#nt:attribute-token'>attribute-token</a></i> <span class='texttt'>carries_dependency</span> specifies
dependency propagation into and out of functions. It shall appear at most once
in each <i ><a href='dcl.attr.grammar#nt:attribute-list'>attribute-list</a></i> and no
<i ><a href='dcl.attr.grammar#nt:attribute-argument-clause'>attribute-argument-clause</a></i> shall be present. The attribute may be
applied to the <i ><a href='dcl.decl#nt:declarator-id'>declarator-id</a></i> of a
<i ><a href='dcl.fct#nt:parameter-declaration'>parameter-declaration</a></i> in a function declaration or lambda, in
which case it specifies that the initialization of the parameter carries a
dependency to (<a href='intro.multithread'>[intro.multithread]</a>) each lvalue-to-rvalue
conversion (<a href='conv.lval'>[conv.lval]</a>) of that object. The attribute may also be applied
to the <i ><a href='dcl.decl#nt:declarator-id'>declarator-id</a></i> of a function declaration, in which case it
specifies that the return value, if any, carries a dependency to the evaluation
of the function call expression.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >The first declaration of a function shall specify the <span class='texttt'>carries_dependency</span> attribute for its
<i ><a href='dcl.decl#nt:declarator-id'>declarator-id</a></i> if any declaration of the function specifies the
<span class='texttt'>carries_dependency</span> attribute. Furthermore, the first declaration of a function shall specify
the <span class='texttt'>carries_dependency</span> attribute for a parameter if any declaration of that function
specifies the <span class='texttt'>carries_dependency</span> attribute for that parameter. If a function or one of its
parameters is declared with the <span class='texttt'>carries_dependency</span> attribute in its first declaration in one
translation unit and the same function or one of its parameters is declared without the
<span class='texttt'>carries_dependency</span> attribute in its first declaration in another translation unit, the
program is ill-formed; no diagnostic required.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><p >[&nbsp;<i>Note:</i> The <span class='texttt'>carries_dependency</span> attribute does not change the meaning of the
program, but may result in generation of more efficient code. <i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><p >[&nbsp;<i>Example:</i>
</p><pre class='codeblock'>
<span class='comment'>/* Translation unit A. */</span>

struct foo { int* a; int* b; };
std::atomic&lt;struct foo *&gt; foo_head[10];
int foo_array[10][10];

[[carries_dependency]] struct foo* f(int i) {
  return foo_head[i].load(memory_order_consume);
}

int g(int* x, int* y [[carries_dependency]]) {
  return kill_dependency(foo_array[*x][*y]);
}

<span class='comment'>/* Translation unit B. */</span>

[[carries_dependency]] struct foo* f(int i);
int g(int* x, int* y [[carries_dependency]]);

int c = 3;

void h(int i) {
  struct foo* p;

  p = f(i);
  do_something_with(g(&amp;c, p-&gt;a));
  do_something_with(g(p-&gt;a, &amp;c));
}
</pre></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><p >The <span class='texttt'>carries_dependency</span> attribute on function <span class='texttt'>f</span> means that the
return value carries a dependency out of <span class='texttt'>f</span>, so that the implementation
need not constrain ordering upon return from <span class='texttt'>f</span>. Implementations of
<span class='texttt'>f</span> and its caller may choose to preserve dependencies instead of emitting
hardware memory ordering instructions (a.k.a. fences).</p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><p >Function <span class='texttt'>g</span>'s second parameter has a <span class='texttt'>carries_dependency</span> attribute,
but its first parameter does not. Therefore, function <span class='texttt'>h</span>'s first call to
<span class='texttt'>g</span> carries a dependency into <span class='texttt'>g</span>, but its second call does not. The
implementation might need to insert a fence prior to the second call to
<span class='texttt'>g</span>.</p><p ><i>&nbsp;—&nbsp;end example</i>&nbsp;]<span class='indexparent'><a class='index' id='attribute'></a></span><span class='indexparent'><a class='index' id='declaration'></a></span></p></div></div></div></body></html>