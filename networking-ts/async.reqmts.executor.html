<!DOCTYPE html><html lang='en'><head><title>[async.reqmts.executor]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>13</a> Asynchronous model <a class='abbr_ref' href='./#async'>[async]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>13.2</a> Requirements <a class='abbr_ref' href='async.reqmts#executor'>[async.reqmts]</a></h2><div id='async.reqmts.executor'><h3 ><a class='secnum' style='min-width:103pt'>13.2.2</a> Executor requirements <a class='abbr_ref'>[async.reqmts.executor]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><p >The library describes a standard set of requirements for executors. A type meeting the <span class='texttt'>Executor</span> requirements embodies a set of rules for determining how submitted function objects are to be executed.</p></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><p >A type <span class='texttt'>X</span> meets the <span class='texttt'>Executor</span> requirements if it satisfies the requirements of <span class='texttt'>CopyConstructible</span> (C++ 2014 [copyconstructible]) and <span class='texttt'>Destructible</span> (C++ 2014 [destructible]), as well as the additional requirements listed below.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><p >No comparison operator, copy operation, move operation, swap operation, or member functions <span class='texttt'>context</span>, <span class='texttt'>on_work_started</span>, and <span class='texttt'>on_work_finished</span> on these types shall exit via an exception.</p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><p >The executor copy constructor, comparison operators, and other member functions defined in these requirements shall not introduce data races as a result of concurrent calls to those functions from different threads.
The member function <span class='texttt'>dispatch</span> may be recursively reentered.</p></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><p >Let <span class='texttt'>ctx</span> be the execution context returned by the executor's <span class='texttt'>context()</span> member function. An executor becomes invalid when the first call to <span class='texttt'>ctx.shutdown()</span> returns. The effect of calling <span class='texttt'>on_work_started</span>, <span class='texttt'>on_work_finished</span>, <span class='texttt'>dispatch</span>, <span class='texttt'>post</span>, or <span class='texttt'>defer</span> on an invalid executor is undefined. [&nbsp;<i>Note:</i> The copy constructor, comparison operators, and <span class='texttt'>context()</span> member function continue to remain valid until <span class='texttt'>ctx</span> is destroyed. <i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><p >In Table <a href='#tab:async.reqmts.executor.requirements'>[tab:async.reqmts.executor.requirements]</a>,
<span class='texttt'>x1</span> and <span class='texttt'>x2</span> denote (possibly const) values of type <span class='texttt'>X</span>,
<span class='texttt'>mx1</span> denotes an xvalue of type <span class='texttt'>X</span>,
<span class='texttt'>f</span> denotes a function object of <span class='texttt'>MoveConstructible</span> (C++ 2014 [moveconstructible]) type <span class='texttt'>Func</span> such that <span class='texttt'>f()</span> is a valid expression,
<span class='texttt'>a</span> denotes a (possibly const) value of type <span class='texttt'>A</span>
where <span class='texttt'>A</span> is a type meeting the <span class='texttt'>ProtoAllocator</span> requirements (<a href='async.reqmts.proto.allocator'>[async.reqmts.proto.allocator]</a>),
and <span class='texttt'>u</span> denotes an identifier.</p><div class='numberedTable' id='tab:async.reqmts.executor.requirements'>Table <a href='#tab:async.reqmts.executor.requirements'>4</a> — Executor requirements<br><table ><tr class='rowsep'><td colspan='1' class='center'><b>expression</b></td><td colspan='1' class='center'><b>type</b></td><td colspan='1' class='center'><b>assertion/note pre/post-conditions</b></td></tr><tr class='capsep'><td class='left'> 
<span class='texttt'>X u(x1);</span>  </td><td class='left'>
  </td><td class='left'>
Shall not exit via an exception.<br/><i>post:</i> <span class='texttt'>u == x1</span> and <span class='texttt'>std::addressof(u.context()) == std::addressof(x1.context()).</span>  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>X u(mx1);</span>  </td><td class='left'>
  </td><td class='left'>
Shall not exit via an exception.<br/><i>post:</i> <span class='texttt'>u</span> equals the prior value of <span class='texttt'>mx1</span> and <span class='texttt'>std::addressof(u.context())</span> equals the prior value of <span class='texttt'>std::addressof(mx1.context())</span>.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1 == x2</span>  </td><td class='left'>
<span class='texttt'>bool</span>  </td><td class='left'>
Returns <span class='texttt'>true</span> only if <span class='texttt'>x1</span> and <span class='texttt'>x2</span> can be interchanged with identical effects in any of the expressions defined in these type requirements. [&nbsp;<i>Note:</i> Returning <span class='texttt'>false</span> does not necessarily imply that the effects are not identical. <i>&nbsp;—&nbsp;end note</i>&nbsp;]<br/><span class='texttt'>operator==</span> shall be reflexive, symmetric, and transitive, and shall not exit via an exception.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1 != x2</span>  </td><td class='left'>
<span class='texttt'>bool</span>  </td><td class='left'>
Same as <span class='texttt'>!(x1 == x2)</span>.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.context()</span>  </td><td class='left'>
<span class='texttt'>execution_context&amp;</span>, or <span class='texttt'>E&amp;</span> where <span class='texttt'>E</span> is a type that satisfies the <span class='texttt'>ExecutionContext</span>  (<a href='async.reqmts.executioncontext'>[async.reqmts.executioncontext]</a>) requirements.  </td><td class='left'>
Shall not exit via an exception. The comparison operators and member functions defined in these requirements shall not alter the reference returned by this function.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.on_work_started()</span>  </td><td class='left'>
  </td><td class='left'>
 Shall not exit via an exception.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.on_work_finished()</span>  </td><td class='left'>
  </td><td class='left'>
Shall not exit via an exception. <br/><i>Precondition:</i> A preceding call <span class='texttt'>x2.on_work_started()</span> where <span class='texttt'>x1 == x2</span>.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.dispatch(<br/><span class='mbox'>  </span>std::move(f), a)</span>  </td><td class='left'>
  </td><td class='left'>
<i>Effects:</i> Creates an object <span class='texttt'>f1</span> initialized with <span class='texttt'><i>DECAY_COPY</i>(std::forward&lt;Func&gt;(f))</span> (C++ 2014 [thread.decaycopy]) in the current thread of execution. Calls <span class='texttt'>f1()</span> at most once. The executor may block forward progress of the caller until <span class='texttt'>f1()</span> finishes execution. Executor implementations should use the supplied allocator to allocate any memory required to store the function object. Prior to invoking the function object, the executor shall deallocate any memory allocated. [&nbsp;<i>Note:</i> Executors defined in this document always use the supplied allocator unless otherwise specified. <i>&nbsp;—&nbsp;end note</i>&nbsp;] <br/>
<i>Synchronization:</i> The invocation of <span class='texttt'>dispatch</span> synchronizes with (C++ 2014 [intro.multithread]) the invocation of <span class='texttt'>f1</span>.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.post(std::move(f), a)</span>  </td><td class='left'>
  </td><td class='left'>
<i>Effects:</i> Creates an object <span class='texttt'>f1</span> initialized with <span class='texttt'><i>DECAY_COPY</i>(std::forward&lt;Func&gt;(f))</span> in the current thread of execution. Calls <span class='texttt'>f1()</span> at most once. The executor shall not block forward progress of the caller pending completion of <span class='texttt'>f1()</span>. The executor may begin <span class='texttt'>f1</span>'s progress before the call to <span class='texttt'>post</span> completes. Executor implementations should use the supplied allocator to allocate any memory required to store the function object. Prior to invoking the function object, the executor shall deallocate any memory allocated. [&nbsp;<i>Note:</i> Executors defined in this document always use the supplied allocator unless otherwise specified. <i>&nbsp;—&nbsp;end note</i>&nbsp;]<br/>
<i>Synchronization:</i> The invocation of <span class='texttt'>post</span> synchronizes with (C++ 2014 [intro.multithread]) the invocation of <span class='texttt'>f1</span>.  </td></tr><tr class='rowsep'><td class='left'> <span class='texttt'>x1.defer(std::move(f), a)</span>  </td><td class='left'>
  </td><td class='left'>
<i>Effects:</i> Creates an object <span class='texttt'>f1</span> initialized with <span class='texttt'><i>DECAY_COPY</i>(std::forward&lt;Func&gt;(f))</span> in the current thread of execution. Calls <span class='texttt'>f1()</span> at most once. The executor shall not block forward progress of the caller pending completion of <span class='texttt'>f1()</span>. The executor should not begin <span class='texttt'>f1</span>'s progress before the call to <span class='texttt'>defer</span> completes. [&nbsp;<i>Note:</i> One use of <span class='texttt'>defer</span> is to convey the intention of the caller that <span class='texttt'>f1</span> is a continuation of the current call context. The executor can use this information to optimize or otherwise adjust the way in which <span class='texttt'>f1</span> is invoked. <i>&nbsp;—&nbsp;end note</i>&nbsp;]  Executor implementations should use the supplied allocator to allocate any memory required to store the function object. Prior to invoking the function object, the executor shall deallocate any memory allocated. [&nbsp;<i>Note:</i> Executors defined in this document always use the supplied allocator unless otherwise specified. <i>&nbsp;—&nbsp;end note</i>&nbsp;]<br/>
<i>Synchronization:</i> The invocation of <span class='texttt'>defer</span> synchronizes with (C++ 2014 [intro.multithread]) the invocation of <span class='texttt'>f1</span>.  </td></tr></table></div></div></div></div></body></html>