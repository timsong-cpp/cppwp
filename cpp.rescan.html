<!DOCTYPE html><html lang='en'><head><title>[cpp.rescan]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>15</a> Preprocessing directives <a class='abbr_ref' href='./#cpp'>[cpp]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>15.6</a> Macro replacement <a class='abbr_ref' href='cpp.replace#cpp.rescan'>[cpp.replace]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>15.6.5</a> Rescanning and further replacement <a class='abbr_ref'>[cpp.rescan]</a></h3><div class='texpara'><a class='index' id=':macro,rescanning_and_replacement'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8238252bcec14f76e97133db32721beaec5c749b/source/preprocessor.tex#L1471'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>After all parameters in the replacement list have been substituted and <span class='texttt'><span class='preprocessordirective'>#</span></span> and <span class='texttt'><span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span></span> processing has taken
place, all placemarker preprocessing tokens are removed<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>Then
the resulting preprocessing token sequence is rescanned, along with all
subsequent preprocessing tokens of the source file, for more macro names
to replace<a class='hidden_link' href='#1.sentence-2'>.</a></div></div></div><div class='para nonNormativeOnly' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8238252bcec14f76e97133db32721beaec5c749b/source/preprocessor.tex#L1478'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<div id='2.sentence-1' class='sentence'>The sequence
<span class='codeblock'><span class='preprocessordirective'>#define</span> x       <span class='literal'>3</span>
<span class='preprocessordirective'>#define</span> f<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>    f<span class='parenthesis'>(</span>x <span class='operator'>*</span> <span class='parenthesis'>(</span>a<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
<span class='preprocessordirective'>#undef</span>  x
<span class='preprocessordirective'>#define</span> x       <span class='literal'>2</span>
<span class='preprocessordirective'>#define</span> g       f
<span class='preprocessordirective'>#define</span> z       z<span class='squarebracket'>[</span><span class='literal'>0</span><span class='squarebracket'>]</span>
<span class='preprocessordirective'>#define</span> h       g<span class='parenthesis'>(</span><span class='operator'>~</span>
<span class='preprocessordirective'>#define</span> m<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>    a<span class='parenthesis'>(</span>w<span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> w       <span class='literal'>0</span>,<span class='literal'>1</span>
<span class='preprocessordirective'>#define</span> t<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>    a
<span class='preprocessordirective'>#define</span> p<span class='parenthesis'>(</span><span class='parenthesis'>)</span>     <span class='keyword'>int</span>
<span class='preprocessordirective'>#define</span> q<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>    x
<span class='preprocessordirective'>#define</span> r<span class='parenthesis'>(</span>x,y<span class='parenthesis'>)</span>  x <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> y
<span class='preprocessordirective'>#define</span> str<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>  <span class='preprocessordirective'>#</span> x

f<span class='parenthesis'>(</span>y<span class='operator'>+</span><span class='literal'>1</span><span class='parenthesis'>)</span> <span class='operator'>+</span> f<span class='parenthesis'>(</span>f<span class='parenthesis'>(</span>z<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>%</span> t<span class='parenthesis'>(</span>t<span class='parenthesis'>(</span>g<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span> <span class='operator'>+</span> t<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>;
g<span class='parenthesis'>(</span>x<span class='operator'>+</span><span class='parenthesis'>(</span><span class='literal'>3</span>,<span class='literal'>4</span><span class='parenthesis'>)</span><span class='operator'>-</span>w<span class='parenthesis'>)</span> <span class='operator'>|</span> h <span class='literal'>5</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> m
    <span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='operator'>^</span>m<span class='parenthesis'>(</span>m<span class='parenthesis'>)</span>;
p<span class='parenthesis'>(</span><span class='parenthesis'>)</span> i<span class='squarebracket'>[</span>q<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> q<span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>(</span><span class='literal'>2</span>,<span class='literal'>3</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>(</span><span class='literal'>4</span>,<span class='parenthesis'>)</span>, r<span class='parenthesis'>(</span>,<span class='literal'>5</span><span class='parenthesis'>)</span>, r<span class='parenthesis'>(</span>,<span class='parenthesis'>)</span> <span class='curlybracket'>}</span>;
<span class='keyword'>char</span> c<span class='squarebracket'>[</span><span class='literal'>2</span><span class='squarebracket'>]</span><span class='squarebracket'>[</span><span class='literal'>6</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> str<span class='parenthesis'>(</span>hello<span class='parenthesis'>)</span>, str<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>;
</span>
results in
<span class='codeblock'>f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span>y<span class='operator'>+</span><span class='literal'>1</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>+</span> f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span>z<span class='squarebracket'>[</span><span class='literal'>0</span><span class='squarebracket'>]</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>%</span> f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>+</span> t<span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>;
f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span><span class='literal'>2</span><span class='operator'>+</span><span class='parenthesis'>(</span><span class='literal'>3</span>,<span class='literal'>4</span><span class='parenthesis'>)</span><span class='operator'>-</span><span class='literal'>0</span>,<span class='literal'>1</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>|</span> f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span><span class='operator'>~</span> <span class='literal'>5</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> f<span class='parenthesis'>(</span><span class='literal'>2</span> <span class='operator'>*</span> <span class='parenthesis'>(</span><span class='literal'>0</span>,<span class='literal'>1</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>^</span>m<span class='parenthesis'>(</span><span class='literal'>0</span>,<span class='literal'>1</span><span class='parenthesis'>)</span>;
<span class='keyword'>int</span> i<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='literal'>1</span>, <span class='literal'>23</span>, <span class='literal'>4</span>, <span class='literal'>5</span>, <span class='curlybracket'>}</span>;
<span class='keyword'>char</span> c<span class='squarebracket'>[</span><span class='literal'>2</span><span class='squarebracket'>]</span><span class='squarebracket'>[</span><span class='literal'>6</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='literal'>"hello"</span>, <span class='literal'>""</span> <span class='curlybracket'>}</span>;
</span></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8238252bcec14f76e97133db32721beaec5c749b/source/preprocessor.tex#L1512'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>If the name of the macro being replaced is found during this scan of
the replacement list
(not including the rest of the source file's preprocessing tokens),
it is not replaced<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>Furthermore,
if any nested replacements encounter the name of the macro being replaced,
it is not replaced<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>These nonreplaced macro name preprocessing tokens are no longer available
for further replacement even if they are later (re)examined in contexts
in which that macro name preprocessing token would otherwise have been
replaced<a class='hidden_link' href='#3.sentence-3'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8238252bcec14f76e97133db32721beaec5c749b/source/preprocessor.tex#L1525'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>The resulting completely macro-replaced preprocessing token sequence
is not processed as a preprocessing directive even if it resembles one,
but all pragma unary operator expressions within it are then processed as
specified in <a href='cpp.pragma.op' title='15.12&emsp;Pragma operator'>[cpp.<span class='shy'></span>pragma.<span class='shy'></span>op]</a> below<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div></div></body></html>