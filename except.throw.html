<!DOCTYPE html><html lang='en'><head><title>[except.throw]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>14</a> Exception handling <a class='abbr_ref' href='./#except'>[except]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>14.2</a> Throwing an exception <a class='abbr_ref'>[except.throw]</a></h2><div class='texpara'><a class='index' id=':exception_handling,throwing'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L192'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>Throwing an exception transfers control to a handler<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='1.sentence-2' class='sentence'>An exception can be thrown from one of the following contexts:
<a href='expr.throw#nt:throw-expression' title='7.6.18&emsp;Throwing an exception&emsp;[expr.throw]'><span id='ntref:throw-expression'><span class='textsf'><i >throw-expression</i></span></span></a><i >s</i> (<a href='expr.throw' title='7.6.18&emsp;Throwing an exception'>[expr.<span class='shy'></span>throw]</a>),
allocation functions (<a href='basic.stc.dynamic.allocation' title='6.7.6.5.2&emsp;Allocation functions'>[basic.<span class='shy'></span>stc.<span class='shy'></span>dynamic.<span class='shy'></span>allocation]</a>),
<span id=':dynamic_cast'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span> (<a href='expr.dynamic.cast' title='7.6.1.7&emsp;Dynamic cast'>[expr.<span class='shy'></span>dynamic.<span class='shy'></span>cast]</a>),
<span id=':typeid'><span class='texttt'><span class='keyword'>typeid</span></span></span> (<a href='expr.typeid' title='7.6.1.8&emsp;Type identification'>[expr.<span class='shy'></span>typeid]</a>),
<a href='expr.new#nt:new-expression' title='7.6.2.8&emsp;New&emsp;[expr.new]'><span id='ntref:new-expression'><span class='textsf'><i >new-expression</i></span></span></a><i >s</i> (<a href='expr.new' title='7.6.2.8&emsp;New'>[expr.<span class='shy'></span>new]</a>), and standard library
functions (<a href='structure.specifications' title='16.3.2.4&emsp;Detailed specifications'>[structure.<span class='shy'></span>specifications]</a>)<a class='hidden_link' href='#1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='1.sentence-3' class='sentence'>
An object is passed and the type of that object determines which handlers
can catch it<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<div id='1.sentence-4' class='sentence'><span class='codeblock'><span class='keyword'>throw</span> <span class='literal'>"Help!"</span>;
</span>
can be caught by a
<a href='except.pre#nt:handler' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:handler'><span class='textsf'><i >handler</i></span></span></a>
of
<span id=':const'><span class='texttt'><span class='keyword'>const</span></span></span>
<span class='texttt'><span id=':char'><span class='texttt'><span class='keyword'>char</span></span></span><span class='operator'>*</span></span>
type:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
    <span class='comment'>// ...</span>
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='comment'>// handle character string exceptions here</span>
<span class='curlybracket'>}</span>
</span>
and
<span class='codeblock'><span class='keyword'>class</span> Overflow <span class='curlybracket'>{</span>
<span class='keyword'>public</span><span class='operator'>:</span>
    Overflow<span class='parenthesis'>(</span><span class='keyword'>char</span>,<span class='keyword'>double</span>,<span class='keyword'>double</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>double</span> x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>throw</span> Overflow<span class='parenthesis'>(</span><span class='literal'>'+'</span>,x,<span class='literal'>3.45e107</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
can be caught by a handler for exceptions of type
<span class='texttt'>Overflow</span>:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
    f<span class='parenthesis'>(</span><span class='literal'>1.2</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span>Overflow<span class='operator'>&amp;</span> oo<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='comment'>// handle exceptions of type <span class='tcode_in_codeblock'>Overflow</span> here</span>
<span class='curlybracket'>}</span>
</span></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L244'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'><a class='index' id=':exception_handling,throwing_'></a><a class='index' id=':exception_handling,handler'></a><a class='index' id=':exception_handling,nearest_handler'></a>When an exception is thrown, control is transferred to the nearest handler with
a matching type (<a href='except.handle' title='14.4&emsp;Handling an exception'>[except.<span class='shy'></span>handle]</a>); “nearest” means the handler
for which the
<a href='stmt.block#nt:compound-statement' title='8.4&emsp;Compound statement or block&emsp;[stmt.block]'><span id='ntref:compound-statement'><span class='textsf'><i >compound-statement</i></span></span></a> or
<a href='class.base.init#nt:ctor-initializer' title='11.9.3&emsp;Initializing bases and members&emsp;[class.base.init]'><span id='ntref:ctor-initializer'><span class='textsf'><i >ctor-initializer</i></span></span></a>
following the
<span id=':try'><span class='texttt'><span class='keyword'>try</span></span></span>
keyword was most recently entered by the thread of control and not yet exited<a class='hidden_link' href='#2.sentence-1'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L257'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Throwing an exception
initializes an object with dynamic storage duration,
called the
<a class='hidden_link' href='#def:exception_handling,exception_object' title='14.2&emsp;Throwing an exception&emsp;[except.throw]'><span id='def:exception_handling,exception_object'><i >exception object</i></span></a><a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>If the type of the exception object would be
an incomplete type (<a href='basic.types.general' title='6.8.1&emsp;General'>[basic.<span class='shy'></span>types.<span class='shy'></span>general]</a>),
an abstract class type (<a href='class.abstract' title='11.7.4&emsp;Abstract classes'>[class.<span class='shy'></span>abstract]</a>),
or a pointer to an incomplete type other than
<span class='mathit'>cv</span> <span id=':void'><span class='texttt'><span class='keyword'>void</span></span></span> (<a href='basic.compound' title='6.8.4&emsp;Compound types'>[basic.<span class='shy'></span>compound]</a>),
the program is ill-formed<a class='hidden_link' href='#3.sentence-2'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L269'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><a class='index' id=':exception_handling,memory'></a><a class='index' id=':exception_handling,rethrowing'></a><a class='index' id=':exception_handling,exception_object'></a>The memory for the exception object is
allocated in an unspecified way, except as noted in <a href='basic.stc.dynamic.allocation' title='6.7.6.5.2&emsp;Allocation functions'>[basic.<span class='shy'></span>stc.<span class='shy'></span>dynamic.<span class='shy'></span>allocation]</a><a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>If a handler exits by rethrowing, control is passed to another handler for
the same exception object<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>The points of potential destruction for the exception object are:
<ul class='itemize'><li id='4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#4.1'>(4.1)</a></div>when an active handler for the exception exits by
any means other than
rethrowing,
immediately after the destruction of the object (if any)
declared in the <a href='except.pre#nt:exception-declaration' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:exception-declaration'><span class='textsf'><i >exception-declaration</i></span></span></a> in the handler;</li><li id='4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#4.2'>(4.2)</a></div>when an object of type <a href='propagation#lib:exception_ptr' title='17.9.7&emsp;Exception propagation&emsp;[propagation]'><span class='texttt'>std&#x200b;::&#x200b;exception_<span class='shy'></span>ptr</span></a>
that refers to the exception object is destroyed,
before the destructor of <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>exception_<span class='shy'></span>ptr</span> returns<a class='hidden_link' href='#4.sentence-3'>.</a></li></ul></div></div><div class='texpara'><div id='4.sentence-4' class='sentence'>Among all points of potential destruction for the exception object,
there is an unspecified last one
where the exception object is destroyed<a class='hidden_link' href='#4.sentence-4'>.</a></div> <div id='4.sentence-5' class='sentence'>All other points <a href='intro.races#def:happens_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'>happen before</a> that last one<a class='hidden_link' href='#4.sentence-5'>.</a></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>:&ensp;<div id='4.sentence-6' class='sentence'>No other thread synchronization is implied in exception handling<a class='hidden_link' href='#4.sentence-6'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='4.sentence-7' class='sentence'>
The implementation may then
deallocate the memory for the exception object; any such deallocation
is done in an unspecified way<a class='hidden_link' href='#4.sentence-7'>.</a></div> <div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>:&ensp;<div id='4.sentence-8' class='sentence'>A thrown exception does not
propagate to other threads unless caught, stored, and rethrown using
appropriate library functions; see <a href='propagation' title='17.9.7&emsp;Exception propagation'>[propagation]</a> and <a href='futures' title='32.10&emsp;Futures'>[futures]</a><a class='hidden_link' href='#4.sentence-8'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L308'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'><a class='index' id=':exception_handling,exception_object,constructor'></a><a class='index' id=':exception_handling,exception_object,destructor'></a>Let <span class='texttt'>T</span> denote the type of the exception object<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>Copy-initialization of an object of type <span class='texttt'>T</span> from
an lvalue of type <span class='texttt'><span class='keyword'>const</span> T</span> in a context unrelated to <span class='texttt'>T</span>
shall be well-formed<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>If <span class='texttt'>T</span> is a class type,
the selected constructor is odr-used (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>) and
the destructor of <span class='texttt'>T</span> is potentially invoked (<a href='class.dtor' title='11.4.7&emsp;Destructors'>[class.<span class='shy'></span>dtor]</a>)<a class='hidden_link' href='#5.sentence-3'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L319'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'><a class='index' id=':exception_handling,uncaught'></a>An exception is considered <a class='hidden_link' href='#def:uncaught_exception' title='14.2&emsp;Throwing an exception&emsp;[except.throw]'><span id='def:uncaught_exception'><i >uncaught</i></span></a>
after completing the initialization of the exception object
until completing the activation of a handler for the exception (<a href='except.handle' title='14.4&emsp;Handling an exception'>[except.<span class='shy'></span>handle]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>:&ensp;<div id='6.sentence-2' class='sentence'>As a consequence, an exception is considered uncaught
during any stack unwinding resulting from it being thrown<a class='hidden_link' href='#6.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L329'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'><a class='index' id='lib:uncaught_exceptions'></a>If an exception is rethrown (<a href='expr.throw' title='7.6.18&emsp;Throwing an exception'>[expr.<span class='shy'></span>throw]</a>, <a href='propagation' title='17.9.7&emsp;Exception propagation'>[propagation]</a>),
it is considered uncaught from the point of rethrow
until the rethrown exception is caught<a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-5'>5</a></i>:&ensp;<div id='7.sentence-2' class='sentence'>The function <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>uncaught_<span class='shy'></span>exceptions</span> (<a href='uncaught.exceptions' title='17.9.6&emsp;uncaught_&shy;exceptions'>[uncaught.<span class='shy'></span>exceptions]</a>)
returns the number of uncaught exceptions in the current thread<a class='hidden_link' href='#7.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L339'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'><a class='index' id=':exception_handling,rethrow'></a>An exception is considered caught when a handler for that exception
becomes <a href='except.handle#def:exception_handling,handler,active' title='14.4&emsp;Handling an exception&emsp;[except.handle]'>active</a><a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='note-6' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-6'>6</a></i>:&ensp;<div id='8.sentence-2' class='sentence'>An exception can have active handlers and still be considered uncaught if
it is rethrown<a class='hidden_link' href='#8.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2d59c792e2a0228e77a0316d39bde9e51f31d146/source/exceptions.tex#L349'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'><a class='index' id=':exception_handling,terminate_called'></a><a class='index' id=':terminate,called'></a>If the exception handling mechanism
handling an uncaught exception
directly invokes a function that exits via an
exception, the function <a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function&emsp;[except.terminate]'><span class='texttt'>std&#x200b;::&#x200b;terminate</span></a> is invoked<a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> C <span class='curlybracket'>{</span>
  C<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
  C<span class='parenthesis'>(</span><span class='keyword'>const</span> C<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>std<span class='operator'>::</span>uncaught_exceptions<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>throw</span> <span class='literal'>0</span>;      <span class='comment'>// throw during copy to handler's <a href='except.pre#nt:exception-declaration' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:exception-declaration_'><span class='textsf'><i >exception-declaration</i></span></span></a> object (<a href='except.handle' title='14.4&emsp;Handling an exception'>[except.<span class='shy'></span>handle]</a>)</span>
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>int</span> main<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>try</span> <span class='curlybracket'>{</span>
    <span class='keyword'>throw</span> C<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;      <span class='comment'>// calls <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;terminate</span> if construction of the handler's</span>
                    <span class='comment'>// <a href='except.pre#nt:exception-declaration' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:exception-declaration__'><span class='textsf'><i >exception-declaration</i></span></span></a> object is not elided (<a href='class.copy.elision' title='11.9.6&emsp;Copy/move elision'>[class.<span class='shy'></span>copy.<span class='shy'></span>elision]</a>)</span>
  <span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span>C<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div> <div id='note-7' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-7'>7</a></i>:&ensp;<div id='9.sentence-2' class='sentence'>If a destructor directly invoked by stack unwinding exits via an exception,
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>terminate</span> is invoked<a class='hidden_link' href='#9.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></body></html>