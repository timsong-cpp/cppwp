<!DOCTYPE html><html lang='en'><head><title>[expr.prim.lambda.capture]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>7</a> Expressions <a class='abbr_ref' href='./#expr'>[expr]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>7.5</a> Primary expressions <a class='abbr_ref' href='expr.prim#lambda.capture'>[expr.prim]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>7.5.5</a> Lambda expressions <a class='abbr_ref' href='expr.prim.lambda#capture'>[expr.prim.lambda]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>7.5.5.2</a> Captures <a class='abbr_ref'>[expr.prim.lambda.capture]</a></h4><pre class='bnf'><a class='nontermdef' href='#nt:lambda-capture' id='nt:lambda-capture'>lambda-capture:</a>
&#9;<a class='grammarterm' href='#nt:capture-default'>capture-default</a>
&#9;<a class='grammarterm' href='#nt:capture-list'>capture-list</a>
&#9;<a class='grammarterm' href='#nt:capture-default'>capture-default</a> <span class='terminal'>,</span> <a class='grammarterm' href='#nt:capture-list'>capture-list</a>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:capture-default' id='nt:capture-default'>capture-default:</a>
&#9;<span class='terminal'><span class='operator'>&amp;</span></span>
&#9;<span class='terminal'><span class='operator'>=</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:capture-list' id='nt:capture-list'>capture-list:</a>
&#9;<a class='grammarterm' href='#nt:capture'>capture</a>
&#9;<a class='grammarterm' href='#nt:capture-list'>capture-list</a> <span class='terminal'>,</span> <a class='grammarterm' href='#nt:capture'>capture</a>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:capture' id='nt:capture'>capture:</a>
&#9;<a class='grammarterm' href='#nt:simple-capture'>simple-capture</a>
&#9;<a class='grammarterm' href='#nt:init-capture'>init-capture</a>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:simple-capture' id='nt:simple-capture'>simple-capture:</a>
&#9;<a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <span class='terminal'><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>
&#9;<span class='terminal'><span class='operator'>&amp;</span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <span class='terminal'><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>
&#9;<span class='texttt'><span class='keyword'>this</span></span><span class='indexparent'><a class='index' id=':this'></a></span>
&#9;<span class='terminal'><span class='operator'>*</span></span> <span class='terminal'><span class='keyword'>this</span></span>
</pre><pre class='bnf'><a class='nontermdef' href='#nt:init-capture' id='nt:init-capture'>init-capture:</a>
&#9;<span class='terminal'><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a>
&#9;<span class='terminal'><span class='operator'>&amp;</span></span> <span class='terminal'><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a>
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L1969'>#</a></div><div id='1.sentence-1' class='sentence'>The body of a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> may refer to variables
with automatic storage duration and the <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> object (if any)
of enclosing block scopes by capturing those entities, as described
below<a class='hidden_link' href='#1.sentence-1'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L1975'>#</a></div><div id='2.sentence-1' class='sentence'>If a <a class='grammarterm' href='#nt:lambda-capture'>lambda-capture</a> includes a <a class='grammarterm' href='#nt:capture-default'>capture-default</a> that
is <span class='texttt'><span class='operator'>&amp;</span></span>, no identifier in a <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a> of that
<a class='grammarterm' href='#nt:lambda-capture'>lambda-capture</a> shall be preceded
by <span class='texttt'><span class='operator'>&amp;</span></span><a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>If a <a class='grammarterm' href='#nt:lambda-capture'>lambda-capture</a> includes a
<a class='grammarterm' href='#nt:capture-default'>capture-default</a> that is <span class='texttt'><span class='operator'>=</span></span>, each
<a class='grammarterm' href='#nt:simple-capture'>simple-capture</a> of that <a class='grammarterm' href='#nt:lambda-capture'>lambda-capture</a> shall
be of the form
“<span class='texttt'><span class='operator'>&amp;</span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <span class='texttt'><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span>”,
“<span class='texttt'><span class='keyword'>this</span></span>”,
or “<span class='texttt'><span class='operator'>*</span> <span class='keyword'>this</span></span>”<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.note-1' class='note'>[&nbsp;<a class='note_link' href='#2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='2.sentence-3' class='sentence'>The form <span class='texttt'><span class='squarebracket'>[</span><span class='operator'>&amp;</span>,<span class='keyword'>this</span><span class='squarebracket'>]</span></span> is redundant but accepted
for compatibility with ISO C++ 2014<a class='hidden_link' href='#2.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='2.sentence-4' class='sentence'>
Ignoring appearances in
<a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a><span class='textit'>s</span> of <a class='grammarterm' href='#nt:init-capture'>init-capture</a><span class='textit'>s</span>, an identifier or
<span class='texttt'><span class='keyword'>this</span></span> shall not appear more than once in a
<a class='grammarterm' href='#nt:lambda-capture'>lambda-capture</a><a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.example-1' class='example'>[&nbsp;<a class='example_link' href='#2.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>struct</span> S2 <span class='curlybracket'>{</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>void</span> S2<span class='operator'>::</span>f<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;        <span class='comment'>// OK</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, <span class='keyword'>this</span>, i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;  <span class='comment'>// OK, equivalent to <span class='tcode_in_codeblock'>[&amp;, i]</span></span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, <span class='operator'>&amp;</span>i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;       <span class='comment'>// error: <span class='tcode_in_codeblock'>i</span> preceded by <span class='tcode_in_codeblock'>&amp;</span> when <span class='tcode_in_codeblock'>&amp;</span> is the default</span>
  <span class='squarebracket'>[</span><span class='operator'>=</span>, <span class='operator'>*</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;    <span class='comment'>// OK</span>
  <span class='squarebracket'>[</span><span class='operator'>=</span>, <span class='keyword'>this</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;     <span class='comment'>// OK, equivalent to <span class='tcode_in_codeblock'>[=]</span></span>
  <span class='squarebracket'>[</span>i, i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;        <span class='comment'>// error: <span class='tcode_in_codeblock'>i</span> repeated</span>
  <span class='squarebracket'>[</span><span class='keyword'>this</span>, <span class='operator'>*</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='curlybracket'>}</span>; <span class='comment'>// error: <span class='tcode_in_codeblock'>this</span> appears twice</span>
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2009'>#</a></div><div id='3.sentence-1' class='sentence'>A <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> shall not have
a <a class='grammarterm' href='#nt:capture-default'>capture-default</a> or <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a>
in its <a class='grammarterm' href='expr.prim.lambda#nt:lambda-introducer'>lambda-introducer</a>
unless its innermost enclosing scope is a block scope (<a href='basic.scope.block'>[basic.scope.block]</a>)
or it appears within a default member initializer
and its innermost enclosing scope is
the corresponding class scope (<a href='basic.scope.class'>[basic.scope.class]</a>)<a class='hidden_link' href='#3.sentence-1'>.</a></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2018'>#</a></div><div id='4.sentence-1' class='sentence'>The <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> in a <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a> is looked up using the
usual rules for <a href='basic.lookup.unqual'>unqualified name lookup</a>; each such lookup
shall find a local entity<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>The <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a><span class='textit'>s</span> <span class='texttt'><span class='keyword'>this</span></span> and <span class='texttt'><span class='operator'>*</span> <span class='keyword'>this</span></span>
denote the local entity <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>An entity that is designated by a
<a class='grammarterm' href='#nt:simple-capture'>simple-capture</a>
is said to be <a class='hidden_link' href='#def:explicitly_captured' id='def:explicitly_captured'><i >explicitly captured</i></a><a class='hidden_link' href='#4.sentence-3'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2028'>#</a></div><div id='5.sentence-1' class='sentence'>If an <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> in a <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a> appears
as the <a class='grammarterm' href='dcl.decl#nt:declarator-id'>declarator-id</a> of a parameter of
the <a class='grammarterm' href='expr.prim.lambda#nt:lambda-declarator'>lambda-declarator</a>'s <a class='grammarterm' href='dcl.fct#nt:parameter-declaration-clause'>parameter-declaration-clause</a>,
the program is ill-formed<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.example-1' class='example'>[&nbsp;<a class='example_link' href='#5.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>0</span>;
  <span class='keyword'>auto</span> g <span class='operator'>=</span> <span class='squarebracket'>[</span>x<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span> x<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span>;    <span class='comment'>// error: parameter and <span class='grammarterm'>simple-capture</span> have the same name</span>
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2042'>#</a></div><div id='6.sentence-1' class='sentence'>An <a class='grammarterm' href='#nt:init-capture'>init-capture</a> without ellipsis
behaves as if it declares and explicitly captures a
variable of
the form “<span class='texttt'><span class='keyword'>auto</span></span> <a class='grammarterm' href='#nt:init-capture'>init-capture</a> <span class='texttt'>;</span>”
whose declarative region is the <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>'s
<a class='grammarterm' href='stmt.block#nt:compound-statement'>compound-statement</a>, except that:
<ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.1'>(6.1)</a></div>if the capture is by copy (see below), the non-static data member
declared for the capture and the variable are treated as two different ways
of referring to the same object, which has the lifetime of the non-static
data member, and no additional copy and destruction is performed, and</li><li id='6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.2'>(6.2)</a></div>if the capture is by reference, the variable's lifetime ends when the
closure object's lifetime ends<a class='hidden_link' href='#6.sentence-1'>.</a></li></ul></div> <div id='6.note-1' class='note'>[&nbsp;<a class='note_link' href='#6.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='6.sentence-2' class='sentence'>This enables an <a class='grammarterm' href='#nt:init-capture'>init-capture</a> like
“<span class='texttt'>x <span class='operator'>=</span> std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span></span>”; the second “<span class='texttt'>x</span>” must bind to a
declaration in the surrounding context<a class='hidden_link' href='#6.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='6.example-1' class='example'>[&nbsp;<a class='example_link' href='#6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>4</span>;
<span class='keyword'>auto</span> y <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>r <span class='operator'>=</span> x, x <span class='operator'>=</span> x<span class='operator'>+</span><span class='literal'>1</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='keyword'>int</span> <span class='curlybracket'>{</span>
            r <span class='operator'>+</span><span class='operator'>=</span> <span class='literal'>2</span>;
            <span class='keyword'>return</span> x<span class='operator'>+</span><span class='literal'>2</span>;
         <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                               <span class='comment'>// Updates <span class='tcode_in_codeblock'>&#x200b;::&#x200b;x</span> to 6, and initializes <span class='tcode_in_codeblock'>y</span> to 7.</span>

<span class='keyword'>auto</span> z <span class='operator'>=</span> <span class='squarebracket'>[</span>a <span class='operator'>=</span> <span class='literal'>42</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>1</span>; <span class='curlybracket'>}</span>;     <span class='comment'>// error: parameter and local variable have the same name</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2074'>#</a></div><div id='7.sentence-1' class='sentence'>For the purposes of lambda capture,
an expression potentially references local entities as follows:</div><ul class='itemize'><li id='7.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.1'>(7.1)</a></div><div id='7.1.sentence-1' class='sentence'>An <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> that names a local entity
potentially references that entity;
an <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> that names
one or more non-static class members
and does not form a pointer to member (<a href='expr.unary.op'>[expr.unary.op]</a>)
potentially references <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#7.1.sentence-1'>.</a></div> <div id='7.1.note-1' class='note'>[&nbsp;<a class='note_link' href='#7.1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='7.1.sentence-2' class='sentence'>This occurs even if overload resolution
selects a static member function for the <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a><a class='hidden_link' href='#7.1.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </li><li id='7.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.2'>(7.2)</a></div><div id='7.2.sentence-1' class='sentence'>A <span class='texttt'><span class='keyword'>this</span></span> expression potentially references <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#7.2.sentence-1'>.</a></div></li><li id='7.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.3'>(7.3)</a></div><div id='7.3.sentence-1' class='sentence'>A <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> potentially references
the local entities named by its <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a><span class='textit'>s</span><a class='hidden_link' href='#7.3.sentence-1'>.</a></div></li></ul><div id='7.sentence-2' class='sentence'>If an expression potentially references a local entity
within a declarative region in which it is odr-usable,
and the expression would be potentially evaluated
if the effect of any enclosing <span class='texttt'><span class='keyword'>typeid</span></span> expressions (<a href='expr.typeid'>[expr.typeid]</a>) were ignored,
the entity is said to be <a class='hidden_link' href='#def:capture,implicit' id='def:capture,implicit'><i >implicitly captured</i></a>
by each intervening <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> with an associated
<a class='grammarterm' href='#nt:capture-default'>capture-default</a> that does not explicitly capture it<a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='7.sentence-3' class='sentence'>The implicit capture of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> is deprecated when the
<a class='grammarterm' href='#nt:capture-default'>capture-default</a> is <span class='texttt'><span class='operator'>=</span></span>; see <a href='depr.capture.this'>[depr.capture.this]</a><a class='hidden_link' href='#7.sentence-3'>.</a></div> <div id='7.example-1' class='example'>[&nbsp;<a class='example_link' href='#7.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span>, <span class='keyword'>const</span> <span class='keyword'>int</span> <span class='parenthesis'>(</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span><span class='squarebracket'>[</span><span class='literal'>2</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;         <span class='comment'>// #1</span>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>int</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>int</span> <span class='parenthesis'>(</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span><span class='squarebracket'>[</span><span class='literal'>1</span><span class='squarebracket'>]</span><span class='parenthesis'>)</span>;       <span class='comment'>// #2</span>
<span class='keyword'>void</span> test<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>17</span>;
  <span class='keyword'>auto</span> g <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    f<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>;                       <span class='comment'>// OK: calls #1, does not capture <span class='tcode_in_codeblock'>x</span></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>auto</span> g1 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    f<span class='parenthesis'>(</span>x<span class='parenthesis'>)</span>;                       <span class='comment'>// OK: calls #1, captures <span class='tcode_in_codeblock'>x</span></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>auto</span> g2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>int</span> selector<span class='squarebracket'>[</span><span class='keyword'>sizeof</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span> <span class='operator'>?</span> <span class='literal'>1</span> <span class='operator'>:</span> <span class='literal'>2</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
    f<span class='parenthesis'>(</span>x, selector<span class='parenthesis'>)</span>;             <span class='comment'>// OK: captures <span class='tcode_in_codeblock'>x</span>, might call #1 or #2</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>auto</span> g3 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>typeid</span><span class='parenthesis'>(</span>a <span class='operator'>+</span> x<span class='parenthesis'>)</span>;              <span class='comment'>// captures <span class='tcode_in_codeblock'>x</span> regardless of whether <span class='tcode_in_codeblock'>a + x</span> is an unevaluated operand</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</pre> <div id='7.sentence-4' class='sentence'>
Within <span class='texttt'>g1</span>, an implementation might optimize away
the capture of <span class='texttt'>x</span> as it is not odr-used<a class='hidden_link' href='#7.sentence-4'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  <div id='7.note-2' class='note'>[&nbsp;<a class='note_link' href='#7.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='7.sentence-5' class='sentence'>The set of captured entities is determined syntactically,
and entities might be implicitly captured
even if the expression denoting a local entity
is within a discarded statement (<a href='stmt.if'>[stmt.if]</a>)<a class='hidden_link' href='#7.sentence-5'>.</a></div> <div id='7.example-2' class='example'>[&nbsp;<a class='example_link' href='#7.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span> B<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span> n<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span>B <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>sizeof</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span> <span class='anglebracket'>&gt;</span> <span class='literal'>4</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>)</span>n;                  <span class='comment'>// captures <span class='tcode_in_codeblock'>n</span> regardless of the value of <span class='tcode_in_codeblock'>B</span> and <span class='tcode_in_codeblock'>sizeof(int)</span></span>
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2154'>#</a></div><div id='8.sentence-1' class='sentence'>An entity is <a class='hidden_link' href='#def:captured' id='def:captured'><i >captured</i></a> if it is captured explicitly or implicitly<a class='hidden_link' href='#8.sentence-1'>.</a></div> <div id='8.sentence-2' class='sentence'>An entity
captured by a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> is odr-used (<a href='basic.def.odr'>[basic.def.odr]</a>) in the scope
containing the <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a><a class='hidden_link' href='#8.sentence-2'>.</a></div> <div id='8.note-1' class='note'>[&nbsp;<a class='note_link' href='#8.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='8.sentence-3' class='sentence'>As a consequence, if a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>
explicitly captures an entity that is not odr-usable,
the program is ill-formed (<a href='basic.def.odr'>[basic.def.odr]</a>)<a class='hidden_link' href='#8.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='8.example-1' class='example'>[&nbsp;<a class='example_link' href='#8.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <span class='indexparent'><a class='index' id=':Bond,James_Bond'></a></span><pre class='codeblock'>
<span class='keyword'>void</span> f1<span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> <span class='keyword'>const</span> N <span class='operator'>=</span> <span class='literal'>20</span>;
  <span class='keyword'>auto</span> m1 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span>
    <span class='keyword'>int</span> <span class='keyword'>const</span> M <span class='operator'>=</span> <span class='literal'>30</span>;
    <span class='keyword'>auto</span> m2 <span class='operator'>=</span> <span class='squarebracket'>[</span>i<span class='squarebracket'>]</span><span class='curlybracket'>{</span>
      <span class='keyword'>int</span> x<span class='squarebracket'>[</span>N<span class='squarebracket'>]</span><span class='squarebracket'>[</span>M<span class='squarebracket'>]</span>;          <span class='comment'>// OK: <span class='tcode_in_codeblock'>N</span> and <span class='tcode_in_codeblock'>M</span> are not odr-used</span>
      x<span class='squarebracket'>[</span><span class='literal'>0</span><span class='squarebracket'>]</span><span class='squarebracket'>[</span><span class='literal'>0</span><span class='squarebracket'>]</span> <span class='operator'>=</span> i;          <span class='comment'>// OK: <span class='tcode_in_codeblock'>i</span> is explicitly captured by <span class='tcode_in_codeblock'>m2</span> and implicitly captured by <span class='tcode_in_codeblock'>m1</span></span>
    <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
  <span class='keyword'>struct</span> s1 <span class='curlybracket'>{</span>
    <span class='keyword'>int</span> f;
    <span class='keyword'>void</span> work<span class='parenthesis'>(</span><span class='keyword'>int</span> n<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>int</span> m <span class='operator'>=</span> n<span class='operator'>*</span>n;
      <span class='keyword'>int</span> j <span class='operator'>=</span> <span class='literal'>40</span>;
      <span class='keyword'>auto</span> m3 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='keyword'>this</span>,m<span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span> m4 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>,j<span class='squarebracket'>]</span> <span class='curlybracket'>{</span>   <span class='comment'>// error: <span class='tcode_in_codeblock'>j</span> not odr-usable due to intervening lambda <span class='tcode_in_codeblock'>m3</span></span>
          <span class='keyword'>int</span> x <span class='operator'>=</span> n;        <span class='comment'>// error: <span class='tcode_in_codeblock'>n</span> is odr-used but not odr-usable due to intervening lambda <span class='tcode_in_codeblock'>m3</span></span>
          x <span class='operator'>+</span><span class='operator'>=</span> m;           <span class='comment'>// OK: <span class='tcode_in_codeblock'>m</span> implicitly captured by <span class='tcode_in_codeblock'>m4</span> and explicitly captured by <span class='tcode_in_codeblock'>m3</span></span>
          x <span class='operator'>+</span><span class='operator'>=</span> i;           <span class='comment'>// error: <span class='tcode_in_codeblock'>i</span> is odr-used but not odr-usable</span>
                            <span class='comment'>// due to intervening function and class scopes</span>
          x <span class='operator'>+</span><span class='operator'>=</span> f;           <span class='comment'>// OK: <span class='tcode_in_codeblock'>this</span> captured implicitly by <span class='tcode_in_codeblock'>m4</span> and explicitly by <span class='tcode_in_codeblock'>m3</span></span>
        <span class='curlybracket'>}</span>;
      <span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>struct</span> s2 <span class='curlybracket'>{</span>
  <span class='keyword'>double</span> ohseven <span class='operator'>=</span> <span class='literal'>.007</span>;
  <span class='keyword'>auto</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>*</span><span class='keyword'>this</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> ohseven;       <span class='comment'>// OK</span>
      <span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
  <span class='keyword'>auto</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>*</span><span class='keyword'>this</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;   <span class='comment'>// error: <span class='tcode_in_codeblock'>*this</span> not captured by outer <span class='grammarterm'>lambda-expression</span></span>
    <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2211'>#</a></div><div id='9.note-1' class='note'>[&nbsp;<a class='note_link' href='#9.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='9.sentence-1' class='sentence'>Because local entities are not
odr-usable within a default argument (<a href='basic.def.odr'>[basic.def.odr]</a>),
a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> appearing in a default argument
cannot implicitly or explicitly capture any local entity<a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='9.sentence-2' class='sentence'>Such a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>
can still have an <a class='grammarterm' href='#nt:init-capture'>init-capture</a> if
any full-expression in its <a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a>
satisfies the constraints of an expression appearing in
a default argument (<a href='dcl.fct.default'>[dcl.fct.default]</a>)<a class='hidden_link' href='#9.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='9.example-1' class='example'>[&nbsp;<a class='example_link' href='#9.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> f2<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i <span class='operator'>=</span> <span class='literal'>1</span>;
  <span class='keyword'>void</span> g1<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span>i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> i; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;          <span class='comment'>// error</span>
  <span class='keyword'>void</span> g2<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span>i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;          <span class='comment'>// error</span>
  <span class='keyword'>void</span> g3<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> i; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;          <span class='comment'>// error</span>
  <span class='keyword'>void</span> g4<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;          <span class='comment'>// OK</span>
  <span class='keyword'>void</span> g5<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='keyword'>sizeof</span> i; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// OK</span>
  <span class='keyword'>void</span> g6<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span>x<span class='operator'>=</span><span class='literal'>1</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> x; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;        <span class='comment'>// OK</span>
  <span class='keyword'>void</span> g7<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='squarebracket'>[</span>x<span class='operator'>=</span>i<span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> x; <span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;        <span class='comment'>// error</span>
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2238'>#</a></div><div id='10.sentence-1' class='sentence'>An entity is <a class='hidden_link' href='#def:captured,by_copy' id='def:captured,by_copy'><i >captured by copy</i></a> if
<ul class='itemize'><li id='10.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.1'>(10.1)</a></div>it is implicitly captured,
the <a class='grammarterm' href='#nt:capture-default'>capture-default</a> is <span class='texttt'><span class='operator'>=</span></span>, and
the captured entity is not <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>, or</li><li id='10.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#10.2'>(10.2)</a></div>it is explicitly captured with a capture that is not of the form
<span class='texttt'><span class='keyword'>this</span></span>,
<span class='texttt'><span class='operator'>&amp;</span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a>, or
<span class='texttt'><span class='operator'>&amp;</span></span> <a class='grammarterm' href='lex.name#nt:identifier'>identifier</a> <a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a><a class='hidden_link' href='#10.sentence-1'>.</a></li></ul></div> <div id='10.sentence-2' class='sentence'>
For each entity captured by copy, an
unnamed non-static data member is declared in the closure type<a class='hidden_link' href='#10.sentence-2'>.</a></div> <div id='10.sentence-3' class='sentence'>The declaration order of
these members is unspecified<a class='hidden_link' href='#10.sentence-3'>.</a></div> <div id='10.sentence-4' class='sentence'>The type of such a data member is
the referenced type if the entity is a reference to an object,
an lvalue reference to the referenced function type if the entity is a reference to a function, or
the type of the corresponding captured entity otherwise<a class='hidden_link' href='#10.sentence-4'>.</a></div> <div id='10.sentence-5' class='sentence'>A member of an anonymous union shall not be captured by copy<a class='hidden_link' href='#10.sentence-5'>.</a></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2259'>#</a></div><div id='11.sentence-1' class='sentence'>Every <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> within the <a class='grammarterm' href='stmt.block#nt:compound-statement'>compound-statement</a> of a
<a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> that is an <a href='basic.def.odr'>odr-use</a> of an
entity captured by copy is transformed into an access to the corresponding unnamed data
member of the closure type<a class='hidden_link' href='#11.sentence-1'>.</a></div> <div id='11.note-1' class='note'>[&nbsp;<a class='note_link' href='#11.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='11.sentence-2' class='sentence'>An <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> that is not an odr-use refers to
the original entity, never to a member of the closure type<a class='hidden_link' href='#11.sentence-2'>.</a></div> <div id='11.sentence-3' class='sentence'>However, such
an <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> can still cause the implicit capture of the
entity<a class='hidden_link' href='#11.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='11.sentence-4' class='sentence'>
If <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> is captured by copy, each expression that odr-uses <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> is
transformed to instead refer to the corresponding unnamed data member of the closure type<a class='hidden_link' href='#11.sentence-4'>.</a></div> <div id='11.example-1' class='example'>[&nbsp;<a class='example_link' href='#11.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>int</span><span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>const</span> <span class='keyword'>int</span> N <span class='operator'>=</span> <span class='literal'>10</span>;
  <span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
    <span class='keyword'>int</span> arr<span class='squarebracket'>[</span>N<span class='squarebracket'>]</span>;     <span class='comment'>// OK: not an odr-use, refers to automatic variable</span>
    f<span class='parenthesis'>(</span><span class='operator'>&amp;</span>N<span class='parenthesis'>)</span>;          <span class='comment'>// OK: causes <span class='tcode_in_codeblock'>N</span> to be captured; <span class='tcode_in_codeblock'>&amp;N</span> points to</span>
                    <span class='comment'>// the corresponding member of the closure type</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2287'>#</a></div><div id='12.sentence-1' class='sentence'>An entity is <a class='hidden_link' href='#def:captured,by_reference' id='def:captured,by_reference'><i >captured by reference</i></a> if it is implicitly or explicitly
captured but not captured by copy<a class='hidden_link' href='#12.sentence-1'>.</a></div> <div id='12.sentence-2' class='sentence'>It is unspecified whether additional unnamed
non-static data members are declared in the closure type for entities captured by
reference<a class='hidden_link' href='#12.sentence-2'>.</a></div> <div id='12.sentence-3' class='sentence'>If declared, such non-static data members shall be of literal type<a class='hidden_link' href='#12.sentence-3'>.</a></div> <div id='12.example-1' class='example'>[&nbsp;<a class='example_link' href='#12.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='comment'>// The inner closure type must be a literal type regardless of how reference captures are represented.</span>
<span class='keyword'>static_assert</span><span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span> n<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>n<span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='operator'>+</span><span class='operator'>+</span>n; <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='literal'>3</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>4</span><span class='parenthesis'>)</span>;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  <div id='12.sentence-4' class='sentence'>
A bit-field or a member of an anonymous union
shall not be captured by reference<a class='hidden_link' href='#12.sentence-4'>.</a></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2302'>#</a></div><div id='13.sentence-1' class='sentence'>An <a class='grammarterm' href='expr.prim.id#nt:id-expression'>id-expression</a> within
the <a class='grammarterm' href='stmt.block#nt:compound-statement'>compound-statement</a> of a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>
that is an odr-use of a reference captured by reference
refers to the entity to which the captured reference is bound and
not to the captured reference<a class='hidden_link' href='#13.sentence-1'>.</a></div> <div id='13.note-1' class='note'>[&nbsp;<a class='note_link' href='#13.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='13.sentence-2' class='sentence'>The validity of such captures is determined by
the lifetime of the object to which the reference refers,
not by the lifetime of the reference itself<a class='hidden_link' href='#13.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='13.example-1' class='example'>[&nbsp;<a class='example_link' href='#13.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>auto</span> h<span class='parenthesis'>(</span><span class='keyword'>int</span> <span class='operator'>&amp;</span>r<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
    <span class='operator'>+</span><span class='operator'>+</span>r;            <span class='comment'>// Valid after <span class='tcode_in_codeblock'>h</span> returns if the lifetime of the</span>
                    <span class='comment'>// object to which <span class='tcode_in_codeblock'>r</span> is bound has not ended</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2324'>#</a></div><div id='14.sentence-1' class='sentence'>If a <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> <span class='texttt'>m2</span> captures an entity and that entity is
captured by an immediately enclosing <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>
<span class='texttt'>m1</span>, then
<span class='texttt'>m2</span>'s capture is transformed as follows:
<ul class='itemize'><li id='14.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.1'>(14.1)</a></div>if <span class='texttt'>m1</span> captures the entity by copy,
<span class='texttt'>m2</span> captures the corresponding
non-static data member of <span class='texttt'>m1</span>'s closure type;</li><li id='14.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#14.2'>(14.2)</a></div>if <span class='texttt'>m1</span> captures the entity by reference,
<span class='texttt'>m2</span> captures the same
entity captured by <span class='texttt'>m1</span><a class='hidden_link' href='#14.sentence-1'>.</a></li></ul></div> <div id='14.example-1' class='example'>[&nbsp;<a class='example_link' href='#14.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='14.sentence-2' class='sentence'>The nested <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>s and invocations below will output
<span class='texttt'><span class='literal'>123234</span></span><a class='hidden_link' href='#14.sentence-2'>.</a></div> <pre class='codeblock'>
<span class='keyword'>int</span> a <span class='operator'>=</span> <span class='literal'>1</span>, b <span class='operator'>=</span> <span class='literal'>1</span>, c <span class='operator'>=</span> <span class='literal'>1</span>;
<span class='keyword'>auto</span> m1 <span class='operator'>=</span> <span class='squarebracket'>[</span>a, <span class='operator'>&amp;</span>b, <span class='operator'>&amp;</span>c<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> m2 <span class='operator'>=</span> <span class='squarebracket'>[</span>a, b, <span class='operator'>&amp;</span>c<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='curlybracket'>{</span>
    std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> a <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> b <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> c;
    a <span class='operator'>=</span> <span class='literal'>4</span>; b <span class='operator'>=</span> <span class='literal'>4</span>; c <span class='operator'>=</span> <span class='literal'>4</span>;
  <span class='curlybracket'>}</span>;
  a <span class='operator'>=</span> <span class='literal'>3</span>; b <span class='operator'>=</span> <span class='literal'>3</span>; c <span class='operator'>=</span> <span class='literal'>3</span>;
  m2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
a <span class='operator'>=</span> <span class='literal'>2</span>; b <span class='operator'>=</span> <span class='literal'>2</span>; c <span class='operator'>=</span> <span class='literal'>2</span>;
m1<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> a <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> b <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> c;
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2356'>#</a></div><div id='15.sentence-1' class='sentence'>When the <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a> is evaluated, the entities that are
captured by copy are used to direct-initialize each corresponding non-static data member
of the resulting closure object, and the non-static data members corresponding to the
<a class='grammarterm' href='#nt:init-capture'>init-capture</a><span class='textit'>s</span> are initialized as indicated by the corresponding
<a class='grammarterm' href='dcl.init#nt:initializer'>initializer</a> (which may be copy- or direct-initialization)<a class='hidden_link' href='#15.sentence-1'>.</a></div> <div id='15.sentence-2' class='sentence'>(For array members, the array elements are
direct-initialized in increasing subscript order<a class='hidden_link' href='#15.sentence-2'>.</a>)</div> <div id='15.sentence-3' class='sentence'>These initializations are performed
in the (unspecified) order in which the non-static data members are declared<a class='hidden_link' href='#15.sentence-3'>.</a></div> <div id='15.note-1' class='note'>[&nbsp;<a class='note_link' href='#15.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='15.sentence-4' class='sentence'>This ensures that the destructions will occur in the reverse order of the constructions<a class='hidden_link' href='#15.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2368'>#</a></div><div id='16.note-1' class='note'>[&nbsp;<a class='note_link' href='#16.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='16.sentence-1' class='sentence'>If a non-reference entity is implicitly or explicitly captured by reference,
invoking the function call operator of the corresponding <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>
after the lifetime of the entity has ended is likely to result in undefined behavior<a class='hidden_link' href='#16.sentence-1'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/8fc95077300d2691f4c5c25fcfd7b15e8987cc67/source/expressions.tex#L2375'>#</a></div><div id='17.sentence-1' class='sentence'>A <a class='grammarterm' href='#nt:simple-capture'>simple-capture</a> containing an ellipsis is a pack
expansion (<a href='temp.variadic'>[temp.variadic]</a>)<a class='hidden_link' href='#17.sentence-1'>.</a></div> <div id='17.sentence-2' class='sentence'><span class='indexparent'><a class='index' id=':init-capture_pack'></a></span>An <a class='grammarterm' href='#nt:init-capture'>init-capture</a> containing an ellipsis is a pack
expansion that introduces an
<a class='grammarterm' href='#nt:init-capture'>init-capture</a> pack (<a href='temp.variadic'>[temp.variadic]</a>)
whose declarative region is
the <a class='grammarterm' href='expr.prim.lambda#nt:lambda-expression'>lambda-expression</a>'s <a class='grammarterm' href='stmt.block#nt:compound-statement'>compound-statement</a><a class='hidden_link' href='#17.sentence-2'>.</a></div> <div id='17.example-1' class='example'>[&nbsp;<a class='example_link' href='#17.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> f<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> lm <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> g<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
  lm<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

  <span class='keyword'>auto</span> lm2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>xs<span class='operator'>=</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> g<span class='parenthesis'>(</span>xs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
  lm2<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div>  </div></div></body></html>