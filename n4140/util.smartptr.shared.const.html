<!DOCTYPE html><html lang='en'><head><title>[util.smartptr.shared.const]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>20</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>20.8</a> Smart pointers <a class='abbr_ref' href='smartptr#util.smartptr.shared.const'>[smartptr]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>20.8.2</a> Shared-ownership pointers <a class='abbr_ref' href='util.smartptr#shared.const'>[util.smartptr]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>20.8.2.2</a> Class template <span class='texttt'>shared_ptr</span> <a class='abbr_ref' href='util.smartptr.shared#const'>[util.smartptr.shared]</a></h4><div id='util.smartptr.shared.const'><h4 ><a class='secnum' style='min-width:133pt'>20.8.2.2.1</a> <span class='texttt'>shared_ptr</span> constructors <a class='abbr_ref'>[util.smartptr.shared.const]</a></h4><p ><span class='indexparent'><a class='index' id='shared_ptr,shared_ptr'></a></span><code class='itemdecl'>
constexpr shared_ptr() noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><p ><i>Effects:</i>  Constructs an <i>empty</i> <span class='texttt'>shared_ptr</span> object.</p></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>use_count() == 0 &amp;&amp; get() == nullptr</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><code class='itemdecl'>
template&lt;class Y&gt; explicit shared_ptr(Y* p);
</code></p><div class='itemdescr'></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><p ><i>Requires:</i>  <span class='texttt'>p</span> shall be convertible to <span class='texttt'>T*</span>.
<span class='texttt'>Y</span> shall be a complete type. The expression <span class='texttt'>delete p</span>
shall be well formed, shall have well defined behavior, and shall not
throw exceptions.</p></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><p ><i>Effects:</i> Constructs a <span class='texttt'>shared_ptr</span> object that <i>owns</i> the pointer
<span class='texttt'>p</span>.</p></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>use_count() == 1 &amp;&amp; get() == p</span>.</p></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><p ><i>Throws:</i> <span class='texttt'>bad_alloc</span>, or an <span class='indexparent'><a class='index' id='exception_type_when_shared_ptr_constructor_fails'></a></span>implementation-defined exception when a resource other than memory could not be obtained.</p></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><p ><i>Exception safety:</i>  If an exception is thrown, <span class='texttt'>delete p</span> is
called.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><code class='itemdecl'>
template&lt;class Y, class D&gt; shared_ptr(Y* p, D d);
template&lt;class Y, class D, class A&gt; shared_ptr(Y* p, D d, A a);
template &lt;class D&gt; shared_ptr(nullptr_t p, D d);
template &lt;class D, class A&gt; shared_ptr(nullptr_t p, D d, A a);
</code></p><div class='itemdescr'></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><p ><i>Requires:</i>  <span class='texttt'>p</span> shall be convertible to <span class='texttt'>T*</span>. <span class='texttt'>D</span> shall be
<span class='texttt'>CopyConstructible</span>. The copy constructor and destructor of <span class='texttt'> D</span>
shall not throw exceptions. The expression <span class='texttt'>d(p)</span> shall be
well formed, shall have well defined behavior, and shall not throw exceptions.
<span class='texttt'>A</span> shall be an allocator (<a href='allocator.requirements'>[allocator.requirements]</a>).
The copy constructor and destructor of <span class='texttt'>A</span> shall not throw exceptions.</p></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><p ><i>Effects:</i>  Constructs a <span class='texttt'>shared_ptr</span> object that <i>owns</i> the
object <span class='texttt'>p</span> and the deleter <span class='texttt'>d</span>.
The second and fourth constructors shall use a copy of <span class='texttt'>a</span> to
allocate memory for internal use.</p></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>use_count() == 1 &amp;&amp; get() == p</span>.</p></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><p ><i>Throws:</i>  <span class='texttt'>bad_alloc</span>, or an <span class='indexparent'><a class='index' id='exception_type_when_shared_ptr_constructor_fails'></a></span>implementation-defined exception
when a resource other than memory could not be obtained.</p></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><p ><i>Exception safety:</i>  If an exception is thrown, <span class='texttt'>d(p)</span> is called.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><code class='itemdecl'>
template&lt;class Y&gt; shared_ptr(const shared_ptr&lt;Y&gt;&amp; r, T* p) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><p ><i>Effects:</i> Constructs a <span class='texttt'>shared_ptr</span> instance that
stores <span class='texttt'>p</span> and <i>shares ownership</i> with <span class='texttt'>r</span>.</p></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><p ><i>Postconditions:</i> <span class='texttt'>get() == p &amp;&amp; use_count() == r.use_count()</span></p></div></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='itemdescr'><p >[&nbsp;<i>Note:</i> To avoid the possibility of a dangling pointer, the
user of this constructor must ensure that <span class='texttt'>p</span> remains valid at
least until the ownership group of <span class='texttt'>r</span> is destroyed. <i>&nbsp;—&nbsp;end note</i>&nbsp;]</p></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='itemdescr'><p >[&nbsp;<i>Note:</i> This constructor allows creation of an <i>empty</i>
<span class='texttt'>shared_ptr</span> instance with a non-null stored pointer. <i>&nbsp;—&nbsp;end note</i>&nbsp;]
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><code class='itemdecl'>
shared_ptr(const shared_ptr&amp; r) noexcept;
template&lt;class Y&gt; shared_ptr(const shared_ptr&lt;Y&gt;&amp; r) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='itemdescr'><p ><i>Remark:</i>
The second constructor shall not participate in overload resolution unless
<span class='texttt'>Y*</span> is implicitly convertible to <span class='texttt'>T*</span>.</p></div></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='itemdescr'><p ><i>Effects:</i>  If <span class='texttt'>r</span> is <i>empty</i>, constructs
an <i>empty</i> <span class='texttt'>shared_ptr</span> object; otherwise, constructs
a <span class='texttt'>shared_ptr</span> object that <i>shares ownership</i> with <span class='texttt'>r</span>.</p></div></div><div class='para' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>get() == r.get() &amp;&amp; use_count() == r.use_count()</span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><code class='itemdecl'>
shared_ptr(shared_ptr&amp;&amp; r) noexcept;
template&lt;class Y&gt; shared_ptr(shared_ptr&lt;Y&gt;&amp;&amp; r) noexcept;
</code></p><div class='itemdescr'></div><div class='para' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='itemdescr'><p ><i>Remark:</i> The second constructor shall not participate in overload resolution unless
<span class='texttt'>Y*</span> is convertible to <span class='texttt'>T*</span>.</p></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='itemdescr'><p ><i>Effects:</i> Move-constructs a <span class='texttt'>shared_ptr</span> instance from
<span class='texttt'>r</span>.</p></div></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='itemdescr'><p ><i>Postconditions:</i> <span class='texttt'>*this</span> shall contain the old value of
<span class='texttt'>r</span>. <span class='texttt'>r</span> shall be <i>empty</i>. <span class='texttt'>r.get() == nullptr.</span>
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><span class='indexparent'><a class='index' id='weak_ptr'></a></span><code class='itemdecl'>
template&lt;class Y&gt; explicit shared_ptr(const weak_ptr&lt;Y&gt;&amp; r);
</code></p><div class='itemdescr'></div><div class='para' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='itemdescr'><p ><i>Requires:</i> <span class='texttt'>Y*</span> shall be convertible to <span class='texttt'>T*</span>.</p></div></div><div class='para' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='itemdescr'><p ><i>Effects:</i>  Constructs a <span class='texttt'>shared_ptr</span> object that <i>shares ownership</i> with
<span class='texttt'>r</span> and stores a copy of the pointer stored in <span class='texttt'>r</span>.</p></div></div><div class='para' id='25'><div class='marginalizedparent'><a class='marginalized' href='#25'>25</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>use_count() == r.use_count()</span>.</p></div></div><div class='para' id='26'><div class='marginalizedparent'><a class='marginalized' href='#26'>26</a></div><div class='itemdescr'><p ><i>Throws:</i>  <span class='texttt'>bad_weak_ptr</span> when <span class='texttt'>r.expired()</span>.</p></div></div><div class='para' id='27'><div class='marginalizedparent'><a class='marginalized' href='#27'>27</a></div><div class='itemdescr'><p ><i>Exception safety:</i>  If an exception is thrown, the constructor has no
effect.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><span class='indexparent'><a class='index' id='auto_ptr'></a></span>
<code class='itemdecl'>
template&lt;class Y&gt; shared_ptr(auto_ptr&lt;Y&gt;&amp;&amp; r);
</code></p><div class='itemdescr'></div><div class='para' id='28'><div class='marginalizedparent'><a class='marginalized' href='#28'>28</a></div><div class='itemdescr'><p ><i>Requires:</i>  <span class='texttt'>r.release()</span> shall be convertible to <span class='texttt'>T*</span>.
<span class='texttt'>Y</span> shall be a complete type. The expression <span class='texttt'>delete
r.release()</span> shall be well formed, shall have well defined behavior,
and shall not throw exceptions.</p></div></div><div class='para' id='29'><div class='marginalizedparent'><a class='marginalized' href='#29'>29</a></div><div class='itemdescr'><p ><i>Effects:</i>  Constructs a <span class='texttt'>shared_ptr</span> object that stores and <i>owns</i>
<span class='texttt'>r.release()</span>.</p></div></div><div class='para' id='30'><div class='marginalizedparent'><a class='marginalized' href='#30'>30</a></div><div class='itemdescr'><p ><i>Postconditions:</i>  <span class='texttt'>use_count() == 1</span> <span class='texttt'>&amp;&amp;</span> <span class='texttt'>r.get() == nullptr</span>.</p></div></div><div class='para' id='31'><div class='marginalizedparent'><a class='marginalized' href='#31'>31</a></div><div class='itemdescr'><p ><i>Throws:</i>  <span class='texttt'>bad_alloc</span>, or an <span class='indexparent'><a class='index' id='exception_type_when_shared_ptr_constructor_fails'></a></span>implementation-defined exception when a
resource other than memory could not be obtained.</p></div></div><div class='para' id='32'><div class='marginalizedparent'><a class='marginalized' href='#32'>32</a></div><div class='itemdescr'><p ><i>Exception safety:</i>  If an exception is thrown, the constructor has no
effect.
</p></div></div><p ><span class='indexparent'><a class='index' id='shared_ptr,constructor'></a></span><span class='indexparent'><a class='index' id='unique_ptr'></a></span><code class='itemdecl'>
template &lt;class Y, class D&gt; shared_ptr(unique_ptr&lt;Y, D&gt;&amp;&amp; r);
</code></p><div class='itemdescr'></div><div class='para' id='33'><div class='marginalizedparent'><a class='marginalized' href='#33'>33</a></div><div class='itemdescr'><p ><i>Effects:</i> Equivalent to <span class='texttt'>shared_ptr(r.release(), r.get_deleter())</span> when
<span class='texttt'>D</span> is not a reference type, otherwise <span class='texttt'>shared_ptr(r.release(),
ref(r.get_deleter()))</span>.</p></div></div><div class='para' id='34'><div class='marginalizedparent'><a class='marginalized' href='#34'>34</a></div><div class='itemdescr'><p ><i>Exception safety:</i> If an exception is thrown, the constructor has no effect.
</p></div></div></div></div></body></html>