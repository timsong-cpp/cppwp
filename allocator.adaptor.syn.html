<!DOCTYPE html><html lang='en'><head><title>[allocator.adaptor.syn]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>20</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>20.13</a> Class template <span class='texttt'>scoped_&shy;allocator_&shy;adaptor</span> <a class='abbr_ref' href='allocator.adaptor#syn'>[allocator.adaptor]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>20.13.1</a> Header <span class='texttt'>&lt;scoped_&shy;allocator&gt;</span> synopsis <a class='abbr_ref'>[allocator.adaptor.syn]</a></h3><span class='indexparent'><a class='index' id=':<scoped_allocator>'></a></span><pre class='codeblock'>
<span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// class template <span class='tcode_in_codeblock'>scoped allocator adaptor</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterAlloc, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> InnerAlloc<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> scoped_allocator_adaptor;

  <span class='comment'>// <a href='scoped.adaptor.operators'>[scoped.adaptor.operators]</a>, scoped allocator operators</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterA1, <span class='keyword'>class</span> OuterA2, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> InnerAllocs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>OuterA1, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> a,
                    <span class='keyword'>const</span> scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>OuterA2, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> b<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9778526cca1fd80fe1d60aacc473e212da5026ef/source/utilities.tex#L12615'>#</a></div><div id='1.sentence-1' class='sentence'>The class template <span class='texttt'>scoped_&shy;allocator_&shy;adaptor</span> is an allocator template that
specifies an allocator resource (the outer allocator) to be used by a container (as any
other allocator does) and also specifies an inner allocator resource to be passed to the
constructor of every element within the container<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>This adaptor is instantiated with one
outer and zero or more inner allocator types<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>If instantiated with only one allocator
type, the inner allocator becomes the <span class='texttt'>scoped_&shy;allocator_&shy;adaptor</span> itself, thus
using the same allocator resource for the container and every element within the
container and, if the elements themselves are containers, each of their elements
recursively<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>If instantiated with more than one allocator, the first allocator is the
outer allocator for use by the container, the second allocator is passed to the
constructors of the container's elements, and, if the elements themselves are
containers, the third allocator is passed to the elements' elements, and so on<a class='hidden_link' href='#1.sentence-4'>.</a></div> <div id='1.sentence-5' class='sentence'>If
containers are nested to a depth greater than the number of allocators, the last
allocator is used repeatedly, as in the single-allocator case, for any remaining
recursions<a class='hidden_link' href='#1.sentence-5'>.</a></div> <div id='1.note-1' class='note'>[&nbsp;<a class='note_link' href='#1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='1.sentence-6' class='sentence'>The <span class='texttt'>scoped_&shy;allocator_&shy;adaptor</span> is derived from the outer
allocator type so it can be substituted for the outer allocator type in most
expressions<a class='hidden_link' href='#1.sentence-6'>.</a></div> â€”&nbsp;<i>end note</i></div>&nbsp;]</div> <span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:outer_allocator_type,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,outer_allocator_type'></a></span><span class='indexparent'><a class='index' id='lib:value_type,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,value_type'></a></span><span class='indexparent'><a class='index' id='lib:size_type,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,size_type'></a></span><span class='indexparent'><a class='index' id='lib:difference_type,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,difference_type'></a></span><span class='indexparent'><a class='index' id='lib:pointer,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,pointer'></a></span><span class='indexparent'><a class='index' id='lib:const_pointer,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,const_pointer'></a></span><span class='indexparent'><a class='index' id='lib:void_pointer,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,void_pointer'></a></span><span class='indexparent'><a class='index' id='lib:const_void_pointer,scoped_allocator_adaptor'></a></span><span class='indexparent'><a class='index' id='lib:scoped_allocator_adaptor,const_void_pointer'></a></span><pre class='codeblock'>
<span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterAlloc, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> InnerAllocs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> scoped_allocator_adaptor <span class='operator'>:</span> <span class='keyword'>public</span> OuterAlloc <span class='curlybracket'>{</span>
  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>using</span> OuterTraits <span class='operator'>=</span> allocator_traits<span class='anglebracket'>&lt;</span>OuterAlloc<span class='anglebracket'>&gt;</span>;   <span class='comment'>// <span class='textit'>exposition only</span></span>
    scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> inner;     <span class='comment'>// <span class='textit'>exposition only</span></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> outer_allocator_type <span class='operator'>=</span> OuterAlloc;
    <span class='keyword'>using</span> inner_allocator_type <span class='operator'>=</span> <span class='textit'><span class='texttt'>see below</span></span>;

    <span class='keyword'>using</span> value_type           <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>value_type;
    <span class='keyword'>using</span> size_type            <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>size_type;
    <span class='keyword'>using</span> difference_type      <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>difference_type;
    <span class='keyword'>using</span> pointer              <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>pointer;
    <span class='keyword'>using</span> const_pointer        <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>const_pointer;
    <span class='keyword'>using</span> void_pointer         <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>void_pointer;
    <span class='keyword'>using</span> const_void_pointer   <span class='operator'>=</span> <span class='keyword'>typename</span> OuterTraits<span class='operator'>::</span>const_void_pointer;

    <span class='keyword'>using</span> propagate_on_container_copy_assignment <span class='operator'>=</span> <span class='textit'><span class='texttt'>see below</span></span>;
    <span class='keyword'>using</span> propagate_on_container_move_assignment <span class='operator'>=</span> <span class='textit'><span class='texttt'>see below</span></span>;
    <span class='keyword'>using</span> propagate_on_container_swap            <span class='operator'>=</span> <span class='textit'><span class='texttt'>see below</span></span>;
    <span class='keyword'>using</span> is_always_equal                        <span class='operator'>=</span> <span class='textit'><span class='texttt'>see below</span></span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tp<span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> rebind <span class='curlybracket'>{</span>
      <span class='keyword'>using</span> other <span class='operator'>=</span> scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>
        OuterTraits<span class='operator'>::</span><span class='keyword'>template</span> rebind_alloc<span class='anglebracket'>&lt;</span>Tp<span class='anglebracket'>&gt;</span>, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
    <span class='curlybracket'>}</span>;

    scoped_allocator_adaptor<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterA2<span class='anglebracket'>&gt;</span>
      scoped_allocator_adaptor<span class='parenthesis'>(</span>OuterA2<span class='operator'>&amp;</span><span class='operator'>&amp;</span> outerAlloc,
                               <span class='keyword'>const</span> InnerAllocs<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> innerAllocs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    scoped_allocator_adaptor<span class='parenthesis'>(</span><span class='keyword'>const</span> scoped_allocator_adaptor<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    scoped_allocator_adaptor<span class='parenthesis'>(</span>scoped_allocator_adaptor<span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterA2<span class='anglebracket'>&gt;</span>
      scoped_allocator_adaptor<span class='parenthesis'>(</span>
        <span class='keyword'>const</span> scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>OuterA2, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterA2<span class='anglebracket'>&gt;</span>
      scoped_allocator_adaptor<span class='parenthesis'>(</span>
        scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>OuterA2, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    scoped_allocator_adaptor<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> scoped_allocator_adaptor<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
    scoped_allocator_adaptor<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>scoped_allocator_adaptor<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

    <span class='operator'>~</span>scoped_allocator_adaptor<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    inner_allocator_type<span class='operator'>&amp;</span> inner_allocator<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>const</span> inner_allocator_type<span class='operator'>&amp;</span> inner_allocator<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    outer_allocator_type<span class='operator'>&amp;</span> outer_allocator<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>const</span> outer_allocator_type<span class='operator'>&amp;</span> outer_allocator<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> pointer allocate<span class='parenthesis'>(</span>size_type n<span class='parenthesis'>)</span>;
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> pointer allocate<span class='parenthesis'>(</span>size_type n, const_void_pointer hint<span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> deallocate<span class='parenthesis'>(</span>pointer p, size_type n<span class='parenthesis'>)</span>;
    size_type max_size<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> construct<span class='parenthesis'>(</span>T<span class='operator'>*</span> p, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
      <span class='keyword'>void</span> destroy<span class='parenthesis'>(</span>T<span class='operator'>*</span> p<span class='parenthesis'>)</span>;

    scoped_allocator_adaptor select_on_container_copy_construction<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> OuterAlloc, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> InnerAllocs<span class='anglebracket'>&gt;</span>
    scoped_allocator_adaptor<span class='parenthesis'>(</span>OuterAlloc, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> scoped_allocator_adaptor<span class='anglebracket'>&lt;</span>OuterAlloc, InnerAllocs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</pre></div></div></body></html>