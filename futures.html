<!DOCTYPE html><html lang='en'><head><title>[futures]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Concurrency support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>33.10</a> Futures <a class='abbr_ref'>[futures]</a></h2><div id='overview' class='section'><h3 ><a class='secnum' href='#overview' style='min-width:80pt'>33.10.1</a> Overview <a class='abbr_ref' href='futures.overview'>[futures.overview]</a></h3><div class='para' id='overview-1'><div class='marginalizedparent'><a class='marginalized' href='#overview-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9872'>#</a></div><div class='texpara'><div id='overview-1.sentence-1' class='sentence'>[futures] describes components that a C++ program can use to retrieve in one thread the
result (value or exception) from a function that has run in the same thread or another thread<a class='hidden_link' href='#overview-1.sentence-1'>.</a></div> <div id='overview-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#overview-note-1'>1</a></i>: <div id='overview-1.sentence-2' class='sentence'>These components are not restricted to multi-threaded programs but can be useful in
single-threaded programs as well<a class='hidden_link' href='#overview-1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div id='future.syn' class='section'><h3 ><a class='secnum' href='#future.syn' style='min-width:80pt'>33.10.2</a> Header <span class='texttt'>&lt;future&gt;</span> synopsis <a class='abbr_ref' href='future.syn'>[future.syn]</a></h3><div class='texpara'><span id='lib:future_errc'><span id='header:<future>'><div class='marginalizedparent'><a class='itemDeclLink' href='#header:%3cfuture%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>enum</span> <span class='keyword'>class</span> future_errc <span class='curlybracket'>{</span>
    broken_promise <span class='operator'>=</span> <a class='index' id=':value_of_future_errc::broken_promise'></a><i >implementation-defined</i>,
    future_already_retrieved <span class='operator'>=</span> <a class='index' id=':value_of_future_errc::future_already_retrieved'></a><i >implementation-defined</i>,
    promise_already_satisfied <span class='operator'>=</span> <a class='index' id=':value_of_future_errc::promise_already_satisfied'></a><i >implementation-defined</i>,
    no_state <span class='operator'>=</span> <a class='index' id=':value_of_future_errc::no_state'></a><i >implementation-defined</i>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>enum</span> <span class='keyword'>class</span> launch <span class='operator'>:</span> <i ><span class='texttt'>unspecified</span></i> <span class='curlybracket'>{</span>
    async <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>,
    deferred <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>,
    <a class='index' id=':last_enumerator_of_launch'></a><i >implementation-defined</i>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>enum</span> <span class='keyword'>class</span> future_status <span class='curlybracket'>{</span>
    ready,
    timeout,
    deferred
  <span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#errors' title='33.10.3&emsp;Error handling'>[futures.<span class='shy'></span>errors]</a>, error handling</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='keyword'>struct</span> is_error_code_enum<span class='anglebracket'>&lt;</span>future_errc<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <span class='keyword'>public</span> true_type <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
  error_code make_error_code<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
  error_condition make_error_condition<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>const</span> error_category<span class='operator'>&amp;</span> future_category<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='comment'>// <a href='#future.error' title='33.10.4&emsp;Class future_&shy;error'>[futures.<span class='shy'></span>future.<span class='shy'></span>error]</a>, class <span class='tcode_in_codeblock'>future_<span class='shy'></span>error</span></span>
  <span class='keyword'>class</span> future_error;

  <span class='comment'>// <a href='#promise' title='33.10.6&emsp;Class template promise'>[futures.<span class='shy'></span>promise]</a>, class template <span class='tcode_in_codeblock'>promise</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> promise;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> promise<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> x, promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> y<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span> Alloc<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> uses_allocator<span class='anglebracket'>&lt;</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span>, Alloc<span class='anglebracket'>&gt;</span>;

  <span class='comment'>// <a href='#unique.future' title='33.10.7&emsp;Class template future'>[futures.<span class='shy'></span>unique.<span class='shy'></span>future]</a>, class template <span class='tcode_in_codeblock'>future</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> future;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span>;

  <span class='comment'>// <a href='#shared.future' title='33.10.8&emsp;Class template shared_&shy;future'>[futures.<span class='shy'></span>shared.<span class='shy'></span>future]</a>, class template <span class='tcode_in_codeblock'>shared_<span class='shy'></span>future</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> shared_future;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> shared_future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> shared_future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span>;

  <span class='comment'>// <a href='#task' title='33.10.10&emsp;Class template packaged_&shy;task'>[futures.<span class='shy'></span>task]</a>, class template <span class='tcode_in_codeblock'>packaged_<span class='shy'></span>task</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> packaged_task;  <span class='comment'>// <i >not defined</i></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ArgTypes<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ArgTypes<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span>, packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='comment'>// <a href='#async' title='33.10.9&emsp;Function template async'>[futures.<span class='shy'></span>async]</a>, function template <span class='tcode_in_codeblock'>async</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> future<span class='anglebracket'>&lt;</span>invoke_result_t<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      async<span class='parenthesis'>(</span>F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> future<span class='anglebracket'>&lt;</span>invoke_result_t<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
      async<span class='parenthesis'>(</span>launch policy, F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></span></span></div><div class='para' id='future.syn-1'><div class='marginalizedparent'><a class='marginalized' href='#future.syn-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9954'>#</a></div><div class='texpara'><div id='future.syn-1.sentence-1' class='sentence'>The <span id=':enum'><span class='texttt'><span class='keyword'>enum</span></span></span> type <span class='texttt'>launch</span> is a bitmask type (<a href='bitmask.types' title='16.3.3.3.3&emsp;Bitmask types'>[bitmask.<span class='shy'></span>types]</a>) with
elements <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>async</span> and <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span><a class='hidden_link' href='#future.syn-1.sentence-1'>.</a></div> <div id='future.syn-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#future.syn-note-1'>1</a></i>: <div id='future.syn-1.sentence-2' class='sentence'>Implementations can provide bitmasks to specify restrictions on task
interaction by functions launched by <span class='texttt'>async<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> applicable to a
corresponding subset of available launch policies<a class='hidden_link' href='#future.syn-1.sentence-2'>.</a></div> <div id='future.syn-1.sentence-3' class='sentence'>Implementations can extend
the behavior of the first overload of <span class='texttt'>async<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> by adding their extensions
to the launch policy under the “as if” rule<a class='hidden_link' href='#future.syn-1.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='future.syn-2'><div class='marginalizedparent'><a class='marginalized' href='#future.syn-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9965'>#</a></div><div class='texpara'><div id='future.syn-2.sentence-1' class='sentence'>The enum values of <span class='texttt'>future_<span class='shy'></span>errc</span> are distinct and not zero<a class='hidden_link' href='#future.syn-2.sentence-1'>.</a></div></div></div></div><div id='errors' class='section'><h3 ><a class='secnum' href='#errors' style='min-width:80pt'>33.10.3</a> Error handling <a class='abbr_ref' href='futures.errors'>[futures.errors]</a></h3><div class='texpara'><div id='lib:future_category'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future_category'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>const</span> error_category<span class='operator'>&amp;</span> future_category<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='errors-1'><div class='marginalizedparent'><a class='marginalized' href='#errors-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9976'>#</a></div><div class='texpara'><div id='errors-1.sentence-1' class='sentence'><i >Returns</i>: A reference to an object of a type derived from class <span class='texttt'>error_<span class='shy'></span>category</span><a class='hidden_link' href='#errors-1.sentence-1'>.</a></div></div></div></div><div class='para' id='errors-2'><div class='marginalizedparent'><a class='marginalized' href='#errors-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9980'>#</a></div><div class='texpara'><div id='errors-2.sentence-1' class='sentence'>The object's <span class='texttt'>default_<span class='shy'></span>error_<span class='shy'></span>condition</span> and <span class='texttt'>equivalent</span> virtual functions shall
behave as specified for the class <span class='texttt'>error_<span class='shy'></span>category</span><a class='hidden_link' href='#errors-2.sentence-1'>.</a></div> <div id='errors-2.sentence-2' class='sentence'>The object's <span class='texttt'>name</span>
virtual function returns a pointer to the string <span class='texttt'><span class='literal'>"future"</span></span><a class='hidden_link' href='#errors-2.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:future_errc,make_error_code'><div id='lib:make_error_code,future_errc'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:make_error_code,future_errc'>🔗</a></div><code class='itemdeclcode'>error_code make_error_code<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='errors-3'><div class='marginalizedparent'><a class='marginalized' href='#errors-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L9992'>#</a></div><div class='texpara'><div id='errors-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>error_<span class='shy'></span>code<span class='parenthesis'>(</span><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>, future_<span class='shy'></span>category<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#errors-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future_errc,make_error_condition'><div id='lib:make_error_condition,future_errc'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:make_error_condition,future_errc'>🔗</a></div><code class='itemdeclcode'>error_condition make_error_condition<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='errors-4'><div class='marginalizedparent'><a class='marginalized' href='#errors-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10003'>#</a></div><div class='texpara'><div id='errors-4.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>error_<span class='shy'></span>condition<span class='parenthesis'>(</span><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>, future_<span class='shy'></span>category<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#errors-4.sentence-1'>.</a></div></div></div></div></div><div id='future.error' class='section'><h3 ><a class='secnum' href='#future.error' style='min-width:80pt'>33.10.4</a> Class <span class='texttt'>future_<span class='shy'></span>error</span> <a class='abbr_ref' href='futures.future.error'>[futures.future.error]</a></h3><div class='texpara'><span id='lib:future_error'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future_error'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> future_error <span class='operator'>:</span> <span class='keyword'>public</span> logic_error <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>explicit</span> future_error<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span>;

    <span class='keyword'>const</span> error_code<span class='operator'>&amp;</span> code<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span>       what<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    error_code ec_;             <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='texpara'><div id='lib:future_error,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future_error,constructor'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>explicit</span> future_error<span class='parenthesis'>(</span>future_errc e<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='future.error-1'><div class='marginalizedparent'><a class='marginalized' href='#future.error-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10032'>#</a></div><div class='texpara'><div id='future.error-1.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'>ec_<span class='shy'></span></span> with <span class='texttt'>make_<span class='shy'></span>error_<span class='shy'></span>code<span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#future.error-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future_error,code'><div id='lib:code,future_error'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:code,future_error'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>const</span> error_code<span class='operator'>&amp;</span> code<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='future.error-2'><div class='marginalizedparent'><a class='marginalized' href='#future.error-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10043'>#</a></div><div class='texpara'><div id='future.error-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>ec_<span class='shy'></span></span><a class='hidden_link' href='#future.error-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future_error,what'><div id='lib:what,future_error'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:what,future_error'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> what<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='future.error-3'><div class='marginalizedparent'><a class='marginalized' href='#future.error-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10054'>#</a></div><div class='texpara'><div id='future.error-3.sentence-1' class='sentence'><i >Returns</i>: An <span class='textsc'>ntbs</span> incorporating <span class='texttt'>code<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>message<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#future.error-3.sentence-1'>.</a></div></div></div></div></div><div id='state' class='section'><h3 ><a class='secnum' href='#state' style='min-width:80pt'>33.10.5</a> Shared state <a class='abbr_ref' href='futures.state'>[futures.state]</a></h3><div class='para' id='state-1'><div class='marginalizedparent'><a class='marginalized' href='#state-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10061'>#</a></div><div class='texpara'><div id='state-1.sentence-1' class='sentence'>Many of the classes introduced in subclause [futures] use some state to communicate results<a class='hidden_link' href='#state-1.sentence-1'>.</a></div> <div id='state-1.sentence-2' class='sentence'>This

<a class='hidden_link' href='#def:future,shared_state' title='33.10.5&emsp;Shared state&emsp;[futures.state]'><span id='def:future,shared_state'><i >shared state</i></span></a> consists of some state information and some (possibly not
yet evaluated) <a class='hidden_link' href='#def:result' id='def:result'><i>result</i></a>, which can be a (possibly void) value or an exception<a class='hidden_link' href='#state-1.sentence-2'>.</a></div> <div id='state-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#state-note-1'>1</a></i>: <div id='state-1.sentence-3' class='sentence'>Futures, promises, and tasks defined in this Clause reference such shared state<a class='hidden_link' href='#state-1.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='state-2'><div class='marginalizedparent'><a class='marginalized' href='#state-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10070'>#</a></div><div class='texpara'><div id='state-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#state-note-2'>2</a></i>: <div id='state-2.sentence-1' class='sentence'>The result can be any kind of object including a function to compute that result,
as used by <span class='texttt'>async</span> when <span class='texttt'>policy</span> is <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span><a class='hidden_link' href='#state-2.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='state-3'><div class='marginalizedparent'><a class='marginalized' href='#state-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10076'>#</a></div><div class='texpara'><div id='state-3.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:asynchronous_return_object' title='33.10.5&emsp;Shared state&emsp;[futures.state]'><span id='def:asynchronous_return_object'><i >asynchronous return object</i></span></a> is an object that reads results from a
shared state<a class='hidden_link' href='#state-3.sentence-1'>.</a></div> <div id='state-3.sentence-2' class='sentence'>A <a class='hidden_link' href='#def:function,waiting' title='33.10.5&emsp;Shared state&emsp;[futures.state]'><span id='def:function,waiting'><i >waiting function</i></span></a> of an asynchronous return object is one
that potentially blocks to wait for the shared state to be made
ready<a class='hidden_link' href='#state-3.sentence-2'>.</a></div> <div id='state-3.sentence-3' class='sentence'>If a waiting function can return before the state is made ready because of a
timeout (<a href='thread.req.lockable' title='33.2.5&emsp;Requirements for Cpp17Lockable types'>[thread.<span class='shy'></span>req.<span class='shy'></span>lockable]</a>), then it is a <a class='hidden_link' href='#def:timed_waiting_function' id='def:timed_waiting_function'><i>timed waiting function</i></a>, otherwise
it is a <a class='hidden_link' href='#def:non-timed_waiting_function' id='def:non-timed_waiting_function'><i>non-timed waiting function</i></a><a class='hidden_link' href='#state-3.sentence-3'>.</a></div></div></div><div class='para' id='state-4'><div class='marginalizedparent'><a class='marginalized' href='#state-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10085'>#</a></div><div class='texpara'><div id='state-4.sentence-1' class='sentence'>An <a class='hidden_link' href='#def:asynchronous_provider' title='33.10.5&emsp;Shared state&emsp;[futures.state]'><span id='def:asynchronous_provider'><i >asynchronous provider</i></span></a> is an object that provides a result to a shared
state<a class='hidden_link' href='#state-4.sentence-1'>.</a></div> <div id='state-4.sentence-2' class='sentence'>The result of a shared state is set by
respective functions on the asynchronous provider<a class='hidden_link' href='#state-4.sentence-2'>.</a></div> <div id='state-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#state-note-3'>3</a></i>: <div id='state-4.sentence-3' class='sentence'>Such as promises or tasks<a class='hidden_link' href='#state-4.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='state-4.sentence-4' class='sentence'>
The means of setting the result of a shared state is specified
in the description of those classes and functions that create such a state object<a class='hidden_link' href='#state-4.sentence-4'>.</a></div></div></div><div class='para' id='state-5'><div class='marginalizedparent'><a class='marginalized' href='#state-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10096'>#</a></div><div class='texpara'><div id='state-5.sentence-1' class='sentence'>When an asynchronous return object or an asynchronous provider is said to release its
shared state, it means:
<ul class='itemize'><li id='state-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-5.1'>(5.1)</a></div>if the return object or provider holds the last reference to its shared state,
the shared state is destroyed; and</li><li id='state-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-5.2'>(5.2)</a></div>the return object or provider gives up its reference to its shared state; and</li><li id='state-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-5.3'>(5.3)</a></div>these actions will not block for the shared state to become ready, except that it
may block if all of the following are true: the shared state was created by a call to
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>async</span>, the shared state is not yet ready, and this was the last reference
to the shared state<a class='hidden_link' href='#state-5.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='state-6'><div class='marginalizedparent'><a class='marginalized' href='#state-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10113'>#</a></div><div class='texpara'><div id='state-6.sentence-1' class='sentence'>When an asynchronous provider is said to make its shared state ready, it means:
<ul class='itemize'><li id='state-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-6.1'>(6.1)</a></div>first, the provider marks its shared state as ready; and</li><li id='state-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-6.2'>(6.2)</a></div>second, the provider unblocks any execution agents waiting for its shared
state to become ready<a class='hidden_link' href='#state-6.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='state-7'><div class='marginalizedparent'><a class='marginalized' href='#state-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10123'>#</a></div><div class='texpara'><div id='state-7.sentence-1' class='sentence'>When an asynchronous provider is said to abandon its shared state, it means:
<ul class='itemize'><li id='state-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-7.1'>(7.1)</a></div>first, if that state is not ready, the provider
<ul class='itemize'><li id='state-7.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#state-7.1.1'>(7.1.1)</a></div>stores an exception object of type <span class='texttt'>future_<span class='shy'></span>error</span> with an error condition of
<span class='texttt'>broken_<span class='shy'></span>promise</span> within its shared state; and then</li><li id='state-7.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#state-7.1.2'>(7.1.2)</a></div>makes its shared state ready;</li></ul></li><li id='state-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#state-7.2'>(7.2)</a></div>second, the provider releases its shared state<a class='hidden_link' href='#state-7.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='state-8'><div class='marginalizedparent'><a class='marginalized' href='#state-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10139'>#</a></div><div class='texpara'><div id='state-8.sentence-1' class='sentence'>A shared state is <a class='hidden_link' href='#def:ready' title='33.10.5&emsp;Shared state&emsp;[futures.state]'><span id='def:ready'><i >ready</i></span></a> only if it holds a value or an exception ready for
retrieval<a class='hidden_link' href='#state-8.sentence-1'>.</a></div> <div id='state-8.sentence-2' class='sentence'>Waiting for a shared state to become ready may invoke code to compute the result on
the waiting thread if so specified in the description of the class or function that creates
the state object<a class='hidden_link' href='#state-8.sentence-2'>.</a></div></div></div><div class='para' id='state-9'><div class='marginalizedparent'><a class='marginalized' href='#state-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10146'>#</a></div><div class='texpara'><div id='state-9.sentence-1' class='sentence'>Calls to functions that successfully set the stored result of a shared
state <a href='intro.multithread#def:synchronize_with' title='6.9.2&emsp;Multi-threaded executions and data races&emsp;[intro.multithread]'>synchronize with</a> calls to functions
successfully detecting the ready state resulting from that setting<a class='hidden_link' href='#state-9.sentence-1'>.</a></div> <div id='state-9.sentence-2' class='sentence'>The storage of the result
(whether normal or exceptional) into the shared state
<a href='intro.multithread#def:synchronize_with' title='6.9.2&emsp;Multi-threaded executions and data races&emsp;[intro.multithread]'>synchronizes with</a>
the successful return from a call to a waiting function on the shared state<a class='hidden_link' href='#state-9.sentence-2'>.</a></div></div></div><div class='para' id='state-10'><div class='marginalizedparent'><a class='marginalized' href='#state-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10155'>#</a></div><div class='texpara'><div id='state-10.sentence-1' class='sentence'>Some functions (e.g., <span class='texttt'>promise<span class='operator'>&#x200b;::&#x200b;</span>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>) delay making
the shared state ready until the calling thread exits<a class='hidden_link' href='#state-10.sentence-1'>.</a></div> <div id='state-10.sentence-2' class='sentence'>The destruction of
each of that thread's objects with <a href='basic.stc.thread' title='6.7.5.3&emsp;Thread storage duration&emsp;[basic.stc.thread]'>thread storage duration</a>
is sequenced before making that shared state ready<a class='hidden_link' href='#state-10.sentence-2'>.</a></div></div></div><div class='para' id='state-11'><div class='marginalizedparent'><a class='marginalized' href='#state-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10161'>#</a></div><div class='texpara'><div id='state-11.sentence-1' class='sentence'>Access to the result of the same shared state may <a href='intro.multithread#def:conflict' title='6.9.2&emsp;Multi-threaded executions and data races&emsp;[intro.multithread]'>conflict</a><a class='hidden_link' href='#state-11.sentence-1'>.</a></div> <div id='state-note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#state-note-4'>4</a></i>: <div id='state-11.sentence-2' class='sentence'>This explicitly specifies that the result of the shared state is
visible in the objects that reference this state in the sense of data race
avoidance (<a href='res.on.data.races' title='16.4.6.10&emsp;Data race avoidance'>[res.<span class='shy'></span>on.<span class='shy'></span>data.<span class='shy'></span>races]</a>)<a class='hidden_link' href='#state-11.sentence-2'>.</a></div> <div id='state-11.sentence-3' class='sentence'>For example, concurrent accesses through
references returned by <span class='texttt'>shared_<span class='shy'></span>future<span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> (<a href='#shared.future' title='33.10.8&emsp;Class template shared_&shy;future'>[futures.<span class='shy'></span>shared.<span class='shy'></span>future]</a>)
must either use read-only operations or provide additional synchronization<a class='hidden_link' href='#state-11.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div id='promise' class='section'><h3 ><a class='secnum' href='#promise' style='min-width:80pt'>33.10.6</a> Class template <span class='texttt'>promise</span> <a class='abbr_ref' href='futures.promise'>[futures.promise]</a></h3><div class='texpara'><span id='lib:promise'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> promise <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Allocator<span class='anglebracket'>&gt;</span>
      promise<span class='parenthesis'>(</span>allocator_arg_t, <span class='keyword'>const</span> Allocator<span class='operator'>&amp;</span> a<span class='parenthesis'>)</span>;
    promise<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    promise<span class='parenthesis'>(</span><span class='keyword'>const</span> promise<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// assignment</span>
    promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> promise<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='comment'>// retrieving the result</span>
    future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// setting the result</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> set_exception<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;

    <span class='comment'>// setting the result with deferred notification</span>
    <span class='keyword'>void</span> set_value_at_thread_exit<span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> set_exception_at_thread_exit<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span> Alloc<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> uses_allocator<span class='anglebracket'>&lt;</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span>, Alloc<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div><div class='para' id='promise-1'><div class='marginalizedparent'><a class='marginalized' href='#promise-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10208'>#</a></div><div class='texpara'><div id='promise-1.sentence-1' class='sentence'>For the primary template, <span class='texttt'>R</span> shall be an object type that
meets the <i >Cpp17Destructible</i> requirements<a class='hidden_link' href='#promise-1.sentence-1'>.</a></div></div></div><div class='para' id='promise-2'><div class='marginalizedparent'><a class='marginalized' href='#promise-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10212'>#</a></div><div class='texpara'><div id='promise-2.sentence-1' class='sentence'>The implementation provides the template <span class='texttt'>promise</span> and two specializations,
<span class='texttt'>promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>promise<span class='anglebracket'>&lt;</span>&#x200b;<span class='keyword'>void</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#promise-2.sentence-1'>.</a></div> <div id='promise-2.sentence-2' class='sentence'>These differ only in the argument type
of the member functions <span class='texttt'>set_<span class='shy'></span>value</span> and <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>,
as set out in their descriptions, below<a class='hidden_link' href='#promise-2.sentence-2'>.</a></div></div></div><div class='para' id='promise-3'><div class='marginalizedparent'><a class='marginalized' href='#promise-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10218'>#</a></div><div class='texpara'><div id='promise-3.sentence-1' class='sentence'>The <span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>exception</span>, <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>,
and <span class='texttt'>set_<span class='shy'></span>exception_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span> member functions behave as though
they acquire a single mutex associated with the promise object while updating the
promise object<a class='hidden_link' href='#promise-3.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:promise,uses_allocator'><div id='lib:uses_allocator,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:uses_allocator,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span> Alloc<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> uses_allocator<span class='anglebracket'>&lt;</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span>, Alloc<span class='anglebracket'>&gt;</span>
    <span class='operator'>:</span> true_type <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
</code></div></div></div></div><div class='para' id='promise-4'><div class='marginalizedparent'><a class='marginalized' href='#promise-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10232'>#</a></div><div class='texpara'><div id='promise-4.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>Alloc</span> meets
the <i >Cpp17Allocator</i> requirements (<a href='allocator.requirements.general' title='16.4.4.6.1&emsp;General'>[allocator.<span class='shy'></span>requirements.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#promise-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,constructor'>🔗</a></div><code class='itemdeclcode'>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Allocator<span class='anglebracket'>&gt;</span>
  promise<span class='parenthesis'>(</span>allocator_arg_t, <span class='keyword'>const</span> Allocator<span class='operator'>&amp;</span> a<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='promise-5'><div class='marginalizedparent'><a class='marginalized' href='#promise-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10246'>#</a></div><div class='texpara'><div id='promise-5.sentence-1' class='sentence'><i >Effects</i>: Creates a shared state<a class='hidden_link' href='#promise-5.sentence-1'>.</a></div> <div id='promise-5.sentence-2' class='sentence'>The second
constructor uses the allocator <span class='texttt'>a</span> to allocate memory for the shared
state<a class='hidden_link' href='#promise-5.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,constructor_'>🔗</a></div><code class='itemdeclcode'>promise<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='promise-6'><div class='marginalizedparent'><a class='marginalized' href='#promise-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10259'>#</a></div><div class='texpara'><div id='promise-6.sentence-1' class='sentence'><i >Effects</i>: Transfers ownership of the shared state
of <span class='texttt'>rhs</span> (if any) to the newly-constructed object<a class='hidden_link' href='#promise-6.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-7'><div class='marginalizedparent'><a class='marginalized' href='#promise-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10264'>#</a></div><div class='texpara'><div id='promise-7.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#promise-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:promise,destructor'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>promise<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='promise-8'><div class='marginalizedparent'><a class='marginalized' href='#promise-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10275'>#</a></div><div class='texpara'><div id='promise-8.sentence-1' class='sentence'><i >Effects</i>: Abandons any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#promise-8.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,operator='><div id='lib:operator=,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,promise'>🔗</a></div><code class='itemdeclcode'>promise<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='promise-9'><div class='marginalizedparent'><a class='marginalized' href='#promise-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10286'>#</a></div><div class='texpara'><div id='promise-9.sentence-1' class='sentence'><i >Effects</i>: Abandons any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>) and then as if
<span class='texttt'>promise<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>swap<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#promise-9.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-10'><div class='marginalizedparent'><a class='marginalized' href='#promise-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10291'>#</a></div><div class='texpara'><div id='promise-10.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#promise-10.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,swap'><div id='lib:swap,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='promise-11'><div class='marginalizedparent'><a class='marginalized' href='#promise-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10302'>#</a></div><div class='texpara'><div id='promise-11.sentence-1' class='sentence'><i >Effects</i>: Exchanges the shared state of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and <span class='texttt'>other</span><a class='hidden_link' href='#promise-11.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-12'><div class='marginalizedparent'><a class='marginalized' href='#promise-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10306'>#</a></div><div class='texpara'><div id='promise-12.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has the shared state (if any) that <span class='texttt'>other</span> had
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#promise-12.sentence-1'>.</a></div> <div id='promise-12.sentence-2' class='sentence'><span class='texttt'>other</span> has the shared state (if any) that
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> had prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#promise-12.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:promise,get_future'><div id='lib:get_future,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_future,promise'>🔗</a></div><code class='itemdeclcode'>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='promise-13'><div class='marginalizedparent'><a class='marginalized' href='#promise-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10319'>#</a></div><div class='texpara'><div id='promise-13.sentence-1' class='sentence'><i >Synchronization</i>: Calls to this function do not introduce
data races  (<a href='intro.multithread' title='6.9.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>) with calls to
<span class='texttt'>set_<span class='shy'></span>value</span>,
<span class='texttt'>set_<span class='shy'></span>exception</span>,
<span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span>, or
<span class='texttt'>set_<span class='shy'></span>exception_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span><a class='hidden_link' href='#promise-13.sentence-1'>.</a></div> <div id='promise-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#promise-note-1'>1</a></i>: <div id='promise-13.sentence-2' class='sentence'>Such calls need not synchronize with each other<a class='hidden_link' href='#promise-13.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='promise-14'><div class='marginalizedparent'><a class='marginalized' href='#promise-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10331'>#</a></div><div class='texpara'><div id='promise-14.sentence-1' class='sentence'><i >Returns</i>: A <span class='texttt'>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span></span> object with the same shared state as
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#promise-14.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-15'><div class='marginalizedparent'><a class='marginalized' href='#promise-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10336'>#</a></div><div class='texpara'><div id='promise-15.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state or if
<span class='texttt'>get_<span class='shy'></span>future</span> has already been called on a <span class='texttt'>promise</span> with the same
shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#promise-15.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-16'><div class='marginalizedparent'><a class='marginalized' href='#promise-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10342'>#</a></div><div class='texpara'><div id='promise-16.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='promise-16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-16.1'>(16.1)</a></div><div class='texpara'><div id='promise-16.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>already_<span class='shy'></span>retrieved</span> if <span class='texttt'>get_<span class='shy'></span>future</span> has already been called on
a <span class='texttt'>promise</span> with the same shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#promise-16.1.sentence-1'>.</a></div></div></li><li id='promise-16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-16.2'>(16.2)</a></div><div class='texpara'><div id='promise-16.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#promise-16.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_value'><div id='lib:set_value,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_value,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> promise<span class='operator'>::</span>set_value<span class='parenthesis'>(</span><span class='keyword'>const</span> R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='promise-17'><div class='marginalizedparent'><a class='marginalized' href='#promise-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10361'>#</a></div><div class='texpara'><div id='promise-17.sentence-1' class='sentence'><i >Effects</i>: Atomically stores the value <span class='texttt'>r</span> in the shared state and
makes that state ready (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#promise-17.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-18'><div class='marginalizedparent'><a class='marginalized' href='#promise-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10366'>#</a></div><div class='texpara'><div id='promise-18.sentence-1' class='sentence'><i >Throws</i>: <ul class='itemize'><li id='promise-18.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-18.1'>(18.1)</a></div><span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception, or</li><li id='promise-18.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-18.2'>(18.2)</a></div>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</li><li id='promise-18.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-18.3'>(18.3)</a></div>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#promise-18.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='promise-19'><div class='marginalizedparent'><a class='marginalized' href='#promise-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10375'>#</a></div><div class='texpara'><div id='promise-19.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='promise-19.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-19.1'>(19.1)</a></div><div class='texpara'><div id='promise-19.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-19.1.sentence-1'>.</a></div></div></li><li id='promise-19.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-19.2'>(19.2)</a></div><div class='texpara'><div id='promise-19.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#promise-19.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_exception'><div id='lib:set_exception,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_exception,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_exception<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='promise-20'><div class='marginalizedparent'><a class='marginalized' href='#promise-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10390'>#</a></div><div class='texpara'><div id='promise-20.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>p</span> is not null<a class='hidden_link' href='#promise-20.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-21'><div class='marginalizedparent'><a class='marginalized' href='#promise-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10394'>#</a></div><div class='texpara'><div id='promise-21.sentence-1' class='sentence'><i >Effects</i>: Atomically stores the exception pointer <span class='texttt'>p</span> in the shared state
and makes that state ready (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#promise-21.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-22'><div class='marginalizedparent'><a class='marginalized' href='#promise-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10399'>#</a></div><div class='texpara'><div id='promise-22.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-22.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-23'><div class='marginalizedparent'><a class='marginalized' href='#promise-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10404'>#</a></div><div class='texpara'><div id='promise-23.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='promise-23.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-23.1'>(23.1)</a></div><div class='texpara'><div id='promise-23.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-23.1.sentence-1'>.</a></div></div></li><li id='promise-23.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-23.2'>(23.2)</a></div><div class='texpara'><div id='promise-23.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#promise-23.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_value_at_thread_exit'><div id='lib:set_value_at_thread_exit,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_value_at_thread_exit,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> promise<span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span><span class='keyword'>const</span> R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span><span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span>R<span class='operator'>&amp;</span> r<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> promise<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>set_value_at_thread_exit<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='promise-24'><div class='marginalizedparent'><a class='marginalized' href='#promise-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10422'>#</a></div><div class='texpara'><div id='promise-24.sentence-1' class='sentence'><i >Effects</i>: Stores the value <span class='texttt'>r</span> in the shared state without making that
state ready immediately<a class='hidden_link' href='#promise-24.sentence-1'>.</a></div> <div id='promise-24.sentence-2' class='sentence'>Schedules that state to be made ready when the current
thread exits, after all objects of thread storage duration associated with the
current thread have been destroyed<a class='hidden_link' href='#promise-24.sentence-2'>.</a></div></div></div></div><div class='para' id='promise-25'><div class='marginalizedparent'><a class='marginalized' href='#promise-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10429'>#</a></div><div class='texpara'><div id='promise-25.sentence-1' class='sentence'><i >Throws</i>: <ul class='itemize'><li id='promise-25.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-25.1'>(25.1)</a></div><span class='texttt'>future_<span class='shy'></span>error</span> if its shared state
already has a stored value or exception, or</li><li id='promise-25.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-25.2'>(25.2)</a></div>for the first version, any exception thrown by the constructor selected to copy an object of <span class='texttt'>R</span>, or</li><li id='promise-25.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-25.3'>(25.3)</a></div>for the second version, any exception thrown by the constructor selected to move an object of <span class='texttt'>R</span><a class='hidden_link' href='#promise-25.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='promise-26'><div class='marginalizedparent'><a class='marginalized' href='#promise-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10438'>#</a></div><div class='texpara'><div id='promise-26.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='promise-26.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-26.1'>(26.1)</a></div><div class='texpara'><div id='promise-26.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-26.1.sentence-1'>.</a></div></div></li><li id='promise-26.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-26.2'>(26.2)</a></div><div class='texpara'><div id='promise-26.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#promise-26.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,set_exception_at_thread_exit'><div id='lib:set_exception_at_thread_exit,promise'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:set_exception_at_thread_exit,promise'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_exception_at_thread_exit<span class='parenthesis'>(</span>exception_ptr p<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='promise-27'><div class='marginalizedparent'><a class='marginalized' href='#promise-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10453'>#</a></div><div class='texpara'><div id='promise-27.sentence-1' class='sentence'><i >Preconditions</i>: <span class='texttt'>p</span> is not null<a class='hidden_link' href='#promise-27.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-28'><div class='marginalizedparent'><a class='marginalized' href='#promise-28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10457'>#</a></div><div class='texpara'><div id='promise-28.sentence-1' class='sentence'><i >Effects</i>: Stores the exception pointer <span class='texttt'>p</span> in the shared state without
making that state ready immediately<a class='hidden_link' href='#promise-28.sentence-1'>.</a></div> <div id='promise-28.sentence-2' class='sentence'>Schedules that state to be made ready when
the current thread exits, after all objects of thread storage duration
associated with the current thread have been destroyed<a class='hidden_link' href='#promise-28.sentence-2'>.</a></div></div></div></div><div class='para' id='promise-29'><div class='marginalizedparent'><a class='marginalized' href='#promise-29'>29</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10464'>#</a></div><div class='texpara'><div id='promise-29.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if an error condition occurs<a class='hidden_link' href='#promise-29.sentence-1'>.</a></div></div></div></div><div class='para' id='promise-30'><div class='marginalizedparent'><a class='marginalized' href='#promise-30'>30</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10468'>#</a></div><div class='texpara'><div id='promise-30.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='promise-30.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-30.1'>(30.1)</a></div><div class='texpara'><div id='promise-30.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if its shared state
already has a stored value or exception<a class='hidden_link' href='#promise-30.1.sentence-1'>.</a></div></div></li><li id='promise-30.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#promise-30.2'>(30.2)</a></div><div class='texpara'><div id='promise-30.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#promise-30.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:promise,swap_'><div id='lib:swap,promise_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,promise_'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> x, promise<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> y<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='promise-31'><div class='marginalizedparent'><a class='marginalized' href='#promise-31'>31</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10484'>#</a></div><div class='texpara'><div id='promise-31.sentence-1' class='sentence'><i >Effects</i>: As if by <span class='texttt'>x<span class='operator'>.</span>swap<span class='parenthesis'>(</span>y<span class='parenthesis'>)</span></span><a class='hidden_link' href='#promise-31.sentence-1'>.</a></div></div></div></div></div><div id='unique.future' class='section'><h3 ><a class='secnum' href='#unique.future' style='min-width:80pt'>33.10.7</a> Class template <span class='texttt'>future</span> <a class='abbr_ref' href='futures.unique.future'>[futures.unique.future]</a></h3><div class='para' id='unique.future-1'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10491'>#</a></div><div class='texpara'><div id='unique.future-1.sentence-1' class='sentence'>The class template <span class='texttt'>future</span> defines a type for asynchronous return objects which
do not share their shared state with other asynchronous return objects<a class='hidden_link' href='#unique.future-1.sentence-1'>.</a></div> <div id='unique.future-1.sentence-2' class='sentence'>A default-constructed <span class='texttt'>future</span> object has no
shared state<a class='hidden_link' href='#unique.future-1.sentence-2'>.</a></div> <div id='unique.future-1.sentence-3' class='sentence'>A <span class='texttt'>future</span> object with shared state can be created by
functions on <a href='#def:asynchronous_provider' title='33.10.5&emsp;Shared state&emsp;[futures.state]'>asynchronous providers</a>
or by the move constructor and shares its shared state with
the original asynchronous provider<a class='hidden_link' href='#unique.future-1.sentence-3'>.</a></div> <div id='unique.future-1.sentence-4' class='sentence'>The result (value or exception) of
a <span class='texttt'>future</span> object
can be
set by
calling a respective function on an
object that shares the same
shared state<a class='hidden_link' href='#unique.future-1.sentence-4'>.</a></div></div></div><div class='para nonNormativeOnly' id='unique.future-2'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10506'>#</a></div><div class='texpara'><div id='unique.future-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#unique.future-note-1'>1</a></i>: <div id='unique.future-2.sentence-1' class='sentence'>Member functions of <span class='texttt'>future</span> do not synchronize with themselves or with
member functions of <span class='texttt'>shared_<span class='shy'></span>future</span><a class='hidden_link' href='#unique.future-2.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='unique.future-3'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10512'>#</a></div><div class='texpara'><div id='unique.future-3.sentence-1' class='sentence'>The effect of calling any member function other than the destructor, the
move-assignment operator, <span class='texttt'>share</span>, or <span class='texttt'>valid</span> on a <span class='texttt'>future</span> object for which
<span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span>
is undefined<a class='hidden_link' href='#unique.future-3.sentence-1'>.</a></div> <div id='unique.future-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#unique.future-note-2'>2</a></i>: <div id='unique.future-3.sentence-2' class='sentence'>It is valid to move from a future object for which <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-3.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><div id='unique.future-3.sentence-3' class='sentence'><i >Recommended practice</i>: Implementations should detect this case and throw an object of type
<span class='texttt'>future_<span class='shy'></span>error</span> with an error condition of <span class='texttt'>future_<span class='shy'></span>errc<span class='operator'>&#x200b;::&#x200b;</span>no_<span class='shy'></span>state</span><a class='hidden_link' href='#unique.future-3.sentence-3'>.</a></div></div><div class='texpara'><span id='lib:future'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> future <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    future<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    future<span class='parenthesis'>(</span>future<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    future<span class='parenthesis'>(</span><span class='keyword'>const</span> future<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> future<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>future<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    shared_future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> share<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='comment'>// retrieving the value</span>
    <i ><span class='texttt'>see below</span></i> get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// functions to check state</span>
    <span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
      future_status wait_for<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rel_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration<span class='anglebracket'>&gt;</span>
      future_status wait_until<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>time_point<span class='anglebracket'>&lt;</span>Clock, Duration<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> abs_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='unique.future-4'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10554'>#</a></div><div class='texpara'><div id='unique.future-4.sentence-1' class='sentence'>For the primary template, <span class='texttt'>R</span> shall be an object type that
meets the <i >Cpp17Destructible</i> requirements<a class='hidden_link' href='#unique.future-4.sentence-1'>.</a></div></div></div><div class='para' id='unique.future-5'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10558'>#</a></div><div class='texpara'><div id='unique.future-5.sentence-1' class='sentence'>The implementation provides the template <span class='texttt'>future</span> and two specializations,
<span class='texttt'>future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>future<span class='anglebracket'>&lt;</span>&#x200b;<span class='keyword'>void</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#unique.future-5.sentence-1'>.</a></div> <div id='unique.future-5.sentence-2' class='sentence'>These differ only in the return type and return
value of the member function <span class='texttt'>get</span>, as set out in its description, below<a class='hidden_link' href='#unique.future-5.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:future,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future,constructor'>🔗</a></div><code class='itemdeclcode'>future<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='unique.future-6'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10569'>#</a></div><div class='texpara'><div id='unique.future-6.sentence-1' class='sentence'><i >Effects</i>: The object does not refer to a shared state<a class='hidden_link' href='#unique.future-6.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-7'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10573'>#</a></div><div class='texpara'><div id='unique.future-7.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future,constructor_'>🔗</a></div><code class='itemdeclcode'>future<span class='parenthesis'>(</span>future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='unique.future-8'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10584'>#</a></div><div class='texpara'><div id='unique.future-8.sentence-1' class='sentence'><i >Effects</i>: Move constructs a <span class='texttt'>future</span> object that refers to the shared
state that
was originally referred to by <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#unique.future-8.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-9'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10590'>#</a></div><div class='texpara'><div id='unique.future-9.sentence-1' class='sentence'><i >Postconditions</i>: <ul class='itemize'><li id='unique.future-9.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-9.1'>(9.1)</a></div><div class='texpara'><div id='unique.future-9.1.sentence-1' class='sentence'><span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the same value as <span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> prior to the
constructor invocation<a class='hidden_link' href='#unique.future-9.1.sentence-1'>.</a></div></div></li><li id='unique.future-9.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-9.2'>(9.2)</a></div><div class='texpara'><div id='unique.future-9.2.sentence-1' class='sentence'><span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-9.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:future,constructor__'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:future,constructor__'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='unique.future-10'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10605'>#</a></div><div class='texpara'><div id='unique.future-10.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='unique.future-10.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-10.1'>(10.1)</a></div>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>);</li><li id='unique.future-10.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-10.2'>(10.2)</a></div>destroys <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#unique.future-10.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:future,operator='><div id='lib:operator=,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,future'>🔗</a></div><code class='itemdeclcode'>future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='unique.future-11'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10621'>#</a></div><div class='texpara'><div id='unique.future-11.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>addressof<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>true</span></span>, there are no effects<a class='hidden_link' href='#unique.future-11.sentence-1'>.</a></div> <div id='unique.future-11.sentence-2' class='sentence'>Otherwise:
<ul class='itemize'><li id='unique.future-11.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-11.1'>(11.1)</a></div><div class='texpara'><div id='unique.future-11.1.sentence-1' class='sentence'>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#unique.future-11.1.sentence-1'>.</a></div></div></li><li id='unique.future-11.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-11.2'>(11.2)</a></div><div class='texpara'><div id='unique.future-11.2.sentence-1' class='sentence'>move assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#unique.future-11.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='unique.future-12'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10632'>#</a></div><div class='texpara'><div id='unique.future-12.sentence-1' class='sentence'><i >Postconditions</i>: <ul class='itemize'><li id='unique.future-12.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-12.1'>(12.1)</a></div><div class='texpara'><div id='unique.future-12.1.sentence-1' class='sentence'><span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the same value as <span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> prior to the
assignment<a class='hidden_link' href='#unique.future-12.1.sentence-1'>.</a></div></div></li><li id='unique.future-12.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-12.2'>(12.2)</a></div><div class='texpara'><div id='unique.future-12.2.sentence-1' class='sentence'>If <span class='texttt'>addressof<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-12.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:future,share'><div id='lib:share,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:share,future'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> share<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='unique.future-13'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10651'>#</a></div><div class='texpara'><div id='unique.future-13.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-13.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-14'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10655'>#</a></div><div class='texpara'><div id='unique.future-14.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>shared_<span class='shy'></span>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#unique.future-14.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,get'><div id='lib:get,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get,future'>🔗</a></div><code class='itemdeclcode'>R future<span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
R<span class='operator'>&amp;</span> future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>void</span> future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para nonNormativeOnly' id='unique.future-15'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10668'>#</a></div><div class='texpara'><div id='unique.future-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#unique.future-note-3'>3</a></i>: <div id='unique.future-15.sentence-1' class='sentence'>As described above, the template and its two required specializations differ only in
the return type and return value of the member function <span class='texttt'>get</span><a class='hidden_link' href='#unique.future-15.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='unique.future-16'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10674'>#</a></div><div class='texpara'><div id='unique.future-16.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='unique.future-16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-16.1'>(16.1)</a></div><span class='texttt'>wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>s until the shared state is ready, then retrieves the
value stored in the shared state;</li><li id='unique.future-16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-16.2'>(16.2)</a></div>releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#unique.future-16.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='unique.future-17'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10682'>#</a></div><div class='texpara'><div id='unique.future-17.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#unique.future-17.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-18'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10686'>#</a></div><div class='texpara'><div id='unique.future-18.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='unique.future-18.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-18.1'>(18.1)</a></div><div class='texpara'><div id='unique.future-18.1.sentence-1' class='sentence'><span class='texttt'>future<span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the value <span class='texttt'>v</span> stored in the object's shared state as
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>v<span class='parenthesis'>)</span></span><a class='hidden_link' href='#unique.future-18.1.sentence-1'>.</a></div></div></li><li id='unique.future-18.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-18.2'>(18.2)</a></div><div class='texpara'><div id='unique.future-18.2.sentence-1' class='sentence'><span class='texttt'>future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the reference stored as value in the object's shared state<a class='hidden_link' href='#unique.future-18.2.sentence-1'>.</a></div></div></li><li id='unique.future-18.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-18.3'>(18.3)</a></div><div class='texpara'><div id='unique.future-18.3.sentence-1' class='sentence'><span class='texttt'>future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns nothing<a class='hidden_link' href='#unique.future-18.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='unique.future-19'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10700'>#</a></div><div class='texpara'><div id='unique.future-19.sentence-1' class='sentence'><i >Throws</i>: The stored exception, if an exception was stored in the shared state<a class='hidden_link' href='#unique.future-19.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,valid'><div id='lib:valid,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:valid,future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='unique.future-20'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10711'>#</a></div><div class='texpara'><div id='unique.future-20.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> only if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> refers to a shared state<a class='hidden_link' href='#unique.future-20.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,wait'><div id='lib:wait,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait,future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='unique.future-21'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10722'>#</a></div><div class='texpara'><div id='unique.future-21.sentence-1' class='sentence'><a class='index' id=':block_(execution)'></a><i >Effects</i>: Blocks until the shared state is ready<a class='hidden_link' href='#unique.future-21.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,wait_for'><div id='lib:wait_for,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait_for,future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
  future_status wait_for<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rel_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='unique.future-22'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10735'>#</a></div><div class='texpara'><div id='unique.future-22.sentence-1' class='sentence'><a class='index' id=':block_(execution)_'></a><i >Effects</i>: None if the shared state contains a deferred function (<a href='#async' title='33.10.9&emsp;Function template async'>[futures.<span class='shy'></span>async]</a>),
otherwise
blocks until the shared state is ready or until
the relative timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>) specified by <span class='texttt'>rel_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#unique.future-22.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-23'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10743'>#</a></div><div class='texpara'><div id='unique.future-23.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='unique.future-23.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-23.1'>(23.1)</a></div><div class='texpara'><div id='unique.future-23.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#unique.future-23.1.sentence-1'>.</a></div></div></li><li id='unique.future-23.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-23.2'>(23.2)</a></div><div class='texpara'><div id='unique.future-23.2.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>ready</span> if the shared state is ready<a class='hidden_link' href='#unique.future-23.2.sentence-1'>.</a></div></div></li><li id='unique.future-23.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-23.3'>(23.3)</a></div><div class='texpara'><div id='unique.future-23.3.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>timeout</span> if the function is returning because the
relative timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)
specified by <span class='texttt'>rel_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#unique.future-23.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='unique.future-24'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10756'>#</a></div><div class='texpara'><div id='unique.future-24.sentence-1' class='sentence'><i >Throws</i>: timeout-related exceptions (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)<a class='hidden_link' href='#unique.future-24.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:future,wait_until'><div id='lib:wait_until,future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait_until,future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration<span class='anglebracket'>&gt;</span>
  future_status wait_until<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>time_point<span class='anglebracket'>&lt;</span>Clock, Duration<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> abs_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='unique.future-25'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10768'>#</a></div><div class='texpara'><div id='unique.future-25.sentence-1' class='sentence'><a class='index' id=':block_(execution)__'></a><i >Effects</i>: None if the shared state contains a deferred function (<a href='#async' title='33.10.9&emsp;Function template async'>[futures.<span class='shy'></span>async]</a>),
otherwise
blocks until the shared state is ready or until
the absolute timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>) specified by <span class='texttt'>abs_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#unique.future-25.sentence-1'>.</a></div></div></div></div><div class='para' id='unique.future-26'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10776'>#</a></div><div class='texpara'><div id='unique.future-26.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='unique.future-26.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-26.1'>(26.1)</a></div><div class='texpara'><div id='unique.future-26.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#unique.future-26.1.sentence-1'>.</a></div></div></li><li id='unique.future-26.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-26.2'>(26.2)</a></div><div class='texpara'><div id='unique.future-26.2.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>ready</span> if the shared state is ready<a class='hidden_link' href='#unique.future-26.2.sentence-1'>.</a></div></div></li><li id='unique.future-26.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#unique.future-26.3'>(26.3)</a></div><div class='texpara'><div id='unique.future-26.3.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>timeout</span> if the function is returning because the
absolute timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)
specified by <span class='texttt'>abs_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#unique.future-26.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='unique.future-27'><div class='marginalizedparent'><a class='marginalized' href='#unique.future-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10790'>#</a></div><div class='texpara'><div id='unique.future-27.sentence-1' class='sentence'><i >Throws</i>: timeout-related exceptions (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)<a class='hidden_link' href='#unique.future-27.sentence-1'>.</a></div></div></div></div></div><div id='shared.future' class='section'><h3 ><a class='secnum' href='#shared.future' style='min-width:80pt'>33.10.8</a> Class template <span class='texttt'>shared_<span class='shy'></span>future</span> <a class='abbr_ref' href='futures.shared.future'>[futures.shared.future]</a></h3><div class='para' id='shared.future-1'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10798'>#</a></div><div class='texpara'><div id='shared.future-1.sentence-1' class='sentence'>The class template <span class='texttt'>shared_<span class='shy'></span>future</span> defines a type for asynchronous return objects
which may share their shared state with other asynchronous return
objects<a class='hidden_link' href='#shared.future-1.sentence-1'>.</a></div> <div id='shared.future-1.sentence-2' class='sentence'>A default-constructed <span class='texttt'>shared_<span class='shy'></span>future</span>
object has no shared state<a class='hidden_link' href='#shared.future-1.sentence-2'>.</a></div> <div id='shared.future-1.sentence-3' class='sentence'>A <span class='texttt'>shared_<span class='shy'></span>future</span> object with
shared state can
be created
by conversion from a <span class='texttt'>future</span> object and shares its shared state with the
original <a href='#def:asynchronous_provider' title='33.10.5&emsp;Shared state&emsp;[futures.state]'>asynchronous provider</a> of the shared state<a class='hidden_link' href='#shared.future-1.sentence-3'>.</a></div> <div id='shared.future-1.sentence-4' class='sentence'>The result (value or exception) of a <span class='texttt'>shared_<span class='shy'></span>future</span> object
can be set by
calling a respective function on an
object that shares the same shared state<a class='hidden_link' href='#shared.future-1.sentence-4'>.</a></div></div></div><div class='para nonNormativeOnly' id='shared.future-2'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10812'>#</a></div><div class='texpara'><div id='shared.future-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-1'>1</a></i>: <div id='shared.future-2.sentence-1' class='sentence'>Member functions of <span class='texttt'>shared_<span class='shy'></span>future</span> do not synchronize with themselves,
but they synchronize with the shared state<a class='hidden_link' href='#shared.future-2.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='shared.future-3'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10818'>#</a></div><div class='texpara'><div id='shared.future-3.sentence-1' class='sentence'>The effect of calling any member function other than the destructor,
the move-assignment operator, the copy-assignment operator, or
<span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> on a <span class='texttt'>shared_<span class='shy'></span>future</span> object for which <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span> is undefined<a class='hidden_link' href='#shared.future-3.sentence-1'>.</a></div> <div id='shared.future-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-2'>2</a></i>: <div id='shared.future-3.sentence-2' class='sentence'>It is valid to copy or move from a <span class='texttt'>shared_<span class='shy'></span>future</span>
object for which <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#shared.future-3.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><div id='shared.future-3.sentence-3' class='sentence'><i >Recommended practice</i>: Implementations should detect this case and throw an object of type
<span class='texttt'>future_<span class='shy'></span>error</span> with an error condition of <span class='texttt'>future_<span class='shy'></span>errc<span class='operator'>&#x200b;::&#x200b;</span>no_<span class='shy'></span>state</span><a class='hidden_link' href='#shared.future-3.sentence-3'>.</a></div></div><div class='texpara'><span id='lib:shared_future'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:shared_future'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> shared_future <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    shared_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    shared_future<span class='parenthesis'>(</span><span class='keyword'>const</span> shared_future<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    shared_future<span class='parenthesis'>(</span>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    shared_future<span class='parenthesis'>(</span>shared_future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='operator'>~</span>shared_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    shared_future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> shared_future<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    shared_future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>shared_future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='comment'>// retrieving the value</span>
    <i ><span class='texttt'>see below</span></i> get<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;

    <span class='comment'>// functions to check state</span>
    <span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
      future_status wait_for<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rel_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration<span class='anglebracket'>&gt;</span>
      future_status wait_until<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>time_point<span class='anglebracket'>&lt;</span>Clock, Duration<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> abs_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='shared.future-4'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10860'>#</a></div><div class='texpara'><div id='shared.future-4.sentence-1' class='sentence'>For the primary template, <span class='texttt'>R</span> shall be an object type that
meets the <i >Cpp17Destructible</i> requirements<a class='hidden_link' href='#shared.future-4.sentence-1'>.</a></div></div></div><div class='para' id='shared.future-5'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10864'>#</a></div><div class='texpara'><div id='shared.future-5.sentence-1' class='sentence'>The implementation provides the template <span class='texttt'>shared_<span class='shy'></span>future</span> and two
specializations, <span class='texttt'>shared_<span class='shy'></span>future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>shared_<span class='shy'></span>future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#shared.future-5.sentence-1'>.</a></div> <div id='shared.future-5.sentence-2' class='sentence'>These
differ only in the return type and return value of the member function <span class='texttt'>get</span>, as
set out in its description, below<a class='hidden_link' href='#shared.future-5.sentence-2'>.</a></div></div></div><div class='texpara'><div id='lib:shared_future,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:shared_future,constructor'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='shared.future-6'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10876'>#</a></div><div class='texpara'><div id='shared.future-6.sentence-1' class='sentence'><i >Effects</i>: The object does not refer to a shared state<a class='hidden_link' href='#shared.future-6.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-7'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10880'>#</a></div><div class='texpara'><div id='shared.future-7.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#shared.future-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:shared_future,constructor_'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='parenthesis'>(</span><span class='keyword'>const</span> shared_future<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='shared.future-8'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10891'>#</a></div><div class='texpara'><div id='shared.future-8.sentence-1' class='sentence'><i >Effects</i>: The object refers to the same
shared state as <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#shared.future-8.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-9'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10896'>#</a></div><div class='texpara'><div id='shared.future-9.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the same value as <span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#shared.future-9.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,constructor__'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:shared_future,constructor__'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='parenthesis'>(</span>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
shared_future<span class='parenthesis'>(</span>shared_future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='shared.future-10'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10908'>#</a></div><div class='texpara'><div id='shared.future-10.sentence-1' class='sentence'><i >Effects</i>: Move constructs a <span class='texttt'>shared_<span class='shy'></span>future</span> object that refers to the
shared state that was originally referred to by <span class='texttt'>rhs</span> (if any)<a class='hidden_link' href='#shared.future-10.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-11'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10913'>#</a></div><div class='texpara'><div id='shared.future-11.sentence-1' class='sentence'><i >Postconditions</i>: <ul class='itemize'><li id='shared.future-11.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-11.1'>(11.1)</a></div><div class='texpara'><div id='shared.future-11.1.sentence-1' class='sentence'><span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the same value as <span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returned prior to
the constructor invocation<a class='hidden_link' href='#shared.future-11.1.sentence-1'>.</a></div></div></li><li id='shared.future-11.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-11.2'>(11.2)</a></div><div class='texpara'><div id='shared.future-11.2.sentence-1' class='sentence'><span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#shared.future-11.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:shared_future,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:shared_future,destructor'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>shared_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='shared.future-12'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10928'>#</a></div><div class='texpara'><div id='shared.future-12.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='shared.future-12.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-12.1'>(12.1)</a></div>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>);</li><li id='shared.future-12.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-12.2'>(12.2)</a></div>destroys <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#shared.future-12.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:shared_future,operator='><div id='lib:operator=,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,shared_future'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>shared_future<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='shared.future-13'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10944'>#</a></div><div class='texpara'><div id='shared.future-13.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>addressof<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>true</span></span>, there are no effects<a class='hidden_link' href='#shared.future-13.sentence-1'>.</a></div> <div id='shared.future-13.sentence-2' class='sentence'>Otherwise:
<ul class='itemize'><li id='shared.future-13.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-13.1'>(13.1)</a></div>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>);</li><li id='shared.future-13.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-13.2'>(13.2)</a></div>move assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#shared.future-13.sentence-2'>.</a></li></ul></div></div></div></div><div class='para' id='shared.future-14'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10955'>#</a></div><div class='texpara'><div id='shared.future-14.sentence-1' class='sentence'><i >Postconditions</i>: <ul class='itemize'><li id='shared.future-14.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-14.1'>(14.1)</a></div><div class='texpara'><div id='shared.future-14.1.sentence-1' class='sentence'><span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the same value as <span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returned prior to
the assignment<a class='hidden_link' href='#shared.future-14.1.sentence-1'>.</a></div></div></li><li id='shared.future-14.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-14.2'>(14.2)</a></div><div class='texpara'><div id='shared.future-14.2.sentence-1' class='sentence'>If <span class='texttt'>addressof<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>false</span></span><a class='hidden_link' href='#shared.future-14.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:shared_future,operator=_'><div id='lib:operator=,shared_future_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,shared_future_'>🔗</a></div><code class='itemdeclcode'>shared_future<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> shared_future<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='shared.future-15'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10974'>#</a></div><div class='texpara'><div id='shared.future-15.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>addressof<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='keyword'>this</span></span> is <span class='texttt'><span class='literal'>true</span></span>, there are no effects<a class='hidden_link' href='#shared.future-15.sentence-1'>.</a></div> <div id='shared.future-15.sentence-2' class='sentence'>Otherwise:
<ul class='itemize'><li id='shared.future-15.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-15.1'>(15.1)</a></div>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>);</li><li id='shared.future-15.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-15.2'>(15.2)</a></div>assigns the contents of <span class='texttt'>rhs</span> to <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#shared.future-15.sentence-2'>.</a> <div class='texpara'><div id='shared.future-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-3'>3</a></i>: <div id='shared.future-15.2.sentence-2' class='sentence'>As a result,
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> refers to the same shared state as <span class='texttt'>rhs</span>
(if any)<a class='hidden_link' href='#shared.future-15.2.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></li></ul></div></div></div></div><div class='para' id='shared.future-16'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L10990'>#</a></div><div class='texpara'><div id='shared.future-16.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> rhs<span class='operator'>.</span>valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#shared.future-16.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,get'><div id='lib:get,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get,shared_future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>const</span> R<span class='operator'>&amp;</span> shared_future<span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
R<span class='operator'>&amp;</span> shared_future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
<span class='keyword'>void</span> shared_future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para nonNormativeOnly' id='shared.future-17'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11003'>#</a></div><div class='texpara'><div id='shared.future-note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-4'>4</a></i>: <div id='shared.future-17.sentence-1' class='sentence'>As described above, the template and its two required specializations differ only in
the return type and return value of the member function <span class='texttt'>get</span><a class='hidden_link' href='#shared.future-17.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para nonNormativeOnly' id='shared.future-18'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11009'>#</a></div><div class='texpara'><div id='shared.future-note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-5'>5</a></i>: <div id='shared.future-18.sentence-1' class='sentence'>Access to a value object stored in the shared state is
unsynchronized, so operations on <span class='texttt'>R</span> might
introduce a data race (<a href='intro.multithread' title='6.9.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>)<a class='hidden_link' href='#shared.future-18.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='shared.future-19'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11016'>#</a></div><div class='texpara'><div id='shared.future-19.sentence-1' class='sentence'><i >Effects</i>: <span class='texttt'>wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>s until the shared state is ready, then retrieves the
value stored in the shared state<a class='hidden_link' href='#shared.future-19.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-20'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11021'>#</a></div><div class='texpara'><div id='shared.future-20.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='shared.future-20.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-20.1'>(20.1)</a></div><div class='texpara'><div id='shared.future-20.1.sentence-1' class='sentence'><span class='texttt'>shared_<span class='shy'></span>future<span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns a const reference to the value stored in the object's
shared state<a class='hidden_link' href='#shared.future-20.1.sentence-1'>.</a></div> <div id='shared.future-note-6' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#shared.future-note-6'>6</a></i>: <div id='shared.future-20.1.sentence-2' class='sentence'>Access through that reference after the shared state has been
destroyed produces undefined behavior; this can be avoided by not storing the reference in any
storage with a greater lifetime than the <span class='texttt'>shared_<span class='shy'></span>future</span> object that returned the
reference<a class='hidden_link' href='#shared.future-20.1.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></li><li id='shared.future-20.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-20.2'>(20.2)</a></div><div class='texpara'><div id='shared.future-20.2.sentence-1' class='sentence'><span class='texttt'>shared_<span class='shy'></span>future<span class='anglebracket'>&lt;</span>R<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns the reference stored as value in the object's
shared state<a class='hidden_link' href='#shared.future-20.2.sentence-1'>.</a></div></div></li><li id='shared.future-20.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-20.3'>(20.3)</a></div><div class='texpara'><div id='shared.future-20.3.sentence-1' class='sentence'><span class='texttt'>shared_<span class='shy'></span>future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> returns nothing<a class='hidden_link' href='#shared.future-20.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='shared.future-21'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11042'>#</a></div><div class='texpara'><div id='shared.future-21.sentence-1' class='sentence'><i >Throws</i>: The stored exception, if an exception was stored in the shared state<a class='hidden_link' href='#shared.future-21.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,valid'><div id='lib:valid,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:valid,shared_future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='shared.future-22'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11053'>#</a></div><div class='texpara'><div id='shared.future-22.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> only if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> refers to a shared state<a class='hidden_link' href='#shared.future-22.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,wait'><div id='lib:wait,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait,shared_future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> wait<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='shared.future-23'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11064'>#</a></div><div class='texpara'><div id='shared.future-23.sentence-1' class='sentence'><a class='index' id=':block_(execution)___'></a><i >Effects</i>: Blocks until the shared state is ready<a class='hidden_link' href='#shared.future-23.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,wait_for'><div id='lib:wait_for,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait_for,shared_future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
  future_status wait_for<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> rel_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='shared.future-24'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11077'>#</a></div><div class='texpara'><div id='shared.future-24.sentence-1' class='sentence'><a class='index' id=':block_(execution)____'></a><i >Effects</i>: None if the shared state contains a deferred function (<a href='#async' title='33.10.9&emsp;Function template async'>[futures.<span class='shy'></span>async]</a>),
otherwise
blocks until the shared state is ready or until
the relative timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>) specified by
<span class='texttt'>rel_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#shared.future-24.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-25'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11086'>#</a></div><div class='texpara'><div id='shared.future-25.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='shared.future-25.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-25.1'>(25.1)</a></div><div class='texpara'><div id='shared.future-25.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#shared.future-25.1.sentence-1'>.</a></div></div></li><li id='shared.future-25.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-25.2'>(25.2)</a></div><div class='texpara'><div id='shared.future-25.2.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>ready</span> if the shared state is ready<a class='hidden_link' href='#shared.future-25.2.sentence-1'>.</a></div></div></li><li id='shared.future-25.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-25.3'>(25.3)</a></div><div class='texpara'><div id='shared.future-25.3.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>timeout</span> if the function is returning because the
relative timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)
specified by <span class='texttt'>rel_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#shared.future-25.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='shared.future-26'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11099'>#</a></div><div class='texpara'><div id='shared.future-26.sentence-1' class='sentence'><i >Throws</i>: timeout-related exceptions (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)<a class='hidden_link' href='#shared.future-26.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:shared_future,wait_until'><div id='lib:wait_until,shared_future'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:wait_until,shared_future'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Clock, <span class='keyword'>class</span> Duration<span class='anglebracket'>&gt;</span>
  future_status wait_until<span class='parenthesis'>(</span><span class='keyword'>const</span> chrono<span class='operator'>::</span>time_point<span class='anglebracket'>&lt;</span>Clock, Duration<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> abs_time<span class='parenthesis'>)</span> <span class='keyword'>const</span>;
</code></div></div></div></div><div class='para' id='shared.future-27'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11111'>#</a></div><div class='texpara'><div id='shared.future-27.sentence-1' class='sentence'><a class='index' id=':block_(execution)_____'></a><i >Effects</i>: None if the shared state contains a deferred function (<a href='#async' title='33.10.9&emsp;Function template async'>[futures.<span class='shy'></span>async]</a>),
otherwise
blocks until the shared state is ready or until the
absolute timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>) specified by
<span class='texttt'>abs_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#shared.future-27.sentence-1'>.</a></div></div></div></div><div class='para' id='shared.future-28'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-28'>28</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11120'>#</a></div><div class='texpara'><div id='shared.future-28.sentence-1' class='sentence'><i >Returns</i>: <ul class='itemize'><li id='shared.future-28.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-28.1'>(28.1)</a></div><div class='texpara'><div id='shared.future-28.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>deferred</span> if the shared state contains a deferred
function<a class='hidden_link' href='#shared.future-28.1.sentence-1'>.</a></div></div></li><li id='shared.future-28.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-28.2'>(28.2)</a></div><div class='texpara'><div id='shared.future-28.2.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>ready</span> if the shared state is ready<a class='hidden_link' href='#shared.future-28.2.sentence-1'>.</a></div></div></li><li id='shared.future-28.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#shared.future-28.3'>(28.3)</a></div><div class='texpara'><div id='shared.future-28.3.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>status<span class='operator'>&#x200b;::&#x200b;</span>timeout</span> if the function is returning because the
absolute timeout (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)
specified by <span class='texttt'>abs_<span class='shy'></span>time</span> has expired<a class='hidden_link' href='#shared.future-28.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='shared.future-29'><div class='marginalizedparent'><a class='marginalized' href='#shared.future-29'>29</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11133'>#</a></div><div class='texpara'><div id='shared.future-29.sentence-1' class='sentence'><i >Throws</i>: timeout-related exceptions (<a href='thread.req.timing' title='33.2.4&emsp;Timing specifications'>[thread.<span class='shy'></span>req.<span class='shy'></span>timing]</a>)<a class='hidden_link' href='#shared.future-29.sentence-1'>.</a></div></div></div></div></div><div id='async' class='section'><h3 ><a class='secnum' href='#async' style='min-width:80pt'>33.10.9</a> Function template <span class='texttt'>async</span> <a class='abbr_ref' href='futures.async'>[futures.async]</a></h3><div class='para' id='async-1'><div class='marginalizedparent'><a class='marginalized' href='#async-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11140'>#</a></div><div class='texpara'><div id='async-1.sentence-1' class='sentence'>The function template <span class='texttt'>async</span> provides a mechanism to launch a function potentially
in a new thread and provides the result of the function in a <span class='texttt'>future</span> object with which
it shares a shared state<a class='hidden_link' href='#async-1.sentence-1'>.</a></div></div></div><div class='texpara'><div id='lib:async'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:async'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> future<span class='anglebracket'>&lt;</span>invoke_result_t<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
    async<span class='parenthesis'>(</span>F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='squarebracket'>[</span><span class='squarebracket'>[</span>nodiscard<span class='squarebracket'>]</span><span class='squarebracket'>]</span> future<span class='anglebracket'>&lt;</span>invoke_result_t<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>
    async<span class='parenthesis'>(</span>launch policy, F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='async-2'><div class='marginalizedparent'><a class='marginalized' href='#async-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11156'>#</a></div><div class='texpara'><div id='async-2.sentence-1' class='sentence'><i >Mandates</i>: The following are all <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='async-2.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-2.1'>(2.1)</a></div><span class='texttt'>is_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, F<span class='anglebracket'>&gt;</span></span>,</li><li id='async-2.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span>is_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span>, Args<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>, and</li><li id='async-2.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-2.3'>(2.3)</a></div><span class='texttt'>is_<span class='shy'></span>invocable_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#async-2.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='async-3'><div class='marginalizedparent'><a class='marginalized' href='#async-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11165'>#</a></div><div class='texpara'><div id='async-3.sentence-1' class='sentence'><i >Effects</i>: The first function
behaves the same as a call to the second function with a <span class='texttt'>policy</span> argument of
<span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>async <span class='operator'>|</span> launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span>
and the same arguments for <span class='texttt'>F</span> and <span class='texttt'>Args</span><a class='hidden_link' href='#async-3.sentence-1'>.</a></div> <div id='async-3.sentence-2' class='sentence'>The second function creates a shared state that is associated with
the returned <span class='texttt'>future</span> object<a class='hidden_link' href='#async-3.sentence-2'>.</a></div> <div id='async-3.sentence-3' class='sentence'>The further behavior
of the second function depends on the <span class='texttt'>policy</span> argument as follows (if
more than one of these conditions applies, the implementation may choose any of
the corresponding policies):
<ul class='itemize'><li id='async-3.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-3.1'>(3.1)</a></div><div class='texpara'><div id='async-3.1.sentence-1' class='sentence'>If <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>async</span> is set in <span class='texttt'>policy</span>, calls
<span class='texttt'>invoke<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>for</span>ward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> (<a href='func.invoke' title='22.10.5&emsp;invoke functions'>[func.<span class='shy'></span>invoke]</a>, <a href='thread.thread.constr' title='33.4.3.3&emsp;Constructors'>[thread.<span class='shy'></span>thread.<span class='shy'></span>constr]</a>)
as if in a new thread of execution represented by a <span class='texttt'>thread</span> object
with the values produced by <span class='texttt'><span class='keyword'>auto</span></span>
being materialized (<a href='conv.rval' title='7.3.5&emsp;Temporary materialization conversion'>[conv.<span class='shy'></span>rval]</a>) in the thread that called <span class='texttt'>async</span><a class='hidden_link' href='#async-3.1.sentence-1'>.</a></div> <div id='async-3.1.sentence-2' class='sentence'>Any return value
is stored as the result in the
shared state<a class='hidden_link' href='#async-3.1.sentence-2'>.</a></div> <div id='async-3.1.sentence-3' class='sentence'>Any exception propagated from
the execution of
<span class='texttt'>invoke<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is stored as the exceptional result in the shared state<a class='hidden_link' href='#async-3.1.sentence-3'>.</a></div> <div id='async-3.1.sentence-4' class='sentence'>The <span class='texttt'>thread</span> object is
stored in the shared state
and affects the behavior of any asynchronous return objects that
reference that state<a class='hidden_link' href='#async-3.1.sentence-4'>.</a></div></div></li><li id='async-3.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-3.2'>(3.2)</a></div><div class='texpara'><div id='async-3.2.sentence-1' class='sentence'>If <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span> is set in <span class='texttt'>policy</span>,
stores <span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>for</span>ward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
in the shared state<a class='hidden_link' href='#async-3.2.sentence-1'>.</a></div> <div id='async-3.2.sentence-2' class='sentence'>These copies of <span class='texttt'>f</span> and <span class='texttt'>args</span> constitute
a <a class='hidden_link' href='#def:function,deferred' title='33.10.9&emsp;Function template async&emsp;[futures.async]'><span id='def:function,deferred'><i >deferred function</i></span></a><a class='hidden_link' href='#async-3.2.sentence-2'>.</a></div> <div id='async-3.2.sentence-3' class='sentence'>Invocation of the deferred function evaluates
<span class='texttt'>invoke<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>g<span class='parenthesis'>)</span>, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>xyz<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> where <span class='texttt'>g</span> is the stored value of
<span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and <span class='texttt'>xyz</span> is the stored copy of
<span class='texttt'><span class='keyword'>auto</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#async-3.2.sentence-3'>.</a></div> <div id='async-3.2.sentence-4' class='sentence'>Any return value is stored
as the result in the shared state<a class='hidden_link' href='#async-3.2.sentence-4'>.</a></div> <div id='async-3.2.sentence-5' class='sentence'>Any exception propagated
from the execution
of the deferred function
is stored as the exceptional result
in the shared state<a class='hidden_link' href='#async-3.2.sentence-5'>.</a></div> <div id='async-3.2.sentence-6' class='sentence'>The shared state is not
made ready until the function has completed<a class='hidden_link' href='#async-3.2.sentence-6'>.</a></div> <div id='async-3.2.sentence-7' class='sentence'>The first call to a
non-timed waiting function (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)
on an asynchronous return object referring to
this shared state invokes the
deferred function in the thread that called the waiting function<a class='hidden_link' href='#async-3.2.sentence-7'>.</a></div> <div id='async-3.2.sentence-8' class='sentence'>Once evaluation of <span class='texttt'>invoke<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>g<span class='parenthesis'>)</span>, std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>xyz<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> begins, the function is no longer
considered deferred<a class='hidden_link' href='#async-3.2.sentence-8'>.</a></div></div><div class='texpara'><div id='async-3.2.sentence-9' class='sentence'><i >Recommended practice</i>: If this policy is specified together with other policies, such as when using a
<span class='texttt'>policy</span> value of <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>async <span class='operator'>|</span> launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span>, implementations should defer
invocation or the selection of the policy when no more concurrency can be effectively
exploited<a class='hidden_link' href='#async-3.2.sentence-9'>.</a></div></div></li><li id='async-3.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-3.3'>(3.3)</a></div><div class='texpara'><div id='async-3.3.sentence-1' class='sentence'>If no value is set in the launch policy, or a value is set that is neither specified
in this document nor by the implementation, the behavior is undefined<a class='hidden_link' href='#async-3.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='para' id='async-4'><div class='marginalizedparent'><a class='marginalized' href='#async-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11231'>#</a></div><div class='texpara'><div id='async-4.sentence-1' class='sentence'><i >Synchronization</i>: The invocation of <span class='texttt'>async</span> synchronizes with the invocation of <span class='texttt'>f</span><a class='hidden_link' href='#async-4.sentence-1'>.</a></div> <div id='async-4.sentence-2' class='sentence'>The completion of the function <span class='texttt'>f</span> is sequenced before
the shared state is made ready<a class='hidden_link' href='#async-4.sentence-2'>.</a></div> <div id='async-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#async-note-1'>1</a></i>: <div id='async-4.sentence-3' class='sentence'>These apply regardless of the provided <span class='texttt'>policy</span> argument, and
even if the corresponding <span class='texttt'>future</span> object is moved to another thread<a class='hidden_link' href='#async-4.sentence-3'>.</a></div> <div id='async-4.sentence-4' class='sentence'>However, it is possible for <span class='texttt'>f</span> not to be called at all,
in which case its completion never happens<a class='hidden_link' href='#async-4.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div><div class='texpara'><div id='async-4.sentence-5' class='sentence'>If the implementation chooses the <span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>async</span> policy,
<ul class='itemize'><li id='async-4.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-4.1'>(4.1)</a></div>a call to a waiting function on an asynchronous return
object that shares the shared state created by this <span class='texttt'>async</span> call shall
block until the associated thread has completed, as if joined, or else time
out (<a href='thread.thread.member' title='33.4.3.6&emsp;Members'>[thread.<span class='shy'></span>thread.<span class='shy'></span>member]</a>);</li><li id='async-4.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-4.2'>(4.2)</a></div>the associated thread completion
<a href='intro.multithread#def:synchronize_with' title='6.9.2&emsp;Multi-threaded executions and data races&emsp;[intro.multithread]'>synchronizes with</a>
the return from
the first function
that successfully detects the ready status of the shared state or
with the return from the last
function that releases the shared state, whichever
happens first<a class='hidden_link' href='#async-4.sentence-5'>.</a></li></ul></div></div></div></div><div class='para' id='async-5'><div class='marginalizedparent'><a class='marginalized' href='#async-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11261'>#</a></div><div class='texpara'><div id='async-5.sentence-1' class='sentence'><i >Returns</i>: An object of type
<span class='texttt'>future<span class='anglebracket'>&lt;</span>invoke_<span class='shy'></span>result_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span>, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> that refers
to the shared state created by this call to <span class='texttt'>async</span><a class='hidden_link' href='#async-5.sentence-1'>.</a></div> <div id='async-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#async-note-2'>2</a></i>: <div id='async-5.sentence-2' class='sentence'>If a future obtained from <span class='texttt'>async</span> is moved outside the local scope,
the future's destructor can block for the shared state to become ready<a class='hidden_link' href='#async-5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='async-6'><div class='marginalizedparent'><a class='marginalized' href='#async-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11271'>#</a></div><div class='texpara'><div id='async-6.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>system_<span class='shy'></span>error</span> if <span class='texttt'>policy <span class='operator'>=</span><span class='operator'>=</span> launch<span class='operator'>&#x200b;::&#x200b;</span>async</span> and the
implementation is unable to start a new thread, or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>bad_<span class='shy'></span>alloc</span> if memory for the internal data structures
cannot be allocated<a class='hidden_link' href='#async-6.sentence-1'>.</a></div></div></div></div><div class='para' id='async-7'><div class='marginalizedparent'><a class='marginalized' href='#async-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11278'>#</a></div><div class='texpara'><div id='async-7.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='async-7.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#async-7.1'>(7.1)</a></div><span class='texttt'>resource_<span class='shy'></span>unavailable_<span class='shy'></span>try_<span class='shy'></span>again</span> — if
<span class='texttt'>policy <span class='operator'>=</span><span class='operator'>=</span> launch<span class='operator'>&#x200b;::&#x200b;</span>async</span> and the system is unable to start a new thread<a class='hidden_link' href='#async-7.sentence-1'>.</a></li></ul></div></div></div></div><div class='para nonNormativeOnly' id='async-8'><div class='marginalizedparent'><a class='marginalized' href='#async-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11286'>#</a></div><div class='texpara'><div id='async-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#async-example-1'>1</a></i>: <span class='codeblock'><span class='keyword'>int</span> work1<span class='parenthesis'>(</span><span class='keyword'>int</span> value<span class='parenthesis'>)</span>;
<span class='keyword'>int</span> work2<span class='parenthesis'>(</span><span class='keyword'>int</span> value<span class='parenthesis'>)</span>;
<span class='keyword'>int</span> work<span class='parenthesis'>(</span><span class='keyword'>int</span> value<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> handle <span class='operator'>=</span> std<span class='operator'>::</span>async<span class='parenthesis'>(</span><span class='squarebracket'>[</span><span class='operator'>=</span><span class='squarebracket'>]</span><span class='curlybracket'>{</span> <span class='keyword'>return</span> work2<span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>int</span> tmp <span class='operator'>=</span> work1<span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>;
  <span class='keyword'>return</span> tmp <span class='operator'>+</span> handle<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;    <span class='comment'>// #1</span>
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><div id='async-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#async-note-3'>3</a></i>: <div id='async-8.sentence-1' class='sentence'>Line #1 might not result in concurrency because
the <span class='texttt'>async</span> call uses the default policy, which might use
<span class='texttt'>launch<span class='operator'>&#x200b;::&#x200b;</span>deferred</span>, in which case the lambda might not be invoked until the
<span class='texttt'>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> call; in that case, <span class='texttt'>work1</span> and <span class='texttt'>work2</span> are called on the
same thread and there is no concurrency<a class='hidden_link' href='#async-8.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div> —&nbsp;<i>end example</i>]</div></div></div></div></div><div id='task' class='section'><h3 ><a class='secnum' href='#task' style='min-width:80pt'>33.10.10</a> Class template <span class='texttt'>packaged_<span class='shy'></span>task</span> <a class='abbr_ref' href='futures.task'>[futures.task]</a></h3><div id='task.general' class='section'><h4 ><a class='secnum' href='#task.general' style='min-width:95pt'>33.10.10.1</a> General <a class='abbr_ref' href='futures.task.general'>[futures.task.general]</a></h4><div class='para' id='task.general-1'><div class='marginalizedparent'><a class='marginalized' href='#task.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11311'>#</a></div><div class='texpara'><div id='task.general-1.sentence-1' class='sentence'>The class template <span class='texttt'>packaged_<span class='shy'></span>task</span> defines a type for wrapping a function or
callable object so that the return value of the function or callable object is stored in
a future when it is invoked<a class='hidden_link' href='#task.general-1.sentence-1'>.</a></div></div></div><div class='para' id='task.general-2'><div class='marginalizedparent'><a class='marginalized' href='#task.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11316'>#</a></div><div class='texpara'><div id='task.general-2.sentence-1' class='sentence'>When the <span class='texttt'>packaged_<span class='shy'></span>task</span> object is invoked, its stored task is invoked and the
result (whether normal or exceptional) stored in the shared state<a class='hidden_link' href='#task.general-2.sentence-1'>.</a></div> <div id='task.general-2.sentence-2' class='sentence'>Any futures that
share the shared state will then be able to access the stored result<a class='hidden_link' href='#task.general-2.sentence-2'>.</a></div></div><div class='texpara'><span id='lib:packaged_task'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> packaged_task;  <span class='comment'>// <i >not defined</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ArgTypes<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// construction and destruction</span>
    packaged_task<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F<span class='anglebracket'>&gt;</span>
      <span class='keyword'>explicit</span> packaged_task<span class='parenthesis'>(</span>F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f<span class='parenthesis'>)</span>;
    <span class='operator'>~</span>packaged_task<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// no copy</span>
    packaged_task<span class='parenthesis'>(</span><span class='keyword'>const</span> packaged_task<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    packaged_task<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> packaged_task<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

    <span class='comment'>// move support</span>
    packaged_task<span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    packaged_task<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='comment'>// result retrieval</span>
    future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// execution</span>
    <span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> <span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> make_ready_at_thread_exit<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ArgTypes<span class='anglebracket'>&gt;</span>
    packaged_task<span class='parenthesis'>(</span>R <span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F<span class='anglebracket'>&gt;</span> packaged_task<span class='parenthesis'>(</span>F<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> packaged_task<span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div></div></div><div id='task.members' class='section'><h4 ><a class='secnum' href='#task.members' style='min-width:95pt'>33.10.10.2</a> Member functions <a class='abbr_ref' href='futures.task.members'>[futures.task.members]</a></h4><div class='texpara'><div id='lib:packaged_task,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task,constructor'>🔗</a></div><code class='itemdeclcode'>packaged_task<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='task.members-1'><div class='marginalizedparent'><a class='marginalized' href='#task.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11371'>#</a></div><div class='texpara'><div id='task.members-1.sentence-1' class='sentence'><i >Effects</i>: The object has no shared state and no stored task<a class='hidden_link' href='#task.members-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,constructor_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task,constructor_'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F<span class='anglebracket'>&gt;</span>
  <span class='keyword'>explicit</span> packaged_task<span class='parenthesis'>(</span>F<span class='operator'>&amp;</span><span class='operator'>&amp;</span> f<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.members-2'><div class='marginalizedparent'><a class='marginalized' href='#task.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11383'>#</a></div><div class='texpara'><div id='task.members-2.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span></span>
is not the same type as <span class='texttt'>packaged_<span class='shy'></span>task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#task.members-2.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-3'><div class='marginalizedparent'><a class='marginalized' href='#task.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11388'>#</a></div><div class='texpara'><div id='task.members-3.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'>is_<span class='shy'></span>invocable_<span class='shy'></span>r_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>R, F<span class='operator'>&amp;</span>, ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#task.members-3.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-4'><div class='marginalizedparent'><a class='marginalized' href='#task.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11392'>#</a></div><div class='texpara'><div id='task.members-4.sentence-1' class='sentence'><i >Preconditions</i>: Invoking a copy of <span class='texttt'>f</span> behaves the same as invoking <span class='texttt'>f</span><a class='hidden_link' href='#task.members-4.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-5'><div class='marginalizedparent'><a class='marginalized' href='#task.members-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11396'>#</a></div><div class='texpara'><div id='task.members-5.sentence-1' class='sentence'><i >Effects</i>: Constructs a new <span class='texttt'>packaged_<span class='shy'></span>task</span> object with a shared state and
initializes the object's stored task with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>F<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.members-5.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-6'><div class='marginalizedparent'><a class='marginalized' href='#task.members-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11401'>#</a></div><div class='texpara'><div id='task.members-6.sentence-1' class='sentence'><i >Throws</i>: Any exceptions thrown by the copy or move constructor of <span class='texttt'>f</span>, or
<span class='texttt'>bad_<span class='shy'></span>alloc</span> if memory for the internal data structures
cannot be allocated<a class='hidden_link' href='#task.members-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,constructor__'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task,constructor__'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> F<span class='anglebracket'>&gt;</span> packaged_task<span class='parenthesis'>(</span>F<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> packaged_task<span class='anglebracket'>&lt;</span><i ><span class='texttt'>see below</span></i><span class='anglebracket'>&gt;</span>;
</code></div></div></div><div class='para' id='task.members-7'><div class='marginalizedparent'><a class='marginalized' href='#task.members-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11414'>#</a></div><div class='texpara'><div id='task.members-7.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><span class='operator'>&amp;</span>F<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is well-formed when
treated as an <a href='term.unevaluated.operand#def:unevaluated_operand'>unevaluated operand</a> and either
<ul class='itemize'><li id='task.members-7.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-7.1'>(7.1)</a></div><span class='texttt'>F<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is a non-static member function and
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>&#x200b;<span class='operator'>&amp;</span>F<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is either of the form
<span class='texttt'>R<span class='parenthesis'>(</span>G<span class='operator'>&#x200b;::&#x200b;</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>A<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> <span class='mathit'>cv</span> <span class='texttt'><span class='operator'>&amp;</span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span><span class='operator'> </span><span class='keyword'>noexcept</span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span></span>
or of the form
<span class='texttt'>R<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>G, A<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='operator'> </span><span class='keyword'>noexcept</span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span></span>
for a type <span class='texttt'>G</span>, or</li><li id='task.members-7.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-7.2'>(7.2)</a></div><span class='texttt'>F<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is a static member function and
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='operator'>&amp;</span>F<span class='operator'>&#x200b;::&#x200b;</span><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is of the form
<span class='texttt'>R<span class='parenthesis'>(</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>A<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span></span><a class='hidden_link' href='#task.members-7.sentence-1'>.</a></li></ul></div></div></div></div><div class='para' id='task.members-8'><div class='marginalizedparent'><a class='marginalized' href='#task.members-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11432'>#</a></div><div class='texpara'><div id='task.members-8.sentence-1' class='sentence'><i >Remarks</i>: The deduced type is <span class='texttt'>packaged_<span class='shy'></span>task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>A<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#task.members-8.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,constructor___'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task,constructor___'>🔗</a></div><code class='itemdeclcode'>packaged_task<span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='task.members-9'><div class='marginalizedparent'><a class='marginalized' href='#task.members-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11443'>#</a></div><div class='texpara'><div id='task.members-9.sentence-1' class='sentence'><i >Effects</i>: Transfers ownership of
<span class='texttt'>rhs</span>'s shared state to <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>, leaving <span class='texttt'>rhs</span> with no
shared state<a class='hidden_link' href='#task.members-9.sentence-1'>.</a></div> <div id='task.members-9.sentence-2' class='sentence'>Moves the stored task from <span class='texttt'>rhs</span> to <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.members-9.sentence-2'>.</a></div></div></div></div><div class='para' id='task.members-10'><div class='marginalizedparent'><a class='marginalized' href='#task.members-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11449'>#</a></div><div class='texpara'><div id='task.members-10.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>rhs</span> has no shared state<a class='hidden_link' href='#task.members-10.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,operator='><div id='lib:operator=,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator=,packaged_task'>🔗</a></div><code class='itemdeclcode'>packaged_task<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.members-11'><div class='marginalizedparent'><a class='marginalized' href='#task.members-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11460'>#</a></div><div class='texpara'><div id='task.members-11.sentence-1' class='sentence'><i >Effects</i>: <ul class='itemize'><li id='task.members-11.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-11.1'>(11.1)</a></div>Releases any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>);</li><li id='task.members-11.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-11.2'>(11.2)</a></div>calls <span class='texttt'>packaged_<span class='shy'></span>task<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rhs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>swap<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.members-11.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div id='lib:packaged_task,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:packaged_task,destructor'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>packaged_task<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='task.members-12'><div class='marginalizedparent'><a class='marginalized' href='#task.members-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11476'>#</a></div><div class='texpara'><div id='task.members-12.sentence-1' class='sentence'><i >Effects</i>: Abandons any shared state (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#task.members-12.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,swap'><div id='lib:swap,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,packaged_task'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>packaged_task<span class='operator'>&amp;</span> other<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.members-13'><div class='marginalizedparent'><a class='marginalized' href='#task.members-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11487'>#</a></div><div class='texpara'><div id='task.members-13.sentence-1' class='sentence'><i >Effects</i>: Exchanges the shared states and stored tasks of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and <span class='texttt'>other</span><a class='hidden_link' href='#task.members-13.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-14'><div class='marginalizedparent'><a class='marginalized' href='#task.members-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11491'>#</a></div><div class='texpara'><div id='task.members-14.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has the same shared state
and stored task (if any) as <span class='texttt'>other</span>
prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#task.members-14.sentence-1'>.</a></div> <div id='task.members-14.sentence-2' class='sentence'><span class='texttt'>other</span> has the same shared state
and stored task (if any)
as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> prior to the call to <span class='texttt'>swap</span><a class='hidden_link' href='#task.members-14.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,valid'><div id='lib:valid,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:valid,packaged_task'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> valid<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.members-15'><div class='marginalizedparent'><a class='marginalized' href='#task.members-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11506'>#</a></div><div class='texpara'><div id='task.members-15.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> only if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has a shared state<a class='hidden_link' href='#task.members-15.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:packaged_task,get_future'><div id='lib:get_future,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_future,packaged_task'>🔗</a></div><code class='itemdeclcode'>future<span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span> get_future<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.members-16'><div class='marginalizedparent'><a class='marginalized' href='#task.members-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11517'>#</a></div><div class='texpara'><div id='task.members-16.sentence-1' class='sentence'><i >Synchronization</i>: Calls to this function do not introduce
data races  (<a href='intro.multithread' title='6.9.2&emsp;Multi-threaded executions and data races'>[intro.<span class='shy'></span>multithread]</a>) with calls to
<span class='texttt'><span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> or
<span class='texttt'>make_<span class='shy'></span>ready_<span class='shy'></span>at_<span class='shy'></span>thread_<span class='shy'></span>exit</span><a class='hidden_link' href='#task.members-16.sentence-1'>.</a></div> <div id='task.members-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#task.members-note-1'>1</a></i>: <div id='task.members-16.sentence-2' class='sentence'>Such calls need not synchronize with each other<a class='hidden_link' href='#task.members-16.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='task.members-17'><div class='marginalizedparent'><a class='marginalized' href='#task.members-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11527'>#</a></div><div class='texpara'><div id='task.members-17.sentence-1' class='sentence'><i >Returns</i>: A <span class='texttt'>future</span> object that shares the same shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.members-17.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-18'><div class='marginalizedparent'><a class='marginalized' href='#task.members-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11531'>#</a></div><div class='texpara'><div id='task.members-18.sentence-1' class='sentence'><i >Throws</i>: A <span class='texttt'>future_<span class='shy'></span>error</span> object if an error occurs<a class='hidden_link' href='#task.members-18.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-19'><div class='marginalizedparent'><a class='marginalized' href='#task.members-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11535'>#</a></div><div class='texpara'><div id='task.members-19.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='task.members-19.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-19.1'>(19.1)</a></div><div class='texpara'><div id='task.members-19.1.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>already_<span class='shy'></span>retrieved</span> if <span class='texttt'>get_<span class='shy'></span>future</span> has already been called on
a <span class='texttt'>packaged_<span class='shy'></span>task</span> object with the same shared state as <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.members-19.1.sentence-1'>.</a></div></div></li><li id='task.members-19.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-19.2'>(19.2)</a></div><div class='texpara'><div id='task.members-19.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#task.members-19.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:packaged_task,operator()'><div id='lib:operator(),packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:operator(),packaged_task'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.members-20'><div class='marginalizedparent'><a class='marginalized' href='#task.members-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11550'>#</a></div><div class='texpara'><div id='task.members-20.sentence-1' class='sentence'><i >Effects</i>: As if by <span class='texttt'><i >INVOKE</i><span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span><span class='parenthesis'>)</span></span> (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>),
where <span class='texttt'>f</span> is the
stored task of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> and
<span class='texttt'>t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span> are the values in <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#task.members-20.sentence-1'>.</a></div> <div id='task.members-20.sentence-2' class='sentence'>If the task returns normally,
the return value is stored as the asynchronous result in the shared state of
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>, otherwise the exception thrown by the task is stored<a class='hidden_link' href='#task.members-20.sentence-2'>.</a></div> <div id='task.members-20.sentence-3' class='sentence'>The
shared state of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> is made ready, and any threads blocked in a
function waiting for
the shared state of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> to become ready are unblocked<a class='hidden_link' href='#task.members-20.sentence-3'>.</a></div></div></div></div><div class='para' id='task.members-21'><div class='marginalizedparent'><a class='marginalized' href='#task.members-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11562'>#</a></div><div class='texpara'><div id='task.members-21.sentence-1' class='sentence'><i >Throws</i>: A <span class='texttt'>future_<span class='shy'></span>error</span> exception object if there is no shared
state or the stored task has already been invoked<a class='hidden_link' href='#task.members-21.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-22'><div class='marginalizedparent'><a class='marginalized' href='#task.members-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11567'>#</a></div><div class='texpara'><div id='task.members-22.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='task.members-22.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-22.1'>(22.1)</a></div><div class='texpara'><div id='task.members-22.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if
the stored task has already been invoked<a class='hidden_link' href='#task.members-22.1.sentence-1'>.</a></div></div></li><li id='task.members-22.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-22.2'>(22.2)</a></div><div class='texpara'><div id='task.members-22.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#task.members-22.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:packaged_task,make_ready_at_thread_exit'><div id='lib:make_ready_at_thread_exit,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:make_ready_at_thread_exit,packaged_task'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> make_ready_at_thread_exit<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.members-23'><div class='marginalizedparent'><a class='marginalized' href='#task.members-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11582'>#</a></div><div class='texpara'><div id='task.members-23.sentence-1' class='sentence'><i >Effects</i>: As if by <span class='texttt'><i >INVOKE</i><span class='anglebracket'>&lt;</span>R<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>f, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span><span class='parenthesis'>)</span></span> (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>),
where <span class='texttt'>f</span> is the stored task and
<span class='texttt'>t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span></span>, <span class='math'>&hellip;</span>, t<span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em; padding-right: 0.085em;">N</span></span></span></span></span></span></span></span> are the values in <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#task.members-23.sentence-1'>.</a></div> <div id='task.members-23.sentence-2' class='sentence'>If the task returns normally,
the return value is stored as the asynchronous result in the shared state of
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>, otherwise the exception thrown by the task is stored<a class='hidden_link' href='#task.members-23.sentence-2'>.</a></div> <div id='task.members-23.sentence-3' class='sentence'>In either
case, this is done without making that state ready (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>) immediately<a class='hidden_link' href='#task.members-23.sentence-3'>.</a></div> <div id='task.members-23.sentence-4' class='sentence'>Schedules
the shared state to be made ready when the current thread exits,
after all objects of thread storage duration associated with the current thread
have been destroyed<a class='hidden_link' href='#task.members-23.sentence-4'>.</a></div></div></div></div><div class='para' id='task.members-24'><div class='marginalizedparent'><a class='marginalized' href='#task.members-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11594'>#</a></div><div class='texpara'><div id='task.members-24.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>future_<span class='shy'></span>error</span> if an error condition occurs<a class='hidden_link' href='#task.members-24.sentence-1'>.</a></div></div></div></div><div class='para' id='task.members-25'><div class='marginalizedparent'><a class='marginalized' href='#task.members-25'>25</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11598'>#</a></div><div class='texpara'><div id='task.members-25.sentence-1' class='sentence'><i >Error conditions</i>: <ul class='itemize'><li id='task.members-25.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-25.1'>(25.1)</a></div><div class='texpara'><div id='task.members-25.1.sentence-1' class='sentence'><span class='texttt'>promise_<span class='shy'></span>already_<span class='shy'></span>satisfied</span> if the
stored task has already been invoked<a class='hidden_link' href='#task.members-25.1.sentence-1'>.</a></div></div></li><li id='task.members-25.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-25.2'>(25.2)</a></div><div class='texpara'><div id='task.members-25.2.sentence-1' class='sentence'><span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> has no shared state<a class='hidden_link' href='#task.members-25.2.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:packaged_task,reset'><div id='lib:reset,packaged_task'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:reset,packaged_task'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='task.members-26'><div class='marginalizedparent'><a class='marginalized' href='#task.members-26'>26</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11613'>#</a></div><div class='texpara'><div id='task.members-26.sentence-1' class='sentence'><i >Effects</i>: As if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span> <span class='operator'>=</span> packaged_<span class='shy'></span>task<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, where
<span class='texttt'>f</span> is the task stored in
<span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.members-26.sentence-1'>.</a></div> <div id='task.members-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#task.members-note-2'>2</a></i>: <div id='task.members-26.sentence-2' class='sentence'>This constructs a new shared state for <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#task.members-26.sentence-2'>.</a></div> <div id='task.members-26.sentence-3' class='sentence'>The
old state is abandoned (<a href='#state' title='33.10.5&emsp;Shared state'>[futures.<span class='shy'></span>state]</a>)<a class='hidden_link' href='#task.members-26.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='task.members-27'><div class='marginalizedparent'><a class='marginalized' href='#task.members-27'>27</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11623'>#</a></div><div class='texpara'><div id='task.members-27.sentence-1' class='sentence'><i >Throws</i>: <ul class='itemize'><li id='task.members-27.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-27.1'>(27.1)</a></div><div class='texpara'><div id='task.members-27.1.sentence-1' class='sentence'><span class='texttt'>bad_<span class='shy'></span>alloc</span> if memory for the new shared state cannot be allocated<a class='hidden_link' href='#task.members-27.1.sentence-1'>.</a></div></div></li><li id='task.members-27.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-27.2'>(27.2)</a></div><div class='texpara'><div id='task.members-27.2.sentence-1' class='sentence'>Any exception thrown by the move constructor of the task stored in the shared
state<a class='hidden_link' href='#task.members-27.2.sentence-1'>.</a></div></div></li><li id='task.members-27.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#task.members-27.3'>(27.3)</a></div><div class='texpara'><div id='task.members-27.3.sentence-1' class='sentence'><span class='texttt'>future_<span class='shy'></span>error</span> with an error condition of <span class='texttt'>no_<span class='shy'></span>state</span> if <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>
has no shared state<a class='hidden_link' href='#task.members-27.3.sentence-1'>.</a></div></div></li></ul></div></div></div></div></div><div id='task.nonmembers' class='section'><h4 ><a class='secnum' href='#task.nonmembers' style='min-width:95pt'>33.10.10.3</a> Globals <a class='abbr_ref' href='futures.task.nonmembers'>[futures.task.nonmembers]</a></h4><div class='texpara'><div id='lib:packaged_task,swap_'><div id='lib:swap,packaged_task_'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,packaged_task_'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> R, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ArgTypes<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> x, packaged_task<span class='anglebracket'>&lt;</span>R<span class='parenthesis'>(</span>ArgTypes<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> y<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='task.nonmembers-1'><div class='marginalizedparent'><a class='marginalized' href='#task.nonmembers-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/a272b7cd04dc0be488250a0c6aaead160e778774/source/threads.tex#L11643'>#</a></div><div class='texpara'><div id='task.nonmembers-1.sentence-1' class='sentence'><i >Effects</i>: As if by <span class='texttt'>x<span class='operator'>.</span>swap<span class='parenthesis'>(</span>y<span class='parenthesis'>)</span></span><a class='hidden_link' href='#task.nonmembers-1.sentence-1'>.</a></div></div></div></div></div></div></div></body></html>