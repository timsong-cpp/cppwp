<!DOCTYPE html><html lang='en'><head><title>[diff.cpp11]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:50pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>C.5</a> C++ and ISO C++ 2011 <a class='abbr_ref'>[diff.cpp11]</a></h2><div id='general' class='section'><h3 ><a class='secnum' href='#general' style='min-width:80pt'>C.5.1</a> General <a class='abbr_ref' href='diff.cpp11.general'>[diff.cpp11.general]</a></h3><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1846'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'><a class='index' id=':summary,compatibility_with_ISO_C++_2011'></a>Subclause [diff.<span class='shy'></span>cpp11] lists the differences between C++ and
ISO C++ 2011,
in addition to those listed above,
by the chapters of this document<a class='hidden_link' href='#general-1.sentence-1'>.</a></div></div></div></div><div id='lex' class='section'><h3 ><a class='secnum' href='#lex' style='min-width:80pt'>C.5.2</a> <a href='lex' title='5&emsp;Lexical conventions'>[lex]</a>: lexical conventions <a class='abbr_ref' href='diff.cpp11.lex'>[diff.cpp11.lex]</a></h3><div class='para' id='lex-1'><div class='marginalizedparent'><a class='marginalized' href='#lex-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1855'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='lex.ppnumber'>[lex.<span class='shy'></span>ppnumber]</a>
<br/> <div id='lex-1.sentence-1' class='sentence'><b>Change:</b> <a href='lex.ppnumber#nt:pp-number' title='5.7&emsp;Preprocessing numbers&emsp;[lex.ppnumber]'><span id='ntref:pp-number'><span class='textsf'><i >pp-number</i></span></span></a> can contain one or more single quotes<a class='hidden_link' href='#lex-1.sentence-1'>.</a></div> <br/> <div id='lex-1.sentence-2' class='sentence'><b>Rationale:</b> Necessary to enable single quotes as digit separators<a class='hidden_link' href='#lex-1.sentence-2'>.</a></div> <br/> <div id='lex-1.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code may fail to compile or may change meaning in this
revision of C++<a class='hidden_link' href='#lex-1.sentence-3'>.</a></div> <div id='lex-1.sentence-4' class='sentence'>For example, the following code is valid both in C++ 2011 and in
this revision of C++, but the macro invocation produces different outcomes
because the single quotes delimit a <a href='lex.ccon#nt:character-literal' title='5.13.3&emsp;Character literals&emsp;[lex.ccon]'><span id='ntref:character-literal'><span class='textsf'><i >character-literal</i></span></span></a> in C++ 2011, whereas they are digit
separators in this revision of C++<a class='hidden_link' href='#lex-1.sentence-4'>.</a></div> <div id='lex-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#lex-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='preprocessordirective'>#define</span> M<span class='parenthesis'>(</span>x, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> __VA_ARGS__
<span class='keyword'>int</span> x<span class='squarebracket'>[</span><span class='literal'>2</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> M<span class='parenthesis'>(</span><span class='literal'>1'2</span>,<span class='literal'>3'4</span>, <span class='literal'>5</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>;
<span class='comment'>// <span class='tcode_in_codeblock'>int x[2] = { 5 };&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> --- C++ 2011</span>
<span class='comment'>// <span class='tcode_in_codeblock'>int x[2] = { 3'4, 5 };</span> --- this revision of C++</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div></div><div id='basic' class='section'><h3 ><a class='secnum' href='#basic' style='min-width:80pt'>C.5.3</a> <a href='basic' title='6&emsp;Basics'>[basic]</a>: basics <a class='abbr_ref' href='diff.cpp11.basic'>[diff.cpp11.basic]</a></h3><div class='para' id='basic-1'><div class='marginalizedparent'><a class='marginalized' href='#basic-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1877'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='basic.stc.dynamic.deallocation'>[basic.<span class='shy'></span>stc.<span class='shy'></span>dynamic.<span class='shy'></span>deallocation]</a>
<br/> <div id='basic-1.sentence-1' class='sentence'><b>Change:</b> New usual (non-placement) deallocator<a class='hidden_link' href='#basic-1.sentence-1'>.</a></div> <br/> <div id='basic-1.sentence-2' class='sentence'><b>Rationale:</b> Required for sized deallocation<a class='hidden_link' href='#basic-1.sentence-2'>.</a></div> <br/> <div id='basic-1.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code can declare a global placement allocation function and
deallocation function as follows:
<span class='codeblock'><span class='keyword'>void</span><span class='operator'>*</span> <span class='keyword'>operator</span> <span class='keyword'>new</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>size_t, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span>;
<span class='keyword'>void</span> <span class='keyword'>operator</span> <span class='keyword'>delete</span><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span>, std<span class='operator'>::</span>size_t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</span></div> <div id='basic-1.sentence-4' class='sentence'>
In this revision of C++, however, the declaration of <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>delete</span></span>
might match a predefined usual (non-placement)
<span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>delete</span></span> (<a href='basic.stc.dynamic' title='6.7.6.5&emsp;Dynamic storage duration'>[basic.<span class='shy'></span>stc.<span class='shy'></span>dynamic]</a>)<a class='hidden_link' href='#basic-1.sentence-4'>.</a></div> <div id='basic-1.sentence-5' class='sentence'>If so, the
program is ill-formed, as it was for class member allocation functions and
deallocation functions (<a href='expr.new' title='7.6.2.8&emsp;New'>[expr.<span class='shy'></span>new]</a>)<a class='hidden_link' href='#basic-1.sentence-5'>.</a></div></div></div></div><div id='expr' class='section'><h3 ><a class='secnum' href='#expr' style='min-width:80pt'>C.5.4</a> <a href='expr' title='7&emsp;Expressions'>[expr]</a>: expressions <a class='abbr_ref' href='diff.cpp11.expr'>[diff.cpp11.expr]</a></h3><div class='para' id='expr-1'><div class='marginalizedparent'><a class='marginalized' href='#expr-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1897'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='expr.cond'>[expr.<span class='shy'></span>cond]</a>
<br/> <div id='expr-1.sentence-1' class='sentence'><b>Change:</b> A conditional expression with a throw expression as its second or third
operand keeps the type and value category of the other operand<a class='hidden_link' href='#expr-1.sentence-1'>.</a></div> <br/> <div id='expr-1.sentence-2' class='sentence'><b>Rationale:</b> Formerly mandated conversions (<a href='conv.lval' title='7.3.2&emsp;Lvalue-to-rvalue conversion&emsp;[conv.lval]'>lvalue-to-rvalue</a>,
<a href='conv.array' title='7.3.3&emsp;Array-to-pointer conversion&emsp;[conv.array]'>array-to-pointer</a>, and <a href='conv.func' title='7.3.4&emsp;Function-to-pointer conversion&emsp;[conv.func]'>function-to-pointer</a>
standard conversions), especially the creation of the temporary due to
lvalue-to-rvalue conversion, were considered gratuitous and surprising<a class='hidden_link' href='#expr-1.sentence-2'>.</a></div> <br/> <div id='expr-1.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code that relies on the conversions may behave differently
in this revision of C++<a class='hidden_link' href='#expr-1.sentence-3'>.</a></div> <div id='expr-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#expr-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> S <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>1</span>;
  <span class='keyword'>void</span> mf<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> x <span class='operator'>=</span> <span class='literal'>2</span>; <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
<span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='keyword'>bool</span> cond<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  S s;
  <span class='parenthesis'>(</span>cond <span class='operator'>?</span> s <span class='operator'>:</span> <span class='keyword'>throw</span> <span class='literal'>0</span><span class='parenthesis'>)</span><span class='operator'>.</span>mf<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span> s<span class='operator'>.</span>x;
<span class='curlybracket'>}</span>
</span> <div id='expr-1.sentence-4' class='sentence'>
In C++ 2011, <span class='texttt'>f<span class='parenthesis'>(</span><span class='literal'>true</span><span class='parenthesis'>)</span></span> returns <span class='texttt'><span class='literal'>1</span></span><a class='hidden_link' href='#expr-1.sentence-4'>.</a></div> <div id='expr-1.sentence-5' class='sentence'>In this revision of C++,
it returns <span class='texttt'><span class='literal'>2</span></span><a class='hidden_link' href='#expr-1.sentence-5'>.</a></div> <span class='codeblock'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='literal'>true</span> <span class='operator'>?</span> <span class='literal'>""</span> <span class='operator'>:</span> <span class='keyword'>throw</span> <span class='literal'>0</span><span class='parenthesis'>)</span>
</span> <div id='expr-1.sentence-6' class='sentence'>
In C++ 2011, the expression yields <span class='texttt'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expr-1.sentence-6'>.</a></div> <div id='expr-1.sentence-7' class='sentence'>In this
revision of C++, it yields <span class='texttt'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>char</span><span class='squarebracket'>[</span><span class='literal'>1</span><span class='squarebracket'>]</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expr-1.sentence-7'>.</a></div> â€”&nbsp;<i>end example</i>]</div></div></div></div></div><div id='dcl.dcl' class='section'><h3 ><a class='secnum' href='#dcl.dcl' style='min-width:80pt'>C.5.5</a> <a href='dcl.dcl' title='9&emsp;Declarations'>[dcl.<span class='shy'></span>dcl]</a>: declarations <a class='abbr_ref' href='diff.cpp11.dcl.dcl'>[diff.cpp11.dcl.dcl]</a></h3><div class='para' id='dcl.dcl-1'><div class='marginalizedparent'><a class='marginalized' href='#dcl.dcl-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1932'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='dcl.constexpr'>[dcl.<span class='shy'></span>constexpr]</a>
<br/> <div id='dcl.dcl-1.sentence-1' class='sentence'><b>Change:</b> <span id=':constexpr'><span class='texttt'><span class='keyword'>constexpr</span></span></span> non-static member functions are not implicitly
<span id=':const'><span class='texttt'><span class='keyword'>const</span></span></span> member functions<a class='hidden_link' href='#dcl.dcl-1.sentence-1'>.</a></div> <br/> <div id='dcl.dcl-1.sentence-2' class='sentence'><b>Rationale:</b> Necessary to allow <span id=':constexpr_'><span class='texttt'><span class='keyword'>constexpr</span></span></span> member functions to mutate
the object<a class='hidden_link' href='#dcl.dcl-1.sentence-2'>.</a></div> <br/> <div id='dcl.dcl-1.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code may fail to compile in this revision of C++<a class='hidden_link' href='#dcl.dcl-1.sentence-3'>.</a></div> <div id='dcl.dcl-example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#dcl.dcl-example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> S <span class='curlybracket'>{</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>const</span> <span class='keyword'>int</span> <span class='operator'>&amp;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>int</span> <span class='operator'>&amp;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span> <div id='dcl.dcl-1.sentence-4' class='sentence'>
This code is valid in C++ 2011
but invalid in this revision of C++ because it declares the same member
function twice with different return types<a class='hidden_link' href='#dcl.dcl-1.sentence-4'>.</a></div> â€”&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='dcl.dcl-2'><div class='marginalizedparent'><a class='marginalized' href='#dcl.dcl-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1953'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='dcl.init.aggr'>[dcl.<span class='shy'></span>init.<span class='shy'></span>aggr]</a>
<br/> <div id='dcl.dcl-2.sentence-1' class='sentence'><b>Change:</b> Classes with default member initializers can be aggregates<a class='hidden_link' href='#dcl.dcl-2.sentence-1'>.</a></div> <br/> <div id='dcl.dcl-2.sentence-2' class='sentence'><b>Rationale:</b> Necessary to allow default member initializers to be used
by aggregate initialization<a class='hidden_link' href='#dcl.dcl-2.sentence-2'>.</a></div> <br/> <div id='dcl.dcl-2.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code may fail to compile or may change meaning in this revision of C++<a class='hidden_link' href='#dcl.dcl-2.sentence-3'>.</a></div> <div id='dcl.dcl-example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#dcl.dcl-example-2'>2</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> S <span class='curlybracket'>{</span>          <span class='comment'>// Aggregate in C++ 2014 onwards.</span>
  <span class='keyword'>int</span> m <span class='operator'>=</span> <span class='literal'>1</span>;
<span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> X <span class='curlybracket'>{</span>
  <span class='keyword'>operator</span> <span class='keyword'>int</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>operator</span> S<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
X a<span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
S b<span class='curlybracket'>{</span>a<span class='curlybracket'>}</span>;             <span class='comment'>// uses copy constructor in C++ 2011,</span>
                    <span class='comment'>// performs aggregate initialization in this revision of C++</span>
</span> â€”&nbsp;<i>end example</i>]</div></div></div></div></div><div id='library' class='section'><h3 ><a class='secnum' href='#library' style='min-width:80pt'>C.5.6</a> <a href='library' title='16&emsp;Library introduction'>[library]</a>: library introduction <a class='abbr_ref' href='diff.cpp11.library'>[diff.cpp11.library]</a></h3><div class='para' id='library-1'><div class='marginalizedparent'><a class='marginalized' href='#library-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1978'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='headers'>[headers]</a>
<br/> <div id='library-1.sentence-1' class='sentence'><b>Change:</b> New header<a class='hidden_link' href='#library-1.sentence-1'>.</a></div> <br/> <div id='library-1.sentence-2' class='sentence'><b>Rationale:</b> New functionality<a class='hidden_link' href='#library-1.sentence-2'>.</a></div> <br/> <div id='library-1.sentence-3' class='sentence'><b>Effect on original feature:</b> The C++ header <a href='shared.mutex.syn#header:%3cshared_mutex%3e' title='32.6.3&emsp;Header &lt;shared_&shy;mutex&gt; synopsis&emsp;[shared.mutex.syn]'><span id='headerref:<shared_mutex>'><span class='texttt'>&lt;shared_<span class='shy'></span>mutex&gt;</span></span></a> is new<a class='hidden_link' href='#library-1.sentence-3'>.</a></div> <div id='library-1.sentence-4' class='sentence'>Valid C++ 2011 code that <span class='texttt'><span class='preprocessordirective'>#include</span></span>s a header with that name may be
invalid in this revision of C++<a class='hidden_link' href='#library-1.sentence-4'>.</a></div></div></div></div><div id='input.output' class='section'><h3 ><a class='secnum' href='#input.output' style='min-width:80pt'>C.5.7</a> <a href='input.output' title='31&emsp;Input/output library'>[input.<span class='shy'></span>output]</a>: input/output library <a class='abbr_ref' href='diff.cpp11.input.output'>[diff.cpp11.input.output]</a></h3><div class='para' id='input.output-1'><div class='marginalizedparent'><a class='marginalized' href='#input.output-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/compatibility.tex#L1990'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='c.files'>[c.<span class='shy'></span>files]</a>
<br/> <div id='input.output-1.sentence-1' class='sentence'><b>Change:</b> <span class='texttt'>gets</span> is not defined<a class='hidden_link' href='#input.output-1.sentence-1'>.</a></div> <br/> <div id='input.output-1.sentence-2' class='sentence'><b>Rationale:</b> Use of <span class='texttt'>gets</span> is considered dangerous<a class='hidden_link' href='#input.output-1.sentence-2'>.</a></div> <br/> <div id='input.output-1.sentence-3' class='sentence'><b>Effect on original feature:</b> Valid C++ 2011 code that uses the <span class='texttt'>gets</span> function may fail to compile
in this revision of C++<a class='hidden_link' href='#input.output-1.sentence-3'>.</a></div></div></div></div></div></body></html>