<!DOCTYPE html><html lang='en'><head><title>[algorithms.parallel]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>25</a> Algorithms library <a class='abbr_ref' href='./#algorithms'>[algorithms]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>25.3</a> Parallel algorithms <a class='abbr_ref'>[algorithms.parallel]</a></h2><div id='defns' class='section'><h3 ><a class='secnum' href='#defns' style='min-width:103pt'>25.3.1</a> Preamble <a class='abbr_ref' href='algorithms.parallel.defns'>[algorithms.parallel.defns]</a></h3><div class='para' id='defns-1'><div class='marginalizedparent'><a class='marginalized' href='#defns-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L271'>#</a></div><div id='defns-1.sentence-1' class='sentence'>Subclause <a href='#algorithms.parallel'>[algorithms.parallel]</a> describes components that C++ programs may use
to perform operations on containers and other sequences in parallel<a class='hidden_link' href='#defns-1.sentence-1'>.</a></div></div><div class='para' id='defns-2'><div class='marginalizedparent'><a class='marginalized' href='#defns-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L275'>#</a></div><div id='defns-2.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:parallel_algorithm' id='def:parallel_algorithm'><i >parallel algorithm</i></a> is a function template listed in this document
with a template parameter named <span class='texttt'>ExecutionPolicy</span><a class='hidden_link' href='#defns-2.sentence-1'>.</a></div></div><div class='para' id='defns-3'><div class='marginalizedparent'><a class='marginalized' href='#defns-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L279'>#</a></div><div id='defns-3.sentence-1' class='sentence'>Parallel algorithms access objects indirectly accessible via their arguments
by invoking the following functions:
<ul class='itemize'><li id='defns-3.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#defns-3.1'>(3.1)</a></div>All operations of the categories of the iterators
  that the algorithm is instantiated with.</li><li id='defns-3.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#defns-3.2'>(3.2)</a></div>Operations on those sequence elements that are required by its specification.</li><li id='defns-3.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#defns-3.3'>(3.3)</a></div>User-provided function objects
  to be applied during the execution of the algorithm,
  if required by the specification.</li><li id='defns-3.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#defns-3.4'>(3.4)</a></div>Operations on those function objects required by the specification. <div id='defns-3.4.note-1' class='note'>[&nbsp;<a class='note_link' href='#defns-3.4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> See <a href='algorithms.requirements'>[algorithms.requirements]</a>. —&nbsp;<i>end note</i></div>&nbsp;]</div> </li></ul>
These functions are herein called <a class='hidden_link' href='#def:element_access_functions' id='def:element_access_functions'><i >element access functions</i></a><a class='hidden_link' href='#defns-3.sentence-1'>.</a></div> <div id='defns-3.example-1' class='example'>[&nbsp;<a class='example_link' href='#defns-3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='defns-3.sentence-2' class='sentence'>The <span class='texttt'>sort</span> function may invoke the following element access functions:
<ul class='itemize'><li >Operations of the random-access iterator of the actual template argument
  (as per <a href='random.access.iterators'>[random.access.iterators]</a>),
  as implied by the name of the template parameter <span class='texttt'>RandomAccessIterator</span>.</li><li >The <span class='texttt'>swap</span> function on the elements of the sequence
  (as per the preconditions specified in <a href='sort'>[sort]</a>).</li><li >The user-provided <span class='texttt'>Compare</span> function object.</li></ul></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='defns-4'><div class='marginalizedparent'><a class='marginalized' href='#defns-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L314'>#</a></div><div id='defns-4.sentence-1' class='sentence'>A standard library function is <a class='hidden_link' href='#def:vectorization-unsafe' id='def:vectorization-unsafe'><i >vectorization-unsafe</i></a>
if it is specified to synchronize with another function invocation, or
another function invocation is specified to synchronize with it,
and if it is not a memory allocation or deallocation function<a class='hidden_link' href='#defns-4.sentence-1'>.</a></div> <div id='defns-4.note-1' class='note'>[&nbsp;<a class='note_link' href='#defns-4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='defns-4.sentence-2' class='sentence'>Implementations must ensure that internal synchronization
inside standard library functions does not prevent forward progress
when those functions are executed by threads of execution
with weakly parallel forward progress guarantees<a class='hidden_link' href='#defns-4.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='defns-4.example-1' class='example'>[&nbsp;<a class='example_link' href='#defns-4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>0</span>;
std<span class='operator'>::</span>mutex m;
<span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>1</span>,<span class='literal'>2</span><span class='curlybracket'>}</span>;
  std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par_unseq, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    std<span class='operator'>::</span>lock_guard<span class='anglebracket'>&lt;</span>mutex<span class='anglebracket'>&gt;</span> guard<span class='parenthesis'>(</span>m<span class='parenthesis'>)</span>;            <span class='comment'>// incorrect: <span class='tcode_in_codeblock'>lock_&shy;guard</span> constructor calls <span class='tcode_in_codeblock'>m.lock()</span></span>
  <span class='operator'>+</span><span class='operator'>+</span>x;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</pre> <div id='defns-4.sentence-3' class='sentence'>
The above program may result in two consecutive calls to <span class='texttt'>m<span class='operator'>.</span>lock<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
on the same thread of execution (which may deadlock),
because the applications of the function object are not guaranteed
to run on different threads of execution<a class='hidden_link' href='#defns-4.sentence-3'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div><div id='user' class='section'><h3 ><a class='secnum' href='#user' style='min-width:103pt'>25.3.2</a> Requirements on user-provided function objects <a class='abbr_ref' href='algorithms.parallel.user'>[algorithms.parallel.user]</a></h3><div class='para' id='user-1'><div class='marginalizedparent'><a class='marginalized' href='#user-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L345'>#</a></div><div id='user-1.sentence-1' class='sentence'>Unless otherwise specified,
function objects passed into parallel algorithms as objects of type
<span class='texttt'>Predicate</span>,
<span class='texttt'>BinaryPredicate</span>,
<span class='texttt'>Compare</span>,
<span class='texttt'>UnaryOperation</span>,
<span class='texttt'>BinaryOperation</span>,
<span class='texttt'>BinaryOperation1</span>,
<span class='texttt'>BinaryOperation2</span>, and
the operators used by the analogous overloads to these parallel algorithms
that could be formed by the invocation
with the specified default predicate or operation (where applicable)
shall not directly or indirectly modify objects via their arguments,
nor shall they rely on the identity of the provided objects<a class='hidden_link' href='#user-1.sentence-1'>.</a></div></div></div><div id='exec' class='section'><h3 ><a class='secnum' href='#exec' style='min-width:103pt'>25.3.3</a> Effect of execution policies on algorithm execution <a class='abbr_ref' href='algorithms.parallel.exec'>[algorithms.parallel.exec]</a></h3><div class='para' id='exec-1'><div class='marginalizedparent'><a class='marginalized' href='#exec-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L363'>#</a></div><div id='exec-1.sentence-1' class='sentence'>Parallel algorithms have
template parameters named <span class='texttt'>ExecutionPolicy</span> (<a href='execpol'>[execpol]</a>)
which describe the manner in which the execution of these algorithms may be
parallelized and the manner in which they apply the element access functions<a class='hidden_link' href='#exec-1.sentence-1'>.</a></div></div><div class='para' id='exec-2'><div class='marginalizedparent'><a class='marginalized' href='#exec-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L369'>#</a></div><div id='exec-2.sentence-1' class='sentence'>If an object is modified by an element access function,
the algorithm will perform no other unsynchronized accesses to that object<a class='hidden_link' href='#exec-2.sentence-1'>.</a></div> <div id='exec-2.sentence-2' class='sentence'>The modifying element access functions are those
which are specified as modifying the object<a class='hidden_link' href='#exec-2.sentence-2'>.</a></div> <div id='exec-2.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-2.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-2.sentence-3' class='sentence'>For example,
<span class='texttt'>swap</span>,
<span class='texttt'><span class='operator'>+</span><span class='operator'>+</span></span>,
<span class='texttt'><span class='operator'>-</span><span class='operator'>-</span></span>,
<span class='texttt'>@<span class='operator'>=</span></span>, and
assignments
modify the object<a class='hidden_link' href='#exec-2.sentence-3'>.</a></div> <div id='exec-2.sentence-4' class='sentence'>For the assignment and <span class='texttt'>@<span class='operator'>=</span></span> operators, only the left argument is modified<a class='hidden_link' href='#exec-2.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-3'><div class='marginalizedparent'><a class='marginalized' href='#exec-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L385'>#</a></div><div id='exec-3.sentence-1' class='sentence'>Unless otherwise stated, implementations may make arbitrary copies of elements
(with type <span class='texttt'>T</span>) from sequences
where <span class='texttt'>is_&shy;trivially_&shy;copy_&shy;constructible_&shy;v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span>
and <span class='texttt'>is_&shy;trivially_&shy;destructible_&shy;v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> are <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec-3.sentence-1'>.</a></div> <div id='exec-3.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-3.sentence-2' class='sentence'>This implies that user-supplied function objects should not rely on
object identity of arguments for such input sequences<a class='hidden_link' href='#exec-3.sentence-2'>.</a></div> <div id='exec-3.sentence-3' class='sentence'>Users for whom the object identity of the arguments to these function objects
is important should consider using a wrapping iterator
that returns a non-copied implementation object
such as <span class='texttt'>reference_&shy;wrapper<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> (<a href='refwrap'>[refwrap]</a>)
or some equivalent solution<a class='hidden_link' href='#exec-3.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-4'><div class='marginalizedparent'><a class='marginalized' href='#exec-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L400'>#</a></div><div id='exec-4.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>sequenced_&shy;policy</span> all occur
in the calling thread of execution<a class='hidden_link' href='#exec-4.sentence-1'>.</a></div> <div id='exec-4.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-4.sentence-2' class='sentence'>The invocations are not interleaved; see <a href='intro.execution'>[intro.execution]</a><a class='hidden_link' href='#exec-4.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-5'><div class='marginalizedparent'><a class='marginalized' href='#exec-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L408'>#</a></div><div id='exec-5.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_&shy;policy</span>
are permitted to execute in an unordered fashion
in the calling thread of execution,
unsequenced with respect to one another in the calling thread of execution<a class='hidden_link' href='#exec-5.sentence-1'>.</a></div> <div id='exec-5.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-5.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-5.sentence-2' class='sentence'>This means that multiple function object invocations
may be interleaved on a single thread of execution,
which overrides the usual guarantee from <a href='intro.execution'>[intro.execution]</a>
that function executions do not overlap with one another<a class='hidden_link' href='#exec-5.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='exec-5.sentence-3' class='sentence'>
The behavior of a program is undefined if
it invokes a vectorization-unsafe standard library function
from user code
called from a <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_&shy;policy</span> algorithm<a class='hidden_link' href='#exec-5.sentence-3'>.</a></div> <div id='exec-5.note-2' class='note'>[&nbsp;<a class='note_link' href='#exec-5.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-5.sentence-4' class='sentence'>Because <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_&shy;policy</span> allows
the execution of element access functions
to be interleaved on a single thread of execution,
blocking synchronization, including the use of mutexes, risks deadlock<a class='hidden_link' href='#exec-5.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-6'><div class='marginalizedparent'><a class='marginalized' href='#exec-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L431'>#</a></div><div id='exec-6.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;policy</span>
are permitted to execute either
in the invoking thread of execution or
in a thread of execution implicitly created by the library
to support parallel algorithm execution<a class='hidden_link' href='#exec-6.sentence-1'>.</a></div> <div id='exec-6.sentence-2' class='sentence'>If the threads of execution created by <span class='texttt'>thread</span> (<a href='thread.thread.class'>[thread.thread.class]</a>)
or <span class='texttt'>jthread</span> (<a href='thread.jthread.class'>[thread.jthread.class]</a>)
provide concurrent forward progress guarantees (<a href='intro.progress'>[intro.progress]</a>),
then a thread of execution implicitly created by the library will provide
parallel forward progress guarantees;
otherwise, the provided forward progress guarantee is
<span class='indexparent'><a class='index' id=':forward_progress_guarantees_for_implicit_threads_of_parallel_algorithms_(if_not_defined_for_thread)'></a></span>implementation-defined<a class='hidden_link' href='#exec-6.sentence-2'>.</a></div> <div id='exec-6.sentence-3' class='sentence'>Any such invocations executing in the same thread of execution
are indeterminately sequenced with respect to each other<a class='hidden_link' href='#exec-6.sentence-3'>.</a></div> <div id='exec-6.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-6.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-6.sentence-4' class='sentence'>It is the caller's responsibility to ensure
that the invocation does not introduce data races or deadlocks<a class='hidden_link' href='#exec-6.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='exec-6.example-1' class='example'>[&nbsp;<a class='example_link' href='#exec-6.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>0</span>,<span class='literal'>1</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>vector<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> v;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span>push_back<span class='parenthesis'>(</span>i<span class='operator'>*</span><span class='literal'>2</span><span class='operator'>+</span><span class='literal'>1</span><span class='parenthesis'>)</span>;                   <span class='comment'>// incorrect: data race</span>
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</pre> <div id='exec-6.sentence-5' class='sentence'>
The program above has a data race because of the unsynchronized access to the
container <span class='texttt'>v</span><a class='hidden_link' href='#exec-6.sentence-5'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  <div id='exec-6.example-2' class='example'>[&nbsp;<a class='example_link' href='#exec-6.example-2'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
std<span class='operator'>::</span>atomic<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> x<span class='curlybracket'>{</span><span class='literal'>0</span><span class='curlybracket'>}</span>;
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>1</span>,<span class='literal'>2</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  x<span class='operator'>.</span>fetch_add<span class='parenthesis'>(</span><span class='literal'>1</span>, std<span class='operator'>::</span>memory_order<span class='operator'>::</span>relaxed<span class='parenthesis'>)</span>;
  <span class='comment'>// spin wait for another iteration to change the value of <span class='tcode_in_codeblock'>x</span></span>
  <span class='keyword'>while</span> <span class='parenthesis'>(</span>x<span class='operator'>.</span>load<span class='parenthesis'>(</span>std<span class='operator'>::</span>memory_order<span class='operator'>::</span>relaxed<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>           <span class='comment'>// incorrect: assumes execution order</span>
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</pre> <div id='exec-6.sentence-6' class='sentence'>
The above example depends on the order of execution of the iterations, and
will not terminate if both iterations are executed sequentially
on the same thread of execution<a class='hidden_link' href='#exec-6.sentence-6'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div>  <div id='exec-6.example-3' class='example'>[&nbsp;<a class='example_link' href='#exec-6.example-3'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>0</span>;
std<span class='operator'>::</span>mutex m;
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>1</span>,<span class='literal'>2</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  std<span class='operator'>::</span>lock_guard<span class='anglebracket'>&lt;</span>mutex<span class='anglebracket'>&gt;</span> guard<span class='parenthesis'>(</span>m<span class='parenthesis'>)</span>;
  <span class='operator'>+</span><span class='operator'>+</span>x;
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</pre> <div id='exec-6.sentence-7' class='sentence'>
The above example synchronizes access to object <span class='texttt'>x</span>
ensuring that it is incremented correctly<a class='hidden_link' href='#exec-6.sentence-7'>.</a></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='exec-7'><div class='marginalizedparent'><a class='marginalized' href='#exec-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L491'>#</a></div><div id='exec-7.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;unsequenced_&shy;policy</span> are
permitted to execute
in an unordered fashion in unspecified threads of execution, and
unsequenced with respect to one another within each thread of execution<a class='hidden_link' href='#exec-7.sentence-1'>.</a></div> <div id='exec-7.sentence-2' class='sentence'>These threads of execution are
either the invoking thread of execution
or threads of execution implicitly created by the library;
the latter will provide weakly parallel forward progress guarantees<a class='hidden_link' href='#exec-7.sentence-2'>.</a></div> <div id='exec-7.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-7.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-7.sentence-3' class='sentence'>This means that multiple function object invocations may be interleaved
on a single thread of execution,
which overrides the usual guarantee from <a href='intro.execution'>[intro.execution]</a>
that function executions do not overlap with one another<a class='hidden_link' href='#exec-7.sentence-3'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='exec-7.sentence-4' class='sentence'>
The behavior of a program is undefined if
it invokes a vectorization-unsafe standard library function
from user code
called from a <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;unsequenced_&shy;policy</span> algorithm<a class='hidden_link' href='#exec-7.sentence-4'>.</a></div> <div id='exec-7.note-2' class='note'>[&nbsp;<a class='note_link' href='#exec-7.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-7.sentence-5' class='sentence'>Because <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;unsequenced_&shy;policy</span> allows
the execution of element access functions
to be interleaved on a single thread of execution,
blocking synchronization, including the use of mutexes, risks deadlock<a class='hidden_link' href='#exec-7.sentence-5'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-8'><div class='marginalizedparent'><a class='marginalized' href='#exec-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L518'>#</a></div><div id='exec-8.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-8.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-8.sentence-1' class='sentence'>The semantics of invocation with
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_&shy;policy</span>,
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;policy</span>, or
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_&shy;unsequenced_&shy;policy</span>
allow the implementation to fall back to sequential execution
if the system cannot parallelize an algorithm invocation,
e.g., due to lack of resources<a class='hidden_link' href='#exec-8.sentence-1'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-9'><div class='marginalizedparent'><a class='marginalized' href='#exec-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L529'>#</a></div><div id='exec-9.sentence-1' class='sentence'>If an invocation of a parallel algorithm uses threads of execution
implicitly created by the library,
then the invoking thread of execution will either
<ul class='itemize'><li id='exec-9.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#exec-9.1'>(9.1)</a></div>temporarily block
  with forward progress guarantee delegation (<a href='intro.progress'>[intro.progress]</a>)
  on the completion of these library-managed threads of execution, or</li><li id='exec-9.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#exec-9.2'>(9.2)</a></div>eventually execute an element access function;</li></ul>
the thread of execution will continue to do so until the algorithm is finished<a class='hidden_link' href='#exec-9.sentence-1'>.</a></div> <div id='exec-9.note-1' class='note'>[&nbsp;<a class='note_link' href='#exec-9.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='exec-9.sentence-2' class='sentence'>In blocking with forward progress guarantee delegation in this context,
a thread of execution created by the library
is considered to have finished execution
as soon as it has finished the execution
of the particular element access function
that the invoking thread of execution logically depends on<a class='hidden_link' href='#exec-9.sentence-2'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='exec-10'><div class='marginalizedparent'><a class='marginalized' href='#exec-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L551'>#</a></div><div id='exec-10.sentence-1' class='sentence'>The semantics of parallel algorithms invoked with an execution policy object of
<span class='indexparent'><a class='index' id=':additional_execution_policies_supported_by_parallel_algorithms'></a></span>implementation-defined type
are <span class='indexparent'><a class='index' id=':semantics_of_parallel_algorithms_invoked_with_implementation-defined_execution_policies'></a></span>implementation-defined<a class='hidden_link' href='#exec-10.sentence-1'>.</a></div></div></div><div id='exceptions' class='section'><h3 ><a class='secnum' href='#exceptions' style='min-width:103pt'>25.3.4</a> Parallel algorithm exceptions <a class='abbr_ref' href='algorithms.parallel.exceptions'>[algorithms.parallel.exceptions]</a></h3><div class='para' id='exceptions-1'><div class='marginalizedparent'><a class='marginalized' href='#exceptions-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L559'>#</a></div><div id='exceptions-1.sentence-1' class='sentence'>During the execution of a parallel algorithm,
if temporary memory resources are required for parallelization
and none are available, the algorithm throws a <span class='texttt'>bad_&shy;alloc</span> exception<a class='hidden_link' href='#exceptions-1.sentence-1'>.</a></div></div><div class='para' id='exceptions-2'><div class='marginalizedparent'><a class='marginalized' href='#exceptions-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L564'>#</a></div><div id='exceptions-2.sentence-1' class='sentence'>During the execution of a parallel algorithm,
if the invocation of an element access function exits via an uncaught exception,
the behavior is determined by the <span class='texttt'>ExecutionPolicy</span><a class='hidden_link' href='#exceptions-2.sentence-1'>.</a></div></div></div><div id='overloads' class='section'><h3 ><a class='secnum' href='#overloads' style='min-width:103pt'>25.3.5</a> <span class='texttt'>ExecutionPolicy</span> algorithm overloads <a class='abbr_ref' href='algorithms.parallel.overloads'>[algorithms.parallel.overloads]</a></h3><div class='para' id='overloads-1'><div class='marginalizedparent'><a class='marginalized' href='#overloads-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L571'>#</a></div><div id='overloads-1.sentence-1' class='sentence'>Parallel algorithms are algorithm overloads<a class='hidden_link' href='#overloads-1.sentence-1'>.</a></div> <div id='overloads-1.sentence-2' class='sentence'>Each parallel algorithm overload
has an additional template type parameter named <span class='texttt'>ExecutionPolicy</span>,
which is the first template parameter<a class='hidden_link' href='#overloads-1.sentence-2'>.</a></div> <div id='overloads-1.sentence-3' class='sentence'>Additionally, each parallel algorithm overload
has an additional function parameter of type <span class='texttt'>ExecutionPolicy<span class='operator'>&amp;</span><span class='operator'>&amp;</span></span>,
which is the first function parameter<a class='hidden_link' href='#overloads-1.sentence-3'>.</a></div> <div id='overloads-1.note-1' class='note'>[&nbsp;<a class='note_link' href='#overloads-1.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='overloads-1.sentence-4' class='sentence'>Not all algorithms have parallel algorithm overloads<a class='hidden_link' href='#overloads-1.sentence-4'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div> </div><div class='para' id='overloads-2'><div class='marginalizedparent'><a class='marginalized' href='#overloads-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L583'>#</a></div><div id='overloads-2.sentence-1' class='sentence'>Unless otherwise specified,
the semantics of <span class='texttt'>ExecutionPolicy</span> algorithm overloads
are identical to their overloads without<a class='hidden_link' href='#overloads-2.sentence-1'>.</a></div></div><div class='para' id='overloads-3'><div class='marginalizedparent'><a class='marginalized' href='#overloads-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L588'>#</a></div><div id='overloads-3.sentence-1' class='sentence'>Unless otherwise specified,
the complexity requirements of <span class='texttt'>ExecutionPolicy</span> algorithm overloads
are relaxed from the complexity requirements of the overloads without
as follows:
when the guarantee says “at most <span class='textit'>expr</span>” or
“exactly <span class='textit'>expr</span>”
and does not specify the number of assignments or swaps, and
<span class='textit'>expr</span> is not already expressed with <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-script-R" style="padding-top: 0.519em; padding-bottom: 0.225em; padding-right: 0.067em;">O</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span></span></span> notation,
the complexity of the algorithm shall be <span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-script-R" style="padding-top: 0.519em; padding-bottom: 0.225em; padding-right: 0.067em;">O</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">expr</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span></span></span><a class='hidden_link' href='#overloads-3.sentence-1'>.</a></div></div><div class='para' id='overloads-4'><div class='marginalizedparent'><a class='marginalized' href='#overloads-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/4f2f5811d4d4f45679e0a09e2cf105f9535db8c6/source/algorithms.tex#L599'>#</a></div><div id='overloads-4.sentence-1' class='sentence'>Parallel algorithms shall not participate in overload resolution unless
<span class='texttt'>is_&shy;execution_&shy;policy_&shy;v<span class='anglebracket'>&lt;</span>remove_&shy;cvref_&shy;t<span class='anglebracket'>&lt;</span>ExecutionPolicy<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#overloads-4.sentence-1'>.</a></div></div></div></div></body></html>