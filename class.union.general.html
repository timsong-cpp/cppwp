<!DOCTYPE html><html lang='en'><head><title>[class.union.general]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>11</a> Classes <a class='abbr_ref' href='./#class'>[class]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>11.5</a> Unions <a class='abbr_ref' href='class.union#general'>[class.union]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>11.5.1</a> General <a class='abbr_ref'>[class.union.general]</a></h3><div class='texpara'><a class='index' id=':union'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L2942'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:union' title='11.5.1&emsp;General&emsp;[class.union.general]'><span id='def:union'><i >union</i></span></a> is a class defined with the <a href='class.pre#nt:class-key' title='11.1&emsp;Preamble&emsp;[class.pre]'><span id='ntref:class-key'><span class='textsf'><i >class-key</i></span></span></a>
<span id=':union_'><span class='texttt'><span class='keyword'>union</span></span></span><a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L2946'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>In a union,
a non-static data member is <a class='hidden_link' href='#def:active,union_member' title='11.5.1&emsp;General&emsp;[class.union.general]'><span id='def:active,union_member'><i >active</i></span></a>
if its name refers to an object
whose lifetime has begun and has not ended (<a href='basic.life' title='6.7.3&emsp;Lifetime'>[basic.<span class='shy'></span>life]</a>)<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>At most one of the non-static data members of an object of union type
can be active at any
time, that is, the value of at most one of the non-static data members can be
stored in a union at any time<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>: <div id='2.sentence-3' class='sentence'>One special guarantee is made in order to
simplify the use of unions: If a standard-layout union contains several standard-layout
structs that share a common initial sequence (<a href='class.mem' title='11.4&emsp;Class members'>[class.<span class='shy'></span>mem]</a>), and
if a non-static data member of an object of this standard-layout union type
is active and is one of the standard-layout structs,
it is permitted to inspect the common initial sequence
of any of the standard-layout struct members;
see <a href='class.mem' title='11.4&emsp;Class members'>[class.<span class='shy'></span>mem]</a><a class='hidden_link' href='#2.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L2966'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>The size of a union is sufficient to contain the largest
of its non-static data members<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>Each non-static data member is allocated
as if it were the sole member of a non-union class<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>: <div id='3.sentence-3' class='sentence'>A union object and its non-static data members are
pointer-interconvertible (<a href='basic.compound' title='6.8.3&emsp;Compound types'>[basic.<span class='shy'></span>compound]</a>, <a href='expr.static.cast' title='7.6.1.9&emsp;Static cast'>[expr.<span class='shy'></span>static.<span class='shy'></span>cast]</a>)<a class='hidden_link' href='#3.sentence-3'>.</a></div> <div id='3.sentence-4' class='sentence'>As a consequence, all non-static data members of a
union object have the same address<a class='hidden_link' href='#3.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L2977'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><a class='index' id=':member_function,union'></a><a class='index' id=':constructor,union'></a><a class='index' id=':destructor,union'></a>A union can have member functions (including constructors and destructors),
<a class='index' id=':restriction,union'></a>but it shall not have virtual (<a href='class.virtual' title='11.7.3&emsp;Virtual functions'>[class.<span class='shy'></span>virtual]</a>) functions<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>A union shall not have
base classes<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>A union shall not be used as a base class<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'><a class='index' id=':restriction,union_'></a>If a union contains a non-static data member of
reference type the program is ill-formed<a class='hidden_link' href='#4.sentence-4'>.</a></div> <div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>: <div id='4.sentence-5' class='sentence'>Absent default member initializers (<a href='class.mem' title='11.4&emsp;Class members'>[class.<span class='shy'></span>mem]</a>),
if any non-static data member of a union has a non-trivial
default constructor (<a href='class.default.ctor' title='11.4.5.2&emsp;Default constructors'>[class.<span class='shy'></span>default.<span class='shy'></span>ctor]</a>),
copy constructor, move constructor (<a href='class.copy.ctor' title='11.4.5.3&emsp;Copy/move constructors'>[class.<span class='shy'></span>copy.<span class='shy'></span>ctor]</a>),
copy assignment operator, move assignment operator (<a href='class.copy.assign' title='11.4.6&emsp;Copy/move assignment operator'>[class.<span class='shy'></span>copy.<span class='shy'></span>assign]</a>),
or destructor (<a href='class.dtor' title='11.4.7&emsp;Destructors'>[class.<span class='shy'></span>dtor]</a>), the corresponding member function
of the union must be user-provided or it will
be implicitly deleted (<a href='dcl.fct.def.delete' title='9.5.3&emsp;Deleted definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>delete]</a>) for the union<a class='hidden_link' href='#4.sentence-5'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L2999'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>: <div id='5.sentence-1' class='sentence'>Consider the following union:
<span class='codeblock'><span class='keyword'>union</span> U <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i;
  <span class='keyword'>float</span> f;
  std<span class='operator'>::</span>string s;
<span class='curlybracket'>}</span>;
</span></div></div><div class='texpara'><div id='5.sentence-2' class='sentence'>Since <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>string</span> (<a href='string.classes' title='21.3&emsp;String classes'>[string.<span class='shy'></span>classes]</a>) declares non-trivial versions of all of the special
member functions, <span class='texttt'>U</span> will have an implicitly deleted default constructor,
copy/move constructor,
copy/move assignment operator, and destructor<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>To use <span class='texttt'>U</span>, some or all of these member functions
must be user-provided<a class='hidden_link' href='#5.sentence-3'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L3018'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>When the left operand of an assignment operator
involves a member access expression (<a href='expr.ref' title='7.6.1.5&emsp;Class member access'>[expr.<span class='shy'></span>ref]</a>)
that nominates a union member,
it may begin the lifetime of that union member,
as described below<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>For an expression <span class='texttt'>E</span>,
define the set <span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>E</span>)</span>
of subexpressions of <span class='texttt'>E</span>
as follows:
<ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#6.1'>(6.1)</a></div><div class='texpara'><div id='6.1.sentence-1' class='sentence'>If <span class='texttt'>E</span> is of the form <span class='texttt'>A<span class='operator'>.</span>B</span>,
<span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>E</span>)</span> contains the elements of <span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>A</span>)</span>,
and also contains <span class='texttt'>A<span class='operator'>.</span>B</span>
if <span class='texttt'>B</span> names a union member of a non-class, non-array type,
or of a class type with a trivial default constructor that is not deleted,
or an array of such types<a class='hidden_link' href='#6.1.sentence-1'>.</a></div></div></li><li id='6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#6.2'>(6.2)</a></div><div class='texpara'><div id='6.2.sentence-1' class='sentence'>If <span class='texttt'>E</span> is of the form <span class='texttt'>A<span class='squarebracket'>[</span>B<span class='squarebracket'>]</span></span>
and is interpreted as a built-in array subscripting operator,
<span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>E</span>)</span> is <span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>A</span>)</span> if <span class='texttt'>A</span> is of array type,
<span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>B</span>)</span> if <span class='texttt'>B</span> is of array type,
and empty otherwise<a class='hidden_link' href='#6.2.sentence-1'>.</a></div></div></li><li id='6.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#6.3'>(6.3)</a></div><div class='texpara'><div id='6.3.sentence-1' class='sentence'>Otherwise, <span class='math'><span class='mathalpha'>S</span>(<span class='mathtt'>E</span>)</span> is empty<a class='hidden_link' href='#6.3.sentence-1'>.</a></div></div></li></ul></div> <div id='6.sentence-3' class='sentence'>
In an assignment expression of the form <span class='texttt'>E1 <span class='operator'>=</span> E2</span>
that uses either the built-in assignment operator (<a href='expr.ass' title='7.6.19&emsp;Assignment and compound assignment operators'>[expr.<span class='shy'></span>ass]</a>)
or a trivial assignment operator (<a href='class.copy.assign' title='11.4.6&emsp;Copy/move assignment operator'>[class.<span class='shy'></span>copy.<span class='shy'></span>assign]</a>),
for each element <span class='texttt'>X</span> of <span class='math'><span class='mathalpha'>S</span>(</span><span class='texttt'>E1</span><span class='math'>)</span>,
if modification of <span class='texttt'>X</span> would have undefined behavior under <a href='basic.life' title='6.7.3&emsp;Lifetime'>[basic.<span class='shy'></span>life]</a>,
an object of the type of <span class='texttt'>X</span> is implicitly created
in the nominated storage;
no initialization is performed and
the beginning of its lifetime is sequenced after
the value computation of the left and right operands
and before the assignment<a class='hidden_link' href='#6.sentence-3'>.</a></div> <div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>: <div id='6.sentence-4' class='sentence'>This ends the lifetime of the previously-active
member of the union, if any (<a href='basic.life' title='6.7.3&emsp;Lifetime'>[basic.<span class='shy'></span>life]</a>)<a class='hidden_link' href='#6.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>: <span class='codeblock'><span class='keyword'>union</span> A <span class='curlybracket'>{</span> <span class='keyword'>int</span> x; <span class='keyword'>int</span> y<span class='squarebracket'>[</span><span class='literal'>4</span><span class='squarebracket'>]</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> B <span class='curlybracket'>{</span> A a; <span class='curlybracket'>}</span>;
<span class='keyword'>union</span> C <span class='curlybracket'>{</span> B b; <span class='keyword'>int</span> k; <span class='curlybracket'>}</span>;
<span class='keyword'>int</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  C c;                  <span class='comment'>// does not start lifetime of any union member</span>
  c<span class='operator'>.</span>b<span class='operator'>.</span>a<span class='operator'>.</span>y<span class='squarebracket'>[</span><span class='literal'>3</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='literal'>4</span>;       <span class='comment'>// OK: <span class='math'><span class='mathalpha'>S</span>(</span><span class='tcode_in_codeblock'>c.b.a.y[3]</span><span class='math'>)</span> contains <span class='tcode_in_codeblock'>c.b</span> and <span class='tcode_in_codeblock'>c.b.a.y</span>;</span>
                        <span class='comment'>// creates objects to hold union members <span class='tcode_in_codeblock'>c.b</span> and <span class='tcode_in_codeblock'>c.b.a.y</span></span>
  <span class='keyword'>return</span> c<span class='operator'>.</span>b<span class='operator'>.</span>a<span class='operator'>.</span>y<span class='squarebracket'>[</span><span class='literal'>3</span><span class='squarebracket'>]</span>;    <span class='comment'>// OK: <span class='tcode_in_codeblock'>c.b.a.y</span> refers to newly created object (see <a href='basic.life' title='6.7.3&emsp;Lifetime'>[basic.<span class='shy'></span>life]</a>)</span>
<span class='curlybracket'>}</span>

<span class='keyword'>struct</span> X <span class='curlybracket'>{</span> <span class='keyword'>const</span> <span class='keyword'>int</span> a; <span class='keyword'>int</span> b; <span class='curlybracket'>}</span>;
<span class='keyword'>union</span> Y <span class='curlybracket'>{</span> X x; <span class='keyword'>int</span> k; <span class='curlybracket'>}</span>;
<span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  Y y <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='curlybracket'>{</span> <span class='literal'>1</span>, <span class='literal'>2</span> <span class='curlybracket'>}</span> <span class='curlybracket'>}</span>;   <span class='comment'>// OK, <span class='tcode_in_codeblock'>y.x</span> is active union member (<a href='class.mem' title='11.4&emsp;Class members'>[class.<span class='shy'></span>mem]</a>)</span>
  <span class='keyword'>int</span> n <span class='operator'>=</span> y<span class='operator'>.</span>x<span class='operator'>.</span>a;
  y<span class='operator'>.</span>k <span class='operator'>=</span> <span class='literal'>4</span>;              <span class='comment'>// OK: ends lifetime of <span class='tcode_in_codeblock'>y.x</span>, <span class='tcode_in_codeblock'>y.k</span> is active member of union</span>
  y<span class='operator'>.</span>x<span class='operator'>.</span>b <span class='operator'>=</span> n;            <span class='comment'>// undefined behavior: <span class='tcode_in_codeblock'>y.x.b</span> modified outside its lifetime,</span>
                        <span class='comment'>// <span class='math'><span class='mathalpha'>S</span>(</span><span class='tcode_in_codeblock'>y.x.b</span><span class='math'>)</span> is empty because <span class='tcode_in_codeblock'>X</span>'s default constructor is deleted,</span>
                        <span class='comment'>// so union member <span class='tcode_in_codeblock'>y.x</span>'s lifetime does not implicitly start</span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para nonNormativeOnly' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/e72874655094916c118488e867d117c65fb9e754/source/classes.tex#L3085'>#</a></div><div class='texpara'><div id='note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-5'>5</a></i>: <div id='7.sentence-1' class='sentence'>In cases where the above rule does not apply,
the active member of a union can only be changed by
the use of a placement <a href='expr.new#nt:new-expression' title='7.6.2.8&emsp;New&emsp;[expr.new]'><span id='ntref:new-expression'><span class='textsf'><i >new-expression</i></span></span></a><a class='hidden_link' href='#7.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>: <div id='7.sentence-2' class='sentence'>Consider an object <span class='texttt'>u</span> of a <span id=':union__'><span class='texttt'><span class='keyword'>union</span></span></span> type <span class='texttt'>U</span> having non-static data members
<span class='texttt'>m</span> of type <span class='texttt'>M</span> and <span class='texttt'>n</span> of type <span class='texttt'>N</span><a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='7.sentence-3' class='sentence'>If <span class='texttt'>M</span> has a non-trivial
destructor and <span class='texttt'>N</span> has a non-trivial constructor (for instance, if they declare or inherit
virtual functions), the active member of <span class='texttt'>u</span> can be safely switched from <span class='texttt'>m</span> to
<span class='texttt'>n</span> using the destructor and placement <a href='expr.new#nt:new-expression' title='7.6.2.8&emsp;New&emsp;[expr.new]'><span id='ntref:new-expression_'><span class='textsf'><i >new-expression</i></span></span></a> as follows:
<span class='codeblock'>u<span class='operator'>.</span>m<span class='operator'>.</span><span class='operator'>~</span>M<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>new</span> <span class='parenthesis'>(</span><span class='operator'>&amp;</span>u<span class='operator'>.</span>n<span class='parenthesis'>)</span> N;
</span></div> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>