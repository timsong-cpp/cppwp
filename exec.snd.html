<!DOCTYPE html><html lang='en'><head><title>[exec.snd]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>34</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>34.9</a> Senders <a class='abbr_ref'>[exec.snd]</a></h2><div id='general' class='section'><h3 ><a class='secnum' href='#general' style='min-width:80pt'>34.9.1</a> General <a class='abbr_ref' href='exec.snd.general'>[exec.snd.general]</a></h3><div class='para' id='general-1'><div class='marginalizedparent'><a class='marginalized' href='#general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1225'>#</a></div><div class='texpara'><div id='general-1.sentence-1' class='sentence'>Subclauses <a href='#exec.factories' title='34.9.11&emsp;Sender factories'>[exec.<span class='shy'></span>factories]</a> and <a href='#exec.adapt' title='34.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> define
customizable algorithms that return senders<a class='hidden_link' href='#general-1.sentence-1'>.</a></div> <div id='general-1.sentence-2' class='sentence'>Each algorithm has a default implementation<a class='hidden_link' href='#general-1.sentence-2'>.</a></div> <div id='general-1.sentence-3' class='sentence'>Let <span class='texttt'>sndr</span> be the result of an invocation of such an algorithm or
an object equal to the result (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>), and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#general-1.sentence-3'>.</a></div> <div id='general-1.sentence-4' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver of type <span class='texttt'>Rcvr</span>
with associated environment <span class='texttt'>env</span> of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_to' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#general-1.sentence-4'>.</a></div> <div id='general-1.sentence-5' class='sentence'>For the default implementation of the algorithm that produced <span class='texttt'>sndr</span>,
connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
necessarily results in the potential evaluation (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>) of
a set of completion operations
whose first argument is a subexpression equal to <span class='texttt'>rcvr</span><a class='hidden_link' href='#general-1.sentence-5'>.</a></div> <div id='general-1.sentence-6' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of completion signatures corresponding to
this set of completion operations<a class='hidden_link' href='#general-1.sentence-6'>.</a></div> <div id='general-1.sentence-7' class='sentence'>Then the type of the expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is
a specialization of
the class template <span class='texttt'>completion_<span class='shy'></span>signatures</span> (<a href='exec.util.cmplsig' title='34.10.1&emsp;execution&#x200b;::&#x200b;completion_&shy;signatures'>[exec.<span class='shy'></span>util.<span class='shy'></span>cmplsig]</a>),
the set of whose template arguments is <span class='texttt'>Sigs</span><a class='hidden_link' href='#general-1.sentence-7'>.</a></div> <div id='general-1.sentence-8' class='sentence'>If a user-provided implementation of the algorithm
that produced <span class='texttt'>sndr</span> is selected instead of the default,
any completion signature
that is in the set of types
denoted by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> and
that is not part of <span class='texttt'>Sigs</span> shall correspond to
error or stopped completion operations,
unless otherwise specified<a class='hidden_link' href='#general-1.sentence-8'>.</a></div></div></div></div><div id='expos' class='section'><h3 ><a class='secnum' href='#expos' style='min-width:80pt'>34.9.2</a> Exposition-only entities <a class='abbr_ref' href='exec.snd.expos'>[exec.snd.expos]</a></h3><div class='para' id='expos-1'><div class='marginalizedparent'><a class='marginalized' href='#expos-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1258'>#</a></div><div class='texpara'><div id='expos-1.sentence-1' class='sentence'>Subclause [exec.<span class='shy'></span>snd] makes use of the following exposition-only entities<a class='hidden_link' href='#expos-1.sentence-1'>.</a></div></div></div><div class='para' id='expos-2'><div class='marginalizedparent'><a class='marginalized' href='#expos-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1261'>#</a></div><div class='texpara'><div id='expos-2.sentence-1' class='sentence'>For a queryable object <span class='texttt'>env</span>,
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is an expression
whose type satisfies <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable'><span class='texttt'><i >queryable</i></span></span></a>
such that for a query object <span class='texttt'>q</span> and
a pack of subexpressions <span class='texttt'>as</span>,
the expression <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed
if <span class='texttt'>forwarding_<span class='shy'></span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>;
otherwise, it is expression-equivalent to <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-2.sentence-1'>.</a></div></div></div><div class='para' id='expos-3'><div class='marginalizedparent'><a class='marginalized' href='#expos-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1271'>#</a></div><div class='texpara'><div id='expos-3.sentence-1' class='sentence'>For a query object <span class='texttt'>q</span> and <span class='texttt'>a</span> subexpression <span class='texttt'>v</span>,
<span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>q, v<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env</span>
whose type satisfies <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_'><span class='texttt'><i >queryable</i></span></span></a>
such that the result of <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> has
a value equal to <span class='texttt'>v</span> (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)<a class='hidden_link' href='#expos-3.sentence-1'>.</a></div> <div id='expos-3.sentence-2' class='sentence'>Unless otherwise stated,
the object to which <span class='texttt'>env<span class='operator'>.</span>query<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> refers remains valid
while <span class='texttt'>env</span> remains valid<a class='hidden_link' href='#expos-3.sentence-2'>.</a></div></div></div><div class='para' id='expos-4'><div class='marginalizedparent'><a class='marginalized' href='#expos-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1281'>#</a></div><div class='texpara'><div id='expos-4.sentence-1' class='sentence'>For two queryable objects <span class='texttt'>env1</span> and <span class='texttt'>env2</span>,
a query object <span class='texttt'>q</span>, and
a pack of subexpressions <span class='texttt'>as</span>,
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span>env1, env2<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>env3</span>
whose type satisfies <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='expos-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#expos-4.1'>(4.1)</a></div><span class='texttt'>env1<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='expos-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#expos-4.2'>(4.2)</a></div>otherwise, <span class='texttt'>env2<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> if that expression is well-formed,</li><li id='expos-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#expos-4.3'>(4.3)</a></div>otherwise, <span class='texttt'>env3<span class='operator'>.</span>query<span class='parenthesis'>(</span>q, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#expos-4.sentence-1'>.</a></li></ul></div></div></div><div class='para' id='expos-5'><div class='marginalizedparent'><a class='marginalized' href='#expos-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1297'>#</a></div><div class='texpara'><div id='expos-5.sentence-1' class='sentence'>The results of <span class='texttt'><i >FWD-ENV</i></span>, <span class='texttt'><i >MAKE-ENV</i></span>, and <span class='texttt'><i >JOIN-ENV</i></span>
can be context-dependent;
i.e., they can evaluate to expressions
with different types and value categories
in different contexts for the same arguments<a class='hidden_link' href='#expos-5.sentence-1'>.</a></div></div></div><div class='para' id='expos-6'><div class='marginalizedparent'><a class='marginalized' href='#expos-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1304'>#</a></div><div class='texpara'><div id='expos-6.sentence-1' class='sentence'>For a scheduler <span class='texttt'>sch</span>,
<span class='texttt'><span class='texttt'><i >SCHED-ATTRS</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o1</span>
whose type satisfies <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span></span> is
an expression with the same type and value as <span class='texttt'>sch</span>
where <span class='texttt'>Tag</span> is one of <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span>, and
such that <span class='texttt'>o1<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-6.sentence-1'>.</a></div> <div id='expos-6.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >SCHED-ENV</i></span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is an expression <span class='texttt'>o2</span>
whose type satisfies <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____'><span class='texttt'><i >queryable</i></span></span></a>
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>)</span></span> is a prvalue
with the same type and value as <span class='texttt'>sch</span>, and
such that <span class='texttt'>o2<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>query<span class='parenthesis'>(</span>get_<span class='shy'></span>domain<span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-6.sentence-2'>.</a></div></div></div><div class='para' id='expos-7'><div class='marginalizedparent'><a class='marginalized' href='#expos-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1320'>#</a></div><div class='texpara'><div id='expos-7.sentence-1' class='sentence'>For two subexpressions <span class='texttt'>rcvr</span> and <span class='texttt'>expr</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='parenthesis'>(</span>expr, set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if the type of <span class='texttt'>expr</span> is <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, <span class='texttt'>set_<span class='shy'></span>value<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, expr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-7.sentence-1'>.</a></div> <div id='expos-7.sentence-2' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-EVAL</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  expr;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if <span class='texttt'>expr</span> is potentially-throwing; otherwise, <span class='texttt'>expr</span><a class='hidden_link' href='#expos-7.sentence-2'>.</a></div> <div id='expos-7.sentence-3' class='sentence'><span class='texttt'><span class='texttt'><i >TRY-SET-VALUE</i></span><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span></span> is
<span class='codeblock'><i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >SET-VALUE</i><span class='parenthesis'>(</span>rcvr, expr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>rcvr</span> is evaluated only once<a class='hidden_link' href='#expos-7.sentence-3'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Default <span class='operator'>=</span> default_domain, <span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='expos-8'><div class='marginalizedparent'><a class='marginalized' href='#expos-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1347'>#</a></div><div class='texpara'><div id='expos-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> is the type of the expression
<span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-8.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-9'><div class='marginalizedparent'><a class='marginalized' href='#expos-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1351'>#</a></div><div class='texpara'><div id='expos-9.sentence-1' class='sentence'><i >Effects</i>: If all of the types
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>)</span></span>,
<span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>)</span></span>, and<br/><span class='texttt'><span class='texttt'><i >COMPL-DOMAIN</i></span><span class='parenthesis'>(</span>set_<span class='shy'></span>stopped_<span class='shy'></span>t<span class='parenthesis'>)</span></span> are ill-formed,
<span class='texttt'>completion<span class='operator'>-</span>domain<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of type <span class='texttt'>Default</span><a class='hidden_link' href='#expos-9.sentence-1'>.</a></div> <div id='expos-9.sentence-2' class='sentence'>Otherwise, if they all share a common type (<a href='meta.trans.other' title='21.3.8.7&emsp;Other transformations'>[meta.<span class='shy'></span>trans.<span class='shy'></span>other]</a>)
(ignoring those types that are ill-formed),
then <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is
a default-constructed prvalue of that type<a class='hidden_link' href='#expos-9.sentence-2'>.</a></div> <div id='expos-9.sentence-3' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#expos-9.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Env, <span class='keyword'>class</span> Default<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >query-with-default</i></span><span class='parenthesis'>(</span>
    Tag, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env, Default<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='expos-10'><div class='marginalizedparent'><a class='marginalized' href='#expos-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1373'>#</a></div><div class='texpara'><div id='expos-10.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression <span class='texttt'>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span>
if that expression is well-formed;
otherwise, it is <span class='texttt'><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Default<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-10.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-11'><div class='marginalizedparent'><a class='marginalized' href='#expos-11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1378'>#</a></div><div class='texpara'><div id='expos-11.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#expos-11.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-12'><div class='marginalizedparent'><a class='marginalized' href='#expos-12'>12</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1382'>#</a></div><div class='texpara'><div id='expos-12.sentence-1' class='sentence'><i >Remarks</i>: The expression in the noexcept clause is <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-12.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='expos-13'><div class='marginalizedparent'><a class='marginalized' href='#expos-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1393'>#</a></div><div class='texpara'><div id='expos-13.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is
the decayed type of the first of the following expressions that is well-formed:
<ul class='itemize'><li id='expos-13.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-13.1'>(13.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='expos-13.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-13.2'>(13.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='expos-13.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-13.3'>(13.3)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >get-domain-late</i></span><span class='parenthesis'>(</span><span class='keyword'>const</span> Sndr<span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='expos-14'><div class='marginalizedparent'><a class='marginalized' href='#expos-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1414'>#</a></div><div class='texpara'><div id='expos-14.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<ul class='itemize'><li id='expos-14.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-14.1'>(14.1)</a></div>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>, then
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the type of the following expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
<div id='expos-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#expos-note-1'>1</a></i>:&ensp;<div id='expos-14.1.sentence-1' class='sentence'>The <span class='texttt'>continues_<span class='shy'></span>on</span> algorithm works
in tandem with <span class='texttt'>schedule_<span class='shy'></span>from</span> (<a href='#exec.schedule.from' title='34.9.12.5&emsp;execution&#x200b;::&#x200b;schedule_&shy;from'>[exec.<span class='shy'></span>schedule.<span class='shy'></span>from]</a>)
to give scheduler authors a way to customize both
how to transition onto (<span class='texttt'>continues_<span class='shy'></span>on</span>) and off of (<span class='texttt'>schedule_<span class='shy'></span>from</span>)
a given execution context<a class='hidden_link' href='#expos-14.1.sentence-1'>.</a></div> <div id='expos-14.1.sentence-2' class='sentence'>Thus, <span class='texttt'>continues_<span class='shy'></span>on</span> ignores the domain of the predecessor and
uses the domain of the destination scheduler to select a customization,
a property that is unique to <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#expos-14.1.sentence-2'>.</a></div> <div id='expos-14.1.sentence-3' class='sentence'>That is why it is given special treatment here<a class='hidden_link' href='#expos-14.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></li><li id='expos-14.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-14.2'>(14.2)</a></div>Otherwise,
<span class='codeblock'><span class='keyword'>return</span> Domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'>Domain</span> is the first of the following expressions
that is well-formed and whose type is not <span class='texttt'><span class='keyword'>void</span></span>:
<ul class='itemize'><li id='expos-14.2.1'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#expos-14.2.1'>(14.2.1)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='expos-14.2.2'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#expos-14.2.2'>(14.2.2)</a></div><span class='texttt'><span class='texttt'><i >completion-domain</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span></li><li id='expos-14.2.3'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#expos-14.2.3'>(14.2.3)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span></li><li id='expos-14.2.4'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#expos-14.2.4'>(14.2.4)</a></div><span class='texttt'>get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='expos-14.2.5'><div class='marginalizedparent' style='left:-48mm'><a class='marginalized' href='#expos-14.2.5'>(14.2.5)</a></div><span class='texttt'>default_<span class='shy'></span>domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span></li></ul></li></ul></div></div></div></div><div class='para' id='expos-15'><div class='marginalizedparent'><a class='marginalized' href='#expos-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1458'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable'><span class='tcode_in_codeblock'><i >callable</i></span></span></a> Fun<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >emplace-from</i> <span class='curlybracket'>{</span>
  Fun <i >fun</i>;                                                      <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> type <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>operator</span> type<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>

  <span class='keyword'>constexpr</span> type <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable_'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span>Fun<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fun<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
<div id='expos-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#expos-note-2'>2</a></i>:&ensp;<div id='expos-15.sentence-1' class='sentence'><span class='texttt'><i >emplace-from</i></span> is used to emplace non-movable types
into <span class='texttt'>tuple</span>, <span class='texttt'>optional</span>, <span class='texttt'>variant</span>, and similar types<a class='hidden_link' href='#expos-15.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='expos-16'><div class='marginalizedparent'><a class='marginalized' href='#expos-16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1480'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>struct</span> <i >on-stop-request</i> <span class='curlybracket'>{</span>
  inplace_stop_source<span class='operator'>&amp;</span> <i >stop-src</i>;       <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >stop-src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='expos-17'><div class='marginalizedparent'><a class='marginalized' href='#expos-17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1488'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>, <span class='keyword'>class</span> T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >product-type</i> <span class='curlybracket'>{</span>       <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>
  T<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span> t<span class='math'><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span></span></span>;                <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >get</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span>     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div><div class='para nonNormativeOnly' id='expos-18'><div class='marginalizedparent'><a class='marginalized' href='#expos-18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1506'>#</a></div><div class='texpara'><div id='expos-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#expos-note-3'>3</a></i>:&ensp;<div id='expos-18.sentence-1' class='sentence'><span class='texttt'><i >product-type</i></span> is presented here in pseudo-code form
for the sake of exposition<a class='hidden_link' href='#expos-18.sentence-1'>.</a></div> <div id='expos-18.sentence-2' class='sentence'>It can be approximated in standard C++ with a tuple-like implementation
that takes care to keep the type an aggregate
that can be used as the initializer of a structured binding declaration<a class='hidden_link' href='#expos-18.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div> <div id='expos-note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#expos-note-4'>4</a></i>:&ensp;<div id='expos-18.sentence-3' class='sentence'>An expression of type <span class='texttt'><i >product-type</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.6&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#expos-18.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span>size_t I, <span class='keyword'>class</span> Self<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='texttt'><i >get</i></span><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='expos-19'><div class='marginalizedparent'><a class='marginalized' href='#expos-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1525'>#</a></div><div class='texpara'><div id='expos-19.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='squarebracket'>[</span>I<span class='squarebracket'>]</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Self, <span class='keyword'>class</span> Fn<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <i >apply</i><span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Fn<span class='operator'>&amp;</span><span class='operator'>&amp;</span> fn<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</span></div><div class='para' id='expos-20'><div class='marginalizedparent'><a class='marginalized' href='#expos-20'>20</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1540'>#</a></div><div class='texpara'><div id='expos-20.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement below is well-formed<a class='hidden_link' href='#expos-20.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-21'><div class='marginalizedparent'><a class='marginalized' href='#expos-21'>21</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1544'>#</a></div><div class='texpara'><div id='expos-21.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> self;
<span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Fn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='expos-22'><div class='marginalizedparent'><a class='marginalized' href='#expos-22'>22</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1552'>#</a></div><div class='texpara'><div id='expos-22.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement above is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#expos-22.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data <span class='operator'>=</span> see below, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>Tag tag, Data<span class='operator'>&amp;</span><span class='operator'>&amp;</span> data, Child<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='expos-23'><div class='marginalizedparent'><a class='marginalized' href='#expos-23'>23</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1565'>#</a></div><div class='texpara'><div id='expos-23.sentence-1' class='sentence'><i >Mandates</i>: The following expressions are <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='expos-23.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-23.1'>(23.1)</a></div><span class='texttt'><a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular'><span class='texttt'>semiregular</span></span></a><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span></span></li><li id='expos-23.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-23.2'>(23.2)</a></div><span class='texttt'><a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span></span></li><li id='expos-23.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#expos-23.3'>(23.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span></li></ul></div></div></div></div><div class='para' id='expos-24'><div class='marginalizedparent'><a class='marginalized' href='#expos-24'>24</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1574'>#</a></div><div class='texpara'><div id='expos-24.sentence-1' class='sentence'><i >Returns</i>: A prvalue of
type <span class='texttt'><span class='texttt'><i >basic-sender</i></span><span class='anglebracket'>&lt;</span>Tag, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Data<span class='anglebracket'>&gt;</span>, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Child<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
that has been direct-list-initialized with the forwarded arguments,
where <span class='texttt'><i >basic-sender</i></span> is the following exposition-only class template except as noted below<a class='hidden_link' href='#expos-24.sentence-1'>.</a></div></div></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:completion-tag' title='34.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:completion-tag'><span class='tcode_in_codeblock'><i >completion-tag</i></span></span></a> <span class='operator'>=</span>                                      <span class='comment'>// <i >exposition only</i></span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_error_t<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_stopped_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span> T, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:valid-specialization' title='34.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='concept:valid-specialization'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a> <span class='operator'>=</span>                                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> T<span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>; <span class='curlybracket'>}</span>;

  <span class='keyword'>struct</span> <i >default-impls</i> <span class='curlybracket'>{</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;              <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                  <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;       <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                              <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >state-type</i> <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>                 <span class='comment'>// <i >exposition only</i></span>
  <span class='keyword'>using</span> <i >env-type</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>)</span>, Index,
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, size_t I <span class='operator'>=</span> <span class='literal'>0</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >child-type</i> <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='keyword'>template</span> <i >get</i><span class='anglebracket'>&lt;</span>I<span class='operator'>+</span><span class='literal'>2</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> remove_reference_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >indices-for</i>;           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-state</i> <span class='curlybracket'>{</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <i >basic-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>:</span> rcvr<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
      , state<span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>

    Rcvr <i >rcvr</i>;                                                  <span class='comment'>// <i >exposition only</i></span>
    <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Index<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <i >valid-specialization</i><span class='anglebracket'>&lt;</span><i >env-type</i>, Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-t</i> <span class='operator'>=</span> <i >state-type</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span>;                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> <i >complete</i> <span class='operator'>=</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >complete</i>;   <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_value_t, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable__'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_error_t, Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_error_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>
      <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable___'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >complete</i><span class='parenthesis'>)</span>, Index, <i >state-t</i><span class='operator'>&amp;</span>, Rcvr<span class='operator'>&amp;</span>, set_stopped_t<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >env-type</i><span class='anglebracket'>&lt;</span>Index, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-env</i><span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >op</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >connect-all</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                         <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >connect-all-result</i> <span class='operator'>=</span> <i >call-result-t</i><span class='anglebracket'>&lt;</span>                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>)</span>, <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span>, Sndr, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>requires</span> <a href='#concept:valid-specialization' title='34.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >state-type</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
             <a href='#concept:valid-specialization' title='34.9.2&emsp;Exposition-only entities&emsp;[exec.snd.expos]'><span id='conceptref:valid-specialization_'><span class='tcode_in_codeblock'><i >valid-specialization</i></span></span></a><span class='anglebracket'>&lt;</span><i >connect-all-result</i>, Sndr, Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-operation</i> <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>                <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> <i >tag-t</i> <span class='operator'>=</span> tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;                               <span class='comment'>// <i >exposition only</i></span>

    <i >connect-all-result</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span> <i >inner-ops</i>;              <span class='comment'>// <i >exposition only</i></span>

    <i >basic-operation</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>  <span class='comment'>// <i >exposition only</i></span>
      <span class='operator'>:</span> <i >basic-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        <i >inner-ops</i><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
    <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ops<span class='squarebracket'>]</span> <span class='operator'>=</span> <i >inner-ops</i>;
      <i >impls-for</i><span class='anglebracket'>&lt;</span>tag<span class='operator'>-</span>t<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >start</i><span class='parenthesis'>(</span><span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >state</i>, <span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i>, ops<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>using</span> <i >completion-signatures-for</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                   <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span> Data, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Child<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >basic-sender</i> <span class='operator'>:</span> <i >product-type</i><span class='anglebracket'>&lt;</span>Tag, Data, Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;
    <span class='keyword'>using</span> <i >indices-for</i> <span class='operator'>=</span> index_sequence_for<span class='anglebracket'>&lt;</span>Child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='operator'>*</span><span class='keyword'>this</span>;
      <span class='keyword'>return</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>Tag<span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-attrs</i><span class='parenthesis'>(</span>data, child<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='execution.syn#concept:decays-to' title='34.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, receiver Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>auto</span> connect<span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Rcvr rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Self<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>self<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='execution.syn#concept:decays-to' title='34.4&emsp;Header &lt;execution&gt; synopsis&emsp;[execution.syn]'><span id='conceptref:decays-to_'><span class='tcode_in_codeblock'><i >decays-to</i></span></span></a><span class='anglebracket'>&lt;</span><i >basic-sender</i><span class='anglebracket'>&gt;</span> Self, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='keyword'>this</span> Self<span class='operator'>&amp;</span><span class='operator'>&amp;</span> self, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <i >completion-signatures-for</i><span class='anglebracket'>&lt;</span>Self, Env<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='expos-25'><div class='marginalizedparent'><a class='marginalized' href='#expos-25'>25</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1715'>#</a></div><div class='texpara'><div id='expos-25.sentence-1' class='sentence'>The default template argument for the <span class='texttt'>Data</span> template parameter
denotes an unspecified empty trivially copyable class type
that models <a href='concepts.object#concept:semiregular' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:semiregular_'><span class='texttt'>semiregular</span></span></a><a class='hidden_link' href='#expos-25.sentence-1'>.</a></div></div></div><div class='para' id='expos-26'><div class='marginalizedparent'><a class='marginalized' href='#expos-26'>26</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1720'>#</a></div><div class='texpara'><div id='expos-26.sentence-1' class='sentence'>It is unspecified whether a specialization of <span class='texttt'><i >basic-sender</i></span>
is an aggregate<a class='hidden_link' href='#expos-26.sentence-1'>.</a></div></div></div><div class='para' id='expos-27'><div class='marginalizedparent'><a class='marginalized' href='#expos-27'>27</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1724'>#</a></div><div class='texpara'><div id='expos-27.sentence-1' class='sentence'>An expression of type <span class='texttt'><i >basic-sender</i></span> is usable as
the initializer of a structured binding declaration (<a href='dcl.struct.bind' title='9.6&emsp;Structured binding declarations'>[dcl.<span class='shy'></span>struct.<span class='shy'></span>bind]</a>)<a class='hidden_link' href='#expos-27.sentence-1'>.</a></div></div></div><div class='para' id='expos-28'><div class='marginalizedparent'><a class='marginalized' href='#expos-28'>28</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1728'>#</a></div><div class='texpara'><div id='expos-28.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-state</i></span> is:
<span class='codeblock'>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<a href='functional.syn#concept:nothrow-callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:nothrow-callable__'><span class='tcode_in_codeblock'><i >nothrow-callable</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >impls-for</i><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span><i >get-state</i><span class='parenthesis'>)</span>, Sndr, Rcvr<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='expos-29'><div class='marginalizedparent'><a class='marginalized' href='#expos-29'>29</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1736'>#</a></div><div class='texpara'><div id='expos-29.sentence-1' class='sentence'>The object <span class='texttt'><i >connect-all</i></span> is initialized with
a callable object equivalent to the following lambda:</div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr, size_t<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Is<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  <span class='texttt'><i >basic-state</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> op, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, index_sequence<span class='anglebracket'>&lt;</span>Is<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
    <span class='keyword'>return</span> <span class='texttt'><i >product-type</i></span><span class='curlybracket'>{</span>connect<span class='parenthesis'>(</span>
      std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
      <span class='texttt'><i >basic-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr, Rcvr, integral_constant<span class='anglebracket'>&lt;</span>size_t, Is<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>op<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
</code></div></div><div class='para' id='expos-30'><div class='marginalizedparent'><a class='marginalized' href='#expos-30'>30</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1751'>#</a></div><div class='texpara'><div id='expos-30.sentence-1' class='sentence'><i >Constraints</i>: The expression in the <span class='texttt'><span class='keyword'>return</span></span> statement is well-formed<a class='hidden_link' href='#expos-30.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-31'><div class='marginalizedparent'><a class='marginalized' href='#expos-31'>31</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1755'>#</a></div><div class='texpara'><div id='expos-31.sentence-1' class='sentence'><i >Remarks</i>: The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause is <span class='texttt'><span class='literal'>true</span></span>
if the <span class='texttt'><span class='keyword'>return</span></span> statement is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#expos-31.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-32'><div class='marginalizedparent'><a class='marginalized' href='#expos-32'>32</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1762'>#</a></div><div class='texpara'><div id='expos-32.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the constructor of <span class='texttt'><i >basic-operation</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-state</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
<span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i >connect-all</i><span class='parenthesis'>(</span><span class='keyword'>this</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >indices-for</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='expos-33'><div class='marginalizedparent'><a class='marginalized' href='#expos-33'>33</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1770'>#</a></div><div class='texpara'><div id='expos-33.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of
the <span class='texttt'>connect</span> member function of <span class='texttt'><i >basic-sender</i></span> is:
<span class='codeblock'>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span><i >basic-operation</i><span class='anglebracket'>&lt;</span>Self, Rcvr<span class='anglebracket'>&gt;</span>, Self, Rcvr<span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='expos-34'><div class='marginalizedparent'><a class='marginalized' href='#expos-34'>34</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1777'>#</a></div><div class='texpara'><div id='expos-34.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span> <span class='parenthesis'>(</span><i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='keyword'>else</span>
    <span class='keyword'>return</span> empty_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='expos-35'><div class='marginalizedparent'><a class='marginalized' href='#expos-35'>35</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1789'>#</a></div><div class='texpara'><div id='expos-35.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='expos-36'><div class='marginalizedparent'><a class='marginalized' href='#expos-36'>36</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1798'>#</a></div><div class='texpara'><div id='expos-36.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='expos-37'><div class='marginalizedparent'><a class='marginalized' href='#expos-37'>37</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1808'>#</a></div><div class='texpara'><div id='expos-37.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='parenthesis'>(</span>execution<span class='operator'>::</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='expos-38'><div class='marginalizedparent'><a class='marginalized' href='#expos-38'>38</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1817'>#</a></div><div class='texpara'><div id='expos-38.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >default-impls</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
  Index, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable____'><span class='tcode_in_codeblock'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>Tag, Rcvr, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>static_assert</span><span class='parenthesis'>(</span>Index<span class='operator'>::</span>value <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span><span class='parenthesis'>)</span>;
  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='expos-39'><div class='marginalizedparent'><a class='marginalized' href='#expos-39'>39</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1829'>#</a></div><div class='texpara'><div id='expos-39.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span> let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-39.sentence-1'>.</a></div> <div id='expos-39.sentence-2' class='sentence'>Let <span class='texttt'>rcvr</span> be a receiver
with an associated environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#expos-39.sentence-2'>.</a></div> <div id='expos-39.sentence-3' class='sentence'><span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> denotes
a specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span>,
the set of whose template arguments correspond to
the set of completion operations that are potentially evaluated
as a result of starting (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
the operation state that results from connecting <span class='texttt'>sndr</span> and <span class='texttt'>rcvr</span><a class='hidden_link' href='#expos-39.sentence-3'>.</a></div> <div id='expos-39.sentence-4' class='sentence'>When <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
the type denoted by <span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>,
if any, is not a specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span><a class='hidden_link' href='#expos-39.sentence-4'>.</a></div></div><div class='texpara'><div id='expos-39.sentence-5' class='sentence'><i >Recommended practice</i>: When <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
implementations are encouraged to use the type
denoted by <span class='texttt'><span class='texttt'><i >completion-signatures-for</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
to communicate to users why<a class='hidden_link' href='#expos-39.sentence-5'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='expos-itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#expos-itemdecl:8'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_'><span class='texttt'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <span class='texttt'><i >write-env</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span>;     <span class='comment'>// <i >exposition only</i></span>
</code></div></div><div class='para' id='expos-40'><div class='marginalizedparent'><a class='marginalized' href='#expos-40'>40</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1856'>#</a></div><div class='texpara'><div id='expos-40.sentence-1' class='sentence'><span class='texttt'><i >write-env</i></span> is an exposition-only sender adaptor that,
when connected with a receiver <span class='texttt'>rcvr</span>,
connects the adapted sender with a receiver
whose execution environment is the result of
joining the <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______'><span class='texttt'><i >queryable</i></span></span></a> argument <span class='texttt'>env</span>
to the result of <span class='texttt'>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#expos-40.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-41'><div class='marginalizedparent'><a class='marginalized' href='#expos-41'>41</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1864'>#</a></div><div class='texpara'><div id='expos-41.sentence-1' class='sentence'>Let <span class='texttt'><i >write-env-t</i></span> be an exposition-only empty class type<a class='hidden_link' href='#expos-41.sentence-1'>.</a></div></div></div></div><div class='para' id='expos-42'><div class='marginalizedparent'><a class='marginalized' href='#expos-42'>42</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1867'>#</a></div><div class='texpara'><div id='expos-42.sentence-1' class='sentence'><i >Returns</i>: <span class='codeblock'><i >make-sender</i><span class='parenthesis'>(</span><i >write-env-t</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='expos-43'><div class='marginalizedparent'><a class='marginalized' href='#expos-43'>43</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1873'>#</a></div><div class='texpara'><div id='expos-43.sentence-1' class='sentence'><i >Remarks</i>: The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >write-env-t</i></span> as follows:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >write-env-t</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
  <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span>state, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div></div></div><div id='concepts' class='section'><h3 ><a class='secnum' href='#concepts' style='min-width:80pt'>34.9.3</a> Sender concepts <a class='abbr_ref' href='exec.snd.concepts'>[exec.snd.concepts]</a></h3><div class='para' id='concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1890'>#</a></div><div class='texpara'><div id='concepts-1.sentence-1' class='sentence'>The <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__'><span class='texttt'>sender</span></span></a> concept defines
the requirements for a sender type (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)<a class='hidden_link' href='#concepts-1.sentence-1'>.</a></div> <div id='concepts-1.sentence-2' class='sentence'>The <a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a> concept defines
the requirements for a sender type
that can create asynchronous operations given an associated environment type<a class='hidden_link' href='#concepts-1.sentence-2'>.</a></div> <div id='concepts-1.sentence-3' class='sentence'>The <a href='#concept:sender_to' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to_'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a> concept defines
the requirements for a sender type
that can connect with a specific receiver type<a class='hidden_link' href='#concepts-1.sentence-3'>.</a></div> <div id='concepts-1.sentence-4' class='sentence'>The <span class='texttt'>get_<span class='shy'></span>env</span> customization point object is used to access
a sender's associated attributes<a class='hidden_link' href='#concepts-1.sentence-4'>.</a></div> <div id='concepts-1.sentence-5' class='sentence'>The connect customization point object is used to connect (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
a sender and a receiver to produce an operation state<a class='hidden_link' href='#concepts-1.sentence-5'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sigs<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:valid-completion-signatures' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;            <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a> <span class='operator'>=</span>                                         <span class='comment'>// <i >exposition only</i></span>
      derived_from<span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> Sndr<span class='operator'>::</span>sender_concept, sender_t<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:enable-sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a> <span class='operator'>=</span>                                     <span class='comment'>// <i >exposition only</i></span>
      <a href='#concept:is-sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:is-sender'><span class='tcode_in_codeblock'><i >is-sender</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>|</span><span class='operator'>|</span>
      <a href='#concept:is-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>empty_env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;               <span class='comment'>// <a href='#exec.awaitable' title='34.9.4&emsp;Awaitable helpers'>[exec.<span class='shy'></span>awaitable]</a></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender'><span id='lib:sender'><span class='tcode_in_codeblock'>sender</span></span></span></a> <span class='operator'>=</span>
      <span class='keyword'>bool</span><span class='parenthesis'>(</span><a href='#concept:enable-sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:enable-sender'><span class='tcode_in_codeblock'><i >enable-sender</i></span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a>;
      <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.moveconstructible#concept:move_constructible' title='18.4.13&emsp;Concept move_&shy;constructible&emsp;[concept.moveconstructible]'><span id='conceptref:move_constructible'><span class='tcode_in_codeblock'>move_<span class='shy'></span>constructible</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>remove_cvref_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Sndr<span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env <span class='operator'>=</span> empty_env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_in'><span id='lib:sender_in'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> get_completion_signatures<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>
          <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:valid-completion-signatures' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:valid-completion-signatures_'><span class='tcode_in_codeblock'><i >valid-completion-signatures</i></span></span></a>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender_to' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender_to'><span id='lib:sender_to'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>to</span></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <a href='exec.recv.concepts#concept:receiver_of' title='34.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>Rcvr, completion_signatures_of_t<span class='anglebracket'>&lt;</span>Sndr, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        connect<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1946'>#</a></div><div class='texpara'><div id='concepts-2.sentence-1' class='sentence'>Given a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>rcvr</span> be a receiver
with an associated environment whose type is <span class='texttt'>Env</span><a class='hidden_link' href='#concepts-2.sentence-1'>.</a></div> <div id='concepts-2.sentence-2' class='sentence'>A completion operation is a <a class='hidden_link' href='#def:completion,permissible' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='def:completion,permissible'><i >permissible completion</i></span></a>
for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span>
if its completion signature appears in the argument list of the specialization of <span class='texttt'>completion_<span class='shy'></span>signatures</span> denoted by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#concepts-2.sentence-2'>.</a></div> <div id='concepts-2.sentence-3' class='sentence'><span class='texttt'>Sndr</span> and <span class='texttt'>Env</span> model <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
if all the completion operations
that are potentially evaluated by connecting <span class='texttt'>sndr</span> to <span class='texttt'>rcvr</span> and
starting the resulting operation state
are permissible completions for <span class='texttt'>Sndr</span> and <span class='texttt'>Env</span><a class='hidden_link' href='#concepts-2.sentence-3'>.</a></div></div></div><div class='para' id='concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1961'>#</a></div><div class='texpara'><div id='concepts-3.sentence-1' class='sentence'>A type models
the exposition-only concept <a class='hidden_link' href='#concept:valid-completion-signatures' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:valid-completion-signatures'><span class='texttt'><i >valid-completion-signatures</i></span></span></a>
if it denotes a specialization of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#concepts-3.sentence-1'>.</a></div></div></div><div class='para' id='concepts-4'><div class='marginalizedparent'><a class='marginalized' href='#concepts-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1967'>#</a></div><div class='texpara'><div id='concepts-4.sentence-1' class='sentence'>The exposition-only concepts
<a href='#concept:sender-of' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-of'><span class='texttt'><i >sender-of</i></span></span></a> and <a href='#concept:sender-in-of' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of'><span class='texttt'><i >sender-in-of</i></span></span></a>
define the requirements for a sender type
that completes with a given unique set of value result types<a class='hidden_link' href='#concepts-4.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> As<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >value-signature</i> <span class='operator'>=</span> set_value_t<span class='parenthesis'>(</span>As<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;             <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-in-of' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-in-of'><span class='tcode_in_codeblock'><i >sender-in-of</i></span></span></a> <span class='operator'>=</span>
      <a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
      <i >MATCHING-SIG</i><span class='parenthesis'>(</span>                     <span class='comment'>// see <a href='exec.general' title='34.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
        set_value_t<span class='parenthesis'>(</span>Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>,
        value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, Env, <i >value-signature</i>, type_identity_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Values<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-of' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-of'><span class='tcode_in_codeblock'><i >sender-of</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender-in-of' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-in-of_'><span class='tcode_in_codeblock'><i >sender-in-of</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, empty_env, Values<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='concepts-5'><div class='marginalizedparent'><a class='marginalized' href='#concepts-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L1989'>#</a></div><div class='texpara'><div id='concepts-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Sndr</span><a class='hidden_link' href='#concepts-5.sentence-1'>.</a></div> <div id='concepts-5.sentence-2' class='sentence'>The type <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is as follows:
<ul class='itemize'><li id='concepts-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#concepts-5.1'>(5.1)</a></div>If the declaration
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, data, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>children<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
</span>
would be well-formed, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is
an alias for <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>tag<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>.</li><li id='concepts-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#concepts-5.2'>(5.2)</a></div>Otherwise, <span class='texttt'>tag_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is ill-formed.</li></ul></div></div></div><div class='para' id='concepts-6'><div class='marginalizedparent'><a class='marginalized' href='#concepts-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2005'>#</a></div><div class='texpara'><div id='concepts-6.sentence-1' class='sentence'>Let <a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_'><span class='texttt'><i >sender-for</i></span></span></a> be an exposition-only concept defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Tag<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='concept:sender-for'><span class='tcode_in_codeblock'><i >sender-for</i></span></span></a> <span class='operator'>=</span>
    <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____'><span class='tcode_in_codeblock'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, Tag<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='concepts-7'><div class='marginalizedparent'><a class='marginalized' href='#concepts-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2016'>#</a></div><div class='texpara'><div id='concepts-7.sentence-1' class='sentence'>For a type <span class='texttt'>T</span>,
<span class='texttt'><span class='texttt'><i >SET-VALUE-SIG</i></span><span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span> denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
if <span class='texttt'>T</span> is <span class='mathit'>cv</span> <span class='texttt'><span class='keyword'>void</span></span>;
otherwise, it denotes the type <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='parenthesis'>(</span>T<span class='parenthesis'>)</span></span><a class='hidden_link' href='#concepts-7.sentence-1'>.</a></div></div></div><div class='para' id='concepts-8'><div class='marginalizedparent'><a class='marginalized' href='#concepts-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2022'>#</a></div><div class='texpara'><div id='concepts-8.sentence-1' class='sentence'>Library-provided sender types
<ul class='itemize'><li id='concepts-8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#concepts-8.1'>(8.1)</a></div>always expose an overload of a member <span class='texttt'>connect</span>
that accepts an rvalue sender and</li><li id='concepts-8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#concepts-8.2'>(8.2)</a></div>only expose an overload of a member <span class='texttt'>connect</span>
that accepts an lvalue sender if they model <a href='concept.copyconstructible#concept:copy_constructible' title='18.4.14&emsp;Concept copy_&shy;constructible&emsp;[concept.copyconstructible]'><span id='conceptref:copy_constructible'><span class='texttt'>copy_<span class='shy'></span>constructible</span></span></a><a class='hidden_link' href='#concepts-8.sentence-1'>.</a></li></ul></div></div></div></div><div id='exec.awaitable' class='section'><h3 ><a class='secnum' href='#exec.awaitable' style='min-width:80pt'>34.9.4</a> Awaitable helpers <a class='abbr_ref' href='exec.awaitable'>[exec.awaitable]</a></h3><div class='para' id='exec.awaitable-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2035'>#</a></div><div class='texpara'><div id='exec.awaitable-1.sentence-1' class='sentence'>The sender concepts recognize awaitables as senders<a class='hidden_link' href='#exec.awaitable-1.sentence-1'>.</a></div> <div id='exec.awaitable-1.sentence-2' class='sentence'>For <a href='exec' title='34&emsp;Execution control library'>[exec]</a>, an <a class='hidden_link' href='#def:awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='def:awaitable'><i >awaitable</i></span></a> is an expression
that would be well-formed as the operand of a <span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span></span> expression
within a given context<a class='hidden_link' href='#exec.awaitable-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.awaitable-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2041'>#</a></div><div class='texpara'><div id='exec.awaitable-2.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>,
let <span class='texttt'><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span></span> be expression-equivalent to
the series of transformations and conversions applied to <span class='texttt'>c</span>
as the operand of an <a href='expr.await#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression'><span class='textsf'><i >await-expression</i></span></span></a> in a coroutine,
resulting in lvalue <span class='texttt'>e</span> as described by <a href='expr.await' title='7.6.2.4&emsp;Await'>[expr.<span class='shy'></span>await]</a>,
where <span class='texttt'>p</span> is an lvalue referring to the coroutine's promise,
which has type <span class='texttt'>Promise</span><a class='hidden_link' href='#exec.awaitable-2.sentence-1'>.</a></div> <div id='exec.awaitable-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.awaitable-note-1'>1</a></i>:&ensp;<div id='exec.awaitable-2.sentence-2' class='sentence'>This includes the invocation of
the promise type's <span class='texttt'>await_<span class='shy'></span>transform</span> member if any,
the invocation of the <span class='texttt'><span class='keyword'>operator</span> <span class='keyword'>co_<span class='shy'></span>await</span></span>
picked by overload resolution if any, and
any necessary implicit conversions and materializations<a class='hidden_link' href='#exec.awaitable-2.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.awaitable-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2057'>#</a></div><div class='texpara'><div id='exec.awaitable-3.sentence-1' class='sentence'>Let <a href='#concept:is-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable_'><span class='texttt'><i >is-awaitable</i></span></span></a> be the following exposition-only concept:
<span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a href='#concept:await-suspend-result' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> A, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaiter' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a> <span class='operator'>=</span>                                          <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>A<span class='operator'>&amp;</span> a, coroutine_handle<span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      a<span class='operator'>.</span>await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>?</span> <span class='literal'>1</span> <span class='operator'>:</span> <span class='literal'>0</span>;
      <span class='curlybracket'>{</span> a<span class='operator'>.</span>await_suspend<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:await-suspend-result' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:await-suspend-result_'><span class='tcode_in_codeblock'><i >await-suspend-result</i></span></span></a>;
      a<span class='operator'>.</span>await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> C, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:is-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:is-awaitable'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a> <span class='operator'>=</span>                                        <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>C <span class='parenthesis'>(</span><span class='operator'>*</span>fc<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='curlybracket'>{</span> <i >GET-AWAITER</i><span class='parenthesis'>(</span>fc<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, p<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaiter' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaiter'><span class='tcode_in_codeblock'><i >is-awaiter</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='anglebracket'>&gt;</span>;
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div id='exec.awaitable-3.sentence-2' class='sentence'><span class='texttt'><a class='hidden_link' href='#concept:await-suspend-result' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:await-suspend-result'><span class='texttt'><i >await-suspend-result</i></span></span></a><span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
if and only if one of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.awaitable-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.awaitable-3.1'>(3.1)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>void</span></span>, or</li><li id='exec.awaitable-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.awaitable-3.2'>(3.2)</a></div><span class='texttt'>T</span> is <span class='texttt'><span class='keyword'>bool</span></span>, or</li><li id='exec.awaitable-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.awaitable-3.3'>(3.3)</a></div><span class='texttt'>T</span> is a specialization of <span class='texttt'>coroutine_<span class='shy'></span>handle</span><a class='hidden_link' href='#exec.awaitable-3.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='exec.awaitable-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2088'>#</a></div><div class='texpara'><div id='exec.awaitable-4.sentence-1' class='sentence'>For a subexpression <span class='texttt'>c</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is type <span class='texttt'>C</span>, and
an lvalue <span class='texttt'>p</span> of type <span class='texttt'>Promise</span>,
<span class='texttt'><span class='texttt'><i >await-result-<br>type</i></span><span class='anglebracket'>&lt;</span>C, Promise<span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >GET-AWAITER</i></span><span class='parenthesis'>(</span>c, p<span class='parenthesis'>)</span><span class='operator'>.</span>await_<span class='shy'></span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.awaitable-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.awaitable-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2095'>#</a></div><div class='texpara'><div id='exec.awaitable-5.sentence-1' class='sentence'>Let <span class='texttt'><i >with-await-transform</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> Promise<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:has-as-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='concept:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a> <span class='operator'>=</span>                                  <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> t, Promise<span class='operator'>&amp;</span> p<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='curlybracket'>{</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>p<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='#concept:is-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable__'><span class='tcode_in_codeblock'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Promise<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Derived<span class='anglebracket'>&gt;</span>
    <span class='keyword'>struct</span> <i >with-await-transform</i> <span class='curlybracket'>{</span>                               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T<span class='anglebracket'>&gt;</span>
        T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>

      <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:has-as-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:has-as-awaitable'><span class='tcode_in_codeblock'><i >has-as-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>Derived<span class='anglebracket'>&gt;</span> T<span class='anglebracket'>&gt;</span>
        <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> await_transform<span class='parenthesis'>(</span>T<span class='operator'>&amp;</span><span class='operator'>&amp;</span> value<span class='parenthesis'>)</span>
          <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span>declval<span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>value<span class='parenthesis'>)</span><span class='operator'>.</span>as_awaitable<span class='parenthesis'>(</span><span class='keyword'>static_cast</span><span class='anglebracket'>&lt;</span>Derived<span class='operator'>&amp;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.awaitable-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.awaitable-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2121'>#</a></div><div class='texpara'><div id='exec.awaitable-6.sentence-2' class='sentence'>Let <span class='texttt'><i >env-promise</i></span> be the exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >env-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span> <span class='comment'>// <i >exposition only</i></span>
    <i ><span class='texttt'>unspecified</span></i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <i ><span class='texttt'>unspecified</span></i> final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>const</span> Env<span class='operator'>&amp;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span>
<div id='exec.awaitable-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.awaitable-note-2'>2</a></i>:&ensp;<div id='exec.awaitable-6.sentence-1' class='sentence'>of <span class='texttt'><i >env-promise</i></span> are used only for the purpose of type computation;
its members need not be defined<a class='hidden_link' href='#exec.awaitable-6.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='exec.domain.default' class='section'><h3 ><a class='secnum' href='#exec.domain.default' style='min-width:80pt'>34.9.5</a> <span class='texttt'>execution&#x200b;::&#x200b;default_<span class='shy'></span>domain</span> <a class='abbr_ref' href='exec.domain.default'>[exec.domain.default]</a></h3><div class='para' id='exec.domain.default-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2145'>#</a></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <span id='lib:default_domain'><a class='hidden_link' href='#lib:default_domain' title='34.9.5&emsp;execution&#x200b;::&#x200b;default_&shy;domain&emsp;[exec.domain.default]'>default_domain</a></span> <span class='curlybracket'>{</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
        <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______'><span class='tcode_in_codeblock'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_sender<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable__________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable___________'><span class='tcode_in_codeblock'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> transform_env<span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________'><span class='tcode_in_codeblock'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> apply_sender<span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div class='itemdecl' id='exec.domain.default-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.domain.default-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________'><span class='texttt'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable____________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
<span class='keyword'>constexpr</span> <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:default_domain,transform_sender'><span id='lib:transform_sender,default_domain'>transform_sender</span></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.domain.default-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2172'>#</a></div><div class='texpara'><div id='exec.domain.default-2.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.domain.default-2.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.domain.default-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2180'>#</a></div><div class='texpara'><div id='exec.domain.default-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#exec.domain.default-3.sentence-1'>.</a></div></div><div class='texpara'><div id='exec.domain.default-3.sentence-2' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.domain.default-3.sentence-2'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.domain.default-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.domain.default-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________'><span class='texttt'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_____________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>constexpr</span> <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable______________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:default_domain,transform_env'><span id='lib:transform_env,default_domain'>transform_env</span></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.domain.default-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2194'>#</a></div><div class='texpara'><div id='exec.domain.default-4.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>tag_of_t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed;
otherwise, <span class='texttt'><span class='keyword'>static_<span class='shy'></span>cast</span><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.domain.default-4.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.domain.default-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2202'>#</a></div><div class='texpara'><div id='exec.domain.default-5.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.domain.default-5.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.domain.default-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2206'>#</a></div><div class='texpara'><div id='exec.domain.default-6.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#exec.domain.default-6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.domain.default-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.domain.default-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:default_domain,apply_sender'><span id='lib:apply_sender,default_domain'>apply_sender</span></span><span class='parenthesis'>(</span>Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
  <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.domain.default-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2218'>#</a></div><div class='texpara'><div id='exec.domain.default-7.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>  Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='exec.domain.default-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2224'>#</a></div><div class='texpara'><div id='exec.domain.default-8.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'>e</span> is a well-formed expression<a class='hidden_link' href='#exec.domain.default-8.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.domain.default-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2228'>#</a></div><div class='texpara'><div id='exec.domain.default-9.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#exec.domain.default-9.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.domain.default-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.domain.default-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2232'>#</a></div><div class='texpara'><div id='exec.domain.default-10.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.domain.default-10.sentence-1'>.</a></div></div></div></div></div><div id='transform' class='section'><h3 ><a class='secnum' href='#transform' style='min-width:80pt'>34.9.6</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.transform'>[exec.snd.transform]</a></h3><div class='texpara'><div class='itemdecl' id='transform-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#transform-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________'><span class='texttt'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_______________'><span class='texttt'><i >queryable</i></span></span></a><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Env<span class='anglebracket'>&gt;</span>
      <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>Env<span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>
    <span class='keyword'>constexpr</span> <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________'><span class='texttt'>sender</span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:transform_sender'><a class='hidden_link' href='#lib:transform_sender' title='34.9.6&emsp;execution&#x200b;::&#x200b;transform_&shy;sender&emsp;[exec.snd.transform]'>transform_sender</a></span><span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>const</span> Env<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> env<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div><div class='para' id='transform-1'><div class='marginalizedparent'><a class='marginalized' href='#transform-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2249'>#</a></div><div class='texpara'><div id='transform-1.sentence-1' class='sentence'>Let <span class='texttt'><i >transformed-sndr</i></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_sender<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div> <div id='transform-1.sentence-2' class='sentence'>
Let <span class='texttt'><i >final-sndr</i></span> be the expression <span class='texttt'><i >transformed-sndr</i></span>
if <span class='texttt'><i >transformed-sndr</i></span> and <span class='texttt'><i >sndr</i></span>
have the same type ignoring cv-qualifiers;
otherwise, it is
the expression <span class='texttt'>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>dom, transformed<span class='operator'>-</span>sndr, env<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#transform-1.sentence-2'>.</a></div></div></div></div><div class='para' id='transform-2'><div class='marginalizedparent'><a class='marginalized' href='#transform-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2264'>#</a></div><div class='texpara'><div id='transform-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><i >final-sndr</i></span><a class='hidden_link' href='#transform-2.sentence-1'>.</a></div></div></div></div><div class='para' id='transform-3'><div class='marginalizedparent'><a class='marginalized' href='#transform-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2268'>#</a></div><div class='texpara'><div id='transform-3.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to
<span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='texttt'><i >final-sndr</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#transform-3.sentence-1'>.</a></div></div></div></div></div><div id='transform.env' class='section'><h3 ><a class='secnum' href='#transform.env' style='min-width:80pt'>34.9.7</a> <span class='texttt'>execution&#x200b;::&#x200b;transform_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.snd.transform.env'>[exec.snd.transform.env]</a></h3><div class='texpara'><div class='itemdecl' id='transform.env-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#transform.env-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________'><span class='texttt'>sender</span></span></a> Sndr, <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable________________'><span class='texttt'><i >queryable</i></span></span></a> Env<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <a href='exec.queryable.concept#concept:queryable' title='34.2.2&emsp;queryable concept&emsp;[exec.queryable.concept]'><span id='conceptref:queryable_________________'><span class='texttt'><i >queryable</i></span></span></a> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:transform_env'><a class='hidden_link' href='#lib:transform_env' title='34.9.7&emsp;execution&#x200b;::&#x200b;transform_&shy;env&emsp;[exec.snd.transform.env]'>transform_env</a></span><span class='parenthesis'>(</span>Domain dom, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Env<span class='operator'>&amp;</span><span class='operator'>&amp;</span> env<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
<span class='curlybracket'>}</span>
</code></div></div><div class='para' id='transform.env-1'><div class='marginalizedparent'><a class='marginalized' href='#transform.env-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2284'>#</a></div><div class='texpara'><div id='transform.env-1.sentence-1' class='sentence'>Let <span class='texttt'>e</span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>transform_env<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='transform.env-2'><div class='marginalizedparent'><a class='marginalized' href='#transform.env-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2294'>#</a></div><div class='texpara'><div id='transform.env-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#transform.env-2.sentence-1'>.</a></div></div></div></div><div class='para' id='transform.env-3'><div class='marginalizedparent'><a class='marginalized' href='#transform.env-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2298'>#</a></div><div class='texpara'><div id='transform.env-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>e</span><a class='hidden_link' href='#transform.env-3.sentence-1'>.</a></div></div></div></div></div><div id='apply' class='section'><h3 ><a class='secnum' href='#apply' style='min-width:80pt'>34.9.8</a> <span class='texttt'>execution&#x200b;::&#x200b;apply_<span class='shy'></span>sender</span> <a class='abbr_ref' href='exec.snd.apply'>[exec.snd.apply]</a></h3><div class='texpara'><div class='itemdecl' id='apply-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#apply-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Domain, <span class='keyword'>class</span> Tag, <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________'><span class='texttt'>sender</span></span></a> Sndr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>constexpr</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span id='lib:apply_sender'><a class='hidden_link' href='#lib:apply_sender' title='34.9.8&emsp;execution&#x200b;::&#x200b;apply_&shy;sender&emsp;[exec.snd.apply]'>apply_sender</a></span><span class='parenthesis'>(</span>Domain dom, Tag, Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>
      <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</code></div></div><div class='para' id='apply-1'><div class='marginalizedparent'><a class='marginalized' href='#apply-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2314'>#</a></div><div class='texpara'><div id='apply-1.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>e</span></span> be the expression
<span class='codeblock'>dom<span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span>
if that expression is well-formed; otherwise,
<span class='codeblock'>default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='operator'>.</span>apply_sender<span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>
</span></div></div></div></div><div class='para' id='apply-2'><div class='marginalizedparent'><a class='marginalized' href='#apply-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2324'>#</a></div><div class='texpara'><div id='apply-2.sentence-1' class='sentence'><i >Constraints</i>: The expression <span class='math'><span class='mathalpha'>e</span></span> is well-formed<a class='hidden_link' href='#apply-2.sentence-1'>.</a></div></div></div></div><div class='para' id='apply-3'><div class='marginalizedparent'><a class='marginalized' href='#apply-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2328'>#</a></div><div class='texpara'><div id='apply-3.sentence-1' class='sentence'><i >Returns</i>: <span class='math'><span class='mathalpha'>e</span></span><a class='hidden_link' href='#apply-3.sentence-1'>.</a></div></div></div></div><div class='para' id='apply-4'><div class='marginalizedparent'><a class='marginalized' href='#apply-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2332'>#</a></div><div class='texpara'><div id='apply-4.sentence-1' class='sentence'><i >Remarks</i>: The exception specification is equivalent to <span class='texttt'><span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#apply-4.sentence-1'>.</a></div></div></div></div></div><div id='exec.getcomplsigs' class='section'><h3 ><a class='secnum' href='#exec.getcomplsigs' style='min-width:80pt'>34.9.9</a> <span class='texttt'>execution&#x200b;::&#x200b;get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> <a class='abbr_ref' href='exec.getcomplsigs'>[exec.getcomplsigs]</a></h3><div class='para' id='exec.getcomplsigs-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.getcomplsigs-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2339'>#</a></div><div class='texpara'><div id='exec.getcomplsigs-1.sentence-1' class='sentence'><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> is a customization point object<a class='hidden_link' href='#exec.getcomplsigs-1.sentence-1'>.</a></div> <div id='exec.getcomplsigs-1.sentence-2' class='sentence'>Let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Sndr</span>, and
let <span class='texttt'>env</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is <span class='texttt'>Env</span><a class='hidden_link' href='#exec.getcomplsigs-1.sentence-2'>.</a></div> <div id='exec.getcomplsigs-1.sentence-3' class='sentence'>Let <span class='texttt'>new_<span class='shy'></span>sndr</span> be the expression
<span class='texttt'>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-late</i></span><span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, sndr, env<span class='parenthesis'>)</span></span>, and
let <span class='texttt'>NewSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.getcomplsigs-1.sentence-3'>.</a></div> <div id='exec.getcomplsigs-1.sentence-4' class='sentence'>Then <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='keyword'>void</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>, CS<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
except that <span class='texttt'><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> and <span class='texttt'><span class='keyword'>void</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> are
indeterminately sequenced,
where <span class='texttt'>CS</span> is:
<ul class='itemize'><li id='exec.getcomplsigs-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.getcomplsigs-1.1'>(1.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='operator'>.</span>get_<span class='shy'></span>completion_<span class='shy'></span>signatures<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
if that type is well-formed,</li><li id='exec.getcomplsigs-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.getcomplsigs-1.2'>(1.2)</a></div>Otherwise, <span class='texttt'>remove_<span class='shy'></span>cvref_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>NewSndr<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span>completion_<span class='shy'></span>signatures</span>
if that type is well-formed,</li><li id='exec.getcomplsigs-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.getcomplsigs-1.3'>(1.3)</a></div>Otherwise,
if <span class='texttt'><a href='#concept:is-awaitable' title='34.9.4&emsp;Awaitable helpers&emsp;[exec.awaitable]'><span id='conceptref:is-awaitable___'><span class='texttt'><i >is-awaitable</i></span></span></a><span class='anglebracket'>&lt;</span>NewSndr, <span class='texttt'><i >env-promise</i></span><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
then:
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span><i >await-result-type</i><span class='anglebracket'>&lt;</span>NewSndr, <i >env-promise</i><span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>,        <span class='comment'>//  (<a href='#concepts' title='34.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a>)</span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></li><li id='exec.getcomplsigs-1.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.getcomplsigs-1.4'>(1.4)</a></div>Otherwise, <span class='texttt'>CS</span> is ill-formed<a class='hidden_link' href='#exec.getcomplsigs-1.sentence-4'>.</a></li></ul></div></div></div><div class='para' id='exec.getcomplsigs-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.getcomplsigs-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2377'>#</a></div><div class='texpara'><div id='exec.getcomplsigs-2.sentence-1' class='sentence'>Let <span class='texttt'>rcvr</span> be an rvalue
whose type <span class='texttt'>Rcvr</span> models <a href='exec.recv.concepts#concept:receiver' title='34.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver'><span class='texttt'>receiver</span></span></a>, and
let <span class='texttt'>Sndr</span> be the type of a sender
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.getcomplsigs-2.sentence-1'>.</a></div> <div id='exec.getcomplsigs-2.sentence-2' class='sentence'>Let <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be the template arguments of
the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.getcomplsigs-2.sentence-2'>.</a></div> <div id='exec.getcomplsigs-2.sentence-3' class='sentence'>Let <span class='texttt'>CSO</span> be a completion function<a class='hidden_link' href='#exec.getcomplsigs-2.sentence-3'>.</a></div> <div id='exec.getcomplsigs-2.sentence-4' class='sentence'>If sender <span class='texttt'>Sndr</span> or its operation state cause
the expression <span class='texttt'>CSO<span class='parenthesis'>(</span>rcvr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
to be potentially evaluated (<a href='basic.def.odr' title='6.3&emsp;One-definition rule'>[basic.<span class='shy'></span>def.<span class='shy'></span>odr]</a>)
then there shall be a signature <span class='texttt'>Sig</span> in <span class='texttt'>Sigs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>
such that
<span class='codeblock'><i >MATCHING-SIG</i><span class='parenthesis'>(</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>CSO<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>, Sig<span class='parenthesis'>)</span>
</span>
is <span class='texttt'><span class='literal'>true</span></span> (<a href='exec.general' title='34.1&emsp;General'>[exec.<span class='shy'></span>general]</a>)<a class='hidden_link' href='#exec.getcomplsigs-2.sentence-4'>.</a></div></div></div></div><div id='exec.connect' class='section'><h3 ><a class='secnum' href='#exec.connect' style='min-width:80pt'>34.9.10</a> <span class='texttt'>execution&#x200b;::&#x200b;connect</span> <a class='abbr_ref' href='exec.connect'>[exec.connect]</a></h3><div class='para' id='exec.connect-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2398'>#</a></div><div class='texpara'><div id='exec.connect-1.sentence-1' class='sentence'><span class='texttt'>connect</span> connects (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) a sender with a receiver<a class='hidden_link' href='#exec.connect-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.connect-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2401'>#</a></div><div class='texpara'><div id='exec.connect-2.sentence-1' class='sentence'>The name <span class='texttt'>connect</span> denotes a customization point object<a class='hidden_link' href='#exec.connect-2.sentence-1'>.</a></div> <div id='exec.connect-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>rcvr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Rcvr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
let <span class='texttt'>new_<span class='shy'></span>sndr</span> be the expression
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >get-domain-late</i><span class='parenthesis'>(</span>sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and let <span class='texttt'>DS</span> and <span class='texttt'>DR</span> be
<span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> and <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>, respectively<a class='hidden_link' href='#exec.connect-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.connect-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2413'>#</a></div><div class='texpara'><div id='exec.connect-3.sentence-1' class='sentence'>Let <span class='texttt'><i >connect-awaitable-promise</i></span> be the following exposition-only class:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >connect-awaitable-promise</i> <span class='operator'>:</span> <i >with-await-transform</i><span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

    <i >connect-awaitable-promise</i><span class='parenthesis'>(</span>DS<span class='operator'>&amp;</span>, DR<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    suspend_always initial_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> suspend_always final_suspend<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> unhandled_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> return_void<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> terminate<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> unhandled_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='keyword'>return</span> noop_coroutine<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <i >operation-state-task</i> get_return_object<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >operation-state-task</i><span class='curlybracket'>{</span>
        coroutine_handle<span class='anglebracket'>&lt;</span><i >connect-awaitable-promise</i><span class='anglebracket'>&gt;</span><span class='operator'>::</span>from_promise<span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    env_of_t<span class='anglebracket'>&lt;</span>DR<span class='anglebracket'>&gt;</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    DR<span class='operator'>&amp;</span> <i >rcvr</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='exec.connect-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2447'>#</a></div><div class='texpara'><div id='exec.connect-4.sentence-1' class='sentence'>Let <span class='texttt'><i >operation-state-task</i></span> be the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >operation-state-task</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> operation_state_concept <span class='operator'>=</span> operation_state_t;
    <span class='keyword'>using</span> promise_type <span class='operator'>=</span> <i >connect-awaitable-promise</i>;

    <span class='keyword'>explicit</span> <i >operation-state-task</i><span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>:</span> coro<span class='parenthesis'>(</span>h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <i >operation-state-task</i><span class='parenthesis'>(</span><i >operation-state-task</i><span class='operator'>&amp;</span><span class='operator'>&amp;</span> o<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
      <span class='operator'>:</span> <i >coro</i><span class='parenthesis'>(</span>exchange<span class='parenthesis'>(</span>o<span class='operator'>.</span><i >coro</i>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='operator'>~</span><i >operation-state-task</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >coro</i><span class='parenthesis'>)</span> <i >coro</i><span class='operator'>.</span>destroy<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> start<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >coro</i><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

  <span class='keyword'>private</span><span class='operator'>:</span>
    coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> <i >coro</i>;                                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.connect-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2470'>#</a></div><div class='texpara'><div id='exec.connect-5.sentence-1' class='sentence'>Let <span class='texttt'>V</span> name the type
<span class='texttt'><span class='texttt'><i >await-result-type</i></span><span class='anglebracket'>&lt;</span>DS, <span class='texttt'><i >connect-awaitable-promise</i></span><span class='anglebracket'>&gt;</span></span>,
let <span class='texttt'>Sigs</span> name the type
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>
  <i >SET-VALUE-SIG</i><span class='parenthesis'>(</span>V<span class='parenthesis'>)</span>,         <span class='comment'>// see  (<a href='#concepts' title='34.9.3&emsp;Sender concepts'>[exec.<span class='shy'></span>snd.<span class='shy'></span>concepts]</a>)</span>
  set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>,
  set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span>
and let <span class='texttt'><i >connect-awaitable</i></span> be an exposition-only coroutine
defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Fun, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <i >suspend-complete</i><span class='parenthesis'>(</span>Fun fun, Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> as<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>auto</span> fn <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span>, fun<span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> fun<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

    <span class='keyword'>struct</span> awaiter <span class='curlybracket'>{</span>
      <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >fn</i><span class='parenthesis'>)</span> <i >fn</i>;                                     <span class='comment'>// <i >exposition only</i></span>

      <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
      <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <i >fn</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>[</span>noreturn<span class='squarebracket'>]</span><span class='squarebracket'>]</span> <span class='keyword'>void</span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> unreachable<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>return</span> awaiter<span class='curlybracket'>{</span><i >fn</i><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>

  <i >operation-state-task</i> <i >connect-awaitable</i><span class='parenthesis'>(</span>DS sndr, DR rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <a href='exec.recv.concepts#concept:receiver_of' title='34.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of_'><span class='tcode_in_codeblock'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span>DR, Sigs<span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
    exception_ptr ep;
    <span class='keyword'>try</span> <span class='curlybracket'>{</span>
      <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>V, <span class='keyword'>void</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
        <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_value, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <span class='keyword'>co_await</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      ep <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
    <span class='keyword'>co_await</span> <i >suspend-complete</i><span class='parenthesis'>(</span>set_error, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ep<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.connect-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.connect-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2515'>#</a></div><div class='texpara'><div id='exec.connect-6.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>sndr, rcvr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<ul class='itemize'><li id='exec.connect-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.connect-6.1'>(6.1)</a></div><div class='texpara'><div id='exec.connect-6.1.sentence-1' class='sentence'><span class='texttt'>new_<span class='shy'></span>sndr<span class='operator'>.</span>connect<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span></span> if that expression is well-formed<a class='hidden_link' href='#exec.connect-6.1.sentence-1'>.</a></div></div><div class='texpara'><div id='exec.connect-6.1.sentence-2' class='sentence'><i >Mandates</i>: The type of the expression above satisfies <a href='exec.opstate.general#concept:operation_state' title='34.8.1&emsp;General&emsp;[exec.opstate.general]'><span id='conceptref:operation_state'><span class='texttt'>operation_<span class='shy'></span>state</span></span></a><a class='hidden_link' href='#exec.connect-6.1.sentence-2'>.</a></div></div></li><li id='exec.connect-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.connect-6.2'>(6.2)</a></div><div class='texpara'><div id='exec.connect-6.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'><span class='texttt'><i >connect-awaitable</i></span><span class='parenthesis'>(</span>new_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.connect-6.2.sentence-1'>.</a></div></div></li></ul></div></div><div class='texpara'><div id='exec.connect-6.sentence-2' class='sentence'><i >Mandates</i>: <span class='texttt'><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <a href='exec.recv.concepts#concept:receiver' title='34.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_'><span class='texttt'>receiver</span></span></a><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.connect-6.sentence-2'>.</a></div></div></div></div><div id='exec.factories' class='section'><h3 ><a class='secnum' href='#exec.factories' style='min-width:80pt'>34.9.11</a> Sender factories <a class='abbr_ref' href='exec.factories'>[exec.factories]</a></h3><div id='exec.schedule' class='section'><h4 ><a class='secnum' href='#exec.schedule' style='min-width:95pt'>34.9.11.1</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule</span> <a class='abbr_ref' href='exec.schedule'>[exec.schedule]</a></h4><div class='para' id='exec.schedule-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2535'>#</a></div><div class='texpara'><div id='exec.schedule-1.sentence-1' class='sentence'><span class='texttt'>schedule</span> obtains a schedule sender (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>)
from a scheduler<a class='hidden_link' href='#exec.schedule-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2539'>#</a></div><div class='texpara'><div id='exec.schedule-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule</span> denotes a customization point object<a class='hidden_link' href='#exec.schedule-2.sentence-1'>.</a></div> <div id='exec.schedule-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sch</span>,
the expression <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.schedule-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2545'>#</a></div><div class='texpara'><div id='exec.schedule-3.sentence-1' class='sentence'><i >Mandates</i>: The type of <span class='texttt'>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.schedule-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2549'>#</a></div><div class='texpara'><div id='exec.schedule-4.sentence-1' class='sentence'>If the expression
<span class='codeblock'>get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>sch<span class='operator'>.</span>schedule<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> sch
</span>
is ill-formed or evaluates to <span class='texttt'><span class='literal'>false</span></span>,
the behavior of calling <span class='texttt'>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span></span> is undefined<a class='hidden_link' href='#exec.schedule-4.sentence-1'>.</a></div></div></div></div><div id='exec.just' class='section'><h4 ><a class='secnum' href='#exec.just' style='min-width:95pt'>34.9.11.2</a> <span class='texttt'>execution&#x200b;::&#x200b;just</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;just_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.just'>[exec.just]</a></h4><div class='para' id='exec.just-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.just-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2559'>#</a></div><div class='texpara'><div id='exec.just-1.sentence-1' class='sentence'><span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> are sender factories
whose asynchronous operations complete synchronously in their start operation
with a value completion operation,
an error completion operation, or
a stopped completion operation, respectively<a class='hidden_link' href='#exec.just-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.just-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.just-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2566'>#</a></div><div class='texpara'><div id='exec.just-2.sentence-1' class='sentence'>The names <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span> denote
customization point objects<a class='hidden_link' href='#exec.just-2.sentence-1'>.</a></div> <div id='exec.just-2.sentence-2' class='sentence'>Let <span class='texttt'><i >just-cpo</i></span> be one of
<span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, or <span class='texttt'>just_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.just-2.sentence-2'>.</a></div> <div id='exec.just-2.sentence-3' class='sentence'>For a pack of subexpressions <span class='texttt'>ts</span>,
let <span class='texttt'>Ts</span> be the pack of types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.just-2.sentence-3'>.</a></div> <div id='exec.just-2.sentence-4' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >just-cpo</i></span><span class='parenthesis'>(</span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is ill-formed if
<ul class='itemize'><li id='exec.just-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.just-2.1'>(2.1)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_'><span class='texttt'><i >movable-value</i></span></span></a><span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='exec.just-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.just-2.2'>(2.2)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>error</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='exec.just-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.just-2.3'>(2.3)</a></div><span class='texttt'><i >just-cpo</i></span> is <span class='texttt'>just_<span class='shy'></span>stopped</span> and
<span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.just-2.sentence-4'>.</a></li></ul></div></div><div class='texpara'><div id='exec.just-2.sentence-5' class='sentence'>Otherwise, it is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span><span class='texttt'><i >just-cpo</i></span>, <span class='texttt'><i >product-type</i></span>ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.just-2.sentence-5'>.</a></div></div><div class='texpara'><div id='exec.just-2.sentence-6' class='sentence'>For <span class='texttt'>just</span>, <span class='texttt'>just_<span class='shy'></span>error</span>, and <span class='texttt'>just_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.just-2.sentence-6'>.</a></div> <div id='exec.just-2.sentence-7' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >just-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >just-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>ts<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
        <i >set-cpo</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='exec.read.env' class='section'><h4 ><a class='secnum' href='#exec.read.env' style='min-width:95pt'>34.9.11.3</a> <span class='texttt'>execution&#x200b;::&#x200b;read_<span class='shy'></span>env</span> <a class='abbr_ref' href='exec.read.env'>[exec.read.env]</a></h4><div class='para' id='exec.read.env-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.read.env-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2608'>#</a></div><div class='texpara'><div id='exec.read.env-1.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a sender factory for a sender
whose asynchronous operation completes synchronously in its start operation
with a value completion result equal to
a value read from the receiver's associated environment<a class='hidden_link' href='#exec.read.env-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.read.env-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.read.env-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2614'>#</a></div><div class='texpara'><div id='exec.read.env-2.sentence-1' class='sentence'><span class='texttt'>read_<span class='shy'></span>env</span> is a customization point object<a class='hidden_link' href='#exec.read.env-2.sentence-1'>.</a></div> <div id='exec.read.env-2.sentence-2' class='sentence'>For some query object <span class='texttt'>q</span>,
the expression <span class='texttt'>read_<span class='shy'></span>env<span class='parenthesis'>(</span>q<span class='parenthesis'>)</span></span> is expression-equivalent to
<span class='texttt'><span class='texttt'><i >make-sender</i></span><span class='parenthesis'>(</span>read_<span class='shy'></span>env, q<span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.read.env-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.read.env-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.read.env-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2620'>#</a></div><div class='texpara'><div id='exec.read.env-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>read_<span class='shy'></span>env</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span>read_env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> start <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> query, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, query<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div></div><div id='exec.adapt' class='section'><h3 ><a class='secnum' href='#exec.adapt' style='min-width:80pt'>34.9.12</a> Sender adaptors <a class='abbr_ref' href='exec.adapt'>[exec.adapt]</a></h3><div id='exec.adapt.general' class='section'><h4 ><a class='secnum' href='#exec.adapt.general' style='min-width:95pt'>34.9.12.1</a> General <a class='abbr_ref' href='exec.adapt.general'>[exec.adapt.general]</a></h4><div class='para' id='exec.adapt.general-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2639'>#</a></div><div class='texpara'><div id='exec.adapt.general-1.sentence-1' class='sentence'>Subclause <a href='#exec.adapt' title='34.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a> specifies a set of sender adaptors<a class='hidden_link' href='#exec.adapt.general-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.adapt.general-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2642'>#</a></div><div class='texpara'><div id='exec.adapt.general-2.sentence-1' class='sentence'>The bitwise inclusive <span class='textsc'>or</span> operator is overloaded
for the purpose of creating sender chains<a class='hidden_link' href='#exec.adapt.general-2.sentence-1'>.</a></div> <div id='exec.adapt.general-2.sentence-2' class='sentence'>The adaptors also support function call syntax with equivalent semantics<a class='hidden_link' href='#exec.adapt.general-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.adapt.general-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2647'>#</a></div><div class='texpara'><div id='exec.adapt.general-3.sentence-1' class='sentence'>Unless otherwise specified:
<ul class='itemize'><li id='exec.adapt.general-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.general-3.1'>(3.1)</a></div><div class='texpara'><div id='exec.adapt.general-3.1.sentence-1' class='sentence'>A sender adaptor is prohibited from causing observable effects,
apart from moving and copying its arguments,
before the returned sender is connected with a receiver using <span class='texttt'>connect</span>,
and <span class='texttt'>start</span> is called on the resulting operation state<a class='hidden_link' href='#exec.adapt.general-3.1.sentence-1'>.</a></div></div></li><li id='exec.adapt.general-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.general-3.2'>(3.2)</a></div><div class='texpara'><div id='exec.adapt.general-3.2.sentence-1' class='sentence'>A parent sender (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) with a single child sender <span class='texttt'>sndr</span> has
an associated attribute object equal to
<span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> (<a href='exec.fwd.env' title='34.5.1&emsp;forwarding_&shy;query'>[exec.<span class='shy'></span>fwd.<span class='shy'></span>env]</a>)<a class='hidden_link' href='#exec.adapt.general-3.2.sentence-1'>.</a></div></div></li><li id='exec.adapt.general-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.general-3.3'>(3.3)</a></div><div class='texpara'><div id='exec.adapt.general-3.3.sentence-1' class='sentence'>A parent sender with more than one child sender has
an associated attributes object equal to <span class='texttt'>empty_<span class='shy'></span>env<span class='curlybracket'>{</span><span class='curlybracket'>}</span></span><a class='hidden_link' href='#exec.adapt.general-3.3.sentence-1'>.</a></div></div></li><li id='exec.adapt.general-3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.general-3.4'>(3.4)</a></div><div class='texpara'><div id='exec.adapt.general-3.4.sentence-1' class='sentence'>When a parent sender is connected to a receiver <span class='texttt'>rcvr</span>,
any receiver used to connect a child sender has
an associated environment equal to <span class='texttt'><span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.adapt.general-3.4.sentence-1'>.</a></div></div></li><li id='exec.adapt.general-3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.general-3.5'>(3.5)</a></div><div class='texpara'><div id='exec.adapt.general-3.5.sentence-1' class='sentence'>These requirements apply to any function
that is selected by the implementation of the sender adaptor<a class='hidden_link' href='#exec.adapt.general-3.5.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.adapt.general-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2671'>#</a></div><div class='texpara'><div id='exec.adapt.general-4.sentence-1' class='sentence'>If a sender returned from a sender adaptor specified in <a href='#exec.adapt' title='34.9.12&emsp;Sender adaptors'>[exec.<span class='shy'></span>adapt]</a>
is specified to include <span class='texttt'>set_<span class='shy'></span>error_<span class='shy'></span>t<span class='parenthesis'>(</span>Err<span class='parenthesis'>)</span></span>
among its set of completion signatures
where <span class='texttt'>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Err<span class='anglebracket'>&gt;</span></span> denotes the type <span class='texttt'>exception_<span class='shy'></span>ptr</span>,
but the implementation does not potentially evaluate
an error completion operation with an <span class='texttt'>exception_<span class='shy'></span>ptr</span> argument,
the implementation is allowed to omit
the <span class='texttt'>exception_<span class='shy'></span>ptr</span> error completion signature from the set<a class='hidden_link' href='#exec.adapt.general-4.sentence-1'>.</a></div></div></div></div><div id='exec.adapt.obj' class='section'><h4 ><a class='secnum' href='#exec.adapt.obj' style='min-width:95pt'>34.9.12.2</a> Closure objects <a class='abbr_ref' href='exec.adapt.obj'>[exec.adapt.obj]</a></h4><div class='para' id='exec.adapt.obj-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.obj-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2683'>#</a></div><div class='texpara'><div id='exec.adapt.obj-1.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_closure_object,pipeable' title='34.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_closure_object,pipeable'><i >pipeable sender adaptor closure object</i></span></a> is a function object
that accepts one or more <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________'><span class='texttt'>sender</span></span></a> arguments and returns a <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.adapt.obj-1.sentence-1'>.</a></div> <div id='exec.adapt.obj-1.sentence-2' class='sentence'>For a pipeable sender adaptor closure object <span class='texttt'>c</span> and
an expression <span class='texttt'>sndr</span>
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________'><span class='texttt'>sender</span></span></a>,
the following expressions are equivalent and yield a <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________'><span class='texttt'>sender</span></span></a>:
<span class='codeblock'>c<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>
sndr <span class='operator'>|</span> c
</span></div> <div id='exec.adapt.obj-1.sentence-3' class='sentence'>
Given an additional pipeable sender adaptor closure object <span class='texttt'>d</span>,
the expression <span class='texttt'>c <span class='operator'>|</span> d</span> produces
another pipeable sender adaptor closure object <span class='texttt'>e</span>:</div></div><div class='texpara'><div id='exec.adapt.obj-1.sentence-4' class='sentence'><span class='texttt'>e</span> is a perfect forwarding call wrapper (<a href='func.require' title='22.10.4&emsp;Requirements'>[func.<span class='shy'></span>require]</a>)
with the following properties:
<ul class='itemize'><li id='exec.adapt.obj-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-1.1'>(1.1)</a></div><div class='texpara'><div id='exec.adapt.obj-1.1.sentence-1' class='sentence'>Its target object is an object <span class='texttt'>d2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>d<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>d</span><a class='hidden_link' href='#exec.adapt.obj-1.1.sentence-1'>.</a></div></div></li><li id='exec.adapt.obj-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-1.2'>(1.2)</a></div><div class='texpara'><div id='exec.adapt.obj-1.2.sentence-1' class='sentence'>It has one bound argument entity,
an object <span class='texttt'>c2</span> of type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>c<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
direct-non-list-initialized with <span class='texttt'>c</span><a class='hidden_link' href='#exec.adapt.obj-1.2.sentence-1'>.</a></div></div></li><li id='exec.adapt.obj-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-1.3'>(1.3)</a></div><div class='texpara'><div id='exec.adapt.obj-1.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>d2<span class='parenthesis'>(</span>c2<span class='parenthesis'>(</span>arg<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>,
where arg is the argument used in a function call expression of <span class='texttt'>e</span><a class='hidden_link' href='#exec.adapt.obj-1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='exec.adapt.obj-1.sentence-5' class='sentence'>
The expression <span class='texttt'>c <span class='operator'>|</span> d</span> is well-formed if and only if
the initializations of the state entities (<a href='func.def' title='22.10.3&emsp;Definitions'>[func.<span class='shy'></span>def]</a>) of <span class='texttt'>e</span>
are all well-formed<a class='hidden_link' href='#exec.adapt.obj-1.sentence-5'>.</a></div></div></div><div class='para' id='exec.adapt.obj-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.obj-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2716'>#</a></div><div class='texpara'><div id='exec.adapt.obj-2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> of type <span class='texttt'>T</span> is
a pipeable sender adaptor closure object
if <span class='texttt'>T</span> models <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>,
<span class='texttt'>T</span> has no other base classes
of type <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>U<span class='anglebracket'>&gt;</span></span> for any other type <span class='texttt'>U</span>, and
<span class='texttt'>T</span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.adapt.obj-2.sentence-1'>.</a></div></div></div><div class='para' id='exec.adapt.obj-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.obj-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2724'>#</a></div><div class='texpara'><div id='exec.adapt.obj-3.sentence-1' class='sentence'>The template parameter <span class='texttt'>D</span> for <span class='texttt'>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure</span> can be
an incomplete type<a class='hidden_link' href='#exec.adapt.obj-3.sentence-1'>.</a></div> <div id='exec.adapt.obj-3.sentence-2' class='sentence'>Before any expression of type <span class='mathit'>cv</span> <span class='texttt'>D</span> appears as
an operand to the <span class='texttt'><span class='operator'>|</span></span> operator,
<span class='texttt'>D</span> shall be complete and
model <span class='texttt'><a href='concept.derived#concept:derived_from' title='18.4.3&emsp;Concept derived_&shy;from&emsp;[concept.derived]'><span id='conceptref:derived_from_'><span class='texttt'>derived_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>sender_<span class='shy'></span>adaptor_<span class='shy'></span>closure<span class='anglebracket'>&lt;</span>D<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.adapt.obj-3.sentence-2'>.</a></div> <div id='exec.adapt.obj-3.sentence-3' class='sentence'>The behavior of an expression involving an object of type <span class='mathit'>cv</span> <span class='texttt'>D</span>
as an operand to the <span class='texttt'><span class='operator'>|</span></span> operator is undefined
if overload resolution selects a program-defined <span class='texttt'><span class='keyword'>operator</span><span class='operator'>|</span></span> function<a class='hidden_link' href='#exec.adapt.obj-3.sentence-3'>.</a></div></div></div><div class='para' id='exec.adapt.obj-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.obj-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2735'>#</a></div><div class='texpara'><div id='exec.adapt.obj-4.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:sender_adaptor_object,pipeable' title='34.9.12.2&emsp;Closure objects&emsp;[exec.adapt.obj]'><span id='def:sender_adaptor_object,pipeable'><i >pipeable sender adaptor object</i></span></a> is a customization point object
that accepts a <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________'><span class='texttt'>sender</span></span></a> as its first argument and
returns a <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.adapt.obj-4.sentence-1'>.</a></div> <div id='exec.adapt.obj-4.sentence-2' class='sentence'>If a pipeable sender adaptor object accepts only one argument,
then it is a pipeable sender adaptor closure object<a class='hidden_link' href='#exec.adapt.obj-4.sentence-2'>.</a></div></div></div><div class='para' id='exec.adapt.obj-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.adapt.obj-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2742'>#</a></div><div class='texpara'><div id='exec.adapt.obj-5.sentence-1' class='sentence'>If a pipeable sender adaptor object adaptor accepts more than one argument,
then let <span class='texttt'>sndr</span> be an expression
such that <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> models <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________'><span class='texttt'>sender</span></span></a>,
let <span class='texttt'>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> be arguments
such that <span class='texttt'>adaptor<span class='parenthesis'>(</span>sndr, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is a well-formed expression
as specified below, and
let <span class='texttt'>BoundArgs</span> be a pack that denotes <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span><a class='hidden_link' href='#exec.adapt.obj-5.sentence-1'>.</a></div> <div id='exec.adapt.obj-5.sentence-2' class='sentence'>The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> produces
a pipeable sender adaptor closure object <span class='texttt'>f</span>
that is a perfect forwarding call wrapper with the following properties:
<ul class='itemize'><li id='exec.adapt.obj-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-5.1'>(5.1)</a></div><div class='texpara'><div id='exec.adapt.obj-5.1.sentence-1' class='sentence'>Its target object is a copy of adaptor<a class='hidden_link' href='#exec.adapt.obj-5.1.sentence-1'>.</a></div></div></li><li id='exec.adapt.obj-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-5.2'>(5.2)</a></div><div class='texpara'><div id='exec.adapt.obj-5.2.sentence-1' class='sentence'>Its bound argument entities <span class='texttt'>bound_<span class='shy'></span>args</span> consist of
objects of types <span class='texttt'>BoundArgs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span> direct-non-list-initialized with
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, respectively<a class='hidden_link' href='#exec.adapt.obj-5.2.sentence-1'>.</a></div></div></li><li id='exec.adapt.obj-5.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.adapt.obj-5.3'>(5.3)</a></div><div class='texpara'><div id='exec.adapt.obj-5.3.sentence-1' class='sentence'>Its call pattern is <span class='texttt'>adaptor<span class='parenthesis'>(</span>rcvr, bound_<span class='shy'></span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>rcvr</span> is
the argument used in a function call expression of <span class='texttt'>f</span><a class='hidden_link' href='#exec.adapt.obj-5.3.sentence-1'>.</a></div></div></li></ul></div> <div id='exec.adapt.obj-5.sentence-3' class='sentence'>
The expression <span class='texttt'>adaptor<span class='parenthesis'>(</span>args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed if and only if
the initializations of the bound argument entities of the result,
as specified above, are all well-formed<a class='hidden_link' href='#exec.adapt.obj-5.sentence-3'>.</a></div></div></div></div><div id='exec.starts.on' class='section'><h4 ><a class='secnum' href='#exec.starts.on' style='min-width:95pt'>34.9.12.3</a> <span class='texttt'>execution&#x200b;::&#x200b;starts_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.starts.on'>[exec.starts.on]</a></h4><div class='para' id='exec.starts.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2771'>#</a></div><div class='texpara'><div id='exec.starts.on-1.sentence-1' class='sentence'><span class='texttt'>starts_<span class='shy'></span>on</span> adapts an input sender into a sender
that will start on an execution agent belonging to
a particular scheduler's associated execution resource<a class='hidden_link' href='#exec.starts.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2776'>#</a></div><div class='texpara'><div id='exec.starts.on-2.sentence-1' class='sentence'>The name <span class='texttt'>starts_<span class='shy'></span>on</span> denotes a customization point object<a class='hidden_link' href='#exec.starts.on-2.sentence-1'>.</a></div> <div id='exec.starts.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><br>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.starts.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.starts.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2783'>#</a></div><div class='texpara'><div id='exec.starts.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>starts_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.starts.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.starts.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2793'>#</a></div><div class='texpara'><div id='exec.starts.on-4.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>OutSndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-4.sentence-1'>.</a></div> <div id='exec.starts.on-4.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for__'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, starts_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed; otherwise
<ul class='itemize'><li id='exec.starts.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.1'>(4.1)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li><li id='exec.starts.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.starts.on-4.2'>(4.2)</a></div><span class='texttt'>starts_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, sndr<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>return</span> let_value<span class='parenthesis'>(</span>
  schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>,
  <span class='squarebracket'>[</span>sndr <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>decay_t<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.starts.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.starts.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2819'>#</a></div><div class='texpara'><div id='exec.starts.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>starts_<span class='shy'></span>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-1'>.</a></div> <div id='exec.starts.on-5.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.starts.on-5.sentence-2'>.</a></div> <div id='exec.starts.on-5.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.starts.on-5.sentence-3'>.</a></div> <div id='exec.starts.on-5.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall start <span class='texttt'>sndr</span>
on an execution agent of the associated execution resource of <span class='texttt'>sch</span><a class='hidden_link' href='#exec.starts.on-5.sentence-4'>.</a></div> <div id='exec.starts.on-5.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.starts.on-5.sentence-5'>.</a></div></div></div></div><div id='exec.continues.on' class='section'><h4 ><a class='secnum' href='#exec.continues.on' style='min-width:95pt'>34.9.12.4</a> <span class='texttt'>execution&#x200b;::&#x200b;continues_<span class='shy'></span>on</span> <a class='abbr_ref' href='exec.continues.on'>[exec.continues.on]</a></h4><div class='para' id='exec.continues.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2836'>#</a></div><div class='texpara'><div id='exec.continues.on-1.sentence-1' class='sentence'><span class='texttt'>continues_<span class='shy'></span>on</span> adapts a sender into one
that completes on the specified scheduler<a class='hidden_link' href='#exec.continues.on-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2840'>#</a></div><div class='texpara'><div id='exec.continues.on-2.sentence-1' class='sentence'>The name <span class='texttt'>continues_<span class='shy'></span>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.continues.on-2.sentence-1'>.</a></div> <div id='exec.continues.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.continues.on-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.continues.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2847'>#</a></div><div class='texpara'><div id='exec.continues.on-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>continues_on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.continues.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.continues.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2855'>#</a></div><div class='texpara'><div id='exec.continues.on-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span>
is specialized for <span class='texttt'>continues_<span class='shy'></span>on_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>continues_on_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.continues.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2870'>#</a></div><div class='texpara'><div id='exec.continues.on-5.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-5.sentence-1'>.</a></div> <div id='exec.continues.on-5.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for___'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, continues_<span class='shy'></span>on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then
the expression <span class='texttt'>continues_<span class='shy'></span>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equal to:
<span class='codeblock'><span class='keyword'>auto</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> schedule_from<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.continues.on-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.continues.on-note-1'>1</a></i>:&ensp;<div id='exec.continues.on-5.sentence-2' class='sentence'>This causes the <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> sender to become
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.continues.on-5.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div><div class='para' id='exec.continues.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.continues.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2887'>#</a></div><div class='texpara'><div id='exec.continues.on-6.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>continues_<span class='shy'></span>on<span class='parenthesis'>(</span>sndr, sch<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-1'>.</a></div> <div id='exec.continues.on-6.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.continues.on-6.sentence-2'>.</a></div> <div id='exec.continues.on-6.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.continues.on-6.sentence-3'>.</a></div> <div id='exec.continues.on-6.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.continues.on-6.sentence-4'>.</a></div> <div id='exec.continues.on-6.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.continues.on-6.sentence-5'>.</a></div></div></div></div><div id='exec.schedule.from' class='section'><h4 ><a class='secnum' href='#exec.schedule.from' style='min-width:95pt'>34.9.12.5</a> <span class='texttt'>execution&#x200b;::&#x200b;schedule_<span class='shy'></span>from</span> <a class='abbr_ref' href='exec.schedule.from'>[exec.schedule.from]</a></h4><div class='para' id='exec.schedule.from-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2906'>#</a></div><div class='texpara'><div id='exec.schedule.from-1.sentence-1' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> schedules work dependent on the completion of a sender
onto a scheduler's associated execution resource<a class='hidden_link' href='#exec.schedule.from-1.sentence-1'>.</a></div> <div id='exec.schedule.from-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.schedule.from-note-1'>1</a></i>:&ensp;<div id='exec.schedule.from-1.sentence-2' class='sentence'><span class='texttt'>schedule_<span class='shy'></span>from</span> is not meant to be used in user code;
it is used in the implementation of <span class='texttt'>continues_<span class='shy'></span>on</span><a class='hidden_link' href='#exec.schedule.from-1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.schedule.from-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2914'>#</a></div><div class='texpara'><div id='exec.schedule.from-2.sentence-1' class='sentence'>The name <span class='texttt'>schedule_<span class='shy'></span>from</span> denotes a customization point object<a class='hidden_link' href='#exec.schedule.from-2.sentence-1'>.</a></div> <div id='exec.schedule.from-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
let <span class='texttt'>Sch</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-2.sentence-2'>.</a></div> <div id='exec.schedule.from-2.sentence-3' class='sentence'>If <span class='texttt'>Sch</span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler__'><span class='texttt'>scheduler</span></span></a>, or
<span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.schedule.from-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.schedule.from-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2923'>#</a></div><div class='texpara'><div id='exec.schedule.from-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>schedule_from, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.schedule.from-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2933'>#</a></div><div class='texpara'><div id='exec.schedule.from-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>schedule_<span class='shy'></span>from_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>schedule_from_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2947'>#</a></div><div class='texpara'><div id='exec.schedule.from-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> data, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ATTRS</i><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2956'>#</a></div><div class='texpara'><div id='exec.schedule.from-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><i ><span class='texttt'>see below</span></i><span class='parenthesis'>)</span>
    <span class='keyword'>requires</span> <a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>

  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, sch, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;

  <span class='keyword'>using</span> sched_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> receiver_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> operation_t <span class='operator'>=</span> connect_result_t<span class='anglebracket'>&lt;</span>schedule_result_t<span class='anglebracket'>&lt;</span>sched_t<span class='anglebracket'>&gt;</span>, receiver_t<span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='literal'>nullptr</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    variant_t <i >async-result</i>;     <span class='comment'>// <i >exposition only</i></span>
    operation_t <i >op-state</i>;       <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >state-type</i><span class='parenthesis'>(</span>sched_t sch, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span>
      <span class='operator'>:</span> <i >rcvr</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, <i >op-state</i><span class='parenthesis'>(</span>connect<span class='parenthesis'>(</span>schedule<span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span>, receiver_t<span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>sch, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2984'>#</a></div><div class='texpara'><div id='exec.schedule.from-7.sentence-1' class='sentence'>Objects of the local class <span class='texttt'><i >state-type</i></span> can be used
to initialize a structured binding<a class='hidden_link' href='#exec.schedule.from-7.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2988'>#</a></div><div class='texpara'><div id='exec.schedule.from-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be
a pack of the arguments to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>child<span class='operator'>-</span>type<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.schedule.from-8.sentence-1'>.</a></div> <div id='exec.schedule.from-8.sentence-2' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
that transforms a completion signature <span class='texttt'>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> into
the tuple specialization <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.schedule.from-8.sentence-2'>.</a></div> <div id='exec.schedule.from-8.sentence-3' class='sentence'>Then <span class='texttt'>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>,
except with duplicate types removed<a class='hidden_link' href='#exec.schedule.from-8.sentence-3'>.</a></div></div></div><div class='para' id='exec.schedule.from-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L2999'>#</a></div><div class='texpara'><div id='exec.schedule.from-9.sentence-1' class='sentence'><span class='texttt'>receiver_<span class='shy'></span>t</span> is an alias for the following exposition-only class:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >receiver-type</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;
    <i >state-type</i><span class='operator'>*</span> <i >state</i>;          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      visit<span class='parenthesis'>(</span>
        <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tuple<span class='operator'>&amp;</span> result<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>monostate, Tuple<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>args<span class='squarebracket'>]</span> <span class='operator'>=</span> result;
            tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>,
        <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >async-result</i><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.schedule.from-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3034'>#</a></div><div class='texpara'><div id='exec.schedule.from-10.sentence-1' class='sentence'>The expression in the <span class='texttt'><span class='keyword'>noexcept</span></span> clause of the lambda is <span class='texttt'><span class='literal'>true</span></span>
if the construction of the returned <span class='texttt'><i >state-type</i></span> object
is not potentially throwing;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.schedule.from-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.schedule.from-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3040'>#</a></div><div class='texpara'><div id='exec.schedule.from-11.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>schedule_<span class='shy'></span>from_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
    <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> result_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>result_t, Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;

  <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>result_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span>valueless_by_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >async-result</i><span class='operator'>.</span>index<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>0</span><span class='parenthesis'>)</span>
    <span class='keyword'>return</span>;

  start<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >op-state</i><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.schedule.from-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.schedule.from-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3062'>#</a></div><div class='texpara'><div id='exec.schedule.from-12.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>schedule_<span class='shy'></span>from<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such,
and let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.schedule.from-12.sentence-1'>.</a></div> <div id='exec.schedule.from-12.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.schedule.from-12.sentence-2'>.</a></div> <div id='exec.schedule.from-12.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.schedule.from-12.sentence-3'>.</a></div> <div id='exec.schedule.from-12.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
start <span class='texttt'>sndr</span> on the current execution agent and
execute completion operations on <span class='texttt'>out_<span class='shy'></span>rcvr</span>
on an execution agent of the execution resource associated with <span class='texttt'>sch</span><a class='hidden_link' href='#exec.schedule.from-12.sentence-4'>.</a></div> <div id='exec.schedule.from-12.sentence-5' class='sentence'>If scheduling onto <span class='texttt'>sch</span> fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.schedule.from-12.sentence-5'>.</a></div></div></div></div><div id='exec.on' class='section'><h4 ><a class='secnum' href='#exec.on' style='min-width:95pt'>34.9.12.6</a> <span class='texttt'>execution&#x200b;::&#x200b;on</span> <a class='abbr_ref' href='exec.on'>[exec.on]</a></h4><div class='para' id='exec.on-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3081'>#</a></div><div class='texpara'><div id='exec.on-1.sentence-1' class='sentence'>The <span class='texttt'>on</span> sender adaptor has two forms:
<ul class='itemize'><li id='exec.on-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.1'>(1.1)</a></div><div class='texpara'><div id='exec.on-1.1.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span>,
which starts a sender <span class='texttt'>sndr</span> on an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource and
that, upon <span class='texttt'>sndr</span>'s completion,
transfers execution back to the execution resource
on which the <span class='texttt'>on</span> sender was started<a class='hidden_link' href='#exec.on-1.1.sentence-1'>.</a></div></div></li><li id='exec.on-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-1.2'>(1.2)</a></div><div class='texpara'><div id='exec.on-1.2.sentence-1' class='sentence'><span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span>,
which upon completion of a sender <span class='texttt'>sndr</span>,
transfers execution to an execution agent
belonging to a scheduler <span class='texttt'>sch</span>'s associated execution resource,
then executes a sender adaptor closure <span class='texttt'>closure</span>
with the async results of the sender, and
that then transfers execution back to the execution resource
on which <span class='texttt'>sndr</span> completed<a class='hidden_link' href='#exec.on-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.on-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3102'>#</a></div><div class='texpara'><div id='exec.on-2.sentence-1' class='sentence'>The name <span class='texttt'>on</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.on-2.sentence-1'>.</a></div> <div id='exec.on-2.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sch</span> and <span class='texttt'>sndr</span>,
<span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is ill-formed if any of the following is true:
<ul class='itemize'><li id='exec.on-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler___'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.2'>(2.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr</span> is not
a pipeable sender adaptor closure object (<a href='#exec.adapt.obj' title='34.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>), or</li><li id='exec.on-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-2.3'>(2.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________'><span class='texttt'>sender</span></span></a> and
<span class='texttt'>sndr </span>is also a pipeable sender adaptor closure object<a class='hidden_link' href='#exec.on-2.sentence-2'>.</a></li></ul></div></div></div><div class='para' id='exec.on-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3118'>#</a></div><div class='texpara'><div id='exec.on-3.sentence-1' class='sentence'>Otherwise, if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> satisfies <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________'><span class='texttt'>sender</span></span></a>,
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >query-or-default</i><span class='parenthesis'>(</span>get_domain, sch, default_domain<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, sch, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sch</span> is evaluated only once<a class='hidden_link' href='#exec.on-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3128'>#</a></div><div class='texpara'><div id='exec.on-4.sentence-1' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>sch</span>, and <span class='texttt'>closure</span>, if
<ul class='itemize'><li id='exec.on-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.1'>(4.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler____'><span class='texttt'>scheduler</span></span></a>, or</li><li id='exec.on-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.2'>(4.2)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.on-4.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-4.3'>(4.3)</a></div><span class='texttt'>closure</span> is not a pipeable sender adaptor closure object (<a href='#exec.adapt.obj' title='34.9.12.2&emsp;Closure objects'>[exec.<span class='shy'></span>adapt.<span class='shy'></span>obj]</a>),</li></ul>
the expression <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>
  <i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>,
  <i >make-sender</i><span class='parenthesis'>(</span>on, <i >product-type</i><span class='curlybracket'>{</span>sch, closure<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.on-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3147'>#</a></div><div class='texpara'><div id='exec.on-5.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> and <span class='texttt'>env</span> be subexpressions,
let <span class='texttt'>OutSndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>, and
let <span class='texttt'>Env</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-5.sentence-1'>.</a></div> <div id='exec.on-5.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>OutSndr, on_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expressions <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> and
<span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span> are ill-formed<a class='hidden_link' href='#exec.on-5.sentence-2'>.</a></div></div></div><div class='para' id='exec.on-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3155'>#</a></div><div class='texpara'><div id='exec.on-6.sentence-1' class='sentence'>Otherwise:
Let <span class='texttt'><i >not-a-scheduler</i></span> be an unspecified empty class type, and
let <span class='texttt'><i >not-a-sender</i></span> be the exposition-only type:
<span class='codeblock'><span class='keyword'>struct</span> <i >not-a-sender</i> <span class='curlybracket'>{</span>
  <span class='keyword'>using</span> sender_concept <span class='operator'>=</span> sender_t;

  <span class='keyword'>auto</span> get_completion_signatures<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span>
where the member function <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span> returns
an object of a type that is not
a specialization of the <span class='texttt'>completion_<span class='shy'></span>signatures</span> class template<a class='hidden_link' href='#exec.on-6.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3172'>#</a></div><div class='texpara'><div id='exec.on-7.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler_____'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >SCHED-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, <i >FWD-ENV</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Env<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3184'>#</a></div><div class='texpara'><div id='exec.on-8.sentence-1' class='sentence'>The expression <span class='texttt'>on<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, env<span class='parenthesis'>)</span></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, child<span class='squarebracket'>]</span> <span class='operator'>=</span> out_sndr;
<span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='exec.sched#concept:scheduler' title='34.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler______'><span class='tcode_in_codeblock'>scheduler</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span>
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> continues_on<span class='parenthesis'>(</span>
      starts_on<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>data<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
      std<span class='operator'>::</span>move<span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>sch, closure<span class='squarebracket'>]</span> <span class='operator'>=</span> data;
  <span class='keyword'>auto</span> orig_sch <span class='operator'>=</span> <i >query-with-default</i><span class='parenthesis'>(</span>
    get_completion_scheduler<span class='anglebracket'>&lt;</span>set_value_t<span class='anglebracket'>&gt;</span>,
    get_env<span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <i >query-with-default</i><span class='parenthesis'>(</span>get_scheduler, env, <i >not-a-scheduler</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;

  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span>, <i >not-a-scheduler</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >not-a-sender</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >write-env</i><span class='parenthesis'>(</span>
      continues_on<span class='parenthesis'>(</span>
        std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>closure<span class='parenthesis'>)</span><span class='parenthesis'>(</span>
          continues_on<span class='parenthesis'>(</span>
            <i >write-env</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>OutSndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <i >SCHED-ENV</i><span class='parenthesis'>(</span>orig_sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
            sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
        orig_sch<span class='parenthesis'>)</span>,
      <i >SCHED-ENV</i><span class='parenthesis'>(</span>sch<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.on-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3222'>#</a></div><div class='texpara'><div id='exec.on-9.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use
the return type of <span class='texttt'><span class='texttt'><i >not-a-sender</i></span><span class='operator'>&#x200b;::&#x200b;</span>get_<span class='shy'></span>completion_<span class='shy'></span>signatures</span>
to inform users that their usage of <span class='texttt'>on</span> is incorrect
because there is no available scheduler onto which to restore execution<a class='hidden_link' href='#exec.on-9.sentence-1'>.</a></div></div></div><div class='para' id='exec.on-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3229'>#</a></div><div class='texpara'><div id='exec.on-10.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sch, sndr<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-10.sentence-1'>.</a></div> <div id='exec.on-10.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in____________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-10.sentence-2'>.</a></div> <div id='exec.on-10.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-3'>.</a></div> <div id='exec.on-10.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.1'>(10.1)</a></div>remember the current scheduler, <span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li><li id='exec.on-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.2'>(10.2)</a></div>start <span class='texttt'>sndr</span> on an execution agent belonging to
sch's associated execution resource;</li><li id='exec.on-10.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.3'>(10.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1; and</li><li id='exec.on-10.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-10.4'>(10.4)</a></div>forward <span class='texttt'>sndr</span>'s async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-10.sentence-4'>.</a></li></ul></div> <div id='exec.on-10.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed
on an unspecified execution agent<a class='hidden_link' href='#exec.on-10.sentence-5'>.</a></div></div></div><div class='para' id='exec.on-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.on-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3256'>#</a></div><div class='texpara'><div id='exec.on-11.sentence-1' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>sndr</span> be a subexpression denoting
a sender returned from <span class='texttt'>on<span class='parenthesis'>(</span>sndr, sch, closure<span class='parenthesis'>)</span></span> or one equal to such, and
let <span class='texttt'>OutSndr</span> be the type <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>out_<span class='shy'></span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.on-11.sentence-1'>.</a></div> <div id='exec.on-11.sentence-2' class='sentence'>Let <span class='texttt'>out_<span class='shy'></span>rcvr</span> be a subexpression denoting a receiver
that has an environment of type <span class='texttt'>Env</span>
such that <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_____________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>OutSndr, Env<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#exec.on-11.sentence-2'>.</a></div> <div id='exec.on-11.sentence-3' class='sentence'>Let <span class='texttt'>op</span> be an lvalue referring to the operation state
that results from connecting <span class='texttt'>out_<span class='shy'></span>sndr</span> with <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-11.sentence-3'>.</a></div> <div id='exec.on-11.sentence-4' class='sentence'>Calling <span class='texttt'>start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span></span> shall
<ul class='itemize'><li id='exec.on-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.1'>(11.1)</a></div>remember the current scheduler,
which is the first of the following expressions that is well-formed:
<ul class='itemize'><li id='exec.on-11.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-11.1.1'>(11.1.1)</a></div><span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>set_<span class='shy'></span>value_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.on-11.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.on-11.1.2'>(11.1.2)</a></div><span class='texttt'>get_<span class='shy'></span>scheduler<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>;</li></ul></li><li id='exec.on-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.2'>(11.2)</a></div>start <span class='texttt'>sndr</span> on the current execution agent;</li><li id='exec.on-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.3'>(11.3)</a></div>upon <span class='texttt'>sndr</span>'s completion,
transfer execution to an agent
owned by sch's associated execution resource;</li><li id='exec.on-11.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.4'>(11.4)</a></div>forward <span class='texttt'>sndr</span>'s async result as if by
connecting and starting a sender <span class='texttt'>closure<span class='parenthesis'>(</span>S<span class='parenthesis'>)</span></span>,
where <span class='texttt'>S</span> is a sender
that completes synchronously with <span class='texttt'>sndr</span>'s async result; and</li><li id='exec.on-11.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.on-11.5'>(11.5)</a></div>upon completion of the operation started in the previous step,
transfer execution back to the execution resource
associated with the scheduler remembered in step 1 and
forward the operation's async result to <span class='texttt'>out_<span class='shy'></span>rcvr</span><a class='hidden_link' href='#exec.on-11.sentence-4'>.</a></li></ul></div> <div id='exec.on-11.sentence-5' class='sentence'>
If any scheduling operation fails,
an error completion on <span class='texttt'>out_<span class='shy'></span>rcvr</span> shall be executed on
an unspecified execution agent<a class='hidden_link' href='#exec.on-11.sentence-5'>.</a></div></div></div></div><div id='exec.then' class='section'><h4 ><a class='secnum' href='#exec.then' style='min-width:95pt'>34.9.12.7</a> <span class='texttt'>execution&#x200b;::&#x200b;then</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;upon_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.then'>[exec.then]</a></h4><div class='para' id='exec.then-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3297'>#</a></div><div class='texpara'><div id='exec.then-1.sentence-1' class='sentence'><span class='texttt'>then</span> attaches an invocable as a continuation
for an input sender's value completion operation<a class='hidden_link' href='#exec.then-1.sentence-1'>.</a></div> <div id='exec.then-1.sentence-2' class='sentence'><span class='texttt'>upon_<span class='shy'></span>error</span> and <span class='texttt'>upon_<span class='shy'></span>stopped</span> do the same
for the error and stopped completion operations, respectively,
sending the result of the invocable as a value completion<a class='hidden_link' href='#exec.then-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.then-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3304'>#</a></div><div class='texpara'><div id='exec.then-2.sentence-1' class='sentence'>The names <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>
denote pipeable sender adaptor objects<a class='hidden_link' href='#exec.then-2.sentence-1'>.</a></div> <div id='exec.then-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >then-cpo</i></span> be one of
<span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, or <span class='texttt'>upon_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.then-2.sentence-2'>.</a></div> <div id='exec.then-2.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender__________________________________'><span class='texttt'>sender</span></span></a>, or
<span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value__'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span> </span>is ill-formed<a class='hidden_link' href='#exec.then-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.then-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3314'>#</a></div><div class='texpara'><div id='exec.then-3.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >then-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.then-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.then-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3322'>#</a></div><div class='texpara'><div id='exec.then-4.sentence-1' class='sentence'>For <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.then-4.sentence-1'>.</a></div> <div id='exec.then-4.sentence-2' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >then-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >then-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span>
      <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
        <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> fn, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
          <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span>set<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
            <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr,
                          invoke<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
            Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
          <span class='curlybracket'>}</span>
        <span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.then-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.then-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3346'>#</a></div><div class='texpara'><div id='exec.then-5.sentence-1' class='sentence'>The expression <span class='texttt'><span class='texttt'><i >then-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> has undefined behavior
unless it returns a sender<span class='texttt'>out_<span class='shy'></span>sndr</span> that
<ul class='itemize'><li id='exec.then-5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-5.1'>(5.1)</a></div>invokes <span class='texttt'>f</span> or a copy of such
with the value, error, or stopped result datums of <span class='texttt'>sndr</span>
for <span class='texttt'>then</span>, <span class='texttt'>upon_<span class='shy'></span>error</span>, and <span class='texttt'>upon_<span class='shy'></span>stopped</span>, respectively,
using the result value of <span class='texttt'>f</span> as <span class='texttt'>out_<span class='shy'></span>sndr</span>'s value completion, and</li><li id='exec.then-5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.then-5.2'>(5.2)</a></div>forwards all other completion operations unchanged<a class='hidden_link' href='#exec.then-5.sentence-1'>.</a></li></ul></div></div></div></div><div id='exec.let' class='section'><h4 ><a class='secnum' href='#exec.let' style='min-width:95pt'>34.9.12.8</a> <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>value</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>error</span>, <span class='texttt'>execution&#x200b;::&#x200b;let_<span class='shy'></span>stopped</span> <a class='abbr_ref' href='exec.let'>[exec.let]</a></h4><div class='para' id='exec.let-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3361'>#</a></div><div class='texpara'><div id='exec.let-1.sentence-1' class='sentence'><span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> transform
a sender's value, error, and stopped completions, respectively,
into a new child asynchronous operation
by passing the sender's result datums to a user-specified callable,
which returns a new sender that is connected and started<a class='hidden_link' href='#exec.let-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3368'>#</a></div><div class='texpara'><div id='exec.let-2.sentence-1' class='sentence'>For <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span>,
let <span class='texttt'><i >set-cpo</i></span> be
<span class='texttt'>set_<span class='shy'></span>value</span>, <span class='texttt'>set_<span class='shy'></span>error</span>, and <span class='texttt'>set_<span class='shy'></span>stopped</span>, respectively<a class='hidden_link' href='#exec.let-2.sentence-1'>.</a></div> <div id='exec.let-2.sentence-2' class='sentence'>Let the expression <span class='texttt'><i >let-cpo</i></span> be one of
<span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, or <span class='texttt'>let_<span class='shy'></span>stopped</span><a class='hidden_link' href='#exec.let-2.sentence-2'>.</a></div> <div id='exec.let-2.sentence-3' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> be expression-equivalent to
the first well-formed expression below:
<ul class='itemize'><li id='exec.let-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.1'>(2.1)</a></div><span class='texttt'>SCHED<span class='operator'>-</span>ENV<span class='parenthesis'>(</span>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.2'>(2.2)</a></div><span class='texttt'><span class='texttt'><i >MAKE-ENV</i></span><span class='parenthesis'>(</span>get_<span class='shy'></span>domain, get_<span class='shy'></span>domain<span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span></li><li id='exec.let-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-2.3'>(2.3)</a></div><span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, empty_<span class='shy'></span>env<span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span></li></ul></div></div></div><div class='para' id='exec.let-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3386'>#</a></div><div class='texpara'><div id='exec.let-3.sentence-1' class='sentence'>The names <span class='texttt'>let_<span class='shy'></span>value</span>, <span class='texttt'>let_<span class='shy'></span>error</span>, and <span class='texttt'>let_<span class='shy'></span>stopped</span> denote
pipeable sender adaptor objects<a class='hidden_link' href='#exec.let-3.sentence-1'>.</a></div> <div id='exec.let-3.sentence-2' class='sentence'>For subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>f</span>,
let <span class='texttt'>F</span> be the decayed type of <span class='texttt'>f</span><a class='hidden_link' href='#exec.let-3.sentence-2'>.</a></div> <div id='exec.let-3.sentence-3' class='sentence'>If <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender___________________________________'><span class='texttt'>sender</span></span></a> or
if <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value___'><span class='texttt'><i >movable-value</i></span></span></a>,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-3'>.</a></div> <div id='exec.let-3.sentence-4' class='sentence'>If <span class='texttt'>F</span> does not satisfy <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='texttt'>invocable</span></span></a>,
the expression <span class='texttt'>let_<span class='shy'></span>stopped<span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.let-3.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3397'>#</a></div><div class='texpara'><div id='exec.let-4.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span><i >let-cpo</i>, f, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.let-4.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3405'>#</a></div><div class='texpara'><div id='exec.let-5.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >let-cpo</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='keyword'>void</span> <i >let-bind</i><span class='parenthesis'>(</span>State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span>;      <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >let-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3421'>#</a></div><div class='texpara'><div id='exec.let-6.sentence-1' class='sentence'>Let <span class='texttt'><i >receiver2</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >receiver2</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>)</span> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span><i >env</i>, <i >FWD-ENV</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_env<span class='parenthesis'>(</span><i >rcvr</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    Rcvr<span class='operator'>&amp;</span> <i >rcvr</i>;                 <span class='comment'>// <i >exposition only</i></span>
    Env <i >env</i>;                    <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3453'>#</a></div><div class='texpara'><div id='exec.let-7.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
  <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, fn, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
  <span class='keyword'>using</span> fn_t <span class='operator'>=</span> decay_t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>;
  <span class='keyword'>using</span> env_t <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>using</span> args_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='keyword'>using</span> ops2_variant_t <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
    fn_t <i >fn</i>;                    <span class='comment'>// <i >exposition only</i></span>
    env_t <i >env</i>;                  <span class='comment'>// <i >exposition only</i></span>
    args_variant_t <i >args</i>;        <span class='comment'>// <i >exposition only</i></span>
    ops2_variant_t <i >ops2</i>;        <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>fn<span class='parenthesis'>)</span>, <i >let-env</i><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, <span class='curlybracket'>{</span><span class='curlybracket'>}</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3474'>#</a></div><div class='texpara'><div id='exec.let-8.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization named by
<span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >child-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-1'>.</a></div> <div id='exec.let-8.sentence-2' class='sentence'>Let <span class='texttt'>LetSigs</span> be a pack of those types in <span class='texttt'>Sigs</span>
with a return type of <span class='texttt'><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >set-cpo</i></span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-2'>.</a></div> <div id='exec.let-8.sentence-3' class='sentence'>Let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-8.sentence-3'>.</a></div> <div id='exec.let-8.sentence-4' class='sentence'>Then <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span>monostate, <span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-8.sentence-4'>.</a></div></div></div><div class='para' id='exec.let-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3487'>#</a></div><div class='texpara'><div id='exec.let-9.sentence-1' class='sentence'>Given a type <span class='texttt'>Tag</span> and a pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-sndr2</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-sndr2</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >call-result-t</i></span><span class='anglebracket'>&lt;</span>Fn, decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.let-9.sentence-1'>.</a></div> <div id='exec.let-9.sentence-2' class='sentence'>Then <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> denotes
the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>monostate, connect_result_t<span class='anglebracket'>&lt;</span><i >as-sndr2</i><span class='anglebracket'>&lt;</span>LetSigs<span class='anglebracket'>&gt;</span>, <i >receiver2</i><span class='anglebracket'>&lt;</span>Rcvr, Env<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
except with duplicate types removed<a class='hidden_link' href='#exec.let-9.sentence-2'>.</a></div></div></div><div class='para' id='exec.let-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3499'>#</a></div><div class='texpara'><div id='exec.let-10.sentence-1' class='sentence'>The <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause'><span class='textsf'><i >requires-clause</i></span></span></a> constraining the above lambda is satisfied
if and only if
the types <span class='texttt'>args_<span class='shy'></span>variant_<span class='shy'></span>t</span> and <span class='texttt'>ops2_<span class='shy'></span>variant_<span class='shy'></span>t</span> are well-formed<a class='hidden_link' href='#exec.let-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.let-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3504'>#</a></div><div class='texpara'><div id='exec.let-11.sentence-1' class='sentence'>The exposition-only function template <span class='texttt'><i >let-bind</i></span>
has effects equivalent to:
<span class='codeblock'><span class='keyword'>using</span> args_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
<span class='keyword'>auto</span> mkop2 <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> connect<span class='parenthesis'>(</span>
    apply<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>fn<span class='parenthesis'>)</span>,
          state<span class='operator'>.</span>args<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>args_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >receiver2</i><span class='curlybracket'>{</span>rcvr, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span>env<span class='parenthesis'>)</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;
start<span class='parenthesis'>(</span>state<span class='operator'>.</span>ops2<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>mkop2<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><i >emplace-from</i><span class='curlybracket'>{</span>mkop2<span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.let-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3518'>#</a></div><div class='texpara'><div id='exec.let-12.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span>let<span class='operator'>-</span>cpo<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span> state, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, <i >decayed-typeof</i><span class='anglebracket'>&lt;</span><i >set-cpo</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <i >let-bind</i><span class='parenthesis'>(</span>state, rcvr, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.let-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3532'>#</a></div><div class='texpara'><div id='exec.let-13.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions, and
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-13.sentence-1'>.</a></div> <div id='exec.let-13.sentence-2' class='sentence'>If
<span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_____'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >decayed-typeof</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >let-cpo</i></span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='operator'>.</span>transform_<span class='shy'></span>env<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed<a class='hidden_link' href='#exec.let-13.sentence-2'>.</a></div> <div id='exec.let-13.sentence-3' class='sentence'>Otherwise, it is equal to
<span class='texttt'><span class='texttt'><i >JOIN-ENV</i></span><span class='parenthesis'>(</span><span class='texttt'><i >let-env</i></span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >FWD-ENV</i></span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.let-13.sentence-3'>.</a></div></div></div><div class='para' id='exec.let-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.let-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3543'>#</a></div><div class='texpara'><div id='exec.let-14.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'><span class='texttt'><i >let-cpo</i></span><span class='parenthesis'>(</span>sndr, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.let-14.sentence-1'>.</a></div> <div id='exec.let-14.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started:
<ul class='itemize'><li id='exec.let-14.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.1'>(14.1)</a></div>invokes <span class='texttt'>f</span> when <span class='texttt'><i >set-cpo</i></span> is called
with <span class='texttt'>sndr</span>'s result datums,</li><li id='exec.let-14.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.2'>(14.2)</a></div>makes its completion dependent on
the completion of a sender returned by <span class='texttt'>f</span>, and</li><li id='exec.let-14.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.let-14.3'>(14.3)</a></div>propagates the other completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#exec.let-14.sentence-2'>.</a></li></ul></div></div></div></div><div id='exec.bulk' class='section'><h4 ><a class='secnum' href='#exec.bulk' style='min-width:95pt'>34.9.12.9</a> <span class='texttt'>execution&#x200b;::&#x200b;bulk</span> <a class='abbr_ref' href='exec.bulk'>[exec.bulk]</a></h4><div class='para' id='exec.bulk-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3565'>#</a></div><div class='texpara'><div id='exec.bulk-1.sentence-1' class='sentence'><span class='texttt'>bulk</span> runs a task repeatedly for every index in an index space<a class='hidden_link' href='#exec.bulk-1.sentence-1'>.</a></div></div><div class='texpara'><div id='exec.bulk-1.sentence-2' class='sentence'>The name <span class='texttt'>bulk</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.bulk-1.sentence-2'>.</a></div> <div id='exec.bulk-1.sentence-3' class='sentence'>For subexpressions <span class='texttt'>sndr</span>, <span class='texttt'>shape</span>, and <span class='texttt'>f</span>,
let <span class='texttt'>Shape</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.bulk-1.sentence-3'>.</a></div> <div id='exec.bulk-1.sentence-4' class='sentence'>If
<ul class='itemize'><li id='exec.bulk-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.1'>(1.1)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender____________________________________'><span class='texttt'>sender</span></span></a>, or</li><li id='exec.bulk-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.2'>(1.2)</a></div><span class='texttt'>Shape</span> does not satisfy <a href='concepts.arithmetic#concept:integral' title='18.4.7&emsp;Arithmetic concepts&emsp;[concepts.arithmetic]'><span id='conceptref:integral'><span class='texttt'>integral</span></span></a>, or</li><li id='exec.bulk-1.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-1.3'>(1.3)</a></div><span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>f<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value____'><span class='texttt'><i >movable-value</i></span></span></a>,</li></ul>
<span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.bulk-1.sentence-4'>.</a></div></div></div><div class='para' id='exec.bulk-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3582'>#</a></div><div class='texpara'><div id='exec.bulk-2.sentence-1' class='sentence'>Otherwise,
the expression <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> is expression-equivalent to:</div></div><div class='texpara'><div id='exec.bulk-2.sentence-2' class='sentence'><span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>bulk, <i >product-type</i><span class='curlybracket'>{</span>shape, f<span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.bulk-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.bulk-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3591'>#</a></div><div class='texpara'><div id='exec.bulk-3.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>bulk_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>bulk_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.bulk-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3603'>#</a></div><div class='texpara'><div id='exec.bulk-4.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>bulk_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
  <span class='parenthesis'>(</span>Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='keyword'>requires</span> <i ><span class='texttt'>see below</span></i> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>shape, f<span class='squarebracket'>]</span> <span class='operator'>=</span> state;
      <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> nothrow <span class='operator'>=</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <i >TRY-EVAL</i><span class='parenthesis'>(</span>rcvr, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>nothrow<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>for</span> <span class='parenthesis'>(</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span><span class='parenthesis'>)</span> i <span class='operator'>=</span> <span class='literal'>0</span>; i <span class='anglebracket'>&lt;</span> shape; <span class='operator'>+</span><span class='operator'>+</span>i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>i<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
        Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
      Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.bulk-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3624'>#</a></div><div class='texpara'><div id='exec.bulk-5.sentence-1' class='sentence'>The expression in the <a href='temp.pre#nt:requires-clause' title='13.1&emsp;Preamble&emsp;[temp.pre]'><span id='ntref:requires-clause_'><span class='textsf'><i >requires-clause</i></span></span></a> of the lambda above
is <span class='texttt'><span class='literal'>true</span></span> if and only
if <span class='texttt'>Tag</span> denotes a type other than <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or
if the expression <span class='texttt'>f<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>shape<span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-5.sentence-1'>.</a></div></div></div><div class='para' id='exec.bulk-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.bulk-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3630'>#</a></div><div class='texpara'><div id='exec.bulk-6.sentence-1' class='sentence'>Let the subexpression <span class='texttt'>out_<span class='shy'></span>sndr</span> denote
the result of the invocation <span class='texttt'>bulk<span class='parenthesis'>(</span>sndr, shape, f<span class='parenthesis'>)</span></span> or
an object equal to such, and
let the subexpression <span class='texttt'>rcvr</span> denote a receiver
such that the expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> is well-formed<a class='hidden_link' href='#exec.bulk-6.sentence-1'>.</a></div> <div id='exec.bulk-6.sentence-2' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span>out_<span class='shy'></span>sndr, rcvr<span class='parenthesis'>)</span></span> has undefined behavior
unless it creates an asynchronous operation (<a href='exec.async.ops' title='34.3&emsp;Asynchronous operations'>[exec.<span class='shy'></span>async.<span class='shy'></span>ops]</a>) that,
when started,
<ul class='itemize'><li id='exec.bulk-6.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-6.1'>(6.1)</a></div>on a value completion operation,
invokes <span class='texttt'>f<span class='parenthesis'>(</span>i, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
for every <span class='texttt'>i</span> of type <span class='texttt'>Shape</span> from <span class='texttt'><span class='literal'>0</span></span> to <span class='texttt'>shape</span>,
where <span class='texttt'>args</span> is a pack of lvalue subexpressions
referring to the value completion result datums of the input sender, and</li><li id='exec.bulk-6.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.bulk-6.2'>(6.2)</a></div>propagates all completion operations sent by <span class='texttt'>sndr</span><a class='hidden_link' href='#exec.bulk-6.sentence-2'>.</a></li></ul></div></div></div></div><div id='exec.split' class='section'><h4 ><a class='secnum' href='#exec.split' style='min-width:95pt'>34.9.12.10</a> <span class='texttt'>execution&#x200b;::&#x200b;split</span> <a class='abbr_ref' href='exec.split'>[exec.split]</a></h4><div class='para' id='exec.split-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3652'>#</a></div><div class='texpara'><div id='exec.split-1.sentence-1' class='sentence'><span class='texttt'>split</span> adapts an arbitrary sender
into a sender that can be connected multiple times<a class='hidden_link' href='#exec.split-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.split-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3656'>#</a></div><div class='texpara'><div id='exec.split-2.sentence-1' class='sentence'>Let <span class='texttt'><i >split-env</i></span> be the type of an environment
such that, given an instance <span class='texttt'>env</span>,
the expression <span class='texttt'>get_<span class='shy'></span>stop_<span class='shy'></span>token<span class='parenthesis'>(</span>env<span class='parenthesis'>)</span></span> is well-formed and
has type <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token<span class='operator'>.</span></span></div></div></div><div class='para' id='exec.split-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3662'>#</a></div><div class='texpara'><div id='exec.split-3.sentence-1' class='sentence'>The name <span class='texttt'>split</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.split-3.sentence-1'>.</a></div> <div id='exec.split-3.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-3.sentence-2'>.</a></div> <div id='exec.split-3.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in______________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >split-env</i></span><span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.split-3.sentence-3'>.</a></div></div></div><div class='para' id='exec.split-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3668'>#</a></div><div class='texpara'><div id='exec.split-4.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>split<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>split, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is evaluated only once<a class='hidden_link' href='#exec.split-4.sentence-1'>.</a></div> <div id='exec.split-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.split-note-1'>1</a></i>:&ensp;<div id='exec.split-4.sentence-2' class='sentence'>The default implementation of <span class='texttt'>transform_<span class='shy'></span>sender</span>
will have the effect of connecting the sender to a receiver<a class='hidden_link' href='#exec.split-4.sentence-2'>.</a></div> <div id='exec.split-4.sentence-3' class='sentence'>It will return a sender with a different tag type<a class='hidden_link' href='#exec.split-4.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='exec.split-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3680'>#</a></div><div class='texpara'><div id='exec.split-5.sentence-1' class='sentence'>Let <span class='texttt'><i >local-state</i></span> denote the following exposition-only class template:</div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>virtual</span> <span class='operator'>~</span><i >local-state-base</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
    <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='literal'>0</span>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >local-state</i> <span class='operator'>:</span> <i >local-state-base</i> <span class='curlybracket'>{</span>                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >on-stop-callback</i> <span class='operator'>=</span>                                    <span class='comment'>// <i >exposition only</i></span>
      stop_callback_of_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <i >local-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    <span class='operator'>~</span><i >local-state</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    optional<span class='anglebracket'>&lt;</span><i >on-stop-callback</i><span class='anglebracket'>&gt;</span> <i >on_stop</i>;                         <span class='comment'>// <i >exposition only</i></span>
    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
    Rcvr<span class='operator'>*</span> <i >rcvr</i>;                                                 <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3713'>#</a></div><div class='texpara'><div id='exec.split-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, data, _<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i> <span class='operator'>=</span> data<span class='operator'>.</span>sh_state<span class='operator'>.</span>get<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>this</span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >rcvr</i> <span class='operator'>=</span> addressof<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span><span class='texttt'><i >local-state</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.split-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3729'>#</a></div><div class='texpara'><div id='exec.split-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'>sh_state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='keyword'>override</span>;
</code></div></div><div class='para' id='exec.split-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3742'>#</a></div><div class='texpara'><div id='exec.split-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> tupl<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>
      <span class='squarebracket'>[</span><span class='keyword'>this</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span> tag, <span class='keyword'>const</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
        tag<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><span class='operator'>*</span><i >rcvr</i><span class='parenthesis'>)</span>, args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>,
      tupl<span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para' id='exec.split-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3759'>#</a></div><div class='texpara'><div id='exec.split-9.sentence-1' class='sentence'>Let <span class='texttt'><i >split-receiver</i></span> denote
the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >split-receiver</i> <span class='curlybracket'>{</span>                                       <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> receiver_t;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>               <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> <i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>;
      <span class='keyword'>try</span> <span class='curlybracket'>{</span>
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
        <span class='keyword'>using</span> tuple_t <span class='operator'>=</span> tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>;
        <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>result<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>tuple_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
      <i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>notify<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_value, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_error, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <i >complete</i><span class='parenthesis'>(</span>execution<span class='operator'>::</span>set_stopped<span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>struct</span> <i >env</i> <span class='curlybracket'>{</span>                                                <span class='comment'>// <i >exposition only</i></span>
      <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh-state</i>;                             <span class='comment'>// <i >exposition only</i></span>

      inplace_stop_token query<span class='parenthesis'>(</span>get_stop_token_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
        <span class='keyword'>return</span> <i >sh-state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>stop_src<span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;

    <i >env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >env</i><span class='curlybracket'>{</span><i >sh_state</i><span class='curlybracket'>}</span>;
    <span class='curlybracket'>}</span>

    <i >shared-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >sh_state</i>;                               <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3811'>#</a></div><div class='texpara'><div id='exec.split-10.sentence-1' class='sentence'>Let <span class='texttt'><i >shared-state</i></span> denote the following exposition-only class template:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >shared-state</i> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> <i >variant-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                             <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> <i >state-list-type</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                          <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>explicit</span> <i >shared-state</i><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;

    <span class='keyword'>void</span> <i >start-op</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >notify</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                     <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >inc-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >dec-ref</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                                    <span class='comment'>// <i >exposition only</i></span>

    inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                             <span class='comment'>// <i >exposition only</i></span>
    <i >variant-type</i> <i >result</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                      <span class='comment'>// <i >exposition only</i></span>
    <i >state-list-type</i> <i >waiting_states</i>;                             <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span> <i >completed</i><span class='curlybracket'>{</span><span class='literal'>false</span><span class='curlybracket'>}</span>;                              <span class='comment'>// <i >exposition only</i></span>
    atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >ref_count</i><span class='curlybracket'>{</span><span class='literal'>1</span><span class='curlybracket'>}</span>;                                <span class='comment'>// <i >exposition only</i></span>
    connect_result_t<span class='anglebracket'>&lt;</span>Sndr, <i >split-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <i >op_state</i>;      <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3837'>#</a></div><div class='texpara'><div id='exec.split-11.sentence-1' class='sentence'>Let <span class='texttt'>Sigs</span> be a pack of the arguments
to the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization
named by <span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.split-11.sentence-1'>.</a></div> <div id='exec.split-11.sentence-2' class='sentence'>For type <span class='texttt'>Tag</span> and pack <span class='texttt'>Args</span>,
let <span class='texttt'><i >as-tuple</i></span> be an alias template
such that <span class='texttt'><span class='texttt'><i >as-tuple</i></span><span class='anglebracket'>&lt;</span>Tag<span class='parenthesis'>(</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span></span> denotes
the type <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span>Tag, Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.split-11.sentence-2'>.</a></div> <div id='exec.split-11.sentence-3' class='sentence'>Then <span class='texttt'><i >variant-type</i></span> denotes the type
<span class='codeblock'>variant<span class='anglebracket'>&lt;</span>tuple<span class='anglebracket'>&lt;</span>set_stopped_t<span class='anglebracket'>&gt;</span>, tuple<span class='anglebracket'>&lt;</span>set_error_t, exception_ptr<span class='anglebracket'>&gt;</span>, <i >as-tuple</i><span class='anglebracket'>&lt;</span>Sigs<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
but with duplicate types removed<a class='hidden_link' href='#exec.split-11.sentence-3'>.</a></div></div></div><div class='para' id='exec.split-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3851'>#</a></div><div class='texpara'><div id='exec.split-12.sentence-1' class='sentence'>Let <span class='texttt'><i >state-list-type</i></span> be a type
that stores a list of pointers to <span class='texttt'><i >local-state-base</i></span> objects and
that permits atomic insertion<a class='hidden_link' href='#exec.split-12.sentence-1'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:4'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:4'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>explicit</span> <span class='texttt'><i >shared-state</i></span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.split-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-13'>13</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3861'>#</a></div><div class='texpara'><div id='exec.split-13.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >op_<span class='shy'></span>state</i></span> with the result of
<span class='texttt'>connect<span class='parenthesis'>(</span>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <span class='texttt'><i >split-receiver</i></span><span class='curlybracket'>{</span><span class='keyword'>this</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-13.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.split-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-14'>14</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3866'>#</a></div><div class='texpara'><div id='exec.split-14.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'><i >waiting_<span class='shy'></span>states</i></span> is empty, and <span class='texttt'><i >completed</i></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.split-14.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:5'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:5'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-15'>15</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3876'>#</a></div><div class='texpara'><div id='exec.split-15.sentence-1' class='sentence'><i >Effects</i>: Evaluates <span class='texttt'><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-15.sentence-1'>.</a></div> <div id='exec.split-15.sentence-2' class='sentence'>If <span class='texttt'>stop_<span class='shy'></span>src<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>;
otherwise, evaluates <span class='texttt'>start<span class='parenthesis'>(</span><span class='texttt'><i >op_<span class='shy'></span>state</i></span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-15.sentence-2'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:6'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:6'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-16'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-16'>16</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3889'>#</a></div><div class='texpara'><div id='exec.split-16.sentence-1' class='sentence'><i >Effects</i>: Atomically does the following:
<ul class='itemize'><li id='exec.split-16.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.split-16.1'>(16.1)</a></div>Sets <span class='texttt'>completed</span> to <span class='texttt'><span class='literal'>true</span></span>, and</li><li id='exec.split-16.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.split-16.2'>(16.2)</a></div>Exchanges <span class='texttt'>waiting_<span class='shy'></span>states</span> with an empty list,
storing the old value in a local <span class='texttt'>prior_<span class='shy'></span>states</span><a class='hidden_link' href='#exec.split-16.sentence-1'>.</a></li></ul></div> <div id='exec.split-16.sentence-2' class='sentence'>
Then, for each pointer <span class='texttt'>p</span> in <span class='texttt'>prior_<span class='shy'></span>states</span>,
evaluates <span class='texttt'>p<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-16.sentence-2'>.</a></div> <div id='exec.split-16.sentence-3' class='sentence'>Finally, evaluates <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-16.sentence-3'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:7'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:7'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-17'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-17'>17</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3909'>#</a></div><div class='texpara'><div id='exec.split-17.sentence-1' class='sentence'><i >Effects</i>: Increments <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#exec.split-17.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.split-itemdecl:8'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.split-itemdecl:8'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.split-18'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-18'>18</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3919'>#</a></div><div class='texpara'><div id='exec.split-18.sentence-1' class='sentence'><i >Effects</i>: Decrements <span class='texttt'><i >ref_<span class='shy'></span>count</i></span><a class='hidden_link' href='#exec.split-18.sentence-1'>.</a></div> <div id='exec.split-18.sentence-2' class='sentence'>If the new value of <span class='texttt'><i >ref_<span class='shy'></span>count</i></span> is <span class='texttt'><span class='literal'>0</span></span>,
calls <span class='texttt'><span class='keyword'>delete</span> <span class='keyword'>this</span></span><a class='hidden_link' href='#exec.split-18.sentence-2'>.</a></div></div></div></div><div class='para' id='exec.split-19'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-19'>19</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3925'>#</a></div><div class='texpara'><div id='exec.split-19.sentence-1' class='sentence'><i >Synchronization</i>: If an evaluation of <span class='texttt'><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> does not
decrement the <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span> then
synchronizes with the evaluation of <span class='texttt'>dec<span class='operator'>-</span>ref<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that decrements <span class='texttt'>ref_<span class='shy'></span>count</span> to <span class='texttt'><span class='literal'>0</span></span><a class='hidden_link' href='#exec.split-19.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.split-20'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3933'>#</a></div><div class='texpara'><div id='exec.split-20.sentence-1' class='sentence'>Let <span class='texttt'><i >split-impl-tag</i></span> be an empty exposition-only class type<a class='hidden_link' href='#exec.split-20.sentence-1'>.</a></div> <div id='exec.split-20.sentence-2' class='sentence'>Given an expression <span class='texttt'>sndr</span>,
the expression <span class='texttt'>split<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>tag, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>auto</span><span class='operator'>*</span> sh_state <span class='operator'>=</span> <span class='keyword'>new</span> <i >shared-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;
<span class='keyword'>return</span> <i >make-sender</i><span class='parenthesis'>(</span><i >split-impl-tag</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >shared-wrapper</i><span class='curlybracket'>{</span>sh_state, tag<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span>
where <span class='texttt'><i >shared-wrapper</i></span> is an exposition-only class
that manages the reference count of the <span class='texttt'><i >shared-state</i></span> object
pointed to by sh_state<a class='hidden_link' href='#exec.split-20.sentence-2'>.</a></div> <div id='exec.split-20.sentence-3' class='sentence'><span class='texttt'><i >shared-wrapper</i></span> models <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable'><span class='texttt'>copyable</span></span></a>
with move operations nulling out the moved-from object,
copy operations incrementing the reference count
by calling <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >inc-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, and
assignment operations performing a copy-and-swap operation<a class='hidden_link' href='#exec.split-20.sentence-3'>.</a></div> <div id='exec.split-20.sentence-4' class='sentence'>The destructor has no effect if sh_state is null;
otherwise, it decrements the reference count
by evaluating <span class='texttt'>sh_<span class='shy'></span>state<span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >dec-ref</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-20.sentence-4'>.</a></div></div></div><div class='para' id='exec.split-21'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-21'>21</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3954'>#</a></div><div class='texpara'><div id='exec.split-21.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'><i >split-impl-tag</i></span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span><i >split-impl-tag</i><span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-22'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-22'>22</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3967'>#</a></div><div class='texpara'><div id='exec.split-22.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to
the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, <span class='keyword'>auto</span><span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >local-state</i><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, rcvr<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.split-23'><div class='marginalizedparent'><a class='marginalized' href='#exec.split-23'>23</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L3978'>#</a></div><div class='texpara'><div id='exec.split-23.sentence-1' class='sentence'>The member
<span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span><span class='texttt'><i >split-impl-tag</i></span><span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
that has a function call operator equivalent to the following:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><i >local-state</i><span class='anglebracket'>&lt;</span>Sndr, Rcvr<span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</span></div></div><div class='texpara'><div id='exec.split-23.sentence-2' class='sentence'><i >Effects</i>: If <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span> is <span class='texttt'><span class='literal'>true</span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#exec.split-23.sentence-2'>.</a></div> <div id='exec.split-23.sentence-3' class='sentence'>Otherwise, does the following in order:
<ul class='itemize'><li id='exec.split-23.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.1'>(23.1)</a></div><div class='texpara'><div id='exec.split-23.1.sentence-1' class='sentence'>Evaluates
<span class='codeblock'>state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
  get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
  <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >sh_state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></li><li id='exec.split-23.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.2'>(23.2)</a></div><div class='texpara'><div id='exec.split-23.2.sentence-1' class='sentence'>Then atomically does the following:
<ul class='itemize'><li id='exec.split-23.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.split-23.2.1'>(23.2.1)</a></div>Reads the value <span class='texttt'>c</span> of
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >completed</i></span></span>, and</li><li id='exec.split-23.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.split-23.2.2'>(23.2.2)</a></div>Inserts <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> into
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>
if <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#exec.split-23.2.sentence-1'>.</a></li></ul></div></div></li><li id='exec.split-23.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.3'>(23.3)</a></div><div class='texpara'><div id='exec.split-23.3.sentence-1' class='sentence'>If <span class='texttt'>c</span> is <span class='texttt'><span class='literal'>true</span></span>,
calls <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >notify</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and returns<a class='hidden_link' href='#exec.split-23.3.sentence-1'>.</a></div></div></li><li id='exec.split-23.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.split-23.4'>(23.4)</a></div><div class='texpara'><div id='exec.split-23.4.sentence-1' class='sentence'>Otherwise,
if <span class='texttt'>addressof<span class='parenthesis'>(</span>state<span class='parenthesis'>)</span></span> is the first item added to
<span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >waiting_<span class='shy'></span>states</i></span></span>,
evaluates <span class='texttt'>state<span class='operator'>.</span><span class='texttt'><i >sh_<span class='shy'></span>state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >start-op</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.split-23.4.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div id='exec.when.all' class='section'><h4 ><a class='secnum' href='#exec.when.all' style='min-width:95pt'>34.9.12.11</a> <span class='texttt'>execution&#x200b;::&#x200b;when_<span class='shy'></span>all</span> <a class='abbr_ref' href='exec.when.all'>[exec.when.all]</a></h4><div class='para' id='exec.when.all-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4023'>#</a></div><div class='texpara'><div id='exec.when.all-1.sentence-1' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span>
both adapt multiple input senders into a sender
that completes when all input senders have completed<a class='hidden_link' href='#exec.when.all-1.sentence-1'>.</a></div> <div id='exec.when.all-1.sentence-2' class='sentence'><span class='texttt'>when_<span class='shy'></span>all</span> only accepts senders
with a single value completion signature and
on success concatenates all the input senders' value result datums
into its own value completion operation<a class='hidden_link' href='#exec.when.all-1.sentence-2'>.</a></div> <div id='exec.when.all-1.sentence-3' class='sentence'><span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is semantically equivalent to
w<span class='texttt'>hen_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
where <span class='texttt'>sndrs</span> is a pack of subexpressions
whose types model <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_____________________________________'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.when.all-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.when.all-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4036'>#</a></div><div class='texpara'><div id='exec.when.all-2.sentence-1' class='sentence'>The names <span class='texttt'>when_<span class='shy'></span>all</span> and <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span> denote
customization point objects<a class='hidden_link' href='#exec.when.all-2.sentence-1'>.</a></div> <div id='exec.when.all-2.sentence-2' class='sentence'>Let <span class='texttt'>sndrs</span> be a pack of subexpressions,
let <span class='texttt'>Sndrs</span> be a pack of the types <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span></span>, and
let <span class='texttt'>CD</span> be
the type <span class='texttt'>common_<span class='shy'></span>type_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='texttt'><i >get-domain-early</i></span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-2.sentence-2'>.</a></div> <div id='exec.when.all-2.sentence-3' class='sentence'>The expressions <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> are ill-formed
if any of the following is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.when.all-2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.1'>(2.1)</a></div><span class='texttt'><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>0</span></span>, or</li><li id='exec.when.all-2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.2'>(2.2)</a></div><span class='texttt'><span class='parenthesis'>(</span><a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender______________________________________'><span class='texttt'>sender</span></span></a><span class='anglebracket'>&lt;</span>Sndrs<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>, or</li><li id='exec.when.all-2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-2.3'>(2.3)</a></div><span class='texttt'>CD</span> is ill-formed<a class='hidden_link' href='#exec.when.all-2.sentence-3'>.</a></li></ul></div></div></div><div class='para' id='exec.when.all-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4055'>#</a></div><div class='texpara'><div id='exec.when.all-3.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span></div></div></div><div class='para' id='exec.when.all-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4061'>#</a></div><div class='texpara'><div id='exec.when.all-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>t</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>when_all_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-attrs</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-env</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >start</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4077'>#</a></div><div class='texpara'><div id='exec.when.all-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-attrs</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> child<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>CD, default_domain<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> empty_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='keyword'>return</span> <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_domain, CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4091'>#</a></div><div class='texpara'><div id='exec.when.all-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-env</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span>, State<span class='operator'>&amp;</span> state, <span class='keyword'>const</span> Receiver<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <i >JOIN-ENV</i><span class='parenthesis'>(</span>
    <i >MAKE-ENV</i><span class='parenthesis'>(</span>get_stop_token, state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4102'>#</a></div><div class='texpara'><div id='exec.when.all-7.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='math'><span class='mathalpha'>e</span></span>;
<span class='curlybracket'>}</span>
</span>
where <span class='math'><span class='mathalpha'>e</span></span> is the expression
<span class='codeblock'>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='operator'>.</span>apply<span class='parenthesis'>(</span><i >make-state</i><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
and where <span class='texttt'><i >make-state</i></span> is the following exposition-only class template:
<span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Env<span class='anglebracket'>&gt;</span>
<span class='keyword'>concept</span> <a class='hidden_link' href='#concept:max-1-sender-in' title='34.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='concept:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a> <span class='operator'>=</span> <a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_______________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>                <span class='comment'>// <i >exposition only</i></span>
  <span class='parenthesis'>(</span>tuple_size_v<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, Env, tuple, tuple<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span>;

<span class='keyword'>enum</span> <span class='keyword'>class</span> <i >disposition</i> <span class='curlybracket'>{</span> <i >started</i>, <i >error</i>, <i >stopped</i> <span class='curlybracket'>}</span>;             <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> <i >make-state</i> <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><a href='#concept:max-1-sender-in' title='34.9.12.11&emsp;execution&#x200b;::&#x200b;when_&shy;all&emsp;[exec.when.all]'><span id='conceptref:max-1-sender-in'><span class='tcode_in_codeblock'><i >max-1-sender-in</i></span></span></a><span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Sndrs<span class='anglebracket'>&gt;</span>
  <span class='keyword'>auto</span> <span class='keyword'>operator</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>auto</span>, <span class='keyword'>auto</span>, Sndrs<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> sndrs<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> values_tuple <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> errors_variant <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>using</span> stop_callback <span class='operator'>=</span> stop_callback_of_t<span class='anglebracket'>&lt;</span>stop_token_of_t<span class='anglebracket'>&lt;</span>env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>, <i >on-stop-request</i><span class='anglebracket'>&gt;</span>;

    <span class='keyword'>struct</span> <i >state-type</i> <span class='curlybracket'>{</span>
      <span class='keyword'>void</span> <i >arrive</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>                        <span class='comment'>// <i >exposition only</i></span>
        <span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='literal'>0</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='operator'>-</span><span class='operator'>-</span>count<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
          <i >complete</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
        <span class='curlybracket'>}</span>
      <span class='curlybracket'>}</span>

      <span class='keyword'>void</span> <i >complete</i><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;                       <span class='comment'>// <i >exposition only</i></span>

      atomic<span class='anglebracket'>&lt;</span>size_t<span class='anglebracket'>&gt;</span> <i >count</i><span class='curlybracket'>{</span><span class='keyword'>sizeof</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='curlybracket'>}</span>;                   <span class='comment'>// <i >exposition only</i></span>
      inplace_stop_source <i >stop_src</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                           <span class='comment'>// <i >exposition only</i></span>
      atomic<span class='anglebracket'>&lt;</span><i >disposition</i><span class='anglebracket'>&gt;</span> disp<span class='curlybracket'>{</span><i >disposition</i><span class='operator'>::</span><i >started</i><span class='curlybracket'>}</span>;           <span class='comment'>// <i >exposition only</i></span>
      errors_variant <i >errors</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                  <span class='comment'>// <i >exposition only</i></span>
      values_tuple <i >values</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;                                    <span class='comment'>// <i >exposition only</i></span>
      optional<span class='anglebracket'>&lt;</span>stop_callback<span class='anglebracket'>&gt;</span> <i >on_stop</i><span class='curlybracket'>{</span>nullopt<span class='curlybracket'>}</span>;                 <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;

    <span class='keyword'>return</span> <i >state-type</i><span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div></div></div><div class='para' id='exec.when.all-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4153'>#</a></div><div class='texpara'><div id='exec.when.all-8.sentence-1' class='sentence'>Let <span class='texttt'><i >copy-fail</i></span> be <span class='texttt'>exception_<span class='shy'></span>ptr</span>
if decay-copying any of the child senders' result datums can potentially throw;
otherwise, <span class='texttt'><i >none-such</i></span>,
where <span class='texttt'><i >none-such</i></span> is an unspecified empty class type<a class='hidden_link' href='#exec.when.all-8.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4159'>#</a></div><div class='texpara'><div id='exec.when.all-9.sentence-1' class='sentence'>The alias <span class='texttt'>values_<span class='shy'></span>tuple</span> denotes the type
<span class='codeblock'>tuple<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndrs, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span>, <i >decayed-tuple</i>, optional<span class='anglebracket'>&gt;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span>
</span>
if that type is well-formed; otherwise, <span class='texttt'>tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#exec.when.all-9.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4166'>#</a></div><div class='texpara'><div id='exec.when.all-10.sentence-1' class='sentence'>The alias <span class='texttt'>errors_<span class='shy'></span>variant</span> denotes
the type <span class='texttt'>variant<span class='anglebracket'>&lt;</span><span class='texttt'><i >none-such</i></span>, <span class='texttt'><i >copy-fail</i></span>, Es<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span></span>
with duplicate types removed,
where <span class='texttt'>Es</span> is the pack of the decayed types
of all the child senders' possible error result datums<a class='hidden_link' href='#exec.when.all-10.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-11'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4173'>#</a></div><div class='texpara'><div id='exec.when.all-11.sentence-1' class='sentence'>The member
<span class='texttt'><span class='keyword'>void</span> <span class='texttt'><i >state-type</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span><span class='parenthesis'>(</span>Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span></span>
behaves as follows:
<ul class='itemize'><li id='exec.when.all-11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.1'>(11.1)</a></div>If <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >started</i></span></span>,
evaluates:
<span class='codeblock'><span class='keyword'>auto</span> tie <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> T<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='operator'>&amp;</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> tuple<span class='anglebracket'>&lt;</span>T<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>t<span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>auto</span> set <span class='operator'>=</span> <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>t<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
apply<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> opts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    apply<span class='parenthesis'>(</span>set, tuple_cat<span class='parenthesis'>(</span>tie<span class='parenthesis'>(</span><span class='operator'>*</span>opts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>,
  values<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.2'>(11.2)</a></div>Otherwise,
if <span class='texttt'>disp</span> is equal to <span class='texttt'><span class='texttt'><i >disposition</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >error</i></span></span>,
evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
visit<span class='parenthesis'>(</span>
  <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span> error<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Error, <i >none-such</i><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>move<span class='parenthesis'>(</span>error<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>,
  errors<span class='parenthesis'>)</span>;
</span></li><li id='exec.when.all-11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.when.all-11.3'>(11.3)</a></div>Otherwise, evaluates:
<span class='codeblock'><i >on_stop</i><span class='operator'>.</span>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></li></ul></div></div></div><div class='para' id='exec.when.all-12'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4214'>#</a></div><div class='texpara'><div id='exec.when.all-12.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>when_<span class='shy'></span>all_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >start</i></span></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ops<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Ops<span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ops<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  state<span class='operator'>.</span><i >on_stop</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>
    get_stop_token<span class='parenthesis'>(</span>get_env<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>,
    <i >on-stop-request</i><span class='curlybracket'>{</span>state<span class='operator'>.</span><i >stop_src</i><span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
  <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    state<span class='operator'>.</span><i >on_stop.</i>reset<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    <span class='parenthesis'>(</span>start<span class='parenthesis'>(</span>ops<span class='parenthesis'>)</span>, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.when.all-13'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4233'>#</a></div><div class='texpara'><div id='exec.when.all-13.sentence-1' class='sentence'>The member <span class='texttt'><i ><span class='texttt'>impls<span class='operator'>-</span><span class='keyword'>for</span></span>&lt;when_<span class='shy'></span>all_<span class='shy'></span>t&gt;&#x200b;::&#x200b;<span class='texttt'><i >complete</i></span></i></span>
is initialized with a callable object
equivalent to the following lambda expression:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Index, <span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Set, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>this</span> <span class='keyword'>auto</span><span class='operator'>&amp;</span> complete, Index, State<span class='operator'>&amp;</span> state, Rcvr<span class='operator'>&amp;</span> rcvr, Set, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_error_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i> <span class='operator'>!</span><span class='operator'>=</span> state<span class='operator'>.</span>disp<span class='operator'>.</span>exchange<span class='parenthesis'>(</span><i >disposition</i><span class='operator'>::</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-ERROR</i><span class='parenthesis'>(</span>state<span class='operator'>.</span>errors, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Set, set_stopped_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>auto</span> expected <span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i>;
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp<span class='operator'>.</span>compare_exchange_strong<span class='parenthesis'>(</span>expected, <i >disposition</i><span class='operator'>::</span><i >stopped</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      state<span class='operator'>.</span><i >stop_src</i><span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><span class='operator'>!</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_______________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>State<span class='operator'>::</span>values<span class='parenthesis'>)</span>, tuple<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span>disp <span class='operator'>=</span><span class='operator'>=</span> <i >disposition</i><span class='operator'>::</span><i >started</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>auto</span><span class='operator'>&amp;</span> opt <span class='operator'>=</span> get<span class='anglebracket'>&lt;</span>Index<span class='operator'>::</span>value<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>state<span class='operator'>.</span>values<span class='parenthesis'>)</span>;
      <i >TRY-EMPLACE-VALUE</i><span class='parenthesis'>(</span>complete, opt, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>
  state<span class='operator'>.</span><i >arrive</i><span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-ERROR</i></span><span class='parenthesis'>(</span>v, e<span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>v</span> and <span class='texttt'>e</span>, is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>exception_ptr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span> is potentially throwing;
otherwise, <span class='texttt'>v<span class='operator'>.</span><span class='keyword'>template</span> emplace<span class='anglebracket'>&lt;</span>decltype<span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>e<span class='parenthesis'>)</span></span>;
and where <span class='texttt'><span class='texttt'><i >TRY-EMPLACE-VALUE</i></span><span class='parenthesis'>(</span>c, o, as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>,
for subexpressions <span class='texttt'>c</span>, <span class='texttt'>o</span>, and pack of subexpressions <span class='texttt'>as</span>,
is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  c<span class='parenthesis'>(</span>Index<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, state, rcvr, set_error, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='keyword'>return</span>;
<span class='curlybracket'>}</span>
</span>
if the expression <span class='texttt'><span class='texttt'><i >decayed-tuple</i></span><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>as<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span></span>
is potentially throwing;
otherwise, <span class='texttt'>o<span class='operator'>.</span>emplace<span class='parenthesis'>(</span>as<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.when.all-13.sentence-1'>.</a></div></div></div><div class='para' id='exec.when.all-14'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4285'>#</a></div><div class='texpara'><div id='exec.when.all-14.sentence-1' class='sentence'>The expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span>CD<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>when_all_with_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.when.all-15'><div class='marginalizedparent'><a class='marginalized' href='#exec.when.all-15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4292'>#</a></div><div class='texpara'><div id='exec.when.all-15.sentence-2' class='sentence'>Given subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>env</span>,
if
<span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>, when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span>child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>return</span> when_all<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
</span>
<div id='exec.when.all-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.when.all-note-1'>1</a></i>:&ensp;<div id='exec.when.all-15.sentence-1' class='sentence'>This causes the <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span> sender
to become <span class='texttt'>when_<span class='shy'></span>all<span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndrs<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span></span>
when it is connected with a receiver
whose execution domain does not customize <span class='texttt'>when_<span class='shy'></span>all_<span class='shy'></span>with_<span class='shy'></span>variant</span><a class='hidden_link' href='#exec.when.all-15.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div></div></div><div id='exec.into.variant' class='section'><h4 ><a class='secnum' href='#exec.into.variant' style='min-width:95pt'>34.9.12.12</a> <span class='texttt'>execution&#x200b;::&#x200b;into_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.into.variant'>[exec.into.variant]</a></h4><div class='para' id='exec.into.variant-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4313'>#</a></div><div class='texpara'><div id='exec.into.variant-1.sentence-1' class='sentence'><span class='texttt'>into_<span class='shy'></span>variant</span> adapts a sender with multiple value completion signatures
into a sender with just one value completion signature
consisting of a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#exec.into.variant-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4318'>#</a></div><div class='texpara'><div id='exec.into.variant-2.sentence-1' class='sentence'>The name <span class='texttt'>into_<span class='shy'></span>variant</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.into.variant-2.sentence-1'>.</a></div> <div id='exec.into.variant-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.into.variant-2.sentence-2'>.</a></div> <div id='exec.into.variant-2.sentence-3' class='sentence'>If <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_______________________________________'><span class='texttt'>sender</span></span></a>,
<span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.into.variant-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.into.variant-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4324'>#</a></div><div class='texpara'><div id='exec.into.variant-3.sentence-1' class='sentence'>Otherwise, the expression <span class='texttt'>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>into_variant, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.into.variant-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.into.variant-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4332'>#</a></div><div class='texpara'><div id='exec.into.variant-4.sentence-1' class='sentence'>The exposition-only class template <span class='texttt'><i >impls-for</i></span> (<a href='#general' title='34.9.1&emsp;General'>[exec.<span class='shy'></span>snd.<span class='shy'></span>general]</a>)
is specialized for <span class='texttt'>into_<span class='shy'></span>variant</span> as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >impls-for</i><span class='anglebracket'>&lt;</span>into_variant_t<span class='anglebracket'>&gt;</span> <span class='operator'>:</span> <i >default-impls</i> <span class='curlybracket'>{</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >get-state</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>auto</span> <i >complete</i> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.into.variant-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4345'>#</a></div><div class='texpara'><div id='exec.into.variant-5.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >get-state</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr, <span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Sndr<span class='operator'>&amp;</span><span class='operator'>&amp;</span> sndr, Rcvr<span class='operator'>&amp;</span> rcvr<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>
  <span class='operator'>-</span><span class='anglebracket'>&gt;</span> type_identity<span class='anglebracket'>&lt;</span>value_types_of_t<span class='anglebracket'>&lt;</span><i >child-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>, env_of_t<span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.into.variant-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.into.variant-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4355'>#</a></div><div class='texpara'><div id='exec.into.variant-6.sentence-1' class='sentence'>The member <span class='texttt'><span class='texttt'><i >impls-for</i></span><span class='anglebracket'>&lt;</span>into_<span class='shy'></span>variant_<span class='shy'></span>t<span class='anglebracket'>&gt;</span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >complete</i></span></span>
is initialized with a callable object equivalent to the following lambda:
<span class='codeblock'><span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> State, <span class='keyword'>class</span> Rcvr, <span class='keyword'>class</span> Tag, <span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>
    <span class='keyword'>auto</span>, State, Rcvr<span class='operator'>&amp;</span> rcvr, Tag, Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> <span class='curlybracket'>{</span>
  <span class='keyword'>if</span> <span class='keyword'>constexpr</span> <span class='parenthesis'>(</span><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as________________'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span>Tag, set_value_t<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
    <span class='keyword'>using</span> variant_type <span class='operator'>=</span> <span class='keyword'>typename</span> State<span class='operator'>::</span>type;
    <i >TRY-SET-VALUE</i><span class='parenthesis'>(</span>rcvr, variant_type<span class='parenthesis'>(</span><i >decayed-tuple</i><span class='anglebracket'>&lt;</span>Args<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='curlybracket'>}</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
    Tag<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>rcvr<span class='parenthesis'>)</span>, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>
</span></div></div></div></div><div id='exec.stopped.opt' class='section'><h4 ><a class='secnum' href='#exec.stopped.opt' style='min-width:95pt'>34.9.12.13</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> <a class='abbr_ref' href='exec.stopped.opt'>[exec.stopped.opt]</a></h4><div class='para' id='exec.stopped.opt-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4372'>#</a></div><div class='texpara'><div id='exec.stopped.opt-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> maps a sender's stopped completion operation
into a value completion operation as a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-1'>.</a></div> <div id='exec.stopped.opt-1.sentence-2' class='sentence'>The sender's value completion operation
is also converted into an <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-2'>.</a></div> <div id='exec.stopped.opt-1.sentence-3' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with a disengaged <span class='texttt'>optional</span><a class='hidden_link' href='#exec.stopped.opt-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4380'>#</a></div><div class='texpara'><div id='exec.stopped.opt-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.opt-2.sentence-1'>.</a></div> <div id='exec.stopped.opt-2.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-2.sentence-2'>.</a></div> <div id='exec.stopped.opt-2.sentence-3' class='sentence'>The expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_optional, <span class='curlybracket'>{</span><span class='curlybracket'>}</span>, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.opt-2.sentence-3'>.</a></div></div></div><div class='para' id='exec.stopped.opt-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.opt-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4389'>#</a></div><div class='texpara'><div id='exec.stopped.opt-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.opt-3.sentence-1'>.</a></div> <div id='exec.stopped.opt-3.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for_______'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>optional_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>, or
if the type <span class='texttt'><span class='texttt'><i >single-sender-value-type</i></span><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span></span>
is ill-formed or <span class='texttt'><span class='keyword'>void</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>optional<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, _, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> V <span class='operator'>=</span> <i >single-sender-value-type</i><span class='anglebracket'>&lt;</span>Sndr, Env<span class='anglebracket'>&gt;</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    then<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
         <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>Ts<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> ts<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>V, Ts<span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
           <span class='keyword'>return</span> optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>in_place, std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Ts<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>ts<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
         <span class='curlybracket'>}</span><span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> just<span class='parenthesis'>(</span>optional<span class='anglebracket'>&lt;</span>V<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div id='exec.stopped.err' class='section'><h4 ><a class='secnum' href='#exec.stopped.err' style='min-width:95pt'>34.9.12.14</a> <span class='texttt'>execution&#x200b;::&#x200b;stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> <a class='abbr_ref' href='exec.stopped.err'>[exec.stopped.err]</a></h4><div class='para' id='exec.stopped.err-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4413'>#</a></div><div class='texpara'><div id='exec.stopped.err-1.sentence-1' class='sentence'><span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> maps an input sender's stopped completion operation
into an error completion operation as a custom error type<a class='hidden_link' href='#exec.stopped.err-1.sentence-1'>.</a></div> <div id='exec.stopped.err-1.sentence-2' class='sentence'>The result is a sender that never completes with stopped,
reporting cancellation by completing with an error<a class='hidden_link' href='#exec.stopped.err-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.stopped.err-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4419'>#</a></div><div class='texpara'><div id='exec.stopped.err-2.sentence-1' class='sentence'>The name <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error</span> denotes a pipeable sender adaptor object<a class='hidden_link' href='#exec.stopped.err-2.sentence-1'>.</a></div> <div id='exec.stopped.err-2.sentence-2' class='sentence'>For some subexpressions <span class='texttt'>sndr</span> and <span class='texttt'>err</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
let <span class='texttt'>Err</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-2.sentence-2'>.</a></div> <div id='exec.stopped.err-2.sentence-3' class='sentence'>If the type <span class='texttt'>Sndr</span> does not satisfy <a href='#concept:sender' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender________________________________________'><span class='texttt'>sender</span></span></a> or
if the type <span class='texttt'>Err</span> does not satisfy <a href='exec.general#concept:movable-value' title='34.1&emsp;General&emsp;[exec.general]'><span id='conceptref:movable-value_____'><span class='texttt'><i >movable-value</i></span></span></a>,
<span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.stopped.err-2.sentence-3'>.</a></div> <div id='exec.stopped.err-2.sentence-4' class='sentence'>Otherwise, the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='parenthesis'>(</span>sndr, err<span class='parenthesis'>)</span></span>
is expression-equivalent to:
<span class='codeblock'>transform_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, <i >make-sender</i><span class='parenthesis'>(</span>stopped_as_error, err, sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
</span>
except that <span class='texttt'>sndr</span> is only evaluated once<a class='hidden_link' href='#exec.stopped.err-2.sentence-4'>.</a></div></div></div><div class='para' id='exec.stopped.err-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.stopped.err-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4434'>#</a></div><div class='texpara'><div id='exec.stopped.err-3.sentence-1' class='sentence'>Let <span class='texttt'>sndr</span> and <span class='texttt'>env</span> be subexpressions
such that <span class='texttt'>Sndr</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> and
<span class='texttt'>Env</span> is <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>env<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.stopped.err-3.sentence-1'>.</a></div> <div id='exec.stopped.err-3.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender-for' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender-for________'><span class='texttt'><i >sender-for</i></span></span></a><span class='anglebracket'>&lt;</span>Sndr, stopped_<span class='shy'></span>as_<span class='shy'></span>error_<span class='shy'></span>t<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
then the expression <span class='texttt'>stopped_<span class='shy'></span>as_<span class='shy'></span>error<span class='operator'>.</span>transform_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr, env<span class='parenthesis'>)</span></span>
is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='squarebracket'>[</span>_, err, child<span class='squarebracket'>]</span> <span class='operator'>=</span> sndr;
<span class='keyword'>using</span> E <span class='operator'>=</span> <span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='keyword'>return</span> let_stopped<span class='parenthesis'>(</span>
    std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>child<span class='parenthesis'>)</span>,
    <span class='squarebracket'>[</span>err <span class='operator'>=</span> std<span class='operator'>::</span>forward_like<span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>mutable</span> <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_move_constructible_v<span class='anglebracket'>&lt;</span>E<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> just_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span></div></div></div></div></div><div id='exec.consumers' class='section'><h3 ><a class='secnum' href='#exec.consumers' style='min-width:80pt'>34.9.13</a> Sender consumers <a class='abbr_ref' href='exec.consumers'>[exec.consumers]</a></h3><div id='exec.sync.wait' class='section'><h4 ><a class='secnum' href='#exec.sync.wait' style='min-width:95pt'>34.9.13.1</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait</span> <a class='abbr_ref' href='exec.sync.wait'>[exec.sync.wait]</a></h4><div class='para' id='exec.sync.wait-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4456'>#</a></div><div class='texpara'><div id='exec.sync.wait-1.sentence-1' class='sentence'><span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> and <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span>
are used
to block the current thread of execution
until the specified sender completes and
to return its async result<a class='hidden_link' href='#exec.sync.wait-1.sentence-1'>.</a></div> <div id='exec.sync.wait-1.sentence-2' class='sentence'><span class='texttt'>sync_<span class='shy'></span>wait</span> mandates
that the input sender has exactly one value completion signature<a class='hidden_link' href='#exec.sync.wait-1.sentence-2'>.</a></div></div></div><div class='para' id='exec.sync.wait-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4465'>#</a></div><div class='texpara'><div id='exec.sync.wait-2.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-env</i></span> be the following exposition-only class type:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> <i >sync-wait-env</i> <span class='curlybracket'>{</span>
    execution<span class='operator'>::</span>run_loop<span class='operator'>*</span> <i >loop</i>;                                  <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>

    <span class='keyword'>auto</span> query<span class='parenthesis'>(</span>execution<span class='operator'>::</span>get_delegation_scheduler_t<span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span>
      <span class='keyword'>return</span> <i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.sync.wait-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4483'>#</a></div><div class='texpara'><div id='exec.sync.wait-3.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-result-type</i></span> and
<span class='texttt'><i >sync-wait-with-variant-result-type</i></span>
be exposition-only alias templates defined as follows:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i>, <i >decayed-tuple</i>,
               type_identity_t<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in_________________'><span class='tcode_in_codeblock'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span><i >sync-wait-env</i><span class='anglebracket'>&gt;</span> Sndr<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> <i >sync-wait-with-variant-result-type</i> <span class='operator'>=</span>
      optional<span class='anglebracket'>&lt;</span>execution<span class='operator'>::</span>value_types_of_t<span class='anglebracket'>&lt;</span>Sndr, <i >sync-wait-env</i><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='para' id='exec.sync.wait-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4500'>#</a></div><div class='texpara'><div id='exec.sync.wait-4.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait</span> denotes a customization point object<a class='hidden_link' href='#exec.sync.wait-4.sentence-1'>.</a></div> <div id='exec.sync.wait-4.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.sync.wait-4.sentence-2'>.</a></div> <div id='exec.sync.wait-4.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in__________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.sync.wait-4.sentence-3'>.</a></div> <div id='exec.sync.wait-4.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to the following,
except that <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='exec.sync.wait-4.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait-4.1'>(4.1)</a></div><div class='texpara'><div id='exec.sync.wait-4.1.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span> is well-formed<a class='hidden_link' href='#exec.sync.wait-4.1.sentence-1'>.</a></div></div></li><li id='exec.sync.wait-4.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait-4.2'>(4.2)</a></div><div class='texpara'><div id='exec.sync.wait-4.2.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the apply_sender expression above<a class='hidden_link' href='#exec.sync.wait-4.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.sync.wait-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4520'>#</a></div><div class='texpara'><div id='exec.sync.wait-5.sentence-1' class='sentence'>Let <span class='texttt'><i >sync-wait-state</i></span> and <span class='texttt'><i >sync-wait-receiver</i></span>
be the following exposition-only class templates:
<span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>this_thread <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-state</i> <span class='curlybracket'>{</span>                                      <span class='comment'>// <i >exposition only</i></span>
    execution<span class='operator'>::</span>run_loop <i >loop</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    exception_ptr <i >error</i>;                                        <span class='comment'>// <i >exposition only</i></span>
    <i >sync-wait-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> <i >result</i>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Sndr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >sync-wait-receiver</i> <span class='curlybracket'>{</span>                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>using</span> receiver_concept <span class='operator'>=</span> execution<span class='operator'>::</span>receiver_t;
    <i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='operator'>*</span> <i >state</i>;                               <span class='comment'>// <i >exposition only</i></span>

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
    <span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;

    <i >sync-wait-env</i> get_env<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='curlybracket'>{</span><span class='operator'>&amp;</span><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='curlybracket'>}</span>; <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div class='texpara'><div class='itemdecl' id='exec.sync.wait-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.sync.wait-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> Args<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_value<span class='parenthesis'>(</span>Args<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span> args<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.sync.wait-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4556'>#</a></div><div class='texpara'><div id='exec.sync.wait-6.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >result</i><span class='operator'>.</span>emplace<span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Args<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>args<span class='parenthesis'>)</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span> <span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.sync.wait-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.sync.wait-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Error<span class='anglebracket'>&gt;</span>
<span class='keyword'>void</span> set_error<span class='parenthesis'>(</span>Error<span class='operator'>&amp;</span><span class='operator'>&amp;</span> err<span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.sync.wait-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4575'>#</a></div><div class='texpara'><div id='exec.sync.wait-7.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >error</i> <span class='operator'>=</span> <i >AS-EXCEPT-PTR</i><span class='parenthesis'>(</span>std<span class='operator'>::</span>forward<span class='anglebracket'>&lt;</span>Error<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>err<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;    <span class='comment'>// see <a href='exec.general' title='34.1&emsp;General'>[exec.<span class='shy'></span>general]</a></span>
<i >state</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >loop</i><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.sync.wait-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.sync.wait-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> set_stopped<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='exec.sync.wait-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4589'>#</a></div><div class='texpara'><div id='exec.sync.wait-8.sentence-1' class='sentence'><i >Effects</i>: Equivalent to <span class='texttt'><span class='texttt'><i >state</i></span><span class='operator'>-</span><span class='anglebracket'>&gt;</span><span class='texttt'><i >loop</i></span><span class='operator'>.</span>finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.sync.wait-8.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.sync.wait-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4594'>#</a></div><div class='texpara'><div id='exec.sync.wait-9.sentence-1' class='sentence'>For a subexpression <span class='texttt'>sndr</span>, let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.sync.wait-9.sentence-1'>.</a></div> <div id='exec.sync.wait-9.sentence-2' class='sentence'>If <span class='texttt'><a href='#concept:sender_to' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_to__'><span class='texttt'>sender_<span class='shy'></span>to</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-receiver</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>sync_<span class='shy'></span>wait<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed;
otherwise, it is equivalent to:
<span class='codeblock'><i >sync-wait-state</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span> state;
<span class='keyword'>auto</span> op <span class='operator'>=</span> connect<span class='parenthesis'>(</span>sndr, <i >sync-wait-receiver</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='curlybracket'>{</span><span class='operator'>&amp;</span>state<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
start<span class='parenthesis'>(</span>op<span class='parenthesis'>)</span>;

state<span class='operator'>.</span><i >loop</i><span class='operator'>.</span>run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  rethrow_exception<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >error</i><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> std<span class='operator'>::</span>move<span class='parenthesis'>(</span>state<span class='operator'>.</span><i >result</i><span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.sync.wait-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4612'>#</a></div><div class='texpara'><div id='exec.sync.wait-10.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is undefined unless:
<ul class='itemize'><li id='exec.sync.wait-10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait-10.1'>(10.1)</a></div><div class='texpara'><div id='exec.sync.wait-10.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#exec.sync.wait-10.1.sentence-1'>.</a></div> <div id='exec.sync.wait-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.sync.wait-note-1'>1</a></i>:&ensp;<div id='exec.sync.wait-10.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait</span> achieves
forward progress guarantee delegation by providing a <span class='texttt'>run_<span class='shy'></span>loop</span> scheduler
via the <span class='texttt'>get_<span class='shy'></span>delegation_<span class='shy'></span>scheduler</span> query
on the <span class='texttt'><i >sync-wait-receiver</i></span>'s environment<a class='hidden_link' href='#exec.sync.wait-10.1.sentence-2'>.</a></div> <div id='exec.sync.wait-10.1.sentence-3' class='sentence'>The <span class='texttt'>run_<span class='shy'></span>loop</span> is driven by the current thread of execution<a class='hidden_link' href='#exec.sync.wait-10.1.sentence-3'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='exec.sync.wait-10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait-10.2'>(10.2)</a></div><div class='texpara'><div id='exec.sync.wait-10.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='exec.sync.wait-10.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait-10.2.1'>(10.2.1)</a></div><div class='texpara'><div id='exec.sync.wait-10.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in
a <span class='texttt'>tuple</span> in an engaged <span class='texttt'>optional</span> object<a class='hidden_link' href='#exec.sync.wait-10.2.1.sentence-1'>.</a></div></div></li><li id='exec.sync.wait-10.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait-10.2.2'>(10.2.2)</a></div><div class='texpara'><div id='exec.sync.wait-10.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#exec.sync.wait-10.2.2.sentence-1'>.</a></div></div></li><li id='exec.sync.wait-10.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait-10.2.3'>(10.2.3)</a></div><div class='texpara'><div id='exec.sync.wait-10.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#exec.sync.wait-10.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div><div id='exec.sync.wait.var' class='section'><h4 ><a class='secnum' href='#exec.sync.wait.var' style='min-width:95pt'>34.9.13.2</a> <span class='texttt'>this_<span class='shy'></span>thread&#x200b;::&#x200b;sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> <a class='abbr_ref' href='exec.sync.wait.var'>[exec.sync.wait.var]</a></h4><div class='para' id='exec.sync.wait.var-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait.var-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4642'>#</a></div><div class='texpara'><div id='exec.sync.wait.var-1.sentence-1' class='sentence'>The name <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> denotes
a customization point object<a class='hidden_link' href='#exec.sync.wait.var-1.sentence-1'>.</a></div> <div id='exec.sync.wait.var-1.sentence-2' class='sentence'>For a subexpression <span class='texttt'>sndr</span>,
let <span class='texttt'>Sndr</span> be <span class='texttt'><span class='keyword'>decltype</span><span class='parenthesis'>(</span>into_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#exec.sync.wait.var-1.sentence-2'>.</a></div> <div id='exec.sync.wait.var-1.sentence-3' class='sentence'>If <span class='texttt'><a href='#concept:sender_in' title='34.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender_in___________________'><span class='texttt'>sender_<span class='shy'></span>in</span></span></a><span class='anglebracket'>&lt;</span>Sndr, <span class='texttt'><i >sync-wait-env</i></span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>false</span></span>,
<span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.sync.wait.var-1.sentence-3'>.</a></div> <div id='exec.sync.wait.var-1.sentence-4' class='sentence'>Otherwise, it is expression-equivalent to the following,
except <span class='texttt'>sndr</span> is evaluated only once:
<span class='codeblock'>apply_sender<span class='parenthesis'>(</span><i >get-domain-early</i><span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span>, sync_wait_with_variant, sndr<span class='parenthesis'>)</span>
</span>
<i >Mandates</i>: <ul class='itemize'><li id='exec.sync.wait.var-1.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait.var-1.1'>(1.1)</a></div><div class='texpara'><div id='exec.sync.wait.var-1.1.sentence-1' class='sentence'>The type <span class='texttt'><span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span></span>
is well-formed<a class='hidden_link' href='#exec.sync.wait.var-1.1.sentence-1'>.</a></div></div></li><li id='exec.sync.wait.var-1.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait.var-1.2'>(1.2)</a></div><div class='texpara'><div id='exec.sync.wait.var-1.2.sentence-1' class='sentence'><span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__________________'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>e</span></span><span class='parenthesis'>)</span>, <span class='texttt'><i >sync-wait-with-variant-result-type</i></span><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
is <span class='texttt'><span class='literal'>true</span></span>, where <span class='math'><span class='mathalpha'>e</span></span> is the <span class='texttt'>apply_<span class='shy'></span>sender</span> expression above<a class='hidden_link' href='#exec.sync.wait.var-1.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='exec.sync.wait.var-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait.var-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4665'>#</a></div><div class='texpara'><div id='exec.sync.wait.var-2.sentence-1' class='sentence'>If <span class='texttt'><a href='functional.syn#concept:callable' title='22.10.2&emsp;Header &lt;functional&gt; synopsis&emsp;[functional.syn]'><span id='conceptref:callable_____'><span class='texttt'><i >callable</i></span></span></a><span class='anglebracket'>&lt;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>t, Sndr<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
the expression <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='operator'>.</span>apply_<span class='shy'></span>sender<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span> is ill-formed<a class='hidden_link' href='#exec.sync.wait.var-2.sentence-1'>.</a></div> <div id='exec.sync.wait.var-2.sentence-2' class='sentence'>Otherwise, it is equivalent to:
<span class='codeblock'><span class='keyword'>using</span> result_type <span class='operator'>=</span> <i >sync-wait-with-variant-result-type</i><span class='anglebracket'>&lt;</span>Sndr<span class='anglebracket'>&gt;</span>;
<span class='keyword'>if</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span> opt_value <span class='operator'>=</span> sync_wait<span class='parenthesis'>(</span>into_variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span>get<span class='anglebracket'>&lt;</span><span class='literal'>0</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><span class='operator'>*</span>opt_value<span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
<span class='keyword'>return</span> result_type<span class='parenthesis'>(</span>nullopt<span class='parenthesis'>)</span>;
</span></div></div></div><div class='para' id='exec.sync.wait.var-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.sync.wait.var-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9243ba5befaea8fd3e878e6114942db8d556a6e0/source/exec.tex#L4677'>#</a></div><div class='texpara'><div id='exec.sync.wait.var-3.sentence-1' class='sentence'>The behavior of <span class='texttt'>this_<span class='shy'></span>thread<span class='operator'>&#x200b;::&#x200b;</span>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant<span class='parenthesis'>(</span>sndr<span class='parenthesis'>)</span></span>
is undefined unless:
<ul class='itemize'><li id='exec.sync.wait.var-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait.var-3.1'>(3.1)</a></div><div class='texpara'><div id='exec.sync.wait.var-3.1.sentence-1' class='sentence'>It blocks the current thread of execution (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
with forward progress guarantee delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
until the specified sender completes<a class='hidden_link' href='#exec.sync.wait.var-3.1.sentence-1'>.</a></div> <div id='exec.sync.wait.var-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#exec.sync.wait.var-note-1'>1</a></i>:&ensp;<div id='exec.sync.wait.var-3.1.sentence-2' class='sentence'>The default implementation of <span class='texttt'>sync_<span class='shy'></span>wait_<span class='shy'></span>with_<span class='shy'></span>variant</span> achieves
forward progress guarantee delegation by relying on
the forward progress guarantee delegation provided by <span class='texttt'>sync_<span class='shy'></span>wait</span><a class='hidden_link' href='#exec.sync.wait.var-3.1.sentence-2'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></li><li id='exec.sync.wait.var-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.sync.wait.var-3.2'>(3.2)</a></div><div class='texpara'><div id='exec.sync.wait.var-3.2.sentence-1' class='sentence'>It returns the specified sender's async results as follows:
<ul class='itemize'><li id='exec.sync.wait.var-3.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait.var-3.2.1'>(3.2.1)</a></div><div class='texpara'><div id='exec.sync.wait.var-3.2.1.sentence-1' class='sentence'>For a value completion,
the result datums are returned in an engaged <span class='texttt'>optional</span> object
that contains a <span class='texttt'>variant</span> of <span class='texttt'>tuple</span>s<a class='hidden_link' href='#exec.sync.wait.var-3.2.1.sentence-1'>.</a></div></div></li><li id='exec.sync.wait.var-3.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait.var-3.2.2'>(3.2.2)</a></div><div class='texpara'><div id='exec.sync.wait.var-3.2.2.sentence-1' class='sentence'>For an error completion, an exception is thrown<a class='hidden_link' href='#exec.sync.wait.var-3.2.2.sentence-1'>.</a></div></div></li><li id='exec.sync.wait.var-3.2.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#exec.sync.wait.var-3.2.3'>(3.2.3)</a></div><div class='texpara'><div id='exec.sync.wait.var-3.2.3.sentence-1' class='sentence'>For a stopped completion, a disengaged <span class='texttt'>optional</span> object is returned<a class='hidden_link' href='#exec.sync.wait.var-3.2.3.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div></div></div></div></body></html>