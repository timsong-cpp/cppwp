<!DOCTYPE html><html lang='en'><head><title>[except.spec]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>18</a> Exception handling <a class='abbr_ref' href='./#except'>[except]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>18.4</a> Exception specifications <a class='abbr_ref'>[except.spec]</a></h2><p ><span class='indexparent'><a class='index' id=':exception_specification'></a></span></p><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L688'>#</a></div><p >The predicate indicating whether a function cannot exit via an exception
is called the <a class='hidden_link' href='#def:exception_specification' id='def:exception_specification'><i >exception specification</i></a> of the function.
If the predicate is false,
the function has a
<span class='indexparent'><a class='index' id=':exception_specification,potentially-throwing'></a></span><a class='hidden_link' href='#def:potentially-throwing,exception_specification' id='def:potentially-throwing,exception_specification'><i >potentially-throwing exception specification</i></a>,
otherwise it has a
<span class='indexparent'><a class='index' id=':exception_specification,non-throwing'></a></span><a class='hidden_link' href='#def:non-throwing_exception_specification' id='def:non-throwing_exception_specification'><i >non-throwing exception specification</i></a>.
The exception specification is either defined implicitly,
or defined explicitly
by using a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
as a suffix of a <a href='dcl.fct'>function declarator</a>.</p><pre class='bnf'><a class='nontermdef' id='nt:noexcept-specifier'>noexcept-specifier:</a>
&#9;<span class='terminal'>noexcept</span> <span class='terminal'>(</span> <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i> <span class='terminal'>)</span>
&#9;<span class='terminal'>noexcept</span>
&#9;<span class='terminal'>throw</span> <span class='terminal'>(</span> <span class='terminal'>)</span>
</pre></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L711'>#</a></div><p ><span class='indexparent'><a class='index' id=':exception_specification,noexcept,constant_expression_and'></a></span>In a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>, the <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i>,
if supplied, shall be a
<a href='expr.const#def:contextually_converted_constant_expression_of_type_bool'>contextually converted constant expression of type <span class='texttt'>bool</span></a>;
that constant expression is the exception specification of
the function type in which the <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> appears.
A <span class='texttt'>(</span> token that follows <span class='texttt'>noexcept</span> is part of the
<i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> and does not commence an
<a href='dcl.init'>initializer</a>.
The <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> <span class='texttt'>noexcept</span>
without a <i ><a href='expr.const#nt:constant-expression'>constant-expression</a></i>
is
equivalent to the <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
<span class='texttt'>noexcept(true)</span>.
The <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> <span class='texttt'>throw()</span>
is <a href='depr.except.spec'>deprecated</a>, and
equivalent to the <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
<span class='texttt'>noexcept(true)</span>.</p></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L731'>#</a></div><p >If a declaration of a function
does not have a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>,
the declaration has a potentially throwing exception specification
unless it is a destructor or a deallocation function
or is defaulted on its first declaration,
in which cases the exception specification
is as specified below
and no other declaration for that function
shall have a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>.
In an <a href='temp.explicit'>explicit instantiation</a>
a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> may be specified,
but is not required.
If a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> is specified
in an explicit instantiation directive,
the exception specification shall be the same as
the exception specification of all other declarations of that function.
A diagnostic is required only if the
exception specifications are not the same
within a single translation unit.</p></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L752'>#</a></div><p ><span class='indexparent'><a class='index' id=':exception_specification,virtual_function_and'></a></span>If a virtual function has a
non-throwing exception specification,
all declarations, including the definition, of any function
that overrides that virtual function in any derived class
shall have a non-throwing
exception specification,
unless the overriding function is defined as deleted.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
struct B {
  virtual void f() noexcept;
  virtual void g();
  virtual void h() noexcept = delete;
};

struct D: B {
  void f();                     <span class='comment'>// ill-formed
</span>  void g() noexcept;            <span class='comment'>// OK
</span>  void h() = delete;            <span class='comment'>// OK
</span>};</pre><p >The declaration of
<span class='texttt'>D&#x200b;::&#x200b;f</span>
is ill-formed because it
has a potentially-throwing exception specification,
whereas
<span class='texttt'>B&#x200b;::&#x200b;f</span>
has a non-throwing exception specification.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L785'>#</a></div><p ><span class='indexparent'><a class='index' id=':exception_handling,terminate_called'></a></span><span class='indexparent'><a class='index' id=':terminate,called'></a></span>Whenever an exception is thrown
and the search for a handler (<a href='except.handle'>[except.handle]</a>)
encounters the outermost block of a function with a
non-throwing exception specification,
the function <a href='except.terminate'><span class='texttt'>std&#x200b;::&#x200b;terminate()</span></a> is called.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
An implementation shall not reject an expression merely because, when
executed, it throws or might
throw an exception from a function with a non-throwing exception specification.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] 
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
extern void f();                <span class='comment'>// potentially-throwing
</span>
void g() noexcept {
  f();                          <span class='comment'>// valid, even if <span class='tcode_in_codeblock'>f</span> throws
</span>  throw 42;                     <span class='comment'>// valid, effectively a call to <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;terminate</span>
</span>}</pre><p >The call to
<span class='texttt'>f</span>
is well-formed even though, when called,
<span class='texttt'>f</span>
might throw an exception.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L814'>#</a></div><p >An expression <span class='texttt'>e</span> is
<a class='hidden_link' href='#def:potentially-throwing,expression' id='def:potentially-throwing,expression'><i >potentially-throwing</i></a> if</p><ul class='itemize'><li id='6.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.1'>(6.1)</a></div><p ><span class='texttt'>e</span> is a <a href='expr.call'>function call</a>
whose <i ><a href='expr.post#nt:postfix-expression'>postfix-expression</a></i>
has a function type,
or a pointer-to-function type,
with a potentially-throwing exception specification,
or
</p></li><li id='6.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.2'>(6.2)</a></div><p ><span class='texttt'>e</span> implicitly invokes a function
(such as an overloaded operator,
an allocation function in a <i ><a href='expr.new#nt:new-expression'>new-expression</a></i>,
a constructor for a function argument,
or a destructor if <span class='texttt'>e</span> is a <a href='intro.execution#def:full-expression'>full-expression</a>)
that is potentially-throwing,
or
</p></li><li id='6.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.3'>(6.3)</a></div><p ><span class='texttt'>e</span> is a <i ><a href='expr.throw#nt:throw-expression'>throw-expression</a></i>,
or
</p></li><li id='6.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.4'>(6.4)</a></div><p ><span class='texttt'>e</span> is a <a href='expr.dynamic.cast'><span class='texttt'>dynamic_&shy;cast</span></a> expression that casts to a reference type and
requires a runtime check,
or
</p></li><li id='6.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.5'>(6.5)</a></div><p ><span class='texttt'>e</span> is a <span class='texttt'>typeid</span> expression applied to a
(possibly parenthesized) built-in unary <span class='texttt'>*</span> operator
applied to a pointer to a
polymorphic class type (<a href='expr.typeid'>[expr.typeid]</a>),
or
</p></li><li id='6.6'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#6.6'>(6.6)</a></div><p >any of the <a href='intro.execution#def:immediate_subexpression'>immediate subexpressions</a>
of <span class='texttt'>e</span> is potentially-throwing.
</p></li></ul></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L852'>#</a></div><p >An implicitly-declared constructor for a class <span class='texttt'>X</span>,
or a constructor without a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
that is defaulted on its first declaration,
has a potentially-throwing exception specification
if and only if
any of the following constructs is potentially-throwing:</p><ul class='itemize'><li id='7.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.1'>(7.1)</a></div><p >a constructor selected by overload resolution
in the implicit definition of the constructor
for class <span class='texttt'>X</span>
to initialize a potentially constructed subobject, or
</p></li><li id='7.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.2'>(7.2)</a></div><p >a subexpression of such an initialization,
such as a default argument expression, or,
</p></li><li id='7.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#7.3'>(7.3)</a></div><p >for a default constructor, a default member initializer.
</p></li></ul><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span> 
Even though destructors for fully-constructed subobjects
are invoked when an exception is thrown
during the execution of a constructor (<a href='except.ctor'>[except.ctor]</a>),
their exception specifications do not contribute
to the exception specification of the constructor,
because an exception thrown from such a destructor
would call <span class='texttt'>std&#x200b;::&#x200b;terminate</span>
rather than escape the constructor (<a href='except.throw'>[except.throw]</a>, <a href='except.terminate'>[except.terminate]</a>).
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L883'>#</a></div><p >The exception specification for an implicitly-declared destructor,
or a destructor without a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>,
is potentially-throwing if and only if
any of the destructors
for any of its potentially constructed subobjects
is potentially throwing.</p></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L891'>#</a></div><p >The exception specification for an implicitly-declared assignment operator,
or an assignment-operator without a <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
that is defaulted on its first declaration,
is potentially-throwing if and only if
the invocation of any assignment operator
in the implicit definition is potentially-throwing.</p></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L899'>#</a></div><p >A <a href='basic.stc.dynamic.deallocation'>deallocation function</a>
with no explicit <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i>
has a non-throwing exception specification.</p></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L904'>#</a></div><p >[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Example:</span> 
</p><pre class='codeblock'>
struct A {
  A(int = (A(5), 0)) noexcept;
  A(const A&amp;) noexcept;
  A(A&amp;&amp;) noexcept;
  ~A();
};
struct B {
  B() throw();
  B(const B&amp;) = default;        <span class='comment'>// implicit exception specification is <span class='tcode_in_codeblock'>noexcept(true)</span>
</span>  B(B&amp;&amp;, int = (throw Y(), 0)) noexcept;
  ~B() noexcept(false);
};
int n = 7;
struct D : public A, public B {
    int * p = new int[n];
    <span class='comment'>// <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;D()</span> potentially-throwing, as the <span class='tcode_in_codeblock'>new</span> operator may throw <span class='tcode_in_codeblock'>bad_&shy;alloc</span> or <span class='tcode_in_codeblock'>bad_&shy;array_&shy;new_&shy;length</span>
</span>    <span class='comment'>// <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;D(const D&amp;)</span> non-throwing
</span>    <span class='comment'>// <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;D(D&amp;&amp;)</span> potentially-throwing, as the default argument for <span class='tcode_in_codeblock'>B</span>'s constructor may throw
</span>    <span class='comment'>// <span class='tcode_in_codeblock'>D&#x200b;::&#x200b; D()</span> potentially-throwing
</span>};</pre><p >Furthermore, if
<span class='texttt'>A&#x200b;::&#x200b;~A()</span>
were virtual,
the program would be ill-formed since a function that overrides a virtual
function from a base class
shall not have a potentially-throwing exception specification
if the base class function has a non-throwing exception specification.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end example</span><span style='white-space:nowrap'>&thinsp;</span>] </p></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/2f118eb5c2d546aaf830f92b262039083e40576f/source/exceptions.tex#L937'>#</a></div><p >An exception specification is considered to be <a class='hidden_link' href='#def:needed,exception_specification' id='def:needed,exception_specification'><i >needed</i></a> when:</p><ul class='itemize'><li id='12.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#12.1'>(12.1)</a></div><p >in an expression, the function is the unique lookup result or the selected
member of a set of overloaded functions (<a href='basic.lookup'>[basic.lookup]</a>, <a href='over.match'>[over.match]</a>, <a href='over.over'>[over.over]</a>);</p></li><li id='12.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#12.2'>(12.2)</a></div><p >the function is <a href='basic.def.odr'>odr-used</a> or, if it appears in an
unevaluated operand, would be odr-used if the expression were
potentially-evaluated;</p></li><li id='12.3'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#12.3'>(12.3)</a></div><p >the exception specification is compared to that of another
declaration (e.g., an explicit specialization or an overriding virtual
function);</p></li><li id='12.4'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#12.4'>(12.4)</a></div><p >the function is defined; or</p></li><li id='12.5'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#12.5'>(12.5)</a></div><p >the exception specification is needed for a defaulted
special member function that calls the function.
[<span style='white-space:nowrap'>&thinsp;</span><span class='textit'>Note:</span>  A defaulted declaration does not require the
exception specification of a base member function to be evaluated
until the implicit exception specification of the derived
function is needed, but an explicit <i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> needs
the implicit exception specification to compare against.
<span class='textit'><span style='white-space:nowrap'>&thinsp;</span>—<span style='white-space:nowrap'>&thinsp;</span>end note</span><span style='white-space:nowrap'>&thinsp;</span>] 
</p></li></ul><p >The exception specification of a defaulted special member
function is evaluated as described above only when needed; similarly, the
<i ><a href='except.spec#nt:noexcept-specifier'>noexcept-specifier</a></i> of a specialization of a function
template or member function of a class template is instantiated only when
needed.
</p></div></div></body></html>