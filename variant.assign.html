<!DOCTYPE html><html lang='en'><head><title>[variant.assign]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>20</a> General utilities library <a class='abbr_ref' href='./#utilities'>[utilities]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>20.7</a> Variants <a class='abbr_ref' href='variant#assign'>[variant]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>20.7.2</a> Class template <span class='texttt'>variant</span> <a class='abbr_ref' href='variant.variant#variant.assign'>[variant.variant]</a></h3><div id='variant.assign'><h4 ><a class='secnum' style='min-width:118pt'>20.7.2.3</a> Assignment <a class='abbr_ref'>[variant.assign]</a></h4><p ><span class='indexparent'><a class='index' id='operator=,variant'></a></span><span class='indexparent'><a class='index' id='variant,operator='></a></span><code class='itemdecl'>
variant&amp; operator=(const variant&amp; rhs);
</code></p><div class='itemdescr'></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='itemdescr'><p ><i>Effects:</i>
</p><ul ><li ><p >If neither <span class='texttt'>*this</span> nor <span class='texttt'>rhs</span> holds a value, there is no effect.  Otherwise,
</p></li><li ><p >if <span class='texttt'>*this</span> holds a value but <span class='texttt'>rhs</span> does not, destroys the value
contained in <span class='texttt'>*this</span> and sets <span class='texttt'>*this</span> to not hold a value.  Otherwise,
</p></li><li ><p >if <span class='texttt'>index() == rhs.index()</span>, assigns the value contained in <span class='texttt'>rhs</span>
to the value contained in <span class='texttt'>*this</span>. Otherwise,
</p></li><li ><p >copies the value contained in <span class='texttt'>rhs</span> to a temporary, then destroys any
value contained in <span class='texttt'>*this</span>. Sets <span class='texttt'>*this</span> to hold the same
alternative index as <span class='texttt'>rhs</span> and initializes the value contained in
<span class='texttt'>*this</span> as if direct-non-list-initializing an object of type <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>
with <span class='texttt'>std::forward&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>&gt;(TMP),</span> with <span class='texttt'>TMP</span> being the temporary and
<span class='math'><span class='mathalpha'>j</span></span> being <span class='texttt'>rhs.index()</span>.
</p></li></ul></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><p ><i>Returns:</i> <span class='texttt'>*this</span>.</p></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><p ><i>Postconditions:</i> <span class='texttt'>index() == rhs.index()</span>.</p></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><p ><i>Remarks:</i>
This function shall not participate in overload resolution unless
<span class='texttt'>is_copy_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt; &amp;&amp; is_move_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt; &amp;&amp; is_copy_assignable_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt;</span>
is <span class='texttt'>true</span> for all <span class='math'><span class='mathalpha'>i</span></span>.
If an exception is thrown during the call to <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s copy assignment,
the state of the contained value is as defined by the exception safety
guarantee of <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s copy assignment; <span class='texttt'>index()</span> will be <span class='math'><span class='mathalpha'>j</span></span>.
If an exception is thrown during the call to <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s copy construction
(with <span class='math'><span class='mathalpha'>j</span></span> being <span class='texttt'>rhs.index()</span>), <span class='texttt'>*this</span> will remain unchanged.
If an exception is thrown during the call to <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s move construction,
the <span class='texttt'>variant</span> will hold no value.
</p></div></div><p ><span class='indexparent'><a class='index' id='operator=,variant'></a></span><span class='indexparent'><a class='index' id='variant,operator='></a></span><code class='itemdecl'>
variant&amp; operator=(variant&amp;&amp; rhs) noexcept(<i><span class='texttt'>see below</span></i>);
</code></p><div class='itemdescr'></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><p ><i>Effects:</i>
</p><ul ><li ><p >If neither <span class='texttt'>*this</span> nor <span class='texttt'>rhs</span> holds a value, there is no effect. Otherwise,
</p></li><li ><p >if <span class='texttt'>*this</span> holds a value but <span class='texttt'>rhs</span> does not, destroys the value
contained in <span class='texttt'>*this</span> and sets <span class='texttt'>*this</span> to not hold a value. Otherwise,
</p></li><li ><p >if <span class='texttt'>index() == rhs.index()</span>, assigns <span class='texttt'>get&lt;<span class='math'><span class='mathalpha'>j</span></span>&gt;(std::move(rhs))</span> to
the value contained in <span class='texttt'>*this</span>, with <span class='math'><span class='mathalpha'>j</span></span> being <span class='texttt'>index()</span>. Otherwise,
</p></li><li ><p >destroys any value contained in <span class='texttt'>*this</span>. Sets <span class='texttt'>*this</span> to hold the
same alternative index as <span class='texttt'>rhs</span> and initializes the value contained in
<span class='texttt'>*this</span> as if direct-non-list-initializing an object of type <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>
with <span class='texttt'>get&lt;<span class='math'><span class='mathalpha'>j</span></span>&gt;(std::move(rhs))</span> with <span class='math'><span class='mathalpha'>j</span></span> being <span class='texttt'>rhs.index()</span>.
</p></li></ul></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><p ><i>Returns:</i> <span class='texttt'>*this</span>.</p></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><p ><i>Remarks:</i>
This function shall not participate in overload resolution unless
<span class='texttt'>is_move_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt; &amp;&amp; is_move_assignable_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt;</span> is
<span class='texttt'>true</span> for all <span class='math'><span class='mathalpha'>i</span></span>.
The expression inside <span class='texttt'>noexcept</span> is equivalent to:
<span class='texttt'>is_nothrow_move_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt; &amp;&amp; is_nothrow_move_assignable_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>&gt;</span> for all <span class='math'><span class='mathalpha'>i</span></span>.
If an exception is thrown during the call to <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s move construction
(with <span class='math'><span class='mathalpha'>j</span></span> being <span class='texttt'>rhs.index())</span>, the <span class='texttt'>variant</span> will hold no value.
If an exception is thrown during the call to <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s move assignment,
the state of the contained value is as defined by the exception safety
guarantee of <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>'s move assignment; <span class='texttt'>index()</span> will be <span class='math'><span class='mathalpha'>j</span></span>.
</p></div></div><p ><span class='indexparent'><a class='index' id='operator=,variant'></a></span><span class='indexparent'><a class='index' id='variant,operator='></a></span><code class='itemdecl'>
template &lt;class T&gt; variant&amp; operator=(T&amp;&amp; t) noexcept(<i><span class='texttt'>see below</span></i>);
</code></p><div class='itemdescr'></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><p >Let <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span> be a type that is determined as follows:
build an imaginary function <span class='texttt'><i>FUN</i>(<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>)</span> for each alternative type
<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>i</span></sub></span>. The overload <span class='texttt'><i>FUN</i>(<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>)</span> selected by overload
resolution for the expression <span class='texttt'><i>FUN</i>(std::forward&lt;T&gt;(<span class='discretionary'></span>t))</span> defines
the alternative <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span> which is the type of the contained value after
assignment.</p></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><p ><i>Effects:</i>
If <span class='texttt'>*this</span> holds a <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>, assigns <span class='texttt'>std::forward&lt;T&gt;(t)</span> to
the value contained in <span class='texttt'>*this</span>. Otherwise, destroys any value contained
in <span class='texttt'>*this</span>, sets <span class='texttt'>*this</span> to hold the alternative type <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>
as selected by the imaginary function overload resolution described above,
and direct-initializes the contained value as if direct-non-list-initializing
it with <span class='texttt'>std::forward&lt;T&gt;(t)</span>.</p></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><p ><i>Postconditions:</i>
<span class='texttt'>holds_alternative&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>&gt;(*this)</span> is <span class='texttt'>true</span>, with <span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>
selected by the imaginary function overload resolution described above.</p></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><p ><i>Returns:</i> <span class='texttt'>*this</span>.</p></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='itemdescr'><p ><i>Remarks:</i>
This function shall not participate in overload resolution unless
<span class='texttt'>is_same_v&lt;decay_t&lt;T&gt;, variant&gt;</span> is <span class='texttt'>false</span>, unless
<span class='texttt'>is_assignable_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>&amp;, T&gt; &amp;&amp; is_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>, T&gt;</span> is <span class='texttt'>true</span>,
and unless the expression <span class='texttt'><i>FUN</i>(std::forward&lt;T&gt;(t))</span> (with
<span class='texttt'><i>FUN</i></span> being the above-mentioned set of imaginary functions)
is well formed.</p></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='itemdescr'><p >[&nbsp;<i>Note:</i><span class='space'></span>
</p><pre class='codeblock'>
variant&lt;string, string&gt; v;
v = "abc";
</pre><p >is ill-formed, as both alternative types have an equally viable constructor
for the argument. <i>&nbsp;â€”&nbsp;end note</i>&nbsp;]</p></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='itemdescr'><p >The expression inside <span class='texttt'>noexcept</span> is equivalent to:
<span class='texttt'>is_nothrow_assignable_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>&amp;, T&gt; &amp;&amp; is_nothrow_constructible_v&lt;<span class='math'><span class='mathalpha'>T</span><sub ><span class='mathalpha'>j</span></sub></span>, T&gt;</span>.
If an exception is thrown during the assignment of <span class='texttt'>std::forward&lt;T&gt;(t)</span>
to the value contained in <span class='texttt'>*this</span>, the state of the contained value and
<span class='texttt'>t</span> are as defined by the exception safety guarantee of the assignment
expression; <span class='texttt'>valueless_by_exception()</span> will be <span class='texttt'>false</span>.
If an exception is thrown during the initialization of the contained value,
the <span class='texttt'>variant</span> object might not hold a value.
</p></div></div></div></div></body></html>