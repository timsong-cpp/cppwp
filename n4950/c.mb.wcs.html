<!DOCTYPE html><html lang='en'><head><title>[c.mb.wcs]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>23</a> Strings library <a class='abbr_ref' href='./#strings'>[strings]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>23.5</a> Null-terminated sequence utilities <a class='abbr_ref' href='c.strings#c.mb.wcs'>[c.strings]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>23.5.6</a> Multibyte / wide string and character conversion functions <a class='abbr_ref'>[c.mb.wcs]</a></h3><div class='para nonNormativeOnly' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5780'>#</a></div><div class='texpara'><div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='1.sentence-1' class='sentence'>The headers <a href='cstdlib.syn#header:%3ccstdlib%3e' title='17.2.2&emsp;Header &lt;cstdlib&gt; synopsis&emsp;[cstdlib.syn]'><span id='headerref:<cstdlib>'><span class='texttt'>&lt;cstdlib&gt;</span></span></a>,
<a href='cuchar.syn#header:%3ccuchar%3e' title='23.5.5&emsp;Header &lt;cuchar&gt; synopsis&emsp;[cuchar.syn]'><span id='headerref:<cuchar>'><span class='texttt'>&lt;cuchar&gt;</span></span></a>,
and <a href='cwchar.syn#header:%3ccwchar%3e' title='23.5.4&emsp;Header &lt;cwchar&gt; synopsis&emsp;[cwchar.syn]'><span id='headerref:<cwchar>'><span class='texttt'>&lt;cwchar&gt;</span></span></a>
declare the functions described in this subclause<a class='hidden_link' href='#1.sentence-1'>.</a></div> â€”&nbsp;<i>end note</i>]</div></div></div></div><div class='texpara'><div id='lib:wcstombs'><div id='lib:mbstowcs'><div id='lib:mblen'><div id='lib:mbsinit'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:mbsinit'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>int</span> mbsinit<span class='parenthesis'>(</span><span class='keyword'>const</span> mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
<span class='keyword'>int</span> mblen<span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n<span class='parenthesis'>)</span>;
size_t mbstowcs<span class='parenthesis'>(</span><span class='keyword'>wchar_t</span><span class='operator'>*</span> pwcs, <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n<span class='parenthesis'>)</span>;
size_t wcstombs<span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span> s, <span class='keyword'>const</span> <span class='keyword'>wchar_t</span><span class='operator'>*</span> pwcs, size_t n<span class='parenthesis'>)</span>;
</code></div></div></div></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5800'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'><i >Effects</i>: These functions have the semantics specified in the C standard library<a class='hidden_link' href='#2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='sentence-1' class='sentence'><span class='textsc'>See also:</span>  ISO/IEC 9899:2018, 7.22.7.1, 7.22.8, 7.29.6.2.1</div></div><div class='texpara'><div id='lib:wctomb'><div id='lib:mbtowc'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:mbtowc'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>int</span> mbtowc<span class='parenthesis'>(</span><span class='keyword'>wchar_t</span><span class='operator'>*</span> pwc, <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n<span class='parenthesis'>)</span>;
<span class='keyword'>int</span> wctomb<span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span> s, <span class='keyword'>wchar_t</span> wchar<span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5815'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'><i >Effects</i>: These functions have the semantics specified in the C standard library<a class='hidden_link' href='#3.sentence-1'>.</a></div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5819'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><i >Remarks</i>: Calls to these functions
may introduce a data race (<a href='res.on.data.races' title='16.4.6.10&emsp;Data race avoidance'>[res.<span class='shy'></span>on.<span class='shy'></span>data.<span class='shy'></span>races]</a>)
with other calls to the same function<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='sentence-2' class='sentence'><span class='textsc'>See also:</span>  ISO/IEC 9899:2018, 7.22.7</div></div><div class='texpara'><div id='lib:wcrtomb'><div id='lib:mbrtowc'><div id='lib:wcrstombs'><div id='lib:mbrstowcs'><div id='lib:mbrlen'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:mbrlen'>ðŸ”—</a></div><code class='itemdeclcode'>size_t mbrlen<span class='parenthesis'>(</span><span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
size_t mbrtowc<span class='parenthesis'>(</span><span class='keyword'>wchar_t</span><span class='operator'>*</span> pwc, <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
size_t wcrtomb<span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span> s, <span class='keyword'>wchar_t</span> wc, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
size_t mbsrtowcs<span class='parenthesis'>(</span><span class='keyword'>wchar_t</span><span class='operator'>*</span> dst, <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span><span class='operator'>*</span> src, size_t len, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
size_t wcsrtombs<span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span> dst, <span class='keyword'>const</span> <span class='keyword'>wchar_t</span><span class='operator'>*</span><span class='operator'>*</span> src, size_t len, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
</code></div></div></div></div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5842'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'><i >Effects</i>: These functions have the semantics specified in the C standard library<a class='hidden_link' href='#5.sentence-1'>.</a></div></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5846'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'><i >Remarks</i>: Calling these functions
with an <span class='texttt'>mbstate_<span class='shy'></span>t<span class='operator'>*</span></span> argument that is a null pointer value
may introduce a data race (<a href='res.on.data.races' title='16.4.6.10&emsp;Data race avoidance'>[res.<span class='shy'></span>on.<span class='shy'></span>data.<span class='shy'></span>races]</a>)
with other calls to the same function
with an <span class='texttt'>mbstate_<span class='shy'></span>t<span class='operator'>*</span></span> argument that is a null pointer value<a class='hidden_link' href='#6.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='sentence-3' class='sentence'><span class='textsc'>See also:</span>  ISO/IEC 9899:2018, 7.29.6.3</div></div><div class='texpara'><div id='lib:mbrtoc8'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:mbrtoc8'>ðŸ”—</a></div><code class='itemdeclcode'>size_t mbrtoc8<span class='parenthesis'>(</span><span class='keyword'>char8_t</span><span class='operator'>*</span> pc8, <span class='keyword'>const</span> <span class='keyword'>char</span><span class='operator'>*</span> s, size_t n, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5863'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>s</span> is a null pointer,
equivalent to <span class='texttt'>mbrtoc8<span class='parenthesis'>(</span><span class='literal'>nullptr</span>, <span class='literal'>""</span>, <span class='literal'>1</span>, ps<span class='parenthesis'>)</span></span><a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.sentence-2' class='sentence'>Otherwise, the function inspects at most <span class='texttt'>n</span> bytes
beginning with the byte pointed to by <span class='texttt'>s</span>
to determine the number of bytes needed to complete
the next multibyte character (including any shift sequences)<a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='7.sentence-3' class='sentence'>If the function determines
that the next multibyte character is complete and valid,
<a class='index' id=':UTF-8'></a>it determines the values of the corresponding UTF-8 code units and then,
if <span class='texttt'>pc8</span> is not a null pointer,
stores the value of the first (or only) such code unit
in the object pointed to by <span class='texttt'>pc8</span><a class='hidden_link' href='#7.sentence-3'>.</a></div> <div id='7.sentence-4' class='sentence'>Subsequent calls will store successive UTF-8 code units
without consuming any additional input
until all the code units have been stored<a class='hidden_link' href='#7.sentence-4'>.</a></div> <div id='7.sentence-5' class='sentence'>If the corresponding Unicode character is <span class='ucode'>U+0000</span> <span class='uname'>null</span>,
the resulting state described is the initial conversion state<a class='hidden_link' href='#7.sentence-5'>.</a></div></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5884'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'><i >Returns</i>: The first of the following that applies (given the current conversion state):
<ul class='itemize'><li id='8.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#8.1'>(8.1)</a></div><div class='texpara'><div id='8.1.sentence-1' class='sentence'><span class='texttt'><span class='literal'>0</span></span>, if the next <span class='texttt'>n</span> or fewer bytes complete
the multibyte character
that corresponds to the <span class='ucode'>U+0000</span> <span class='uname'>null</span> Unicode character
(which is the value stored)<a class='hidden_link' href='#8.1.sentence-1'>.</a></div></div></li><li id='8.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#8.2'>(8.2)</a></div><div class='texpara'><div id='8.2.sentence-1' class='sentence'>between <span class='texttt'><span class='literal'>1</span></span> and <span class='texttt'>n</span> (inclusive),
if the next n or fewer bytes complete a valid multibyte character
(whose first (or only) code unit is stored);
the value returned is the number of bytes that complete the multibyte character<a class='hidden_link' href='#8.2.sentence-1'>.</a></div></div></li><li id='8.3'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#8.3'>(8.3)</a></div><div class='texpara'><div id='8.3.sentence-1' class='sentence'><span class='texttt'><span class='parenthesis'>(</span>size_<span class='shy'></span>t<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='operator'>-</span><span class='literal'>3</span><span class='parenthesis'>)</span></span>, if the next code unit
resulting from a previous call has been stored
(no bytes from the input have been consumed by this call)<a class='hidden_link' href='#8.3.sentence-1'>.</a></div></div></li><li id='8.4'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#8.4'>(8.4)</a></div><div class='texpara'><div id='8.4.sentence-1' class='sentence'><span class='texttt'><span class='parenthesis'>(</span>size_<span class='shy'></span>t<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='operator'>-</span><span class='literal'>2</span><span class='parenthesis'>)</span></span>, if the next <span class='texttt'>n</span> bytes
contribute to an incomplete (but potentially valid) multibyte character, and
all <span class='texttt'>n</span> bytes have been processed (no value is stored)<a class='hidden_link' href='#8.4.sentence-1'>.</a></div></div></li><li id='8.5'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#8.5'>(8.5)</a></div><div class='texpara'><div id='8.5.sentence-1' class='sentence'><span class='texttt'><span class='parenthesis'>(</span>size_<span class='shy'></span>t<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='operator'>-</span><span class='literal'>1</span><span class='parenthesis'>)</span></span>, if an encoding error occurs,
in which case the next <span class='texttt'>n</span> or fewer bytes do not contribute to
a complete and valid multibyte character (no value is stored);
the value of the macro <span class='texttt'>EILSEQ</span> is stored in <span class='texttt'>errno</span>, and
the conversion state is unspecified<a class='hidden_link' href='#8.5.sentence-1'>.</a></div></div></li></ul></div></div></div></div><div class='texpara'><div id='lib:c8rtomb'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:c8rtomb'>ðŸ”—</a></div><code class='itemdeclcode'>size_t c8rtomb<span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span> s, <span class='keyword'>char8_t</span> c8, mbstate_t<span class='operator'>*</span> ps<span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5916'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'><i >Effects</i>: If <span class='texttt'>s</span> is a null pointer, equivalent to
<span class='texttt'>c8rtomb<span class='parenthesis'>(</span>buf, <span class='literal'>u8'<span class='math'>\</span>0'</span>, ps<span class='parenthesis'>)</span></span>
where <span class='texttt'>buf</span> is an internal buffer<a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='9.sentence-2' class='sentence'><a class='index' id=':UTF-8_'></a>Otherwise, if <span class='texttt'>c8</span> completes a sequence of valid UTF-8 code units,
determines the number of bytes needed
to represent the multibyte character (including any shift sequences),
and stores the multibyte character representation in the array
whose first element is pointed to by <span class='texttt'>s</span><a class='hidden_link' href='#9.sentence-2'>.</a></div> <div id='9.sentence-3' class='sentence'>At most <span class='texttt'>MB_<span class='shy'></span>CUR_<span class='shy'></span>MAX</span> bytes are stored<a class='hidden_link' href='#9.sentence-3'>.</a></div> <div id='9.sentence-4' class='sentence'>If the multibyte character is a null character, a null byte is stored,
preceded by any shift sequence needed to restore the initial shift state;
the resulting state described is the initial conversion state<a class='hidden_link' href='#9.sentence-4'>.</a></div></div></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5932'>#</a></div><div class='texpara'><div id='10.sentence-1' class='sentence'><i >Returns</i>: The number of bytes stored in the array object (including any shift sequences)<a class='hidden_link' href='#10.sentence-1'>.</a></div> <div id='10.sentence-2' class='sentence'>If <span class='texttt'>c8</span> does not contribute to a sequence of <span id=':char8_t'><span class='texttt'><span class='keyword'>char8_<span class='shy'></span>t</span></span></span>
corresponding to a valid multibyte character,
the value of the macro <span class='texttt'>EILSEQ</span> is stored in <span class='texttt'>errno</span>,
<span class='texttt'><span class='parenthesis'>(</span>size_<span class='shy'></span>t<span class='parenthesis'>)</span> <span class='parenthesis'>(</span><span class='operator'>-</span><span class='literal'>1</span><span class='parenthesis'>)</span></span> is returned, and the conversion state is unspecified<a class='hidden_link' href='#10.sentence-2'>.</a></div></div></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/df2e6ff582d09a4100b459399f5f76ad3db5f88f/source/strings.tex#L5940'>#</a></div><div class='texpara'><div id='11.sentence-1' class='sentence'><i >Remarks</i>: Calls to <span class='texttt'>c8rtomb</span> with a null pointer argument for <span class='texttt'>s</span>
may introduce a data race (<a href='res.on.data.races' title='16.4.6.10&emsp;Data race avoidance'>[res.<span class='shy'></span>on.<span class='shy'></span>data.<span class='shy'></span>races]</a>)
with other calls to <span class='texttt'>c8rtomb</span>
with a null pointer argument for <span class='texttt'>s</span><a class='hidden_link' href='#11.sentence-1'>.</a></div></div></div></div></div></body></html>