<!DOCTYPE html><html lang='en'><head><title>[diff.expr]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:50pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>C.6</a> C++ and ISO C <a class='abbr_ref' href='diff.iso#diff.expr'>[diff.iso]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>C.6.4</a> <a href='expr' title='7&emsp;Expressions'>[expr]</a>: expressions <a class='abbr_ref'>[diff.expr]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/dbd2450ef21216a8eff8e7c454db6c4e1683bbf5/source/compatibility.tex#L2382'>#</a></div><div class='texpara'><b>Affected subclause:</b> <a href='conv.ptr'>[conv.<span class='shy'></span>ptr]</a>
<br/> <div id='1.sentence-1' class='sentence'><b>Change:</b> Converting <span class='texttt'><span id=':void'><span class='texttt'><span class='keyword'>void</span></span></span><span class='operator'>*</span></span> to a pointer-to-object type requires casting<a class='hidden_link' href='#1.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>char</span> a<span class='squarebracket'>[</span><span class='literal'>10</span><span class='squarebracket'>]</span>;
<span class='keyword'>void</span><span class='operator'>*</span> b<span class='operator'>=</span>a;
<span class='keyword'>void</span> foo<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>char</span><span class='operator'>*</span> c<span class='operator'>=</span>b;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><div id='1.sentence-2' class='sentence'>ISO C accepts this usage of pointer to <span id=':void_'><span class='texttt'><span class='keyword'>void</span></span></span> being assigned
to a pointer to object type<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>C++ does not<a class='hidden_link' href='#1.sentence-3'>.</a></div> <br/> <div id='1.sentence-4' class='sentence'><b>Rationale:</b> C++ tries harder than C to enforce compile-time type safety<a class='hidden_link' href='#1.sentence-4'>.</a></div> <br/> <div id='1.sentence-5' class='sentence'><b>Effect on original feature:</b> Deletion of semantically well-defined feature<a class='hidden_link' href='#1.sentence-5'>.</a></div> <br/> <div id='1.sentence-6' class='sentence'><b>Difficulty of converting:</b> Can be automated<a class='hidden_link' href='#1.sentence-6'>.</a></div> <div id='1.sentence-7' class='sentence'>Violations will be diagnosed by the C++ translator<a class='hidden_link' href='#1.sentence-7'>.</a></div> <div id='1.sentence-8' class='sentence'>The
fix is to add a  cast<a class='hidden_link' href='#1.sentence-8'>.</a></div> <div id='1.sentence-9' class='sentence'>For example:
<span class='codeblock'><span class='keyword'>char</span><span class='operator'>*</span> c <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span><span class='parenthesis'>)</span> b;
</span></div></div><div class='texpara'><br/> <div id='1.sentence-10' class='sentence'><b>How widely used:</b> This is fairly widely used but it is good
programming practice to add the cast when assigning pointer-to-void to pointer-to-object<a class='hidden_link' href='#1.sentence-10'>.</a></div> <div id='1.sentence-11' class='sentence'>Some ISO C translators will give a warning
if the cast is not used<a class='hidden_link' href='#1.sentence-11'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/dbd2450ef21216a8eff8e7c454db6c4e1683bbf5/source/compatibility.tex#L2416'>#</a></div><div class='texpara'><b>Affected subclauses:</b> <a href='expr.post.incr'>[expr.<span class='shy'></span>post.<span class='shy'></span>incr]</a> and <a href='expr.pre.incr'>[expr.<span class='shy'></span>pre.<span class='shy'></span>incr]</a>
<br/> <div id='2.sentence-1' class='sentence'><b>Change:</b> Decrement operator is not allowed with <span id=':bool'><span class='texttt'><span class='keyword'>bool</span></span></span> operand<a class='hidden_link' href='#2.sentence-1'>.</a></div> <br/> <div id='2.sentence-2' class='sentence'><b>Rationale:</b> Feature with surprising semantics<a class='hidden_link' href='#2.sentence-2'>.</a></div> <br/> <div id='2.sentence-3' class='sentence'><b>Effect on original feature:</b> A valid ISO C expression utilizing the decrement operator on
a <span id=':bool_'><span class='texttt'><span class='keyword'>bool</span></span></span> lvalue
(for instance, via the C typedef in <a href='depr.c.macros#header:%3cstdbool.h%3e' title='D.13&emsp;Deprecated C macros&emsp;[depr.c.macros]'><span id='headerref:<stdbool.h>'><span class='texttt'>&lt;stdbool.h&gt;</span></span></a>)
is ill-formed in C++<a class='hidden_link' href='#2.sentence-3'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/dbd2450ef21216a8eff8e7c454db6c4e1683bbf5/source/compatibility.tex#L2427'>#</a></div><div class='texpara'><b>Affected subclauses:</b> <a href='expr.sizeof'>[expr.<span class='shy'></span>sizeof]</a> and <a href='expr.cast'>[expr.<span class='shy'></span>cast]</a>
<br/> <div id='3.sentence-1' class='sentence'><b>Change:</b> In C++, types can only be defined in declarations, not in expressions<a class='hidden_link' href='#3.sentence-1'>.</a></div> <br/> <div id='3.sentence-2' class='sentence'>
In C, a <span id=':sizeof'><span class='texttt'><span class='keyword'>sizeof</span></span></span> expression or cast expression may define a new type<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>For example,
<span class='codeblock'>p <span class='operator'>=</span> <span class='parenthesis'>(</span><span class='keyword'>void</span><span class='operator'>*</span><span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='keyword'>struct</span> x <span class='curlybracket'>{</span><span class='keyword'>int</span> i;<span class='curlybracket'>}</span> <span class='operator'>*</span><span class='parenthesis'>)</span><span class='literal'>0</span>;
</span>
defines a new type, struct <span class='texttt'>x</span><a class='hidden_link' href='#3.sentence-3'>.</a></div> <br/> <div id='3.sentence-4' class='sentence'><b>Rationale:</b> This prohibition helps to clarify the location of
definitions in the source code<a class='hidden_link' href='#3.sentence-4'>.</a></div> <br/> <div id='3.sentence-5' class='sentence'><b>Effect on original feature:</b> Deletion of semantically well-defined feature<a class='hidden_link' href='#3.sentence-5'>.</a></div> <br/> <div id='3.sentence-6' class='sentence'><b>Difficulty of converting:</b> Syntactic transformation<a class='hidden_link' href='#3.sentence-6'>.</a></div> <br/> <div id='3.sentence-7' class='sentence'><b>How widely used:</b> Seldom<a class='hidden_link' href='#3.sentence-7'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='http://github.com/timsong-cpp/draft/tree/dbd2450ef21216a8eff8e7c454db6c4e1683bbf5/source/compatibility.tex#L2446'>#</a></div><div class='texpara'><b>Affected subclauses:</b> <a href='expr.cond'>[expr.<span class='shy'></span>cond]</a>, <a href='expr.ass'>[expr.<span class='shy'></span>ass]</a>, and <a href='expr.comma'>[expr.<span class='shy'></span>comma]</a>
<a class='index' id=':conversion,lvalue-to-rvalue'></a><a class='index' id=':rvalue,lvalue_conversion_to'></a><a class='index' id=':lvalue'></a><br/> <div id='4.sentence-1' class='sentence'><b>Change:</b> The result of a conditional expression, an assignment expression, or a comma expression may be an lvalue<a class='hidden_link' href='#4.sentence-1'>.</a></div> <br/> <div id='4.sentence-2' class='sentence'><b>Rationale:</b> C++ is an object-oriented language, placing relatively
more emphasis on lvalues<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>For example, function calls may
yield lvalues<a class='hidden_link' href='#4.sentence-3'>.</a></div> <br/> <div id='4.sentence-4' class='sentence'><b>Effect on original feature:</b> Change to semantics of well-defined feature<a class='hidden_link' href='#4.sentence-4'>.</a></div> <div id='4.sentence-5' class='sentence'>Some C
expressions that implicitly rely on lvalue-to-rvalue
conversions will yield different results<a class='hidden_link' href='#4.sentence-5'>.</a></div> <div id='4.sentence-6' class='sentence'>For example,
<span class='codeblock'><span class='keyword'>char</span> arr<span class='squarebracket'>[</span><span class='literal'>100</span><span class='squarebracket'>]</span>;
<span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='literal'>0</span>, arr<span class='parenthesis'>)</span>
</span>
yields
<span class='texttt'><span class='literal'>100</span></span>
in C++ and
<span class='texttt'><span class='keyword'>sizeof</span><span class='parenthesis'>(</span><span class='keyword'>char</span><span class='operator'>*</span><span class='parenthesis'>)</span></span>
in C<a class='hidden_link' href='#4.sentence-6'>.</a><br/></div> <div id='4.sentence-7' class='sentence'><b>Difficulty of converting:</b> Programs must add explicit casts to the appropriate rvalue<a class='hidden_link' href='#4.sentence-7'>.</a></div> <br/> <div id='4.sentence-8' class='sentence'><b>How widely used:</b> Rare<a class='hidden_link' href='#4.sentence-8'>.</a></div></div></div></div></body></html>