<!DOCTYPE html><html lang='en'><head><title>[algorithms.parallel.exec]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>27</a> Algorithms library <a class='abbr_ref' href='./#algorithms'>[algorithms]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>27.3</a> Parallel algorithms <a class='abbr_ref' href='algorithms.parallel#exec'>[algorithms.parallel]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>27.3.3</a> Effect of execution policies on algorithm execution <a class='abbr_ref'>[algorithms.parallel.exec]</a></h3><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L383'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>Parallel algorithms have
template parameters named <span class='texttt'>ExecutionPolicy</span> (<a href='execpol' title='22.12&emsp;Execution policies'>[execpol]</a>)
which describe the manner in which the execution of these algorithms may be
parallelized and the manner in which they apply the element access functions<a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L389'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>If an object is modified by an element access function,
the algorithm will perform no other unsynchronized accesses to that object<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>The modifying element access functions are those
which are specified as modifying the object<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='2.sentence-3' class='sentence'>For example,
<span class='texttt'>swap</span>,
<span class='texttt'><span class='operator'>+</span><span class='operator'>+</span></span>,
<span class='texttt'><span class='operator'>-</span><span class='operator'>-</span></span>,
<span class='texttt'>@<span class='operator'>=</span></span>, and
assignments
modify the object<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>For the assignment and <span class='texttt'>@<span class='operator'>=</span></span> operators, only the left argument is modified<a class='hidden_link' href='#2.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L405'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Unless otherwise stated, implementations may make arbitrary copies of elements
(with type <span class='texttt'>T</span>) from sequences
where <span class='texttt'>is_<span class='shy'></span>trivially_<span class='shy'></span>copy_<span class='shy'></span>constructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span>
and <span class='texttt'>is_<span class='shy'></span>trivially_<span class='shy'></span>destructible_<span class='shy'></span>v<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> are <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>:&ensp;<div id='3.sentence-2' class='sentence'>This implies that user-supplied function objects cannot rely on
object identity of arguments for such input sequences<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>If object identity of the arguments to these function objects
is important, a wrapping iterator
that returns a non-copied implementation object
such as <span class='texttt'>reference_<span class='shy'></span>wrapper<span class='anglebracket'>&lt;</span>T<span class='anglebracket'>&gt;</span></span> (<a href='refwrap' title='22.10.6&emsp;Class template reference_&shy;wrapper'>[refwrap]</a>),
or some equivalent solution, can be used<a class='hidden_link' href='#3.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L420'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>sequenced_<span class='shy'></span>policy</span> all occur
in the calling thread of execution<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>:&ensp;<div id='4.sentence-2' class='sentence'>The invocations are not interleaved; see <a href='intro.execution' title='6.9.1&emsp;Sequential execution'>[intro.<span class='shy'></span>execution]</a><a class='hidden_link' href='#4.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L428'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_<span class='shy'></span>policy</span>
are permitted to execute in an unordered fashion
in the calling thread of execution,
unsequenced with respect to one another in the calling thread of execution<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>:&ensp;<div id='5.sentence-2' class='sentence'>This means that multiple function object invocations
can be interleaved on a single thread of execution,
which overrides the usual guarantee from <a href='intro.execution' title='6.9.1&emsp;Sequential execution'>[intro.<span class='shy'></span>execution]</a>
that function executions do not overlap with one another<a class='hidden_link' href='#5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='5.sentence-3' class='sentence'>
The behavior of a program is undefined if
it invokes a vectorization-unsafe standard library function
from user code
called from an <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_<span class='shy'></span>policy</span> algorithm<a class='hidden_link' href='#5.sentence-3'>.</a></div> <div id='note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-5'>5</a></i>:&ensp;<div id='5.sentence-4' class='sentence'>Because <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_<span class='shy'></span>policy</span> allows
the execution of element access functions
to be interleaved on a single thread of execution,
blocking synchronization, including the use of mutexes, risks deadlock<a class='hidden_link' href='#5.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L451'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>policy</span>
are permitted to execute either
in the invoking thread of execution or
in a thread of execution implicitly created by the library
to support parallel algorithm execution<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>If the threads of execution created by <span class='texttt'>thread</span> (<a href='thread.thread.class' title='33.4.3&emsp;Class thread'>[thread.<span class='shy'></span>thread.<span class='shy'></span>class]</a>)
or <span class='texttt'>jthread</span> (<a href='thread.jthread.class' title='33.4.4&emsp;Class jthread'>[thread.<span class='shy'></span>jthread.<span class='shy'></span>class]</a>)
provide concurrent forward progress guarantees (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>),
then a thread of execution implicitly created by the library will provide
parallel forward progress guarantees;
otherwise, the provided forward progress guarantee is
<a class='index' id=':forward_progress_guarantees_for_implicit_threads_of_parallel_algorithms_(if_not_defined_for_thread)'></a>implementation-defined<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='6.sentence-3' class='sentence'>Any such invocations executing in the same thread of execution
are indeterminately sequenced with respect to each other<a class='hidden_link' href='#6.sentence-3'>.</a></div> <div id='note-6' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-6'>6</a></i>:&ensp;<div id='6.sentence-4' class='sentence'>It is the caller's responsibility to ensure
that the invocation does not introduce data races or deadlocks<a class='hidden_link' href='#6.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>0</span>,<span class='literal'>1</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>vector<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> v;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span> i<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  v<span class='operator'>.</span>push_back<span class='parenthesis'>(</span>i<span class='operator'>*</span><span class='literal'>2</span><span class='operator'>+</span><span class='literal'>1</span><span class='parenthesis'>)</span>;                   <span class='comment'>// incorrect: data race</span>
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span> <div id='6.sentence-5' class='sentence'>
The program above has a data race because of the unsynchronized access to the
container <span class='texttt'>v</span><a class='hidden_link' href='#6.sentence-5'>.</a></div> —&nbsp;<i>end example</i>]</div></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>:&ensp;<span class='codeblock'>std<span class='operator'>::</span>atomic<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> x<span class='curlybracket'>{</span><span class='literal'>0</span><span class='curlybracket'>}</span>;
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>1</span>,<span class='literal'>2</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  x<span class='operator'>.</span>fetch_add<span class='parenthesis'>(</span><span class='literal'>1</span>, std<span class='operator'>::</span>memory_order<span class='operator'>::</span>relaxed<span class='parenthesis'>)</span>;
  <span class='comment'>// spin wait for another iteration to change the value of <span class='tcode_in_codeblock'>x</span></span>
  <span class='keyword'>while</span> <span class='parenthesis'>(</span>x<span class='operator'>.</span>load<span class='parenthesis'>(</span>std<span class='operator'>::</span>memory_order<span class='operator'>::</span>relaxed<span class='parenthesis'>)</span> <span class='operator'>=</span><span class='operator'>=</span> <span class='literal'>1</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>           <span class='comment'>// incorrect: assumes execution order</span>
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span> <div id='6.sentence-6' class='sentence'>
The above example depends on the order of execution of the iterations, and
will not terminate if both iterations are executed sequentially
on the same thread of execution<a class='hidden_link' href='#6.sentence-6'>.</a></div> —&nbsp;<i>end example</i>]</div></div> <div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>:&ensp;<span class='codeblock'><span class='keyword'>int</span> x <span class='operator'>=</span> <span class='literal'>0</span>;
std<span class='operator'>::</span>mutex m;
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span><span class='literal'>1</span>,<span class='literal'>2</span><span class='curlybracket'>}</span>;
std<span class='operator'>::</span>for_each<span class='parenthesis'>(</span>std<span class='operator'>::</span>execution<span class='operator'>::</span>par, std<span class='operator'>::</span>begin<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, std<span class='operator'>::</span>end<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, <span class='squarebracket'>[</span><span class='operator'>&amp;</span><span class='squarebracket'>]</span><span class='parenthesis'>(</span><span class='keyword'>int</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  std<span class='operator'>::</span>lock_guard<span class='anglebracket'>&lt;</span>mutex<span class='anglebracket'>&gt;</span> guard<span class='parenthesis'>(</span>m<span class='parenthesis'>)</span>;
  <span class='operator'>+</span><span class='operator'>+</span>x;
<span class='curlybracket'>}</span><span class='parenthesis'>)</span>;
</span> <div id='6.sentence-7' class='sentence'>
The above example synchronizes access to object <span class='texttt'>x</span>
ensuring that it is incremented correctly<a class='hidden_link' href='#6.sentence-7'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L511'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'>The invocations of element access functions in parallel algorithms invoked with
an execution policy object of type <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>unsequenced_<span class='shy'></span>policy</span> are
permitted to execute
in an unordered fashion in unspecified threads of execution, and
unsequenced with respect to one another within each thread of execution<a class='hidden_link' href='#7.sentence-1'>.</a></div> <div id='7.sentence-2' class='sentence'>These threads of execution are
either the invoking thread of execution
or threads of execution implicitly created by the library;
the latter will provide weakly parallel forward progress guarantees<a class='hidden_link' href='#7.sentence-2'>.</a></div> <div id='note-7' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-7'>7</a></i>:&ensp;<div id='7.sentence-3' class='sentence'>This means that multiple function object invocations can be interleaved
on a single thread of execution,
which overrides the usual guarantee from <a href='intro.execution' title='6.9.1&emsp;Sequential execution'>[intro.<span class='shy'></span>execution]</a>
that function executions do not overlap with one another<a class='hidden_link' href='#7.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='7.sentence-4' class='sentence'>
The behavior of a program is undefined if
it invokes a vectorization-unsafe standard library function
from user code
called from an <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>unsequenced_<span class='shy'></span>policy</span> algorithm<a class='hidden_link' href='#7.sentence-4'>.</a></div> <div id='note-8' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-8'>8</a></i>:&ensp;<div id='7.sentence-5' class='sentence'>Because <span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>unsequenced_<span class='shy'></span>policy</span> allows
the execution of element access functions
to be interleaved on a single thread of execution,
blocking synchronization, including the use of mutexes, risks deadlock<a class='hidden_link' href='#7.sentence-5'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L538'>#</a></div><div class='texpara'><div id='note-9' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-9'>9</a></i>:&ensp;<div id='8.sentence-1' class='sentence'>The semantics of invocation with
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>unsequenced_<span class='shy'></span>policy</span>,
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>policy</span>, or
<span class='texttt'>execution<span class='operator'>&#x200b;::&#x200b;</span>parallel_<span class='shy'></span>unsequenced_<span class='shy'></span>policy</span>
allow the implementation to fall back to sequential execution
if the system cannot parallelize an algorithm invocation,
e.g., due to lack of resources<a class='hidden_link' href='#8.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L549'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'>If an invocation of a parallel algorithm uses threads of execution
implicitly created by the library,
then the invoking thread of execution will either
<ul class='itemize'><li id='9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.1'>(9.1)</a></div>temporarily block
  with forward progress guarantee delegation (<a href='intro.progress' title='6.9.2.3&emsp;Forward progress'>[intro.<span class='shy'></span>progress]</a>)
  on the completion of these library-managed threads of execution, or</li><li id='9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.2'>(9.2)</a></div>eventually execute an element access function;</li></ul>
the thread of execution will continue to do so until the algorithm is finished<a class='hidden_link' href='#9.sentence-1'>.</a></div> <div id='note-10' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-10'>10</a></i>:&ensp;<div id='9.sentence-2' class='sentence'>In blocking with forward progress guarantee delegation in this context,
a thread of execution created by the library
is considered to have finished execution
as soon as it has finished the execution
of the particular element access function
that the invoking thread of execution logically depends on<a class='hidden_link' href='#9.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/12b6307589257a803527eb38c43f08f867d59322/source/algorithms.tex#L571'>#</a></div><div class='texpara'><div id='10.sentence-1' class='sentence'>The semantics of parallel algorithms invoked with an execution policy object of
<a class='index' id=':additional_execution_policies_supported_by_parallel_algorithms'></a>implementation-defined type
are <a class='index' id=':semantics_of_parallel_algorithms_invoked_with_implementation-defined_execution_policies'></a>implementation-defined<a class='hidden_link' href='#10.sentence-1'>.</a></div></div></div></div></body></html>