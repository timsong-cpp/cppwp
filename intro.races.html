<!DOCTYPE html><html lang='en'><head><title>[intro.races]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>6</a> Basics <a class='abbr_ref' href='./#basic'>[basic]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>6.9</a> Program execution <a class='abbr_ref' href='basic.exec#intro.races'>[basic.exec]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>6.9.2</a> Multi-threaded executions and data races <a class='abbr_ref' href='intro.multithread#intro.races'>[intro.multithread]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>6.9.2.2</a> Data races <a class='abbr_ref'>[intro.races]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6213'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>The value of an object visible to a thread <span class='math'><span class='mathalpha'>T</span></span> at a particular point is the
initial value of the object, a value assigned to the object by <span class='math'><span class='mathalpha'>T</span></span>, or a
value assigned to the object by another thread, according to the rules below<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='1.sentence-2' class='sentence'>In some cases, there might instead be undefined behavior<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>Much of this
subclause is motivated by the desire to support atomic operations with explicit
and detailed visibility constraints<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>However, it also implicitly supports a
simpler view for more restricted programs<a class='hidden_link' href='#1.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6224'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>Two expression evaluations <a class='hidden_link' href='#def:conflict' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:conflict'><i >conflict</i></span></a> if one of them
<ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.1'>(2.1)</a></div>modifies (<a href='defns.access' title='3.1&emsp;access'>[defns.<span class='shy'></span>access]</a>) a memory location (<a href='intro.memory' title='6.7.1&emsp;Memory model'>[intro.<span class='shy'></span>memory]</a>) or</li><li id='2.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.2'>(2.2)</a></div>starts or ends the lifetime of an object in a memory location</li></ul>
and the other one
<ul class='itemize'><li id='2.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.3'>(2.3)</a></div>reads or modifies the same memory location or</li><li id='2.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#2.4'>(2.4)</a></div>starts or ends the lifetime of an object occupying storage that
overlaps with the memory location<a class='hidden_link' href='#2.sentence-1'>.</a></li></ul></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>:&ensp;<div id='2.sentence-2' class='sentence'>A modification can still conflict
even if it does not alter the value of any bits<a class='hidden_link' href='#2.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6245'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>The library defines a number of atomic operations (<a href='atomics' title='32.5&emsp;Atomic operations'>[atomics]</a>) and
operations on mutexes (<a href='thread' title='32&emsp;Concurrency support library'>[thread]</a>) that are specially identified as
synchronization operations<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>These operations play a special role in making
assignments in one thread visible to another<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='3.sentence-3' class='sentence'>A synchronization operation on one
or more memory locations is either a consume operation, an acquire operation, a
release operation, or both an acquire and release operation<a class='hidden_link' href='#3.sentence-3'>.</a></div> <div id='3.sentence-4' class='sentence'>A synchronization
operation without an associated memory location is a fence and can be either an
acquire fence, a release fence, or both an acquire and release fence<a class='hidden_link' href='#3.sentence-4'>.</a></div> <div id='3.sentence-5' class='sentence'>In
addition, there are relaxed atomic operations, which are not synchronization
operations, and atomic read-modify-write operations, which have special
characteristics<a class='hidden_link' href='#3.sentence-5'>.</a></div> <div id='note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-3'>3</a></i>:&ensp;<div id='3.sentence-6' class='sentence'>For example, a call that acquires a mutex will
perform an acquire operation on the locations comprising the mutex<a class='hidden_link' href='#3.sentence-6'>.</a></div> <div id='3.sentence-7' class='sentence'>Correspondingly, a call that releases the same mutex will perform a release
operation on those same locations<a class='hidden_link' href='#3.sentence-7'>.</a></div> <div id='3.sentence-8' class='sentence'>Informally, performing a release operation on
<span class='math'><span class='mathalpha'>A</span></span> forces prior
<a class='index' id=':side_effects'></a>side effects on other memory locations to become visible
to other threads that later perform a consume or an acquire operation on
<span class='math'><span class='mathalpha'>A</span></span><a class='hidden_link' href='#3.sentence-8'>.</a></div> <div id='3.sentence-9' class='sentence'>“Relaxed” atomic operations are not synchronization operations even
though, like synchronization operations, they cannot contribute to data races<a class='hidden_link' href='#3.sentence-9'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6270'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>All modifications to a particular atomic object <span class='math'><span class='mathalpha'>M</span></span> occur in some
particular total order, called the <a class='hidden_link' href='#def:modification_order' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:modification_order'><i >modification order</i></span></a> of <span class='math'><span class='mathalpha'>M</span></span><a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='note-4' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-4'>4</a></i>:&ensp;<div id='4.sentence-2' class='sentence'>There is a separate order for each
atomic object<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>There is no requirement that these can be combined into a single
total order for all objects<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'>In general this will be impossible since different
threads can observe modifications to different objects in inconsistent orders<a class='hidden_link' href='#4.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6280'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:release_sequence' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:release_sequence'><i >release sequence</i></span></a> headed
by a release operation <span class='math'><span class='mathalpha'>A</span></span> on an atomic object <span class='math'><span class='mathalpha'>M</span></span>
is a maximal contiguous sub-sequence of
<a class='index' id=':side_effects_'></a>side effects in the modification order of <span class='math'><span class='mathalpha'>M</span></span>,
where the first operation is <span class='math'><span class='mathalpha'>A</span></span>, and
every subsequent operation is an atomic read-modify-write operation<a class='hidden_link' href='#5.sentence-1'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6289'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>Certain library calls <a class='hidden_link' href='#def:synchronize_with' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:synchronize_with'><i >synchronize with</i></span></a> other library calls performed by
another thread<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>For example, an atomic store-release synchronizes with a
load-acquire that takes its value from the store (<a href='atomics.order' title='32.5.4&emsp;Order and consistency'>[atomics.<span class='shy'></span>order]</a>)<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='note-5' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-5'>5</a></i>:&ensp;<div id='6.sentence-3' class='sentence'>Except in the specified cases, reading a later value does not
necessarily ensure visibility as described below<a class='hidden_link' href='#6.sentence-3'>.</a></div> <div id='6.sentence-4' class='sentence'>Such a requirement would
sometimes interfere with efficient implementation<a class='hidden_link' href='#6.sentence-4'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='note-6' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-6'>6</a></i>:&ensp;<div id='6.sentence-5' class='sentence'>The
specifications of the synchronization operations define when one reads the value
written by another<a class='hidden_link' href='#6.sentence-5'>.</a></div> <div id='6.sentence-6' class='sentence'>For atomic objects, the definition is clear<a class='hidden_link' href='#6.sentence-6'>.</a></div> <div id='6.sentence-7' class='sentence'>All operations
on a given mutex occur in a single total order<a class='hidden_link' href='#6.sentence-7'>.</a></div> <div id='6.sentence-8' class='sentence'>Each mutex acquisition “reads
the value written” by the last mutex release<a class='hidden_link' href='#6.sentence-8'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6306'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> <a class='hidden_link' href='#def:carries_a_dependency' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:carries_a_dependency'><i >carries a dependency</i></span></a> to an evaluation <span class='math'><span class='mathalpha'>B</span></span> if
<ul class='itemize'><li id='7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.1'>(7.1)</a></div>the value of <span class='math'><span class='mathalpha'>A</span></span> is used as an operand of <span class='math'><span class='mathalpha'>B</span></span>, unless:
<ul class='itemize'><li id='7.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#7.1.1'>(7.1.1)</a></div><span class='math'><span class='mathalpha'>B</span></span> is an invocation of any specialization of
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>kill_<span class='shy'></span>dependency</span> (<a href='atomics.order' title='32.5.4&emsp;Order and consistency'>[atomics.<span class='shy'></span>order]</a>), or</li><li id='7.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#7.1.2'>(7.1.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> is the left operand of a built-in logical <span class='textsc'>and</span> (<span class='texttt'><span class='operator'>&amp;</span><span class='operator'>&amp;</span></span>,
see <a href='expr.log.and' title='7.6.14&emsp;Logical AND operator'>[expr.<span class='shy'></span>log.<span class='shy'></span>and]</a>) or logical <span class='textsc'>or</span> (<span class='texttt'><span class='operator'>|</span><span class='operator'>|</span></span>, see <a href='expr.log.or' title='7.6.15&emsp;Logical OR operator'>[expr.<span class='shy'></span>log.<span class='shy'></span>or]</a>)
operator, or</li><li id='7.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#7.1.3'>(7.1.3)</a></div><span class='math'><span class='mathalpha'>A</span></span> is the left operand of a conditional (<span class='texttt'><span class='operator'>?</span><span class='operator'>:</span></span>, see <a href='expr.cond' title='7.6.16&emsp;Conditional operator'>[expr.<span class='shy'></span>cond]</a>)
operator, or</li><li id='7.1.4'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#7.1.4'>(7.1.4)</a></div><span class='math'><span class='mathalpha'>A</span></span> is the left operand of the built-in comma (<span class='texttt'>,</span>)
operator (<a href='expr.comma' title='7.6.20&emsp;Comma operator'>[expr.<span class='shy'></span>comma]</a>);</li></ul> or</li><li id='7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.2'>(7.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> writes a scalar object or bit-field <span class='math'><span class='mathalpha'>M</span></span>, <span class='math'><span class='mathalpha'>B</span></span> reads the value
written by <span class='math'><span class='mathalpha'>A</span></span> from <span class='math'><span class='mathalpha'>M</span></span>, and <span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='7.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#7.3'>(7.3)</a></div>for some evaluation <span class='math'><span class='mathalpha'>X</span></span>, <span class='math'><span class='mathalpha'>A</span></span> carries a dependency to <span class='math'><span class='mathalpha'>X</span></span>, and
<span class='math'><span class='mathalpha'>X</span></span> carries a dependency to <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#7.sentence-1'>.</a></li></ul></div> <div id='note-7' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-7'>7</a></i>:&ensp;<div id='7.sentence-2' class='sentence'>“Carries a dependency to” is a subset of “is sequenced before”,
and is similarly strictly intra-thread<a class='hidden_link' href='#7.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6337'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> is <a class='hidden_link' href='#def:dependency-ordered_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:dependency-ordered_before'><i >dependency-ordered before</i></span></a> an evaluation
<span class='math'><span class='mathalpha'>B</span></span> if
<ul class='itemize'><li id='8.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#8.1'>(8.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> performs a release operation on an atomic object <span class='math'><span class='mathalpha'>M</span></span>, and, in
another thread, <span class='math'><span class='mathalpha'>B</span></span> performs a consume operation on <span class='math'><span class='mathalpha'>M</span></span> and reads
the value written by <span class='math'><span class='mathalpha'>A</span></span>, or</li><li id='8.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#8.2'>(8.2)</a></div>for some evaluation <span class='math'><span class='mathalpha'>X</span></span>, <span class='math'><span class='mathalpha'>A</span></span> is dependency-ordered before <span class='math'><span class='mathalpha'>X</span></span> and
<span class='math'><span class='mathalpha'>X</span></span> carries a dependency to <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#8.sentence-1'>.</a></li></ul></div> <div id='note-8' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-8'>8</a></i>:&ensp;<div id='8.sentence-2' class='sentence'>The relation “is dependency-ordered before” is analogous to
“synchronizes with”, but uses release/consume in place of release/acquire<a class='hidden_link' href='#8.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6355'>#</a></div><div class='texpara'><div id='9.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> <a class='hidden_link' href='#def:inter-thread_happens_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:inter-thread_happens_before'><i >inter-thread happens before</i></span></a> an evaluation <span class='math'><span class='mathalpha'>B</span></span>
if
<ul class='itemize'><li id='9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.1'>(9.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> synchronizes with <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.2'>(9.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> is dependency-ordered before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.3'>(9.3)</a></div>for some evaluation <span class='math'><span class='mathalpha'>X</span></span>
  <ul class='itemize'><li id='9.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#9.3.1'>(9.3.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> synchronizes with <span class='math'><span class='mathalpha'>X</span></span> and <span class='math'><span class='mathalpha'>X</span></span>
    is sequenced before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='9.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#9.3.2'>(9.3.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>X</span></span> and <span class='math'><span class='mathalpha'>X</span></span>
    inter-thread happens before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='9.3.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#9.3.3'>(9.3.3)</a></div><span class='math'><span class='mathalpha'>A</span></span> inter-thread happens before <span class='math'><span class='mathalpha'>X</span></span> and <span class='math'><span class='mathalpha'>X</span></span>
    inter-thread happens before <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#9.sentence-1'>.</a></li></ul></li></ul></div> <div id='note-9' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-9'>9</a></i>:&ensp;<div id='9.sentence-2' class='sentence'>The “inter-thread happens before” relation describes arbitrary
concatenations of “sequenced before”, “synchronizes with” and
“dependency-ordered before” relationships, with two exceptions<a class='hidden_link' href='#9.sentence-2'>.</a></div> <div id='9.sentence-3' class='sentence'>The first
exception is that a concatenation never ends with
“dependency-ordered before” followed by “sequenced before”<a class='hidden_link' href='#9.sentence-3'>.</a></div> <div id='9.sentence-4' class='sentence'>The reason for
this limitation is that a consume operation participating in a
“dependency-ordered before” relationship provides ordering only with respect
to operations to which this consume operation actually carries a dependency<a class='hidden_link' href='#9.sentence-4'>.</a></div> <div id='9.sentence-5' class='sentence'>The
reason that this limitation applies only to the end of such a concatenation is
that any subsequent release operation will provide the required ordering for a
prior consume operation<a class='hidden_link' href='#9.sentence-5'>.</a></div> <div id='9.sentence-6' class='sentence'>The second exception is that a concatenation never
consist entirely of “sequenced before”<a class='hidden_link' href='#9.sentence-6'>.</a></div> <div id='9.sentence-7' class='sentence'>The reasons for this
limitation are (1) to permit “inter-thread happens before” to be transitively
closed and (2) the “happens before” relation, defined below, provides for
relationships consisting entirely of “sequenced before”<a class='hidden_link' href='#9.sentence-7'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='10'><div class='marginalizedparent'><a class='marginalized' href='#10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6395'>#</a></div><div class='texpara'><div id='10.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> <a class='hidden_link' href='#def:happens_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:happens_before'><i >happens before</i></span></a> an evaluation <span class='math'><span class='mathalpha'>B</span></span>
(or, equivalently, <span class='math'><span class='mathalpha'>B</span></span> <a class='hidden_link' href='#def:happens_after' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:happens_after'><i >happens after</i></span></a> <span class='math'><span class='mathalpha'>A</span></span>) if
<ul class='itemize'><li id='10.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#10.1'>(10.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='10.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#10.2'>(10.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> inter-thread happens before <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#10.sentence-1'>.</a></li></ul></div> <div id='10.sentence-2' class='sentence'>
The implementation shall ensure that no program execution demonstrates a cycle
in the “happens before” relation<a class='hidden_link' href='#10.sentence-2'>.</a></div> <div id='note-10' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-10'>10</a></i>:&ensp;<div id='10.sentence-3' class='sentence'>This cycle would otherwise be
possible only through the use of consume operations<a class='hidden_link' href='#10.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='11'><div class='marginalizedparent'><a class='marginalized' href='#11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6409'>#</a></div><div class='texpara'><div id='11.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> <a class='hidden_link' href='#def:simply_happens_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:simply_happens_before'><i >simply happens before</i></span></a> an evaluation <span class='math'><span class='mathalpha'>B</span></span>
if either
<ul class='itemize'><li id='11.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#11.1'>(11.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='11.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#11.2'>(11.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> synchronizes with <span class='math'><span class='mathalpha'>B</span></span>, or</li><li id='11.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#11.3'>(11.3)</a></div><span class='math'><span class='mathalpha'>A</span></span> simply happens before <span class='math'><span class='mathalpha'>X</span></span> and
<span class='math'><span class='mathalpha'>X</span></span> simply happens before <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#11.sentence-1'>.</a></li></ul></div> <div id='note-11' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-11'>11</a></i>:&ensp;<div id='11.sentence-2' class='sentence'>In the absence of consume operations,
the happens before and simply happens before relations are identical<a class='hidden_link' href='#11.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='12'><div class='marginalizedparent'><a class='marginalized' href='#12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6423'>#</a></div><div class='texpara'><div id='12.sentence-1' class='sentence'>An evaluation <span class='math'><span class='mathalpha'>A</span></span> <a class='hidden_link' href='#def:strongly_happens_before' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:strongly_happens_before'><i >strongly happens before</i></span></a>
an evaluation <span class='math'><span class='mathalpha'>D</span></span> if, either
<ul class='itemize'><li id='12.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#12.1'>(12.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>D</span></span>, or</li><li id='12.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#12.2'>(12.2)</a></div><span class='math'><span class='mathalpha'>A</span></span> synchronizes with <span class='math'><span class='mathalpha'>D</span></span>, and
both <span class='math'><span class='mathalpha'>A</span></span> and <span class='math'><span class='mathalpha'>D</span></span> are
sequentially consistent atomic operations (<a href='atomics.order' title='32.5.4&emsp;Order and consistency'>[atomics.<span class='shy'></span>order]</a>), or</li><li id='12.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#12.3'>(12.3)</a></div>there are evaluations <span class='math'><span class='mathalpha'>B</span></span> and <span class='math'><span class='mathalpha'>C</span></span>
such that <span class='math'><span class='mathalpha'>A</span></span> is sequenced before <span class='math'><span class='mathalpha'>B</span></span>,
<span class='math'><span class='mathalpha'>B</span></span> simply happens before <span class='math'><span class='mathalpha'>C</span></span>, and
<span class='math'><span class='mathalpha'>C</span></span> is sequenced before <span class='math'><span class='mathalpha'>D</span></span>, or</li><li id='12.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#12.4'>(12.4)</a></div>there is an evaluation <span class='math'><span class='mathalpha'>B</span></span> such that
<span class='math'><span class='mathalpha'>A</span></span> strongly happens before <span class='math'><span class='mathalpha'>B</span></span>, and
<span class='math'><span class='mathalpha'>B</span></span> strongly happens before <span class='math'><span class='mathalpha'>D</span></span><a class='hidden_link' href='#12.sentence-1'>.</a></li></ul></div> <div id='note-12' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-12'>12</a></i>:&ensp;<div id='12.sentence-2' class='sentence'>Informally, if <span class='math'><span class='mathalpha'>A</span></span> strongly happens before <span class='math'><span class='mathalpha'>B</span></span>,
then <span class='math'><span class='mathalpha'>A</span></span> appears to be evaluated before <span class='math'><span class='mathalpha'>B</span></span>
in all contexts<a class='hidden_link' href='#12.sentence-2'>.</a></div> <div id='12.sentence-3' class='sentence'>Strongly happens before excludes consume operations<a class='hidden_link' href='#12.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='13'><div class='marginalizedparent'><a class='marginalized' href='#13'>13</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6445'>#</a></div><div class='texpara'><div id='13.sentence-1' class='sentence'>A <a class='hidden_link' href='#def:side_effects,visible' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:side_effects,visible'><i >visible side effect</i></span></a> <span class='math'><span class='mathalpha'>A</span></span> on a scalar object or bit-field <span class='math'><span class='mathalpha'>M</span></span>
with respect to a value computation <span class='math'><span class='mathalpha'>B</span></span> of <span class='math'><span class='mathalpha'>M</span></span> satisfies the
conditions:
<ul class='itemize'><li id='13.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#13.1'>(13.1)</a></div><span class='math'><span class='mathalpha'>A</span></span> happens before <span class='math'><span class='mathalpha'>B</span></span> and</li><li id='13.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#13.2'>(13.2)</a></div>there is no other
<a class='index' id=':side_effects__'></a>side effect <span class='math'><span class='mathalpha'>X</span></span> to <span class='math'><span class='mathalpha'>M</span></span> such that <span class='math'><span class='mathalpha'>A</span></span>
happens before <span class='math'><span class='mathalpha'>X</span></span> and <span class='math'><span class='mathalpha'>X</span></span> happens before <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#13.sentence-1'>.</a></li></ul></div></div><div class='texpara'><div id='13.sentence-2' class='sentence'>The value of a non-atomic scalar object or bit-field <span class='math'><span class='mathalpha'>M</span></span>, as determined by
evaluation <span class='math'><span class='mathalpha'>B</span></span>, is the value stored by the
<a class='index' id=':side_effects,visible'></a>visible side effect <span class='math'><span class='mathalpha'>A</span></span><a class='hidden_link' href='#13.sentence-2'>.</a></div> <div id='note-13' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-13'>13</a></i>:&ensp;<div id='13.sentence-3' class='sentence'>If there is ambiguity about which side effect to a
non-atomic object or bit-field is visible, then the behavior is either
unspecified or undefined<a class='hidden_link' href='#13.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='note-14' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-14'>14</a></i>:&ensp;<div id='13.sentence-4' class='sentence'>This states that operations on
ordinary objects are not visibly reordered<a class='hidden_link' href='#13.sentence-4'>.</a></div> <div id='13.sentence-5' class='sentence'>This is not actually detectable
without data races, but is needed to ensure that data races, as defined
below, and with suitable restrictions on the use of atomics, correspond to data
races in a simple interleaved (sequentially consistent) execution<a class='hidden_link' href='#13.sentence-5'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='14'><div class='marginalizedparent'><a class='marginalized' href='#14'>14</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6474'>#</a></div><div class='texpara'><div id='14.sentence-1' class='sentence'>The value of an
atomic object <span class='math'><span class='mathalpha'>M</span></span>, as determined by evaluation <span class='math'><span class='mathalpha'>B</span></span>, is the value
stored by some unspecified
side effect <span class='math'><span class='mathalpha'>A</span></span> that modifies <span class='math'><span class='mathalpha'>M</span></span>, where <span class='math'><span class='mathalpha'>B</span></span> does not happen
before <span class='math'><span class='mathalpha'>A</span></span><a class='hidden_link' href='#14.sentence-1'>.</a></div> <div id='note-15' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-15'>15</a></i>:&ensp;<div id='14.sentence-2' class='sentence'>The set of such side effects is also restricted by the rest of the rules
described here, and in particular, by the coherence requirements below<a class='hidden_link' href='#14.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='15'><div class='marginalizedparent'><a class='marginalized' href='#15'>15</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6485'>#</a></div><div class='texpara'><div id='15.sentence-1' class='sentence'><a class='index' id=':coherence,write-write'></a>If an operation <span class='math'><span class='mathalpha'>A</span></span> that modifies an atomic object <span class='math'><span class='mathalpha'>M</span></span> happens before
an operation <span class='math'><span class='mathalpha'>B</span></span> that modifies <span class='math'><span class='mathalpha'>M</span></span>, then <span class='math'><span class='mathalpha'>A</span></span> is earlier
than <span class='math'><span class='mathalpha'>B</span></span> in the modification order of <span class='math'><span class='mathalpha'>M</span></span><a class='hidden_link' href='#15.sentence-1'>.</a></div> <div id='note-16' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-16'>16</a></i>:&ensp;<div id='15.sentence-2' class='sentence'>This requirement is known as write-write coherence<a class='hidden_link' href='#15.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='16'><div class='marginalizedparent'><a class='marginalized' href='#16'>16</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6494'>#</a></div><div class='texpara'><div id='16.sentence-1' class='sentence'><a class='index' id=':coherence,read-read'></a>If a
<a class='index' id=':value_computation'></a>value computation <span class='math'><span class='mathalpha'>A</span></span> of an atomic object <span class='math'><span class='mathalpha'>M</span></span> happens before a
value computation <span class='math'><span class='mathalpha'>B</span></span> of <span class='math'><span class='mathalpha'>M</span></span>, and <span class='math'><span class='mathalpha'>A</span></span> takes its value from a side
effect <span class='math'><span class='mathalpha'>X</span></span> on <span class='math'><span class='mathalpha'>M</span></span>, then the value computed by <span class='math'><span class='mathalpha'>B</span></span> is either
the value stored by <span class='math'><span class='mathalpha'>X</span></span> or the value stored by a
<a class='index' id=':side_effects___'></a>side effect <span class='math'><span class='mathalpha'>Y</span></span> on <span class='math'><span class='mathalpha'>M</span></span>,
where <span class='math'><span class='mathalpha'>Y</span></span> follows <span class='math'><span class='mathalpha'>X</span></span> in the modification order of <span class='math'><span class='mathalpha'>M</span></span><a class='hidden_link' href='#16.sentence-1'>.</a></div> <div id='note-17' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-17'>17</a></i>:&ensp;<div id='16.sentence-2' class='sentence'>This requirement is known as read-read coherence<a class='hidden_link' href='#16.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='17'><div class='marginalizedparent'><a class='marginalized' href='#17'>17</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6509'>#</a></div><div class='texpara'><div id='17.sentence-1' class='sentence'><a class='index' id=':coherence,read-write'></a>If a
<a class='index' id=':value_computation_'></a>value computation <span class='math'><span class='mathalpha'>A</span></span> of an atomic object <span class='math'><span class='mathalpha'>M</span></span> happens before an
operation <span class='math'><span class='mathalpha'>B</span></span> that modifies <span class='math'><span class='mathalpha'>M</span></span>, then <span class='math'><span class='mathalpha'>A</span></span> takes its value from a side
effect <span class='math'><span class='mathalpha'>X</span></span> on <span class='math'><span class='mathalpha'>M</span></span>, where <span class='math'><span class='mathalpha'>X</span></span> precedes <span class='math'><span class='mathalpha'>B</span></span> in the
modification order of <span class='math'><span class='mathalpha'>M</span></span><a class='hidden_link' href='#17.sentence-1'>.</a></div> <div id='note-18' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-18'>18</a></i>:&ensp;<div id='17.sentence-2' class='sentence'>This requirement is known as
read-write coherence<a class='hidden_link' href='#17.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='18'><div class='marginalizedparent'><a class='marginalized' href='#18'>18</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6522'>#</a></div><div class='texpara'><div id='18.sentence-1' class='sentence'><a class='index' id=':coherence,write-read'></a>If a
<a class='index' id=':side_effects____'></a>side effect <span class='math'><span class='mathalpha'>X</span></span> on an atomic object <span class='math'><span class='mathalpha'>M</span></span> happens before a value
computation <span class='math'><span class='mathalpha'>B</span></span> of <span class='math'><span class='mathalpha'>M</span></span>, then the evaluation <span class='math'><span class='mathalpha'>B</span></span> takes its
value from <span class='math'><span class='mathalpha'>X</span></span> or from a
<a class='index' id=':side_effects_____'></a>side effect <span class='math'><span class='mathalpha'>Y</span></span> that follows <span class='math'><span class='mathalpha'>X</span></span> in the modification order of <span class='math'><span class='mathalpha'>M</span></span><a class='hidden_link' href='#18.sentence-1'>.</a></div> <div id='note-19' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-19'>19</a></i>:&ensp;<div id='18.sentence-2' class='sentence'>This requirement is known as write-read coherence<a class='hidden_link' href='#18.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='19'><div class='marginalizedparent'><a class='marginalized' href='#19'>19</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6535'>#</a></div><div class='texpara'><div id='note-20' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-20'>20</a></i>:&ensp;<div id='19.sentence-1' class='sentence'>The four preceding coherence requirements effectively disallow
compiler reordering of atomic operations to a single object, even if both
operations are relaxed loads<a class='hidden_link' href='#19.sentence-1'>.</a></div> <div id='19.sentence-2' class='sentence'>This effectively makes the cache coherence
guarantee provided by most hardware available to C++ atomic operations<a class='hidden_link' href='#19.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='20'><div class='marginalizedparent'><a class='marginalized' href='#20'>20</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6543'>#</a></div><div class='texpara'><div id='note-21' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-21'>21</a></i>:&ensp;<div id='20.sentence-1' class='sentence'>The value observed by a load of an atomic depends on the “happens
before” relation, which depends on the values observed by loads of atomics<a class='hidden_link' href='#20.sentence-1'>.</a></div> <div id='20.sentence-2' class='sentence'>The intended reading is that there must exist an
association of atomic loads with modifications they observe that, together with
suitably chosen modification orders and the “happens before” relation derived
as described above, satisfy the resulting constraints as imposed here<a class='hidden_link' href='#20.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='21'><div class='marginalizedparent'><a class='marginalized' href='#21'>21</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6553'>#</a></div><div class='texpara'><div id='21.sentence-1' class='sentence'>Two actions are <a class='hidden_link' href='#def:potentially_concurrent' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:potentially_concurrent'><i >potentially concurrent</i></span></a> if
<ul class='itemize'><li id='21.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#21.1'>(21.1)</a></div>they are performed by different threads, or</li><li id='21.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#21.2'>(21.2)</a></div>they are unsequenced, at least one is performed by a signal handler, and
they are not both performed by the same signal handler invocation<a class='hidden_link' href='#21.sentence-1'>.</a></li></ul></div> <div id='21.sentence-2' class='sentence'>
The execution of a program contains a <a class='hidden_link' href='#def:data_race' title='6.9.2.2&emsp;Data races&emsp;[intro.races]'><span id='def:data_race'><i >data race</i></span></a> if it contains two
potentially concurrent conflicting actions, at least one of which is not atomic,
and neither happens before the other,
except for the special case for signal handlers described below<a class='hidden_link' href='#21.sentence-2'>.</a></div> <div id='21.sentence-3' class='sentence'>Any such data race results in undefined
behavior<a class='hidden_link' href='#21.sentence-3'>.</a></div> <div id='note-22' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-22'>22</a></i>:&ensp;<div id='21.sentence-4' class='sentence'>It can be shown that programs that correctly use mutexes
and <span class='texttt'>memory_<span class='shy'></span>order<span class='operator'>&#x200b;::&#x200b;</span>seq_<span class='shy'></span>cst</span> operations to prevent all data races and use no
other synchronization operations behave as if the operations executed by their
constituent threads were simply interleaved, with each
<a class='index' id=':value_computation__'></a>value computation of an
object being taken from the last
<a class='index' id=':side_effects______'></a>side effect on that object in that
interleaving<a class='hidden_link' href='#21.sentence-4'>.</a></div> <div id='21.sentence-5' class='sentence'>This is normally referred to as “sequential consistency”<a class='hidden_link' href='#21.sentence-5'>.</a></div> <div id='21.sentence-6' class='sentence'>However, this applies only to data-race-free programs, and data-race-free
programs cannot observe most program transformations that do not change
single-threaded program semantics<a class='hidden_link' href='#21.sentence-6'>.</a></div> <div id='21.sentence-7' class='sentence'>In fact, most single-threaded program
transformations remain possible, since any program that behaves
differently as a result has undefined behavior<a class='hidden_link' href='#21.sentence-7'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='22'><div class='marginalizedparent'><a class='marginalized' href='#22'>22</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6584'>#</a></div><div class='texpara'><div id='22.sentence-1' class='sentence'>Two accesses to the same object of type <span class='texttt'><span id=':volatile'><span class='texttt'><span class='keyword'>volatile</span></span></span> std<span class='operator'>&#x200b;::&#x200b;</span>sig_<span class='shy'></span>atomic_<span class='shy'></span>t</span> do not
result in a data race if both occur in the same thread, even if one or more
occurs in a signal handler<a class='hidden_link' href='#22.sentence-1'>.</a></div> <div id='22.sentence-2' class='sentence'>For each signal handler invocation, evaluations
performed by the thread invoking a signal handler can be divided into two
groups <span class='math'><span class='mathalpha'>A</span></span> and <span class='math'><span class='mathalpha'>B</span></span>, such that no evaluations in
<span class='math'><span class='mathalpha'>B</span></span> happen before evaluations in <span class='math'><span class='mathalpha'>A</span></span>, and the
evaluations of such <span class='texttt'><span id=':volatile_'><span class='texttt'><span class='keyword'>volatile</span></span></span> std<span class='operator'>&#x200b;::&#x200b;</span>sig_<span class='shy'></span>atomic_<span class='shy'></span>t</span> objects take values as though
all evaluations in <span class='math'><span class='mathalpha'>A</span></span> happened before the execution of the signal
handler and the execution of the signal handler happened before all evaluations
in <span class='math'><span class='mathalpha'>B</span></span><a class='hidden_link' href='#22.sentence-2'>.</a></div></div></div><div class='para nonNormativeOnly' id='23'><div class='marginalizedparent'><a class='marginalized' href='#23'>23</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6596'>#</a></div><div class='texpara'><div id='note-23' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-23'>23</a></i>:&ensp;<div id='23.sentence-1' class='sentence'>Compiler transformations that introduce assignments to a potentially
shared memory location that would not be modified by the abstract machine are
generally precluded by this document, since such an assignment might overwrite
another assignment by a different thread in cases in which an abstract machine
execution would not have encountered a data race<a class='hidden_link' href='#23.sentence-1'>.</a></div> <div id='23.sentence-2' class='sentence'>This includes implementations
of data member assignment that overwrite adjacent members in separate memory
locations<a class='hidden_link' href='#23.sentence-2'>.</a></div> <div id='23.sentence-3' class='sentence'>Reordering of atomic loads in cases in which the atomics in question
might alias is also generally precluded, since this could violate the coherence
rules<a class='hidden_link' href='#23.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='24'><div class='marginalizedparent'><a class='marginalized' href='#24'>24</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/basic.tex#L6609'>#</a></div><div class='texpara'><div id='note-24' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-24'>24</a></i>:&ensp;<div id='24.sentence-1' class='sentence'>It is possible that transformations that introduce a speculative read of a potentially
shared memory location do not preserve the semantics of the C++ program as
defined in this document, since they potentially introduce a data race<a class='hidden_link' href='#24.sentence-1'>.</a></div> <div id='24.sentence-2' class='sentence'>However,
they are typically valid in the context of an optimizing compiler that targets a
specific machine with well-defined semantics for data races<a class='hidden_link' href='#24.sentence-2'>.</a></div> <div id='24.sentence-3' class='sentence'>They would be
invalid for a hypothetical machine that is not tolerant of races or provides
hardware race detection<a class='hidden_link' href='#24.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></body></html>