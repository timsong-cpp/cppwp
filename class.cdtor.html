<!DOCTYPE html><html lang='en'><head><title>[class.cdtor]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>11</a> Classes <a class='abbr_ref' href='./#class'>[class]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>11.9</a> Initialization <a class='abbr_ref' href='class.init#class.cdtor'>[class.init]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>11.9.5</a> Construction and destruction <a class='abbr_ref'>[class.cdtor]</a></h3><div class='texpara'><a class='index' id=':construction'></a><a class='index' id=':destruction'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L5905'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':construction,member_access'></a><a class='index' id=':destruction,member_access'></a>For an object with a non-trivial constructor, referring to any non-static member
or base class of the object before the constructor begins execution results in
undefined behavior<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>For an object with a non-trivial destructor, referring to
any non-static member or base class of the object after the destructor finishes
execution results in undefined behavior<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> X <span class='curlybracket'>{</span> <span class='keyword'>int</span> i; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> Y <span class='operator'>:</span> X <span class='curlybracket'>{</span> Y<span class='parenthesis'>(</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;                  <span class='comment'>// non-trivial</span>
<span class='keyword'>struct</span> A <span class='curlybracket'>{</span> <span class='keyword'>int</span> a; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> B <span class='operator'>:</span> <span class='keyword'>public</span> A <span class='curlybracket'>{</span> <span class='keyword'>int</span> j; Y y; <span class='curlybracket'>}</span>;    <span class='comment'>// non-trivial</span>

<span class='keyword'>extern</span> B bobj;
B<span class='operator'>*</span> pb <span class='operator'>=</span> <span class='operator'>&amp;</span>bobj;                          <span class='comment'>// OK</span>
<span class='keyword'>int</span><span class='operator'>*</span> p1 <span class='operator'>=</span> <span class='operator'>&amp;</span>bobj<span class='operator'>.</span>a;                      <span class='comment'>// undefined behavior: refers to base class member</span>
<span class='keyword'>int</span><span class='operator'>*</span> p2 <span class='operator'>=</span> <span class='operator'>&amp;</span>bobj<span class='operator'>.</span>y<span class='operator'>.</span>i;                    <span class='comment'>// undefined behavior: refers to member's member</span>

A<span class='operator'>*</span> pa <span class='operator'>=</span> <span class='operator'>&amp;</span>bobj;                          <span class='comment'>// undefined behavior: upcast to a base class type</span>
B bobj;                                 <span class='comment'>// definition of <span class='tcode_in_codeblock'>bobj</span></span>

<span class='keyword'>extern</span> X xobj;
<span class='keyword'>int</span><span class='operator'>*</span> p3 <span class='operator'>=</span> <span class='operator'>&amp;</span>xobj<span class='operator'>.</span>i;                      <span class='comment'>// OK, all constructors of <span class='tcode_in_codeblock'>X</span> are trivial</span>
X xobj;
</span> <div id='1.sentence-3' class='sentence'>
For another example,
<span class='codeblock'><span class='keyword'>struct</span> W <span class='curlybracket'>{</span> <span class='keyword'>int</span> j; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> X <span class='operator'>:</span> <span class='keyword'>public</span> <span class='keyword'>virtual</span> W <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> Y <span class='curlybracket'>{</span>
  <span class='keyword'>int</span><span class='operator'>*</span> p;
  X x;
  Y<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>:</span> p<span class='parenthesis'>(</span><span class='operator'>&amp;</span>x<span class='operator'>.</span>j<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>   <span class='comment'>// undefined, <span class='tcode_in_codeblock'>x</span> is not yet constructed</span>
    <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;
</span></div> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L5945'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>During the construction of an object,
if the value of the object or any of its subobjects is
accessed through a glvalue that is not obtained, directly or indirectly, from
the constructor's
<span id=':this'><span class='texttt'><span class='keyword'>this</span></span></span>
pointer, the value of the object or subobject thus obtained is unspecified<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='example-2' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-2'>2</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> C;
<span class='keyword'>void</span> no_opt<span class='parenthesis'>(</span>C<span class='operator'>*</span><span class='parenthesis'>)</span>;

<span class='keyword'>struct</span> C <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> c;
  C<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>:</span> c<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> no_opt<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;

<span class='keyword'>const</span> C cobj;

<span class='keyword'>void</span> no_opt<span class='parenthesis'>(</span>C<span class='operator'>*</span> cptr<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>int</span> i <span class='operator'>=</span> cobj<span class='operator'>.</span>c <span class='operator'>*</span> <span class='literal'>100</span>;         <span class='comment'>// value of <span class='tcode_in_codeblock'>cobj.c</span> is unspecified</span>
  cptr<span class='operator'>-</span><span class='anglebracket'>&gt;</span>c <span class='operator'>=</span> <span class='literal'>1</span>;
  cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> cobj<span class='operator'>.</span>c <span class='operator'>*</span> <span class='literal'>100</span>          <span class='comment'>// value of <span class='tcode_in_codeblock'>cobj.c</span> is unspecified</span>
       <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> <span class='literal'>'\n'</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>extern</span> <span class='keyword'>struct</span> D d;
<span class='keyword'>struct</span> D <span class='curlybracket'>{</span>
  D<span class='parenthesis'>(</span><span class='keyword'>int</span> a<span class='parenthesis'>)</span> <span class='operator'>:</span> a<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>, b<span class='parenthesis'>(</span>d<span class='operator'>.</span>a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
  <span class='keyword'>int</span> a, b;
<span class='curlybracket'>}</span>;
D d <span class='operator'>=</span> D<span class='parenthesis'>(</span><span class='literal'>1</span><span class='parenthesis'>)</span>;                     <span class='comment'>// value of <span class='tcode_in_codeblock'>d.b</span> is unspecified</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L5980'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'><a class='index' id=':construction,pointer_to_member_or_base'></a><a class='index' id=':destruction,pointer_to_member_or_base'></a>To explicitly or implicitly convert a pointer (a glvalue) referring to
an object of class
<span class='texttt'>X</span>
to a pointer (reference) to a direct or indirect base class
<span class='texttt'>B</span>
of
<span class='texttt'>X</span>,
the construction of
<span class='texttt'>X</span>
and the construction of all of its direct or indirect bases that directly or
indirectly derive from
<span class='texttt'>B</span>
shall have started and the destruction of these classes shall not have
completed, otherwise the conversion results in undefined behavior<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>To form a pointer to (or access the value of) a direct non-static member of
an object
<span class='texttt'>obj</span>,
the construction of
<span class='texttt'>obj</span>
shall have started and its destruction shall not have completed,
otherwise the computation of the pointer value (or accessing the member
value) results in undefined behavior<a class='hidden_link' href='#3.sentence-2'>.</a></div> <div id='example-3' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-3'>3</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> A <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> B <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> C <span class='operator'>:</span> B <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> D <span class='operator'>:</span> <span class='keyword'>virtual</span> A <span class='curlybracket'>{</span> D<span class='parenthesis'>(</span>A<span class='operator'>*</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;
<span class='keyword'>struct</span> X <span class='curlybracket'>{</span> X<span class='parenthesis'>(</span>A<span class='operator'>*</span><span class='parenthesis'>)</span>; <span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> E <span class='operator'>:</span> C, D, X <span class='curlybracket'>{</span>
  E<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>:</span> D<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span>,    <span class='comment'>// undefined behavior: upcast from <span class='tcode_in_codeblock'>E*</span> to <span class='tcode_in_codeblock'>A*</span> might use path <span class='tcode_in_codeblock'>E*</span> <span class='math'>→</span> <span class='tcode_in_codeblock'>D*</span> <span class='math'>→</span> <span class='tcode_in_codeblock'>A*</span></span>
                    <span class='comment'>// but <span class='tcode_in_codeblock'>D</span> is not constructed</span>

                    <span class='comment'>// “<span class='tcode_in_codeblock'>D((C*)this)</span>'' would be defined: <span class='tcode_in_codeblock'>E*</span> <span class='math'>→</span> <span class='tcode_in_codeblock'>C*</span> is defined because <span class='tcode_in_codeblock'>E()</span> has started,</span>
                    <span class='comment'>// and <span class='tcode_in_codeblock'>C*</span> <span class='math'>→</span> <span class='tcode_in_codeblock'>A*</span> is defined because <span class='tcode_in_codeblock'>C</span> is fully constructed</span>

  X<span class='parenthesis'>(</span><span class='keyword'>this</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>        <span class='comment'>// defined: upon construction of <span class='tcode_in_codeblock'>X</span>, <span class='tcode_in_codeblock'>C/B/D/A</span> sublattice is fully constructed</span>
<span class='curlybracket'>}</span>;
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L6025'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><a class='index' id=':virtual_function_call,constructor_and'></a><a class='index' id=':virtual_function_call,destructor_and'></a><a class='index' id=':construction,virtual_function_call'></a><a class='index' id=':destruction,virtual_function_call'></a>Member functions, including virtual functions (<a href='class.virtual' title='11.7.3&emsp;Virtual functions'>[class.<span class='shy'></span>virtual]</a>), can be called
during construction or destruction (<a href='class.base.init' title='11.9.3&emsp;Initializing bases and members'>[class.<span class='shy'></span>base.<span class='shy'></span>init]</a>)<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>When a virtual function is called directly or indirectly from a constructor
or from a destructor,
including during the construction or destruction of the class's non-static data
members,
and the object to which the call applies is the object (call it <span class='texttt'>x</span>) under construction or
destruction,
the function called is the
final overrider in the constructor's or destructor's class and not one
overriding it in a more-derived class<a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>If the virtual function call uses an explicit class member access (<a href='expr.ref' title='7.6.1.5&emsp;Class member access'>[expr.<span class='shy'></span>ref]</a>)
and the object expression refers to
the complete object of <span class='texttt'>x</span> or one of that object's base class subobjects
but not <span class='texttt'>x</span> or one of its base class subobjects, the behavior
is undefined<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='example-4' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-4'>4</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> V <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> A <span class='operator'>:</span> <span class='keyword'>virtual</span> V <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> B <span class='operator'>:</span> <span class='keyword'>virtual</span> V <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  B<span class='parenthesis'>(</span>V<span class='operator'>*</span>, A<span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> A, B <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  D<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>:</span> B<span class='parenthesis'>(</span><span class='parenthesis'>(</span>A<span class='operator'>*</span><span class='parenthesis'>)</span><span class='keyword'>this</span>, <span class='keyword'>this</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;

B<span class='operator'>::</span>B<span class='parenthesis'>(</span>V<span class='operator'>*</span> v, A<span class='operator'>*</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;              <span class='comment'>// calls <span class='tcode_in_codeblock'>V&#x200b;::&#x200b;f</span>, not <span class='tcode_in_codeblock'>A&#x200b;::&#x200b;f</span></span>
  g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;              <span class='comment'>// calls <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;g</span>, not <span class='tcode_in_codeblock'>D&#x200b;::&#x200b;g</span></span>
  v<span class='operator'>-</span><span class='anglebracket'>&gt;</span>g<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;           <span class='comment'>// <span class='tcode_in_codeblock'>v</span> is base of <span class='tcode_in_codeblock'>B</span>, the call is well-defined, calls <span class='tcode_in_codeblock'>B&#x200b;::&#x200b;g</span></span>
  a<span class='operator'>-</span><span class='anglebracket'>&gt;</span>f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;           <span class='comment'>// undefined behavior: <span class='tcode_in_codeblock'>a</span>'s type not a base of <span class='tcode_in_codeblock'>B</span></span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L6077'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'><a class='index' id=':construction,typeid_operator'></a><a class='index' id=':destruction,typeid_operator'></a><a class='index' id=':typeid,construction_and'></a><a class='index' id=':typeid,destruction_and'></a>The
<span class='texttt'><span class='keyword'>typeid</span></span>
operator (<a href='expr.typeid' title='7.6.1.8&emsp;Type identification'>[expr.<span class='shy'></span>typeid]</a>) can be used during construction or destruction (<a href='class.base.init' title='11.9.3&emsp;Initializing bases and members'>[class.<span class='shy'></span>base.<span class='shy'></span>init]</a>)<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='5.sentence-2' class='sentence'>When
<span class='texttt'><span class='keyword'>typeid</span></span>
is used in a constructor (including the
<a href='class.base.init#nt:mem-initializer' title='11.9.3&emsp;Initializing bases and members&emsp;[class.base.init]'><span id='ntref:mem-initializer'><span class='textsf'><i >mem-initializer</i></span></span></a> or default member initializer (<a href='class.mem' title='11.4&emsp;Class members'>[class.<span class='shy'></span>mem]</a>)
for a non-static data member)
or in a destructor, or used in a function called (directly or indirectly) from
a constructor or destructor, if the operand of
<span class='texttt'><span class='keyword'>typeid</span></span>
refers to the object under construction or destruction,
<span class='texttt'><span class='keyword'>typeid</span></span>
yields the
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>type_<span class='shy'></span>info</span>
object representing the constructor or destructor's class<a class='hidden_link' href='#5.sentence-2'>.</a></div> <div id='5.sentence-3' class='sentence'>If the operand of
<span class='texttt'><span class='keyword'>typeid</span></span>
refers to the object under construction or destruction and the static type of
the operand is neither the constructor or destructor's class nor one of its
bases, the behavior is undefined<a class='hidden_link' href='#5.sentence-3'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/896196c8c08ed834ef876c29c1182510da9c1a1c/source/classes.tex#L6104'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'><a class='index' id=':construction,dynamic_cast_and'></a><a class='index' id=':destruction,dynamic_cast_and'></a><a class='index' id=':cast,dynamic,construction_and'></a><a class='index' id=':cast,dynamic,destruction_and'></a><span id=':dynamic_cast'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span>s (<a href='expr.dynamic.cast' title='7.6.1.7&emsp;Dynamic cast'>[expr.<span class='shy'></span>dynamic.<span class='shy'></span>cast]</a>) can be used during construction
or destruction (<a href='class.base.init' title='11.9.3&emsp;Initializing bases and members'>[class.<span class='shy'></span>base.<span class='shy'></span>init]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='6.sentence-2' class='sentence'>When a
<span id=':dynamic_cast_'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span>
is used in a constructor (including the
<a href='class.base.init#nt:mem-initializer' title='11.9.3&emsp;Initializing bases and members&emsp;[class.base.init]'><span id='ntref:mem-initializer_'><span class='textsf'><i >mem-initializer</i></span></span></a> or default member initializer
for a non-static data member)
or in a destructor, or used in a function called (directly or indirectly) from
a constructor or destructor, if the operand of the
<span id=':dynamic_cast__'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span>
refers to the object under construction or destruction, this object is
considered to be a most derived object that has the type of the constructor or
destructor's class<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='6.sentence-3' class='sentence'>If the operand of the
<span id=':dynamic_cast___'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span>
refers to the object under construction or destruction and the static type of
the operand is not a pointer to or object of the constructor or destructor's
own class or one of its bases, the
<span id=':dynamic_cast____'><span class='texttt'><span class='keyword'>dynamic_<span class='shy'></span>cast</span></span></span>
results in undefined behavior<a class='hidden_link' href='#6.sentence-3'>.</a></div> <div id='example-5' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-5'>5</a></i>:&ensp;<span class='codeblock'><span class='keyword'>struct</span> V <span class='curlybracket'>{</span>
  <span class='keyword'>virtual</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> A <span class='operator'>:</span> <span class='keyword'>virtual</span> V <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> B <span class='operator'>:</span> <span class='keyword'>virtual</span> V <span class='curlybracket'>{</span>
  B<span class='parenthesis'>(</span>V<span class='operator'>*</span>, A<span class='operator'>*</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>struct</span> D <span class='operator'>:</span> A, B <span class='curlybracket'>{</span>
  D<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>:</span> B<span class='parenthesis'>(</span><span class='parenthesis'>(</span>A<span class='operator'>*</span><span class='parenthesis'>)</span><span class='keyword'>this</span>, <span class='keyword'>this</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='curlybracket'>}</span>
<span class='curlybracket'>}</span>;

B<span class='operator'>::</span>B<span class='parenthesis'>(</span>V<span class='operator'>*</span> v, A<span class='operator'>*</span> a<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>typeid</span><span class='parenthesis'>(</span><span class='operator'>*</span><span class='keyword'>this</span><span class='parenthesis'>)</span>;                <span class='comment'>// <span class='tcode_in_codeblock'>type_<span class='shy'></span>info</span> for <span class='tcode_in_codeblock'>B</span></span>
  <span class='keyword'>typeid</span><span class='parenthesis'>(</span><span class='operator'>*</span>v<span class='parenthesis'>)</span>;                   <span class='comment'>// well-defined: <span class='tcode_in_codeblock'>*v</span> has type <span class='tcode_in_codeblock'>V</span>, a base of <span class='tcode_in_codeblock'>B</span> yields <span class='tcode_in_codeblock'>type_<span class='shy'></span>info</span> for <span class='tcode_in_codeblock'>B</span></span>
  <span class='keyword'>typeid</span><span class='parenthesis'>(</span><span class='operator'>*</span>a<span class='parenthesis'>)</span>;                   <span class='comment'>// undefined behavior: type <span class='tcode_in_codeblock'>A</span> not a base of <span class='tcode_in_codeblock'>B</span></span>
  <span class='keyword'>dynamic_cast</span><span class='anglebracket'>&lt;</span>B<span class='operator'>*</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>v<span class='parenthesis'>)</span>;          <span class='comment'>// well-defined: <span class='tcode_in_codeblock'>v</span> of type <span class='tcode_in_codeblock'>V*</span>, <span class='tcode_in_codeblock'>V</span> base of <span class='tcode_in_codeblock'>B</span> results in <span class='tcode_in_codeblock'>B*</span></span>
  <span class='keyword'>dynamic_cast</span><span class='anglebracket'>&lt;</span>B<span class='operator'>*</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>;          <span class='comment'>// undefined behavior: <span class='tcode_in_codeblock'>a</span> has type <span class='tcode_in_codeblock'>A*</span>, <span class='tcode_in_codeblock'>A</span> not a base of <span class='tcode_in_codeblock'>B</span></span>
<span class='curlybracket'>}</span>
</span> —&nbsp;<i>end example</i>]</div></div> </div></div></div></body></html>