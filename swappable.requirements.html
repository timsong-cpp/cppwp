<!DOCTYPE html><html lang='en'><head><title>[swappable.requirements]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>20</a> Library introduction <a class='abbr_ref' href='./#library'>[library]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>20.5</a> Library-wide requirements <a class='abbr_ref' href='requirements#swappable.requirements'>[requirements]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>20.5.3</a> Requirements on types and expressions <a class='abbr_ref' href='utility.requirements#swappable.requirements'>[utility.requirements]</a></h3><h4 ><a class='secnum' style='min-width:118pt'>20.5.3.2</a> Swappable requirements <a class='abbr_ref'>[swappable.requirements]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/7231f47876a82200e7eeb000a1e90f0af19cdab1/source/lib-intro.tex#L1707'>#</a></div><div id='1.sentence-1' class='sentence'>This subclause provides definitions for swappable types and expressions<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>In these
definitions, let <span class='texttt'>t</span> denote an expression of type <span class='texttt'>T</span>, and let <span class='texttt'>u</span>
denote an expression of type <span class='texttt'>U</span><a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/7231f47876a82200e7eeb000a1e90f0af19cdab1/source/lib-intro.tex#L1712'>#</a></div><div id='2.sentence-1' class='sentence'>An object <span class='texttt'>t</span> is <a class='hidden_link' href='#def:swappable_with' id='def:swappable_with'><i >swappable with</i></a> an object <span class='texttt'>u</span> if and only if:</div><div id='2.sentence-2' class='sentence'><ul class='itemize'><li id='2.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.1'>(2.1)</a></div><div id='2.1.sentence-1' class='sentence'>the expressions <span class='texttt'>swap(t, u)</span> and <span class='texttt'>swap(u, t)</span> are valid when
evaluated in the context described below, and</div></li><li id='2.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#2.2'>(2.2)</a></div><div id='2.2.sentence-1' class='sentence'>these expressions have the following effects:</div><div id='2.2.sentence-2' class='sentence'><ul class='itemize'><li id='2.2.1'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#2.2.1'>(2.2.1)</a></div><div id='2.2.1.sentence-1' class='sentence'>the object referred to by <span class='texttt'>t</span> has the value originally held by <span class='texttt'>u</span> and</div></li><li id='2.2.2'><div class='marginalizedparent' style='left:-9em'><a class='marginalized' href='#2.2.2'>(2.2.2)</a></div><div id='2.2.2.sentence-1' class='sentence'>the object referred to by <span class='texttt'>u</span> has the value originally held by <span class='texttt'>t</span><a class='hidden_link' href='#2.2.2.sentence-1'>.</a></div></li></ul></div></li></ul></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/7231f47876a82200e7eeb000a1e90f0af19cdab1/source/lib-intro.tex#L1727'>#</a></div><div id='3.sentence-1' class='sentence'>The context in which <span class='texttt'>swap(t, u)</span> and <span class='texttt'>swap(u, t)</span> are evaluated shall
ensure that a binary non-member function named “swap” is selected via <a href='over.match'>overload
resolution</a> on a candidate set that includes:</div><div id='3.sentence-2' class='sentence'><ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.1'>(3.1)</a></div><div id='3.1.sentence-1' class='sentence'>the two <span class='texttt'>swap</span> function templates defined in
<a href='utility'><span class='texttt'>&lt;utility&gt;</span></a> and</div></li><li id='3.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#3.2'>(3.2)</a></div><div id='3.2.sentence-1' class='sentence'>the lookup set produced by <a href='basic.lookup.argdep'>argument-dependent lookup</a><a class='hidden_link' href='#3.2.sentence-1'>.</a></div></li></ul></div><div id='3.note-1' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-3' class='sentence'>If <span class='texttt'>T</span> and <span class='texttt'>U</span> are both fundamental types or arrays of
fundamental types and the declarations from the header <span class='texttt'>&lt;utility&gt;</span> are in
scope, the overall lookup set described above is equivalent to that of the
qualified name lookup applied to the expression <span class='texttt'>std&#x200b;::&#x200b;swap(t, u)</span> or
<span class='texttt'>std&#x200b;::&#x200b;swap(u, t)</span> as appropriate<a class='hidden_link' href='#3.sentence-3'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> <div id='3.note-2' class='note'>[<span style='white-space:nowrap'> </span><a class='note_link' href='#3.note-2'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='3.sentence-4' class='sentence'>It is unspecified whether a library component that has a swappable
requirement includes the header <span class='texttt'>&lt;utility&gt;</span> to ensure an appropriate
evaluation context<a class='hidden_link' href='#3.sentence-4'>.</a></div> —<span style='white-space:nowrap'> </span><i>end note</i></div><span style='white-space:nowrap'> </span>]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/7231f47876a82200e7eeb000a1e90f0af19cdab1/source/lib-intro.tex#L1749'>#</a></div><div id='4.sentence-1' class='sentence'>An rvalue or lvalue <span class='texttt'>t</span> is <a class='hidden_link' href='#def:swappable' id='def:swappable'><i >swappable</i></a> if and only if <span class='texttt'>t</span> is
swappable with any rvalue or lvalue, respectively, of type <span class='texttt'>T</span><a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/7231f47876a82200e7eeb000a1e90f0af19cdab1/source/lib-intro.tex#L1753'>#</a></div><div id='5.sentence-1' class='sentence'>A type <span class='texttt'>X</span> satisfying any of the iterator requirements (<a href='iterator.requirements'>[iterator.requirements]</a>)
satisfies the <span class='textit'>Cpp17ValueSwappable</span> requirements if,
for any dereferenceable object
<span class='texttt'>x</span> of type <span class='texttt'>X</span>,
<span class='texttt'>*x</span> is swappable<a class='hidden_link' href='#5.sentence-1'>.</a></div><div style='height:0.6em;display:block'></div><div id='5.example-1' class='example'>[<span style='white-space:nowrap'> </span><a class='example_link' href='#5.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='5.sentence-2' class='sentence'>User code can ensure that the evaluation of <span class='texttt'>swap</span> calls
is performed in an appropriate context under the various conditions as follows:
<pre class='codeblock'>
#include &lt;utility&gt;

<span class='comment'>// Requires: <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;forward&lt;T&gt;(t)</span> shall be swappable with <span class='tcode_in_codeblock'>std&#x200b;::&#x200b;forward&lt;U&gt;(u)</span>.
</span>template&lt;class T, class U&gt;
void value_swap(T&amp;&amp; t, U&amp;&amp; u) {
  using std::swap;
  swap(std::forward&lt;T&gt;(t), std::forward&lt;U&gt;(u)); <span class='comment'>// OK: uses “swappable with” conditions
</span>                                                <span class='comment'>// for rvalues and lvalues
</span>}

<span class='comment'>// Requires: lvalues of <span class='tcode_in_codeblock'>T</span> shall be swappable.
</span>template&lt;class T&gt;
void lv_swap(T&amp; t1, T&amp; t2) {
  using std::swap;
  swap(t1, t2);                                 <span class='comment'>// OK: uses swappable conditions for lvalues of type <span class='tcode_in_codeblock'>T</span>
</span>}

namespace N {
  struct A { int m; };
  struct Proxy { A* a; };
  Proxy proxy(A&amp; a) { return Proxy{ &amp;a }; }

  void swap(A&amp; x, Proxy p) {
    std::swap(x.m, p.a-&gt;m);                     <span class='comment'>// OK: uses context equivalent to swappable
</span>                                                <span class='comment'>// conditions for fundamental types
</span>  }
  void swap(Proxy p, A&amp; x) { swap(x, p); }      <span class='comment'>// satisfy symmetry constraint
</span>}

int main() {
  int i = 1, j = 2;
  lv_swap(i, j);
  assert(i == 2 &amp;&amp; j == 1);

  N::A a1 = { 5 }, a2 = { -5 };
  value_swap(a1, proxy(a2));
  assert(a1.m == -5 &amp;&amp; a2.m == 5);
}</pre></div> —<span style='white-space:nowrap'> </span><i>end example</i></div><span style='white-space:nowrap'> </span>]</div> </div></div></body></html>