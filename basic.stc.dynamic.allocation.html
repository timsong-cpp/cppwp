<!DOCTYPE html><html lang='en'><head><title>[basic.stc.dynamic.allocation]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>6</a> Basics <a class='abbr_ref' href='./#basic'>[basic]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>6.7</a> Memory and objects <a class='abbr_ref' href='basic.memobj#basic.stc.dynamic.allocation'>[basic.memobj]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>6.7.5</a> Storage duration <a class='abbr_ref' href='basic.stc#dynamic.allocation'>[basic.stc]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>6.7.5.5</a> Dynamic storage duration <a class='abbr_ref' href='basic.stc.dynamic#allocation'>[basic.stc.dynamic]</a></h4><h4 ><a class='secnum' style='min-width:110pt'>6.7.5.5.2</a> Allocation functions <a class='abbr_ref'>[basic.stc.dynamic.allocation]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/d3fbad184abd1c327dd2dd097cd3caa17ada48af/source/basic.tex#L3849'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'><a class='index' id=':function,allocation'></a>An allocation function that is not a class member function
shall belong to the global scope and not have a name with internal linkage<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>The return type shall be <span class='texttt'><span id=':void'><span class='texttt'><span class='keyword'>void</span></span></span><span class='operator'>*</span></span><a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>The first
parameter shall have type <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>size_&shy;t</span> (<a href='support.types' title='17.2&emsp;Common definitions'>[support.<span class='shy'></span>types]</a>)<a class='hidden_link' href='#1.sentence-3'>.</a></div> <div id='1.sentence-4' class='sentence'>The
first parameter shall not have an associated default
argument (<a href='dcl.fct.default' title='9.3.4.7&emsp;Default arguments'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>default]</a>)<a class='hidden_link' href='#1.sentence-4'>.</a></div> <div id='1.sentence-5' class='sentence'>The value of the first parameter
is interpreted as the requested size of the allocation<a class='hidden_link' href='#1.sentence-5'>.</a></div> <div id='1.sentence-6' class='sentence'>An allocation
function can be a function template<a class='hidden_link' href='#1.sentence-6'>.</a></div> <div id='1.sentence-7' class='sentence'>Such a template shall declare its
return type and first parameter as specified above (that is, template
parameter types shall not be used in the return type and first parameter
type)<a class='hidden_link' href='#1.sentence-7'>.</a></div> <div id='1.sentence-8' class='sentence'>Allocation function templates shall have two or more parameters<a class='hidden_link' href='#1.sentence-8'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/d3fbad184abd1c327dd2dd097cd3caa17ada48af/source/basic.tex#L3863'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>An allocation function attempts to allocate the requested amount of
storage<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>If it is successful, it returns the address of the start
of a block of storage whose length in bytes is at least as large
as the requested size<a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>The order,
contiguity, and initial value of storage allocated by successive calls
to an allocation function are unspecified<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>Even if the size of the space
requested is zero, the request can fail<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>If the request succeeds, the
value returned by a replaceable allocation function
is a non-null pointer value (<a href='basic.compound' title='6.8.3&emsp;Compound types'>[basic.<span class='shy'></span>compound]</a>)
<span class='texttt'>p0</span> different from any previously returned value <span class='texttt'>p1</span>,
unless that value <span class='texttt'>p1</span> was subsequently passed to a
replaceable deallocation function<a class='hidden_link' href='#2.sentence-5'>.</a></div> <div id='2.sentence-6' class='sentence'>Furthermore, for the library allocation functions
in <a href='new.delete.single' title='17.6.3.2&emsp;Single-object forms'>[new.<span class='shy'></span>delete.<span class='shy'></span>single]</a> and <a href='new.delete.array' title='17.6.3.3&emsp;Array forms'>[new.<span class='shy'></span>delete.<span class='shy'></span>array]</a>,
<span class='texttt'>p0</span> represents the address of a block of storage disjoint from the storage
for any other object accessible to the caller<a class='hidden_link' href='#2.sentence-6'>.</a></div> <div id='2.sentence-7' class='sentence'>The effect of indirecting through a pointer
returned from a request for zero size is undefined<a class='hidden_link' href='#2.sentence-7'>.</a><a class='footnoteref' href='#footnote-29' id='footnoteref-29' title='The intent is to have operator new() implementable by calling std&#x200b;::&#x200b;malloc() or std&#x200b;::&#x200b;calloc(), so the rules are substantially the same. C++ differs from C in requiring a zero request to return a non-null pointer.'>29</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/d3fbad184abd1c327dd2dd097cd3caa17ada48af/source/basic.tex#L3892'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>For an allocation function other than
a reserved placement allocation function (<a href='new.delete.placement' title='17.6.3.4&emsp;Non-allocating forms'>[new.<span class='shy'></span>delete.<span class='shy'></span>placement]</a>),
the pointer returned on a successful call
shall represent the address of storage that is aligned as follows:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.1'>(3.1)</a></div><div class='texpara'><div id='3.1.sentence-1' class='sentence'>If the allocation function takes an argument
  of type <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>align_&shy;val_&shy;t</span>,
  the storage will have the alignment specified
  by the value of this argument<a class='hidden_link' href='#3.1.sentence-1'>.</a></div></div></li><li id='3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.2'>(3.2)</a></div><div class='texpara'><div id='3.2.sentence-1' class='sentence'>Otherwise, if the allocation function is named <span class='texttt'><span id=':operator_'><span class='texttt'><span class='keyword'>operator</span></span></span> <span id=':new_'><span class='texttt'><span class='keyword'>new</span></span></span><span class='squarebracket'>[</span><span class='squarebracket'>]</span></span>,
  the storage is aligned for any object that
  does not have new-extended alignment (<a href='basic.align' title='6.7.6&emsp;Alignment'>[basic.<span class='shy'></span>align]</a>) and
  is no larger than the requested size<a class='hidden_link' href='#3.2.sentence-1'>.</a></div></div></li><li id='3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.3'>(3.3)</a></div><div class='texpara'><div id='3.3.sentence-1' class='sentence'>Otherwise, the storage is aligned for any object that
  does not have new-extended alignment and is of the requested size<a class='hidden_link' href='#3.3.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/d3fbad184abd1c327dd2dd097cd3caa17ada48af/source/basic.tex#L3913'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>An allocation function that fails to allocate storage can invoke the
currently installed new-handler function (<a href='new.handler' title='17.6.4.3&emsp;Type new_&shy;handler'>[new.<span class='shy'></span>handler]</a>), if any<a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>: <div id='4.sentence-2' class='sentence'><a class='index' id=':new_handler'></a>A program-supplied allocation function can obtain the address of the
currently installed <span class='texttt'>new_&shy;handler</span> using the
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>get_&shy;new_&shy;handler</span> function (<a href='get.new.handler' title='17.6.4.5&emsp;get_&shy;new_&shy;handler'>[get.<span class='shy'></span>new.<span class='shy'></span>handler]</a>)<a class='hidden_link' href='#4.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='4.sentence-3' class='sentence'>
An allocation function that has a non-throwing
exception specification (<a href='except.spec' title='14.5&emsp;Exception specifications'>[except.<span class='shy'></span>spec]</a>)
indicates failure by returning
a null pointer value<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'>Any other allocation function
never returns a null pointer value and
indicates failure only by throwing an exception (<a href='except.throw' title='14.2&emsp;Throwing an exception'>[except.<span class='shy'></span>throw]</a>) of a type
that would match a handler (<a href='except.handle' title='14.4&emsp;Handling an exception'>[except.<span class='shy'></span>handle]</a>) of type
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>bad_&shy;alloc</span> (<a href='bad.alloc' title='17.6.4.1&emsp;Class bad_&shy;alloc'>[bad.<span class='shy'></span>alloc]</a>)<a class='hidden_link' href='#4.sentence-4'>.</a></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/d3fbad184abd1c327dd2dd097cd3caa17ada48af/source/basic.tex#L3932'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>A global allocation function is only called as the result of a <a href='expr.new' title='7.6.2.8&emsp;New&emsp;[expr.new]'>new
expression</a>, or called directly using the <a href='expr.call' title='7.6.1.3&emsp;Function call&emsp;[expr.call]'>function call</a>
syntax, or called indirectly to allocate storage for
a coroutine state (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>),
or called indirectly through calls to the
functions in the C++ standard library<a class='hidden_link' href='#5.sentence-1'>.</a></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>: <div id='5.sentence-2' class='sentence'>In particular, a
global allocation function is not called to allocate storage for objects
with <a href='basic.stc.static' title='6.7.5.2&emsp;Static storage duration&emsp;[basic.stc.static]'>static storage duration</a>, for objects or references
with <a href='basic.stc.thread' title='6.7.5.3&emsp;Thread storage duration&emsp;[basic.stc.thread]'>thread storage duration</a>, for objects of
type <a href='expr.typeid' title='7.6.1.8&emsp;Type identification&emsp;[expr.typeid]'><span class='texttt'>std&#x200b;::&#x200b;type_&shy;info</span></a>, or for an
<a href='except.throw' title='14.2&emsp;Throwing an exception&emsp;[except.throw]'>exception object</a><a class='hidden_link' href='#5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='footnoteSeparator'></div><div class='footnote' id='footnote-29'><div class='texpara'><a class='footnotenum' href='#footnote-29'>29)</a><a class='footnoteBacklink' href='#footnoteref-29'>29)</a> <div id='footnote-29.sentence-1' class='sentence'>The intent is
to have <span class='texttt'><span id=':operator'><span class='texttt'><span class='keyword'>operator</span></span></span> <span id=':new'><span class='texttt'><span class='keyword'>new</span></span></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> implementable by
calling <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>malloc<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> or <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>calloc<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>, so the rules are
substantially the same<a class='hidden_link' href='#footnote-29.sentence-1'>.</a></div> <div id='footnote-29.sentence-2' class='sentence'>C++ differs from C in requiring a zero request
to return a non-null pointer<a class='hidden_link' href='#footnote-29.sentence-2'>.</a></div></div></div></div></body></html>