<!DOCTYPE html><html lang='en'><head><title>[exec.ctx]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>33.12</a> Execution contexts <a class='abbr_ref'>[exec.ctx]</a></h2><hr><h3 ><a class='secnum' style='min-width:80pt'>33.12.1</a> <span class='texttt'>execution&#x200b;::&#x200b;run_<span class='shy'></span>loop</span> <a class='abbr_ref' href='#exec.run.loop'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop]</a><div style='clear:right'></div></h3><h4 ><a class='secnum' style='min-width:95pt'>33.12.1.1</a> General <a class='abbr_ref' href='#exec.run.loop.general'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>general]</a><div style='clear:right'></div></h4><h4 ><a class='secnum' style='min-width:95pt'>33.12.1.2</a> Associated types <a class='abbr_ref' href='#exec.run.loop.types'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>types]</a><div style='clear:right'></div></h4><h4 ><a class='secnum' style='min-width:95pt'>33.12.1.3</a> Constructor and destructor <a class='abbr_ref' href='#exec.run.loop.ctor'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>ctor]</a><div style='clear:right'></div></h4><h4 ><a class='secnum' style='min-width:95pt'>33.12.1.4</a> Member functions <a class='abbr_ref' href='#exec.run.loop.members'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a><div style='clear:right'></div></h4><hr><div id='exec.run.loop' class='section'><h3 ><a class='secnum' href='#exec.run.loop' style='min-width:50pt'>33.12.1</a> <span class='texttt'>execution&#x200b;::&#x200b;run_<span class='shy'></span>loop</span> <a class='abbr_ref' href='exec.run.loop'>[exec.run.loop]</a></h3></div><div id='exec.run.loop.general' class='section'><h4 ><a class='secnum' href='#exec.run.loop.general' style='min-width:65pt'>33.12.1.1</a> General <a class='abbr_ref' href='exec.run.loop.general'>[exec.run.loop.general]</a></h4></div><div class='para' id='exec.run.loop.general-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6318'>#</a></div><div class='texpara'><div id='exec.run.loop.general-1.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> is an execution resource on which work can be scheduled<a class='hidden_link' href='#exec.run.loop.general-1.sentence-1'>.</a></div> <div id='exec.run.loop.general-1.sentence-2' class='sentence'>It maintains a thread-safe first-in-first-out queue of work<a class='hidden_link' href='#exec.run.loop.general-1.sentence-2'>.</a></div> <div id='exec.run.loop.general-1.sentence-3' class='sentence'>Its <span class='texttt'>run</span> member function removes elements from the queue and
executes them in a loop on the thread of execution that calls <span class='texttt'>run</span><a class='hidden_link' href='#exec.run.loop.general-1.sentence-3'>.</a></div></div></div><div class='para' id='exec.run.loop.general-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6324'>#</a></div><div class='texpara'><div id='exec.run.loop.general-2.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated <a class='hidden_link' href='#def:count' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:count'><i >count</i></span></a>
that corresponds to the number of work items that are in its queue<a class='hidden_link' href='#exec.run.loop.general-2.sentence-1'>.</a></div> <div id='exec.run.loop.general-2.sentence-2' class='sentence'>Additionally, a <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated state
that can be one of
<a class='hidden_link' href='#def:starting' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:starting'><i >starting</i></span></a>, <a class='hidden_link' href='#def:running' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:running'><i >running</i></span></a>, <a class='hidden_link' href='#def:finishing' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finishing'><i >finishing</i></span></a>, or <a class='hidden_link' href='#def:finished' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finished'><i >finished</i></span></a><a class='hidden_link' href='#exec.run.loop.general-2.sentence-2'>.</a></div></div></div><div class='para' id='exec.run.loop.general-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6331'>#</a></div><div class='texpara'><div id='exec.run.loop.general-3.sentence-1' class='sentence'>Concurrent invocations of the member functions of <span class='texttt'>run_<span class='shy'></span>loop</span>
other than <span class='texttt'>run</span> and its destructor do not introduce data races<a class='hidden_link' href='#exec.run.loop.general-3.sentence-1'>.</a></div> <div id='exec.run.loop.general-3.sentence-2' class='sentence'>The member functions
<span class='texttt'><i >pop-front</i></span>, <span class='texttt'><i >push-back</i></span>, and <span class='texttt'>finish</span>
execute atomically<a class='hidden_link' href='#exec.run.loop.general-3.sentence-2'>.</a></div></div></div><div class='para' id='exec.run.loop.general-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.general-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6338'>#</a></div><div class='texpara'><div id='exec.run.loop.general-4.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use an intrusive queue of operation states
to hold the work units to make scheduling allocation-free<a class='hidden_link' href='#exec.run.loop.general-4.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:run_loop'><a class='hidden_link' href='#lib:run_loop' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'>run_loop</a></span> <span class='curlybracket'>{</span>
    <span class='comment'>// <a href='#exec.run.loop.types' title='33.12.1.2&emsp;Associated types'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>types]</a>, associated types</span>
    <span class='keyword'>class</span> <i >run-loop-scheduler</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>class</span> <i >run-loop-sender</i>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>struct</span> <i >run-loop-opstate-base</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='literal'>0</span>;                               <span class='comment'>// <i >exposition only</i></span>
      run_loop<span class='operator'>*</span> <i >loop</i>;                                           <span class='comment'>// <i >exposition only</i></span>
      <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >next</i>;                              <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >run-loop-opstate</i> <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

    <span class='comment'>// <a href='#exec.run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >push-back</i><span class='parenthesis'>(</span><i >run-loop-opstate-base</i><span class='operator'>*</span><span class='parenthesis'>)</span>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#exec.run.loop.ctor' title='33.12.1.3&emsp;Constructor and destructor'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>ctor]</a>, constructor and destructor</span>
    run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    run_loop<span class='parenthesis'>(</span>run_loop<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='#exec.run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-scheduler</i> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div id='exec.run.loop.types' class='section'><h4 ><a class='secnum' href='#exec.run.loop.types' style='min-width:65pt'>33.12.1.2</a> Associated types <a class='abbr_ref' href='exec.run.loop.types'>[exec.run.loop.types]</a></h4></div><div class='texpara'><div class='itemdecl' id='exec.run.loop.types-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.run.loop.types-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-scheduler</i></span>;
</code></div></div><div class='para' id='exec.run.loop.types-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6381'>#</a></div><div class='texpara'><div id='exec.run.loop.types-1.sentence-1' class='sentence'><span class='texttt'><i >run-loop-scheduler</i></span> is an unspecified type
that models <a href='exec.sched#concept:scheduler' title='33.6&emsp;Schedulers&emsp;[exec.sched]'><span id='conceptref:scheduler'><span class='texttt'>scheduler</span></span></a><a class='hidden_link' href='#exec.run.loop.types-1.sentence-1'>.</a></div></div></div><div class='para' id='exec.run.loop.types-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6385'>#</a></div><div class='texpara'><div id='exec.run.loop.types-2.sentence-1' class='sentence'>Instances of <span class='texttt'><i >run-loop-scheduler</i></span> remain valid
until the end of the lifetime of the <span class='texttt'>run_<span class='shy'></span>loop</span> instance
from which they were obtained<a class='hidden_link' href='#exec.run.loop.types-2.sentence-1'>.</a></div></div></div><div class='para' id='exec.run.loop.types-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6390'>#</a></div><div class='texpara'><div id='exec.run.loop.types-3.sentence-1' class='sentence'>Two instances of <span class='texttt'><i >run-loop-scheduler</i></span> compare equal
if and only if they were obtained from the same <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#exec.run.loop.types-3.sentence-1'>.</a></div></div></div><div class='para' id='exec.run.loop.types-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6394'>#</a></div><div class='texpara'><div id='exec.run.loop.types-4.sentence-1' class='sentence'>Let <span class='texttt'><i >sch</i></span> be an expression of type <span class='texttt'><i >run-loop-scheduler</i></span><a class='hidden_link' href='#exec.run.loop.types-4.sentence-1'>.</a></div> <div id='exec.run.loop.types-4.sentence-2' class='sentence'>The expression <span class='texttt'>schedule<span class='parenthesis'>(</span><span class='texttt'><i >sch</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><i >run-loop-<br>sender</i></span> and
is not potentially-throwing if <span class='texttt'><i >sch</i></span> is not potentially-throwing<a class='hidden_link' href='#exec.run.loop.types-4.sentence-2'>.</a></div></div></div><div class='texpara'><div class='itemdecl' id='exec.run.loop.types-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.run.loop.types-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>class</span> <span class='texttt'><i >run-loop-sender</i></span>;
</code></div></div><div class='para' id='exec.run.loop.types-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6404'>#</a></div><div class='texpara'><div id='exec.run.loop.types-5.sentence-1' class='sentence'><span class='texttt'><i >run-loop-sender</i></span> is an exposition-only type
that satisfies <a href='exec.snd.concepts#concept:sender' title='33.9.3&emsp;Sender concepts&emsp;[exec.snd.concepts]'><span id='conceptref:sender'><span class='texttt'>sender</span></span></a><a class='hidden_link' href='#exec.run.loop.types-5.sentence-1'>.</a></div> <div id='exec.run.loop.types-5.sentence-2' class='sentence'><span class='texttt'>completion_<span class='shy'></span>signatures_<span class='shy'></span>of_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='texttt'><i >run-<br/>loop-sender</i></span><span class='anglebracket'>&gt;</span></span> is
<span class='codeblock'>completion_signatures<span class='anglebracket'>&lt;</span>set_value_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, set_error_t<span class='parenthesis'>(</span>exception_ptr<span class='parenthesis'>)</span>, set_stopped_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span>
</span></div></div></div><div class='para' id='exec.run.loop.types-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6412'>#</a></div><div class='texpara'><div id='exec.run.loop.types-6.sentence-1' class='sentence'>An instance of <span class='texttt'><i >run-loop-sender</i></span> remains valid
until the end of the lifetime of its associated <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#exec.run.loop.types-6.sentence-1'>.</a></div></div></div><div class='para' id='exec.run.loop.types-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6416'>#</a></div><div class='texpara'><div id='exec.run.loop.types-7.sentence-1' class='sentence'>Let <span class='texttt'><i >sndr</i></span> be an expression of type <span class='texttt'><i >run-loop-sender</i></span>,
let <span class='texttt'><i >rcvr</i></span> be an expression
such that <span class='texttt'><a href='exec.recv.concepts#concept:receiver_of' title='33.7.1&emsp;Receiver concepts&emsp;[exec.recv.concepts]'><span id='conceptref:receiver_of'><span class='texttt'>receiver_<span class='shy'></span>of</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, CS<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>
where <span class='texttt'>CS</span> is the <span class='texttt'>completion_<span class='shy'></span>signatures</span> specialization above<a class='hidden_link' href='#exec.run.loop.types-7.sentence-1'>.</a></div> <div id='exec.run.loop.types-7.sentence-2' class='sentence'>Let <span class='texttt'>C</span> be either <span class='texttt'>set_<span class='shy'></span>value_<span class='shy'></span>t</span> or <span class='texttt'>set_<span class='shy'></span>stopped_<span class='shy'></span>t</span><a class='hidden_link' href='#exec.run.loop.types-7.sentence-2'>.</a></div> <div id='exec.run.loop.types-7.sentence-3' class='sentence'>Then:
<ul class='itemize'><li id='exec.run.loop.types-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.run.loop.types-7.1'>(7.1)</a></div><div class='texpara'><div id='exec.run.loop.types-7.1.sentence-1' class='sentence'>The expression <span class='texttt'>connect<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span>, <span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span></span>
has type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>decay_<span class='shy'></span>t<span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='anglebracket'>&gt;</span></span>
and is potentially-throwing if and only if
<span class='texttt'><span class='parenthesis'>(</span><span class='keyword'>void</span><span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span>, <span class='keyword'>auto</span><span class='parenthesis'>(</span><span class='texttt'><i >rcvr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span> is potentially-throwing<a class='hidden_link' href='#exec.run.loop.types-7.1.sentence-1'>.</a></div></div></li><li id='exec.run.loop.types-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.run.loop.types-7.2'>(7.2)</a></div><div class='texpara'><div id='exec.run.loop.types-7.2.sentence-1' class='sentence'>The expression <span class='texttt'>get_<span class='shy'></span>completion_<span class='shy'></span>scheduler<span class='anglebracket'>&lt;</span>C<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>get_<span class='shy'></span>env<span class='parenthesis'>(</span><span class='texttt'><i >sndr</i></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span></span>
is potentially-throwing if and only if <span class='texttt'><i >sndr</i></span> is potentially-throwing,
has type <span class='texttt'><i >run-loop-scheduler</i></span>, and
compares equal to the <span class='texttt'><i >run-loop-<br>scheduler</i></span> instance
from which <span class='texttt'><i >sndr</i></span> was obtained<a class='hidden_link' href='#exec.run.loop.types-7.2.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='texpara'><div class='itemdecl' id='exec.run.loop.types-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.run.loop.types-itemdecl:3'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <span class='texttt'><i >run-loop-opstate</i></span>;
</code></div></div><div class='para' id='exec.run.loop.types-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6442'>#</a></div><div class='texpara'><div id='exec.run.loop.types-8.sentence-1' class='sentence'><span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>
inherits privately and unambiguously from <span class='texttt'><i >run-loop-opstate-base</i></span><a class='hidden_link' href='#exec.run.loop.types-8.sentence-1'>.</a></div></div></div><div class='para' id='exec.run.loop.types-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.types-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6446'>#</a></div><div class='texpara'><div id='exec.run.loop.types-9.sentence-1' class='sentence'>Let <span class='math'><span class='mathalpha'>o</span></span> be a non-const lvalue of type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span>,
and let <span class='texttt'>REC<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> be a non-const lvalue reference to an instance of type <span class='texttt'>Rcvr</span>
that was initialized with the expression <span class='texttt'><i >rcvr</i></span>
passed to the invocation of connect that returned <span class='math'><span class='mathalpha'>o</span></span><a class='hidden_link' href='#exec.run.loop.types-9.sentence-1'>.</a></div> <div id='exec.run.loop.types-9.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='exec.run.loop.types-9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.run.loop.types-9.1'>(9.1)</a></div>The object to which <span class='texttt'><span class='texttt'><i >REC</i></span><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> refers
remains valid for the lifetime of the object to which <span class='math'><span class='mathalpha'>o</span></span> refers.</li><li id='exec.run.loop.types-9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.run.loop.types-9.2'>(9.2)</a></div>The type <span class='texttt'><span class='texttt'><i >run-loop-opstate</i></span><span class='anglebracket'>&lt;</span>Rcvr<span class='anglebracket'>&gt;</span></span> overrides
<span class='texttt'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>&#x200b;::&#x200b;</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
such that <span class='texttt'><span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><span class='texttt'><i >execute</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>if</span> <span class='parenthesis'>(</span>get_stop_token<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_stopped<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>else</span> <span class='curlybracket'>{</span>
  set_value<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li><li id='exec.run.loop.types-9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#exec.run.loop.types-9.3'>(9.3)</a></div>The expression <span class='texttt'>start<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span></span> is equivalent to:
<span class='codeblock'><span class='keyword'>try</span> <span class='curlybracket'>{</span>
  <span class='math'><span class='mathalpha'>o</span></span><span class='operator'>.</span><i >loop</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >push-back</i><span class='parenthesis'>(</span>addressof<span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span> <span class='keyword'>catch</span><span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  set_error<span class='parenthesis'>(</span>std<span class='operator'>::</span>move<span class='parenthesis'>(</span><i >REC</i><span class='parenthesis'>(</span><span class='math'><span class='mathalpha'>o</span></span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>, current_exception<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></li></ul></div></div></div><div id='exec.run.loop.ctor' class='section'><h4 ><a class='secnum' href='#exec.run.loop.ctor' style='min-width:65pt'>33.12.1.3</a> Constructor and destructor <a class='abbr_ref' href='exec.run.loop.ctor'>[exec.run.loop.ctor]</a></h4></div><div class='texpara'><div id='lib:run_loop,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,constructor'>ðŸ”—</a></div><code class='itemdeclcode'>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div><div class='para' id='exec.run.loop.ctor-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.ctor-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6486'>#</a></div><div class='texpara'><div id='exec.run.loop.ctor-1.sentence-1' class='sentence'><i >Postconditions</i>: The <span class='texttt'>run_<span class='shy'></span>loop</span> instance's count is 0 and
its state is starting<a class='hidden_link' href='#exec.run.loop.ctor-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run_loop,destructor'>ðŸ”—</a></div><code class='itemdeclcode'><span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='exec.run.loop.ctor-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.ctor-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6498'>#</a></div><div class='texpara'><div id='exec.run.loop.ctor-2.sentence-1' class='sentence'><i >Effects</i>: If the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's count is not 0 or
if its state is running,
invokes <span class='texttt'>terminate</span> (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#exec.run.loop.ctor-2.sentence-1'>.</a></div> <div id='exec.run.loop.ctor-2.sentence-2' class='sentence'>Otherwise, has no effects<a class='hidden_link' href='#exec.run.loop.ctor-2.sentence-2'>.</a></div></div></div></div><div id='exec.run.loop.members' class='section'><h4 ><a class='secnum' href='#exec.run.loop.members' style='min-width:65pt'>33.12.1.4</a> Member functions <a class='abbr_ref' href='exec.run.loop.members'>[exec.run.loop.members]</a></h4></div><div class='texpara'><div class='itemdecl' id='exec.run.loop.members-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.run.loop.members-itemdecl:1'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> <span class='texttt'><i >pop-front</i></span><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.run.loop.members-1'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6513'>#</a></div><div class='texpara'><div id='exec.run.loop.members-1.sentence-1' class='sentence'><i >Effects</i>: Blocks (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>) until one of the following conditions is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='exec.run.loop.members-1.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.run.loop.members-1.1'>(1.1)</a></div>The <span class='texttt'>run_<span class='shy'></span>loop</span> instance's count is 0 and its state is finishing,
in which case <span class='texttt'><i >pop-front</i></span> sets the state to finished
and returns <span class='texttt'><span class='literal'>nullptr</span></span>; or</li><li id='exec.run.loop.members-1.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#exec.run.loop.members-1.2'>(1.2)</a></div>the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's count is greater than 0,
in which case an item is removed from the front of the queue,
the count is decremented by <span class='texttt'><span class='literal'>1</span></span>, and
the removed item is returned<a class='hidden_link' href='#exec.run.loop.members-1.sentence-1'>.</a></li></ul></div></div></div></div><div class='texpara'><div class='itemdecl' id='exec.run.loop.members-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#exec.run.loop.members-itemdecl:2'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> <span class='texttt'><i >push-back</i></span><span class='parenthesis'>(</span><span class='texttt'><i >run-loop-opstate-base</i></span><span class='operator'>*</span> item<span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='exec.run.loop.members-2'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6534'>#</a></div><div class='texpara'><div id='exec.run.loop.members-2.sentence-1' class='sentence'><i >Effects</i>: Adds <span class='texttt'>item</span> to the back of the queue and
increments the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's count by 1<a class='hidden_link' href='#exec.run.loop.members-2.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.run.loop.members-3'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6539'>#</a></div><div class='texpara'><div id='exec.run.loop.members-3.sentence-1' class='sentence'><i >Synchronization</i>: This operation synchronizes with
the <span class='texttt'><i >pop-front</i></span> operation that obtains <span class='texttt'>item</span><a class='hidden_link' href='#exec.run.loop.members-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,get_scheduler'><div id='lib:get_scheduler,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_scheduler,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='texttt'><i >run-loop-scheduler</i></span> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.run.loop.members-4'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6551'>#</a></div><div class='texpara'><div id='exec.run.loop.members-4.sentence-1' class='sentence'><i >Returns</i>: An instance of <span class='texttt'><i >run-loop-scheduler</i></span>
that can be used to schedule work onto this <span class='texttt'>run_<span class='shy'></span>loop</span> instance<a class='hidden_link' href='#exec.run.loop.members-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,run'><div id='lib:run,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:run,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.run.loop.members-5'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6563'>#</a></div><div class='texpara'><div id='exec.run.loop.members-5.sentence-1' class='sentence'><i >Preconditions</i>: The <span class='texttt'>run_<span class='shy'></span>loop</span> instance's state is either starting or finishing<a class='hidden_link' href='#exec.run.loop.members-5.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.run.loop.members-6'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-6'>6</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6567'>#</a></div><div class='texpara'><div id='exec.run.loop.members-6.sentence-1' class='sentence'><i >Effects</i>: If the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's state is starting,
sets the state to running,
otherwise leaves the state unchanged<a class='hidden_link' href='#exec.run.loop.members-6.sentence-1'>.</a></div> <div id='exec.run.loop.members-6.sentence-2' class='sentence'>Then, equivalent to:
<span class='codeblock'><span class='keyword'>while</span> <span class='parenthesis'>(</span><span class='keyword'>auto</span><span class='operator'>*</span> op <span class='operator'>=</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  op<span class='operator'>-</span><span class='anglebracket'>&gt;</span><i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></div><div class='para' id='exec.run.loop.members-7'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-7'>7</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6579'>#</a></div><div class='texpara'><div id='exec.run.loop.members-7.sentence-1' class='sentence'><i >Remarks</i>: When the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's state changes,
it does so without introducing data races<a class='hidden_link' href='#exec.run.loop.members-7.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:run_loop,finish'><div id='lib:finish,run_loop'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:finish,run_loop'>ðŸ”—</a></div><code class='itemdeclcode'><span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div></div><div class='para' id='exec.run.loop.members-8'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-8'>8</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6591'>#</a></div><div class='texpara'><div id='exec.run.loop.members-8.sentence-1' class='sentence'><i >Preconditions</i>: The <span class='texttt'>run_<span class='shy'></span>loop</span> instance's state is either starting or running<a class='hidden_link' href='#exec.run.loop.members-8.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.run.loop.members-9'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-9'>9</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6595'>#</a></div><div class='texpara'><div id='exec.run.loop.members-9.sentence-1' class='sentence'><i >Effects</i>: Changes the <span class='texttt'>run_<span class='shy'></span>loop</span> instance's state to finishing<a class='hidden_link' href='#exec.run.loop.members-9.sentence-1'>.</a></div></div></div></div><div class='para' id='exec.run.loop.members-10'><div class='marginalizedparent'><a class='marginalized' href='#exec.run.loop.members-10'>10</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/98ce5ac6fbce2338787adb9b1c842fcf8ebab37c/source/exec.tex#L6599'>#</a></div><div class='texpara'><div id='exec.run.loop.members-10.sentence-1' class='sentence'><i >Synchronization</i>: <span class='texttt'>finish</span> synchronizes with the <span class='texttt'><i >pop-front</i></span> operation
that returns <span class='texttt'><span class='literal'>nullptr</span></span><a class='hidden_link' href='#exec.run.loop.members-10.sentence-1'>.</a></div></div></div></div></div></body></html>