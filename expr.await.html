<!DOCTYPE html><html lang='en'><head><title>[expr.await]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>7</a> Expressions <a class='abbr_ref' href='./#expr'>[expr]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>7.6</a> Compound expressions <a class='abbr_ref' href='expr.compound#expr.await'>[expr.compound]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>7.6.2</a> Unary expressions <a class='abbr_ref' href='expr.unary#expr.await'>[expr.unary]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>7.6.2.4</a> Await <a class='abbr_ref'>[expr.await]</a></h4><div class='texpara'><a class='index' id=':expression,await'></a><a class='index' id=':co_await'></a></div><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L4865'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>The <span id=':co_await_'><span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span></span></span> expression is used to suspend evaluation of a
coroutine (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>) while awaiting completion of
the computation represented by the operand expression<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>Suspending the evaluation of a coroutine
transfers control to its caller or resumer<a class='hidden_link' href='#1.sentence-2'>.</a></div></div><div class='texpara'><div class='bnf' id='nt:await-expression'>
<a class='hidden_link' href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='nt:await-expression'><span id=':await-expression'>await-expression<span class='textnormal'>:</span></span></span></a><br/><span class='terminal'><span class='keyword'>co_await</span></span> <a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression'><span class='textsf'><i >cast-expression</i></span></span></a>
</div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L4877'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression'><span class='textsf'><i >await-expression</i></span></span></a> shall appear only as a potentially-evaluated
expression within the <a href='stmt.block#nt:compound-statement' title='8.4&emsp;Compound statement or block&emsp;[stmt.block]'><span id='ntref:compound-statement'><span class='textsf'><i >compound-statement</i></span></span></a> of a
<a href='dcl.fct.def.general#nt:function-body' title='9.5.1&emsp;General&emsp;[dcl.fct.def.general]'><span id='ntref:function-body'><span class='textsf'><i >function-body</i></span></span></a> or <a href='expr.prim.lambda.general#nt:lambda-expression' title='7.5.6.1&emsp;General&emsp;[expr.prim.lambda.general]'><span id='ntref:lambda-expression'><span class='textsf'><i >lambda-expression</i></span></span></a>,
in either case
outside of a <a href='except.pre#nt:handler' title='14.1&emsp;Preamble&emsp;[except.pre]'><span id='ntref:handler'><span class='textsf'><i >handler</i></span></span></a> (<a href='except.pre' title='14.1&emsp;Preamble'>[except.<span class='shy'></span>pre]</a>)<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>In a <a href='stmt.dcl#nt:declaration-statement' title='8.8&emsp;Declaration statement&emsp;[stmt.dcl]'><span id='ntref:declaration-statement'><span class='textsf'><i >declaration-statement</i></span></span></a> or in the
<a href='dcl.pre#nt:simple-declaration' title='9.1&emsp;Preamble&emsp;[dcl.pre]'><span id='ntref:simple-declaration'><span class='textsf'><i >simple-declaration</i></span></span></a> (if any)
of an <a href='stmt.pre#nt:init-statement' title='8.1&emsp;Preamble&emsp;[stmt.pre]'><span id='ntref:init-statement'><span class='textsf'><i >init-statement</i></span></span></a>, an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_'><span class='textsf'><i >await-expression</i></span></span></a>
shall appear only in an <a href='dcl.init.general#nt:initializer' title='9.4.1&emsp;General&emsp;[dcl.init.general]'><span id='ntref:initializer'><span class='textsf'><i >initializer</i></span></span></a> of that
<a href='stmt.dcl#nt:declaration-statement' title='8.8&emsp;Declaration statement&emsp;[stmt.dcl]'><span id='ntref:declaration-statement_'><span class='textsf'><i >declaration-statement</i></span></span></a> or <a href='dcl.pre#nt:simple-declaration' title='9.1&emsp;Preamble&emsp;[dcl.pre]'><span id='ntref:simple-declaration_'><span class='textsf'><i >simple-declaration</i></span></span></a><a class='hidden_link' href='#2.sentence-2'>.</a></div> <div id='2.sentence-3' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression__'><span class='textsf'><i >await-expression</i></span></span></a> shall not appear in a
default argument (<a href='dcl.fct.default' title='9.3.4.7&emsp;Default arguments'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>default]</a>)<a class='hidden_link' href='#2.sentence-3'>.</a></div> <div id='2.sentence-4' class='sentence'>An <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression___'><span class='textsf'><i >await-expression</i></span></span></a> shall not appear in the initializer of
a block variable with static or thread storage duration<a class='hidden_link' href='#2.sentence-4'>.</a></div> <div id='2.sentence-5' class='sentence'>A context within a function where an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression____'><span class='textsf'><i >await-expression</i></span></span></a> can appear
is called a <a class='hidden_link' href='#def:suspension_context' id='def:suspension_context'><i>suspension context</i></a> of the function<a class='hidden_link' href='#2.sentence-5'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L4895'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Evaluation of an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_____'><span class='textsf'><i >await-expression</i></span></span></a> involves the following
auxiliary types, expressions, and objects:
<ul class='itemize'><li id='3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.1'>(3.1)</a></div><div class='texpara'><div id='3.1.sentence-1' class='sentence'><i >p</i> is an lvalue naming the promise
object (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)
of the enclosing coroutine and <span class='texttt'>P</span> is the type of that object<a class='hidden_link' href='#3.1.sentence-1'>.</a></div></div></li><li id='3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.2'>(3.2)</a></div><div class='texpara'><div id='3.2.sentence-1' class='sentence'>Unless
the <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression______'><span class='textsf'><i >await-expression</i></span></span></a> was implicitly produced by
a <a href='expr.yield#nt:yield-expression' title='7.6.17&emsp;Yielding a value&emsp;[expr.yield]'><span id='ntref:yield-expression'><span class='textsf'><i >yield-expression</i></span></span></a> (<a href='expr.yield' title='7.6.17&emsp;Yielding a value'>[expr.<span class='shy'></span>yield]</a>),
an initial await expression,
or a final await expression (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>),
a search is performed for the name <span class='texttt'>await_<span class='shy'></span>transform</span>
in the scope of <span class='texttt'>P</span>  (<a href='class.member.lookup' title='6.5.2&emsp;Member name lookup'>[class.<span class='shy'></span>member.<span class='shy'></span>lookup]</a>)<a class='hidden_link' href='#3.2.sentence-1'>.</a></div> <div id='3.2.sentence-2' class='sentence'>If this search is performed and finds at least one declaration,
then <i >a</i> is
<span class='mbox'><i >p</i><span class='texttt'><span class='operator'>.</span>await_<span class='shy'></span>transform<span class='parenthesis'>(</span></span><a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression_'><span class='textsf'><i >cast-expression</i></span></span></a><span class='texttt'><span class='parenthesis'>)</span></span></span>;
otherwise, <i >a</i> is the  <a href='expr.cast#nt:cast-expression' title='7.6.3&emsp;Explicit type conversion (cast notation)&emsp;[expr.cast]'><span id='ntref:cast-expression__'><span class='textsf'><i >cast-expression</i></span></span></a><a class='hidden_link' href='#3.2.sentence-2'>.</a></div></div></li><li id='3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.3'>(3.3)</a></div><div class='texpara'><div id='3.3.sentence-1' class='sentence'><i >o</i> is determined by enumerating the applicable
<span class='texttt'><span id=':operator'><span class='texttt'><span class='keyword'>operator</span></span></span> <span id=':co_await__'><span class='texttt'><span class='keyword'>co_<span class='shy'></span>await</span></span></span></span> functions for an argument
<i >a</i> (<a href='over.match.oper' title='12.2.2.3&emsp;Operators in expressions'>[over.<span class='shy'></span>match.<span class='shy'></span>oper]</a>), and choosing the best one through
overload resolution (<a href='over.match' title='12.2&emsp;Overload resolution'>[over.<span class='shy'></span>match]</a>)<a class='hidden_link' href='#3.3.sentence-1'>.</a></div> <div id='3.3.sentence-2' class='sentence'>If overload resolution is ambiguous,
the program is ill-formed<a class='hidden_link' href='#3.3.sentence-2'>.</a></div> <div id='3.3.sentence-3' class='sentence'>If no viable functions are found, <i >o</i> is <i >a</i><a class='hidden_link' href='#3.3.sentence-3'>.</a></div> <div id='3.3.sentence-4' class='sentence'>Otherwise, <i >o</i> is a call to the selected function
with the argument <i >a</i><a class='hidden_link' href='#3.3.sentence-4'>.</a></div> <div id='3.3.sentence-5' class='sentence'>If <i >o</i> would be a prvalue,
the temporary materialization conversion (<a href='conv.rval' title='7.3.5&emsp;Temporary materialization conversion'>[conv.<span class='shy'></span>rval]</a>) is applied<a class='hidden_link' href='#3.3.sentence-5'>.</a></div></div></li><li id='3.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.4'>(3.4)</a></div><div class='texpara'><div id='3.4.sentence-1' class='sentence'><i >e</i> is an lvalue
referring to the result of evaluating
the (possibly-converted) <i >o</i><a class='hidden_link' href='#3.4.sentence-1'>.</a></div></div></li><li id='3.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.5'>(3.5)</a></div><div class='texpara'><div id='3.5.sentence-1' class='sentence'><i >h</i> is an object of type
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span>P<span class='anglebracket'>&gt;</span></span>
referring to the enclosing coroutine<a class='hidden_link' href='#3.5.sentence-1'>.</a></div></div></li><li id='3.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.6'>(3.6)</a></div><div class='texpara'><div id='3.6.sentence-1' class='sentence'><i >await-ready</i> is the expression
<i >e</i><span class='texttt'><span class='operator'>.</span>await_<span class='shy'></span>ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>,
contextually converted to <span class='texttt'><span class='keyword'>bool</span></span><a class='hidden_link' href='#3.6.sentence-1'>.</a></div></div></li><li id='3.7'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.7'>(3.7)</a></div><div class='texpara'><div id='3.7.sentence-1' class='sentence'><i >await-suspend</i> is the expression
<i >e</i><span class='texttt'><span class='operator'>.</span>await_<span class='shy'></span>suspend<span class='parenthesis'>(</span></span><i >h</i><span class='texttt'><span class='parenthesis'>)</span></span>,
which shall be a prvalue of type <span id=':void'><span class='texttt'><span class='keyword'>void</span></span></span>, <span id=':bool'><span class='texttt'><span class='keyword'>bool</span></span></span>, or
<span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span>Z<span class='anglebracket'>&gt;</span></span> for some type <span class='texttt'>Z</span><a class='hidden_link' href='#3.7.sentence-1'>.</a></div></div></li><li id='3.8'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#3.8'>(3.8)</a></div><div class='texpara'><div id='3.8.sentence-1' class='sentence'><i >await-resume</i> is the expression
<i >e</i><span class='texttt'><span class='operator'>.</span>await_<span class='shy'></span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span><a class='hidden_link' href='#3.8.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L4958'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>The <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_______'><span class='textsf'><i >await-expression</i></span></span></a> has the same type and value category
as the <i >await-resume</i> expression<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L4962'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>The <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression________'><span class='textsf'><i >await-expression</i></span></span></a> evaluates
the (possibly-converted) <i >o</i> expression and
the <i >await-ready</i> expression, then:
<ul class='itemize'><li id='5.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#5.1'>(5.1)</a></div><div class='texpara'><div id='5.1.sentence-1' class='sentence'>If the result of <i >await-ready</i> is <span id=':false'><span class='texttt'><span class='literal'>false</span></span></span>,
the coroutine is considered suspended<a class='hidden_link' href='#5.1.sentence-1'>.</a></div> <div id='5.1.sentence-2' class='sentence'>Then:
<ul class='itemize'><li id='5.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.1'>(5.1.1)</a></div><div class='texpara'><div id='5.1.1.sentence-1' class='sentence'>If the type of <i >await-suspend</i>
is <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>coroutine_<span class='shy'></span>handle<span class='anglebracket'>&lt;</span>Z<span class='anglebracket'>&gt;</span></span>,
<i >await-suspend</i><span class='texttt'><span class='operator'>.</span>resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is evaluated<a class='hidden_link' href='#5.1.1.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='5.1.1.sentence-2' class='sentence'>This resumes the coroutine referred to
by the result of <i >await-suspend</i><a class='hidden_link' href='#5.1.1.sentence-2'>.</a></div> <div id='5.1.1.sentence-3' class='sentence'>Any number of coroutines can be successively resumed in this fashion,
eventually returning control flow to the current coroutine caller or
resumer (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)<a class='hidden_link' href='#5.1.1.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></li><li id='5.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.2'>(5.1.2)</a></div><div class='texpara'><div id='5.1.2.sentence-1' class='sentence'>Otherwise, if the type of <i >await-suspend</i>
is <span id=':bool_'><span class='texttt'><span class='keyword'>bool</span></span></span>,
<i >await-suspend</i> is evaluated,
and the coroutine is resumed if the result is <span id=':false_'><span class='texttt'><span class='literal'>false</span></span></span><a class='hidden_link' href='#5.1.2.sentence-1'>.</a></div></div></li><li id='5.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#5.1.3'>(5.1.3)</a></div><div class='texpara'><div id='5.1.3.sentence-1' class='sentence'>Otherwise, <i >await-suspend</i> is evaluated<a class='hidden_link' href='#5.1.3.sentence-1'>.</a></div></div></li></ul></div> <div id='5.1.sentence-3' class='sentence'>
If the evaluation of <i >await-suspend</i>
exits via an exception, the exception is caught,
the coroutine is resumed, and the exception is immediately
rethrown (<a href='except.throw' title='14.2&emsp;Throwing an exception'>[except.<span class='shy'></span>throw]</a>)<a class='hidden_link' href='#5.1.sentence-3'>.</a></div> <div id='5.1.sentence-4' class='sentence'>Otherwise, control flow returns
to the current coroutine caller or resumer (<a href='dcl.fct.def.coroutine' title='9.5.4&emsp;Coroutine definitions'>[dcl.<span class='shy'></span>fct.<span class='shy'></span>def.<span class='shy'></span>coroutine]</a>)
without exiting any scopes (<a href='stmt.jump' title='8.7&emsp;Jump statements'>[stmt.<span class='shy'></span>jump]</a>)<a class='hidden_link' href='#5.1.sentence-4'>.</a></div> <div id='5.1.sentence-5' class='sentence'><a class='index' id=':coroutine,suspend_point'></a>The point in the coroutine
immediately prior to control returning to its caller or resumer
is a coroutine <a class='hidden_link' href='#def:suspend_point' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='def:suspend_point'><i >suspend point</i></span></a><a class='hidden_link' href='#5.1.sentence-5'>.</a></div></div></li><li id='5.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#5.2'>(5.2)</a></div><div class='texpara'><div id='5.2.sentence-1' class='sentence'>If the result of <i >await-ready</i> is <span id=':true'><span class='texttt'><span class='literal'>true</span></span></span>,
or when the coroutine is resumed
other than by rethrowing an exception from <i >await-suspend</i>,
the <i >await-resume</i> expression is evaluated, and
its result is the result of the <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression_________'><span class='textsf'><i >await-expression</i></span></span></a><a class='hidden_link' href='#5.2.sentence-1'>.</a></div></div></li></ul></div> <div id='note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-2'>2</a></i>:&ensp;<div id='5.sentence-2' class='sentence'>With respect to sequencing,
an <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression__________'><span class='textsf'><i >await-expression</i></span></span></a> is indivisible (<a href='intro.execution' title='6.9.1&emsp;Sequential execution'>[intro.<span class='shy'></span>execution]</a>)<a class='hidden_link' href='#5.sentence-2'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para nonNormativeOnly' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/expressions.tex#L5016'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<span class='codeblock'><span class='keyword'>template</span> <span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span>
<span class='keyword'>struct</span> my_future <span class='curlybracket'>{</span>
  <span class='comment'>/* ... */</span>
  <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>std<span class='operator'>::</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
  T await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>;

<span class='keyword'>template</span> <span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rep, <span class='keyword'>class</span> Period<span class='anglebracket'>&gt;</span>
<span class='keyword'>auto</span> <span class='keyword'>operator</span> <span class='keyword'>co_await</span><span class='parenthesis'>(</span>std<span class='operator'>::</span>chrono<span class='operator'>::</span>duration<span class='anglebracket'>&lt;</span>Rep, Period<span class='anglebracket'>&gt;</span> d<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  <span class='keyword'>struct</span> awaiter <span class='curlybracket'>{</span>
    std<span class='operator'>::</span>chrono<span class='operator'>::</span>system_clock<span class='operator'>::</span>duration duration;
    <span class='comment'>/* ... */</span>
    awaiter<span class='parenthesis'>(</span>std<span class='operator'>::</span>chrono<span class='operator'>::</span>system_clock<span class='operator'>::</span>duration d<span class='parenthesis'>)</span> <span class='operator'>:</span> duration<span class='parenthesis'>(</span>d<span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='keyword'>bool</span> await_ready<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> duration<span class='operator'>.</span>count<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='anglebracket'>&lt;</span><span class='operator'>=</span> <span class='literal'>0</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_resume<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='keyword'>void</span> await_suspend<span class='parenthesis'>(</span>std<span class='operator'>::</span>coroutine_handle<span class='anglebracket'>&lt;</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='comment'>/* ... */</span> <span class='curlybracket'>}</span>
  <span class='curlybracket'>}</span>;
  <span class='keyword'>return</span> awaiter<span class='curlybracket'>{</span>d<span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>using</span> <span class='keyword'>namespace</span> std<span class='operator'>::</span>chrono;

my_future<span class='anglebracket'>&lt;</span><span class='keyword'>int</span><span class='anglebracket'>&gt;</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

my_future<span class='anglebracket'>&lt;</span><span class='keyword'>void</span><span class='anglebracket'>&gt;</span> g<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> <span class='literal'>"just about to go to sleep...\n"</span>;
  <span class='keyword'>co_await</span> <span class='literal'>10ms</span>;
  std<span class='operator'>::</span>cout <span class='anglebracket'>&lt;</span><span class='anglebracket'>&lt;</span> <span class='literal'>"resumed\n"</span>;
  <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>

<span class='keyword'>auto</span> f<span class='parenthesis'>(</span><span class='keyword'>int</span> x <span class='operator'>=</span> <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>;   <span class='comment'>// error: <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression___________'><span class='textsf'><i >await-expression</i></span></span></a> outside of function suspension context</span>
<span class='keyword'>int</span> a<span class='squarebracket'>[</span><span class='squarebracket'>]</span> <span class='operator'>=</span> <span class='curlybracket'>{</span> <span class='keyword'>co_await</span> h<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span>;     <span class='comment'>// error: <a href='#nt:await-expression' title='7.6.2.4&emsp;Await&emsp;[expr.await]'><span id='ntref:await-expression____________'><span class='textsf'><i >await-expression</i></span></span></a> outside of function suspension context</span>
</span> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>