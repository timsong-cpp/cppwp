<!DOCTYPE html><html lang='en'><head><title>[module.context]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>10</a> Modules <a class='abbr_ref' href='./#module'>[module]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>10.6</a> Instantiation context <a class='abbr_ref'>[module.context]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L878'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>The <a class='hidden_link' href='#def:instantiation_context' title='10.6&emsp;Instantiation context&emsp;[module.context]'><span id='def:instantiation_context'><i >instantiation context</i></span></a> is a set of points within the program
that determines which declarations are found by
argument-dependent name lookup (<a href='basic.lookup.argdep' title='6.5.4&emsp;Argument-dependent name lookup'>[basic.<span class='shy'></span>lookup.<span class='shy'></span>argdep]</a>)
and which are reachable (<a href='module.reach' title='10.7&emsp;Reachability'>[module.<span class='shy'></span>reach]</a>)
in the context of a particular declaration or template instantiation<a class='hidden_link' href='#1.sentence-1'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L885'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>During the implicit definition of
a defaulted function (<a href='special' title='11.4.4&emsp;Special member functions'>[special]</a>, <a href='class.compare.default' title='11.10.1&emsp;Defaulted comparison operator functions'>[class.<span class='shy'></span>compare.<span class='shy'></span>default]</a>),
the instantiation context contains each point in
the instantiation context from the definition of the class and
each point in
the instantiation context of the program construct that
resulted in the implicit definition of the defaulted function<a class='hidden_link' href='#2.sentence-1'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L894'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>During the implicit instantiation of a template
whose point of instantiation is specified as
that of an enclosing specialization (<a href='temp.point' title='13.8.4.1&emsp;Point of instantiation'>[temp.<span class='shy'></span>point]</a>),
the instantiation context contains each point in
the instantiation context of the enclosing specialization and,
if the template is defined in a module interface unit of a module <span class='math'><span class='mathalpha'>M</span></span>
and the point of instantiation is not in a module interface unit of <span class='math'><span class='mathalpha'>M</span></span>,
the point at the end of the
<a href='dcl.pre#nt:declaration-seq' title='9.1&emsp;Preamble&emsp;[dcl.pre]'><span id='ntref:declaration-seq'><span class='textsf'><i >declaration-seq</i></span></span></a> of the
primary module interface unit of <span class='math'><span class='mathalpha'>M</span></span>
(prior to the <a href='module.private.frag#nt:private-module-fragment' title='10.5&emsp;Private module fragment&emsp;[module.private.frag]'><span id='ntref:private-module-fragment'><span class='textsf'><i >private-module-fragment</i></span></span></a>, if any)<a class='hidden_link' href='#3.sentence-1'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L907'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'>During the implicit instantiation of a template
that is implicitly instantiated because it is referenced
from within the implicit definition of a defaulted function,
the instantiation context contains each point in the instantiation context of
the defaulted function<a class='hidden_link' href='#4.sentence-1'>.</a></div></div></div><div class='para' id='5'><div class='marginalizedparent'><a class='marginalized' href='#5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L914'>#</a></div><div class='texpara'><div id='5.sentence-1' class='sentence'>During the instantiation of any other template specialization,
the instantiation context contains the point of instantiation
of the template<a class='hidden_link' href='#5.sentence-1'>.</a></div></div></div><div class='para' id='6'><div class='marginalizedparent'><a class='marginalized' href='#6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L919'>#</a></div><div class='texpara'><div id='6.sentence-1' class='sentence'>During the implicit instantiation of any construct
that resulted from the evaluation of an expression
as a core constant expression,
the instantiation context contains
each point in the evaluation context (<a href='expr.const' title='7.7&emsp;Constant expressions'>[expr.<span class='shy'></span>const]</a>)<a class='hidden_link' href='#6.sentence-1'>.</a></div> <div id='note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#note-1'>1</a></i>:&ensp;<div id='6.sentence-2' class='sentence'>Implicit instantiations can result
from invocations of library functions (<a href='meta.reflection' title='21.4&emsp;Reflection'>[meta.<span class='shy'></span>reflection]</a>)<a class='hidden_link' href='#6.sentence-2'>.</a></div> <div id='6.sentence-3' class='sentence'>The evaluation context can include synthesized points
associated with injected declarations
produced by <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>meta<span class='operator'>&#x200b;::&#x200b;</span>define_<span class='shy'></span>aggregate</span> (<a href='meta.reflection.define.aggregate' title='21.4.16&emsp;Reflection class definition generation'>[meta.<span class='shy'></span>reflection.<span class='shy'></span>define.<span class='shy'></span>aggregate]</a>)<a class='hidden_link' href='#6.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div><div class='para' id='7'><div class='marginalizedparent'><a class='marginalized' href='#7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L933'>#</a></div><div class='texpara'><div id='7.sentence-1' class='sentence'>In any other case, the instantiation context
at a point within the program
contains that point<a class='hidden_link' href='#7.sentence-1'>.</a></div></div></div><div class='para' id='8'><div class='marginalizedparent'><a class='marginalized' href='#8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L938'>#</a></div><div class='texpara'><div id='8.sentence-1' class='sentence'>The instantiation context contains only the points specified above<a class='hidden_link' href='#8.sentence-1'>.</a></div></div></div><div class='para nonNormativeOnly' id='9'><div class='marginalizedparent'><a class='marginalized' href='#9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/1d9fdb066e95b7be58881f24977a20a51359097c/source/modules.tex#L941'>#</a></div><div class='texpara'><div id='example-1' class='example'><div class='texpara'>[<i>Example&nbsp;<a href='#example-1'>1</a></i>:&ensp;<p>Translation unit #1:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T, <span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> foo<span class='parenthesis'>(</span>T, U u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>auto</span> v <span class='operator'>=</span> u; <span class='curlybracket'>}</span>
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T, <span class='keyword'>typename</span> U<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> bar<span class='parenthesis'>(</span>T, U u<span class='parenthesis'>)</span> <span class='curlybracket'>{</span> <span class='keyword'>auto</span> v <span class='operator'>=</span> <span class='operator'>*</span>u; <span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Translation unit #2:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> M1;
<span class='keyword'>import</span> <span class='literal'>"defn.h"</span>;        <span class='comment'>// provides <span class='tcode_in_codeblock'>struct X {};</span></span>
<span class='keyword'>import</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> f<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  X x;
  foo<span class='parenthesis'>(</span>t, x<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Translation unit #3:<span class='codeblock'><span class='keyword'>export</span> <span class='keyword'>module</span> M2;
<span class='keyword'>import</span> <span class='literal'>"decl.h"</span>;        <span class='comment'>// provides <span class='tcode_in_codeblock'>struct X;</span> (not a definition)</span>
<span class='keyword'>import</span> stuff;
<span class='keyword'>export</span> <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>typename</span> T<span class='anglebracket'>&gt;</span> <span class='keyword'>void</span> g<span class='parenthesis'>(</span>T t<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  X <span class='operator'>*</span>x;
  bar<span class='parenthesis'>(</span>t, x<span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span></div><div class='texpara'><p>Translation unit #4:<span class='codeblock'><span class='keyword'>import</span> M1;
<span class='keyword'>import</span> M2;
<span class='keyword'>void</span> test<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
  f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;
  g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span>;
<span class='curlybracket'>}</span>
</span> <div id='9.sentence-1' class='sentence'>
The call to <span class='texttt'>f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span> is valid;
the instantiation context of <span class='texttt'>foo<span class='anglebracket'>&lt;</span><span class='keyword'>int</span>, X<span class='anglebracket'>&gt;</span></span> comprises
<ul class='itemize'><li id='9.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.1'>(9.1)</a></div>the point at the end of translation unit #1,</li><li id='9.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.2'>(9.2)</a></div>the point at the end of translation unit #2, and</li><li id='9.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.3'>(9.3)</a></div>the point of the call to <span class='texttt'>f<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span>,</li></ul>
so the definition of <span class='texttt'>X</span> is reachable (<a href='module.reach' title='10.7&emsp;Reachability'>[module.<span class='shy'></span>reach]</a>)<a class='hidden_link' href='#9.sentence-1'>.</a></div></div><div class='texpara'><div id='9.sentence-2' class='sentence'>It is unspecified whether the call to <span class='texttt'>g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span> is valid:
the instantiation context of <span class='texttt'>bar<span class='anglebracket'>&lt;</span><span class='keyword'>int</span>, X<span class='anglebracket'>&gt;</span></span> comprises
<ul class='itemize'><li id='9.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.4'>(9.4)</a></div>the point at the end of translation unit #1,</li><li id='9.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.5'>(9.5)</a></div>the point at the end of translation unit #3, and</li><li id='9.6'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#9.6'>(9.6)</a></div>the point of the call to <span class='texttt'>g<span class='parenthesis'>(</span><span class='literal'>0</span><span class='parenthesis'>)</span></span>,</li></ul>
so the definition of <span class='texttt'>X</span> need not be reachable,
as described in <a href='module.reach' title='10.7&emsp;Reachability'>[module.<span class='shy'></span>reach]</a><a class='hidden_link' href='#9.sentence-2'>.</a></div> —&nbsp;<i>end example</i>]</div></div></div></div></div></body></html>