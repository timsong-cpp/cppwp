<!DOCTYPE html><html lang='en'><head><title>[cpp.subst]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:73pt'>15</a> Preprocessing directives <a class='abbr_ref' href='./#cpp'>[cpp]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>15.6</a> Macro replacement <a class='abbr_ref' href='cpp.replace#cpp.subst'>[cpp.replace]</a></h2><h3 ><a class='secnum' style='min-width:103pt'>15.6.1</a> Argument substitution <a class='abbr_ref'>[cpp.subst]</a></h3><span class='indexparent'><a class='index' id=':macro,argument_substitution'></a></span>
<span class='indexparent'><a class='index' id=':__VA_OPT__'></a></span><pre class='bnf'><a class='nontermdef' href='#nt:va-opt-replacement' id='nt:va-opt-replacement'>va-opt-replacement:</a>
&#9;<span class='terminal'><span class='texttt'>__VA_&shy;OPT__</span> <span class='parenthesis'>(</span></span> <a class='grammarterm' href='cpp.pre#nt:pp-tokens'>pp-tokens</a><span class="mjx-chtml"><span class="mjx-math"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mi"><span class="mjx-char"></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mstyle" style="font-size: 113.1%; color: black;"><span class="mjx-mrow" style="font-size: 88.4%;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">o</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.225em; padding-bottom: 0.446em;">p</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-main-I" style="padding-top: 0.372em; padding-bottom: 0.298em;">t</span></span></span></span></span></span></span></span></span> <span class='terminal'><span class='parenthesis'>)</span></span>
</pre><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f30ae8fa2e8023bb070d9a6225063168f278cbb2/source/preprocessor.tex#L1142'>#</a></div><div id='1.sentence-1' class='sentence'>After the arguments for the invocation of a function-like macro have
been identified, argument substitution takes place<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>For each parameter in the replacement list that is neither
preceded by a <span class='texttt'><span class='preprocessordirective'>#</span></span> or <span class='texttt'><span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span></span> preprocessing token nor
followed by a <span class='texttt'><span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span></span> preprocessing token, the preprocessing tokens
naming the parameter are replaced by a token sequence determined as follows:
<ul class='itemize'><li id='1.1'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.1'>(1.1)</a></div>If the parameter is of the form <a class='grammarterm' href='#nt:va-opt-replacement'>va-opt-replacement</a>,
  the replacement preprocessing tokens are the
  preprocessing token sequence for the corresponding argument,
  as specified below.</li><li id='1.2'><div class='marginalizedparent' style='left:-7em'><a class='marginalized' href='#1.2'>(1.2)</a></div>Otherwise, the replacement preprocessing tokens are the
  preprocessing tokens of corresponding argument after all
  macros contained therein have been expanded. The argument's
  preprocessing tokens are completely macro replaced before
  being substituted as if they formed the rest of the preprocessing
  file with no other preprocessing tokens being available.</li></ul></div> <div id='1.example-1' class='example'>[&nbsp;<a class='example_link' href='#1.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='preprocessordirective'>#define</span> LPAREN<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='parenthesis'>(</span>
<span class='preprocessordirective'>#define</span> G<span class='parenthesis'>(</span>Q<span class='parenthesis'>)</span> <span class='literal'>42</span>
<span class='preprocessordirective'>#define</span> F<span class='parenthesis'>(</span>R, X, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>  __VA_OPT__<span class='parenthesis'>(</span>G R X<span class='parenthesis'>)</span> <span class='parenthesis'>)</span>
<span class='keyword'>int</span> x <span class='operator'>=</span> F<span class='parenthesis'>(</span>LPAREN<span class='parenthesis'>(</span><span class='parenthesis'>)</span>, <span class='literal'>0</span>, <span class='anglebracket'>&lt;</span><span class='operator'>:</span><span class='operator'>-</span><span class='parenthesis'>)</span>;    <span class='comment'>// replaced by <span class='tcode_in_codeblock'>int x = 42;</span></span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f30ae8fa2e8023bb070d9a6225063168f278cbb2/source/preprocessor.tex#L1172'>#</a></div><div id='2.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':__VA_ARGS__'></a></span>An identifier <span class='texttt'>__VA_&shy;ARGS__</span> that occurs in the replacement list
shall be treated as if it were a parameter, and the variable arguments shall form
the preprocessing tokens used to replace it<a class='hidden_link' href='#2.sentence-1'>.</a></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f30ae8fa2e8023bb070d9a6225063168f278cbb2/source/preprocessor.tex#L1178'>#</a></div><div id='3.example-1' class='example'>[&nbsp;<a class='example_link' href='#3.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <div id='3.sentence-1' class='sentence'><pre class='codeblock'>
<span class='preprocessordirective'>#define</span> debug<span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> fprintf<span class='parenthesis'>(</span>stderr, __VA_ARGS__<span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> showlist<span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> puts<span class='parenthesis'>(</span><span class='preprocessordirective'>#</span>__VA_ARGS__<span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> report<span class='parenthesis'>(</span>test, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='parenthesis'>(</span><span class='parenthesis'>(</span>test<span class='parenthesis'>)</span> <span class='operator'>?</span> puts<span class='parenthesis'>(</span><span class='preprocessordirective'>#</span>test<span class='parenthesis'>)</span> <span class='operator'>:</span> printf<span class='parenthesis'>(</span>__VA_ARGS__<span class='parenthesis'>)</span><span class='parenthesis'>)</span>
debug<span class='parenthesis'>(</span><span class='literal'>"Flag"</span><span class='parenthesis'>)</span>;
debug<span class='parenthesis'>(</span><span class='literal'>"X = %d\n"</span>, x<span class='parenthesis'>)</span>;
showlist<span class='parenthesis'>(</span>The first, second, and third items<span class='operator'>.</span><span class='parenthesis'>)</span>;
report<span class='parenthesis'>(</span>x<span class='anglebracket'>&gt;</span>y, <span class='literal'>"x is %d but y is %d"</span>, x, y<span class='parenthesis'>)</span>;
</pre>
results in
<pre class='codeblock'>
fprintf<span class='parenthesis'>(</span>stderr, <span class='literal'>"Flag"</span><span class='parenthesis'>)</span>;
fprintf<span class='parenthesis'>(</span>stderr, <span class='literal'>"X = %d\n"</span>, x<span class='parenthesis'>)</span>;
puts<span class='parenthesis'>(</span><span class='literal'>"The first, second, and third items."</span><span class='parenthesis'>)</span>;
<span class='parenthesis'>(</span><span class='parenthesis'>(</span>x<span class='anglebracket'>&gt;</span>y<span class='parenthesis'>)</span> <span class='operator'>?</span> puts<span class='parenthesis'>(</span><span class='literal'>"x&gt;y"</span><span class='parenthesis'>)</span> <span class='operator'>:</span> printf<span class='parenthesis'>(</span><span class='literal'>"x is %d but y is %d"</span>, x, y<span class='parenthesis'>)</span><span class='parenthesis'>)</span>;
</pre></div> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/f30ae8fa2e8023bb070d9a6225063168f278cbb2/source/preprocessor.tex#L1198'>#</a></div><div id='4.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':__VA_OPT___'></a></span>The identifier <span class='texttt'>__VA_&shy;OPT__</span>
shall always occur as part of the preprocessing token sequence
<a class='grammarterm' href='#nt:va-opt-replacement'>va-opt-replacement</a>;
its closing <span class='texttt'><span class='parenthesis'>)</span></span> is determined by skipping
intervening pairs of matching left and right parentheses
in its <a class='grammarterm' href='cpp.pre#nt:pp-tokens'>pp-tokens</a><a class='hidden_link' href='#4.sentence-1'>.</a></div> <div id='4.sentence-2' class='sentence'>The <a class='grammarterm' href='cpp.pre#nt:pp-tokens'>pp-tokens</a> of a <a class='grammarterm' href='#nt:va-opt-replacement'>va-opt-replacement</a>
shall not contain <span class='texttt'>__VA_&shy;OPT__</span><a class='hidden_link' href='#4.sentence-2'>.</a></div> <div id='4.sentence-3' class='sentence'>If the <a class='grammarterm' href='cpp.pre#nt:pp-tokens'>pp-tokens</a> would be ill-formed
as the replacement list of the current function-like macro,
the program is ill-formed<a class='hidden_link' href='#4.sentence-3'>.</a></div> <div id='4.sentence-4' class='sentence'>A <a class='grammarterm' href='#nt:va-opt-replacement'>va-opt-replacement</a> is treated as if it were a parameter,
and the preprocessing token sequence for the corresponding
argument is defined as follows<a class='hidden_link' href='#4.sentence-4'>.</a></div> <div id='4.sentence-5' class='sentence'>If the substitution of <span class='texttt'>__VA_&shy;ARGS__</span> as neither an operand
of <span class='texttt'><span class='preprocessordirective'>#</span></span> nor <span class='texttt'><span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span></span> consists of no preprocessing tokens,
the argument consists of
a single placemarker preprocessing token (<a href='cpp.concat'>[cpp.concat]</a>, <a href='cpp.rescan'>[cpp.rescan]</a>)<a class='hidden_link' href='#4.sentence-5'>.</a></div> <div id='4.sentence-6' class='sentence'>Otherwise, the argument consists of
the results of the expansion of the contained <a class='grammarterm' href='cpp.pre#nt:pp-tokens'>pp-tokens</a>
as the replacement list of the current function-like macro
before removal of placemarker tokens, rescanning, and further replacement<a class='hidden_link' href='#4.sentence-6'>.</a></div> <div id='4.note-1' class='note'>[&nbsp;<a class='note_link' href='#4.note-1'><span class='textit'>Note</span></a><div class='noteBody'><span class='textit'>:</span> <div id='4.sentence-7' class='sentence'>The placemarker tokens are removed before stringization (<a href='cpp.stringize'>[cpp.stringize]</a>),
and can be removed by rescanning and further replacement (<a href='cpp.rescan'>[cpp.rescan]</a>)<a class='hidden_link' href='#4.sentence-7'>.</a></div> —&nbsp;<i>end note</i></div>&nbsp;]</div>  <div id='4.example-1' class='example'>[&nbsp;<a class='example_link' href='#4.example-1'><span class='textit'>Example</span></a><div class='exampleBody'><span class='textit'>:</span> <pre class='codeblock'>
<span class='preprocessordirective'>#define</span> F<span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>           f<span class='parenthesis'>(</span><span class='literal'>0</span> __VA_OPT__<span class='parenthesis'>(</span>,<span class='parenthesis'>)</span> __VA_ARGS__<span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> G<span class='parenthesis'>(</span>X, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span>        f<span class='parenthesis'>(</span><span class='literal'>0</span>, X __VA_OPT__<span class='parenthesis'>(</span>,<span class='parenthesis'>)</span> __VA_ARGS__<span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> SDEF<span class='parenthesis'>(</span>sname, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> S sname __VA_OPT__<span class='parenthesis'>(</span><span class='operator'>=</span> <span class='curlybracket'>{</span> __VA_ARGS__ <span class='curlybracket'>}</span><span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> EMP

F<span class='parenthesis'>(</span>a, b, c<span class='parenthesis'>)</span>          <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0, a, b, c)</span></span>
F<span class='parenthesis'>(</span><span class='parenthesis'>)</span>                 <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0)</span></span>
F<span class='parenthesis'>(</span>EMP<span class='parenthesis'>)</span>              <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0)</span></span>

G<span class='parenthesis'>(</span>a, b, c<span class='parenthesis'>)</span>          <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0, a, b, c)</span></span>
G<span class='parenthesis'>(</span>a, <span class='parenthesis'>)</span>              <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0, a)</span></span>
G<span class='parenthesis'>(</span>a<span class='parenthesis'>)</span>                <span class='comment'>// replaced by <span class='tcode_in_codeblock'>f(0, a)</span></span>

SDEF<span class='parenthesis'>(</span>foo<span class='parenthesis'>)</span>;          <span class='comment'>// replaced by <span class='tcode_in_codeblock'>S foo;</span></span>
SDEF<span class='parenthesis'>(</span>bar, <span class='literal'>1</span>, <span class='literal'>2</span><span class='parenthesis'>)</span>;    <span class='comment'>// replaced by <span class='tcode_in_codeblock'>S bar = { 1, 2 };</span></span>

<span class='preprocessordirective'>#define</span> H1<span class='parenthesis'>(</span>X, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> X __VA_OPT__<span class='parenthesis'>(</span><span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span><span class='parenthesis'>)</span> __VA_ARGS__ <span class='comment'>// error: <span class='tcode_in_codeblock'>##</span> may not appear at</span>
                                                <span class='comment'>// the beginning of a replacement list (<a href='cpp.concat'>[cpp.concat]</a>)</span>

<span class='preprocessordirective'>#define</span> H2<span class='parenthesis'>(</span>X, Y, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> __VA_OPT__<span class='parenthesis'>(</span>X <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> Y,<span class='parenthesis'>)</span> __VA_ARGS__
H2<span class='parenthesis'>(</span>a, b, c, d<span class='parenthesis'>)</span>      <span class='comment'>// replaced by <span class='tcode_in_codeblock'>ab, c, d</span></span>

<span class='preprocessordirective'>#define</span> H3<span class='parenthesis'>(</span>X, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> <span class='preprocessordirective'>#</span>__VA_OPT__<span class='parenthesis'>(</span>X<span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span>X X<span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span>X<span class='parenthesis'>)</span>
H3<span class='parenthesis'>(</span>, <span class='literal'>0</span><span class='parenthesis'>)</span>             <span class='comment'>// replaced by <span class='tcode_in_codeblock'>""</span></span>

<span class='preprocessordirective'>#define</span> H4<span class='parenthesis'>(</span>X, <span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> __VA_OPT__<span class='parenthesis'>(</span>a X <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> X<span class='parenthesis'>)</span> <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> b
H4<span class='parenthesis'>(</span>, <span class='literal'>1</span><span class='parenthesis'>)</span>             <span class='comment'>// replaced by <span class='tcode_in_codeblock'>a b</span></span>

<span class='preprocessordirective'>#define</span> H5A<span class='parenthesis'>(</span><span class='operator'>.</span><span class='operator'>.</span><span class='operator'>.</span><span class='parenthesis'>)</span> __VA_OPT__<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='comment'>/**/</span>__VA_OPT__<span class='parenthesis'>(</span><span class='parenthesis'>)</span>
<span class='preprocessordirective'>#define</span> H5B<span class='parenthesis'>(</span>X<span class='parenthesis'>)</span> a <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> X <span class='preprocessordirective'>#</span><span class='preprocessordirective'>#</span> b
<span class='preprocessordirective'>#define</span> H5C<span class='parenthesis'>(</span>X<span class='parenthesis'>)</span> H5B<span class='parenthesis'>(</span>X<span class='parenthesis'>)</span>
H5C<span class='parenthesis'>(</span>H5A<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span>          <span class='comment'>// replaced by <span class='tcode_in_codeblock'>ab</span></span>
</pre> —&nbsp;<i>end example</i></div>&nbsp;]</div> </div></div></body></html>