<!DOCTYPE html><html lang='en'><head><title>[diff.cpp03]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Notes and examples expanded'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='collapsed.css' title='Notes and examples collapsed'/><link rel='icon' href='icon.png'/></head><body><div class='wrapper'><h1 ><a class='annexnum' style='min-width:73pt'>Annex C&emsp;(informative)</a> Compatibility <a class='abbr_ref' href='./#diff'>[diff]</a></h1><h2 ><a class='secnum' style='min-width:88pt'>C.2</a> C++ and ISO C++ 2003 <a class='abbr_ref'>[diff.cpp03]</a></h2><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/48da313836eb57fd8282649c6c17b50a9cb97c3a/source/compatibility.tex#L823'>#</a></div><div id='1.sentence-1' class='sentence'><span class='indexparent'><a class='index' id=':summary,compatibility_with_ISO_C++_2003_'></a></span>This subclause lists the differences between C++ and
ISO C++ 2003 (ISO/IEC 14882:2003, <span class='textit'>Programming Languages — C++</span>),
by the chapters of this document<a class='hidden_link' href='#1.sentence-1'>.</a></div></div><div id='lex' class='section'><h3 ><a class='secnum' href='#lex' style='min-width:103pt'>C.2.1</a> Clause <a href='lex'>[lex]</a>: lexical conventions <a class='abbr_ref' href='diff.cpp03.lex'>[diff.cpp03.lex]</a></h3><div id='lex-sentence-1' class='sentence'><a href='lex.pptoken'>[lex.pptoken]</a>
<br/><b>Change:</b> New kinds of string literals<a class='hidden_link' href='#lex-sentence-1'>.</a></div> <div id='lex-sentence-2' class='sentence'><br/><b>Rationale:</b> Required for new features<a class='hidden_link' href='#lex-sentence-2'>.</a></div> <div id='lex-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may fail to compile or produce different results in
this International Standard<a class='hidden_link' href='#lex-sentence-3'>.</a></div> <div id='lex-sentence-4' class='sentence'>Specifically, macros named <span class='texttt'>R</span>, <span class='texttt'>u8</span>,
<span class='texttt'>u8R</span>, <span class='texttt'>u</span>, <span class='texttt'>uR</span>, <span class='texttt'>U</span>, <span class='texttt'>UR</span>, or <span class='texttt'>LR</span> will
not be expanded when adjacent to a string literal but will be interpreted as
part of the string literal<a class='hidden_link' href='#lex-sentence-4'>.</a></div> <div id='lex-sentence-5' class='sentence'>For example,</div><pre class='codeblock'>
#define u8 "abc"
const char* s = u8"def";        <span class='comment'>// Previously <span class='tcode_in_codeblock'>"abcdef"</span>, now <span class='tcode_in_codeblock'>"def"</span>
</span></pre><div id='lex-sentence-6' class='sentence'><a href='lex.pptoken'>[lex.pptoken]</a>
<br/><b>Change:</b> User-defined literal string support<a class='hidden_link' href='#lex-sentence-6'>.</a></div> <div id='lex-sentence-7' class='sentence'><br/><b>Rationale:</b> Required for new features<a class='hidden_link' href='#lex-sentence-7'>.</a></div> <div id='lex-sentence-8' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may fail to compile or produce different results in
this International Standard, as the following example illustrates<a class='hidden_link' href='#lex-sentence-8'>.</a></div><pre class='codeblock'>
#define _x "there"
"hello"_x         <span class='comment'>// #1
</span></pre><div id='lex-sentence-9' class='sentence'>Previously, #1 would have consisted of two separate preprocessing tokens and
the macro <span class='texttt'>_&shy;x</span> would have been expanded<a class='hidden_link' href='#lex-sentence-9'>.</a></div> <div id='lex-sentence-10' class='sentence'>In this International Standard,
#1 consists of a single preprocessing token, so the macro is not expanded<a class='hidden_link' href='#lex-sentence-10'>.</a></div><div style='height:0.6em;display:block'></div><div id='lex-sentence-11' class='sentence'><a href='lex.key'>[lex.key]</a>
<br/><b>Change:</b> New keywords<a class='hidden_link' href='#lex-sentence-11'>.</a></div> <div id='lex-sentence-12' class='sentence'><br/><b>Rationale:</b> Required for new features<a class='hidden_link' href='#lex-sentence-12'>.</a></div> <div id='lex-sentence-13' class='sentence'><br/><b>Effect on original feature:</b>
Added to Table <a href='lex.key#tab:keywords'>5</a>, the following identifiers are new keywords:
<span class='texttt'>alignas</span>,
<span class='texttt'>alignof</span>,
<span class='texttt'>char16_&shy;t</span>,
<span class='texttt'>char32_&shy;t</span>,
<span class='texttt'>constexpr</span>,
<span class='texttt'>decltype</span>,
<span class='texttt'>noexcept</span>,
<span class='texttt'>nullptr</span>,
<span class='texttt'>static_&shy;assert</span>,
and
<span class='texttt'>thread_&shy;local</span><a class='hidden_link' href='#lex-sentence-13'>.</a></div> <div id='lex-sentence-14' class='sentence'>Valid C++ 2003 code using these identifiers is invalid in this International
Standard<a class='hidden_link' href='#lex-sentence-14'>.</a></div><div style='height:0.6em;display:block'></div><div id='lex-sentence-15' class='sentence'><a href='lex.icon'>[lex.icon]</a>
<br/><b>Change:</b> Type of integer literals<a class='hidden_link' href='#lex-sentence-15'>.</a></div> <div id='lex-sentence-16' class='sentence'><br/><b>Rationale:</b> C99 compatibility<a class='hidden_link' href='#lex-sentence-16'>.</a></div> <div id='lex-sentence-17' class='sentence'><br/><b>Effect on original feature:</b>
Certain integer literals larger than can be represented by <span class='texttt'>long</span> could
change from an unsigned integer type to <span class='texttt'>signed long long</span><a class='hidden_link' href='#lex-sentence-17'>.</a></div></div><div id='conv' class='section'><h3 ><a class='secnum' href='#conv' style='min-width:103pt'>C.2.2</a> Clause <a href='conv'>[conv]</a>: standard conversions <a class='abbr_ref' href='diff.cpp03.conv'>[diff.cpp03.conv]</a></h3><div id='conv-sentence-1' class='sentence'><a href='conv.ptr'>[conv.ptr]</a>
<br/><b>Change:</b> Only literals are integer null pointer constants<a class='hidden_link' href='#conv-sentence-1'>.</a></div> <div id='conv-sentence-2' class='sentence'><br/><b>Rationale:</b> Removing surprising interactions with templates and constant
expressions<a class='hidden_link' href='#conv-sentence-2'>.</a></div> <div id='conv-sentence-3' class='sentence'><br/><b>Effect on original feature:</b> Valid C++ 2003 code may fail to compile or produce different results in
this International Standard, as the following example illustrates:</div><pre class='codeblock'>
void f(void *);  <span class='comment'>// #1
</span>void f(...);     <span class='comment'>// #2
</span>template&lt;int N&gt; void g() {
  f(0*N);        <span class='comment'>// calls #2; used to call #1
</span>}</pre></div><div id='expr' class='section'><h3 ><a class='secnum' href='#expr' style='min-width:103pt'>C.2.3</a> Clause <a href='expr'>[expr]</a>: expressions <a class='abbr_ref' href='diff.cpp03.expr'>[diff.cpp03.expr]</a></h3><div id='expr-sentence-1' class='sentence'><a href='expr.mul'>[expr.mul]</a>
<br/><b>Change:</b> Specify rounding for results of integer <span class='texttt'>/</span> and <span class='texttt'>%</span><a class='hidden_link' href='#expr-sentence-1'>.</a></div> <div id='expr-sentence-2' class='sentence'><br/><b>Rationale:</b> Increase portability, C99 compatibility<a class='hidden_link' href='#expr-sentence-2'>.</a></div> <div id='expr-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that uses integer division rounds the result toward 0 or
toward negative infinity, whereas this International Standard always rounds
the result toward 0<a class='hidden_link' href='#expr-sentence-3'>.</a></div><div style='height:0.6em;display:block'></div><div id='expr-sentence-4' class='sentence'><a href='expr.log.and'>[expr.log.and]</a>
<br/><b>Change:</b><span class='texttt'>&amp;&amp;</span> is valid in a <i ><a href='dcl.type.simple#nt:type-name'>type-name</a></i><a class='hidden_link' href='#expr-sentence-4'>.</a></div> <div id='expr-sentence-5' class='sentence'><br/><b>Rationale:</b> Required for new features<a class='hidden_link' href='#expr-sentence-5'>.</a></div> <div id='expr-sentence-6' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may fail to compile or produce different results in
this International Standard, as the following example illustrates:</div><pre class='codeblock'>
bool b1 = new int &amp;&amp; false;           <span class='comment'>// previously <span class='tcode_in_codeblock'>false</span>, now ill-formed
</span>struct S { operator int(); };
bool b2 = &amp;S::operator int &amp;&amp; false;  <span class='comment'>// previously <span class='tcode_in_codeblock'>false</span>, now ill-formed
</span></pre></div><div id='dcl.dcl' class='section'><h3 ><a class='secnum' href='#dcl.dcl' style='min-width:103pt'>C.2.4</a> Clause <a href='dcl.dcl'>[dcl.dcl]</a>: declarations <a class='abbr_ref' href='diff.cpp03.dcl.dcl'>[diff.cpp03.dcl.dcl]</a></h3><div id='dcl.dcl-sentence-1' class='sentence'><a href='dcl.spec'>[dcl.spec]</a>
<br/><b>Change:</b> Remove <span class='texttt'>auto</span> as a storage class specifier<a class='hidden_link' href='#dcl.dcl-sentence-1'>.</a></div> <div id='dcl.dcl-sentence-2' class='sentence'><br/><b>Rationale:</b> New feature<a class='hidden_link' href='#dcl.dcl-sentence-2'>.</a></div> <div id='dcl.dcl-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that uses the keyword <span class='texttt'>auto</span> as a storage class
specifier may be invalid in this International Standard<a class='hidden_link' href='#dcl.dcl-sentence-3'>.</a></div> <div id='dcl.dcl-sentence-4' class='sentence'>In this International
Standard, <span class='texttt'>auto</span> indicates that the type of a variable is to be deduced
from its initializer expression<a class='hidden_link' href='#dcl.dcl-sentence-4'>.</a></div></div><div id='dcl.decl' class='section'><h3 ><a class='secnum' href='#dcl.decl' style='min-width:103pt'>C.2.5</a> Clause <a href='dcl.decl'>[dcl.decl]</a>: declarators <a class='abbr_ref' href='diff.cpp03.dcl.decl'>[diff.cpp03.dcl.decl]</a></h3><div id='dcl.decl-sentence-1' class='sentence'><a href='dcl.init.list'>[dcl.init.list]</a>
<br/><b>Change:</b> Narrowing restrictions in aggregate initializers<a class='hidden_link' href='#dcl.decl-sentence-1'>.</a></div> <div id='dcl.decl-sentence-2' class='sentence'><br/><b>Rationale:</b> Catches bugs<a class='hidden_link' href='#dcl.decl-sentence-2'>.</a></div> <div id='dcl.decl-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may fail to compile in this International Standard<a class='hidden_link' href='#dcl.decl-sentence-3'>.</a></div> <div id='dcl.decl-sentence-4' class='sentence'>For
example, the following code is valid in C++ 2003 but invalid in this
International Standard because <span class='texttt'>double</span> to <span class='texttt'>int</span> is a narrowing
conversion:</div><pre class='codeblock'>
int x[] = { 2.0 };</pre></div><div id='special' class='section'><h3 ><a class='secnum' href='#special' style='min-width:103pt'>C.2.6</a> Clause <a href='special'>[special]</a>: special member functions <a class='abbr_ref' href='diff.cpp03.special'>[diff.cpp03.special]</a></h3><div id='special-sentence-1' class='sentence'><a href='class.ctor'>[class.ctor]</a>, <a href='class.dtor'>[class.dtor]</a>, <a href='class.copy'>[class.copy]</a>
<br/><b>Change:</b> Implicitly-declared special member functions are defined as deleted
when the implicit definition would have been ill-formed<a class='hidden_link' href='#special-sentence-1'>.</a></div> <div id='special-sentence-2' class='sentence'><br/><b>Rationale:</b> Improves template argument deduction failure<a class='hidden_link' href='#special-sentence-2'>.</a></div> <div id='special-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
A valid C++ 2003 program that uses one of these special member functions in a
context where the definition is not required (e.g., in an expression that is
not potentially evaluated) becomes ill-formed<a class='hidden_link' href='#special-sentence-3'>.</a></div><div style='height:0.6em;display:block'></div><div id='special-sentence-4' class='sentence'><a href='class.dtor'>[class.dtor]</a> (destructors)
<br/><b>Change:</b> User-declared destructors have an implicit exception specification<a class='hidden_link' href='#special-sentence-4'>.</a></div> <div id='special-sentence-5' class='sentence'><br/><b>Rationale:</b> Clarification of destructor requirements<a class='hidden_link' href='#special-sentence-5'>.</a></div> <div id='special-sentence-6' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may execute differently in this International Standard<a class='hidden_link' href='#special-sentence-6'>.</a></div> <div id='special-sentence-7' class='sentence'>In
particular, destructors that throw exceptions will call <span class='texttt'>std&#x200b;::&#x200b;terminate</span>
(without calling <span class='texttt'>std&#x200b;::&#x200b;unexpected</span>) if their exception specification is
non-throwing<a class='hidden_link' href='#special-sentence-7'>.</a></div></div><div id='temp' class='section'><h3 ><a class='secnum' href='#temp' style='min-width:103pt'>C.2.7</a> Clause <a href='temp'>[temp]</a>: templates <a class='abbr_ref' href='diff.cpp03.temp'>[diff.cpp03.temp]</a></h3><div id='temp-sentence-1' class='sentence'><a href='temp.param'>[temp.param]</a>
<br/><b>Change:</b> Remove <span class='texttt'>export</span><a class='hidden_link' href='#temp-sentence-1'>.</a></div> <div id='temp-sentence-2' class='sentence'><br/><b>Rationale:</b> No implementation consensus<a class='hidden_link' href='#temp-sentence-2'>.</a></div> <div id='temp-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
A valid C++ 2003 declaration containing <span class='texttt'>export</span> is ill-formed in this
International Standard<a class='hidden_link' href='#temp-sentence-3'>.</a></div><div style='height:0.6em;display:block'></div><div id='temp-sentence-4' class='sentence'><a href='temp.arg'>[temp.arg]</a>
<br/><b>Change:</b> Remove whitespace requirement for nested closing template right angle
brackets<a class='hidden_link' href='#temp-sentence-4'>.</a></div> <div id='temp-sentence-5' class='sentence'><br/><b>Rationale:</b> Considered a persistent but minor annoyance<a class='hidden_link' href='#temp-sentence-5'>.</a></div> <div id='temp-sentence-6' class='sentence'>Template aliases
representing non-class types would exacerbate whitespace issues<a class='hidden_link' href='#temp-sentence-6'>.</a></div> <div id='temp-sentence-7' class='sentence'><br/><b>Effect on original feature:</b>
Change to semantics of well-defined expression<a class='hidden_link' href='#temp-sentence-7'>.</a></div> <div id='temp-sentence-8' class='sentence'>A valid C++ 2003 expression
containing a right angle bracket (“<span class='texttt'>&gt;</span>”) followed immediately by
another right angle bracket may now be treated as closing two templates<a class='hidden_link' href='#temp-sentence-8'>.</a></div> <div id='temp-sentence-9' class='sentence'>For example, the following code is valid in C++ 2003 because “<span class='texttt'>&gt;&gt;</span>”
is a right-shift operator, but invalid in this International Standard because
“<span class='texttt'>&gt;&gt;</span>” closes two templates<a class='hidden_link' href='#temp-sentence-9'>.</a></div><pre class='codeblock'>
template &lt;class T&gt; struct X { };
template &lt;int N&gt; struct Y { };
X&lt; Y&lt; 1 &gt;&gt; 2 &gt; &gt; x;</pre><div id='temp-sentence-10' class='sentence'><a href='temp.dep.candidate'>[temp.dep.candidate]</a>
<br/><b>Change:</b> Allow dependent calls of functions with internal linkage<a class='hidden_link' href='#temp-sentence-10'>.</a></div> <div id='temp-sentence-11' class='sentence'><br/><b>Rationale:</b> Overly constrained, simplify overload resolution rules<a class='hidden_link' href='#temp-sentence-11'>.</a></div> <div id='temp-sentence-12' class='sentence'><br/><b>Effect on original feature:</b>
A valid C++ 2003 program could get a different result than this
International Standard<a class='hidden_link' href='#temp-sentence-12'>.</a></div></div><div id='library' class='section'><h3 ><a class='secnum' href='#library' style='min-width:103pt'>C.2.8</a> Clause <a href='library'>[library]</a>: library introduction <a class='abbr_ref' href='diff.cpp03.library'>[diff.cpp03.library]</a></h3><div id='library-sentence-1' class='sentence'><a href='library'>[library]</a> – <a href='thread'>[thread]</a>
<br/><b>Change:</b> New reserved identifiers<a class='hidden_link' href='#library-sentence-1'>.</a></div> <div id='library-sentence-2' class='sentence'><br/><b>Rationale:</b> Required by new features<a class='hidden_link' href='#library-sentence-2'>.</a></div> <div id='library-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that uses any identifiers added to the C++ standard
library by this International Standard may fail to compile or produce different
results in this International Standard<a class='hidden_link' href='#library-sentence-3'>.</a></div> <div id='library-sentence-4' class='sentence'>A comprehensive list of identifiers used
by the C++ standard library can be found in the Index of Library Names in this
International Standard<a class='hidden_link' href='#library-sentence-4'>.</a></div><div style='height:0.6em;display:block'></div><div id='library-sentence-5' class='sentence'><a href='headers'>[headers]</a>
<br/><b>Change:</b> New headers<a class='hidden_link' href='#library-sentence-5'>.</a></div> <div id='library-sentence-6' class='sentence'><br/><b>Rationale:</b> New functionality<a class='hidden_link' href='#library-sentence-6'>.</a></div> <div id='library-sentence-7' class='sentence'><br/><b>Effect on original feature:</b>
The following C++ headers are new:
<span class='texttt'>&lt;array&gt;</span>,
<span class='texttt'>&lt;atomic&gt;</span>,
<span class='texttt'>&lt;chrono&gt;</span>,
<span class='texttt'>&lt;codecvt&gt;</span>,
<span class='texttt'>&lt;condition_&shy;variable&gt;</span>,
<span class='texttt'>&lt;forward_&shy;list&gt;</span>,
<span class='texttt'>&lt;future&gt;</span>,
<span class='texttt'>&lt;initializer_&shy;list&gt;</span>,
<span class='texttt'>&lt;mutex&gt;</span>,
<span class='texttt'>&lt;random&gt;</span>,
<span class='texttt'>&lt;ratio&gt;</span>,
<span class='texttt'>&lt;regex&gt;</span>,
<span class='texttt'>&lt;scoped_&shy;allocator&gt;</span>,
<span class='texttt'>&lt;system_&shy;error&gt;</span>,
<span class='texttt'>&lt;thread&gt;</span>,
<span class='texttt'>&lt;tuple&gt;</span>,
<span class='texttt'>&lt;typeindex&gt;</span>,
<span class='texttt'>&lt;type_&shy;traits&gt;</span>,<br/>
<span class='texttt'>&lt;unordered_&shy;map&gt;</span>,
and
<span class='texttt'>&lt;unordered_&shy;set&gt;</span><a class='hidden_link' href='#library-sentence-7'>.</a></div> <div id='library-sentence-8' class='sentence'>In addition the following C compatibility headers are new:
<span class='texttt'>&lt;ccomplex&gt;</span>,
<span class='texttt'>&lt;cfenv&gt;</span>,
<span class='texttt'>&lt;cinttypes&gt;</span>,
<span class='texttt'>&lt;cstdalign&gt;</span>,
<span class='texttt'>&lt;cstdbool&gt;</span>,
<span class='texttt'>&lt;cstdint&gt;</span>,
<span class='texttt'>&lt;ctgmath&gt;</span>,
and
<span class='texttt'>&lt;cuchar&gt;</span><a class='hidden_link' href='#library-sentence-8'>.</a></div> <div id='library-sentence-9' class='sentence'>Valid C++ 2003 code that <span class='texttt'>#include</span>s headers with these names may be
invalid in this International Standard<a class='hidden_link' href='#library-sentence-9'>.</a></div><div style='height:0.6em;display:block'></div><div id='library-sentence-10' class='sentence'><a href='swappable.requirements'>[swappable.requirements]</a>
<br/><b>Effect on original feature:</b> Function <span class='texttt'>swap</span> moved to a different header
<br/><b>Rationale:</b> Remove dependency on <span class='texttt'>&lt;algorithm&gt;</span> for <span class='texttt'>swap</span><a class='hidden_link' href='#library-sentence-10'>.</a></div> <div id='library-sentence-11' class='sentence'><br/><b>Effect on original feature:</b> Valid C++ 2003 code that has been compiled expecting swap to be in
<span class='texttt'>&lt;algorithm&gt;</span> may have to instead include <span class='texttt'>&lt;utility&gt;</span><a class='hidden_link' href='#library-sentence-11'>.</a></div><div style='height:0.6em;display:block'></div><div id='library-sentence-12' class='sentence'><a href='namespace.posix'>[namespace.posix]</a>
<br/><b>Change:</b> New reserved namespace<a class='hidden_link' href='#library-sentence-12'>.</a></div> <div id='library-sentence-13' class='sentence'><br/><b>Rationale:</b> New functionality<a class='hidden_link' href='#library-sentence-13'>.</a></div> <div id='library-sentence-14' class='sentence'><br/><b>Effect on original feature:</b>
The global namespace <span class='texttt'>posix</span> is now reserved for standardization<a class='hidden_link' href='#library-sentence-14'>.</a></div> <div id='library-sentence-15' class='sentence'>Valid
C++ 2003 code that uses a top-level namespace <span class='texttt'>posix</span> may be invalid in
this International Standard<a class='hidden_link' href='#library-sentence-15'>.</a></div><div style='height:0.6em;display:block'></div><div id='library-sentence-16' class='sentence'><a href='res.on.macro.definitions'>[res.on.macro.definitions]</a>
<br/><b>Change:</b> Additional restrictions on macro names<a class='hidden_link' href='#library-sentence-16'>.</a></div> <div id='library-sentence-17' class='sentence'><br/><b>Rationale:</b> Avoid hard to diagnose or non-portable constructs<a class='hidden_link' href='#library-sentence-17'>.</a></div> <div id='library-sentence-18' class='sentence'><br/><b>Effect on original feature:</b>
Names of attribute identifiers may not be used as macro names<a class='hidden_link' href='#library-sentence-18'>.</a></div> <div id='library-sentence-19' class='sentence'>Valid C++
2003 code that defines <span class='texttt'>override</span>, <span class='texttt'>final</span>,
<span class='texttt'>carries_&shy;dependency</span>, or <span class='texttt'>noreturn</span> as macros is invalid in this
International Standard<a class='hidden_link' href='#library-sentence-19'>.</a></div></div><div id='language.support' class='section'><h3 ><a class='secnum' href='#language.support' style='min-width:103pt'>C.2.9</a> Clause <a href='language.support'>[language.support]</a>:
language support library <a class='abbr_ref' href='diff.cpp03.language.support'>[diff.cpp03.language.support]</a></h3><div id='language.support-sentence-1' class='sentence'><a href='new.delete.single'>[new.delete.single]</a>
<br/><b>Change:</b> Linking <span class='texttt'>new</span> and <span class='texttt'>delete</span> operators<a class='hidden_link' href='#language.support-sentence-1'>.</a></div> <div id='language.support-sentence-2' class='sentence'><br/><b>Rationale:</b> The two throwing single-object signatures of <span class='texttt'>operator new</span> and
<span class='texttt'>operator delete</span> are now specified to form the base functionality for
the other operators<a class='hidden_link' href='#language.support-sentence-2'>.</a></div> <div id='language.support-sentence-3' class='sentence'>This clarifies that replacing just these two signatures
changes others, even if they are not explicitly changed<a class='hidden_link' href='#language.support-sentence-3'>.</a></div> <div id='language.support-sentence-4' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that replaces global <span class='texttt'>new</span> or <span class='texttt'>delete</span>
operators may execute differently in this International Standard<a class='hidden_link' href='#language.support-sentence-4'>.</a></div> <div id='language.support-sentence-5' class='sentence'>For
example, the following program should write <span class='texttt'>"custom deallocation"</span> twice,
once for the single-object delete and once for the array delete<a class='hidden_link' href='#language.support-sentence-5'>.</a></div><pre class='codeblock'>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;new&gt;

void* operator new(std::size_t size) throw(std::bad_alloc) {
  return std::malloc(size);
}

void operator delete(void* ptr) throw() {
  std::puts("custom deallocation");
  std::free(ptr);
}

int main() {
  int* i = new int;
  delete i;                     <span class='comment'>// single-object delete
</span>  int* a = new int[3];
  delete [] a;                  <span class='comment'>// array delete
</span>}</pre><div id='language.support-sentence-6' class='sentence'><a href='new.delete.single'>[new.delete.single]</a>
<br/><b>Change:</b> <span class='texttt'>operator new</span> may throw exceptions other than
<span class='texttt'>std&#x200b;::&#x200b;bad_&shy;alloc</span><a class='hidden_link' href='#language.support-sentence-6'>.</a></div> <div id='language.support-sentence-7' class='sentence'><br/><b>Rationale:</b> Consistent application of <span class='texttt'>noexcept</span><a class='hidden_link' href='#language.support-sentence-7'>.</a></div> <div id='language.support-sentence-8' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that assumes that global <span class='texttt'>operator new</span> only
throws <span class='texttt'>std&#x200b;::&#x200b;bad_&shy;alloc</span> may execute differently in this International
Standard<a class='hidden_link' href='#language.support-sentence-8'>.</a></div></div><div id='diagnostics' class='section'><h3 ><a class='secnum' href='#diagnostics' style='min-width:103pt'>C.2.10</a> Clause <a href='diagnostics'>[diagnostics]</a>: diagnostics library <a class='abbr_ref' href='diff.cpp03.diagnostics'>[diff.cpp03.diagnostics]</a></h3><div id='diagnostics-sentence-1' class='sentence'><a href='errno'>[errno]</a>
<br/><b>Change:</b> Thread-local error numbers<a class='hidden_link' href='#diagnostics-sentence-1'>.</a></div> <div id='diagnostics-sentence-2' class='sentence'><br/><b>Rationale:</b> Support for new thread facilities<a class='hidden_link' href='#diagnostics-sentence-2'>.</a></div> <div id='diagnostics-sentence-3' class='sentence'><br/><b>Effect on original feature:</b> Valid but implementation-specific C++ 2003 code that relies on
<span class='texttt'>errno</span> being the same across threads may change behavior in this
International Standard<a class='hidden_link' href='#diagnostics-sentence-3'>.</a></div></div><div id='utilities' class='section'><h3 ><a class='secnum' href='#utilities' style='min-width:103pt'>C.2.11</a> Clause <a href='utilities'>[utilities]</a>: general utilities library <a class='abbr_ref' href='diff.cpp03.utilities'>[diff.cpp03.utilities]</a></h3><div id='utilities-sentence-1' class='sentence'><a href='util.dynamic.safety'>[util.dynamic.safety]</a>
<br/><b>Change:</b> Minimal support for garbage-collected regions<a class='hidden_link' href='#utilities-sentence-1'>.</a></div> <div id='utilities-sentence-2' class='sentence'><br/><b>Rationale:</b> Required by new feature<a class='hidden_link' href='#utilities-sentence-2'>.</a></div> <div id='utilities-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code, compiled without traceable pointer support,
that interacts with newer C++ code using regions declared reachable may
have different runtime behavior<a class='hidden_link' href='#utilities-sentence-3'>.</a></div><div style='height:0.6em;display:block'></div><div id='utilities-sentence-4' class='sentence'><a href='refwrap'>[refwrap]</a>, <a href='arithmetic.operations'>[arithmetic.operations]</a>, <a href='comparisons'>[comparisons]</a>,
<a href='logical.operations'>[logical.operations]</a>, <a href='bitwise.operations'>[bitwise.operations]</a>, <a href='depr.negators'>[depr.negators]</a>
<br/><b>Change:</b> Standard function object types no longer derived from
<span class='texttt'>std&#x200b;::&#x200b;unary_&shy;function</span> or <span class='texttt'>std&#x200b;::&#x200b;binary_&shy;function</span><a class='hidden_link' href='#utilities-sentence-4'>.</a></div> <div id='utilities-sentence-5' class='sentence'><br/><b>Rationale:</b> Superseded by new feature; <span class='texttt'>unary_&shy;function</span> and
<span class='texttt'>binary_&shy;function</span> are no longer defined<a class='hidden_link' href='#utilities-sentence-5'>.</a></div> <div id='utilities-sentence-6' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that depends on function object types being derived from
<span class='texttt'>unary_&shy;function</span> or <span class='texttt'>binary_&shy;function</span> may fail to compile
in this International Standard<a class='hidden_link' href='#utilities-sentence-6'>.</a></div></div><div id='strings' class='section'><h3 ><a class='secnum' href='#strings' style='min-width:103pt'>C.2.12</a> Clause <a href='strings'>[strings]</a>: strings library <a class='abbr_ref' href='diff.cpp03.strings'>[diff.cpp03.strings]</a></h3><div id='strings-sentence-1' class='sentence'><a href='string.classes'>[string.classes]</a>
<br/><b>Change:</b> <span class='texttt'>basic_&shy;string</span> requirements no longer allow reference-counted
strings<a class='hidden_link' href='#strings-sentence-1'>.</a></div> <div id='strings-sentence-2' class='sentence'><br/><b>Rationale:</b> Invalidation is subtly different with reference-counted strings<a class='hidden_link' href='#strings-sentence-2'>.</a></div> <div id='strings-sentence-3' class='sentence'>This change regularizes behavior for this International Standard<a class='hidden_link' href='#strings-sentence-3'>.</a></div> <div id='strings-sentence-4' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may execute differently in this International Standard<a class='hidden_link' href='#strings-sentence-4'>.</a></div><div style='height:0.6em;display:block'></div><div id='strings-sentence-5' class='sentence'><a href='string.require'>[string.require]</a>
<br/><b>Change:</b> Loosen <span class='texttt'>basic_&shy;string</span> invalidation rules<a class='hidden_link' href='#strings-sentence-5'>.</a></div> <div id='strings-sentence-6' class='sentence'><br/><b>Rationale:</b> Allow small-string optimization<a class='hidden_link' href='#strings-sentence-6'>.</a></div> <div id='strings-sentence-7' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code may execute differently in this International Standard<a class='hidden_link' href='#strings-sentence-7'>.</a></div> <div id='strings-sentence-8' class='sentence'>Some <span class='texttt'>const</span> member functions, such as <span class='texttt'>data</span> and <span class='texttt'>c_&shy;str</span>,
no longer invalidate iterators<a class='hidden_link' href='#strings-sentence-8'>.</a></div></div><div id='containers' class='section'><h3 ><a class='secnum' href='#containers' style='min-width:103pt'>C.2.13</a> Clause <a href='containers'>[containers]</a>: containers library <a class='abbr_ref' href='diff.cpp03.containers'>[diff.cpp03.containers]</a></h3><div id='containers-sentence-1' class='sentence'><a href='container.requirements'>[container.requirements]</a>
<br/><b>Change:</b> Complexity of <span class='texttt'>size()</span> member functions now constant<a class='hidden_link' href='#containers-sentence-1'>.</a></div> <div id='containers-sentence-2' class='sentence'><br/><b>Rationale:</b> Lack of specification of complexity of <span class='texttt'>size()</span> resulted in
divergent implementations with inconsistent performance characteristics<a class='hidden_link' href='#containers-sentence-2'>.</a></div> <div id='containers-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Some container implementations that conform to C++ 2003 may not conform to the
specified <span class='texttt'>size()</span> requirements in this International Standard<a class='hidden_link' href='#containers-sentence-3'>.</a></div> <div id='containers-sentence-4' class='sentence'>Adjusting
containers such as <span class='texttt'>std&#x200b;::&#x200b;list</span> to the stricter requirements may require
incompatible changes<a class='hidden_link' href='#containers-sentence-4'>.</a></div><div style='height:0.6em;display:block'></div><div id='containers-sentence-5' class='sentence'><a href='container.requirements'>[container.requirements]</a>
<br/><b>Change:</b> Requirements change: relaxation<a class='hidden_link' href='#containers-sentence-5'>.</a></div> <div id='containers-sentence-6' class='sentence'><br/><b>Rationale:</b> Clarification<a class='hidden_link' href='#containers-sentence-6'>.</a></div> <div id='containers-sentence-7' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that attempts to meet the specified container requirements
may now be over-specified<a class='hidden_link' href='#containers-sentence-7'>.</a></div> <div id='containers-sentence-8' class='sentence'>Code that attempted to be portable across containers
may need to be adjusted as follows:
<ul class='itemize'><li ><div id='containers-sentence-1' class='sentence'>not all containers provide <span class='texttt'>size()</span>; use <span class='texttt'>empty()</span> instead
of <span class='texttt'>size() == 0</span>;</div></li><li ><div id='containers-sentence-1' class='sentence'>not all containers are empty after construction (<span class='texttt'>array</span>);</div></li><li ><div id='containers-sentence-1' class='sentence'>not all containers have constant complexity for <span class='texttt'>swap()</span> (<span class='texttt'>array</span>)<a class='hidden_link' href='#containers-sentence-1'>.</a></div></li></ul></div><div id='containers-sentence-9' class='sentence'><a href='container.requirements'>[container.requirements]</a>
<br/><b>Change:</b> Requirements change: default constructible<a class='hidden_link' href='#containers-sentence-9'>.</a></div> <div id='containers-sentence-10' class='sentence'><br/><b>Rationale:</b> Clarification of container requirements<a class='hidden_link' href='#containers-sentence-10'>.</a></div> <div id='containers-sentence-11' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that attempts to explicitly instantiate a container using
a user-defined type with no default constructor may fail to compile<a class='hidden_link' href='#containers-sentence-11'>.</a></div><div style='height:0.6em;display:block'></div><div id='containers-sentence-12' class='sentence'><a href='sequence.reqmts'>[sequence.reqmts]</a>, <a href='associative.reqmts'>[associative.reqmts]</a>
<br/><b>Change:</b> Signature changes: from <span class='texttt'>void</span> return types<a class='hidden_link' href='#containers-sentence-12'>.</a></div> <div id='containers-sentence-13' class='sentence'><br/><b>Rationale:</b> Old signature threw away useful information that may be expensive
to recalculate<a class='hidden_link' href='#containers-sentence-13'>.</a></div> <div id='containers-sentence-14' class='sentence'><br/><b>Effect on original feature:</b>
The following member functions have changed:
<ul class='itemize'><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>erase(iter)</span> for <span class='texttt'>set</span>, <span class='texttt'>multiset</span>, <span class='texttt'>map</span>, <span class='texttt'>multimap</span></div></li><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>erase(begin, end)</span> for <span class='texttt'>set</span>, <span class='texttt'>multiset</span>, <span class='texttt'>map</span>, <span class='texttt'>multimap</span></div></li><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>insert(pos, num, val)</span> for <span class='texttt'>vector</span>, <span class='texttt'>deque</span>, <span class='texttt'>list</span>, <span class='texttt'>forward_&shy;list</span></div></li><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>insert(pos, beg, end)</span> for <span class='texttt'>vector</span>, <span class='texttt'>deque</span>, <span class='texttt'>list</span>, <span class='texttt'>forward_&shy;list</span></div></li></ul></div><div id='containers-sentence-15' class='sentence'>Valid C++ 2003 code that relies on these functions returning <span class='texttt'>void</span>
(e.g., code that creates a pointer to member function that points to one
of these functions) will fail to compile with this International Standard<a class='hidden_link' href='#containers-sentence-15'>.</a></div><div style='height:0.6em;display:block'></div><div id='containers-sentence-16' class='sentence'><a href='sequence.reqmts'>[sequence.reqmts]</a>, <a href='associative.reqmts'>[associative.reqmts]</a>
<br/><b>Change:</b> Signature changes: from <span class='texttt'>iterator</span> to <span class='texttt'>const_&shy;iterator</span>
parameters<a class='hidden_link' href='#containers-sentence-16'>.</a></div> <div id='containers-sentence-17' class='sentence'><br/><b>Rationale:</b> Overspecification<a class='hidden_link' href='#containers-sentence-17'>.</a></div> <div id='containers-sentence-18' class='sentence'><br/><b>Effect on original feature:</b>
The signatures of the following member functions changed from taking an
<span class='texttt'>iterator</span> to taking a <span class='texttt'>const_&shy;iterator</span>:</div><div id='containers-sentence-19' class='sentence'><ul class='itemize'><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>insert(iter, val)</span> for <span class='texttt'>vector</span>, <span class='texttt'>deque</span>, <span class='texttt'>list</span>,
<span class='texttt'>set</span>, <span class='texttt'>multiset</span>, <span class='texttt'>map</span>, <span class='texttt'>multimap</span></div></li><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>insert(pos, beg, end)</span> for <span class='texttt'>vector</span>, <span class='texttt'>deque</span>, <span class='texttt'>list</span>,
<span class='texttt'>forward_&shy;list</span></div></li><li ><div id='containers-sentence-1' class='sentence'><span class='texttt'>erase(begin, end)</span> for <span class='texttt'>set</span>, <span class='texttt'>multiset</span>, <span class='texttt'>map</span>, <span class='texttt'>multimap</span></div></li><li ><div id='containers-sentence-1' class='sentence'>all forms of <span class='texttt'>list&#x200b;::&#x200b;splice</span></div></li><li ><div id='containers-sentence-1' class='sentence'>all forms of <span class='texttt'>list&#x200b;::&#x200b;merge</span></div></li></ul></div><div id='containers-sentence-20' class='sentence'>Valid C++ 2003 code that uses these functions may fail to compile with this
International Standard<a class='hidden_link' href='#containers-sentence-20'>.</a></div><div style='height:0.6em;display:block'></div><div id='containers-sentence-21' class='sentence'><a href='sequence.reqmts'>[sequence.reqmts]</a>, <a href='associative.reqmts'>[associative.reqmts]</a>
<br/><b>Change:</b> Signature changes: <span class='texttt'>resize</span><a class='hidden_link' href='#containers-sentence-21'>.</a></div> <div id='containers-sentence-22' class='sentence'><br/><b>Rationale:</b> Performance, compatibility with move semantics<a class='hidden_link' href='#containers-sentence-22'>.</a></div> <div id='containers-sentence-23' class='sentence'><br/><b>Effect on original feature:</b>
For <span class='texttt'>vector</span>, <span class='texttt'>deque</span>, and <span class='texttt'>list</span>
the fill value passed to <span class='texttt'>resize</span> is now passed by reference instead of
by value, and an additional overload of <span class='texttt'>resize</span> has been added<a class='hidden_link' href='#containers-sentence-23'>.</a></div> <div id='containers-sentence-24' class='sentence'>Valid
C++ 2003 code that uses this function may fail to compile with this International
Standard<a class='hidden_link' href='#containers-sentence-24'>.</a></div></div><div id='algorithms' class='section'><h3 ><a class='secnum' href='#algorithms' style='min-width:103pt'>C.2.14</a> Clause <a href='algorithms'>[algorithms]</a>: algorithms library <a class='abbr_ref' href='diff.cpp03.algorithms'>[diff.cpp03.algorithms]</a></h3><div id='algorithms-sentence-1' class='sentence'><a href='algorithms.general'>[algorithms.general]</a>
<br/><b>Change:</b> Result state of inputs after application of some algorithms<a class='hidden_link' href='#algorithms-sentence-1'>.</a></div> <div id='algorithms-sentence-2' class='sentence'><br/><b>Rationale:</b> Required by new feature<a class='hidden_link' href='#algorithms-sentence-2'>.</a></div> <div id='algorithms-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
A valid C++ 2003 program may detect that an object with a valid but
unspecified state has a different valid but unspecified state with this
International Standard<a class='hidden_link' href='#algorithms-sentence-3'>.</a></div> <div id='algorithms-sentence-4' class='sentence'>For example, <span class='texttt'>std&#x200b;::&#x200b;remove</span> and
<span class='texttt'>std&#x200b;::&#x200b;remove_&shy;if</span> may leave the tail of the input sequence with a
different set of values than previously<a class='hidden_link' href='#algorithms-sentence-4'>.</a></div></div><div id='numerics' class='section'><h3 ><a class='secnum' href='#numerics' style='min-width:103pt'>C.2.15</a> Clause <a href='numerics'>[numerics]</a>: numerics library <a class='abbr_ref' href='diff.cpp03.numerics'>[diff.cpp03.numerics]</a></h3><div id='numerics-sentence-1' class='sentence'><a href='complex.numbers'>[complex.numbers]</a>
<br/><b>Change:</b> Specified representation of complex numbers<a class='hidden_link' href='#numerics-sentence-1'>.</a></div> <div id='numerics-sentence-2' class='sentence'><br/><b>Rationale:</b> Compatibility with C99<a class='hidden_link' href='#numerics-sentence-2'>.</a></div> <div id='numerics-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that uses implementation-specific knowledge about the
binary representation of the required template specializations of
<span class='texttt'>std&#x200b;::&#x200b;complex</span> may not be compatible with this International Standard<a class='hidden_link' href='#numerics-sentence-3'>.</a></div></div><div id='input.output' class='section'><h3 ><a class='secnum' href='#input.output' style='min-width:103pt'>C.2.16</a> Clause <a href='input.output'>[input.output]</a>: input/output library <a class='abbr_ref' href='diff.cpp03.input.output'>[diff.cpp03.input.output]</a></h3><div id='input.output-sentence-1' class='sentence'><a href='./istream::sentry'>[istream::sentry]</a>,
<a href='./ostream::sentry'>[ostream::sentry]</a>,
<a href='iostate.flags'>[iostate.flags]</a>
<br/><b>Change:</b> Specify use of <span class='texttt'>explicit</span> in existing boolean conversion functions<a class='hidden_link' href='#input.output-sentence-1'>.</a></div> <div id='input.output-sentence-2' class='sentence'><br/><b>Rationale:</b> Clarify intentions, avoid workarounds<a class='hidden_link' href='#input.output-sentence-2'>.</a></div> <div id='input.output-sentence-3' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that relies on implicit boolean conversions will fail to
compile with this International Standard<a class='hidden_link' href='#input.output-sentence-3'>.</a></div> <div id='input.output-sentence-4' class='sentence'>Such conversions occur in the
following conditions:</div><div id='input.output-sentence-5' class='sentence'><ul class='itemize'><li ><div id='input.output-sentence-1' class='sentence'>passing a value to a function that takes an argument of type <span class='texttt'>bool</span>;</div></li><li ><div id='input.output-sentence-1' class='sentence'>using <span class='texttt'>operator==</span> to compare to <span class='texttt'>false</span> or <span class='texttt'>true</span>;</div></li><li ><div id='input.output-sentence-1' class='sentence'>returning a value from a function with a return type of <span class='texttt'>bool</span>;</div></li><li ><div id='input.output-sentence-1' class='sentence'>initializing members of type <span class='texttt'>bool</span> via aggregate initialization;</div></li><li ><div id='input.output-sentence-1' class='sentence'>initializing a <span class='texttt'>const bool&amp;</span> which would bind to a temporary<a class='hidden_link' href='#input.output-sentence-1'>.</a></div></li></ul></div><div id='input.output-sentence-6' class='sentence'><a href='./ios::failure'>[ios::failure]</a>
<br/><b>Change:</b> Change base class of <span class='texttt'>std&#x200b;::&#x200b;ios_&shy;base&#x200b;::&#x200b;failure</span><a class='hidden_link' href='#input.output-sentence-6'>.</a></div> <div id='input.output-sentence-7' class='sentence'><br/><b>Rationale:</b> More detailed error messages<a class='hidden_link' href='#input.output-sentence-7'>.</a></div> <div id='input.output-sentence-8' class='sentence'><br/><b>Effect on original feature:</b>
<span class='texttt'>std&#x200b;::&#x200b;ios_&shy;base&#x200b;::&#x200b;failure</span> is no longer derived directly from
<span class='texttt'>std&#x200b;::&#x200b;exception</span>, but is now derived from <span class='texttt'>std&#x200b;::&#x200b;system_&shy;error</span>,
which in turn is derived from <span class='texttt'>std&#x200b;::&#x200b;runtime_&shy;error</span><a class='hidden_link' href='#input.output-sentence-8'>.</a></div> <div id='input.output-sentence-9' class='sentence'>Valid C++ 2003 code
that assumes that <span class='texttt'>std&#x200b;::&#x200b;ios_&shy;base&#x200b;::&#x200b;failure</span> is derived directly from
<span class='texttt'>std&#x200b;::&#x200b;exception</span> may execute differently in this International Standard<a class='hidden_link' href='#input.output-sentence-9'>.</a></div><div style='height:0.6em;display:block'></div><div id='input.output-sentence-10' class='sentence'><a href='ios.base'>[ios.base]</a>
<br/><b>Change:</b> Flag types in <span class='texttt'>std&#x200b;::&#x200b;ios_&shy;base</span> are now bitmasks with values
defined as constexpr static members<a class='hidden_link' href='#input.output-sentence-10'>.</a></div> <div id='input.output-sentence-11' class='sentence'><br/><b>Rationale:</b> Required for new features<a class='hidden_link' href='#input.output-sentence-11'>.</a></div> <div id='input.output-sentence-12' class='sentence'><br/><b>Effect on original feature:</b>
Valid C++ 2003 code that relies on <span class='texttt'>std&#x200b;::&#x200b;ios_&shy;base</span> flag types being
represented as <span class='texttt'>std&#x200b;::&#x200b;bitset</span> or as an integer type may fail to compile
with this International Standard<a class='hidden_link' href='#input.output-sentence-12'>.</a></div> <div id='input.output-sentence-13' class='sentence'>For example:</div><pre class='codeblock'>
#include &lt;iostream&gt;

int main() {
  int flag = std::ios_base::hex;
  std::cout.setf(flag);         <span class='comment'>// error: <span class='tcode_in_codeblock'>setf</span> does not take argument of type <span class='tcode_in_codeblock'>int</span>
</span>}</pre></div></div></body></html>