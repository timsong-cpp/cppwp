<!DOCTYPE html><html lang='en'><head><title>[thread.stoptoken]</title><meta charset='UTF-8'/><link rel='stylesheet' type='text/css' href='14882.css'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'/><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'/><link rel='icon' href='icon.png'/><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'/><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'/><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'/></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>32</a> Concurrency support library <a class='abbr_ref' href='./#thread'>[thread]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>32.3</a> Stop tokens <a class='abbr_ref'>[thread.stoptoken]</a></h2><div id='intro' class='section'><h3 ><a class='secnum' href='#intro' style='min-width:80pt'>32.3.1</a> Introduction <a class='abbr_ref' href='thread.stoptoken.intro'>[thread.stoptoken.intro]</a></h3><div class='para' id='intro-1'><div class='marginalizedparent'><a class='marginalized' href='#intro-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L449'>#</a></div><div class='texpara'><div id='intro-1.sentence-1' class='sentence'>Subclause [thread.<span class='shy'></span>stoptoken] describes components that can be used
to asynchronously request that an operation stops execution in a timely manner,
typically because the result is no longer required<a class='hidden_link' href='#intro-1.sentence-1'>.</a></div> <div id='intro-1.sentence-2' class='sentence'>Such a request is called a <a class='hidden_link' href='#def:stop_request' title='32.3.1&emsp;Introduction&emsp;[thread.stoptoken.intro]'><span id='def:stop_request'><i >stop request</i></span></a><a class='hidden_link' href='#intro-1.sentence-2'>.</a></div></div></div><div class='para' id='intro-2'><div class='marginalizedparent'><a class='marginalized' href='#intro-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L455'>#</a></div><div class='texpara'><div id='intro-2.sentence-1' class='sentence'>The concepts
<a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source'><span class='texttt'><i >stoppable-source</i></span></span></a>,
<a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>, and
<a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for'><span class='texttt'><i >stoppable-callback-for</i></span></span></a>
specify the required syntax and semantics of
shared access to a <a class='hidden_link' href='#def:stop_state' title='32.3.1&emsp;Introduction&emsp;[thread.stoptoken.intro]'><span id='def:stop_state'><i >stop state</i></span></a><a class='hidden_link' href='#intro-2.sentence-1'>.</a></div> <div id='intro-2.sentence-2' class='sentence'>Any object modeling <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source_'><span class='texttt'><i >stoppable-source</i></span></span></a>,
<a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>, or
<a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for_'><span class='texttt'><i >stoppable-callback-for</i></span></span></a>
that refers to the same stop state is
an <a class='hidden_link' href='#def:associated' title='32.3.1&emsp;Introduction&emsp;[thread.stoptoken.intro]'><span id='def:associated'><i >associated</i></span></a>
<a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source__'><span class='texttt'><i >stoppable-source</i></span></span></a>,
<a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token__'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>, or
<a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for__'><span class='texttt'><i >stoppable-callback-for</i></span></span></a>,
respectively<a class='hidden_link' href='#intro-2.sentence-2'>.</a></div></div></div><div class='para' id='intro-3'><div class='marginalizedparent'><a class='marginalized' href='#intro-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L472'>#</a></div><div class='texpara'><div id='intro-3.sentence-1' class='sentence'>An object of a type that models <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token___'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>
can be passed to an operation that can either
<ul class='itemize'><li id='intro-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#intro-3.1'>(3.1)</a></div>actively poll the token to check if there has been a stop request, or</li><li id='intro-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#intro-3.2'>(3.2)</a></div>register a callback that
        will be called in the event that a stop request is made<a class='hidden_link' href='#intro-3.sentence-1'>.</a></li></ul></div> <div id='intro-3.sentence-2' class='sentence'>
A stop request made via an object
whose type models <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source___'><span class='texttt'><i >stoppable-source</i></span></span></a>
will be visible to
all associated <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token____'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> and
<a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source____'><span class='texttt'><i >stoppable-source</i></span></span></a> objects<a class='hidden_link' href='#intro-3.sentence-2'>.</a></div> <div id='intro-3.sentence-3' class='sentence'>Once a stop request has been made it cannot be withdrawn
(a subsequent stop request has no effect)<a class='hidden_link' href='#intro-3.sentence-3'>.</a></div></div></div><div class='para' id='intro-4'><div class='marginalizedparent'><a class='marginalized' href='#intro-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L488'>#</a></div><div class='texpara'><div id='intro-4.sentence-1' class='sentence'>Callbacks registered via an object
whose type models <a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for___'><span class='texttt'><i >stoppable-callback-for</i></span></span></a>
are called when a stop request is first made
by any associated <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source_____'><span class='texttt'><i >stoppable-source</i></span></span></a> object<a class='hidden_link' href='#intro-4.sentence-1'>.</a></div></div></div><div class='para' id='intro-5'><div class='marginalizedparent'><a class='marginalized' href='#intro-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L494'>#</a></div><div class='texpara'><div id='intro-5.sentence-1' class='sentence'>The types <span class='texttt'>stop_<span class='shy'></span>source</span> and <span class='texttt'>stop_<span class='shy'></span>token</span> and
the class template <span class='texttt'>stop_<span class='shy'></span>callback</span> implement
the semantics of shared ownership of a stop state<a class='hidden_link' href='#intro-5.sentence-1'>.</a></div> <div id='intro-5.sentence-2' class='sentence'>The last remaining owner of the stop state automatically releases
the resources associated with the stop state<a class='hidden_link' href='#intro-5.sentence-2'>.</a></div></div></div><div class='para' id='intro-6'><div class='marginalizedparent'><a class='marginalized' href='#intro-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L501'>#</a></div><div class='texpara'><div id='intro-6.sentence-1' class='sentence'>An object of type <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span>
is the sole owner of its stop state<a class='hidden_link' href='#intro-6.sentence-1'>.</a></div> <div id='intro-6.sentence-2' class='sentence'>An object of type <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span> or
of a specialization of the class template <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>callback</span>
does not participate in ownership of its associated stop state<a class='hidden_link' href='#intro-6.sentence-2'>.</a></div> <div id='intro-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#intro-note-1'>1</a></i>:&ensp;<div id='intro-6.sentence-3' class='sentence'>They are for use when all uses of the associated token and callback objects
are known to nest within the lifetime of the <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> object<a class='hidden_link' href='#intro-6.sentence-3'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div id='syn' class='section'><h3 ><a class='secnum' href='#syn' style='min-width:80pt'>32.3.2</a> Header <span class='texttt'>&lt;stop_<span class='shy'></span>token&gt;</span> synopsis <a class='abbr_ref' href='thread.stoptoken.syn'>[thread.stoptoken.syn]</a></h3><div class='texpara'><span id='header:<stop_token>'><div class='marginalizedparent'><a class='itemDeclLink' href='#header:%3cstop_token%3e'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='comment'>// <a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>, stop token concepts</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn, <span class='keyword'>class</span> Token, <span class='keyword'>class</span> Initializer <span class='operator'>=</span> CallbackFn<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for____'><span class='tcode_in_codeblock'><i >stoppable-callback-for</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;           <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_____'><span class='tcode_in_codeblock'>stoppable_<span class='shy'></span>token</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token'><span class='tcode_in_codeblock'>unstoppable_<span class='shy'></span>token</span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Source<span class='anglebracket'>&gt;</span>
    <span class='keyword'>concept</span> <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source______'><span class='tcode_in_codeblock'><i >stoppable-source</i></span></span></a> <span class='operator'>=</span> <i ><span class='texttt'>see below</span></i>;                 <span class='comment'>// <i >exposition only</i></span>

  <span class='comment'>// <a href='#stoptoken' title='32.3.4&emsp;Class stop_&shy;token'>[stoptoken]</a>, class <span class='tcode_in_codeblock'>stop_<span class='shy'></span>token</span></span>
  <span class='keyword'>class</span> stop_token;

  <span class='comment'>// <a href='#stopsource' title='32.3.5&emsp;Class stop_&shy;source'>[stopsource]</a>, class <span class='tcode_in_codeblock'>stop_<span class='shy'></span>source</span></span>
  <span class='keyword'>class</span> stop_source;

  <span class='comment'>// no-shared-stop-state indicator</span>
  <span class='keyword'>struct</span> nostopstate_t <span class='curlybracket'>{</span>
    <span class='keyword'>explicit</span> nostopstate_t<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
  <span class='curlybracket'>}</span>;
  <span class='keyword'>inline</span> <span class='keyword'>constexpr</span> nostopstate_t nostopstate<span class='curlybracket'>{</span><span class='curlybracket'>}</span>;

  <span class='comment'>// <a href='#stopcallback' title='32.3.6&emsp;Class template stop_&shy;callback'>[stopcallback]</a>, class template <span class='tcode_in_codeblock'>stop_<span class='shy'></span>callback</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Callback<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> stop_callback;

  <span class='comment'>// <a href='#stoptoken.never' title='32.3.7&emsp;Class never_&shy;stop_&shy;token'>[stoptoken.<span class='shy'></span>never]</a>, class <span class='tcode_in_codeblock'>never_<span class='shy'></span>stop_<span class='shy'></span>token</span></span>
  <span class='keyword'>class</span> never_stop_token;

  <span class='comment'>// <a href='#stoptoken.inplace' title='32.3.8&emsp;Class inplace_&shy;stop_&shy;token'>[stoptoken.<span class='shy'></span>inplace]</a>, class <span class='tcode_in_codeblock'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span></span>
  <span class='keyword'>class</span> inplace_stop_token;

  <span class='comment'>// <a href='#stopsource.inplace' title='32.3.9&emsp;Class inplace_&shy;stop_&shy;source'>[stopsource.<span class='shy'></span>inplace]</a>, class <span class='tcode_in_codeblock'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span></span>
  <span class='keyword'>class</span> inplace_stop_source;

  <span class='comment'>// <a href='#stopcallback.inplace' title='32.3.10&emsp;Class template inplace_&shy;stop_&shy;callback'>[stopcallback.<span class='shy'></span>inplace]</a>, class template <span class='tcode_in_codeblock'>inplace_<span class='shy'></span>stop_<span class='shy'></span>callback</span></span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
    <span class='keyword'>class</span> inplace_stop_callback;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> T, <span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
    <span class='keyword'>using</span> stop_callback_for_t <span class='operator'>=</span> T<span class='operator'>::</span><span class='keyword'>template</span> callback_type<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div id='stoptoken.concepts' class='section'><h3 ><a class='secnum' href='#stoptoken.concepts' style='min-width:80pt'>32.3.3</a> Stop token concepts <a class='abbr_ref' href='stoptoken.concepts'>[stoptoken.concepts]</a></h3><div class='para' id='stoptoken.concepts-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L566'>#</a></div><div class='texpara'><div id='stoptoken.concepts-1.sentence-1' class='sentence'>The exposition-only <a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for_____'><span class='texttt'><i >stoppable-callback-for</i></span></span></a> concept
checks for a callback compatible with a given <span class='texttt'>Token</span> type<a class='hidden_link' href='#stoptoken.concepts-1.sentence-1'>.</a></div> <span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn, <span class='keyword'>class</span> Token, <span class='keyword'>class</span> Initializer <span class='operator'>=</span> CallbackFn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='concept:stoppable-callback-for'><span class='tcode_in_codeblock'><i >stoppable-callback-for</i></span></span></a> <span class='operator'>=</span>                          <span class='comment'>// <i >exposition only</i></span>
    <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable'><span class='tcode_in_codeblock'>invocable</span></span></a><span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <span class='keyword'>requires</span> <span class='curlybracket'>{</span> <span class='keyword'>typename</span> stop_callback_for_t<span class='anglebracket'>&lt;</span>Token, CallbackFn<span class='anglebracket'>&gt;</span>; <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_'><span class='tcode_in_codeblock'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>stop_callback_for_t<span class='anglebracket'>&lt;</span>Token, CallbackFn<span class='anglebracket'>&gt;</span>, <span class='keyword'>const</span> Token<span class='operator'>&amp;</span>, Initializer<span class='anglebracket'>&gt;</span>;
</span></div></div><div class='para' id='stoptoken.concepts-2'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L578'>#</a></div><div class='texpara'><div id='stoptoken.concepts-2.sentence-1' class='sentence'>Let <span class='texttt'>t</span> and <span class='texttt'>u</span> be distinct, valid objects of type <span class='texttt'>Token</span>
that reference the same logical stop state;
let <span class='texttt'>init</span> be an expression such that
<span class='texttt'><a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as'><span class='texttt'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>decltype</span><span class='parenthesis'>(</span>init<span class='parenthesis'>)</span>, Initializer<span class='anglebracket'>&gt;</span></span> is <span class='texttt'><span class='literal'>true</span></span>; and
let <span class='texttt'>SCB</span> denote the type <span class='texttt'>stop_<span class='shy'></span>callback_<span class='shy'></span>for_<span class='shy'></span>t<span class='anglebracket'>&lt;</span>Token, CallbackFn<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#stoptoken.concepts-2.sentence-1'>.</a></div></div></div><div class='para' id='stoptoken.concepts-3'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L585'>#</a></div><div class='texpara'><div id='stoptoken.concepts-3.sentence-1' class='sentence'>The concept
<span class='texttt'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for______'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Token, Initializer<span class='anglebracket'>&gt;</span></span>
is modeled only if:
<ul class='itemize'><li id='stoptoken.concepts-3.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-3.1'>(3.1)</a></div><div class='texpara'><div id='stoptoken.concepts-3.1.sentence-1' class='sentence'>The following concepts are modeled:
<ul class='itemize'><li id='stoptoken.concepts-3.1.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.1.1'>(3.1.1)</a></div><span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from__'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>SCB, Token, Initializer<span class='anglebracket'>&gt;</span></span></li><li id='stoptoken.concepts-3.1.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.1.2'>(3.1.2)</a></div><span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from___'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>SCB, Token<span class='operator'>&amp;</span>, Initializer<span class='anglebracket'>&gt;</span></span></li><li id='stoptoken.concepts-3.1.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.1.3'>(3.1.3)</a></div><span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from____'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>SCB, <span class='keyword'>const</span> Token, Initializer<span class='anglebracket'>&gt;</span></span></li></ul></div></div></li><li id='stoptoken.concepts-3.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-3.2'>(3.2)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.sentence-1' class='sentence'>An object of type <span class='texttt'>SCB</span> has
an associated callback function of type <span class='texttt'>CallbackFn</span><a class='hidden_link' href='#stoptoken.concepts-3.2.sentence-1'>.</a></div> <div id='stoptoken.concepts-3.2.sentence-2' class='sentence'>Let <span class='texttt'>scb</span> be an object of type <span class='texttt'>SCB</span> and
let <span class='texttt'>callback_<span class='shy'></span>fn</span> denote <span class='texttt'>scb's</span> associated callback function<a class='hidden_link' href='#stoptoken.concepts-3.2.sentence-2'>.</a></div> <div id='stoptoken.concepts-3.2.sentence-3' class='sentence'>Direct-non-list-initializing <span class='texttt'>scb</span> from
arguments <span class='texttt'>t</span> and <span class='texttt'>init</span>
shall execute a <a class='hidden_link' href='#def:registration,stoppable_callback' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='def:registration,stoppable_callback'><i >stoppable callback registration</i></span></a> as follows:
<ul class='itemize'><li id='stoptoken.concepts-3.2.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1'>(3.2.1)</a></div>If <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>:
<ul class='itemize'><li id='stoptoken.concepts-3.2.1.1'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1.1'>(3.2.1.1)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.1.1.sentence-1' class='sentence'><span class='texttt'>callback_<span class='shy'></span>fn</span> shall be direct-initialized with <span class='texttt'>init</span><a class='hidden_link' href='#stoptoken.concepts-3.2.1.1.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.2.1.2'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1.2'>(3.2.1.2)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.1.2.sentence-1' class='sentence'>Construction of <span class='texttt'>scb</span> shall only throw exceptions
thrown by the initialization of <span class='texttt'>callback_<span class='shy'></span>fn</span> from <span class='texttt'>init</span><a class='hidden_link' href='#stoptoken.concepts-3.2.1.2.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.2.1.3'><div class='marginalizedparent' style='left:-45mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1.3'>(3.2.1.3)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.1.3.sentence-1' class='sentence'>The callback invocation <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>callback_<span class='shy'></span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
shall be registered with <span class='texttt'>t</span>'s associated stop state as follows:
<ul class='itemize'><li id='stoptoken.concepts-3.2.1.3.1'><div class='marginalizedparent' style='left:-54mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1.3.1'>(3.2.1.3.1)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.1.3.1.sentence-1' class='sentence'>If <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> evaluates to <span class='texttt'><span class='literal'>false</span></span>
at the time of registration,
the callback invocation is added to the stop state's list of callbacks
such that <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span><br>callback_<span class='shy'></span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is evaluated
if a stop request is made on the stop state<a class='hidden_link' href='#stoptoken.concepts-3.2.1.3.1.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.2.1.3.2'><div class='marginalizedparent' style='left:-54mm'><a class='marginalized' href='#stoptoken.concepts-3.2.1.3.2'>(3.2.1.3.2)</a></div><div class='texpara'><div id='stoptoken.concepts-3.2.1.3.2.sentence-1' class='sentence'>Otherwise, <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>callback_<span class='shy'></span>fn<span class='parenthesis'>)</span><span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
shall be immediately evaluated
on the thread executing <span class='texttt'>scb</span>'s constructor, and
the callback invocation shall not be added to the list of callback invocations<a class='hidden_link' href='#stoptoken.concepts-3.2.1.3.2.sentence-1'>.</a></div></div></li></ul></div> <div id='stoptoken.concepts-3.2.1.3.sentence-2' class='sentence'>
If the callback invocation was added to stop state's list of callbacks,
<span class='texttt'>scb</span> shall be associated with the stop state<a class='hidden_link' href='#stoptoken.concepts-3.2.1.3.sentence-2'>.</a></div></div></li></ul></li><li id='stoptoken.concepts-3.2.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.2.2'>(3.2.2)</a></div><div id='stoptoken.concepts-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stoptoken.concepts-note-1'>1</a></i>:&ensp;<div id='stoptoken.concepts-3.2.2.sentence-1' class='sentence'>If <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>,
there is no requirement
that the initialization of <span class='texttt'>scb</span>
causes the initialization of <span class='texttt'>callback_<span class='shy'></span>fn</span><a class='hidden_link' href='#stoptoken.concepts-3.2.2.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></li></ul></div></div></li><li id='stoptoken.concepts-3.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-3.3'>(3.3)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.sentence-1' class='sentence'>Destruction of <span class='texttt'>scb</span> shall execute
a <a class='hidden_link' href='#def:callback_deregistration,stoppable' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='def:callback_deregistration,stoppable'><i >stoppable callback deregistration</i></span></a> as follows (in order):
<ul class='itemize'><li id='stoptoken.concepts-3.3.1'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.1'>(3.3.1)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.1.sentence-1' class='sentence'>If the constructor of <span class='texttt'>scb</span> did not register
a callback invocation with <span class='texttt'>t</span>'s stop state,
then the stoppable callback deregistration shall have no effect
other than destroying <span class='texttt'>callback_<span class='shy'></span>fn</span> if it was constructed<a class='hidden_link' href='#stoptoken.concepts-3.3.1.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.3.2'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.2'>(3.3.2)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.2.sentence-1' class='sentence'>Otherwise, the invocation of <span class='texttt'>callback_<span class='shy'></span>fn</span> shall be removed
from the associated stop state<a class='hidden_link' href='#stoptoken.concepts-3.3.2.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.3.3'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.3'>(3.3.3)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.3.sentence-1' class='sentence'>If <span class='texttt'>callback_<span class='shy'></span>fn</span> is concurrently executing on another thread,
then the stoppable callback deregistration shall block (<a href='defns.block' title='3.6&emsp;block'>[defns.<span class='shy'></span>block]</a>)
until the invocation of <span class='texttt'>callback_<span class='shy'></span>fn</span> returns
such that the return from the invocation of <span class='texttt'>callback_<span class='shy'></span>fn</span>
strongly happens before (<a href='intro.races' title='6.9.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>)
the destruction of <span class='texttt'>callback_<span class='shy'></span>fn</span><a class='hidden_link' href='#stoptoken.concepts-3.3.3.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.3.4'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.4'>(3.3.4)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.4.sentence-1' class='sentence'>If <span class='texttt'>callback_<span class='shy'></span>fn</span> is executing on the current thread,
then the destructor shall not block
waiting for the return from the invocation of <span class='texttt'>callback_<span class='shy'></span>fn</span><a class='hidden_link' href='#stoptoken.concepts-3.3.4.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.3.5'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.5'>(3.3.5)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.5.sentence-1' class='sentence'>A stoppable callback deregistration shall not block
on the completion of the invocation of some other callback
registered with the same logical stop state<a class='hidden_link' href='#stoptoken.concepts-3.3.5.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-3.3.6'><div class='marginalizedparent' style='left:-36mm'><a class='marginalized' href='#stoptoken.concepts-3.3.6'>(3.3.6)</a></div><div class='texpara'><div id='stoptoken.concepts-3.3.6.sentence-1' class='sentence'>The stoppable callback deregistration shall destroy <span class='texttt'>callback_<span class='shy'></span>fn</span><a class='hidden_link' href='#stoptoken.concepts-3.3.6.sentence-1'>.</a></div></div></li></ul></div></div></li></ul></div></div></div><div class='para' id='stoptoken.concepts-4'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L675'>#</a></div><div class='texpara'><div id='stoptoken.concepts-4.sentence-1' class='sentence'>The <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token______'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> concept checks
for the basic interface of a stop token
that is copyable and allows polling to see if stop has been requested and
also whether a stop request is possible<a class='hidden_link' href='#stoptoken.concepts-4.sentence-1'>.</a></div> <div id='stoptoken.concepts-4.sentence-2' class='sentence'>The <a href='#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token_'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> concept checks
for a <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_______'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> type that does not allow stopping<a class='hidden_link' href='#stoptoken.concepts-4.sentence-2'>.</a></div> <span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span> <span class='keyword'>class</span><span class='anglebracket'>&gt;</span>
  <span class='keyword'>struct</span> <i >check-type-alias-exists</i>;                               <span class='comment'>// <i >exposition only</i></span>

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='concept:stoppable_token'><span id='lib:stoppable_token'><span class='tcode_in_codeblock'>stoppable_<span class='shy'></span>token</span></span></span></a> <span class='operator'>=</span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> Token tok<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>typename</span> <i >check-type-alias-exists</i><span class='anglebracket'>&lt;</span>Token<span class='operator'>::</span><span class='keyword'>template</span> callback_type<span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>{</span> tok<span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>{</span> tok<span class='operator'>.</span>stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as__'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>{</span> Token<span class='parenthesis'>(</span>tok<span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span>;                  <span class='comment'>// see implicit expression variations (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)</span>
    <span class='curlybracket'>}</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable'><span class='tcode_in_codeblock'>copyable</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable'><span class='tcode_in_codeblock'>equality_<span class='shy'></span>comparable</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span>;

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Token<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='concept:unstoppable_token'><span id='lib:unstoppable_token'><span class='tcode_in_codeblock'>unstoppable_<span class='shy'></span>token</span></span></span></a> <span class='operator'>=</span>
    <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token________'><span class='tcode_in_codeblock'>stoppable_<span class='shy'></span>token</span></span></a><span class='anglebracket'>&lt;</span>Token<span class='anglebracket'>&gt;</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span><span class='keyword'>const</span> Token tok<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>
      <span class='keyword'>requires</span> bool_constant<span class='anglebracket'>&lt;</span><span class='parenthesis'>(</span><span class='operator'>!</span>tok<span class='operator'>.</span>stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span><span class='parenthesis'>)</span><span class='anglebracket'>&gt;</span><span class='operator'>::</span>value;
    <span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='stoptoken.concepts-5'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-5'>5</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L705'>#</a></div><div class='texpara'><div id='stoptoken.concepts-5.sentence-1' class='sentence'>An object whose type models <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a>
has at most one associated logical stop state<a class='hidden_link' href='#stoptoken.concepts-5.sentence-1'>.</a></div> <div id='stoptoken.concepts-5.sentence-2' class='sentence'>A <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token__________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> object with no associated stop state
is said to be <a class='hidden_link' href='#def:disengaged' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='def:disengaged'><i >disengaged</i></span></a><a class='hidden_link' href='#stoptoken.concepts-5.sentence-2'>.</a></div></div></div><div class='para' id='stoptoken.concepts-6'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-6'>6</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L711'>#</a></div><div class='texpara'><div id='stoptoken.concepts-6.sentence-1' class='sentence'>Let <span class='texttt'>SP</span> be an evaluation of <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that is <span class='texttt'><span class='literal'>false</span></span>, and
let SR be an evaluation of <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> that is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stoptoken.concepts-6.sentence-1'>.</a></div></div></div><div class='para' id='stoptoken.concepts-7'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-7'>7</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L716'>#</a></div><div class='texpara'><div id='stoptoken.concepts-7.sentence-1' class='sentence'>The type <span class='texttt'>Token</span> models <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token___________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> only if:
<ul class='itemize'><li id='stoptoken.concepts-7.1'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-7.1'>(7.1)</a></div><div class='texpara'><div id='stoptoken.concepts-7.1.sentence-1' class='sentence'>Any evaluation of <span class='texttt'>u<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> or <span class='texttt'>u<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that happens after (<a href='intro.races' title='6.9.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>) <span class='texttt'>SP</span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.concepts-7.1.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-7.2'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-7.2'>(7.2)</a></div><div class='texpara'><div id='stoptoken.concepts-7.2.sentence-1' class='sentence'>Any evaluation of <span class='texttt'>u<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> or <span class='texttt'>u<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
that happens after <span class='texttt'>SR</span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stoptoken.concepts-7.2.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-7.3'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-7.3'>(7.3)</a></div><div class='texpara'><div id='stoptoken.concepts-7.3.sentence-1' class='sentence'>For any types <span class='texttt'>CallbackFn</span> and <span class='texttt'>Initializer</span> such that
<span class='texttt'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for_______'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Token, Initializer<span class='anglebracket'>&gt;</span></span>
is satisfied,
<span class='texttt'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for________'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Token, Initializer<span class='anglebracket'>&gt;</span></span>
is modeled<a class='hidden_link' href='#stoptoken.concepts-7.3.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-7.4'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-7.4'>(7.4)</a></div><div class='texpara'><div id='stoptoken.concepts-7.4.sentence-1' class='sentence'>If <span class='texttt'>t</span> is disengaged,
evaluations of <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and <span class='texttt'>t<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span>
are <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.concepts-7.4.sentence-1'>.</a></div></div></li><li id='stoptoken.concepts-7.5'><div class='marginalizedparent' style='left:-27mm'><a class='marginalized' href='#stoptoken.concepts-7.5'>(7.5)</a></div><div class='texpara'><div id='stoptoken.concepts-7.5.sentence-1' class='sentence'>If <span class='texttt'>t</span> and <span class='texttt'>u</span> reference the same stop state, or
if both <span class='texttt'>t</span> and <span class='texttt'>u</span> are disengaged,
<span class='texttt'>t <span class='operator'>=</span><span class='operator'>=</span> u</span> is <span class='texttt'><span class='literal'>true</span></span>; otherwise, it is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.concepts-7.5.sentence-1'>.</a></div></div></li></ul></div></div></div><div class='para' id='stoptoken.concepts-8'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-8'>8</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L741'>#</a></div><div class='texpara'><div id='stoptoken.concepts-8.sentence-1' class='sentence'>An object
whose type models the exposition-only <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source_______'><span class='texttt'><i >stoppable-source</i></span></span></a> concept
can be queried
whether stop has been requested (<span class='texttt'>stop_<span class='shy'></span>requested</span>) and
whether stop is possible (<span class='texttt'>stop_<span class='shy'></span>possible</span>)<a class='hidden_link' href='#stoptoken.concepts-8.sentence-1'>.</a></div> <div id='stoptoken.concepts-8.sentence-2' class='sentence'>It is a factory for associated stop tokens (<span class='texttt'>get_<span class='shy'></span>token</span>), and
a stop request can be made on it (<span class='texttt'>request_<span class='shy'></span>stop</span>)<a class='hidden_link' href='#stoptoken.concepts-8.sentence-2'>.</a></div> <div id='stoptoken.concepts-8.sentence-3' class='sentence'>It maintains a list of registered stop callback invocations
that it executes when a stop request is first made<a class='hidden_link' href='#stoptoken.concepts-8.sentence-3'>.</a></div> <span class='codeblock'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Source<span class='anglebracket'>&gt;</span>
  <span class='keyword'>concept</span> <a class='hidden_link' href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='concept:stoppable-source'><span class='tcode_in_codeblock'><i >stoppable-source</i></span></span></a> <span class='operator'>=</span>                                    <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>requires</span> <span class='parenthesis'>(</span>Source<span class='operator'>&amp;</span> src, <span class='keyword'>const</span> Source csrc<span class='parenthesis'>)</span> <span class='curlybracket'>{</span>         <span class='comment'>// see implicit expression variations (<a href='concepts.equality' title='18.2&emsp;Equality preservation'>[concepts.<span class='shy'></span>equality]</a>)</span>
      <span class='curlybracket'>{</span> csrc<span class='operator'>.</span>get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> stoppable_token;
      <span class='curlybracket'>{</span> csrc<span class='operator'>.</span>stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as___'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>{</span> csrc<span class='operator'>.</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='keyword'>noexcept</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
      <span class='curlybracket'>{</span> src<span class='operator'>.</span>request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='curlybracket'>}</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> <a href='concept.same#concept:same_as' title='18.4.2&emsp;Concept same_&shy;as&emsp;[concept.same]'><span id='conceptref:same_as_____'><span class='tcode_in_codeblock'>same_<span class='shy'></span>as</span></span></a><span class='anglebracket'>&lt;</span><span class='keyword'>bool</span><span class='anglebracket'>&gt;</span>;
    <span class='curlybracket'>}</span>;
</span></div></div><div class='para' id='stoptoken.concepts-9'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-9'>9</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L762'>#</a></div><div class='texpara'><div id='stoptoken.concepts-9.sentence-1' class='sentence'>An object whose type models <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source________'><span class='texttt'><i >stoppable-source</i></span></span></a> has
at most one associated logical stop state<a class='hidden_link' href='#stoptoken.concepts-9.sentence-1'>.</a></div> <div id='stoptoken.concepts-9.sentence-2' class='sentence'>If it has no associated stop state, it is said to be disengaged<a class='hidden_link' href='#stoptoken.concepts-9.sentence-2'>.</a></div> <div id='stoptoken.concepts-9.sentence-3' class='sentence'>Let <span class='texttt'>s</span> be an object whose type models <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source_________'><span class='texttt'><i >stoppable-source</i></span></span></a> and
that is disengaged<a class='hidden_link' href='#stoptoken.concepts-9.sentence-3'>.</a></div> <div id='stoptoken.concepts-9.sentence-4' class='sentence'><span class='texttt'>s<span class='operator'>.</span>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> and <span class='texttt'>s<span class='operator'>.</span>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> shall be <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.concepts-9.sentence-4'>.</a></div></div></div><div class='para' id='stoptoken.concepts-10'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-10'>10</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L770'>#</a></div><div class='texpara'><div id='stoptoken.concepts-10.sentence-1' class='sentence'>Let <span class='texttt'>t</span> be an object whose type models <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source__________'><span class='texttt'><i >stoppable-source</i></span></span></a><a class='hidden_link' href='#stoptoken.concepts-10.sentence-1'>.</a></div> <div id='stoptoken.concepts-10.sentence-2' class='sentence'>If <span class='texttt'>t</span> is disengaged,
<span class='texttt'>t<span class='operator'>.</span>get_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> shall return a disengaged stop token;
otherwise, it shall return
a stop token that is associated with the stop state of <span class='texttt'>t</span><a class='hidden_link' href='#stoptoken.concepts-10.sentence-2'>.</a></div></div></div><div class='para' id='stoptoken.concepts-11'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-11'>11</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L777'>#</a></div><div class='texpara'><div id='stoptoken.concepts-11.sentence-1' class='sentence'>Calls to the member functions
<span class='texttt'>request_<span class='shy'></span>stop</span>, <span class='texttt'>stop_<span class='shy'></span>requested</span>, and <span class='texttt'>stop_<span class='shy'></span>possible</span> and
similarly named member functions
on associated <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token____________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> objects
do not introduce data races<a class='hidden_link' href='#stoptoken.concepts-11.sentence-1'>.</a></div> <div id='stoptoken.concepts-11.sentence-2' class='sentence'>A call to <span class='texttt'>request_<span class='shy'></span>stop</span> that returns <span class='texttt'><span class='literal'>true</span></span> synchronizes with
a call to <span class='texttt'>stop_<span class='shy'></span>requested</span> on
an associated
<a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_____________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a> or <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source___________'><span class='texttt'><i >stoppable-source</i></span></span></a> object
that returns <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stoptoken.concepts-11.sentence-2'>.</a></div> <div id='stoptoken.concepts-11.sentence-3' class='sentence'>Registration of a callback synchronizes with the invocation of that callback<a class='hidden_link' href='#stoptoken.concepts-11.sentence-3'>.</a></div></div></div><div class='para' id='stoptoken.concepts-12'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.concepts-12'>12</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L790'>#</a></div><div class='texpara'><div id='stoptoken.concepts-12.sentence-1' class='sentence'>If the <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source____________'><span class='texttt'><i >stoppable-source</i></span></span></a> is disengaged,
<span class='texttt'>request_<span class='shy'></span>stop</span> shall have no effect and return <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.concepts-12.sentence-1'>.</a></div> <div id='stoptoken.concepts-12.sentence-2' class='sentence'>Otherwise, it shall execute a <a class='hidden_link' href='#def:operation,stop_request' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='def:operation,stop_request'><i >stop request operation</i></span></a>
on the associated stop state<a class='hidden_link' href='#stoptoken.concepts-12.sentence-2'>.</a></div> <div id='stoptoken.concepts-12.sentence-3' class='sentence'>A stop request operation determines
whether the stop state has received a stop request, and
if not, makes a stop request<a class='hidden_link' href='#stoptoken.concepts-12.sentence-3'>.</a></div> <div id='stoptoken.concepts-12.sentence-4' class='sentence'>The determination and making of the stop request shall happen atomically,
as-if by a read-modify-write operation (<a href='intro.races' title='6.9.2.2&emsp;Data races'>[intro.<span class='shy'></span>races]</a>)<a class='hidden_link' href='#stoptoken.concepts-12.sentence-4'>.</a></div> <div id='stoptoken.concepts-12.sentence-5' class='sentence'>If the request was made,
the stop state's registered callback invocations shall be
synchronously executed<a class='hidden_link' href='#stoptoken.concepts-12.sentence-5'>.</a></div> <div id='stoptoken.concepts-12.sentence-6' class='sentence'>If an invocation of a callback exits via an exception
then <span class='texttt'>terminate</span> shall be invoked (<a href='except.terminate' title='14.6.2&emsp;The std&#x200b;::&#x200b;terminate function'>[except.<span class='shy'></span>terminate]</a>)<a class='hidden_link' href='#stoptoken.concepts-12.sentence-6'>.</a></div> <div id='stoptoken.concepts-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stoptoken.concepts-note-2'>2</a></i>:&ensp;<div id='stoptoken.concepts-12.sentence-7' class='sentence'>No constraint is placed on the order
in which the callback invocations are executed<a class='hidden_link' href='#stoptoken.concepts-12.sentence-7'>.</a></div> —&nbsp;<i>end note</i>]</div></div> <div id='stoptoken.concepts-12.sentence-8' class='sentence'><span class='texttt'>request_<span class='shy'></span>stop</span> shall return <span class='texttt'><span class='literal'>true</span></span> if a stop request was made, and
<span class='texttt'><span class='literal'>false</span></span> otherwise<a class='hidden_link' href='#stoptoken.concepts-12.sentence-8'>.</a></div> <div id='stoptoken.concepts-12.sentence-9' class='sentence'>After a call to <span class='texttt'>request_<span class='shy'></span>stop</span> either
a call to <span class='texttt'>stop_<span class='shy'></span>possible</span> shall return <span class='texttt'><span class='literal'>false</span></span> or
a call to <span class='texttt'>stop_<span class='shy'></span>requested</span> shall return <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stoptoken.concepts-12.sentence-9'>.</a></div> <div id='stoptoken.concepts-note-3' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stoptoken.concepts-note-3'>3</a></i>:&ensp;<div id='stoptoken.concepts-12.sentence-10' class='sentence'>A stop request includes notifying
all condition variables of type <span class='texttt'>condition_<span class='shy'></span>variable_<span class='shy'></span>any</span>
temporarily registered during
an interruptible wait (<a href='thread.condvarany.intwait' title='32.7.5.3&emsp;Interruptible waits'>[thread.<span class='shy'></span>condvarany.<span class='shy'></span>intwait]</a>)<a class='hidden_link' href='#stoptoken.concepts-12.sentence-10'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div id='stoptoken' class='section'><h3 ><a class='secnum' href='#stoptoken' style='min-width:80pt'>32.3.4</a> Class <span class='texttt'>stop_<span class='shy'></span>token</span> <a class='abbr_ref' href='stoptoken'>[stoptoken]</a></h3><div class='texpara'><a class='index' id='lib:stop_token'></a></div><div id='stoptoken.general' class='section'><h4 ><a class='secnum' href='#stoptoken.general' style='min-width:95pt'>32.3.4.1</a> General <a class='abbr_ref' href='stoptoken.general'>[stoptoken.general]</a></h4><div class='para' id='stoptoken.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L826'>#</a></div><div class='texpara'><div id='stoptoken.general-1.sentence-1' class='sentence'><a class='index' id='lib:stop_token_'></a>The class <span class='texttt'>stop_<span class='shy'></span>token</span> models the concept <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token______________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a><a class='hidden_link' href='#stoptoken.general-1.sentence-1'>.</a></div> <div id='stoptoken.general-1.sentence-2' class='sentence'>It shares ownership of its stop state, if any,
with its associated <span class='texttt'>stop_<span class='shy'></span>source</span> object (<a href='#stopsource' title='32.3.5&emsp;Class stop_&shy;source'>[stopsource]</a>) and
any <span class='texttt'>stop_<span class='shy'></span>token</span> objects to which it compares equal<a class='hidden_link' href='#stoptoken.general-1.sentence-2'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> stop_token <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> callback_type <span class='operator'>=</span> stop_callback<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span>;

    stop_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

    <span class='comment'>// <a href='#stoptoken.mem' title='32.3.4.2&emsp;Member functions'>[stoptoken.<span class='shy'></span>mem]</a>, member functions</span>
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>stop_token<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> stop_token<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    shared_ptr<span class='anglebracket'>&lt;</span><i ><span class='texttt'>unspecified</span></i><span class='anglebracket'>&gt;</span> <i >stop-state</i>;                           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div><div class='para' id='stoptoken.general-2'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L856'>#</a></div><div class='texpara'><div id='stoptoken.general-2.sentence-1' class='sentence'><span class='texttt'><i >stop-state</i></span> refers to the <span class='texttt'>stop_<span class='shy'></span>token</span>'s associated stop state<a class='hidden_link' href='#stoptoken.general-2.sentence-1'>.</a></div> <div id='stoptoken.general-2.sentence-2' class='sentence'>A <span class='texttt'>stop_<span class='shy'></span>token</span> object is disengaged when <span class='texttt'><i >stop-state</i></span> is empty<a class='hidden_link' href='#stoptoken.general-2.sentence-2'>.</a></div></div></div></div><div id='stoptoken.mem' class='section'><h4 ><a class='secnum' href='#stoptoken.mem' style='min-width:95pt'>32.3.4.2</a> Member functions <a class='abbr_ref' href='stoptoken.mem'>[stoptoken.mem]</a></h4><div class='texpara'><div id='lib:stop_token,swap'><div id='lib:swap,stop_token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,stop_token'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>stop_token<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stoptoken.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L868'>#</a></div><div class='texpara'><div id='stoptoken.mem-1.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >stop-state</i><span class='operator'>.</span>swap<span class='parenthesis'>(</span>rhs<span class='operator'>.</span><i >stop-state</i><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:stop_token,stop_requested'><div id='lib:stop_requested,stop_token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_requested,stop_token'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stoptoken.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L882'>#</a></div><div class='texpara'><div id='stoptoken.mem-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> if <span class='texttt'><i >stop-state</i></span> refers to a stop state
that has received a stop request;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stoptoken.mem-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:stop_token,stop_possible'><div id='lib:stop_possible,stop_token'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_possible,stop_token'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stoptoken.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L895'>#</a></div><div class='texpara'><div id='stoptoken.mem-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>false</span></span> if
<ul class='itemize'><li id='stoptoken.mem-3.1'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#stoptoken.mem-3.1'>(3.1)</a></div><span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> is disengaged, or</li><li id='stoptoken.mem-3.2'><div class='marginalizedparent' style='left:-39mm'><a class='marginalized' href='#stoptoken.mem-3.2'>(3.2)</a></div>a stop request was not made
      and there are no associated <span class='texttt'>stop_<span class='shy'></span>source</span> objects;</li></ul>
otherwise, <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stoptoken.mem-3.sentence-1'>.</a></div></div></div></div></div></div><div id='stopsource' class='section'><h3 ><a class='secnum' href='#stopsource' style='min-width:80pt'>32.3.5</a> Class <span class='texttt'>stop_<span class='shy'></span>source</span> <a class='abbr_ref' href='stopsource'>[stopsource]</a></h3><div class='texpara'><a class='index' id='lib:stop_source'></a></div><div id='stopsource.general' class='section'><h4 ><a class='secnum' href='#stopsource.general' style='min-width:95pt'>32.3.5.1</a> General <a class='abbr_ref' href='stopsource.general'>[stopsource.general]</a></h4><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> stop_source <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#stopsource.cons' title='32.3.5.2&emsp;Constructors, copy, and assignment'>[stopsource.<span class='shy'></span>cons]</a>, constructors, copy, and assignment</span>
    stop_source<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>explicit</span> stop_source<span class='parenthesis'>(</span>nostopstate_t<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>

    <span class='comment'>// <a href='#stopsource.mem' title='32.3.5.3&emsp;Member functions'>[stopsource.<span class='shy'></span>mem]</a>, member functions</span>
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>stop_source<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>bool</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> stop_source<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    shared_ptr<span class='anglebracket'>&lt;</span><i ><span class='texttt'>unspecified</span></i><span class='anglebracket'>&gt;</span> <i >stop-state</i>;                         <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='stopsource.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L932'>#</a></div><div class='texpara'><div id='stopsource.general-1.sentence-1' class='sentence'><span class='texttt'><i >stop-state</i></span> refers to the <span class='texttt'>stop_<span class='shy'></span>source</span>'s associated stop state<a class='hidden_link' href='#stopsource.general-1.sentence-1'>.</a></div> <div id='stopsource.general-1.sentence-2' class='sentence'>A <span class='texttt'>stop_<span class='shy'></span>source</span> object is disengaged when <span class='texttt'><i >stop-state</i></span> is empty<a class='hidden_link' href='#stopsource.general-1.sentence-2'>.</a></div></div></div><div class='para' id='stopsource.general-2'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L936'>#</a></div><div class='texpara'><div id='stopsource.general-2.sentence-1' class='sentence'><span class='texttt'>stop_<span class='shy'></span>source</span> models
<a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source_____________'><span class='texttt'><i >stoppable-source</i></span></span></a>,
<a href='concepts.object#concept:copyable' title='18.6&emsp;Object concepts&emsp;[concepts.object]'><span id='conceptref:copyable_'><span class='texttt'>copyable</span></span></a>,
<a href='concept.equalitycomparable#concept:equality_comparable' title='18.5.4&emsp;Concept equality_&shy;comparable&emsp;[concept.equalitycomparable]'><span id='conceptref:equality_comparable_'><span class='texttt'>equality_<span class='shy'></span>comparable</span></span></a>, and
<a href='concept.swappable#concept:swappable' title='18.4.9&emsp;Concept swappable&emsp;[concept.swappable]'><span id='conceptref:swappable'><span class='texttt'>swappable</span></span></a><a class='hidden_link' href='#stopsource.general-2.sentence-1'>.</a></div></div></div></div><div id='stopsource.cons' class='section'><h4 ><a class='secnum' href='#stopsource.cons' style='min-width:95pt'>32.3.5.2</a> Constructors, copy, and assignment <a class='abbr_ref' href='stopsource.cons'>[stopsource.cons]</a></h4><div class='texpara'><div id='lib:stop_source,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_source,constructor'>🔗</a></div><code class='itemdeclcode'>stop_source<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='stopsource.cons-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.cons-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L951'>#</a></div><div class='texpara'><div id='stopsource.cons-1.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >stop-state</i></span> with a pointer to a new stop state<a class='hidden_link' href='#stopsource.cons-1.sentence-1'>.</a></div></div></div></div><div class='para' id='stopsource.cons-2'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.cons-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L955'>#</a></div><div class='texpara'><div id='stopsource.cons-2.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span>
and <span class='texttt'>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stopsource.cons-2.sentence-1'>.</a></div></div></div></div><div class='para' id='stopsource.cons-3'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.cons-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L960'>#</a></div><div class='texpara'><div id='stopsource.cons-3.sentence-1' class='sentence'><i >Throws</i>: <span class='texttt'>bad_<span class='shy'></span>alloc</span> if memory cannot be allocated for the stop state<a class='hidden_link' href='#stopsource.cons-3.sentence-1'>.</a></div></div></div></div></div><div id='stopsource.mem' class='section'><h4 ><a class='secnum' href='#stopsource.mem' style='min-width:95pt'>32.3.5.3</a> Member functions <a class='abbr_ref' href='stopsource.mem'>[stopsource.mem]</a></h4><div class='texpara'><div id='lib:stop_source,swap'><div id='lib:swap,stop_source'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:swap,stop_source'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>stop_source<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stopsource.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L973'>#</a></div><div class='texpara'><div id='stopsource.mem-1.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><i >stop-state</i><span class='operator'>.</span>swap<span class='parenthesis'>(</span>rhs<span class='operator'>.</span><i >stop-state</i><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='texpara'><div id='lib:stop_source,get_token'><div id='lib:get_token,stop_source'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:get_token,stop_source'>🔗</a></div><code class='itemdeclcode'>stop_token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stopsource.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L987'>#</a></div><div class='texpara'><div id='stopsource.mem-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'>stop_<span class='shy'></span>token<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> if <span class='texttt'>stop_<span class='shy'></span>possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span>;
otherwise a new associated <span class='texttt'>stop_<span class='shy'></span>token</span> object;
i.e., its <span class='texttt'><i >stop-state</i></span> member is equal to
the <span class='texttt'><i >stop-state</i></span> member of <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#stopsource.mem-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:stop_source,stop_possible'><div id='lib:stop_possible,stop_source'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_possible,stop_source'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stopsource.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1001'>#</a></div><div class='texpara'><div id='stopsource.mem-3.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='texttt'><i >stop-state</i></span> <span class='operator'>!</span><span class='operator'>=</span> <span class='literal'>nullptr</span></span><a class='hidden_link' href='#stopsource.mem-3.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:stop_source,stop_requested'><div id='lib:stop_requested,stop_source'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_requested,stop_source'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stopsource.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1012'>#</a></div><div class='texpara'><div id='stopsource.mem-4.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> if <span class='texttt'><i >stop-state</i></span> refers to a stop state
that has received a stop request;
otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stopsource.mem-4.sentence-1'>.</a></div></div></div></div><div class='texpara'><div id='lib:stop_source,request_stop'><div id='lib:request_stop,stop_source'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:request_stop,stop_source'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div></div></div><div class='para' id='stopsource.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1025'>#</a></div><div class='texpara'><div id='stopsource.mem-5.sentence-1' class='sentence'><i >Effects</i>: Executes a stop request operation (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>) on
the associated stop state, if any<a class='hidden_link' href='#stopsource.mem-5.sentence-1'>.</a></div></div></div></div></div></div><div id='stopcallback' class='section'><h3 ><a class='secnum' href='#stopcallback' style='min-width:80pt'>32.3.6</a> Class template <span class='texttt'>stop_<span class='shy'></span>callback</span> <a class='abbr_ref' href='stopcallback'>[stopcallback]</a></h3><div class='texpara'><a class='index' id='lib:stop_callback'></a></div><div id='stopcallback.general' class='section'><h4 ><a class='secnum' href='#stopcallback.general' style='min-width:95pt'>32.3.6.1</a> General <a class='abbr_ref' href='stopcallback.general'>[stopcallback.general]</a></h4><div class='para' id='stopcallback.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1036'>#</a></div><div class='texpara'><span id='lib:stop_callback_'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_callback_'>🔗</a></div><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> stop_callback <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> callback_type <span class='operator'>=</span> CallbackFn;

    <span class='comment'>// <a href='#stopcallback.cons' title='32.3.6.2&emsp;Constructors and destructor'>[stopcallback.<span class='shy'></span>cons]</a>, constructors and destructor</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
      <span class='keyword'>explicit</span> stop_callback<span class='parenthesis'>(</span><span class='keyword'>const</span> stop_token<span class='operator'>&amp;</span> st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
      <span class='keyword'>explicit</span> stop_callback<span class='parenthesis'>(</span>stop_token<span class='operator'>&amp;</span><span class='operator'>&amp;</span> st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
    <span class='operator'>~</span>stop_callback<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    stop_callback<span class='parenthesis'>(</span><span class='keyword'>const</span> stop_callback<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    stop_callback<span class='parenthesis'>(</span>stop_callback<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    stop_callback<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> stop_callback<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    stop_callback<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>stop_callback<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    CallbackFn <i >callback-fn</i>;                                     <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
    stop_callback<span class='parenthesis'>(</span>stop_token, CallbackFn<span class='parenthesis'>)</span> <span class='operator'>-</span><span class='anglebracket'>&gt;</span> stop_callback<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></span></div></div><div class='para' id='stopcallback.general-2'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1068'>#</a></div><div class='texpara'><div id='stopcallback.general-2.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'>stop_<span class='shy'></span>callback</span> is instantiated with an argument for the
template parameter <span class='texttt'>CallbackFn</span>
that satisfies both <a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable_'><span class='texttt'>invocable</span></span></a>
and <a href='concept.destructible#concept:destructible' title='18.4.10&emsp;Concept destructible&emsp;[concept.destructible]'><span id='conceptref:destructible'><span class='texttt'>destructible</span></span></a><a class='hidden_link' href='#stopcallback.general-2.sentence-1'>.</a></div></div></div><div class='para' id='stopcallback.general-3'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.general-3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1075'>#</a></div><div class='texpara'><div id='stopcallback.general-3.sentence-1' class='sentence'><i >Remarks</i>: For a type <span class='texttt'>Initializer</span>,
if
<span class='texttt'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for_________'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, stop_<span class='shy'></span>token, Initializer<span class='anglebracket'>&gt;</span></span>
is satisfied, then
<span class='texttt'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for__________'><span class='texttt'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, stop_<span class='shy'></span>token, Initializer<span class='anglebracket'>&gt;</span></span> is modeled<a class='hidden_link' href='#stopcallback.general-3.sentence-1'>.</a></div> <div id='stopcallback.general-3.sentence-2' class='sentence'>The exposition-only <span class='texttt'><i >callback-fn</i></span> member is
the associated callback function (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>) of
<span class='texttt'>stop_<span class='shy'></span>callback<span class='anglebracket'>&lt;</span><br>CallbackFn<span class='anglebracket'>&gt;</span></span> objects<a class='hidden_link' href='#stopcallback.general-3.sentence-2'>.</a></div></div></div></div><div id='stopcallback.cons' class='section'><h4 ><a class='secnum' href='#stopcallback.cons' style='min-width:95pt'>32.3.6.2</a> Constructors and destructor <a class='abbr_ref' href='stopcallback.cons'>[stopcallback.cons]</a></h4><div class='texpara'><div id='lib:stop_callback,constructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_callback,constructor'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
  <span class='keyword'>explicit</span> stop_callback<span class='parenthesis'>(</span><span class='keyword'>const</span> stop_token<span class='operator'>&amp;</span> st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;

<span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
  <span class='keyword'>explicit</span> stop_callback<span class='parenthesis'>(</span>stop_token<span class='operator'>&amp;</span><span class='operator'>&amp;</span> st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='stopcallback.cons-1'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.cons-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1100'>#</a></div><div class='texpara'><div id='stopcallback.cons-1.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'>CallbackFn</span> and <span class='texttt'>Initializer</span> satisfy
<span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from_____'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span></span><a class='hidden_link' href='#stopcallback.cons-1.sentence-1'>.</a></div></div></div></div><div class='para' id='stopcallback.cons-2'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.cons-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1105'>#</a></div><div class='texpara'><div id='stopcallback.cons-2.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >callback-fn</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>init<span class='parenthesis'>)</span></span>
and executes a stoppable callback registration (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>)<a class='hidden_link' href='#stopcallback.cons-2.sentence-1'>.</a></div> <div id='stopcallback.cons-2.sentence-2' class='sentence'>If a callback is registered with <span class='texttt'>st</span>'s shared stop state,
then <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span> acquires shared ownership of that stop state<a class='hidden_link' href='#stopcallback.cons-2.sentence-2'>.</a></div></div></div></div><div class='texpara'><div id='lib:stop_callback,destructor'><div class='itemdecl'><div class='marginalizedparent'><a class='itemDeclLink' href='#lib:stop_callback,destructor'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>stop_callback<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div></div><div class='para' id='stopcallback.cons-3'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.cons-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1119'>#</a></div><div class='texpara'><div id='stopcallback.cons-3.sentence-1' class='sentence'><i >Effects</i>: Executes a stoppable callback deregistration (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>) and
releases ownership of the stop state, if any<a class='hidden_link' href='#stopcallback.cons-3.sentence-1'>.</a></div></div></div></div></div></div><div id='stoptoken.never' class='section'><h3 ><a class='secnum' href='#stoptoken.never' style='min-width:80pt'>32.3.7</a> Class <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token</span> <a class='abbr_ref' href='stoptoken.never'>[stoptoken.never]</a></h3><div class='para' id='stoptoken.never-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.never-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1127'>#</a></div><div class='texpara'><div id='stoptoken.never-1.sentence-1' class='sentence'>The class <span class='texttt'>never_<span class='shy'></span>stop_<span class='shy'></span>token</span> models
the <a href='#concept:unstoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:unstoppable_token__'><span class='texttt'>unstoppable_<span class='shy'></span>token</span></span></a> concept<a class='hidden_link' href='#stoptoken.never-1.sentence-1'>.</a></div> <div id='stoptoken.never-1.sentence-2' class='sentence'>It provides a stop token interface,
but also provides static information
that a stop is never possible nor requested<a class='hidden_link' href='#stoptoken.never-1.sentence-2'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> never_stop_token <span class='curlybracket'>{</span>
    <span class='keyword'>struct</span> <i >callback-type</i> <span class='curlybracket'>{</span>                                      <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>explicit</span> <i >callback-type</i><span class='parenthesis'>(</span>never_stop_token, <span class='keyword'>auto</span><span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span><span class='curlybracket'>}</span>
    <span class='curlybracket'>}</span>;
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span><span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> callback_type <span class='operator'>=</span> <i >callback-type</i>;

    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>false</span>; <span class='curlybracket'>}</span>

    <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> never_stop_token<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='stoptoken.inplace' class='section'><h3 ><a class='secnum' href='#stoptoken.inplace' style='min-width:80pt'>32.3.8</a> Class <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span> <a class='abbr_ref' href='stoptoken.inplace'>[stoptoken.inplace]</a></h3><div id='stoptoken.inplace.general' class='section'><h4 ><a class='secnum' href='#stoptoken.inplace.general' style='min-width:95pt'>32.3.8.1</a> General <a class='abbr_ref' href='stoptoken.inplace.general'>[stoptoken.inplace.general]</a></h4><div class='para' id='stoptoken.inplace.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1155'>#</a></div><div class='texpara'><div id='stoptoken.inplace.general-1.sentence-1' class='sentence'>The class <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span> models
the concept <a href='#concept:stoppable_token' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable_token_______________'><span class='texttt'>stoppable_<span class='shy'></span>token</span></span></a><a class='hidden_link' href='#stoptoken.inplace.general-1.sentence-1'>.</a></div> <div id='stoptoken.inplace.general-1.sentence-2' class='sentence'>It references the stop state of
its associated <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> object (<a href='#stopsource.inplace' title='32.3.9&emsp;Class inplace_&shy;stop_&shy;source'>[stopsource.<span class='shy'></span>inplace]</a>),
if any<a class='hidden_link' href='#stoptoken.inplace.general-1.sentence-2'>.</a></div> <span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> inplace_stop_token <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> callback_type <span class='operator'>=</span> inplace_stop_callback<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span>;

    inplace_stop_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>default</span>;
    <span class='keyword'>bool</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> inplace_stop_token<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='operator'>=</span> <span class='keyword'>default</span>;

    <span class='comment'>// <a href='#stoptoken.inplace.mem' title='32.3.8.2&emsp;Member functions'>[stoptoken.<span class='shy'></span>inplace.<span class='shy'></span>mem]</a>, member functions</span>
    <span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>void</span> swap<span class='parenthesis'>(</span>inplace_stop_token<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    <span class='keyword'>const</span> inplace_stop_source<span class='operator'>*</span> <i >stop-source</i> <span class='operator'>=</span> <span class='literal'>nullptr</span>;           <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='stoptoken.inplace.mem' class='section'><h4 ><a class='secnum' href='#stoptoken.inplace.mem' style='min-width:95pt'>32.3.8.2</a> Member functions <a class='abbr_ref' href='stoptoken.inplace.mem'>[stoptoken.inplace.mem]</a></h4><div class='texpara'><div class='itemdecl' id='stoptoken.inplace.mem-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#stoptoken.inplace.mem-itemdecl:1'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>void</span> swap<span class='parenthesis'>(</span>inplace_stop_token<span class='operator'>&amp;</span> rhs<span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stoptoken.inplace.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1189'>#</a></div><div class='texpara'><div id='stoptoken.inplace.mem-1.sentence-1' class='sentence'><i >Effects</i>: Exchanges the values of <span class='texttt'><i >stop-source</i></span> and <span class='texttt'>rhs<span class='operator'>.</span><span class='texttt'><i >stop-source</i></span></span><a class='hidden_link' href='#stoptoken.inplace.mem-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='stoptoken.inplace.mem-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#stoptoken.inplace.mem-itemdecl:2'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stoptoken.inplace.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1199'>#</a></div><div class='texpara'><div id='stoptoken.inplace.mem-2.sentence-1' class='sentence'><i >Effects</i>: Equivalent to:
<span class='codeblock'><span class='keyword'>return</span> <i >stop-source</i> <span class='operator'>!</span><span class='operator'>=</span> <span class='literal'>nullptr</span> <span class='operator'>&amp;</span><span class='operator'>&amp;</span> <i >stop-source</i><span class='operator'>-</span><span class='anglebracket'>&gt;</span>stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</span></div></div></div></div><div class='para nonNormativeOnly' id='stoptoken.inplace.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1206'>#</a></div><div class='texpara'><div id='stoptoken.inplace.mem-note-1' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stoptoken.inplace.mem-note-1'>1</a></i>:&ensp;<div id='stoptoken.inplace.mem-3.sentence-1' class='sentence'>As specified in <a href='basic.life' title='6.7.4&emsp;Lifetime'>[basic.<span class='shy'></span>life]</a>,
the behavior of <span class='texttt'>stop_<span class='shy'></span>requested</span> is undefined
unless the call strongly happens before the start of
the destructor of the associated <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> object, if any<a class='hidden_link' href='#stoptoken.inplace.mem-3.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div><div class='texpara'><div class='itemdecl' id='stoptoken.inplace.mem-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#stoptoken.inplace.mem-itemdecl:3'>🔗</a></div><code class='itemdeclcode'>stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stoptoken.inplace.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1220'>#</a></div><div class='texpara'><div id='stoptoken.inplace.mem-4.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='texttt'><i >stop-source</i></span> <span class='operator'>!</span><span class='operator'>=</span> <span class='literal'>nullptr</span></span><a class='hidden_link' href='#stoptoken.inplace.mem-4.sentence-1'>.</a></div></div></div></div><div class='para nonNormativeOnly' id='stoptoken.inplace.mem-5'><div class='marginalizedparent'><a class='marginalized' href='#stoptoken.inplace.mem-5'>5</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1224'>#</a></div><div class='texpara'><div id='stoptoken.inplace.mem-note-2' class='note'><div class='texpara'>[<i>Note&nbsp;<a href='#stoptoken.inplace.mem-note-2'>2</a></i>:&ensp;<div id='stoptoken.inplace.mem-5.sentence-1' class='sentence'>As specified in <a href='basic.stc.general' title='6.7.6.1&emsp;General'>[basic.<span class='shy'></span>stc.<span class='shy'></span>general]</a>,
the behavior of <span class='texttt'>stop_<span class='shy'></span>possible</span> is implementation-defined
unless the call strongly happens before
the end of the storage duration of
the associated <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> object, if any<a class='hidden_link' href='#stoptoken.inplace.mem-5.sentence-1'>.</a></div> —&nbsp;<i>end note</i>]</div></div></div></div></div></div></div><div id='stopsource.inplace' class='section'><h3 ><a class='secnum' href='#stopsource.inplace' style='min-width:80pt'>32.3.9</a> Class <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> <a class='abbr_ref' href='stopsource.inplace'>[stopsource.inplace]</a></h3><div id='stopsource.inplace.general' class='section'><h4 ><a class='secnum' href='#stopsource.inplace.general' style='min-width:95pt'>32.3.9.1</a> General <a class='abbr_ref' href='stopsource.inplace.general'>[stopsource.inplace.general]</a></h4><div class='para' id='stopsource.inplace.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1238'>#</a></div><div class='texpara'><div id='stopsource.inplace.general-1.sentence-1' class='sentence'>The class <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>source</span> models <a href='#concept:stoppable-source' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-source______________'><span class='texttt'><i >stoppable-source</i></span></span></a><a class='hidden_link' href='#stopsource.inplace.general-1.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> inplace_stop_source <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='#stopsource.inplace.cons' title='32.3.9.2&emsp;Constructors'>[stopsource.<span class='shy'></span>inplace.<span class='shy'></span>cons]</a>, constructors</span>
    <span class='keyword'>constexpr</span> inplace_stop_source<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;

    inplace_stop_source<span class='parenthesis'>(</span>inplace_stop_source<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_source<span class='parenthesis'>(</span><span class='keyword'>const</span> inplace_stop_source<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_source<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>inplace_stop_source<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_source<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> inplace_stop_source<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>inplace_stop_source<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='#stopsource.inplace.mem' title='32.3.9.3&emsp;Member functions'>[stopsource.<span class='shy'></span>inplace.<span class='shy'></span>mem]</a>, stop handling</span>
    <span class='keyword'>constexpr</span> inplace_stop_token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>static</span> <span class='keyword'>constexpr</span> <span class='keyword'>bool</span> stop_possible<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span> <span class='curlybracket'>{</span> <span class='keyword'>return</span> <span class='literal'>true</span>; <span class='curlybracket'>}</span>
    <span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
    <span class='keyword'>bool</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div><div id='stopsource.inplace.cons' class='section'><h4 ><a class='secnum' href='#stopsource.inplace.cons' style='min-width:95pt'>32.3.9.2</a> Constructors <a class='abbr_ref' href='stopsource.inplace.cons'>[stopsource.inplace.cons]</a></h4><div class='texpara'><div class='itemdecl' id='stopsource.inplace.cons-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopsource.inplace.cons-itemdecl:1'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>constexpr</span> inplace_stop_source<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stopsource.inplace.cons-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.cons-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1270'>#</a></div><div class='texpara'><div id='stopsource.inplace.cons-1.sentence-1' class='sentence'><i >Effects</i>: Initializes a new stop state inside <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span><a class='hidden_link' href='#stopsource.inplace.cons-1.sentence-1'>.</a></div></div></div></div><div class='para' id='stopsource.inplace.cons-2'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.cons-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1274'>#</a></div><div class='texpara'><div id='stopsource.inplace.cons-2.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stopsource.inplace.cons-2.sentence-1'>.</a></div></div></div></div></div><div id='stopsource.inplace.mem' class='section'><h4 ><a class='secnum' href='#stopsource.inplace.mem' style='min-width:95pt'>32.3.9.3</a> Member functions <a class='abbr_ref' href='stopsource.inplace.mem'>[stopsource.inplace.mem]</a></h4><div class='texpara'><div class='itemdecl' id='stopsource.inplace.mem-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopsource.inplace.mem-itemdecl:1'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>constexpr</span> inplace_stop_token get_token<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stopsource.inplace.mem-1'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.mem-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1286'>#</a></div><div class='texpara'><div id='stopsource.inplace.mem-1.sentence-1' class='sentence'><i >Returns</i>: A new associated <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>token</span> object
whose <span class='texttt'><i >stop-source</i></span> member is equal to <span class='texttt'><span class='keyword'>this</span></span><a class='hidden_link' href='#stopsource.inplace.mem-1.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='stopsource.inplace.mem-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopsource.inplace.mem-itemdecl:2'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> stop_requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>const</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stopsource.inplace.mem-2'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.mem-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1297'>#</a></div><div class='texpara'><div id='stopsource.inplace.mem-2.sentence-1' class='sentence'><i >Returns</i>: <span class='texttt'><span class='literal'>true</span></span> if the stop state inside <span class='texttt'><span class='operator'>*</span><span class='keyword'>this</span></span>
has received a stop request; otherwise, <span class='texttt'><span class='literal'>false</span></span><a class='hidden_link' href='#stopsource.inplace.mem-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='stopsource.inplace.mem-itemdecl:3'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopsource.inplace.mem-itemdecl:3'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>bool</span> request_stop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
</code></div></div><div class='para' id='stopsource.inplace.mem-3'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.mem-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1308'>#</a></div><div class='texpara'><div id='stopsource.inplace.mem-3.sentence-1' class='sentence'><i >Effects</i>: Executes a stop request operation (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>)<a class='hidden_link' href='#stopsource.inplace.mem-3.sentence-1'>.</a></div></div></div></div><div class='para' id='stopsource.inplace.mem-4'><div class='marginalizedparent'><a class='marginalized' href='#stopsource.inplace.mem-4'>4</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1312'>#</a></div><div class='texpara'><div id='stopsource.inplace.mem-4.sentence-1' class='sentence'><i >Postconditions</i>: <span class='texttt'>stop_<span class='shy'></span>requested<span class='parenthesis'>(</span><span class='parenthesis'>)</span></span> is <span class='texttt'><span class='literal'>true</span></span><a class='hidden_link' href='#stopsource.inplace.mem-4.sentence-1'>.</a></div></div></div></div></div></div><div id='stopcallback.inplace' class='section'><h3 ><a class='secnum' href='#stopcallback.inplace' style='min-width:80pt'>32.3.10</a> Class template <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>callback</span> <a class='abbr_ref' href='stopcallback.inplace'>[stopcallback.inplace]</a></h3><div id='stopcallback.inplace.general' class='section'><h4 ><a class='secnum' href='#stopcallback.inplace.general' style='min-width:95pt'>32.3.10.1</a> General <a class='abbr_ref' href='stopcallback.inplace.general'>[stopcallback.inplace.general]</a></h4><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std <span class='curlybracket'>{</span>
  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
  <span class='keyword'>class</span> inplace_stop_callback <span class='curlybracket'>{</span>
  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='keyword'>using</span> callback_type <span class='operator'>=</span> CallbackFn;

    <span class='comment'>// <a href='#stopcallback.inplace.cons' title='32.3.10.2&emsp;Constructors and destructor'>[stopcallback.<span class='shy'></span>inplace.<span class='shy'></span>cons]</a>, constructors and destructor</span>
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
      <span class='keyword'>explicit</span> inplace_stop_callback<span class='parenthesis'>(</span>inplace_stop_token st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
        <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
    <span class='operator'>~</span>inplace_stop_callback<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    inplace_stop_callback<span class='parenthesis'>(</span>inplace_stop_callback<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_callback<span class='parenthesis'>(</span><span class='keyword'>const</span> inplace_stop_callback<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_callback<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span>inplace_stop_callback<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    inplace_stop_callback<span class='operator'>&amp;</span> <span class='keyword'>operator</span><span class='operator'>=</span><span class='parenthesis'>(</span><span class='keyword'>const</span> inplace_stop_callback<span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;

  <span class='keyword'>private</span><span class='operator'>:</span>
    CallbackFn <i >callback-fn</i>;                                     <span class='comment'>// <i >exposition only</i></span>
  <span class='curlybracket'>}</span>;

  <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> CallbackFn<span class='anglebracket'>&gt;</span>
    inplace_stop_callback<span class='parenthesis'>(</span>inplace_stop_token, CallbackFn<span class='parenthesis'>)</span>
      <span class='operator'>-</span><span class='anglebracket'>&gt;</span> inplace_stop_callback<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span>;
<span class='curlybracket'>}</span>
</span></div><div class='para' id='stopcallback.inplace.general-1'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.inplace.general-1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1349'>#</a></div><div class='texpara'><div id='stopcallback.inplace.general-1.sentence-1' class='sentence'><i >Mandates</i>: <span class='texttt'>CallbackFn</span> satisfies both
<a href='concept.invocable#concept:invocable' title='18.7.2&emsp;Concept invocable&emsp;[concept.invocable]'><span id='conceptref:invocable__'><span class='texttt'>invocable</span></span></a> and <a href='concept.destructible#concept:destructible' title='18.4.10&emsp;Concept destructible&emsp;[concept.destructible]'><span id='conceptref:destructible_'><span class='texttt'>destructible</span></span></a><a class='hidden_link' href='#stopcallback.inplace.general-1.sentence-1'>.</a></div></div></div><div class='para' id='stopcallback.inplace.general-2'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.inplace.general-2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1354'>#</a></div><div class='texpara'><div id='stopcallback.inplace.general-2.sentence-1' class='sentence'><i >Remarks</i>: For a type <span class='texttt'>Initializer</span>, if
<span class='codeblock'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for___________'><span class='tcode_in_codeblock'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, inplace_stop_token, Initializer<span class='anglebracket'>&gt;</span>
</span>
is satisfied, then
<span class='codeblock'><a href='#concept:stoppable-callback-for' title='32.3.3&emsp;Stop token concepts&emsp;[stoptoken.concepts]'><span id='conceptref:stoppable-callback-for____________'><span class='tcode_in_codeblock'><i >stoppable-callback-for</i></span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, inplace_stop_token, Initializer<span class='anglebracket'>&gt;</span>
</span>
is modeled<a class='hidden_link' href='#stopcallback.inplace.general-2.sentence-1'>.</a></div> <div id='stopcallback.inplace.general-2.sentence-2' class='sentence'>For an <span class='texttt'>inplace_<span class='shy'></span>stop_<span class='shy'></span>callback<span class='anglebracket'>&lt;</span>CallbackFn<span class='anglebracket'>&gt;</span></span> object,
the exposition-only <span class='texttt'><i >callback-fn</i></span> member is
its associated callback function (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>)<a class='hidden_link' href='#stopcallback.inplace.general-2.sentence-2'>.</a></div></div></div></div><div id='stopcallback.inplace.cons' class='section'><h4 ><a class='secnum' href='#stopcallback.inplace.cons' style='min-width:95pt'>32.3.10.2</a> Constructors and destructor <a class='abbr_ref' href='stopcallback.inplace.cons'>[stopcallback.inplace.cons]</a></h4><div class='texpara'><div class='itemdecl' id='stopcallback.inplace.cons-itemdecl:1'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopcallback.inplace.cons-itemdecl:1'>🔗</a></div><code class='itemdeclcode'><span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Initializer<span class='anglebracket'>&gt;</span>
  <span class='keyword'>explicit</span> inplace_stop_callback<span class='parenthesis'>(</span>inplace_stop_token st, Initializer<span class='operator'>&amp;</span><span class='operator'>&amp;</span> init<span class='parenthesis'>)</span>
    <span class='keyword'>noexcept</span><span class='parenthesis'>(</span>is_nothrow_constructible_v<span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='stopcallback.inplace.cons-1'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.inplace.cons-1'>1</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1378'>#</a></div><div class='texpara'><div id='stopcallback.inplace.cons-1.sentence-1' class='sentence'><i >Constraints</i>: <span class='texttt'><a href='concept.constructible#concept:constructible_from' title='18.4.11&emsp;Concept constructible_&shy;from&emsp;[concept.constructible]'><span id='conceptref:constructible_from______'><span class='texttt'>constructible_<span class='shy'></span>from</span></span></a><span class='anglebracket'>&lt;</span>CallbackFn, Initializer<span class='anglebracket'>&gt;</span></span> is satisfied<a class='hidden_link' href='#stopcallback.inplace.cons-1.sentence-1'>.</a></div></div></div></div><div class='para' id='stopcallback.inplace.cons-2'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.inplace.cons-2'>2</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1382'>#</a></div><div class='texpara'><div id='stopcallback.inplace.cons-2.sentence-1' class='sentence'><i >Effects</i>: Initializes <span class='texttt'><i >callback-fn</i></span> with <span class='texttt'>std<span class='operator'>&#x200b;::&#x200b;</span>forward<span class='anglebracket'>&lt;</span>Initializer<span class='anglebracket'>&gt;</span><span class='parenthesis'>(</span>init<span class='parenthesis'>)</span></span>
and executes a stoppable callback registration (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>)<a class='hidden_link' href='#stopcallback.inplace.cons-2.sentence-1'>.</a></div></div></div></div><div class='texpara'><div class='itemdecl' id='stopcallback.inplace.cons-itemdecl:2'><div class='marginalizedparent'><a class='itemDeclLink' href='#stopcallback.inplace.cons-itemdecl:2'>🔗</a></div><code class='itemdeclcode'><span class='operator'>~</span>inplace_stop_callback<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
</code></div></div><div class='para' id='stopcallback.inplace.cons-3'><div class='marginalizedparent'><a class='marginalized' href='#stopcallback.inplace.cons-3'>3</a></div><div class='itemdescr'><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/399b93910d0bb6f5632405ad188e9f4aad0ae99a/source/threads.tex#L1393'>#</a></div><div class='texpara'><div id='stopcallback.inplace.cons-3.sentence-1' class='sentence'><i >Effects</i>: Executes a stoppable callback deregistration (<a href='#stoptoken.concepts' title='32.3.3&emsp;Stop token concepts'>[stoptoken.<span class='shy'></span>concepts]</a>)<a class='hidden_link' href='#stopcallback.inplace.cons-3.sentence-1'>.</a></div></div></div></div></div></div></div></body></html>