<!DOCTYPE html><html lang='en'><head><title>[exec.run.loop.general]</title><meta charset='UTF-8'><link rel='stylesheet' type='text/css' href='14882.css'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Serif'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans'><link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css2?family=Noto+Sans+Mono'><link rel='icon' href='icon.png'><link rel='stylesheet' type='text/css' href='expanded.css' title='Normal'><link rel='alternate stylesheet' type='text/css' href='colored.css' title='Notes and examples colored'><link rel='alternate stylesheet' type='text/css' href='normative-only.css' title='Notes and examples hidden'></head><body><div class='wrapper'><h1 ><a class='secnum' style='min-width:50pt'>33</a> Execution control library <a class='abbr_ref' href='./#exec'>[exec]</a></h1><h2 ><a class='secnum' style='min-width:65pt'>33.12</a> Execution contexts <a class='abbr_ref' href='exec.ctx#exec.run.loop.general'>[exec.ctx]</a></h2><h3 ><a class='secnum' style='min-width:80pt'>33.12.1</a> <span class='texttt'>execution&#x200b;::&#x200b;run_<span class='shy'></span>loop</span> <a class='abbr_ref' href='exec.run.loop#general'>[exec.run.loop]</a></h3><h4 ><a class='secnum' style='min-width:95pt'>33.12.1.1</a> General <a class='abbr_ref'>[exec.run.loop.general]</a></h4><div class='para' id='1'><div class='marginalizedparent'><a class='marginalized' href='#1'>1</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9b8a5e51752efe9edd7a447e96ffab0f3313accc/source/exec.tex#L5142'>#</a></div><div class='texpara'><div id='1.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> is an execution resource on which work can be scheduled<a class='hidden_link' href='#1.sentence-1'>.</a></div> <div id='1.sentence-2' class='sentence'>It maintains a thread-safe first-in-first-out queue of work<a class='hidden_link' href='#1.sentence-2'>.</a></div> <div id='1.sentence-3' class='sentence'>Its <span class='texttt'>run</span> member function removes elements from the queue and
executes them in a loop on the thread of execution that calls <span class='texttt'>run</span><a class='hidden_link' href='#1.sentence-3'>.</a></div></div></div><div class='para' id='2'><div class='marginalizedparent'><a class='marginalized' href='#2'>2</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9b8a5e51752efe9edd7a447e96ffab0f3313accc/source/exec.tex#L5148'>#</a></div><div class='texpara'><div id='2.sentence-1' class='sentence'>A <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated <a class='hidden_link' href='#def:count' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:count'><i >count</i></span></a>
that corresponds to the number of work items that are in its queue<a class='hidden_link' href='#2.sentence-1'>.</a></div> <div id='2.sentence-2' class='sentence'>Additionally, a <span class='texttt'>run_<span class='shy'></span>loop</span> instance has an associated state
that can be one of
<a class='hidden_link' href='#def:starting' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:starting'><i >starting</i></span></a>, <a class='hidden_link' href='#def:running' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:running'><i >running</i></span></a>, <a class='hidden_link' href='#def:finishing' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finishing'><i >finishing</i></span></a>, or <a class='hidden_link' href='#def:finished' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'><span id='def:finished'><i >finished</i></span></a><a class='hidden_link' href='#2.sentence-2'>.</a></div></div></div><div class='para' id='3'><div class='marginalizedparent'><a class='marginalized' href='#3'>3</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9b8a5e51752efe9edd7a447e96ffab0f3313accc/source/exec.tex#L5155'>#</a></div><div class='texpara'><div id='3.sentence-1' class='sentence'>Concurrent invocations of the member functions of <span class='texttt'>run_<span class='shy'></span>loop</span>
other than <span class='texttt'>run</span> and its destructor do not introduce data races<a class='hidden_link' href='#3.sentence-1'>.</a></div> <div id='3.sentence-2' class='sentence'>The member functions
<span class='texttt'><i >pop-front</i></span>, <span class='texttt'><i >push-back</i></span>, and <span class='texttt'>finish</span>
execute atomically<a class='hidden_link' href='#3.sentence-2'>.</a></div></div></div><div class='para' id='4'><div class='marginalizedparent'><a class='marginalized' href='#4'>4</a></div><div class='sourceLinkParent'><a class='sourceLink' href='https://github.com/cplusplus/draft/tree/9b8a5e51752efe9edd7a447e96ffab0f3313accc/source/exec.tex#L5162'>#</a></div><div class='texpara'><div id='4.sentence-1' class='sentence'><i >Recommended practice</i>: Implementations should use an intrusive queue of operation states
to hold the work units to make scheduling allocation-free<a class='hidden_link' href='#4.sentence-1'>.</a></div></div><div class='texpara'><span class='codeblock'><span class='keyword'>namespace</span> std<span class='operator'>::</span>execution <span class='curlybracket'>{</span>
  <span class='keyword'>class</span> <span id='lib:run_loop'><a class='hidden_link' href='#lib:run_loop' title='33.12.1.1&emsp;General&emsp;[exec.run.loop.general]'>run_loop</a></span> <span class='curlybracket'>{</span>
    <span class='comment'>// <a href='exec.run.loop.types' title='33.12.1.2&emsp;Associated types'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>types]</a>, associated types</span>
    <span class='keyword'>class</span> <i >run-loop-scheduler</i>;                                   <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>class</span> <i >run-loop-sender</i>;                                      <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>struct</span> <i >run-loop-opstate-base</i> <span class='curlybracket'>{</span>                              <span class='comment'>// <i >exposition only</i></span>
      <span class='keyword'>virtual</span> <span class='keyword'>void</span> <i >execute</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='literal'>0</span>;                               <span class='comment'>// <i >exposition only</i></span>
      run_loop<span class='operator'>*</span> <i >loop</i>;                                           <span class='comment'>// <i >exposition only</i></span>
      run<span class='operator'>-</span>loop<span class='operator'>-</span>opstate<span class='operator'>-</span>base<span class='operator'>*</span> <i >next</i>;                              <span class='comment'>// <i >exposition only</i></span>
    <span class='curlybracket'>}</span>;
    <span class='keyword'>template</span><span class='anglebracket'>&lt;</span><span class='keyword'>class</span> Rcvr<span class='anglebracket'>&gt;</span>
      <span class='keyword'>using</span> <i >run-loop-opstate</i> <span class='operator'>=</span> <i ><span class='texttt'>unspecified</span></i>;                     <span class='comment'>// <i >exposition only</i></span>

    <span class='comment'>// <a href='exec.run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-opstate-base</i><span class='operator'>*</span> <i >pop-front</i><span class='parenthesis'>(</span><span class='parenthesis'>)</span>;                         <span class='comment'>// <i >exposition only</i></span>
    <span class='keyword'>void</span> <i >push-back</i><span class='parenthesis'>(</span><i >run-loop-opstate-base</i><span class='operator'>*</span><span class='parenthesis'>)</span>;                     <span class='comment'>// <i >exposition only</i></span>

  <span class='keyword'>public</span><span class='operator'>:</span>
    <span class='comment'>// <a href='exec.run.loop.ctor' title='33.12.1.3&emsp;Constructor and destructor'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>ctor]</a>, constructor and destructor</span>
    run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span> <span class='keyword'>noexcept</span>;
    run_loop<span class='parenthesis'>(</span>run_loop<span class='operator'>&amp;</span><span class='operator'>&amp;</span><span class='parenthesis'>)</span> <span class='operator'>=</span> <span class='keyword'>delete</span>;
    <span class='operator'>~</span>run_loop<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;

    <span class='comment'>// <a href='exec.run.loop.members' title='33.12.1.4&emsp;Member functions'>[exec.<span class='shy'></span>run.<span class='shy'></span>loop.<span class='shy'></span>members]</a>, member functions</span>
    <i >run-loop-scheduler</i> get_scheduler<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> run<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
    <span class='keyword'>void</span> finish<span class='parenthesis'>(</span><span class='parenthesis'>)</span>;
  <span class='curlybracket'>}</span>;
<span class='curlybracket'>}</span>
</span></div></div></div></body></html>